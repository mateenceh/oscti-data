<!DOCTYPE html>
<html lang="en">

<head class="sans-serif">

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="baidu-site-verification" content="KeThzeyMOr" />
    <meta name="baidu-site-verification" content="code-NIlrS7gNhx" />

    <title>Multiplayer Doom on Cloudflare Workers</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/tippy.js/3.4.1/themes/light.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/index.css?v=ee05741d71" />

    <link rel="apple-touch-icon" sizes="180x180" href="/favicon_package_v0.16/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon_package_v0.16/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon_package_v0.16/favicon-16x16.png">
    <link rel="mask-icon" href="/favicon_package_v0.16/safari-pinned-tab.svg" color="#f78100">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    <script type="text/javascript" src="/assets/built/index.js?v=ee05741d71"></script>
    <script src="/assets/js/check-for-tex.js" defer></script>

    <meta name="description" content="Here&#x27;s Doom Multiplayer running on top of Cloudflare Workers." />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="canonical" href="https://blog.cloudflare.com/doom-multiplayer-workers/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    
    <meta property="og:site_name" content="The Cloudflare Blog" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Multiplayer Doom on Cloudflare Workers" />
    <meta property="og:description" content="So, if a developer wants to run their next hit, say a real-time multiplayer game, using nothing but their app and Workers, without any servers or traditional infrastructure, can they? Let’s prove they can. Here&#x27;s Doom Multiplayer running on top of Cloudflare Workers." />
    <meta property="og:url" content="https://blog.cloudflare.com/doom-multiplayer-workers/" />
    <meta property="og:image" content="https://blog.cloudflare.com/content/images/2021/05/image4-8.png" />
    <meta property="article:published_time" content="2021-05-18T12:59:57.000Z" />
    <meta property="article:modified_time" content="2021-05-18T12:59:57.000Z" />
    <meta property="article:tag" content="Cloudflare Workers" />
    <meta property="article:tag" content="Gaming" />
    <meta property="article:tag" content="Durable Objects" />
    
    <meta property="article:publisher" content="https://www.facebook.com/cloudflare" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Multiplayer Doom on Cloudflare Workers" />
    <meta name="twitter:description" content="So, if a developer wants to run their next hit, say a real-time multiplayer game, using nothing but their app and Workers, without any servers or traditional infrastructure, can they? Let’s prove they can. Here&#x27;s Doom Multiplayer running on top of Cloudflare Workers." />
    <meta name="twitter:url" content="https://blog.cloudflare.com/doom-multiplayer-workers/" />
    <meta name="twitter:image" content="https://blog.cloudflare.com/content/images/2021/05/image4-8.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Celso Martinho" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Cloudflare Workers, Gaming, Durable Objects" />
    <meta name="twitter:site" content="@cloudflare" />
    <meta name="twitter:creator" content="@celso" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "The Cloudflare Blog",
        "logo": {
            "@type": "ImageObject",
            "url": "https://blog-cloudflare-com-assets.storage.googleapis.com/2019/06/logo-cloudflare-dark-1.svg",
            "width": 109,
            "height": 40.5
        }
    },
    "author": {
        "@type": "Person",
        "name": "Celso Martinho",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/a2f317c510e8b8fb72f8ddd568ab417c?s=250&d=mm&r=x",
            "width": 250,
            "height": 250
        },
        "url": "https://blog.cloudflare.com/author/celso/",
        "sameAs": [
            "https://celso.io/",
            "https://twitter.com/celso"
        ]
    },
    "headline": "Multiplayer Doom on Cloudflare Workers",
    "url": "https://blog.cloudflare.com/doom-multiplayer-workers/",
    "datePublished": "2021-05-18T12:59:57.000Z",
    "dateModified": "2021-05-18T12:59:57.000Z",
    "image": "https://blog.cloudflare.com/content/images/2021/05/image4-8.png",
    "keywords": "Cloudflare Workers, Gaming, Durable Objects",
    "description": "So, if a developer wants to run their next hit, say a real-time multiplayer game, using nothing but their app and Workers, without any servers or traditional infrastructure, can they? Let’s prove they can. Here&#x27;s Doom Multiplayer running on top of Cloudflare Workers.",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://blog.cloudflare.com/"
    }
}
    </script>

    <meta name="generator" content="Ghost 3.5" />
    <link rel="alternate" type="application/rss+xml" title="The Cloudflare Blog" href="https://blog.cloudflare.com/rss/" />
    <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://tr.www.cloudflare.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','cfDataLayer','GTM-PKQFGQB');</script>
<!-- End Google Tag Manager -->

<!-- Google Optimize -->
<script src="https://www.googleoptimize.com/optimize.js?id=GTM-N4JSZJ8"></script>

<meta name="msvalidate.01" content="CF295E1604697F9CAD18B5A232E871F6" />
<meta class="swiftype" name="language" data-type="string" content="en" />
<!--<script src="/assets/js/index.js"></script>-->
<script type="text/javascript" src="//cdn.bizible.com/scripts/bizible.js" async=""></script>
<script>
var trackRecruitingLink = function(role, url) {
   ga('send', 'event', 'recruiting', 'jobscore-click', role, {
     'transport': 'beacon',
     'hitCallback': function(){document.location = url;}
   });
}
</script> 
<script type="text/javascript">
	(function() {
		var didInit = false;
		function initMunchkin() {
			if(didInit === false) {
				didInit = true;
				Munchkin.init('713-XSC-918');
			}
		}
		var s = document.createElement('script');
		s.type = 'text/javascript';
		s.async = true;
		s.src = '//munchkin.marketo.net/munchkin.js';
		s.onreadystatechange = function() {
			if (this.readyState == 'complete' || this.readyState == 'loaded') {
				initMunchkin();
			}
		};
		s.onload = initMunchkin;
		document.getElementsByTagName('head')[0].appendChild(s);
		})();
</script>
<script>
var HTMLAttrToAdd = document.querySelector("html");
HTMLAttrToAdd.setAttribute("lang", "en");
</script>
<style>
    table {
        background-color: transparent;
    }
    td {
		padding: 5px 1em;
    }
    pre {
        max-height: 500px;
        overflow-y: scroll;
    }
</style>
<!-- Cloudflare Web Analytics -->
<script
        defer
        src='https://static.cloudflareinsights.com/beacon.min.js'
        data-cf-beacon='{"token": "f446eacb44504e50864bad7c47ffa9e8"}'></script>
<!-- End Cloudflare Web Analytics -->

</head>

<body id="main-body" class="post-template tag-hash-blog-511 tag-workers tag-gaming tag-durable-objects sans-serif">

    <div class="site-wrapper">

        <header class="flex flex-row flex-wrap justify-between items-end mw8 center mv3 pl3 pr2">
    <div class="w-100 flex items-end justify-between justify-start-l">
        <div class="w-100 tr">
            <span class="dn di-l">
                <a href="https://www.cloudflare.com/plans/enterprise/contact/" class="f1 gray4 no-underline underline-hover">Contact Sales:
                </a>
                <a href="tel:+18889935273" class="f1 gray4 no-underline underline-hover">+1 (888) 274-3482</a>
            </span>
        </div>
    </div>
    <div class="w-100 w-50-l flex items-end justify-between justify-start-l">
        <a href="https://blog.cloudflare.com" class="header-logo mr4">
            <img src="https://blog-cloudflare-com-assets.storage.googleapis.com/2019/06/logo-cloudflare-dark-1.svg" alt="The Cloudflare Blog" class="header-logo" />
        </a>
        <h2 class="mt0 mb1">
            <a href="/" class="fw5 f5 gray3 no-underline">
                <span class="dn di-l">The Cloudflare Blog</span>
            </a>
        </h2>
    </div>
    <div class="w-100 w-50-l dn db-l">
        <div class="w-100 tr mkto-sub-message">
            <p class="f2">Thanks for being here, come back soon. Get notified of new posts:</p>
        </div>
        <div class="w-100 tr">
            <script src="//app-ab13.marketo.com/js/forms2/js/forms2.min.js"></script>
            <div class="marketo-form-container">
                <form id="mktoForm_1653"></form>
            </div>
            <script>
                MktoForms2.loadForm("//app-ab13.marketo.com", "713-XSC-918", 1653, function(form) {
                    document.querySelectorAll('#mktoForm_1653 .mktoEmailField')[0].placeholder = "Email Address";

                    form.onSuccess(function(vals, thanksURL){
                        // Hide form and show success msg
                        document.getElementById("mktoForm_1653").style.display = "none";
                        document.getElementsByClassName("mkto-sub-message")[0].style.display = "none";

                        document.getElementsByClassName("js-form-success-msg")[0].style.display = "block";
                        return false;
                    });
                });
            </script>
        </div>
        <div class="w-100 tr dn js-form-success-msg">
            <p class="f2">Subscription confirmed. Thank you for subscribing!</p>
        </div>
    </div>
</header>

<nav id="nav" class="w-100 bb b--black-10 z-1">
    <div id="desktop-nav-items-container" class="flex flex-row flex-wrap justify-between items-center mw8 center mv3 mv0-l">
        <div class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3" data-tag="product-news">
            <a href="/tag/product-news/" class="no-underline gray1 f2 fw5 pv3">Product News</a>
        </div>
        <div class="nav-item nav-item-desktop mh2 dn db-l pv3" data-tag="speed-and-reliability">
            <a href="/tag/speed-and-reliability/" class="no-underline gray1 f2 fw5 pv3">Speed &amp; Reliability</a>
        </div>
        <div class="nav-item nav-item-desktop mh2 dn db-l pv3" data-tag="security">
            <a href="/tag/security/" class="no-underline gray1 f2 fw5 pv3">Security</a>
        </div>
        <div class="nav-item nav-item-desktop mh2 dn db-l pv3" data-tag="serverless">
            <a href="/tag/serverless/" class="no-underline gray1 f2 fw5 pv3">Serverless</a>
        </div>
        <div class="nav-item nav-item-desktop mh2 dn db-l pv3" data-tag="zero-trust">
            <a href="/tag/zero-trust/" class="no-underline gray1 f2 fw5 pv3">Zero Trust</a>
        </div>
        <div class="nav-item nav-item-desktop mh2 dn db-l pv3" data-tag="developers">
            <a href="/tag/developers/" class="no-underline gray1 f2 fw5 pv3">Developers</a>
        </div>
        <div class="nav-item nav-item-desktop mh2 dn db-l pv3" data-tag="deep-dive">
            <a href="/tag/deep-dive/" class="no-underline gray1 f2 fw5 pv3">Deep Dive</a>
        </div>
        <div class="nav-item nav-item-desktop ml2 mr3 dn db-l pv3" data-tag="life-at-cloudflare">
            <a href="/tag/life-at-cloudflare/" class="no-underline gray1 f2 fw5 pv3">Life @Cloudflare</a>
        </div>
        <a href="/search/"><img src="/assets/images/magnifier.svg?v=ee05741d71" class="js-search-box-trigger mw2 pointer ph3 ph2-l" />
        </a>
        <img src="/assets/images/hamburger.svg?v=ee05741d71" class="w2 pointer js-mobile-nav-trigger ph3 db dn-l" />
    </div>

    <div class="js-mobile-nav-container dn">
        <div class="flex flex-column flex-wrap bg-gray9 o-95 absolute w-100 ph3 z-1">
            <div class="pv3 ph2">
                <a href="/tag/product-news/" class="no-underline gray1 f4 fw7">Product News</a>
            </div>
            <div class="pv3 ph2">
                <a href="/tag/speed-and-reliability/" class="no-underline gray1 f4 fw7">Speed &amp; Reliability</a>
            </div>
            <div class="pv3 ph2">
                <a href="/tag/security/" class="no-underline gray1 f4 fw7">Security</a>
            </div>
            <div class="pv3 ph2">
                <a href="/tag/serverless/" class="no-underline gray1 f4 fw7">Serverless</a>
            </div>
            <div class="pv3 ph2">
                <a href="/tag/zero-trust/" class="no-underline gray1 f4 fw7">Zero Trust</a>
            </div>
            <div class="pv3 ph2">
                <a href="/tag/developers/" class="no-underline gray1 f4 fw7">Developers</a>
            </div>
            <div class="pv3 ph2">
                <a href="/tag/deep-dive/" class="no-underline gray1 f4 fw7">Deep Dive</a>
            </div>
            <div class="pv3 ph2">
                <a href="/tag/life-at-cloudflare/" class="no-underline gray1 f4 fw7">Life @Cloudflare</a>
            </div>
        </div>
    </div>
</nav>
        


<main id="post" class="flex flex-row flex-wrap items-center justify-center pt2 pt4-l">
    <article
        class="post-full mw-100 ph3 ph0-l fs-20px post tag-hash-blog-511 tag-workers tag-gaming tag-durable-objects ">
        <h1 class="f6 f7-l fw4 gray1 pt1 pt3-l mb1">Multiplayer Doom on Cloudflare Workers</h1>


        <p class="f3 fw5 gray5 db di-l mt2" localize datetime="2021-05-18T13:59:57+01:00">Loading...</p>
        <noscript>
            <p class="f3 fw5 gray5 db di-l mt2">May 18, 2021 1:59PM</p>
        </noscript>

        <ul class="flex flex-wrap pl0 mt4">
            <li class="list flex items-center ml0 pl0 pb1">
                <a href="/author/celso/" class="static-avatar pr1">
                    <img class="author-profile-image h2 w2 br-100 mr2" src="//www.gravatar.com/avatar/a2f317c510e8b8fb72f8ddd568ab417c?s&#x3D;250&amp;d&#x3D;mm&amp;r&#x3D;x" alt="Celso Martinho" />
                </a>
                <div class="author-name-tooltip">
                    <a href="/author/celso" class="fw5 f3 no-underline black mr3">Celso Martinho</a>
                </div>
            </li>
        </ul>

        <section class="post-full-content">
            <div class="post-content lh-copy gray1">
                <figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2021/05/image4-7.png" class="kg-image"></figure><p>There are halls and corridors in Cloudflare engineering, dangerous places for innocent wanderers, filled with wild project ideas, experiments that we should do, and extremely convincing proponents. A couple of months ago, John Graham-Cumming, our CTO, bumped into me in one of those places and asked: "What if we ported Doom multiplayer to work with our edge network?". He fatally <a href="https://xkcd.com/356/">nerd-sniped</a> me.</p><p><em>Aside by John: I nerd-sniped him because I wanted to show how Cloudflare Workers and Durable Objects are a new architectural paradigm where, rather than choosing between two places to write code (the client, the browser or app, and the server, perhaps in a cloud provider availability zone), there’s a third way: put code on the edge.</em></p><figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2021/05/image9.png" class="kg-image"></figure><p><em>Writing code that runs on a client (such as JavaScript that runs in a browser or a native app on a phone) has advantages. Because the code runs close to the end-user it can be highly interactive, there’s almost no latency since it’s literally running on the device. But client-side code has security problems: it’s literally in the hands of the end-user and thus can be reverse engineered or modified. And client-side code can be slow to update as it depends on the end-user. If the client is actually an IoT device then updates can be even slower or essentially never.</em></p><p><em>On the other hand, code running on a server is quick to update and secure. You can keep secrets in that code, and modify it at will. But it tends to be far from the end-user which limits interactivity because of latency.</em></p><p><em>The edge offers advantages from both worlds: the code is secured and can contain secrets since it runs in a controlled environment and not on the end-user device, the code can be updated quickly since it doesn’t depend on the end-user and the edge is close to end-users meaning low latency and opportunity for high interactivity.</em></p><figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2021/05/image5-4.png" class="kg-image"></figure><p><em>Games are fun, interactive and tend to stress systems. Doom Multiplayer was the perfect example because it demonstrates the power of WebAssembly to run code in the browser and the power of Durable Objects to provide the backend for multiplayer games with low latency.</em></p><p><em>So while you’re enjoying multiplayer Doom running in the browser and coordinated by Durable Objects and Cloudflare Workers, try to keep in mind this new architecture for applications. And we’ve open sourced the code for all of it: </em><a href="https://github.com/cloudflare/doom-wasm"><em>Doom running in Wasm</em></a><em>, the associated </em><a href="https://github.com/cloudflare/doom-workers"><em>website</em></a><em> and the message </em><a href="https://github.com/cloudflare/doom-workers"><em>routing</em></a><em> code that runs on the edge using Cloudflare Workers and Durable Objects.</em></p><p><em>Back to Celso...</em></p><p>Doom <a href="https://www.youtube.com/watch?v=6A4-SVUHQYI">is considered</a> the first popularized FPS (first-person shooter) game of all time. When id Software launched it in 1993, it boasted 3D graphics, spatial navigation, networked multiplayer, and an open format (WAD) to define levels, sprites, and all sorts of game modifications, also known as Doom <a href="https://en.wikipedia.org/wiki/Doom_modding">modding</a>. It became an instant revolution and sparked both a new game industry and a global community of gamers and Doom fans that lasts up until today.</p><p>If you want to read more about this period and how the "<a href="https://en.wikipedia.org/wiki/Masters_of_Doom">Two Johns</a>" changed everything in gaming back in the 90s, I highly recommend you get a copy of the book <a href="https://www.goodreads.com/book/show/222146.Masters_of_Doom">Masters of Doom</a>.</p><p>But Doom has gone beyond the gaming community. In 1997, <a href="https://twitter.com/ID_AA_Carmack">John Carmack</a>, still at id Software, <a href="https://github.com/id-Software/DOOM">open-sourced the original code</a> and presented it as "a useful base to experiment and build on." Little did he know. Since then, his masterpiece was ported to run on pretty much anything that has a CPU on it, including a <a href="https://twitter.com/Foone/status/1302820468819288066">pregnancy test</a> and a <a href="https://www.youtube.com/watch?v=ztVI7r7C-1w">spectrum analyser</a>. Running Doom is effectively the new “Hello, World” in computing.</p><p>A few weeks ago, we introduced a major feature in our Workers edge computing platform: <a href="https://blog.cloudflare.com/introducing-websockets-in-workers/">WebSockets support</a>. Not only that, but we improved <a href="https://developers.cloudflare.com/workers/learning/using-durable-objects">Durable Objects</a> to seamlessly interface with WebSocket connections and provide state and storage capabilities. This opened a large door to start implementing real-time, interactive applications that can communicate over persistent data connections, all on top of <a href="https://developers.cloudflare.com/workers/">Workers</a>.</p><p>So, if a developer wants to run their next hit, say a real-time multiplayer game, using nothing but their app and Workers, without any servers or traditional infrastructure, can they? Let’s prove they can.</p><p>Here's Doom Multiplayer running on top of Cloudflare Workers showcasing this scenario…</p><p><a href="https://silentspacemarine.com/">https://silentspacemarine.com/</a><br></p><p>...and read it to find out how we did it.</p><figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2021/05/image8-1.png" class="kg-image"></figure><h2 id="keeping-it-simple">Keeping it simple</h2><p>We wanted this demo to be as simple as possible, to run in the browser, end to end, with no downloads or native binaries required. This meant one first task: porting Doom to compile to <a href="https://webassembly.org/">WebAssembly</a>, an open standard that defines a portable binary-code format for executable programs and enables high-performance applications in multiple environments, including web pages on modern browsers.</p><p>We looked around for other Wasm Doom ports<strong> that included the network layer</strong> but didn't find any. It was time to get our hands dirty and do it ourselves. How hard could it be?</p><p>Enter the world of <a href="https://emscripten.org/">Emscripten</a>, “a complete compiler toolchain to WebAssembly, using LLVM” that provides Web support for popular portable APIs such as SDL, effectively allowing ports of complex applications such as Doom.</p><p>We also found <a href="https://github.com/chocolate-doom/chocolate-doom">Chocolate Doom</a>, a modern, community-driven, well-maintained port that aims to reproduce the original DOS version of Doom and has a few bonuses, like networked multiplayer support, and a decent, readable, and modular codebase. Perfect match.</p><p>Long story short, we got Emscripten to compile Chocolate Doom a few days later. It felt like magic when we saw Doom running in a browser window for the first time. The magic is WebAssembly.</p><figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2021/05/image3-5.png" class="kg-image"></figure><p>It cost us a few head bangs on the wall, but we learned a lot in the process. Here's a few things I think you’ll find interesting:</p><h3 id="no-main-loop">No main() loop</h3><p>Unlike many C/C++ graphical apps, like games, you can't have an infinite loop running on a page. The browser environment is <a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Building_blocks/Events">event-driven</a>. When an event is processed, it then needs to return control to the browser so that the next event gets its turn.</p><p>Emscripten provides a function to solve this problem. With <a href="https://emscripten.org/docs/api_reference/emscripten.h.html#c.emscripten_set_main_loop"><code>emscripten_set_main_loop()</code></a>, you can have your infinite loop running at, say, 60 frames per second, but the other browser functions can still run between iterations without hanging the page.</p><p>In <a href="https://github.com/chocolate-doom/chocolate-doom/blob/master/src/doom/d_main.c#L499"><code>d_main.c</code></a></p><!--kg-card-begin: markdown--><pre><code class="language-js">while (1)
{
	D_RunFrame();
}
</code></pre>
<!--kg-card-end: markdown--><p>Became:</p><!--kg-card-begin: markdown--><pre><code class="language-js">emscripten_set_main_loop(D_RunFrame, 0, 0);
</code></pre>
<!--kg-card-end: markdown--><h3 id="no-udp">No UDP</h3><p>The original MS-DOS Doom used the <a href="https://en.wikipedia.org/wiki/IPX/SPX">IPX</a> networking protocol from Novell NetWare. Later versions and current ports migrated to UDP (though some still maintain compatibility with IPX, because why not?). There's a good reason why action games use UDP (instead of TCP) for their multiplayer protocols. UDP is simple, fast, and non-blocking. However, you need to deal with packet loss or out-of-order packets at the application level. You're basically trading responsiveness, low latency, and speed for guarantees and reliability.</p><p>Emscripten has some <a href="https://emscripten.org/docs/porting/networking.html">wrappers</a> to emulate POSIX TCP sockets over WebSockets, but not UDP. Also, we don't want UDP; we want to use WebSockets, which in turn use TCP.</p><p>It became evident that we'd have to write a new Chocolate Doom network module to use TCP and WebSockets instead of UDP while working to mitigate the problems mentioned above.</p><h3 id="enter-the-net_websockets-c-driver">Enter the net_websockets.c driver</h3><p>We had to deal with a few challenges to make the WebSockets module work the way we wanted. The first was the network topology:</p><figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2021/05/image7-1.png" class="kg-image"></figure><p>On the left, let’s imagine there are four players in the original LAN topology: the server (the one who starts the game) and the other three players who connect to the server via UDP. If you wanted to play Doom over the Internet, you'd have to make sure all players had public IP addresses and specific firewall and forwarding rules configured. Chocolate Doom even has some <a href="https://en.wikipedia.org/wiki/Hole_punching_(networking)">hole punching</a> code in it. We don't want to deal with any of this.</p><p>On the right, in our case, we want everything to be Web-based and zero-config, so all of the four players connect to a single WebSockets server that acts as a message router between the group.</p><p>We won’t have IP addresses anymore, just a WebSocket connection to which we need to tunnel our UDP-based point-to-point protocol through. To emulate the standard behaviour we create a <a href="https://github.com/cloudflare/doom-wasm/blob/main/src/d_loop.c#L438">fake IP at startup</a>, just a random uint32_t number, and we add ourselves and the other clients we discover in the WebSocket protocol and have to talk to, to an internal <a href="https://github.com/cloudflare/doom-wasm/blob/main/src/net_websockets.c#L41">routing</a> table.</p><!--kg-card-begin: markdown--><pre><code class="language-js">// Generate UID for this instance - it will be used as the websocketsID
srand((unsigned int)time(NULL));
instanceUID = rand() % 0xfffe;

// addresses table
static int addrs_index = 0;
net_addr_t addrs[MAX_QUEUE_SIZE];
uint32_t ips[MAX_QUEUE_SIZE];

// add a new fake ip to the routing table
addrs[addrs_index].refcount = 1;
addrs[addrs_index].module = &amp;net_websockets_module;
ips[addrs_index] = ip;
addrs[addrs_index].handle = &amp;ips[addrs_index];
return (&amp;addrs[addrs_index++]);
</code></pre>
<!--kg-card-end: markdown--><p>Next, we wanted to avoid blocking Doom at all costs, so we created an intermediate queue between the asynchronous WebSockets layer and the internal Doom routines to act as a buffer and alleviate the fact that, indeed, we'll be using TCP. This worked nicely.</p><!--kg-card-begin: markdown--><pre><code class="language-js">// WebSockets packet queue
typedef struct {
    net_packet_t *packets[MAX_QUEUE_SIZE];
    uint32_t froms[MAX_QUEUE_SIZE];
    int head, tail;
} packet_queue_t;

// Pushes one packet into the queue
static void WebsocketsQueuePush(packet_queue_t *queue, net_packet_t *packet, uint32_t from)

// Pops one packet from the queue
static ws_packet_t *WebsocketsQueuePop(packet_queue_t *queue)
</code></pre>
<!--kg-card-end: markdown--><p>This queue is then fed every time we receive a new WebSockets packet, asynchronously, outside the game main loop and logic.</p><!--kg-card-begin: markdown--><pre><code class="language-js">WebSocketMessage(int t, const WebSocketMessageEvent *e, void *data) {
    ...
    packet = NET_NewPacket(e-&gt;numBytes - 4);
    memcpy(packet-&gt;data, &amp;e-&gt;data[4], e-&gt;numBytes - 4);
    ...
    WebsocketsQueuePush(&amp;client_queue, packet, ip);
}

emscripten_websocket_set_onmessage_callback(websocket, (void *)45, WebSocketMessage);
</code></pre>
<!--kg-card-end: markdown--><p>And then, when the main game loop asks for newly received packets as part of its “main loop”, we’re now able to instantly return everything we see in our queue, close to how UDP would behave.</p><!--kg-card-begin: markdown--><pre><code class="language-js">NET_Websockets_RecvPacket(net_addr_t **addr, net_packet_t **packet)
{
    ws_packet_t *popped;

    if (InitWebSockets() == false) return false;

    popped = WebsocketsQueuePop(&amp;client_queue);

    if (popped != NULL) {
        *packet = popped-&gt;packet;
        *addr = FindAddressByIp((*(uint32_t *)(popped-&gt;from)));
        return true;
    }

    return false;
}
</code></pre>
<!--kg-card-end: markdown--><p>Finally we use <a href="https://github.com/cloudflare/doom-wasm/blob/main/src/net_websockets.c#L200">NET_Websockets_SendPacket()</a> and <a href="http://emscripten_websocket_send_binary">emscripten_websocket_send_binary</a>() to send the traffic out. The messages are sent through the WebSocket using a simple envelope that contains the “From” and the “To” fake IPs, 4 bytes each (UInt32 little-endian), and the original packet from the Doom protocol.</p><!--kg-card-begin: markdown--><pre><code class="language-js">NET_Websockets_SendPacket(net_addr_t *addr, net_packet_t *packet)
{
    char *wspacket = malloc(packet-&gt;len + 8);
    to_ip = (*(uint32_t *)(addr-&gt;handle));
    memcpy(&amp;wspacket[0], &amp;to_ip, 4);       // to
    memcpy(&amp;wspacket[4], &amp;instanceUID, 4); // from
    memcpy(&amp;wspacket[8], packet-&gt;data, packet-&gt;len);
    emscripten_websocket_send_binary(websocket, wspacket, packet-&gt;len + 8);
    free(wspacket);
}
</code></pre>
<!--kg-card-end: markdown--><p>The message router in Cloudflare Workers, explained below, then keeps its own table of connections and uses the address headers to, well, route the incoming messages to the correspondent client.</p><figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2021/05/image1-6.png" class="kg-image"></figure><p>We also added a few options to the original Chocolate Doom code base, like choosing your name from the command line, and support for multiple keys for the same action.</p><p>The open-sourced code and instructions to compile and run Wasm Doom locally can be found in <a href="http://github.com/cloudflare/doom-wasm">this repo</a>.</p><h2 id="the-message-router">The Message Router</h2><p>The message router runs on Cloudflare edge and handles the incoming and outgoing messages between the clients and the server. It has the following requirements:</p><ul><li>Accept WebSocket connections</li><li>Build a routing table that maps a connection to a “From” address</li><li>Receive and parse the incoming messages</li><li>Broadcast the messages to the corresponding clients</li><li>Handle some REST APIs to create and validate Doom rooms (game sessions)</li></ul><p>We're using Cloudflare Workers’ <a href="https://developers.cloudflare.com/workers/learning/using-websockets">WebSockets</a> support to handle the client connections and <a href="https://developers.cloudflare.com/workers/learning/using-durable-objects">Durable Objects</a> to provide state across them for the message router.</p><p>WebSockets are persistent connections between the client and, in this case, Cloudflare edge. Inside the connection, both ends can exchange data fast, whenever they want, without additional overhead, which make them ideal for real-time interactive applications like chats, sports results, stock information, or gaming.</p><p>A Durable Object is simply a class in our Worker code that contains data and methods to access and manipulate that data and other logic. You interact with your Durable Object through the well-known <a href="https://developers.cloudflare.com/workers/runtime-apis/fetch">Fetch API</a>, just like any regular Worker.</p><p>Let's go through some code:</p><p>This is the default Worker class, all it does to handover things to handleApiRequest()</p><!--kg-card-begin: markdown--><pre><code class="language-js">export default {
    ...
    return handleApiRequest(url.pathname, request, env)
    ...
}
</code></pre>
<!--kg-card-end: markdown--><p>Each multiplayer game session creates a unique Id, or "room", which corresponds to its own Durable Object instance. This Id is used in the URL when the user invites friends to his new game.</p><p><a href="https://github.com/cloudflare/doom-workers/blob/3fc79f1822e4455414fdd6b6a669774c087ae93c/router/index.mjs#L57"><code>handleApiRequest()</code></a>validates the room Id in the URL and forwards the API request or WebSocket connection to the corresponding Durable Object object.</p><p>There's a small performance trick in here. There are two ways you can ask Workers to generate a unique Durable Object Id. One is by using <a href="https://developers.cloudflare.com/workers/runtime-apis/durable-objects#generating-ids-randomly"><code>newUniqueId()</code></a>, which is very fast; another one is to use <code>idFromName()</code>, which derives the Id from your arbitrary input string. The latter can be convenient for some use-cases, but it requires our platform to do a global network lookup, which can be expensive time-wise. We're using <code>newUniqueId()</code>, and we construct our room Id with it (Thanks, Kenton Varda).</p><!--kg-card-begin: markdown--><pre><code class="language-js">async function handleApiRequest(path, request, env) {
  ...
  switch (parts[1]) {
    case 'ws':
    case 'room':
      room = await checkRoom(parts[2], env)
      if (room) {
        let id = env.router.idFromString(room)
        let routerObject = env.router.get(id)
        return routerObject.fetch(path, request)
      }
    case 'newroom':
      room = await createRoom(env)
      return jsonReply({ room: room }, 200)
  }
}
</code></pre>
<!--kg-card-end: markdown--><p>Here’s how we create a new room Id:</p><!--kg-card-begin: markdown--><pre><code class="language-js">async function createRoom(env) {
  const room = env.router.newUniqueId().toString()
  const digest = await crypto.subtle.digest({ name: 'SHA-256' },
    new TextEncoder().encode(room + env.DOOM_KEY),
  )
  const hash = Array.from(new Uint8Array(digest))
  const hex = hash.slice(0, 4).map(b =&gt; b.toString(16)
    .padStart(2, '0'))
    .join('')
  return `${room}-${hex}`
}
</code></pre>
<!--kg-card-end: markdown--><p>Finally, our Router takes over and handles the WebSockets messages. <code>webSocket.addEventListener('message')</code>runs on every received message and does a few things.</p><p>First it decodes the packet:</p><!--kg-card-begin: markdown--><pre><code class="language-js">let data = msg.data
let from = new Uint32Array(data.slice(4, 8))[0]
let to = new Uint32Array(data.slice(0, 4))[0]
</code></pre>
<!--kg-card-end: markdown--><p>Then, it adds every new client to a routing table, a list of WebSocket objects (open connections), and corresponding "From" Ids (see our Doom protocol packet scheme above).</p><!--kg-card-begin: markdown--><pre><code class="language-js">// if it's a new client, add it to the table of clients
if (this.sessions.map(c =&gt; c.from).indexOf(from) == -1) {
    let session = { ws: webSocket, from: from }
    this.sessions.push(session)
}
</code></pre>
<!--kg-card-end: markdown--><p>And finally, it sends the message to its destination, the "To" client.</p><!--kg-card-begin: markdown--><pre><code class="language-js">// send this packet to the corresponding client
i = this.sessions.map(c =&gt; c.from).indexOf(to)
if (i != -1) this.sessions[i].ws.send(data.slice(4))
</code></pre>
<!--kg-card-end: markdown--><p>You can check the full source code and setup instructions for the message router in our GitHub repo <a href="https://github.com/cloudflare/doom-wasm">here</a>. We also provide a simplified NodeJS implementation to facilitate local development.</p><h2 id="the-website">The Website</h2><p>The cherry on top of our little pet project is the website, the thing that glues everything together. We will, of course, be using <a href="https://pages.cloudflare.com/">Cloudflare Pages</a> for this.</p><p>The website needs to do a couple of things:</p><ul><li>Run Wasm Doom on the page and adjust its input arguments according to the user context (multiplayer, initiator or friend, deathmatch or cooperative, solo play, etc.)</li><li>Have great UX and the most straightforward possible game setup and game join sequences.</li><li>Interact with Doom and provide feedback to the user.</li><li>Have that retro feeling 90s dark look.</li></ul><h3 id="running-wasm-doom">Running Wasm Doom</h3><p>Emscripten Wasm binaries use <a href="https://emscripten.org/docs/api_reference/module.html">Module</a>, a global JavaScript object, as their environment configuration. When the app starts, it looks at the Module's definitions and applies them during the different execution stages.</p><p>Module allows you to define things like the input arguments (like the ones you'd pass to a command-line app), code to run before the Wasm starts, the function to handle stdout, and many other parameters.</p><p>For instance, we use <a href="https://emscripten.org/docs/api_reference/module.html#Module.preRun">PreRun</a> to make sure we load two files, <code>doom1.wad</code> and <code>default.cfg</code> into Emscripten’s <a href="https://emscripten.org/docs/api_reference/Filesystem-API.html">virtual file-system</a> before Doom starts. Without them, the app wouldn’t start.</p><!--kg-card-begin: markdown--><pre><code class="language-js">preRun: () =&gt; {
    Module.FS.createPreloadedFile(&quot;&quot;, &quot;doom1.wad&quot;, &quot;doom1.wad&quot;);
    Module.FS.createPreloadedFile(&quot;&quot;, &quot;default.cfg&quot;, &quot;default.cfg&quot;);
}
</code></pre>
<!--kg-card-end: markdown--><p>You can see our website’s <a href="https://github.com/cloudflare/doom-workers/blob/main/assets/carmack.js">JavaScript code</a> and how we configure Module and interact with Wasm Doom and our Message Router APIs here.</p><p>One other neat trick is to show important messages coming from the game while it's running, using a bottom scrolling ticker just below the game canvas. There are other, more sophisticated ways to interface between the web page and the Wasm process, but in this case we’re simply parsing <em>stdout</em> messages using a custom purpose handcrafted text protocol.</p><p>This is what the user sees:</p><figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2021/05/image2-4.png" class="kg-image"></figure><p>This is our <em>stdout</em> based <a href="https://github.com/cloudflare/doom-wasm#stdout-procotol">protocol</a>:</p><!--kg-card-begin: markdown--><pre><code class="language-c">doom: 1, failed to connect to websockets server
doom: 2, connected to %s
doom: 3, we're out of client addresses
</code></pre>
<!--kg-card-end: markdown--><p>And this is all we have to do in Doom’s C source code:</p><!--kg-card-begin: markdown--><pre><code class="language-c">net_websockets.c: printf(&quot;doom: 2, connected to %s\n&quot;, attr.url);
</code></pre>
<!--kg-card-end: markdown--><h2 id="game-setup">Game setup</h2><p>The game setup is as easy as it can be. You go to <a href="https://silentspacemarine.com">silentspacemarine.com</a>, start a multiplayer game, get a unique game permalink, share it with your friends online, wait for them to join, and start playing. The person who starts the game becomes "the server" in the network, but we handle that for you; there's no need to worry about technical details.</p><p>If you receive one of these permalink invites, all you need to do is click on it, choose your name, wait for your host to start the game, and that's it.</p><figure class="kg-card kg-image-card"><img src="https://blog.cloudflare.com/content/images/2021/05/image6.gif" class="kg-image"></figure><p>The source and Worker Pages wrangler configuration for the <a href="https://silentspacemarine.com">silentspacemarine.com</a> website can be found in this <a href="https://github.com/cloudflare/doom-workers">repo</a>.</p><h2 id="conclusion">Conclusion</h2><p>You can play our demo at <a href="https://silentspacemarine.com/">https://silentspacemarine.com/</a>.</p><p>Our Wasm Doom with WebSockets implementation runs in the browser, supports mouse, sound and fullscreen (press F during the game), works on the desktop and mobile phones (using virtual gamepads) and supports real-time networked multiplayer (up to four players) on top of the Cloudflare edge.</p><p>There is certainly room for improvement in this project. For instance, we don't handle reconnects or disconnects very well if players drop off abruptly (ex: close their web browser window). We're also not using <a href="https://developers.cloudflare.com/workers/runtime-apis/durable-objects#transactional-storage-api">storage</a> in our Durable Object to persist a session over an unlikely but possible <a href="https://developers.cloudflare.com/workers/learning/how-workers-works">isolate</a> termination.</p><p>Doom's original protocol (1994) is not well suited for modern Internet multiplayer fast-paced games either. Every client receives a full copy of all the input (keyboard, mouse) from all the other clients. The game only advances when everyone receives the commands from all the other players in the group. The result is that the game's playability depends on the player with the slowest connection.</p><p>Modern FPS gaming protocols solve these and other challenges by predicting future movements (games are mostly deterministic), using compression, sending only the deltas, and other techniques. You can read more about this in “<a href="https://mrelusive.com/publications/papers/The-DOOM-III-Network-Architecture.pdf">The DOOM III Network Architecture</a>”.</p><p>However, as John put it, we wanted to showcase a paradigm shift and the opportunity to build real-time networked applications, now made possible because new and powerful technologies and features are available on our edge computing platform.</p><p>Having said this, the source code for <a href="https://github.com/cloudflare/doom-wasm">Wasm Doom</a>, <a href="https://github.com/cloudflare/doom-workers">Message Router</a>, and website is all open-sourced and available in our GitHub, and you can start playing with it. Comments, issues, or even PRs are welcome. We tried to package everything together so that you can run things locally or deploy your version in Cloudflare.</p><p>Edge Doom (or Durable Objects Offer Multiplayer, as we like to call it) was a fun project to put together. We hope you found this tech write-up interesting and inspiring to do other things with our edge computing components, and we can't wait to see what you come up with.</p>
            </div>
        </section>

        <a href="/tag/workers/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2">Cloudflare Workers</a>
        <a href="/404/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2">Gaming</a>
        <a href="/tag/durable-objects/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2">Durable Objects</a>
    </article>
</main>

<div class="pv4 ph3 mw7 center" id="social-buttons">
    <h2>Comments</h2>
    <div class="mt5-l mt4 flex flex-row-ns flex-column flex-wrap">
        <a id="social-button-twitter" title="Discuss on Twitter" href="https://twitter.com/Cloudflare" target="_blank" class="mr2-ns mb0-l white link b pv3 ph3 mb3 dn" style="background-color:#0055DC;">
            <span>Discuss on Twitter</span>
        </a>
        <a id="social-button-hn" title="Discuss on Hacker News" href="https://hn.algolia.com/?dateRange=all&page=0&prefix=false&query=blog.cloudflare.com&sort=byDate&type=story" target="_blank" class="mr2-ns mb0-l white link b pv3 ph3 mb3 dn" style="background-color:#0055DC;">
            <span>Discuss on Hacker News</span>
        </a>
        <a id="social-button-reddit" title="Discuss on Reddit" href="https://www.reddit.com/r/CloudFlare/" target="_blank" class="mr2-ns mb0-l white link b pv3 ph3 mb3 dn" style="background-color:#0055DC;">
            <span>Discuss on Reddit</span>
        </a>
    </div>
</div>

<div class="pv4 flex flex-row flex-wrap mw7 center">
    <div class="w-100 ph3 bt b--gray8">
        <p class="orange fw5 f4 mt4 ttu">Related Posts</p>
    </div>


</div>




        <footer class="pt4 pb4 pl1 pr1 main-footer">
  <div class="mw8 center dn db-l ph3">
    <div class="flex flex-row justify-between">
      <div class="main-footer__menu-group">
        <ul id="sales-menu" class="list pl0">
          <li class="pt1 pb1 f1" data-submenu="sales-menu"
            class="main-footer__menu-group__header js-toggle-footer-group f1">
            Sales
            <i class="icon-caret-down"></i>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/plans/enterprise/contact/" data-tracking-category="footer"
              data-tracking-action="click" data-tracking-label="enterprise_sales"
              class="f1 blue3 no-underline underline-hover">
              Enterprise Sales
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/partners/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="become_a_partner" class="f1 blue3 no-underline underline-hover">
              Become a Partner
            </a>
          </li>
        </ul>
        <p class="phone f1 blue3 no-underline underline-hover">
          <p class="tel f1 blue3 no-underline underline-hover">Contact Sales:</p>
          <p><a data-i18n-phonenumber="" class="tel f1 blue3 no-underline underline-hover" href="tel:+18889935273">+1
              (888) 99 FLARE</a></p>

          <noscript><a class="phone f1 blue3 no-underline underline-hover" href="tel:+16503198930">+1 650 319
              8930</a></noscript>
        </p>
      </div>
      <div class="main-footer__menu-group">
        <ul id="getting-started-menu" class="list pl0">
          <li class="pt1 pb1 f1" data-submenu="getting-started-menu"
            class="main-footer__menu-group__header js-toggle-footer-group">
            Getting Started
            <i class="icon-caret-down"></i>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/plans/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="plans" class="f1 blue3 no-underline underline-hover">
              Pricing
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/case-studies/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="case_studies" class="f1 blue3 no-underline underline-hover">
              Case Studies
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/resources/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="white_papers" class="f1 blue3 no-underline underline-hover">
              White Papers
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/webinars/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="webinars" class="f1 blue3 no-underline underline-hover">
              Webinars
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/learning/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="learning_center" class="f1 blue3 no-underline underline-hover">
              Learning Center
            </a>
          </li>
        </ul>
      </div>
      <div class="main-footer__menu-group">
        <ul id="community-menu" class="list pl0">
          <li class="pt1 pb1 f1" data-submenu="community-menu"
            class="main-footer__menu-group__header js-toggle-footer-group">
            Community
            <i class="icon-caret-down"></i>
          </li>
          <li class="pt1 pb1">
            <a href="https://community.cloudflare.com" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="community_hub" class="f1 blue3 no-underline underline-hover">
              Community Hub
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://blog.cloudflare.com" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="blog" class="f1 blue3 no-underline underline-hover">
              Blog
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/galileo/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="galileo" class="f1 blue3 no-underline underline-hover">
              Project Galileo
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/athenian/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="athenian" class="f1 blue3 no-underline underline-hover">
              Athenian Project
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.tv/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="tv" class="f1 blue3 no-underline underline-hover">
              Cloudflare TV
            </a>
          </li>
        </ul>
      </div>
      <div class="main-footer__menu-group">
        <ul id="developers-menu" class="list pl0">
          <li class="pt1 pb1 f1" data-submenu="developers-menu"
            class="main-footer__menu-group__header js-toggle-footer-group">
            Developers
            <i class="icon-caret-down"></i>
          </li>
          <li class="pt1 pb1">
            <a href="https://developers.cloudflare.com" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="developer_hub" class="f1 blue3 no-underline underline-hover">
              Developer Hub
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/technical-resources/" data-tracking-category="footer"
              data-tracking-action="click" data-tracking-label="technical_resources"
              class="f1 blue3 no-underline underline-hover">
              Technical Resources
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/products/cloudflare-workers/" data-tracking-category="footer"
              data-tracking-action="click" data-tracking-label="cloudflare_workers"
              class="f1 blue3 no-underline underline-hover">
              Cloudflare Workers
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/integrations/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="integrations" class="f1 blue3 no-underline underline-hover">
              Integrations
            </a>
          </li>
        </ul>
      </div>
      <div class="main-footer__menu-group">
        <ul id="support-menu" class="list pl0">
          <li class="pt1 pb1 f1" data-submenu="support-menu"
            class="main-footer__menu-group__header js-toggle-footer-group">
            Support
            <i class="icon-caret-down"></i>
          </li>
          <li class="pt1 pb1">
            <a href="https://support.cloudflare.com" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="support" class="f1 blue3 no-underline underline-hover">
              Support
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://www.cloudflarestatus.com" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="status" class="f1 blue3 no-underline underline-hover">
              Cloudflare Status
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/compliance/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="compliance" class="f1 blue3 no-underline underline-hover">
              Compliance
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/gdpr/introduction/" data-tracking-category="footer"
              data-tracking-action="click" data-tracking-label="gdpr" class="f1 blue3 no-underline underline-hover">
              GDPR
            </a>
          </li>
        </ul>
      </div>
      <div class="main-footer__menu-group">
        <ul id="company-menu" class="list pl0">
          <li class="pt1 pb1 f1" data-submenu="company-menu"
            class="main-footer__menu-group__header js-toggle-footer-group">
            Company
            <i class="icon-caret-down"></i>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/about-overview/" data-tracking-category="footer"
              data-tracking-action="click" data-tracking-label="overview" class="f1 blue3 no-underline underline-hover">
              About Cloudflare
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/people/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="our_team" class="f1 blue3 no-underline underline-hover">
              Our Team
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/press/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="press" class="f1 blue3 no-underline underline-hover">
              Press
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/analysts/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="analysts" class="f1 blue3 no-underline underline-hover">
              Analysts
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/careers/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="careers" class="f1 blue3 no-underline underline-hover">
              Careers
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/internetsummit/" data-tracking-category="footer"
              data-tracking-action="click" data-tracking-label="internet_summit"
              class="f1 blue3 no-underline underline-hover">
              Internet Summit
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/logo/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="logo" class="f1 blue3 no-underline underline-hover">
              Logo
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/network/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="network_map" class="f1 blue3 no-underline underline-hover">
              Network Map
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="mw8 center ph3">
    <div class="flex flex-row flex-wrap justify-between pt4">
      <div class="flex flex-row items-start w-100 w-50-l pb4 pb0-l">
        <a target="_blank" rel="noopener" href="https://www.facebook.com/Cloudflare/" class="w-10"><img
            src="https://cloudflare.com/img/footer/facebook.svg" class="w-60"></a>
        <a target=" _blank" rel="noopener" href="https://twitter.com/Cloudflare" class="w-10"><img
            src="https://cloudflare.com/img/footer/twitter.svg" class="w-60"></a>
        <a target="_blank" rel="noopener" href="https://www.linkedin.com/company/cloudflare-inc-" class="w-10"><img
            src="https://cloudflare.com/img/footer/linkedin.svg" class="w-60"></a>
        <a target="_blank" rel="noopener" href="https://www.youtube.com/cloudflare" class="w-10"><img
            src="https://cloudflare.com/img/footer/youtube.svg" class="w-60"></a>
        <a target="_blank" rel="noopener" href="https://www.instagram.com/cloudflare" class="w-10"><img
            src="https://cloudflare.com/img/footer/instagram.svg" class="w-60"></a>
      </div>
      <div class="w-100 w-50-l tr-l tl-ns">
        <div>
          <span class="main-footer__copyright f1">© 2020 Cloudflare, Inc.</span>
          <span class="main-footer__copyright f1">|</span>
          <a href="https://cloudflare.com/privacypolicy/"
            class="main-footer__copyright f1 no-underline underline-hover">Privacy
            Policy</a>
          <span class="main-footer__copyright f1">|</span>
          <a href="https://cloudflare.com/website-terms/"
            class="main-footer__copyright f1 no-underline underline-hover">Terms of Use</a>
          <span class="main-footer__copyright f1">|</span>
          <a href="https://cloudflare.com/abuse/"
            class="main-footer__copyright f1 no-underline underline-hover">Trust &amp; Safety</a>
          <span class="main-footer__copyright f1">|</span>
          <a href="https://cloudflare.com/trademark/"
            class="main-footer__copyright f1 no-underline underline-hover">Trademark</a>
        </div>
      </div>
    </div>
  </div>
</footer>    </div>


    <script type="text/javascript">
    (function () {
        // Social media, make request to worker
        var urlObj = new URL(window.location.href);
        var currenturl = urlObj.origin + urlObj.pathname;
        try {
            $.get("https://api.blog.cloudflare.com/social?u=" + currenturl, function( res ) {
                if (!res.data.twitter && !res.data.hn && !res.data.reddit) {
                    $("#social-buttons").hide();
                }

                if (res.data.twitter) {
                    var twitterurl = "https://twitter.com/intent/tweet?in_reply_to=" + res.data.twitter.id;
                    $("#social-button-twitter").attr("href", twitterurl);
                    $("#social-button-twitter").show()
                }

                if (!res.data.hn) {
                    $("#social-button-hn").attr("href", "https://news.ycombinator.com/submitlink?u=" + currenturl);
                    $("#social-button-hn").show();
                }

                if (res.data.hn) {
                    $("#social-button-hn").attr("href", res.data.hn.comments_link);
                    $("#social-button-hn").show();
                }

                if (res.data.reddit) {
                    $("#social-button-reddit").attr("href", res.data.reddit.comments_link);
                    $("#social-button-reddit").show();
                }
            });
        } catch (err) {
            console.error(err);
            $("#social-buttons").hide();
        }
    })();
</script>

<script type="text/javascript" src="/assets/built/prism.js?v=ee05741d71"></script>
<script>!function (d, s, id) { var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https'; if (!d.getElementById(id)) { js = d.createElement(s); js.id = id; js.src = p + '://platform.twitter.com/widgets.js'; fjs.parentNode.insertBefore(js, fjs); } }(document, 'script', 'twitter-wjs');
</script>
<script>(function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=596756540369391";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
</script>
<script src="//platform.linkedin.com/in.js" type="text/javascript">lang: en_US</script>
<script type="text/javascript">
        (function () {
            var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
            po.src = 'https://apis.google.com/js/platform.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
        })();
</script>

<script>!function (d, s, id) { var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https'; if (!d.getElementById(id)) { js = d.createElement(s); js.id = id; js.src = p + '://platform.twitter.com/widgets.js'; fjs.parentNode.insertBefore(js, fjs); } }(document, 'script', 'twitter-wjs');
</script>
<script>(function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=596756540369391";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
</script>
<script src="//platform.linkedin.com/in.js" type="text/javascript">lang: en_US</script>
<script type="text/javascript">
        (function () {
            var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
            po.src = 'https://apis.google.com/js/platform.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
        })();
</script>


    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://tr.www.cloudflare.com/ns.html?id=GTM-PKQFGQB"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<script>
    var links = document.links;

    for (var i = 0, linksLength = links.length; i < linksLength; i++) {  
       if (links[i].hostname != window.location.hostname) {
           links[i].target = '_blank';
       } 
    } 
</script>

<script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"rayId":"652877c7ec9959c8","token":"2bc156e5f250476cb274d269511ffb57","version":"2021.5.1","si":10}'></script>
</body>

</html>