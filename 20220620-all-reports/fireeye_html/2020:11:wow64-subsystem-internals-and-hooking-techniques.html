
<!DOCTYPE html>
<html>
<head>

<script>
    var companyDetails6Sense = localStorage.getItem('_6senseCompanyDetails');

    if(null != companyDetails6Sense || companyDetails6Sense != "" || companyDetails6Sense != undefined){
		var jsonVal = JSON.parse(companyDetails6Sense);

        var companyRevenueRange = jsonVal.company.revenue_range;
        var companyCountry = jsonVal.company.country;
        var companyIndustry = jsonVal.company.industry;
        var companyName = jsonVal.company.name;
        var companyRegion = jsonVal.company.region;
        var companyDomain = jsonVal.company.domain;
    	var segments = JSON.stringify(jsonVal.segments);
    	
        window.dataLayer=window.dataLayer ||[];
        window.dataLayer.push({
                "company_industry" : companyIndustry,
                "company_name" : companyName,
                "company_revenue" : companyRevenueRange,
                "company_country" : companyCountry,
                "company_region" : companyRegion,
            	"company_domain" : companyDomain,
            	"segments" : segments
        });
    }

</script>

<style>.async-hide { opacity: 0 !important} </style>
<script>(function(a,s,y,n,c,h,i,d,e){s.className+=' '+y;h.start=1*new Date;
h.end=i=function(){s.className=s.className.replace(RegExp(' ?'+y),'')};
(a[n]=a[n]||[]).hide=h;setTimeout(function(){i();h.end=null},c);h.timeout=c;
})(window,document.documentElement,'async-hide','dataLayer',4000,
{"GTM-5ZX7QTZ":true});</script>

<title>WOW64!Hooks: WOW64 Subsystem Internals and Hooking Techniques | FireEye Inc</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<link rel="alternate" type="application/atom+xml" title="Atom Feed for &#39;WOW64!Hooks: WOW64 Subsystem Internals and Hooking Techniques&#39;" href="/content/fireeye-www/en_US/blog/threat-research/2020/11/wow64-subsystem-internals-and-hooking-techniques/_jcr_content.feed">
<link rel="canonical" href="https://www.fireeye.com/blog/threat-research/2020/11/wow64-subsystem-internals-and-hooking-techniques.html">
<meta name="language" content="en">
<meta name="locale" content="en_US">
<meta http-equiv="cleartype" content="on">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">
<meta name="description" content="We dive deep into the WOW64 system and&amp;nbsp;assess two hooking techniques and their effectiveness.
">

<meta itemprop="name" content="WOW64!Hooks: WOW64 Subsystem Internals and Hooking Techniques">
<meta itemprop="description" content="We dive deep into the WOW64 system and&amp;nbsp;assess two hooking techniques and their effectiveness.
">
<meta itemprop="image" content="https://www.fireeye.com/content/dam/fireeye-www/fw/images/fireeye-2-color-square.png">

<meta name="twitter:site" content="@FireEye">
<meta name="twitter:title" content="WOW64!Hooks: WOW64 Subsystem Internals and Hooking Techniques">
<meta name="twitter:description" content="We dive deep into the WOW64 system and&amp;nbsp;assess two hooking techniques and their effectiveness.
">
<meta name="twitter:creator" content="@FireEye">
<meta name="twitter:image" content="https://www.fireeye.com/content/dam/fireeye-www/fw/images/fireeye-2-color-square.png">

<meta property="og:title" content="WOW64!Hooks: WOW64 Subsystem Internals and Hooking Techniques">
<meta property="og:type" content="website">
<meta property="og:url" content="https://www.fireeye.com/blog/threat-research/2020/11/wow64-subsystem-internals-and-hooking-techniques.html">
<meta property="og:image" content="https://www.fireeye.com/content/dam/fireeye-www/fw/images/fireeye-2-color-square.png">
<meta property="og:description" content="We dive deep into the WOW64 system and&amp;nbsp;assess two hooking techniques and their effectiveness.
">
<meta property="og:site_name" content="FireEye">
<meta property="fb:admins" content="45127269202">
<script type="text/javascript" src="/etc.clientlibs/clientlibs/granite/jquery.min.js"></script>

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MVGC8KK');</script>


<script type="text/javascript" src="/etc.clientlibs/clientlibs/granite/jquery/granite/csrf.min.js"></script>
<script type="text/javascript" src="/etc/designs/fireeye-www/clientlibs_nav.min.js"></script>
<script type="text/javascript">
var cookiesOK = $.cookie("ec-privacy");
var fdc =fdc || {};
var onAccept = function () {
	$.cookie("ec-privacy", "accept", { path: "/", expires: 365 });
	jQuery("#cookie-privacy-banner").hide();
};

var onDecline = function () {
	$.cookie("ec-privacy", "decline", { path: "/", expires: 365 });
	jQuery("#cookie-privacy-banner").hide();
};

var ipLocation = (function () {
	var banner ="#cookie-privacy-banner";

	/* Show the privacy notification banner. */
	var showBanner = function (banner) {
		jQuery(banner).show();
	};

	/* Suppress the privacy notification banner. */
	var hideBanner = function (banner) {
		jQuery(banner).hide();
	};

	/* These are the country codes for the countries subject to EC privacy laws.
	 * We will check to see if a visitor is coming from one of these countries.
	 * If they are, we display a privacy notification banner. If not, we
	 * do nothing. */
	var countries = {
		"AT": true,"BE": true,"BG": true,"HR": true,"CY": true,"CZ": true,"DK": true,
		"EE": true,"FI": true,"FR": true,"DE": true,"GR": true,"HU": true,"IE": true,
		"IT": true,"LV": true,"LT": true,"LU": true,"MT": true,"NL": true,"PL": true,
		"PT": true,"RO": true,"SK": true,"SI": true,"ES": true,"SE": true,"GB": true
	};
	var defaultSite = "US";

	var onSuccess = function (geoipResponse) {
		fdc.geoipresponse=geoipResponse;
		/* There's no guarantee that a successful response object
		 * has any particular property, so we need to code defensively. */
		if (!geoipResponse.country.iso_code) {
			hideBanner(banner);
			return;
		}
		//
		if (location.host.indexOf("stage") >= 0 && geoipResponse.country.iso_code === "SG") {
            geoipResponse.country.iso_code = "ES"
        }
		/* ISO country codes are in upper case. */
		var code = geoipResponse.country.iso_code;
			
		
		if ((countries[code]) && (cookiesOK == undefined)) {
			showBanner(banner);
		}
		else {
			hideBanner(banner);
		}
	};

	/* We don't really care what the error is. */
	var onError = function (error) {
		hideBanner(banner);
	};

	return function () {
		geoip2.country( onSuccess, onError );
	};
}());
ipLocation();
</script>
<div class="htmlpassthru_836d htmlpassthru">

<script type="text/javascript">
    if (!String.prototype.includes) {
        String.prototype.includes = function() {
            return String.prototype.indexOf.apply(this, arguments) !== -1;
        };
    }
var userAgent = navigator.userAgent,
gomezAgent = userAgent.includes("GomezAgent"),
prtgAgent = userAgent.includes("PRTG Network Monitor");

if (gomezAgent || prtgAgent) {
    cookiesOK = "decline";
}

if (cookiesOK != "decline") {
    // Google Analytics was here. Now it's in Tealium and GTM.
}
// Temporary patch for AA issue.
if(typeof _satellite == "undefined") {
    _satellite = {};
    _satellite.track = function(){};
}
</script>
<style>
@media ( max-width : 959px) {
    .g04 .megamenu .n03-sub_table .n03-sub_cell, .g04 .megamenu .separator {
        display: block;
    }
    .g04 .megamenu .n03_list-item-sub>.megamenu-cta {
        padding: 0;
    }
    .g04 .megamenu .n03-sub_cell.n03-sub_cell-utility {
        padding: 11px 0 11px 10px;
    }
}

@media ( min-width : 48em) {
    .cta-bar .n01 .n01_cell {
        width: auto;
    }
}

/* styles for the CTA bar test */
.n01.n01v1 .n01_cell {
    background-color: #222;
    border: 1px solid #444;
}

.n01.n01v1 .n01_cell .ficon, .n01.n01v1 .n01_cell .n01_label, .n01.n01v1 .n01_text
    {
    color: #fff;
}

@media ( min-width : 48em) {
    .n01.n01v1 .n01_cell {
        background-color: transparent;
        border: none;
    }
    .n01.n01v1 .n01_link {
        background-color: #222;
        border: 1px solid #444;
        border-right: 0;
    }
}
/* fix for new footer */
.g03v1 .g03-s-i:after {
    left: -3px;
}
/* fix for tables */
span.nowrap {
    white-space: nowrap;
}
/* fix for blog cta */
.blog-cta {
    border: 1px solid #dadadb;
    background-color: #ebebed;
    margin-bottom: 10px;
    line-height: 0;
}
</style>
<link rel="stylesheet" type="text/css" href="https://cloud.typography.com/6746836/6977592/css/fonts.css" />
<link rel="stylesheet" type="text/css" href="/content/dam/fireeye-www/fw/css/patch.css?v=1" />
<script type="text/javascript">
var addthis_config = addthis_config||{};
    addthis_config.data_track_clickback = false;
var addthis_share = {
   url: window.location.href
};
</script>
<style>
/* fix for IE */
.uc-he01v1 .uc-he01_container .background {
    max-height: 470px;
    position: absolute;
}
.uc-he01v2 .uc-he01_container .background {
    position: absolute;
}
@media (max-width: 48em) {
    .uc-he01v1 .uc-he01_container .background {
        max-height: 320px;
    }
}
@media (min-width: 54em) {
    .uc-he01v1 .uc-he01_container .background {
        max-height: 600px;
    }
}
</style>
<style>
/* Update the images used in the Table component. */
.c09v1 .tablesorter-default .header, .c09v1 .tablesorter-default .tablesorter-header {
background-position-x: calc(100% - 4px);
background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAUCAYAAAC58NwRAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQwIDc5LjE2MDQ1MSwgMjAxNy8wNS8wNi0wMTowODoyMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggTWFjaW50b3NoIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjc2NDE0RUUyNjc2QjExRThBNEFDQTFFRUMyNzIyRjM4IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjc2NDE0RUUzNjc2QjExRThBNEFDQTFFRUMyNzIyRjM4Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NTg5MzI0RkY2NzZCMTFFOEE0QUNBMUVFQzI3MjJGMzgiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NTg5MzI1MDA2NzZCMTFFOEE0QUNBMUVFQzI3MjJGMzgiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz567IGQAAAApklEQVR42mL8//8/A0kApAELlgJiG2xyTDjMcQFiayDmRJfApkEbiJWgiq2J0eCCxLYBYkF8GjAUAIEvLg2C2JwAdZ42Ng022DyJ7kwmJFOM8YS+INRABkZSI45sDSAnxRFQuweIj8D8cA+Iz+JR/B6kGD2UQALf8ZiOEawgU45iUQyy/SqumD4C1YgMNhNKS3vwGYBNw1WoM75jdSKpGYjkiAMIMAAPu279CuYueAAAAABJRU5ErkJggg==)
}
.c09v1 .tablesorter-default thead .headerSortUp,.c09v1 .tablesorter-default thead .tablesorter-headerSortUp,.c09v1 .tablesorter-default thead .tablesorter-headerAsc{background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAUCAYAAAC58NwRAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQwIDc5LjE2MDQ1MSwgMjAxNy8wNS8wNi0wMTowODoyMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggTWFjaW50b3NoIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjU4OTMyNEY5Njc2QjExRThBNEFDQTFFRUMyNzIyRjM4IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjU4OTMyNEZBNjc2QjExRThBNEFDQTFFRUMyNzIyRjM4Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NTg5MzI0Rjc2NzZCMTFFOEE0QUNBMUVFQzI3MjJGMzgiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NTg5MzI0Rjg2NzZCMTFFOEE0QUNBMUVFQzI3MjJGMzgiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5TuQesAAAAp0lEQVR42mL8//8/A0kApAELNgbicmxyuDTsBuJ3QCxIjIbQ/wjQQYyGu/9RgRI+DeX/McFuXBqUoO7GBkKxaZj5Hze4i67B5T9hAA5mRlIjjmwNSkAcR0DtHiA+wgTl3APis3gUvwcpBjGYkARBAt/xmM6ArgFkylEsikG2X8WmAWbLezSxzcgcJnzWYzMAm4arUGd8x+pEHPlBCohtsMmRHHEAAQYAbP+KkOIl8zUAAAAASUVORK5CYII=)}
.c09v1 .tablesorter-default thead .headerSortDown,.c09v1 .tablesorter-default thead .tablesorter-headerSortDown,.c09v1 .tablesorter-default thead .tablesorter-headerDesc{background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAUCAYAAAC58NwRAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQwIDc5LjE2MDQ1MSwgMjAxNy8wNS8wNi0wMTowODoyMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggTWFjaW50b3NoIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjU4OTMyNEZENjc2QjExRThBNEFDQTFFRUMyNzIyRjM4IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjU4OTMyNEZFNjc2QjExRThBNEFDQTFFRUMyNzIyRjM4Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NTg5MzI0RkI2NzZCMTFFOEE0QUNBMUVFQzI3MjJGMzgiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NTg5MzI0RkM2NzZCMTFFOEE0QUNBMUVFQzI3MjJGMzgiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6nOhWUAAAAqElEQVR42mL8//8/AymACYe4FBDbkKLBBYitgZiTGA3aQKwEVWxNjAYXJDbIWYL4NGAoAAJfXBoEsTkB6jxtbBpssHkS3ZlMSKYY4wl+QVgwM1Ir4ghqALnxPwFcDlYJchIUz/yPG9yFqUPWoATE73BoCMWmAYTLsSjejawGXQMD1HpkoERIQyiS4g50eWwaGKDOAPlHEF2OBUdwV0CD+j26BMkxDRBgALvSCpUQlZEGAAAAAElFTkSuQmCC)}
.c09v1 .tablesorter-default thead .sorter-false {
    background-image: none;
}
@media (max-width: 41.9125em){
    .c09.c09v1.has-data-label tr>:not(:first-child):before {
        width: auto; min-width: 35%;
    }
}
</style>
<script>
$(document).ready(function(){
    if(typeof(ipLocation) !== "undefined" && typeof fdc.geoipResponse === "undefined"){ipLocation();}
    if(typeof fdc.geoipResponse !== "undefined"){showCountryNotification(fdc.geoipResponse);}
    if(typeof fdc.geoipResponse !== "undefined" && typeof fdc.geoipResponse.country !== "undefined" && fdc.geoipResponse.country.is_in_european_union && ($.cookie("ec-privacy") == undefined)){jQuery("#cookie-privacy-banner").show();}
});
function showCountryNotification(geoipResponse) {
	if (!geoipResponse.country || !geoipResponse.country.iso_code) {
        return;
    }
	var code = geoipResponse.country.iso_code,
	    langIndex = code === "FR" ? 2 : code === "DE" ? 3 : code === "JP" ? 4 : code === "KR" ? 5 : 1;
	if (langIndex > 1) {
		$('.c08_modal.lang').addClass("is-open");
		$('.c08_modal.lang .col:nth-child(' + (langIndex - 1) + ')').show();
		$('.c08_modal.lang, .c08_modal.lang [data-behavior="dismiss-c08"]').click(function(){
		    $.cookie("country-notification", "decline", { path: "/", expires: 365 });
		    closec08();
		});
		$('.c08_modal.lang .c08').click(function(e){
		    e.stopPropagation();
		});
		if (($.cookie("country-notification") === "decline") || $(".g01_options_list li:nth-child(" + langIndex + ") a").attr("href").indexOf(".html") < 0) {
		    closec08();
		} else {
		    $(".c08_modal.lang .btn").eq(langIndex - 2).attr("href", $(".g01_options_list li:nth-child(" + langIndex + ") a").attr("href"));
		}
	}
}
</script>
<script>    
     var _6SenseJsonObj = localStorage.getItem('_6senseCompanyDetails'),
         _6SenseTime = localStorage.getItem('_6senseCompanyDetails-timestamp'),
         isJsonStale = _6SenseTime === null ? true : Date.now() - parseInt(_6SenseTime) > 86400000; // 86400000 = 1 day in ms
     
     window._6si = window._6si || [];
     window._6si.push(['enableEventTracking', true]);
     window._6si.push(['setToken', '1322340356018696d853e0ac6f7ce3a2']);
     window._6si.push(['setEndpoint', 'b.6sc.co']);
     if(_6SenseJsonObj === null || isJsonStale){
       window._6si.push(['enableCompanyDetails', true]);
       window._6si.push(['setEpsilonKey', '325d6d60e24c7cfc3a782839d85ce08c8d3bb27c']);
       localStorage.setItem('_6senseCompanyDetails-timestamp', Date.now());
     }  
    (function () {
          var gd = document.createElement('script');
      gd.type = 'text/javascript';
      gd.async = true;
      gd.src = '//j.6sc.co/6si.min.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(gd, s);
     })();
</script>
<script>
    var jsonObj;

    function targetPageParams() { 
        jsonObj = localStorage.getItem('_6senseCompanyDetails');
        if(jsonObj) {
        	var jsonVal = JSON.parse(jsonObj);
            return { 
                "companyRevenueRange": jsonVal.company.revenue_range, 
                "companyCountry": jsonVal.company.country, 
                "companyIndustry": jsonVal.company.industry,
                "companyName": jsonVal.company.name,
                "companyRegion": jsonVal.company.region,
                "companyDomain": jsonVal.company.domain,
                "segments": JSON.stringify(jsonVal.segments)
            }; 
        }
     }; 
</script>
<script>
$(document).ready(function(){
    $(".loadmore").on("click", function(){$(".list.parbase").addClass("no-max-height");});
    // Don't show title text for textures.
    $(".texture img").attr("title", "");
});
</script>
<style>
.no-max-height .c11v9 h4{
    max-height: none !important;
}
.g04 #header-search .search-field_submit:after {
    font-size: 9px;
}
.c11v8.hideLinkText .btn {
    display: inline-block;
}
/* CTA fix */
.g04 .megamenu-tab .has-inner-cta .n03-sub_container {
    padding: 0;
    margin: 0 0 0 10px;
    max-width: 1210px;
}
.g04 .megamenu-tab .has-inner-cta .col-wrap {
    padding: 40px 0;
}
.g04 .n03-sub_container[data-columns="1"] .megamenu-cta {
    width: 50%;
}
.g04 .n03-sub_container[data-columns="2"] .megamenu-cta {
    width: 33.9%;
}
.g04 .has-inner-cta > [data-columns="2"] .n03-sub_cell {
    width: calc(50% - 60px);
}
.g04 .n03-sub_container[data-columns="3"] .megamenu-cta {
    width: 25%;
}
.g04 .n03-sub_container[data-columns="4"] .megamenu-cta {
    width: 20%;
}
.g04 .megamenu-cta h5 {
    line-height: 1.4;
}
html .g04 header .megamenu-cta h5 {
    font-weight: 500;
    font-size: 15px;
    color: #44474d;
}
html .g04 header .megamenu-cta p {
    font-weight: 300;
    color: #44474d;
}
.g04 .n03-sub_table > .megamenu-cta {
    background: none;
    padding: 0;
}
.g04 .megamenu-cta .n03_utility {
    border: none;
    height: 100%;
}
.g04 .megamenu-cta .n03_utility_cell {
    display: block;
    width: auto;
    margin-left: 30px;
}
/* Un/re-comment to add/remove in the line to the left of the CTA in the megamenu. */
.g04 .n03-sub_table .col-wrap:not(:last-child) .separator.disabled {
    border-right-color: #ebebed;
}

/* Put a grid over the texture from a neighboring grid. */
.force {
    z-index: 15;
    position: relative;
}
/* Remove the gradient above the tiles on blog pages and reduce the space there. */
.iparsys + .l_container>div.gradient-top {
    background-image: none;
}
.iparsys + .l_container>.gradient-top>div>.g {
    padding: 0;
}
@media (min-width: 35em) {
    .entries .highlightFirst .c11v9 .c11-image-div {
        border-left: 1px solid #dadadb;
        border-right: 1px solid #dadadb;
    }
}
@media (max-width: 1024px) {
    .uc-he01v2 .panel .asset .image img {
        max-height: 200px;
	max-width: 300px;
    }
}
/* mobile view for MegaMenu CTA. */
@media (max-width: 1024px) {
    .g04 .megamenu-tab.open .n03_list-item-sub.has-inner-cta {
        padding-bottom: 0;
    }
    .g04 .has-inner-cta > [data-columns="2"] .n03-sub_cell,
    .g04 .n03-sub_container[data-columns="2"] .megamenu-cta {
        width: 100%;
        display: block;
    }
    .g04 .megamenu-tab .has-inner-cta .n03-sub_container {
        margin: 0;
    }
    .g04 .megamenu-tab .has-inner-cta .n03-sub_container .col-wrap {
        padding: 0;
    }
    .g04 .megamenu-cta .n03_utility_cell {
        margin-left: 15px;
        margin-right: 22px;
    }
    .g04 .megamenu-cta .n03_utility_cell:nth-child(1) {
        padding-bottom: 0;
    }
    .g04 .megamenu-cta .n03_utility_cell:nth-child(2) {
        padding-top: 0;
    }
    .g04 .megamenu-cta .n03_utility_cell h5,
    .g04 .megamenu-cta .n03_utility_cell p {
        font-size: 12px;
    }
    .content-2-par .megamenus .n03-sub_table .megamenu-cta {
        border-radius: 0;
    }
}
/* Training pages side design. */
  .training-side-box {background: url('/content/dam/fireeye-www/brand/homepage-banner-images/hpb-bg-testimonial-red.jpg') left no-repeat; background-size: cover; padding:30px; border: 1px solid #dadadb; margin-bottom: 20px;}
  .training-side-text {color: #ffffff;}
  .training-side-text a:hover {color: #ffffff; text-decoration: underline;}

/* Avoid column breaks in ordered lists. */
  .c00 ol > li {page-break-inside: avoid; margin-bottom: 15px;}

/* Safari needs this on html to stop side scrolling, not just on the body. */
html {overflow-x:hidden;}
/* Make sure the footer is above a texture that precedes it. */
#g03-footer {z-index: 725;}
/* Allow border for linked images. */
.border>a>img {border: 1px solid #dadadb;}
/* Allows for easy scrollable text boxes on blog pages right in the Blog Text component. */
table.limitedHeight td {
    height: 350px;
    display: block;
    overflow-y: scroll;
    overflow-x: hidden;
    padding-bottom: 0;
}
/* Fix for edge case in Safari where page title in breadcrumbs wraps when the title is just the right length. */
.g02_list_item:last-child span {
    min-width: 360px;
    display: block;
}
</style></div>

<link rel="stylesheet" href="/etc/designs/fireeye-www/clientlibs_fw-2019.min.css" type="text/css">
<link rel="stylesheet" href="/etc/clientlibs/fireeye-blog/clientlibs_base.min.css" type="text/css">
<link rel="icon" type="image/vnd.microsoft.icon" href="/content/dam/fireeye-www/brand/logos/fireeye.ico">
<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="/content/dam/fireeye-www/brand/logos/fireeye.ico">
</head>

<body itemscope itemtype="http://schema.org/WebPage" data-redesign="redesign-2019"><script type="text/javascript">window.Granite = window.Granite || {}; window.Granite.csrf = true;</script>


<div class="clientcontext parbase"><script type="text/javascript" src="/etc.clientlibs/clientlibs/granite/utils.min.js"></script>
<script type="text/javascript" src="/etc.clientlibs/clientlibs/granite/jquery/granite.min.js"></script>
<script type="text/javascript" src="/etc.clientlibs/foundation/clientlibs/jquery.min.js"></script>
<script type="text/javascript" src="/etc.clientlibs/foundation/clientlibs/shared.min.js"></script>
<script type="text/javascript" src="/etc.clientlibs/clientlibs/granite/lodash/modern.min.js"></script>
<script type="text/javascript" src="/etc.clientlibs/cq/personalization/clientlib/personalization/kernel.min.js"></script>
<script type="text/javascript">
    $CQ(function() {
        CQ_Analytics.SegmentMgr.loadSegments("\/etc\/segmentation");
        CQ_Analytics.ClientContextUtils.init("\/etc\/clientcontext\/default", "\/content\/fireeye\u002Dwww\/en_US\/blog\/threat\u002Dresearch\/2020\/11\/wow64\u002Dsubsystem\u002Dinternals\u002Dand\u002Dhooking\u002Dtechniques");

        
    });
</script>
</div>


<div class="masthead_v2 masthead-v2">
<div class="g04 masthead g04v1">


<div class="bottom-bar">
<div class="tab">
<span class="ficon ficon-warning"></span>
<p><a class="contact_bar" href="/company/incident-response.html">Report an Incident</a></p>
</div>
<div class="tab">
<span class="ficon ficon-phone2"></span>
<p><a class="contact_bar" href="/company/contact-us.html">Contact Us</a></p>
</div>
</div>
<div class="cta-bar">
<div class="content-well">
<ul>
<li>
<a class="contact_bar" href="/company/contact-us.html">
<span class="g04_label">Contact Us</span><span class="g04_icon"><span class="ficon ficon-phone3"></span></span>
</a>
</li>
<li style="display: none;" id="liveagent_button_online_573a00000008kP3">
<a class="contact_bar" href="javascript://Chat" onclick="liveagent.startChat('573a00000008kP3')">
<span class="g04_label">Chat with an Expert</span><span class="g04_icon"><span class="ficon ficon-chat"></span></span>
</a>
</li>
<li class="red">
<a class="contact_bar" href="/company/incident-response.html">
<span class="g04_label">Report an Incident</span><span class="g04_icon"><span class="ficon ficon-incident"></span></span>
</a>
</li>
</ul>
</div>
</div>

<script type="text/javascript">
    if (!window._laq) { window._laq = []; }
    window._laq.push(function(){
    	liveagent.showWhenOnline('573a00000008kP3', document.getElementById('liveagent_button_online_573a00000008kP3'));
    });
</script>
<script type="text/javascript" src="https://c.la2c2.salesforceliveagent.com/content/g/js/34.0/deployment.js"></script>
<script type="text/javascript">
    liveagent.init("https://d.la2c2.salesforceliveagent.com/chat", "572a0000000H8aJ", "00D3000000063LS");
</script><header role="banner" itemscope itemtype="http://schema.org/WPHeader">
<div class="language-and-search"> <div class="search">
<div class="content-searchbox searchbox">
<a class="g01_options-option option-search" href="#header-search" data-for="q" data-behavior="showHeaderMenu focusField">Search</a>
<div class="option-menu option-menu_search" id="header-search">
<form method="get" action="/search.html">
<fieldset class="search-field" title="Search FireEye.com">
<label class="search-field_label" for="q">Search FireEye.com</label>
<input class="input-text search-field_text" type="text" name="q" id="q" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" data-locale="en_US" placeholder="Search FireEye.com">
<div id="searchboxsuggestions"></div>
<button class="btn btn-secondary search-field_submit" type="submit">Go</button>
</fieldset>
</form>
</div>
</div>
</div>
</div>
<div class="logo-and-megamenu">
<div class="logo" itemscope itemtype="https://schema.org/Brand">
<a href="https://www.fireeye.com"><img src="/content/dam/fireeye-www/fw/images/fe-logo-color.svg" alt="FireEye" itemprop="logo" class="fireeye" /></a>
</div>
<nav class="megamenu">
<ul><li class="megamenu-tab" data-curry="/blog.html" data-link="/products.html">
<h4 class="megamenu-title">
<a href="/products.html" itemprop="url" class="MegaMenus">Products</a>
</h4>
<div class="content-0-par parsys"><div class="megamenus section">

<div class="n03_list-item-sub has-inner-cta ">
<div class="n03-sub_container" data-columns="2">
<div class="n03-sub_table">
<div class="col-wrap">
<div class="n03-sub_cell">
<div class="parsys"><div class="megamenu-list section">
<h4 class="n03-sub_title">Enterprise Security</h4><ul><li itemprop="url"><a href="/products/helix.html" itemprop="name" class="MegaMenus">Helix Security Platform</a></li>
<li itemprop="url"><a href="/products/network-security.html" itemprop="name" class="MegaMenus">Network Security and Forensics</a></li>
<li itemprop="url"><a href="/products/endpoint-security.html" itemprop="name" class="MegaMenus">Endpoint Security</a></li>
<li itemprop="url"><a href="/products/email-security.html" itemprop="name" class="MegaMenus">Email Security</a></li>
<li itemprop="url"><a href="/products/cloudvisory.html" itemprop="name" class="MegaMenus">Cloudvisory</a></li>
<li itemprop="url"><a href="/products/detection-on-demand.html" itemprop="name" class="MegaMenus">Detection On Demand</a></li>
</ul></div>
</div>
</div><div class="separator"></div>
<div class="n03-sub_cell">
<div class="parsys"><div class="megamenu-list section">
<h4 class="n03-sub_title">Security For:</h4><ul><li itemprop="url"><a href="/products/cloud-security.html" itemprop="name" class="MegaMenus">Cloud</a></li>
<li itemprop="url"><a href="/products/financial-services.html" itemprop="name" class="MegaMenus">Financial Services</a></li>
<li itemprop="url"><a href="/products/government.html" itemprop="name" class="MegaMenus">Government</a></li>
<li itemprop="url"><a href="/products/healthcare.html" itemprop="name" class="MegaMenus">Healthcare</a></li>
<li itemprop="url"><a href="/products/industrial-systems-and-critical-infrastructure-security.html" itemprop="name" class="MegaMenus">Industrial Control Systems</a></li>
</ul></div>
<div class="htmlpassthru section">
<style>
  @media (max-width: 1024px) {
    .megamenu-tab .parsys .megamenus .megamenu-cta {
      display: none;
    }
  }
  .content-0-par .megamenus .megamenu-cta {
    background: url(/content/dam/fireeye-www/global/en/nav/bg-nav-customers.jpg) center no-repeat;
    background-size: cover;
    border-radius: 60px 0 0 60px;
    border: 0 solid #ffffff;
  }
  .content-0-par .n03_utility {background-color: transparent;}
  .n03_utility_cell {padding: 0 13px 0 0;}
</style></div>
</div>
</div><div class="separator disabled"></div></div><div class="megamenu-cta">

<div class="n03_utility">
<div class="n03_utility_container">
<div class="n03_utility_table">
<div class="n03_utility_cell">
<h5>Customer Stories</h5>
<p>Explore some of the companies who are succeeding with&nbsp;FireEye.</p>
</div>
<div class="n03_utility_cell"><div class="button"><div class="text-center"><a class="btn btn-2E5799 compact" href="/customers.html" id="learn-more-intel">Read the Stories</a></div></div>
</div>
</div>
</div>
</div></div>
</div>
</div>
<div class="view-all-bar">
<a href="/products.html" class="MegaMenus">
VIEW ALL PRODUCTS</a>
</div></div>
</div>
</div>
</li><li class="megamenu-tab" data-curry="/blog.html" data-link="/mandiant.html">
<h4 class="megamenu-title">
<a href="/mandiant.html" itemprop="url" class="MegaMenus">Mandiant Solutions</a>
</h4>
<div class="content-1-par parsys"><div class="megamenus section">

<div class="n03_list-item-sub has-inner-cta ">
<div class="n03-sub_container" data-columns="2">
<div class="n03-sub_table">
<div class="col-wrap">
<div class="n03-sub_cell">
<div class="parsys"><div class="megamenu-list section">
<ul><li itemprop="url"><a href="/mandiant/threat-intelligence.html" itemprop="name" class="MegaMenus">Threat Intelligence</a></li>
<li itemprop="url"><a href="/mandiant/security-validation.html" itemprop="name" class="MegaMenus">Security Validation</a></li>
<li itemprop="url"><a href="/mandiant/managed-detection-and-response.html" itemprop="name" class="MegaMenus">Managed Defense</a></li>
</ul></div>
</div>
</div><div class="separator"></div>
<div class="n03-sub_cell">
<div class="parsys"><div class="megamenu-list section">
<ul><li itemprop="url"><a href="/mandiant/incident-response.html" itemprop="name" class="MegaMenus">Incident Response</a></li>
<li itemprop="url"><a href="/mandiant/cyber-security-consulting.html" itemprop="name" class="MegaMenus">Cyber Security Consulting</a></li>
<li itemprop="url"><a href="/mandiant/expertise-on-demand.html" itemprop="name" class="MegaMenus">Expertise On Demand</a></li>
<li itemprop="url"><a href="/services/training.html" itemprop="name" class="MegaMenus">Cyber Security Training</a></li>
</ul></div>
<div class="htmlpassthru section">
<style>
  .content-1-par .megamenus .megamenu-cta {
    background: url(/content/dam/fireeye-www/global/en/nav/bg-nav-mandiant.jpg) center no-repeat;
    background-size: cover;
    background-position: bottom;
    border-radius: 60px 0 0 60px;
    border: 0 solid #ffffff;}
  .content-1-par .n03_utility {background-color: transparent;}
  .n03_utility_cell {padding: 0 13px 0 0;}

</style></div>
</div>
</div><div class="separator disabled"></div></div><div class="megamenu-cta">

<div class="n03_utility">
<div class="n03_utility_container">
<div class="n03_utility_table">
<div class="n03_utility_cell">
<h5>Mandiant Advantage</h5>
<p>The new standard in threat intelligence.</p>
</div>
<div class="n03_utility_cell"><div class="button"><div class="text-center"><a class="btn btn-B2282D expand" href="/mandiant/advantage.html">Learn More</a></div></div>
</div>
</div>
</div>
</div></div>
</div>
</div>
<div class="view-all-bar">
<a href="/mandiant.html" class="MegaMenus">
VIEW ALL Mandiant Solutions</a>
</div></div>
</div>
</div>
</li><li class="megamenu-tab" data-curry="/blog.html" data-link="/customers.html">
<h4 class="megamenu-title">
<a href="/company/customers.html" itemprop="url" class="MegaMenus">Customers</a>
</h4>
<div class="content-2-par parsys"><div class="megamenus section">

<div class="n03_list-item-sub has-inner-cta ">
<div class="n03-sub_container" data-columns="2">
<div class="n03-sub_table">
<div class="col-wrap">
<div class="n03-sub_cell">
 <div class="parsys"><div class="megamenu-list section">
<h4 class="n03-sub_title">Customers</h4><ul><li itemprop="url"><a href="/customers.html" itemprop="name" class="MegaMenus">Customer Stories</a></li>
<li itemprop="url"><a href="/company/customers.html" itemprop="name" class="MegaMenus">Customer Success</a></li>
<li itemprop="url"><a href="https://fireeyecommunity.force.com/CustomerCommunity/s/" target="_blank" itemprop="name" class="MegaMenus">Customer Portal</a></li>
</ul></div>
<div class="megamenu-list section">
<h4 class="n03-sub_title">Get Support</h4><ul><li itemprop="url"><a href="/support/contacts.html" itemprop="name" class="MegaMenus">Contact Support</a></li>
</ul></div>
</div>
</div><div class="separator"></div>
<div class="n03-sub_cell">
<div class="parsys"><div class="megamenu-list section">
<h4 class="n03-sub_title">Find Answers</h4><ul><li itemprop="url"><a href="/support/programs.html" itemprop="name" class="MegaMenus">Support Programs</a></li>
<li itemprop="url"><a href="/support/notices.html" itemprop="name" class="MegaMenus">Support Notices</a></li>
<li itemprop="url"><a href="/support/products.html" itemprop="name" class="MegaMenus">Supported Products</a></li>
<li itemprop="url"><a href="https://community.fireeye.com/s/support-community" target="_blank" itemprop="name" class="MegaMenus">Communities</a></li>
<li itemprop="url"><a href="https://docs.fireeye.com" target="_blank" itemprop="name" class="MegaMenus">Documentation Portal</a></li>
</ul></div>
<div class="htmlpassthru section">
<style>
  .content-2-par .megamenus .megamenu-cta {
    background: url(/content/dam/fireeye-www/global/en/nav/bg-nav-support.jpg) center no-repeat;
    background-size: cover;
    border-radius: 60px 0 12px 60px;
    border: 0 solid #ffffff;}
  .content-2-par .n03_utility {background-color: transparent;}
  .n03_utility_cell {padding: 0 13px 0 0;}

</style></div>
</div>
</div><div class="separator disabled"></div></div><div class="megamenu-cta">

<div class="n03_utility">
<div class="n03_utility_container">
<div class="n03_utility_table">
<div class="n03_utility_cell">
<h5>Support</h5>
<p>A global network of support experts available 24x7. We offer simple and flexible support programs to maximize the value of your FireEye products and services.</p>
</div>
<div class="n03_utility_cell"><div class="button"><div class="text-center"><a class="btn btn-2E5799 compact" href="/support.html">Get Support</a></div></div>
</div>
</div>
</div>
</div></div>
</div>
</div>
</div>
</div>
</div>
</li><li class="megamenu-tab" data-curry="/blog.html" data-link="/partners.html">
<h4 class="megamenu-title">
<a href="/partners.html" itemprop="url" class="MegaMenus">Partners</a>
</h4>
<div class="content-3-par parsys"><div class="megamenus section">

<div class="n03_list-item-sub has-inner-cta ">
<div class="n03-sub_container" data-columns="2">
<div class="n03-sub_table">
<div class="col-wrap">
<div class="n03-sub_cell">
<div class="parsys"><div class="megamenu-list section">
<h4 class="n03-sub_title">FireEye Partners</h4><ul><li itemprop="url"><a href="/partners.html" itemprop="name" class="MegaMenus">Partners Overview</a></li>
<li itemprop="url"><a href="/partners/resellers.html" itemprop="name" class="MegaMenus">FireEye Affinity Resellers</a></li>
<li itemprop="url"><a href="/partners/strategic-technology-partners.html" itemprop="name" class="MegaMenus">Technology Partners</a></li>
<li itemprop="url"><a href="/partners/strategic-technology-partners/cyber-risk-insurance.html" itemprop="name" class="MegaMenus">Cyber Risk Partners</a></li>
<li itemprop="url"><a href="/partners/global-solution-providers.html" itemprop="name" class="MegaMenus">Global Solution Providers</a></li>
</ul></div>
</div>
</div><div class="separator"></div>
<div class="n03-sub_cell">
<div class="parsys"><div class="megamenu-list section">
<h4 class="n03-sub_title">Partner Resources</h4><ul><li itemprop="url"><a href="https://partners.fireeye.com/directory/" target="_blank" itemprop="name" class="MegaMenus">Partner Locator</a></li>
<li itemprop="url"><a href="http://training.fireeye.com/" target="_blank" itemprop="name" class="MegaMenus">Partner Education Center</a></li>
<li itemprop="url"><a href="/support.html" itemprop="name" class="MegaMenus">Support</a></li>
</ul></div>
<div class="megamenu-list section">
<h4 class="n03-sub_title">Partnering with FireEye</h4><ul><li itemprop="url"><a href="https://www2.fireeye.com/Partner-Request-LP-New.html" target="_blank" itemprop="name" class="MegaMenus">Become a Partner</a></li>
</ul></div>
<div class="htmlpassthru section">
<style>
  .content-3-par .megamenus .megamenu-cta {
    background: url(/content/dam/fireeye-www/global/en/nav/bg-nav-partners.jpg) center no-repeat;
    background-size: cover;
    border-radius: 60px 0 12px 60px;
    border: 0 solid #ffffff;}
  .content-3-par .n03_utility {background-color: transparent;}
  .n03_utility_cell {padding: 0 13px 0 0;}

</style></div>
</div>
</div><div class="separator disabled"></div></div><div class="megamenu-cta">

<div class="n03_utility">
<div class="n03_utility_container">
<div class="n03_utility_table">
<div class="n03_utility_cell">
<h5>Partner Portal</h5>
<p>Access for our registered Partners to help you be successful with FireEye.
Collateral, deal registration, request for funds, training, enablement, and more.</p>
</div>
<div class="n03_utility_cell"><div class="button"><div class="text-center"><a class="btn btn-F99B1C compact mm-cta" href="https://partners.fireeye.com/" target="_blank">Partner Portal</a></div></div>
</div>
</div>
</div>
</div></div>
</div>
</div>
</div>
</div>
</div>
</li><li class="megamenu-tab" data-curry="/blog.html" data-link="/current-threats.html">
<h4 class="megamenu-title">
<a href="/current-threats.html" itemprop="url" class="MegaMenus">Resources</a>
</h4>
<div class="content-4-par parsys"><div class="megamenus section">

<div class="n03_list-item-sub " id="mandiant-mega-menu">
<div class="n03-sub_container" data-columns="3">
<div class="n03-sub_table">
<div class="col-wrap">
<div class="n03-sub_cell">
<div class="parsys"><div class="megamenu-list section">
<h4 class="n03-sub_title">Intelligence Briefings and Bulletins</h4><ul><li itemprop="url"><a href="/current-threats/annual-threat-report.html" itemprop="name" class="MegaMenus">Annual Threat Reports</a></li>
<li itemprop="url"><a href="/current-threats/threat-intelligence-reports.html" itemprop="name" class="MegaMenus">Threat Intelligence Reports</a></li>
<li itemprop="url"><a href="/current-threats/reports-by-industry.html" itemprop="name" class="MegaMenus">Threat Intelligence Reports by Industry</a></li>
<li itemprop="url"><a href="/current-threats/apt-groups.html" itemprop="name" class="MegaMenus">APT Groups</a></li>
</ul></div>
<div class="megamenu-list section">
<h4 class="n03-sub_title">FireEye Blogs</h4><ul><li itemprop="url"><a href="/blog.html" itemprop="name" class="MegaMenus">Read the FireEye Blogs</a></li>
</ul></div>
</div>
</div><div class="separator"></div>
<div class="n03-sub_cell">
<div class="parsys"><div class="megamenu-list section">
<h4 class="n03-sub_title">Cyber Security</h4><ul><li itemprop="url"><a href="/current-threats/what-is-cyber-security.html" itemprop="name" class="MegaMenus">What is Cyber Security?</a></li>
<li itemprop="url"><a href="/campaigns/clarity-in-the-cloud.html" itemprop="name" class="MegaMenus">Clarity in the Cloud</a></li>
<li itemprop="url"><a href="/campaigns/security-effectiveness.html" itemprop="name" class="MegaMenus">Security Effectiveness and Validation</a></li>
<li itemprop="url"><a href="https://vision.fireeye.com" target="_blank" itemprop="name" class="MegaMenus">The Vision – Digital Magazine</a></li>
<li itemprop="url"><a href="/company/webinars.html" itemprop="name" class="MegaMenus">Webinars</a></li>
</ul></div>
</div>
</div><div class="separator"></div>
<div class="n03-sub_cell">
<div class="parsys"><div class="megamenu-list section">
<h4 class="n03-sub_title">Free Tools & Apps</h4><ul><li itemprop="url"><a href="/services/freeware.html" itemprop="name" class="MegaMenus">Free Software Downloads</a></li>
<li itemprop="url"><a href="https://fireeye.market" target="_blank" itemprop="name" class="MegaMenus">FireEye Market</a></li>
</ul></div>
<div class="megamenu-list section">
<h4 class="n03-sub_title">Training</h4><ul><li itemprop="url"><a href="/services/training.html" itemprop="name" class="MegaMenus">Education and Training</a></li>
</ul></div>
</div>
</div><div class="separator disabled"></div></div></div>
</div>
<div class="view-all-bar">
<a href="/current-threats.html" class="MegaMenus">
VIEW ALL RESOURCES</a>
</div></div>
</div>
</div>
</li><li class="megamenu-tab" data-curry="/blog.html" data-link="/company.html">
<h4 class="megamenu-title">
<a href="/company.html" itemprop="url" class="MegaMenus">Company</a>
</h4>
<div class="content-5-par parsys"><div class="megamenus section">

<div class="n03_list-item-sub has-inner-cta ">
<div class="n03-sub_container" data-columns="2">
<div class="n03-sub_table">
<div class="col-wrap">
<div class="n03-sub_cell">
<div class="parsys"><div class="megamenu-list section">
<h4 class="n03-sub_title">About Us</h4><ul><li itemprop="url"><a href="/company.html" itemprop="name" class="MegaMenus">Why FireEye?</a></li>
<li itemprop="url"><a href="/company/awards.html" itemprop="name" class="MegaMenus">Awards and Honors</a></li>
<li itemprop="url"><a href="/company/leadership.html" itemprop="name" class="MegaMenus">Leadership</a></li>
<li itemprop="url"><a href="/company/board-of-directors.html" itemprop="name" class="MegaMenus">Board of Directors</a></li>
<li itemprop="url"><a href="http://investors.fireeye.com" target="_blank" itemprop="name" class="MegaMenus">Investor Relations</a></li>
</ul></div>
<div class="megamenu-list section">
<h4 class="n03-sub_title">Contact</h4><ul><li itemprop="url"><a href="/company/contact-us.html" itemprop="name" class="MegaMenus">Contact FireEye</a></li>
</ul></div>
<div class="htmlpassthru section">
<style>.g04 .megamenu-list a{padding-right:38px;line-height:1.358;padding-bottom:2px}@media (min-width:60em){.g04 .n03-sub_container{padding-bottom:23px}}@media(min-width:64em) and (max-width:64.5em){.g04 .megamenu-tab:first-child .megamenu-title{padding-left:14px}}@media (min-width:68em) and (max-width:69em){.g04 .megamenu-tab:first-child .megamenu-title{padding-left:30px}}</style></div>
</div>
</div><div class="separator"></div>
<div class="n03-sub_cell">
<div class="parsys"><div class="megamenu-list section">
<h4 class="n03-sub_title">News and Events</h4><ul><li itemprop="url"><a href="/company/newsroom.html" itemprop="name" class="MegaMenus">Newsroom</a></li>
<li itemprop="url"><a href="/company/press-releases.html" itemprop="name" class="MegaMenus">Press Releases</a></li>
<li itemprop="url"><a href="/company/events.html" itemprop="name" class="MegaMenus">Events</a></li>
</ul></div>
<div class="megamenu-list section">
<h4 class="n03-sub_title">Careers</h4><ul><li itemprop="url"><a href="/company/jobs.html" itemprop="name" class="MegaMenus">Job Opportunities</a></li>
<li itemprop="url"><a href="/company/jobs/internships.html" itemprop="name" class="MegaMenus">Internships</a></li>
</ul></div>
<div class="htmlpassthru section">
<style>
  .content-5-par .megamenus .megamenu-cta {
    background: url(/content/dam/fireeye-www/global/en/nav/bg-nav-vision.jpg) center no-repeat;
    background-size: cover;
    border-radius: 60px 0 12px 60px;
    border: 0 solid #ffffff;}
  .content-5-par .n03_utility {background-color: transparent;}
  .n03_utility_cell {padding: 0 13px 0 0;}

</style></div>
</div>
</div><div class="separator disabled"></div></div><div class="megamenu-cta">

<div class="n03_utility">
<div class="n03_utility_container">
<div class="n03_utility_table">
<div class="n03_utility_cell">
<h5>The Vision</h5>
<p>Read our digital magazine providing expert-authored stories, information, unique insights, and advice on cyber security.</p>
</div>
<div class="n03_utility_cell"><div class="button"><div class="text-center"><a class="btn btn-B2282D compact" href="https://vision.fireeye.com/" target="_blank">Get Your Copy</a></div></div>
</div>
</div>
</div>
</div></div>
</div>
</div>
</div>
</div>
</div>
</li></ul>
</nav>
</div>
<span class="burger ficon ficon-menu"></span>
</header>
</div>
</div>


<div id="cookie-privacy-banner" style="display:none;">
<div class="l_container">
<div class="g">
<div class="g-u-1">
<div class="g-content">
<div class="cookie-banner">
<p class="cookie-text">
To give you the best possible experience, this site uses cookies.&nbsp; Find out more on <a href='/company/privacy.html' target='_blank'>how we use cookies</a>.<button type="button" class="cookie-button highlighted" onclick='javascript:onAccept();'>Accept</button>
</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="breadcrumbs breadcrumb">
<div class="l_container is-full">
<div class="g02 g02v0" id="g02-breadcrumbs">
<div class="g02_container">
<div class="g02_content">
<ul class="list-inline g02_list" itemscope itemtype="http://schema.org/BreadcrumbList">
<li class="g02_list_item" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"><a itemprop="item" class="BreadCrumb" href="/"><span itemprop="name">Home</span></a><meta itemprop="position" content="1" /></li>
<li class="g02_list_item" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"><a itemprop="item" class="BreadCrumb" href="/blog.html"><span itemprop="name">FireEye Blogs</span></a><meta itemprop="position" content="2" /></li>
<li class="g02_list_item" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"><a itemprop="item" class="BreadCrumb" href="/blog/threat-research.html"><span itemprop="name">Threat Research</span></a><meta itemprop="position" content="3" /></li>
<li class="g02_list_item" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"><span itemprop="name">WOW64!Hooks: WOW64 Subsystem Internals and Hooking...<meta itemprop="position" content="6" /></span>
</ul>
</div>
</div>
</div>
</div>
</div>
<main class="l_main" role="main">
<div class="l_container">
<div class="g g-alt ">
<div class="g-u-17-24 l_g-u-1">
<div class="g-content">
<div class="blog main"><div itemscope itemtype="http://schema.org/BlogPosting">
<div class="summary entrytextteaser">
</div>
<div class="title entrytitle">
<h2 class="category-name">Threat Research</h2>
<h1 class="blogpostlanding red" itemprop="headline">WOW64!Hooks: WOW64 Subsystem Internals and Hooking Techniques</h1>
<div class="c00 c00v0 entry-meta-block selfClear">
<time class="entry-date" itemprop="datePublished" content="2020-11-09T19:00:00Z">November 09, 2020</time>
<span class="sep"> | </span>
<span class="by-author" itemscope itemptype="http://schema.org/Person">by <a href="/blog/threat-research.html/category/etc/tags/fireeye-blog-authors/stephen-eckels" title="View all entries filed under 'Fireeye - Authors : Stephen Eckels'">Stephen Eckels</a><meta itemprop="author" content="Stephen Eckels" /></span>
<div class="tags-section">
<a class="tagList" href="/blog/threat-research.html/category/etc/tags/fireeye-blog-tags/detection"> <span class="tagbutton">Detection</span></a><br class="on-mobile" />
<a class="tagList" href="/blog/threat-research.html/category/etc/tags/fireeye-blog-tags/FLARE"> <span class="tagbutton">FLARE</span></a><br class="on-mobile" />
<a class="tagList" href="/blog/threat-research.html/category/etc/tags/fireeye-blog-tags/evasion"> <span class="tagbutton">Evasion</span></a><br class="on-mobile" />
<a class="tagList" href="/blog/threat-research.html/category/etc/tags/fireeye-blog-tags/windows"> <span class="tagbutton">Windows</span></a><br class="on-mobile" />
</div>
</div>
</div>
<div class="par parsys"><div class="entrytext section"><div class="c00 c00v0" itemprop="articleBody">
<p>Microsoft is known for their backwards compatibility. When they rolled out the 64-bit variant of Windows years ago they needed to provide compatibility with existing 32-bit applications. In order to provide seamless execution regardless of application bitness, the WoW (Windows on Windows) system was coined. This layer, which will be referred to as ‘WOW64’ from here on out, is responsible for translating all Windows API calls from 32-bit userspace to the 64-bit operating system kernel. This blog post is broken up into two sections. First we start by diving deep into the WOW64 system. To do this, we trace a call from 32-bit userspace and follow the steps it takes to finally transition to the kernel. The second part of the post assesses two hooking techniques and their effectiveness. I will cover how this system works, the ways malware abuses it, and detail a mechanism by which all WoW syscalls can be hooked from userspace. Note that all information here is true as of Windows 10, version 2004 and in some cases <i>has</i> changed from how previous Windows versions were implemented.</p>
<h4>Recognition</h4>
<p>First and foremost, this is a topic which has existing research by multiple authors. This work was critical in efficient exploration of the internals and research would have taken much longer had these authors not publicly posted their awesome work. I would like to callout the following references:</p>
<ul>
<li>(<a adhocenable="false" href="https://wbenny.github.io/2018/11/04/wow64-internals.html">wbenny</a>): An extremely detailed view of WOW64 internals on ARM</li>
<li>(<a adhocenable="false" href="http://blog.rewolf.pl/blog/?p=102">ReWolf</a>): A PoC heaven’s gate implementation</li>
<li>(<a adhocenable="false" href="https://github.com/JustasMasiulis/wow64pp">JustasMasiulis</a>): A very clean C++ heaven’s gate implementation</li>
<li>(<a adhocenable="false" href="https://www.malwaretech.com/2014/02/the-0x33-segment-selector-heavens-gate.html">MalwareTech</a>): A WOW64 segmentation explanation</li>
</ul>
<h4>WOW64 Internals</h4>
<p>To understand how the WOW64 system works internally we will explore the call sequence starting in 32-bit usermode before transitioning into the kernel from within a system DLL. Within these system DLLs the operating system will check arguments and eventually transition to a stub known as a syscall stub. This syscall stub is responsible for servicing the API call in the kernel. On a 64-bit system, the syscall stub is straightforward as it directly executes the syscall instruction as shown in Figure 1.</p>
<p><img src="/content/dam/fireeye-www/blog/images/wowhooks/figure2.png" alt=""><br>
<span class="type-XS">Figure 1: Native x64 Syscall Stub</span></p>
<p>Figure 2 shows a syscall stub for a 32-bit process running on WOW64</p>
<p><img src="/content/dam/fireeye-www/blog/images/wowhooks/figure1.png" alt=""><br>
<span class="type-XS">Figure 2: WOW64 Syscall Stub</span></p>
<p>Notice that instead of a syscall instruction in the WOW64 version, <span class="code">Wow64SystemServiceCall</span> is called. In the WOW64 system what would normally be an entry into the kernel is instead replaced by a call to a usermode routine. Following this <span class="code">Wow64SystemServiceCall</span>, we can see in Figure 3 that it immediately performs an indirect jmp through a pointer named <span class="code">Wow64Transition</span>.</p>
<p><img src="/content/dam/fireeye-www/blog/images/wowhooks/figure3.png" alt=""><br>
<span class="type-XS">Figure 3: Wow64SystemService transitions through a pointer ‘Wow64Transition’</span></p>
<p>Note that the <span class="code">Wow64SystemServiceCall</span> function is found within ntdll labeled as ntdll_77550000; a WOW64 process has two ntdll modules loaded, a 32-bit one and a 64-bit one. WinDbg differentiates between these two by placing the address of the module after the 32-bit variant. The 64-bit ntdll can be found in %WINDIR%\System32 and the 32-bit in %WINDIR%\SysWOW64. In the PDBs, the 64bit and 32bit ntdlls are referred to as ntdll.pdb and wntdll.pdb respectively, try loading them in a disassembler! Continuing with the call trace, if we look at what the <span class="code">Wow64Transition</span> pointer holds we can see its destination is <span class="code">wow64cpu!KiFastSystemCall</span>. As an aside, note that the address of <span class="code">wow64cpu!KiFastSystemCall</span> is held in the 32-bit TEB (Thread Environment Block) via member WOW32Reserved, this isn’t relevant for this trace but is useful to know. In Figure 4 we see the body of <span class="code">KiFastSystemCall</span>.</p>
<p><img src="/content/dam/fireeye-www/blog/images/wowhooks/figure4.png" alt=""><br>
<span class="type-XS">Figure 4: KiFastSystemCall transitions to x64 mode via segment selector 0x33</span></p>
<p>The <span class="code">KiFastSystemCall</span> performs a jmp using the 0x33 segment selector to a memory location just after the instruction. This 0x33 segment transitions the CPU into 64-bit mode via a GDT entry as described by (MalwareTech).</p>
<p>Let's recap the trace we've performed to this point. We started from a call in ntdll, NtResumeThread. This function calls the Wow64SystemServiceCall function which then executes the Wow64Transition. The KiFastSystemCall performs the transition from 32-bit to 64-bit execution. The flow is shown in Figure 5.</p>
<p><img src="/content/dam/fireeye-www/blog/images/wowhooks/figure5.png" alt=""><br>
<span class="type-XS">Figure 5: 32-bit to 64-bit transition</span></p>
<p>The destination of the CPU transition jump is the 64-bit code show in Figure 6.</p>
<p><img src="/content/dam/fireeye-www/blog/images/wowhooks/figure6.png" alt=""><br>
<span class="type-XS">Figure 6: Destination of KiFastSystemCall</span></p>
<p>Figure 6 shows the first 64-bit instruction we’ve seen executed in this call trace so far. In order to understand it, we need to look at how the WOW64 system initializes itself. For a detailed explanation of this refer to (wbenny). For now, we can look at the important parts in <span class="code">wow64cpu!RunSimulatedCode</span>.</p>
<p><img src="/content/dam/fireeye-www/blog/images/wowhooks/figure7.png" alt=""><br>
<span class="type-XS">Figure 7: 64bit registers are saved in RunSimulatedCode</span></p>
<p>Figure 7 depicts the retrieval of the 64-bit TEB which is used to access Thread Local Storage at slot index 1. Then the moving of a function pointer table into register r15. The TLS data retrieved is an undocumented data structure <span class="code">WOW64_CPURESERVED</span> that contains register data and CPU state information used by the WOW64 layer to set and restore registers across the 32-bit and 64-bit boundaries. Within this structure is the <span class="code">WOW64_CONTEXT</span> structure, <a adhocenable="false" href="https://docs.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-wow64_context">partially documented on the Microsoft website</a>. I have listed both structures at the end of this post. We’ll look at how this context structure is used later, but for our understanding of the jmp earlier all we need to know is that r15 is a function pointer table.</p>
<p>It’s interesting to note at this point the architecture of the WOW64 layer. From the perspective of the 64-bit kernel the execution of 32-bit (Wow64) usermode applications is essentially a big while loop. The loop executes x86 instructions in the processor's 32-bit execution mode and occasionally exits the loop to service a system call. Because the kernel is 64-bit, the processor mode is temporarily switched to 64-bit, the system call serviced, then the mode switched back and the loop continued where it was paused. One could say the WOW64 layer acts like an emulator where the instructions are instead executed on the physical CPU.</p>
<p>Going back to the jmp instruction we saw in Figure 6, we now know what is occurring. The instruction jmp [r15 + 0xF8] is equivalent to the C code jmp TurboThunkDispatch[0xF8 / sizeof(uint64_t)]. Looking at the function pointer at this index we can see we’re at the function <span class="code">wow64cpu!CpupReturnFromSimulatedCode</span> (Figure 8).</p>
<p><img src="/content/dam/fireeye-www/blog/images/wowhooks/figure8.png" alt=""><br>
<span class="type-XS">Figure 8: TurboThunk table's last function pointer entry is an exit routine</span></p>
<p>This routine is responsible for saving the state of the 32-bit registers into the <span class="code">WOW64_CONTEXT</span> structure we mentioned before as well as retrieving the arguments for the syscall. There is some trickiness going on here, so let’s examine this in detail. First a pointer to the stack is moved into r14 via xchg, the value at this location will be the return address from the syscall stub where <span class="code">Wow64SystemServiceCall</span> was called. The stack pointer r14 is then incremented by 4 to get a pointer to where the stack should be reset when it’s time to restore all these context values. These two values are then stored in the context’s EIP and ESP variables respectively. The r14 stack pointer is then incremented one more time to get the location where the __stdcall arguments are (remember stdcall passes all arguments on the stack). This argument array is important for later, remember it. The arguments pointer is moved into r11, so in C this means that r11 is equivalent to an array of stack slots where each slot is an argument uint32_t r11[argCount]. The rest of the registers and EFlags are then saved.</p>
<p>Once the 32-bit context is saved, the WOW64 layer then calculates the appropriate TurboThunk to invoke by grabbing the upper 16 bits of the syscall number and dispatches to that thunk. Note that at the beginning of this array is the function <span class="code">TurboDispatchJumpAddressEnd</span>, shown in Figure 9, which is invoked for functions that do not support TurboThunks.</p>
<p><img src="/content/dam/fireeye-www/blog/images/wowhooks/figure9.png" alt=""><br>
<span class="type-XS">Figure 9: TurboThunk table's first function pointer entry is an entry routine</span></p>
<p>TurboThunks are described by (wbenny)—read his blog post at this point if you have not. To summarize the post, for functions that have simple arguments with widths &lt;= sizeof(uint32_t) the WOW64 layer will directly widen these arguments to 64 bits via zero or sign-extension and then perform a direct syscall into the kernel. This all occurs within wow64cpu, rather than executing a more complex path detailed as follows. This acts as an optimization. For more complex functions that do not support TurboThunks the <span class="code">TurboDispatchJumpAddressEnd</span> stub is used which dispatches to <span class="code">wow64!SystemServiceEx</span> to perform the system call as shown in Figure 10.</p>
<p><img src="/content/dam/fireeye-www/blog/images/wowhooks/figure10.png" alt=""><br>
<span class="type-XS">Figure 10: Complex system calls go through Wow64SystemServiceEx</span></p>
<p>We’ll look at this routine in a moment as it’s the meat of this blog post, but for now let’s finish this call trace. Once <span class="code">Wow64SystemServiceEx</span> returns from doing the system call the return value in eax is moved into the <span class="code">WOW64_CONTEXT</span> structure and then the 32-bit register states are restored. There’s two paths for this, a common case and a case that appears to exist only to be used by <span class="code">NtContinue</span> and other WOW64 internals. A flag at the start of the <span class="code">WOW64_CPURESERVED</span> structure retrieved from the&nbsp;TLS slot is checked, and controls which restore path to follow as shown in Figure 11.</p>
<p><img src="/content/dam/fireeye-www/blog/images/wowhooks/figure11.png" alt=""><br>
<span class="type-XS">Figure 11: CPU state is restored once the system call is done; there’s a simple path and a complex one handling XMM registers</span></p>
<p>The simpler case will build a jmp that uses the segment selector 0x23 to transition back to 32-bit mode after restoring all the saved registers in the <span class="code">WOW64_CONTEXT</span>. The more complex case will additionally restore some segments, xmm values, and the saved registers in the <span class="code">WOW64_CONTEXT</span> structure and then will do an iret to transition back. The common case jmp once built is shown in Figure 12.</p>
<p><img src="/content/dam/fireeye-www/blog/images/wowhooks/figure12.png" alt=""><br>
<span class="type-XS">Figure 12: Dynamically built jmp to transition back to 32bit mode</span></p>
<p>At this point our call trace is complete. The WOW64 layer has transitioned back to 32-bit mode and will continue execution at the ret after <span class="code">Wow64SystemServiceCall</span> in the syscall stub we started with. Now that an understanding of the flow of the WOW64 layer itself is understood, let’s examine the <span class="code">Wow64SystemServiceEx</span> call we glossed over before.</p>
<p>A little bit into the <span class="code">Wow64SystemServiceEx</span> routine, Figure 13 shows some interesting logic that we will use later.</p>
<p><img src="/content/dam/fireeye-www/blog/images/wowhooks/figure13.png" alt=""><br>
<span class="type-XS">Figure 13: Logging routines invoked before and after dispatching the syscalls</span></p>
<p>The routine starts by indexing into service tables which hold pointers to routines that convert the passed argument array into the wider 64-bit types expected by the regular 64-bit system modules. This argument array is exactly the stack slot that was stored earlier in r14.</p>
<p>Two calls to the <span class="code">LogService</span> function exist, however these are only called if the DLL %WINDIR%\system32\wow64log.dll is loaded and has the exports Wow64LogInitialize, Wow64LogSystemService, Wow64LogMessageArgList, and Wow64LogTerminate. This DLL is not present on Windows by default, but it can be placed there with administrator privileges.&nbsp;</p>
<p>The next section will detail how this logging DLL can be used to hook syscalls that transition through this wow64layer. Because the logging routine <span class="code">LogService</span> is invoked before and after the syscall is serviced we can achieve a standard looking inline hook style callback function capable of inspecting arguments and return values.</p>
<h4>Bypassing Inline Hooks</h4>
<p>As described in this blog post, Windows provides a way for 32-bit applications to execute 64-bit syscalls on a 64-bit system using the WOW64 layer. However, the segmentation switch we noted earlier can be manually performed, and 64-bit shellcode can be written to setup a syscall. This technique is popularly called “Heaven’s Gate”. JustasMasiulis’ work <a href="https://github.com/JustasMasiulis/wow64pp/blob/be72557d0bd2e997d985fd9c590529b62de3765b/include/wow64pp.hpp#L727">call_function64</a> can be used as a reference to see how this may be done in practice (JustasMasiulis). When system calls are performed this way the 32-bit syscall stub that the WOW64 layer uses is completely skipped in the execution chain. This is unfortunate for security products or tracing tools because any inline hooks in-place on these stubs are also bypassed. Malware authors know this and utilize “Heaven’s Gate” as a bypass technique in some cases. Figure 14 and Figure 15 shows the execution flow of a regular syscall stub through the WOW64 layer, and hooked syscall stub where malware utilizes “Heaven’s Gate”.</p>
<p><img src="/content/dam/fireeye-www/blog/images/wowhooks/figure14.png" alt=""><br>
<span class="type-XS">Figure 14: NtResumeThread transitioning through the WOW64 layer</span></p>
<p><img src="/content/dam/fireeye-www/blog/images/wowhooks/figure15b.png" alt=""><span class="type-XS"><br>
Figure 15: NtResumeThread inline hook before transitioning through the WOW64 layer</span></p>
<p>As seen in Figure 15, when using the Heaven’s Gate technique, execution begins <i>after</i> the inline hook and WOW64 layer is done. This is an effective bypass technique, but one that is easy to detect from a lower level such as a driver or hypervisor. The easiest bypass to inline hooks is simply to restore the original function bytes, usually from bytes on disk. Malware such as AgentTesla and Conti has been known to utilize this last evasion technique.</p>
<h4>Hooking WOW64 via Inline Hooks</h4>
<p>As a malware analyst being able to detect when samples attempt to bypass the WOW64 layer can be very useful. The obvious technique to detect this is to place inline hooks on the 64-bit syscall stubs as well as the 32-bit syscall stubs. If the 64-bit hook detects an invocation that didn’t also pass through the 32-bit hook, then it’s known that a sample is utilizing Heaven’s Gate. This technique can detect both evasion techniques previously detailed. However, in practice this is very difficult to implement. Looking at the requirements that must be satisfied to hook the 64-bit syscall stub we come up with this list:</p>
<ol>
<li>Install 64-bit hook from a 32-bit module<ul>
<li>How do you read/write 64-bit address space from a 32-bit module?</li>
</ul>
</li>
<li>Implement a 64-bit callback from a 32-bit module<ul>
<li>Typically, inline hooking uses C functions as callback stubs, but we’re compiling a 32-bit module so we’ll have a 32-bit callback instead of the required 64-bit one.</li>
</ul>
</li>
</ol>
<p>To solve the first challenge ntdll kindly provides the exports <span class="code">NtWow64ReadVirtualMemory64</span>, <span class="code">NtWow64WriteVirtualMemory64</span>, and <span class="code">NtWow64QueryInformationProcess64</span>. Using these it is possible to read memory, write memory, and retrieve the PEB of a 64-bit module from a 32-bit process. However, the second challenge is much harder as either shellcode or a JIT will be required to craft a callback stub of the right bitness. In practice ASMJIT may be utilized for this. This is however a very tedious technique to trace a large number of APIs. There are other challenges to this technique as well. For example, in modern Windows 10 the base address of ntdll64 is set to a high 64-bit address rather than a lower 32-bit address as in Windows 7. Due to this, supporting returns from callbacks back up to the original hooked stub and allocating a trampoline within the required memory range is difficult since the standard ret instruction doesn’t have enough bits on the stack to represent the 64-bit return address.</p>
<p>As an aside, it should be noted that the WOW64 layer contains what is likely a bug when dealing with the <span class="code">NtWow64*</span> functions. These APIs all take a <span class="code">HANDLE</span> as first argument, which <i>should</i> be sign extended to 64-bits. However, this does not occur for these APIs, therefore when using the pseudo handle -1 the call fails with <span class="code">STATUS_INVALID_HANDLE</span>. This bug was introduced in an unknown Windows 10 version. To successfully use these APIs <span class="code">OpenProcess</span> must be used to retrieve a real, positive valued handle.</p>
<p>I will not be covering the internals of how to inline hook the 64-bit syscall stub since this post is already very long. Instead I will show how my hooking library <a href="https://github.com/stevemk14ebr/PolyHook_2_0">PolyHook2</a> can be extended to support cross-architecture hooking using these Windows APIs, and leave the rest as an exercise to the reader. This works because PolyHook’s trampolines are not limited to +-2GB and do not spoil registers. The internals of how <i>that</i> is achieved is a topic for another post. Figure 16 depicts how to overload the C++ API of polyhook to read/write memory using the aforementioned WinAPIs.</p>
<p><img src="/content/dam/fireeye-www/blog/images/wowhooks/figure16.png" alt=""><br>
<span class="type-XS">Figure 16: Overloading the memory operations to read/write/protect 64-bit memory</span></p>
<p>Once these inline hooks are in-place on the 64-bit syscall stubs, any application utilizing Heaven’s Gate will be properly intercepted. This hooking technique is very invasive and complicated and can still be bypassed if a sample was to directly execute a syscall instruction rather than using the 64-bit module’s syscalls stub. Therefore, a driver or hypervisor is more suitable to detect this evasion technique. Instead we can focus on the more common byte restoration evasion techniques and look for a way to hook the WOW64 layer itself. This doesn’t involve assembly modifications at all.</p>
<h4>Hooking WOW64 via LogService</h4>
<p>Thinking back to the WOW64 layer’s execution flow we know that all calls which are sent through the <span class="code">Wow64SystemServiceEx</span> routine may invoke the routine <span class="code">Wow64LogSystemService</span> if the logging DLL is loaded. We can utilize this logging DLL and routine to implement hooks which can be written the exact same way as inline hooks, without modifying any assembly.</p>
<p>The first step to implementing this is to force all API call paths through the <span class="code">Wow64SystemServiceEx</span> routine so that the log routine may be called. Remember earlier that those that support TurboThunks will not take this path. Lucky for us we know that any TurboThunk entry that points to <span class="code">TurboDispatchJumpAddressEnd</span> will take this path. Therefore, by pointing every entry in the TurboThunk table to point at that address, the desired behavior is achieved. Windows kindly implements this patching via <span class="code">wow64cpu!BTCpuTurboThunkControl</span> as shown in Figure 17.</p>
<p><img src="/content/dam/fireeye-www/blog/images/wowhooks/figure17.png" alt=""><br>
<span class="type-XS">Figure 17: Patching the TurboThunk table is implemented for us</span></p>
<p>Note that in previous Windows versions the module which exported this and how it did is different to Windows 10, version 2004. After invoking this patch routine all syscall paths through WOW64 go through <span class="code">Wow64SystemServiceEx</span> and we can focus on crafting a logging DLL that man-in-the-middles (MITMs) all calls. There are a couple of challenges to be considered here:</p>
<ol>
<li>How do we determine which system call is currently occurring from the logging DLL?</li>
<li>How are callbacks written? Wow64log is 64-bit DLL, we’d like a 32-bit callback.<ul>
<li>Is shellcode required, or can we make nice C style function callbacks?</li>
</ul>
</li>
<li>What APIs may we call? All that’s loaded is 64-bit ntdll.</li>
</ol>
<p>The first concern is rather easy, from within the wow64log DLL we can read the syscall number from the syscall stubs to create a map of number to name. This is possible because syscall stubs always start with the same assembly and the syscall number is at a static offset of 0x4. Figure 18 shows how we can then compare the values in this map against the syscall number passed to <span class="code">Wow64LogSystemService</span>’s parameter structure <span class="code">WOW64_LOG_SERVICE</span>.</p>
<table cellpadding="1" cellspacing="0" border="1">
<tbody><tr><td><p><span class="code">typedef uint32_t* WOW64_ARGUMENTS;<br>
struct WOW64_LOG_SERVICE<br>
{<br>
&nbsp; &nbsp; &nbsp; uint64_t BtLdrEntry;<br>
&nbsp; &nbsp; &nbsp; WOW64_ARGUMENTS Arguments;<br>
&nbsp; &nbsp; &nbsp; ULONG ServiceTable;<br>
&nbsp; &nbsp; &nbsp; ULONG ServiceNumber;<br>
&nbsp; &nbsp; &nbsp; NTSTATUS Status;<br>
&nbsp; &nbsp; &nbsp; BOOLEAN PostCall;<br>
};</span></p>
<p><span class="code">EXTERN_C<br>
__declspec(dllexport)<br>
NTSTATUS<br>
NTAPI<br>
Wow64LogSystemService(WOW64_LOG_SERVICE* service)<br>
{<br>
&nbsp; &nbsp; &nbsp;for (uint32_t i = 0; i &lt; LAST_SYSCALL_ID; i++) {<br>
&nbsp; &nbsp; &nbsp; &nbsp; const char* sysname = SysCallMap[i].name;<br>
&nbsp; &nbsp; &nbsp; &nbsp; uint32_t syscallNum = SysCallMap[i].SystemCallNumber;<br>
&nbsp; &nbsp; &nbsp; &nbsp; if (ServiceParameters-&gt;ServiceNumber != syscallNum)<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; continue;<br>
&nbsp; &nbsp; &nbsp; &nbsp; //LOG sysname<br>
&nbsp; &nbsp; &nbsp;}<br>
}</span></p>
</td>
</tr></tbody></table>
<p><span class="type-XS">Figure 18: Minimal example of determining which syscall is occurring—in practice the service table must be checked too</span></p>
<p>Writing callbacks is a bit more challenging. The wow64log DLL is executing in 64-bit mode and we’d like to be able to write callbacks in 32-bit mode since it’s very easy to load additional 32-bit modules into a WOW64 process. The best way to handle this is to write shellcode which is capable of transitioning back to 32-bit mode, execute the callback, then go back to 64-bit mode to continue execution in the wow64log DLL. The segment transitions themselves are rather easy at this point, we know we just need to use 0x23 or 0x33 segment selectors when jumping. But we also need to deal with the calling convention differences between 64-bit and 32-bit. Our shellcode will therefore be responsible for moving 64-bit arguments’ register/stack slots to the 32-bit arguments register/stack slots. Enforcing that 32-bit callbacks may only be __cdecl makes this easier as all arguments are on the stack and the shellcode has full control of stack layout and cleanup. Figure 19 shows the locations of the arguments for each calling convention. Once the first 4 arguments are relocated all further arguments can be moved in a loop since it’s simply moving stack values into lower slots. This is relatively easy to implement using external masm files in MSVC. Raw bytes will need to be emitted at points rather than using the assembler due to the mix of architectures. Alternatively, GCC or Clang inline assembly could be used. ReWolf’s work achieves the opposite direction of 32-bit -&gt; 64-bit and implements the shellcode via msvc inline asm. X64 MSVC doesn’t support this and there are complications with REX prefixes when using that method. It’s nicer to use external masm files and rely on the linker to implement this shellcode.</p>
<table border="0" cellspacing="0" cellpadding="0" width="651">
<tbody><tr><td width="163"><p><b>Arg Number</b></p>
</td>
<td width="163" valign="top"><p><b>Cdecl Location</b></p>
</td>
<td width="196" valign="top"><p><b>Fastcall Location</b></p>
</td>
<td width="129" valign="top"><p><b>Special Case?</b></p>
</td>
</tr><tr><td width="163" valign="top"><p>0</p>
</td>
<td width="163" valign="top"><p>[ebp + 8]</p>
</td>
<td width="196" valign="top"><p>rcx</p>
</td>
<td width="129" valign="top"><p>Yes</p>
</td>
</tr><tr><td width="163" valign="top"><p>1</p>
</td>
<td width="163" valign="top"><p>[ebp + 12]</p>
</td>
<td width="196" valign="top"><p>rdx</p>
</td>
<td width="129" valign="top"><p>Yes</p>
</td>
</tr><tr><td width="163" valign="top"><p>2</p>
</td>
<td width="163" valign="top"><p>[ebp + 16]</p>
</td>
<td width="196" valign="top"><p>r8d</p>
</td>
<td width="129" valign="top"><p>Yes</p>
</td>
</tr><tr><td width="163" valign="top"><p>3</p>
</td>
<td width="163" valign="top"><p>[ebp + 20]</p>
</td>
<td width="196" valign="top"><p>r9d</p>
</td>
<td width="129" valign="top"><p>Yes</p>
</td>
</tr><tr><td width="163" valign="top"><p>4</p>
</td>
<td width="163" valign="top"><p>[ebp + 24]</p>
</td>
<td width="196" valign="top"><p>[rbp + 32 + 8]</p>
</td>
<td width="129" valign="top"><p>No</p>
</td>
</tr><tr><td width="163" valign="top"><p>5</p>
</td>
<td width="163" valign="top"><p>[ebp + 28]</p>
</td>
<td width="196" valign="top"><p>[rbp + 32 + 16]</p>
</td>
<td width="129" valign="top"><p>No</p>
</td>
</tr><tr><td width="163" valign="top"><p>6</p>
</td>
<td width="163" valign="top"><p>[ebp + 32]</p>
</td>
<td width="196" valign="top"><p>[rbp + 32 + 24]</p>
</td>
<td width="129" valign="top"><p>No</p>
</td>
</tr></tbody></table>
<p><span class="type-XS">Figure 19: Cdecl vs Fastcall argument positions</span></p>
<p>Once this shellcode is written and wrapped into a nice C++ function, it’s possible for the wow64log DLL to invoke the callback via a simple C style function pointer call shown in Figure 20.</p>
<p><img src="/content/dam/fireeye-www/blog/images/wowhooks/figure20.png" alt=""><br>
<span class="type-XS">Figure 20: call_function32 invokes shellcode to call a 32-bit callback from the 64-bit logging DLL</span></p>
<p>From within the 32-bit callback any desired MITM operations can be performed, but restrictions exist on which APIs are callable. Due to the context saving that the WOW64 layer performs, 32-bit APIs that would re-enter the WOW64 layer may not be called as the context values would be corrupted. We are therefore limited to only APIs that won’t re-enter WOW64, which are those that are exported from the 64-bit ntdll. The <span class="code">NtWriteFile</span> export may be used to easily write to stdout or a file, but we must re-enter the 64-bit execution mode and do the inverse argument mapping as before. This logging routine can be called from within the 32-bit callbacks and is shown in Figure 21 and Figure 22.</p>
<p><img src="/content/dam/fireeye-www/blog/images/wowhooks/figure21.png" alt=""><br>
<span class="type-XS">Figure 21: call_function64 invokes shellcode to call the 64bit WriteFile from with the 32bit callback</span></p>
<p><img src="/content/dam/fireeye-www/blog/images/wowhooks/figure22.png" alt=""><br>
<span class="type-XS">Figure 22: 32bit callbacks must log via routines that only call non-reentrant WOW64 APIs</span></p>
<p>The result is clean looking callback stubs that function exactly how inline hooks might, but with zero assembly modifications required. Arguments can easily be manipulated as well, but the return status may not be modified unless a little stack walk hackery is implemented. The only other consideration is that the wow64log DLL itself needs to be carefully crafted to not build with any CRT mechanisms. The flags required are:</p>
<ul>
<li>Disable CRT with /NODEFAULT LIB (all C APIs now unavailable), set a new entry point name to not init CRT NtDllMain</li>
<li>Disable all CRT security routines /GS-</li>
<li>Disable C++ exceptions</li>
<li>Remove default linker libraries, only link ntdll.lib</li>
<li>Use extern “C” __declspec(dllimport) &lt;typedef&gt; to link against the correct NtApis</li>
</ul>
<p>An example of a program hooking its own system calls via wow64log inline hooks is shown in Figure 23.</p>
<p><img src="/content/dam/fireeye-www/blog/images/wowhooks/figure23.gif" alt=""><br>
<span class="type-XS">Figure 23: Demonstration of inline hooks in action</span></p>
<h4>Conclusion</h4>
<p>Using inline WOW64 hooks, wow64log hooks, and kernel/hypervisor hooks, all techniques of usermode hook evasion can be identified easily and automatically. Detecting which layers of hooks are skipped or bypassed will give insight into which evasion technique is employed. The identifying table is:</p>
<table border="0" cellspacing="0" cellpadding="0" width="624">
<tbody><tr><td width="194" valign="top"><p><b>Evasion Mode</b></p>
</td>
<td width="87" valign="top"><p><b>32bit Inline</b></p>
</td>
<td width="97" valign="top"><p><b>wow64Log</b></p>
</td>
<td width="91" valign="top"><p><b>64bit Inline</b></p>
</td>
<td width="156" valign="top"><p><b>Kernel/Hypervisor</b></p>
</td>
</tr><tr><td width="194" valign="top"><p>Prologue Restore</p>
</td>
<td width="87" valign="top"><p>❌</p>
</td>
<td width="97" valign="top"><p><b>✔</b></p>
</td>
<td width="91" valign="top"><p><b>✔</b></p>
</td>
<td width="156" valign="top"><p><b>✔</b></p>
</td>
</tr><tr><td width="194" valign="top"><p>Heavens Gate sys-stub</p>
</td>
<td width="87" valign="top"><p>❌</p>
</td>
<td width="97" valign="top"><p>❌</p>
</td>
<td width="91" valign="top"><p><b>✔</b></p>
</td>
<td width="156" valign="top"><p><b>✔</b></p>
</td>
</tr><tr><td width="194" valign="top"><p>Heavens Gate direct syscall</p>
</td>
<td width="87" valign="top"><p>❌</p>
</td>
<td width="97" valign="top"><p>❌</p>
</td>
<td width="91" valign="top"><p>❌</p>
</td>
<td width="156" valign="top"><p><b>✔</b></p>
</td>
</tr></tbody></table>
<h4>Structure Appendix</h4>
<p><span class="code">struct _WOW64_CPURESERVED<br>
{<br>
&nbsp; USHORT Flags;<br>
&nbsp; USHORT MachineType;<br>
&nbsp; WOW64_CONTEXT Context;<br>
&nbsp; char ContextEx[1024];<br>
};</span></p>
<p><span class="code">typedef ULONG *WOW64_LOG_ARGUMENTS;<br>
struct _WOW64_SYSTEM_SERVICE<br>
{<br>
&nbsp; unsigned __int32 SystemCallNumber : 12;<br>
&nbsp; unsigned __int32 ServiceTableIndex : 4;<br>
&nbsp; unsigned __int32 TurboThunkNumber : 5;<br>
&nbsp; unsigned __int32 AlwaysZero : 11;<br>
};<br>
#pragma pack(push, 1)<br>
struct _WOW64_FLOATING_SAVE_AREA<br>
{<br>
&nbsp; DWORD ControlWord;<br>
&nbsp; DWORD StatusWord;<br>
&nbsp; DWORD TagWord;<br>
&nbsp; DWORD ErrorOffset;<br>
&nbsp; DWORD ErrorSelector;<br>
&nbsp; DWORD DataOffset;<br>
&nbsp; DWORD DataSelector;<br>
&nbsp; BYTE RegisterArea[80];<br>
&nbsp; DWORD Cr0NpxState;<br>
};<br>
#pragma pack(pop)</span></p>
<p><span class="code">#pragma pack(push, 1)<br>
struct _WOW64_CONTEXT<br>
{<br>
&nbsp; DWORD ContextFlags;<br>
&nbsp; DWORD Dr0;<br>
&nbsp; DWORD Dr1;<br>
&nbsp; DWORD Dr2;<br>
&nbsp; DWORD Dr3;<br>
&nbsp; DWORD Dr6;<br>
&nbsp; DWORD Dr7;<br>
&nbsp; WOW64_FLOATING_SAVE_AREA FloatSave;<br>
&nbsp; DWORD SegGs;<br>
&nbsp; DWORD SegFs;<br>
&nbsp; DWORD SegEs;<br>
&nbsp; DWORD SegDs;<br>
&nbsp; DWORD Edi;<br>
&nbsp; DWORD Esi;<br>
&nbsp; DWORD Ebx;<br>
&nbsp; DWORD Edx;<br>
&nbsp; DWORD Ecx;<br>
&nbsp; DWORD Eax;<br>
&nbsp; DWORD Ebp;<br>
&nbsp; DWORD Eip;<br>
&nbsp; DWORD SegCs;<br>
&nbsp; DWORD EFlags;<br>
&nbsp; DWORD Esp;<br>
&nbsp; DWORD SegSs;<br>
&nbsp; BYTE ExtendedRegistersUnk[160];<br>
&nbsp; M128A Xmm0;<br>
&nbsp; M128A Xmm1;<br>
&nbsp; M128A Xmm2;<br>
&nbsp; M128A Xmm3;<br>
&nbsp; M128A Xmm4;<br>
&nbsp; M128A Xmm5;<br>
&nbsp; M128A Xmm6;<br>
&nbsp; M128A Xmm7;<br>
&nbsp; M128A Xmm8;<br>
&nbsp; M128A Xmm9;<br>
&nbsp; M128A Xmm10;<br>
&nbsp; M128A Xmm11;<br>
&nbsp; M128A Xmm12;<br>
&nbsp; M128A Xmm13;<br>
&nbsp; M128A Xmm14;<br>
&nbsp; M128A Xmm15;<br>
};<br>
#pragma pack(pop)</span></p>
</div>
<div class="clear-all"></div></div>
</div>
<div class="par prevnextbutton">
<div class="prevnext">
<div class="button">
<a id="leftBtnId" class="btn btn-B2282D" href="#"><span>Previous</span> <span>Post</span></a>
</div>
<div class="button">
<a id="rightBtnId" class="btn btn-B2282D" href="#"><span>Next</span> <span>Post</span></a>
</div>
</div>
<input type="hidden" value="/content/fireeye-www/en_US/blog/threat-research" id="categoryPathVal" name="categoryPath" />
<script>
    $(document).ready(function(){

         var prevenextHtml = $('.prevnext').html();	
         var categoryPathVal = $("#categoryPathVal").val();
            var blogsDetails;
        
            if(undefined == blogsDetails){
                    blogsDetails = [];
            }
        
        
            if(undefined != prevenextHtml){
                if(blogsDetails.length <= 0){
                     $.ajax({
                        type: "GET",
                        url: "/bin/www-blogs/read-blogentries",
                        dataType: "json",
                        data: { categoryPath: categoryPathVal} ,
                        async: false,
                        success : function(data) {
                            var totalFoundRes = data.blogs.length;
                            blogsDetails = data.blogs;
                            var currentPagePath = window.location.pathname;
                            currentPagePath = currentPagePath.split(".")[0]
                            console.log("currentPagePath :: "+currentPagePath);
        
                            for (var i = 0; i < blogsDetails.length; i++) {
                                var currentItrPath = blogsDetails[i].path;
        
                                if (currentItrPath.indexOf(currentPagePath) > -1) {
                                    console.log(blogsDetails[i-1]);
                                    console.log(blogsDetails[i+1]);

                                    if(undefined != blogsDetails[i-1] ){
										var prevPagePath = blogsDetails[i-1].path;
                                        $("#leftBtnId").attr("href",prevPagePath+".html");
                                        $("#leftBtnId").show();
                                    }else{
										$("#leftBtnId").hide();
                                    }
                                    if(undefined != blogsDetails[i+1] ){
										var nextPagePath = blogsDetails[i+1].path;  
                                    	$("#rightBtnId").attr("href",nextPagePath+".html");
                                        $("#rightBtnId").show();
                                    }else{
										$("#rightBtnId").hide();
                                    }
                                }
                            }
        
                        },
                        error : function(response){
                            console.log("Error: while connecting to servlet.");
                        }
                    });
                 }else{
                     alert("Blogs from global object :: "+blogsDetails);
                 }
            }else{
                alert("prevenextHtml :: "+prevenextHtml);
            }
    });
</script></div>
</div></div>
</div>
</div>
<div id="sidebar" class="g-u-7-24 l_g-u-1 blog-sidebar">
<div class="g-content">
 <div class="sidebar reuse-blog-resources">
<div class="blog-resources">
<div class="grid-33-left parsys"><div class="rightrail section">
<div class="blog-right-rail">
<div class="bottom-bar"><div class="tab">
<span class="ficon ficon-star"></span>
<p>Promotion</p></div><div class="tab">
<span class="ficon ficon-checkbox-checked"></span>
<p>Subscribe</p></div>
<div class="tab">
<span class="ficon ficon-share"></span>
<p>Share</p></div>
<div class="tab">
<span class="ficon ficon-history2"></span>
<p>Recent</p></div>
<div class="tab">
<span class="ficon ficon-feed"></span>
<p>RSS</p></div>
</div><div class="section cta">
<div id="cq-image-jsp-/content/fireeye-www/site-content/en_US/blog-right-threat-research/jcr:content/grid-33-left/rightrail/image"><a href="/mandiant/advantage.html"><img src="/content/dam/fireeye-www/services/images/bnr-mandiant-advantage-v3-315x315.png" alt="bnr-mandiant-advantage-v3-315x315" title="bnr-mandiant-advantage-v3-315x315" class="cq-dd-image"></a></div></div><div class="section email">
<script src="https://www2.fireeye.com/js/forms2/js/forms2.min.js"></script>
<div id="mktoWrapper_3353" class="a08 bg-f2f2f2"><div class="c00 c00v0"><h3>Email Updates</h3><p>Information and insight on today's advanced threats from FireEye.</p></div><form id="mktoForm_3353"></form> <script type="text/javascript">
		if(typeof digitalData=="undefined"){digitalData={}}
        //alert(https://www2.fireeye.com+":"+848-DID-242)
        //alert("false");
		MktoForms2.loadForm("https://www2.fireeye.com", "848-DID-242", 3353,
		function(form) {
			
            if(typeof fdc.blog.initCheckboxes === "function") {
                fdc.blog.initCheckboxes(form);
            } 
			digitalData.form = {id: form.getId(),name: document.title,url: window.location.href};
			//if(typeof marketoFormViewTealiumEvent !== "undefined" && typeof utag!=="undefined"){marketoFormViewTealiumEvent(form);}
			if(typeof marketoFormViewGtmEvent !== "undefined") {
				marketoFormViewGtmEvent(form);
			}
			form.onSubmit(function(values){
                //Check if GA fields are present
                if(($("input[name='GACLIENTID__c']").length>0)&&($("input[name='GAUSERID__c']").length>0)&&($("input[name='GATRACKID__c']").length>0)&&(typeof ga!=="undefined"))
                {
                      ga(function(){ 
                          //Get tracking ID and Client ID
                           var tracker = ga.getAll()[0];
                           var trackingId = tracker.get('trackingId');
                           var clientId = tracker.get('clientId');
                           var userId = tracker.get('userId');
                           $("input[name='GACLIENTID__c'").val(clientId);
                           $("input[name='GATRACKID__c'").val(trackingId);
                           $("input[name='GAUSERID__c'").val(userId);
                       });
                 }
            
        	});
			form.onSuccess(function(values, followUpUrl) {
				//if(typeof marketoFormSubmitTealiumEvent !== "undefined"){marketoFormSubmitTealiumEvent(values);}
				if(typeof marketoFormSubmitGTMEvent !== "undefined") {
					marketoFormSubmitGTMEvent(values);
				}
				
				if(typeof fdc.blog.replaceFormWithThankYou === "function") {
					var result = fdc.blog.replaceFormWithThankYou(form,values,followUpUrl);
					if (result === false) {
						return false;
					}
				} 
				return true;
			});
			
			var adrC = typeof addMissingUTMsFromCookies !== "undefined" ? addMissingUTMsFromCookies(document.URL) : document.URL;
			form.addHiddenFields({ ADR__c: adrC,ADR_Credit__c_account: document.title,ADR_Credit__c: document.referrer });
			if(($("input[name='GACLIENTID__c']").length==0)&&($("input[name='GAUSERID__c']").length==0)&&($("input[name='GATRACKID__c']").length==0)){
				form.addHiddenFields({ GACLIENTID__c:"",GAUSERID__c:"",GATRACKID__c:""});				
			}
			
		});
	</script>
</div></div>
<div class="section share">
<h6><small>Share</small></h6>

<div class="addthis_inline_share_toolbox_7uq8"></div>
</div>
<div class="section recent">
<h6>Recent Posts</h6>

<div class="c05 c05v0"><ul>
<li class="c05_item"><p class="c05_date">04 Mar 2021</p><a class="c05_link" href="/blog/threat-research/2021/03/detection-response-to-exploitation-of-microsoft-exchange-zero-day-vulnerabilities.html" title="Detection and Response to Exploitation of Microsoft Exchange Zero-Day Vulnerabilities">Detection and Response to Exploitation of Microsoft Exchange Zero-Day Vulnerabilities</a></li>

<li class="c05_item"><p class="c05_date">04 Mar 2021</p><a class="c05_link" href="/blog/threat-research/2021/03/sunshuttle-second-stage-backdoor-targeting-us-based-entity.html" title="New SUNSHUTTLE Second-Stage Backdoor Uncovered Targeting U.S.-Based Entity; Possible Connection to UNC2452">New SUNSHUTTLE Second-Stage Backdoor Uncovered Targeting U.S.-Based
Entity; Possible Connection to UNC2452</a></li>

<li class="c05_item"><p class="c05_date">03 Mar 2021</p><a class="c05_link" href="/blog/threat-research/2021/03/fuzzing-image-parsing-in-windows-uninitialized-memory.html" title="Fuzzing Image Parsing in Windows, Part Two: Uninitialized Memory">Fuzzing Image Parsing in Windows, Part Two: Uninitialized Memory</a></li>
</ul></div>
</div>
<a href="/content/fireeye-www/en_US/blog/threat-research/_jcr_content.feed" target="_blank">
<div class="section rss">
<h6><small>RSS Feed: </small><small>Stay Connected</small></h6>
<span class="ficon ficon-feed"></span>
</div>
</a>
</div>
</div>
</div>
</div></div>
</div>
</div>
</div>
</div>
</main>

<div class="footer_f635 footer">

<footer id="g03-footer" class="l_footer g03 g03v0 g03v2 g03-5col">
<div class="main-footer-wrapper">

<div class="g03_list g03_list_1">
<div class="parsys"><div class="htmlpassthru section">
<p style="margin-bottom:6px"><strong>Company</strong></p></div>
<div class="footer-list section">
<ul class="g03_block"><li class="g03_item"><a href="/company.html" class="Footer">Why FireEye?</a></li>
<li class="g03_item"><a href="/customers.html" class="Footer">Customer Stories</a></li>
<li class="g03_item"><a href="/company/jobs.html" class="Footer">Careers</a></li>
<li class="g03_item"><a href="/company/compliance-certification.html" class="Footer">Certifications and Compliance</a></li>
<li class="g03_item"><a href="http://investors.fireeye.com/" target="_blank" class="Footer">Investor Relations</a></li>
<li class="g03_item"><a href="/company/supplier.html" class="Footer">Supplier Documents</a></li>
</ul></div>
</div>
</div>
<div class="g03_list g03_list_2">
<div class="parsys"><div class="htmlpassthru section">
<p style="margin-bottom:6px"><strong>News and Events</strong></p></div>
<div class="footer-list section">
<ul class="g03_block"><li class="g03_item"><a href="/company/newsroom.html" class="Footer">Newsroom</a></li>
<li class="g03_item"><a href="/company/press-releases.html" class="Footer">Press Releases</a></li>
<li class="g03_item"><a href="/company/webinars.html" class="Footer">Webinars</a></li>
<li class="g03_item"><a href="/company/events.html" class="Footer">Events</a></li>
<li class="g03_item"><a href="/company/awards.html" class="Footer">Awards and Honors</a></li>
<li class="g03_item"><a href="/company/contact-us/manage-your-communication-preference.html" class="Footer">Email Preferences</a></li>
</ul></div>
</div>
</div>
<div class="g03_list g03_list_3">
<div class="parsys"><div class="htmlpassthru section">
<p style="margin-bottom:6px"><strong>Technical Support</strong></p></div>
<div class="footer-list section">
<ul class="g03_block"><li class="g03_item"><a href="/company/incident-response.html" class="Footer">Incident?</a></li>
<li class="g03_item"><a href="/company/security.html" class="Footer">Report Security Issue</a></li>
<li class="g03_item"><a href="/support/contacts.html" class="Footer">Contact Support</a></li>
<li class="g03_item"><a href="https://csportal.fireeye.com/secur/login_portal.jsp?orgId=00D3000000063LS&portalId=06030000000pSNE" target="_blank" class="Footer">Customer Portal</a></li>
<li class="g03_item"><a href="https://community.fireeye.com/s/support-community" target="_blank" class="Footer">Communities</a></li>
<li class="g03_item"><a href="https://docs.fireeye.com" target="_blank" class="Footer">Documentation Portal</a></li>
</ul></div>
</div>
</div>
<div class="g03_list g03_list_4">
<div class="parsys"><div class="htmlpassthru section">
<p style="margin-bottom:6px"><strong>FireEye Blogs</strong></p></div>
<div class="footer-list section">
<ul class="g03_block"><li class="g03_item"><a href="/blog/threat-research.html" class="Footer">Threat Research</a></li>
<li class="g03_item"><a href="/blog/products-and-services.html" class="Footer">FireEye Stories</a></li>
<li class="g03_item"><a href="/blog/executive-perspective.html" class="Footer">Industry Perspectives</a></li>
</ul></div>
<div class="htmlpassthru section">
<p style="margin-bottom:6px"><strong>Threat Map</strong></p></div>
<div class="footer-list section">
<ul class="g03_block"><li class="g03_item"><a href="/cyber-map/threat-map.html" class="Footer">View the Latest Threats</a></li>
</ul></div>
</div>
</div>
<div class="g03_list g03_list_5">
<div class="parsys"><div class="htmlpassthru section">
<p style="margin-bottom:6px"><strong>Contact Us</strong><br>
<div class="footer-list section">
<ul class="g03_block">
<li class="g03_item"><a href="tel:+1 877-347-3393" class="contactlinks">+1 877-347-3393</a><br>&nbsp;</li>
</ul>
</div></div>
<div class="htmlpassthru section">
<p style="margin-bottom:6px"><strong>Stay Connected</strong></p></div>
<div class="followus-footer section"><h4 class="g03_title" id="g03-followus-title"> </h4><ul class="g03_block g03-s" id="g03-followus-list"><li class="g03_item g03_item-s">
<a href="https://www.linkedin.com/company/fireeye" target="_blank">
<span class="g03-s-i ficon g03-s-i-li ficon-linkedin"></span>
<span class="g03-s_label">LinkedIn</span>
</a>
</li><li class="g03_item g03_item-s">
<a href="https://twitter.com/fireeye" target="_blank">
 <span class="g03-s-i ficon g03-s-i-tw ficon-twitter2"></span>
<span class="g03-s_label">Twitter</span>
</a>
</li><li class="g03_item g03_item-s">
<a href="https://www.facebook.com/FireEye" target="_blank">
<span class="g03-s-i ficon g03-s-i-fb ficon-facebook2"></span>
<span class="g03-s_label">Facebook</span>
</a>
</li><li class="g03_item g03_item-s">
<a href="https://www.youtube.com/user/FireEyeInc" target="_blank">
<span class="g03-s-i ficon g03-s-i-yt ficon-youtube2"></span>
<span class="g03-s_label">YouTube</span>
</a>
</li><li class="g03_item g03_item-s">
<a href="https://itunes.apple.com/us/podcast/eye-on-security/id1073779629?mt=2" target="_blank">
<span class="g03-s-i ficon g03-s-i-pc ficon-podcast"></span>
<span class="g03-s_label">Podcast</span>
</a>
</li></ul>
</div>
<div class="htmlpassthru section">
<div class="country-notification">
<div id="c08_modal-lang" class="c08_modal lang">
<div class="c08 c08v1">
<div class="c08_header">
<a href="#dismiss-lightbox" class="ficon ficon-close c08_dismiss" data-behavior="dismiss-c08"></a>
</div>
<div class="c08_content">
<div class="c08_body">
<div class="col FR">
<p class="type-ML">Cette page est également disponible en français.</p>
<div class="button section"><a class="btn" href="/index.html">Version française</a></div>
</div>
<div class="col DE">
<p class="type-ML">Diese Seite ist auch auf Deutsch verfügbar</p>
<div class="button section"><a class="btn" href="/index.html">Zur deutschen Seite wechseln</a></div>
</div>
<div class="col JP">
<p class="type-ML">日本語ページを</p>
<div class="button section"><a class="btn" href="/index.html">見る</a></div>
</div>
<div class="col KR">
<p class="type-ML">해당 페이지는 한글 버전으로 보실 수 있습니다</p>
<div class="button section"><a class="btn" href="/index.html">바로 가기</a></div>
</div>
<hr>
<div class="col">
<p><a class="dismiss" href="#dismiss-lightbox" data-behavior="dismiss-c08">Continue viewing this page in English</a></p>
</div>
</div>
</div>
</div>
</div>
<style>
.c08_modal.lang {
    background: rgba(255,255,255,0.8);
}
.c08_modal.lang .c08_header {
    background: transparent;
    border-left: none;
}
.c08_modal.lang .c08 {
    top: 20%;
    width: 600px;
    border-radius: 12px;
    box-shadow: rgba(0, 0, 0, 0.37) 0 0 15px;
    border: 1px solid #b4b5b8;
    background-image: url("/content/dam/fireeye-www/fw/images/bg-language-select.jpg");
    background-position: right bottom;
    margin: 0 auto;
    position: relative;
    max-width: 90%;
}
.c08_modal.lang .c08_dismiss {
    color: #222;
}
.c08_modal.lang .c08_body {
    padding: 12px 50px 60px;
}
.c08_modal.lang .col {
    display: none;
}
.c08_modal.lang .col:last-child {
    display: block;
}
.c08_modal.lang .btn {
    margin-bottom: 0;
}
.c08_modal.lang hr {
    margin: 30px 80px;
}
.c08_modal.lang hr:before {
    border-bottom: none;
}
</style>
</div></div>
</div>
</div></div>
<div class="legal-footer-wrapper">
<div class="legal-footer">
<div class="g03_copyright">
<p class="g03_copyright_p">
Copyright&nbsp;&copy;&nbsp;2021&nbsp;FireEye, Inc.&nbsp;All rights reserved.&nbsp;<span class="g03-legal"><a href="/company/privacy.html">Privacy &amp; Cookies Policy</a> | <a href="/company/privacy-shield-commitment.html">Privacy Shield</a> | <a href="/company/legal.html">Legal Documentation</a></span>
</p>
</div><div class="g03_languages">
<a class="g01_options-option" href="#footer-worldwide">
<span>Site Language</span>
<span>English<span class="ficon ficon-globe"></span></span>
</a>
<div class="option-menu" id="footer-worldwide">
<p><strong>My preferred language:</strong></p>
<ul class="g01_options_list"><li><a href="https://www.fireeye.com/blog/threat-research/2020/11/wow64-subsystem-internals-and-hooking-techniques.html" target="_blank">English (English)</a></li>
<li><a href="https://www.fireeye.fr" target="_blank">French (Français)</a></li>
<li><a href="https://www.fireeye.de" target="_blank">German (Deutsch)</a></li>
<li><a href="https://www.fireeye.jp" target="_blank">Japanese (日本語)</a></li>
<li><a href="https://www.fireeye.kr" target="_blank">Korean (한국어)</a></li>
<li><a href="/products/international-literature.html">More languages</a></li>
</ul>
</div>
</div> </div>
</div>
</footer>
</div>
<script type="text/javascript" src="/etc/designs/fireeye-www/clientlibs_fw.min.js"></script>


<div class="htmlpassthru_c66c htmlpassthru">
</div>

<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=fewebadmin"></script>
</body>
</html>
