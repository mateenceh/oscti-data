<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>

  
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
    <!-- Taken from www.malwarebytes.com -->
  <!-- Fav Ico -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel='shortcut icon' href='//www.malwarebytes.com/images/favicon.ico' type='image/x-icon' />
  <link rel="apple-touch-icon" sizes="57x57" href="//www.malwarebytes.com/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="//www.malwarebytes.com/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="//www.malwarebytes.com/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="//www.malwarebytes.com/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="//www.malwarebytes.com/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="//www.malwarebytes.com/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="//www.malwarebytes.com/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="//www.malwarebytes.com/apple-touch-icon-152x152.png">
  <link rel="icon" type="image/png" href="//www.malwarebytes.com/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="///www.malwarebytes.com/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="//www.malwarebytes.com/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="//www.malwarebytes.com/manifest.json">
  <meta name="msapplication-TileColor" content="#2b5797">
  <meta name="msapplication-TileImage" content="//www.malwarebytes.com/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">
  
<title>

The Hidden Bee infection chain, part 1: the stegano pack - Malwarebytes Labs | Malwarebytes Labs  </title>
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="https://blog.malwarebytes.com/xmlrpc.php">

  
	<!-- Meta Tag Manager -->
	<meta property="fb:app_id" content="358351844222748" />
	<!-- / Meta Tag Manager -->

	<!-- This site is optimized with the Yoast SEO plugin v15.9 - https://yoast.com/wordpress/plugins/seo/ -->
	<meta name="description" content="Hidden Bee has a complex, multi-layered internal structure that is unusual among cybercrime toolkits. We look at its evolution over the last year." />
	<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
	<link rel="canonical" href="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/" />
	<meta property="og:locale" content="en_US" />
	<meta property="og:type" content="article" />
	<meta property="og:title" content="The Hidden Bee infection chain, part 1: the stegano pack - Malwarebytes Labs" />
	<meta property="og:description" content="Hidden Bee has a complex, multi-layered internal structure that is unusual among cybercrime toolkits. We look at its evolution over the last year." />
	<meta property="og:url" content="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/" />
	<meta property="og:site_name" content="Malwarebytes Labs" />
	<meta property="article:published_time" content="2019-08-15T15:26:55+00:00" />
	<meta property="article:modified_time" content="2019-08-18T20:00:46+00:00" />
	<meta property="og:image" content="https://blog.malwarebytes.com/wp-content/uploads/2019/08/shutterstock_1341482126.jpg" />
	<meta property="og:image:width" content="1000" />
	<meta property="og:image:height" content="737" />
	<meta name="twitter:card" content="summary" />
	<meta name="twitter:creator" content="@hasherezade" />
	<meta name="twitter:site" content="@malwarebytes" />
	<meta name="twitter:label1" content="Written by">
	<meta name="twitter:data1" content="hasherezade">
	<meta name="twitter:label2" content="Est. reading time">
	<meta name="twitter:data2" content="18 minutes">
	<script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://blog.malwarebytes.com/#website","url":"https://blog.malwarebytes.com/","name":"Malwarebytes Labs","description":"The Security Blog From Malwarebytes","potentialAction":[{"@type":"SearchAction","target":"https://blog.malwarebytes.com/?s={search_term_string}","query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"ImageObject","@id":"https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/#primaryimage","inLanguage":"en-US","url":"https://blog.malwarebytes.com/wp-content/uploads/2019/08/shutterstock_1341482126.jpg","width":1000,"height":737,"caption":"hidden bee"},{"@type":"WebPage","@id":"https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/#webpage","url":"https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/","name":"The Hidden Bee infection chain, part 1: the stegano pack - Malwarebytes Labs","isPartOf":{"@id":"https://blog.malwarebytes.com/#website"},"primaryImageOfPage":{"@id":"https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/#primaryimage"},"datePublished":"2019-08-15T15:26:55+00:00","dateModified":"2019-08-18T20:00:46+00:00","author":{"@id":"https://blog.malwarebytes.com/#/schema/person/3c674ace3322ac9b8bd3368413fecf10"},"description":"Hidden Bee has a complex, multi-layered internal structure that is unusual among cybercrime toolkits. We look at its evolution over the last year.","breadcrumb":{"@id":"https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/#breadcrumb"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/"]}]},{"@type":"BreadcrumbList","@id":"https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://blog.malwarebytes.com/","url":"https://blog.malwarebytes.com/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/","url":"https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/","name":"The Hidden Bee infection chain, part 1: the stegano pack"}}]},{"@type":"Person","@id":"https://blog.malwarebytes.com/#/schema/person/3c674ace3322ac9b8bd3368413fecf10","name":"hasherezade","image":{"@type":"ImageObject","@id":"https://blog.malwarebytes.com/#personlogo","inLanguage":"en-US","url":"https://secure.gravatar.com/avatar/5d5dda1e7e00492cdb89a26415b1fa8f?s=96&d=identicon&r=g","caption":"hasherezade"},"description":"Unpacks malware with as much joy as a kid unpacking candies.","sameAs":["http://hasherezade.net","https://twitter.com/hasherezade"]}]}</script>
	<!-- / Yoast SEO plugin. -->


<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel='dns-prefetch' href='//v0.wordpress.com' />
<link rel="alternate" type="application/rss+xml" title="Malwarebytes Unpacked" href="http://blog.malwarebytes.org/feed/" />
<link rel="alternate" type="application/rss+xml" title="Malwarebytes Unpacked | Comments" href="http://blog.malwarebytes.org/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Malwarebytes Labs &raquo; The Hidden Bee infection chain, part 1: the stegano pack Comments Feed" href="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/blog.malwarebytes.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.6.2"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css'  href='https://blog.malwarebytes.com/wp-includes/css/dist/block-library/style.min.css?ver=5.6.2' type='text/css' media='all' />
<style id='wp-block-library-inline-css' type='text/css'>
.has-text-align-justify{text-align:justify;}
</style>
<link rel='stylesheet' id='responsive-lightbox-prettyphoto-css'  href='https://blog.malwarebytes.com/wp-content/plugins/responsive-lightbox/assets/prettyphoto/prettyPhoto.min.css?ver=2.3.2' type='text/css' media='all' />
<link crossorigin="anonymous" rel='stylesheet' id='mb_labs-fonts-css'  href='//fonts.googleapis.com/css?family=Source+Sans+Pro%3A300%2C400%2C700%2C300italic%2C400italic%2C700italic%7CBitter%3A400%2C700&#038;subset=latin%2Clatin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='genericons-css'  href='https://blog.malwarebytes.com/wp-content/plugins/jetpack/_inc/genericons/genericons/genericons.css?ver=3.1' type='text/css' media='all' />
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-includes/js/jquery/jquery.min.js?ver=3.5.1' id='jquery-core-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.3.2' id='jquery-migrate-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-content/plugins/responsive-lightbox/assets/prettyphoto/jquery.prettyPhoto.min.js?ver=2.3.2' id='responsive-lightbox-prettyphoto-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-includes/js/underscore.min.js?ver=1.8.3' id='underscore-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-content/plugins/responsive-lightbox/assets/infinitescroll/infinite-scroll.pkgd.min.js?ver=5.6.2' id='responsive-lightbox-infinite-scroll-js'></script>
<script type='text/javascript' id='responsive-lightbox-js-extra'>
/* <![CDATA[ */
var rlArgs = {"script":"prettyphoto","selector":"lightbox","customEvents":"","activeGalleries":"1","animationSpeed":"normal","slideshow":"0","slideshowDelay":"5000","slideshowAutoplay":"0","opacity":"0.75","showTitle":"1","allowResize":"1","allowExpand":"1","width":"1080","height":"720","separator":"\/","theme":"pp_default","horizontalPadding":"20","hideFlash":"0","wmode":"opaque","videoAutoplay":"0","modal":"0","deeplinking":"0","overlayGallery":"1","keyboardShortcuts":"1","social":"0","woocommerce_gallery":"0","ajaxurl":"https:\/\/blog.malwarebytes.com\/wp-admin\/admin-ajax.php","nonce":"34b79a074b"};
/* ]]> */
</script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-content/plugins/responsive-lightbox/js/front.js?ver=2.3.2' id='responsive-lightbox-js'></script>
<link rel="https://api.w.org/" href="https://blog.malwarebytes.com/wp-json/" /><link rel="alternate" type="application/json" href="https://blog.malwarebytes.com/wp-json/wp/v2/posts/38724" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://blog.malwarebytes.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://blog.malwarebytes.com/wp-includes/wlwmanifest.xml" /> 
<link rel='shortlink' href='https://blog.malwarebytes.com/?p=38724' />
<link rel="alternate" type="application/json+oembed" href="https://blog.malwarebytes.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblog.malwarebytes.com%2Fthreat-analysis%2F2019%2F08%2Fthe-hidden-bee-infection-chain-part-1-the-stegano-pack%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://blog.malwarebytes.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblog.malwarebytes.com%2Fthreat-analysis%2F2019%2F08%2Fthe-hidden-bee-infection-chain-part-1-the-stegano-pack%2F&#038;format=xml" />
	<style type="text/css" id="mb_labs-header-css">
			.site-header {
			background: url(https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/headers/circle.png) no-repeat scroll top;
			background-size: 1600px auto;
		}
		</style>
	<link rel="amphtml" href="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/amp/">    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.css" />
	<link rel="stylesheet" type="text/css" href="//www.malwarebytes.com/css/style.css?12-20-2016" />
	<link rel="stylesheet" type="text/css" href="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/style.css?03-03-2021" />


  <script src="//www.malwarebytes.com/js/jquery-1.11.3.min.js" type="text/javascript"></script>

<!-- OneTrust Cookies Consent Notice (Production Standard, malwarebytes.com, en-GB) start -->

<script src="https://optanon.blob.core.windows.net/consent/9530a107-0af8-4204-a2c2-217efb78222b.js" type="text/javascript" charset="UTF-8"></script>

<script type="text/javascript">

function OptanonWrapper() { }

</script>

<!-- OneTrust Cookies Consent Notice (Production Standard, malwarebytes.com, en-GB) end -->

  <script src="//www.malwarebytes.com/js/bootstrap.js" type="text/javascript"></script>
  <script src="//www.malwarebytes.com/js/ie-fixes/respond.min.js" type="text/javascript"></script>

<script src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/modernizr.js"></script>
<!--[if gte IE 9]><!-->
<script type="text/javascript" src="//www.malwarebytes.com/js/nav-resize.js"></script>
<!--<![endif]-->
	
  <script src="//www.malwarebytes.com/js/flexibility.js"></script>

  <!--<script src="//www.malwarebytes.com/js/nav.js"></script>-->
  <script>
function readCookie(name) {
  var nameEQ = name + "=";
  var ca = document.cookie.split(';');
  for (var i = 0; i < ca.length; i++) {
    var c = ca[i];
    while (c.charAt(0) == ' ') c = c.substring(1, c.length);
    if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
  }
  return null;
}

//disable functions based on cookie preference
var acceptCookies = readCookie('ce-cookie');
if (acceptCookies === "N") {
    $('body').css('visibility','visible');
    function setCookie() {
        return false;
    }
}
  
  
  
</script>
 
  <script src="//www.malwarebytes.com/js/global.js"></script>

  <script src="//www.malwarebytes.com/js/xs.js"></script>
  <script src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/js/search.js"></script>

<link rel="amphtml" href="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/amp/">
<script>
$(document).ready(function() {
  $("link[rel=amphtml]").each(function(){
    amphtml = $(this).attr("href");
    $(this).attr("href",amphtml.replace("/?amp","/amp"));
  });
});
</script>

<!-- New nav -->
  <link href="//www.malwarebytes.com/css/NEW-NAV.css" rel="stylesheet" type="text/css">
  <script src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/js/new-nav.js" type="text/javascript"></script>

  
</head>
<body>
<!-- Google Tag Manager -->
<noscript>
<iframe src="//www.googletagmanager.com/ns.html?id=GTM-MKSKW3"
height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MKSKW3');</script> 
<!-- End Google Tag Manager --> 

  
  

<!-- global nav -->
<nav id="mbnav" class="abtest">
    <div id="nav-background"></div>
    <div class="nav-container">
        <div class="logo">
            <a href="/" id="cta-navbar-company-logo-en-test">
                <!--<img src="https://blog.malwarebytes.com/wp-content/themes/labs.malwarebytes.org-1.7d/images/labs-log-w-tagline.svg" id="mb-labs-logo">-->
                <script>
                  $('document').ready(function () {
                    setTimeout(function () {
                      $('#main-logo, #logo-tagline').attr('class', 'changed');
                    }, 3000);
                    setTimeout(function () {
                      $('#main-logo, #logo-tagline').attr('class', '');
                    }, 7000);
                  })
                </script>

                <svg version="1.1" id="main-logo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="-672 235.9 278.5 31.1" style="enable-background:new -672 235.9 254.5 31.1;" xml:space="preserve" class="" aria-labelledby="malwarebytes-main-logo-title malwarebytes-main-logo-desc" role="img">
    <title id="malwarebytes-main-logo-title">The official Malwarebytes logo</title>
                    <desc id="malwarebytes-main-logo-desc">The official Malwarebytes logo in a blue font</desc>
                    <image src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/malwarebytes-labs-logo.png" xlink:href=""></image>
                    <style type="text/css">
                        .st0 {
                            fill: #0D3ECC !important;
                        }

                        .st1 {
                            fill: #414042;
                        }

                        .st2 {
                            fill: none;
                        }

                        .st3 {
                            enable-background: new;
                        }

                        .st4 {
                            fill: #FFFFFF;
                        }
                    </style>
                    <path id="logo-icon" class="st0" d="M-659.1,263.1C-659,263.1-659,263.1-659.1,263.1c0.3,0,0.4-0.2,0.4-0.4c0-0.2-0.1-0.3-0.3-0.4h-0.1h-0.2
  c-3.8-0.8-6.8-4.2-6.8-8.2c0-1.7,0.5-3.3,1.4-4.7c0.1-0.2,0.4-0.3,0.6-0.1l6.1,6.2c0.1,0.1,0.2,0.1,0.3,0.1s0.2,0,0.3-0.1l6.2-6.1
  c0.2-0.2,0.4-0.2,0.6,0c0.9,1.3,1.4,2.9,1.4,4.7c0,2.2-0.8,4.1-2.1,5.6c0,0-0.1,0.1-0.1,0.2v0.1c0,0.2,0.2,0.3,0.3,0.3l0,0
  c0,0,0.1,0,0.2-0.1c8.1-3.5,7.8-11.5,7.8-11.5c0-4.6-2.2-8.8-5.6-11.4c-0.2-0.1-0.4-0.1-0.5,0l-8.1,8.1c-0.2,0.2-0.4,0.2-0.5,0
  l-8.1-8.1c-0.1-0.1-0.4-0.2-0.5,0c-3.4,2.6-5.6,6.8-5.6,11.4l0,0C-672,256.2-666.3,262.3-659.1,263.1"></path>
                    <g id="logo-maintext">
                        <polygon class="st1" points="-446.9,260.3 -454.3,242.4 -461.7,260.4 -459.7,260.4 -458.3,256.8 -453.5,256.8 -457.4,254.5
    -454.3,246.9 -450.3,257.1 -453.8,257.1 -446.8,260.3   "></polygon>
                        <path class="st0" d="M-545.7,244L-545.7,244l-0.1-7.8c0-0.2-0.2-0.3-0.4-0.3l-2.2,0.3c-0.2,0-0.3,0.2-0.3,0.3v23.1
    c0,0.2,0.1,0.3,0.2,0.3c1.9,0.4,4.3,0.6,5.8,0.6c6.3,0,7.2-3,7.2-6.3v-6c0-3.5-1.6-5.3-4.9-5.3C-542.6,242.8-544.6,243.5-545.7,244
    z M-538.2,248v6.3c0,2.3-0.7,3.8-4.2,3.8c-1.2,0-2.3-0.1-3.4-0.2h-0.1v-11.3l0,0c1-0.5,3.1-1.3,4.7-1.3
    C-539.1,245.3-538.2,246.1-538.2,248z"></path>
                        <path class="st0" d="M-531.7,243.2h-2.1c-0.2,0-0.4,0.2-0.3,0.4l5.3,16.3c0,0.1,0.2,0.2,0.3,0.2h0.6c0.2,0,0.4,0.2,0.3,0.4
    l-2.1,6.1c-0.1,0.2,0.1,0.4,0.3,0.4h2c0.1,0,0.2-0.1,0.3-0.2l2.3-6.6l5.5-16.6c0.1-0.2-0.1-0.4-0.3-0.4h-2.1
    c-0.1,0-0.2,0.1-0.3,0.2l-4.4,13.8c-0.1,0.3-0.5,0.3-0.6,0l-4.4-13.8C-531.4,243.3-531.6,243.2-531.7,243.2z"></path>
                        <path class="st0" d="M-505.6,249.2v5.1c0,4.2,2.1,6.2,6.7,6.2c2,0,4.1-0.3,5.7-0.9c0.2,0,0.2-0.2,0.2-0.4l-0.3-1.6
    c0-0.2-0.2-0.3-0.4-0.2c-1.9,0.5-3.5,0.7-5,0.7c-3.5,0-4.1-1.3-4.1-3.8v-1.2c0-0.2,0.1-0.3,0.3-0.3h9.6c0.2,0,0.3-0.1,0.3-0.3v-3.2
    c0-4.3-2.1-6.4-6.3-6.4C-503.3,242.8-505.6,245-505.6,249.2z M-502.8,248.9c0-2.6,1.2-3.8,3.8-3.8s3.7,1.1,3.7,3.8v1.2
    c0,0.2-0.1,0.3-0.3,0.3h-6.9c-0.2,0-0.3-0.1-0.3-0.3L-502.8,248.9L-502.8,248.9z"></path>
                        <path class="st0" d="M-484.4,250.5c-2.9-0.7-3-1.1-3-3c0-1.6,0.4-2.2,2.9-2.2c1.2,0,2.9,0.2,4.3,0.4c0.2,0,0.4-0.1,0.4-0.3l0.2-1.7
    c0-0.2-0.1-0.3-0.2-0.3c-1.3-0.3-2.9-0.5-4.5-0.5c-4.2,0-5.8,1.2-5.8,4.5c0,3.5,0.4,4.4,4.6,5.4c3.4,0.8,3.6,1,3.6,2.9
    c0,1.8-0.4,2.4-3.2,2.4c-1.3,0-3.1-0.2-4.5-0.6c-0.2,0-0.4,0.1-0.4,0.2l-0.3,1.6c0,0.2,0.1,0.3,0.2,0.4c1.4,0.5,3.5,0.8,5.1,0.8
    c4.9,0,5.8-1.6,5.8-4.9C-479.2,252-479.8,251.6-484.4,250.5z"></path>
                        <g>
                            <path class="st0" d="M-613.7,259.9l-3-16.5c0-0.2,0.1-0.4,0.3-0.4h3.4c0.2,0,0.3,0.1,0.3,0.2l1.8,9.9c0,0.3,0.5,0.4,0.6,0l3-10
      c0-0.1,0.2-0.2,0.3-0.2h4c0.1,0,0.2,0.1,0.3,0.2l2.9,10c0.1,0.3,0.5,0.3,0.6,0l1.8-9.9c0-0.2,0.2-0.2,0.3-0.2h3.4
      c0.2,0,0.3,0.2,0.3,0.4l-3,16.5c0,0.2-0.2,0.2-0.3,0.2h-4.5c-0.1,0-0.2-0.1-0.3-0.2l-3.3-11c-0.1-0.3-0.5-0.3-0.6,0l-3.3,11
      c0,0.1-0.2,0.2-0.3,0.2h-4.5C-613.5,260.2-613.7,260.1-613.7,259.9z"></path>
                        </g>
                        <path class="st0" d="M-618.6,257c-1.5,0-2-0.7-2-2.6v-12.3v-4.9c0-0.2-0.2-0.3-0.4-0.3l-3.6,0.5c-0.2,0-0.3,0.2-0.3,0.3v0.2v4.2
    v12.8c0,3.9,2.4,5.6,5.5,5.6c0.3,0,1.5,0,2-0.1c0.2,0,0.3-0.2,0.3-0.3v-2.7c0-0.2-0.2-0.3-0.3-0.3C-617.8,257-618.3,257-618.6,257z
    "></path>
                        <g>
                            <path class="st0" d="M-566.9,246.8c-1.5,0.7-2.7,1.4-4.2,2.3c-0.1,0-0.2,0.2-0.2,0.3v10.5c0,0.2-0.1,0.3-0.3,0.3h-3.7
      c-0.2,0-0.3-0.1-0.3-0.3V244c0-0.2,0.1-0.3,0.2-0.3l3.1-0.5c0.2,0,0.3,0.1,0.4,0.2l0.2,1.1c0,0.2,0.3,0.3,0.5,0.2
      c0.9-0.6,2.5-1.5,3.7-1.9c0.2-0.1,0.4,0.1,0.4,0.3l0.4,3.3C-566.7,246.6-566.7,246.7-566.9,246.8z"></path>
                        </g>
                        <path class="st0" d="M-510,258.1c-1.7,0-1.8-0.8-1.8-2v-10.3c0-0.2,0.1-0.3,0.3-0.3h4c0.2,0,0.3-0.1,0.3-0.3l0.2-1.7
    c0-0.2-0.1-0.4-0.3-0.4h-4.2c-0.2,0-0.3-0.1-0.3-0.3v-3.9c0-0.2-0.2-0.3-0.4-0.3l-2.2,0.3c-0.2,0-0.3,0.2-0.3,0.3v3.7
    c0,0.2-0.1,0.3-0.3,0.3h-2.4c-0.2,0-0.3,0.1-0.3,0.3v1.7c0,0.2,0.1,0.3,0.3,0.3h2.4c0.2,0,0.3,0.1,0.3,0.3v10.8
    c0,2.7,1.2,3.8,4.2,3.8c0.7,0,1.3-0.1,2-0.2c0.2,0,0.2-0.2,0.2-0.3v-1.6c0-0.2-0.2-0.3-0.4-0.3C-509.1,258.1-509.5,258.1-510,258.1
    z"></path>
                        <path class="st2" d="M-557.3,246.2c-0.2,0-0.4,0-0.7,0c-2.1,0-2.8,1.1-2.8,2.7v1.5l0,0h5.4c0.2,0,0.3-0.1,0.3-0.3v-1.2
    C-555.1,247.4-555.7,246.4-557.3,246.2z"></path>
                        <path class="st0" d="M-554.5,243.3c-0.9-0.4-2.1-0.6-3.5-0.6c-1.6,0-3,0.3-4,0.8c-2.3,1.1-3.1,3.4-3.1,5.9v4.5c0,4,1.8,6.5,6.9,6.6
    c0.4,0,0.8,0,1.2,0c1.4,0,2.8-0.2,4.2-0.4c0.2,0,0.3-0.2,0.3-0.4v-0.2l-0.4-2.3l0,0c-1.3,0.1-2.4,0.2-3.7,0.2l0,0
    c-3.1,0-4.1-0.9-4.1-2.8V254l0,0v-0.8l0,0h9.2c0.2,0,0.3-0.1,0.3-0.3v-1.3v-2.1C-551.3,246.8-552,244.4-554.5,243.3z M-555.1,250.1
    c0,0.2-0.1,0.3-0.3,0.3h-5.4l0,0v-1.5c0-1.6,0.7-2.7,2.8-2.7c0.2,0,0.5,0,0.7,0c1.6,0.2,2.2,1.3,2.2,2.7V250.1z"></path>
                        <path class="st0" d="M-635.8,242.8c-1.5,0-3.1,0.1-4.5,0.3c-0.2,0-0.3,0.2-0.2,0.4l0.4,2.6c0,0.2,0.2,0.3,0.3,0.3
    c1.4-0.2,2.3-0.2,3.7-0.2c3.1,0,4.1,0.9,4.1,2.8v1.1c0,0.2-0.1,0.3-0.3,0.3h-4c-3.5,0-5.5,1.8-5.5,5c0,3,2.3,5.1,5.7,5.1
    c2.2,0,3-0.3,3.7-1c0.2-0.2,0.5,0,0.5,0.2v0.2c0,0.2,0.1,0.3,0.3,0.3h3.4c0.2,0,0.3-0.1,0.3-0.3V249
    C-627.9,244.8-630.8,242.8-635.8,242.8z M-632.1,253.8c0,2.1-1.5,3.6-3.7,3.6c-1.8,0-2.7-0.7-2.7-2.1c0-1.5,0.9-2.1,2.7-2.1h3.4
    c0.2,0,0.3,0.1,0.3,0.3V253.8z"></path>
                        <path class="st0" d="M-586.4,242.8c-1.5,0-3.1,0.1-4.5,0.3c-0.2,0-0.3,0.2-0.2,0.4l0.4,2.6c0,0.2,0.2,0.3,0.3,0.3
    c1.4-0.2,2.3-0.2,3.7-0.2c3.1,0,4.1,0.9,4.1,2.8v1.1c0,0.2-0.1,0.3-0.3,0.3h-4c-3.5,0-5.5,1.8-5.5,5c0,3,2.3,5.1,5.7,5.1
    c2.2,0,3-0.3,3.7-1c0.2-0.2,0.5,0,0.5,0.2v0.2c0,0.2,0.1,0.3,0.3,0.3h3.5c0.2,0,0.3-0.1,0.3-0.3V249
    C-578.4,244.8-581.4,242.8-586.4,242.8z M-582.7,253.8c0,2.1-1.5,3.6-3.7,3.6c-1.8,0-2.7-0.7-2.7-2.1c0-1.5,0.9-2.1,2.7-2.1h3.4
    c0.2,0,0.3,0.1,0.3,0.3C-582.7,253.5-582.7,253.8-582.7,253.8z"></path>
                        <path class="st1" d="M-424,260.4c-2.2,0-4.6-0.5-6.9-1.4l0.5-1.8c2.1,0.7,4.4,1.2,6.3,1.2c2.7,0,4.3-1.1,4.3-2.6
    c0-1.3-0.8-2-4.7-3.5c-4.4-1.6-5.9-2.8-5.9-5.4c0-2.8,2.3-4,6.4-4c1.8,0,4.3,0.3,6,0.9l-0.4,1.8c-1.7-0.4-3.7-0.7-5.5-0.7
    c-3,0-4.2,0.5-4.2,2c0,1.6,1.1,2.2,5.1,3.7c4.4,1.7,5.5,2.7,5.5,5.1C-417.4,258.5-420,260.4-424,260.4z"></path>
                        <g>
                            <path class="st1" d="M-462.7,260.3h-7.5c-1,0-1.6-0.4-1.9-0.7c-0.6-0.7-0.6-1.5-0.6-1.8v-15h1.8V258c0,0.1,0,0.3,0.1,0.4
      c0.1,0.1,0.4,0.2,0.5,0.2h7.5L-462.7,260.3L-462.7,260.3z"></path>
                        </g>
                        B <path class="st1" d="M-432.2,255.4c0-2.1-1-3.8-3.1-4.6c1.3-0.7,2.3-2,2.3-3.8c0-2.6-2-4.1-5.5-4.1h-7v14.5l0,0v0.4
    c0,0.2,0,1.1,0.6,1.8c0.3,0.4,0.9,0.7,1.9,0.7h4.9h0.1l0,0h0.3l0,0C-433.9,260.2-432.2,258-432.2,255.4z M-443.6,244.6h5.1
    c2.5,0,3.7,0.8,3.7,2.6s-1.2,3-3.5,3h-5.3L-443.6,244.6L-443.6,244.6z M-436.8,258.5h-6.2c-0.2,0-0.4,0-0.5-0.2
    c-0.1-0.1-0.1-0.4-0.1-0.4v-6h5.9c2.5,0,3.7,1.5,3.6,3.4C-434.2,257-435.1,258.2-436.8,258.5z"></path>
                    </g>
    </svg>
                <p id="logo-tagline" class="">We research. You level up.</p>
            </a>
        </div>
        <div id="mb-nav-icon" type="button" data-target="#navbar" data-toggle="collapse" role="button" aria-label="Open mobile menu" tabindex="0" aria-pressed="true" aria-haspopup="true" aria-expanded="false" aria-controls="navbar">&nbsp;
            <span class="firstline">&nbsp;</span>
            <span class="secondline">&nbsp;</span>
            <span class="thirdline">&nbsp;</span>
        </div>
        <div id="main-nav-menu">
            <div id="main-top-nav">
                <div class="navitem has-dropdown" data-submenu="personal-nav" tabindex="0" aria-haspopup="true" >
                    <span>Personal</span>
                    <div class="submenu">
                        <div class="submenu-container submenu-container-full">
                            <div class="submenu-box divider" role="menuitem">
                                <a href="javascript:void(0)"  data-submenu="personal-nav" tabindex="-1" class="main-nav-item nav-back-link"><span class="back-arrow"></span> Personal</a>
                                <div class="submenu-content">
                                    <ul>
                                        <li class="title" role="none">Security & Antivirus</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/premium/" id="cta-navbar-windows-en-test" tabindex="-1">Malwarebytes for Windows</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/mac/" id="cta-navbar-mac-en-test" tabindex="-1">Malwarebytes for Mac</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/chromebook/" id="cta-navbar-chromebook-en-test" tabindex="-1">Malwarebytes for Chromebook</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/browserguard/" id="cta-navbar-browserguard-en-test" tabindex="-1">Malwarebytes Browser Guard</a></li>
                                        <li role="none"><a href="//www.malwarebytes.com/for-home/" id="cta-press-navbar-forhome-en-test" class="bold-link" tabindex="-1">Overview <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="submenu-box divider">
                                <div class="submenu-content">
                                    <ul>
                                        <li class="title" role="none">Security & Antivirus for Mobile</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/android/" id="cta-navbar-android-en-test" tabindex="-1">Malwarebytes for Android</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/ios/" id="cta-navbar-ios-en-test" tabindex="-1">Malwarebytes for iOS</a></li>

                                        <li class="title" role="none">Online Privacy</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/vpn/" id="cta-navbar-malwarebytes-privacy-en-test" tabindex="-1">Malwarebytes Privacy VPN</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="submenu-box divider">
                                <div class="submenu-content submenu-gradient">
                                    <ul>
                                        <li class="title" role="none">Get Started</li>
                                        <li role="none">
                                            <a href="//www.malwarebytes.com/for-home/products/" id="cta-navbar-viewall-en-test" class="bold-link" tabindex="-1">
                                                <img class="link-icon" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/icons/personal-icon.svg" alt="Personal Icon">
                                                Explore all Personal Products
                                            </a>
                                        </li>
                                        <li role="none">
                                            <a href="//www.malwarebytes.com/pricing/" id="cta-navbar-pricing-en-test" class="bold-link" tabindex="-1">
                                                <img class="link-icon" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/icons/pricing-icon.svg" alt="Pricing Icon">
                                                Explore Pricing
                                            </a>
                                        </li>
                                        <li role="none">
                                            <a id="cta-navbar-freedownload-personaldropdown-en-test" href="//www.malwarebytes.com/mwb-download/thankyou/" class="free-download link-box" tabindex="-1">
                                                <div>
                                                    <h4>Free Trial of Malwarebytes Premium</h4>
                                                    <p>Protect your devices, your data, and your privacy—at home or on the go.</p>
                                                    <span class="cta-text">Get free trial <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></span>
                                                </div>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="navitem has-dropdown" data-submenu="business-nav" tabindex="0">
                    <span>Business</span>
                    <div id="business-nav" class="submenu">
                        <div class="submenu-container submenu-container-full">
                            <div class="submenu-box divider">
                                <a href="javascript:void(0)" data-submenu="business-nav" tabindex="-1" class="main-nav-item nav-back-link"><span class="back-arrow"></span> Business</a>
                                <div class="submenu-content">
                                    <ul>
                                        <li class="title" role="none">Security & Antivirus</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/cloud/" id="cta-navbar-forbusiness-nebula-en-test" tabindex="-1">Malwarebytes Nebula - Cloud Hosted Security Platform</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/endpoint-protection/" id="cta-navbar-forbusiness-ep-en-test" tabindex="-1">Malwarebytes Endpoint Protection</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/edr/" id="cta-navbar-forbusiness-edr-en-test" tabindex="-1">Malwarebytes Endpoint Detection & Response</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/incident-response/" id="cta-navbar-forbusiness-ir-en-test" tabindex="-1">Malwarebytes Incident Response</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/crowdstrike/" id="cta-navbar-forbusiness-crowdstrike-en-test" tabindex="-1">Malwarebytes Remediation for CrowdStrike</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/teams/" id="cta-navbar-forbusiness-teams-en-test" tabindex="-1">Malwarebytes for Teams</a></li>
                                        <li class="title" role="none">Services</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/services/malware-removal/" id="cta-navbar-forbusiness-malwareremovalservice-en-test" tabindex="-1">Malwarebytes Malware Removal</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="submenu-box divider">
                                <div class="submenu-content">
                                    <ul>
                                        <li class="title" role="none">Server Protection</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/endpoint-protection/server-security/" id="cta-navbar-forbusiness-ep-server-security-en-test" tabindex="-1">Malwarebytes Endpoint Protection for Servers</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/edr/server-security/" id="cta-navbar-forbusiness-edr-server-security-en-test" tabindex="-1">Malwarebytes Endpoint Detection and Response for Servers</a></li>

                                        <li class="title" role="none">Solutions</li>
                                        <li class="subtitle" role="none">BUSINESS SOLUTIONS</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/solutions/small-business/" id="cta-navbar-forbusiness-solutions-small-business-en-test" tabindex="-1">Small Business Antivirus</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/solutions/mid-market/" id="cta-navbar-forbusiness-solutions-mid-market-en-test" tabindex="-1">Secure Remote Workers</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/solutions/enterprise/" id="cta-navbar-forbusiness-solutions-enterprise-en-test" tabindex="-1">Enterprise Antivirus and Cybersecurity</a></li>

                                        <li class="subtitle" role="none">INDUSTRY SOLUTIONS</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/education/" id="cta-navbar-forbusiness-education-en-test" tabindex="-1">Education</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/finance/" id="cta-navbar-forbusiness-finance-en-test" tabindex="-1">Finance</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/healthcare/" id="cta-navbar-forbusiness-healthcare-en-test" tabindex="-1">Healthcare</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="submenu-box divider">
                                <div class="submenu-content submenu-gradient">
                                    <ul>
                                        <li class="title" role="none">Get Started</li>
                                        <li role="none">
                                            <a href="//www.malwarebytes.com/business/" id="cta-navbar-forbusiness-en-test" class="bold-link" tabindex="-1">
                                                <img class="link-icon" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/icons/business-icon.svg" alt="Business Icon">
                                                Explore all Business Products
                                            </a>
                                        </li>
                                        <li role="none">
                                            <a href="//www.malwarebytes.com/pricing/business/" id="cta-navbar-forbusiness-pricing-en-test" class="bold-link" tabindex="-1">
                                                <img class="link-icon" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/icons/pricing-icon.svg" alt="Pricing Icon">
                                                Explore Pricing
                                            </a>
                                        </li>
                                        <li role="none">
                                            <a id="cta-navbar-businesstrial-businessdropdown-en-test" href="//www.malwarebytes.com/business/request_trial/?ref=nav" class="link-box" tabindex="-1">
                                                <div class="biz">
                                                    <h4>Get a Free Trial</h4>
                                                    <p>Secure your endpoints and servers with industry-leading protection, detection, and response solutions.</p>
                                                    <span class="cta-text">Get Started <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></span>
                                                </div>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="navitem" tabindex="0">
                    <a href="//www.malwarebytes.com/pricing/" class="pricing-link" id="cta-navbar-pricing-en-test" ><span>Pricing</span></a>
                </div>
                <div class="navitem has-dropdown" data-submenu="partners-nav" tabindex="0">
                    <span>Partners</span>
                    <div id="partner-nav" class="submenu">
                        <div class="submenu-container">
                            <div class="submenu-box"></div>
                            <div class="submenu-box divider">
                                <a  href="javascript:void(0)" data-submenu="partner-nav" tabindex="-1" class="main-nav-item nav-back-link"><span class="back-arrow"></span> Partners</a>
                                <div class="submenu-content">
                                    <div class="submenu-content submenu-gradient">
                                        <ul>
                                            <li role="none">
                                                <a href="//www.malwarebytes.com/partners/" id="cta-navbar-partners-explore-partnerships-en-test" class="bold-link" tabindex="-1">
                                                    <img class="link-icon" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/icons/partner-icon.svg" alt="Partner Icon">
                                                    Explore Partnerships
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <ul class="submenu-content divider-top">
                                        <li class="title" role="none">Partner Solutions</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/partners/solution-providers/" id="cta-navbar-partners-solution-providers-en-test" tabindex="-1">Resellers</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/partners/managed-service-providers/" id="cta-navbar-partners-managed-service-providers-en-test" tabindex="-1">Managed Service Providers</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/techbench/" id="cta-navbar-partners-computer-repair-en-test" tabindex="-1">Computer Repair</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/integrations/" id="cta-navbar-partners-tech-partnerships-en-test" tabindex="-1">Technology Partners</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="submenu-box divider">
                                <div class="submenu-content submenu-gradient">
                                    <ul>
                                        <li class="title" role="none">Partner Success Story</li>
                                        <li class="partner-highlight" role="none">
                                            <div>
                                                <img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/partners/optimus-systems.webp" onerror='this.onerror = null; this.src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/partners/optimus-systems.png"' alt="Optimus Systems Logo">
                                            </div>
                                            <div class="name">Marek Drummond</div>
                                            <div class="position">Managing Director at Optimus Systems</div>
                                            <p>"Thanks to the Malwarebytes MSP program, we have this high-quality product in our stack. It’s a great addition, and I have confidence that customers’ systems are protected."</p>
                                        </li>
                                        <li role="none"><a href="https://resources.malwarebytes.com/casestudy/optimus-systems-delivers-trusted-desktop-security-services-malwarebytes-managed-services-provider/" id="cta-navbar-partners-featured-optimus-en-test" class="bold-link" tabindex="-1">See full story <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="navitem has-dropdown" data-submenu="resources-nav" tabindex="0">
                    <span>Resources</span>
                    <div id="resources-nav" class="submenu">
                        <div class="submenu-container submenu-container-full">
                            <div class="submenu-box divider">
                                <a  href="javascript:void(0)" data-submenu="resources-nav" tabindex="-1" class="main-nav-item nav-back-link"><span class="back-arrow"></span> Resources</a>
                                <div class="submenu-content">
                                    <ul>
                                        <li class="title" role="none">Learn About Cybersecurity</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/antivirus/" id="cta-navbar-resources-antivirus-en-test" tabindex="-1">Antivirus</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/malware/" id="cta-navbar-resources-malware-en-test" tabindex="-1">Malware</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/ransomware/" id="cta-navbar-resources-ransomware-en-test" tabindex="-1">Ransomware</a></li>
                                        <li role="none"><a href="//www.malwarebytes.com/cybersecurity/" id="cta-navbar-resources-pillarhub-en-test" class="bold-link" tabindex="-1">See all <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></a></li>

                                        <li class="title" role="none">Malwarebytes Labs</li>
                                        <li role="none"><a href="https://blog.malwarebytes.com/" id="cta-navbar-resources-blog-en-test" class="bold-link" tabindex="-1">Explore <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="submenu-box divider">
                                <div class="submenu-content">
                                    <ul>
                                        <li class="title" role="none">Business Resources</li>
                                        <li class="link" role="none"><a href="https://resources.malwarebytes.com/#reviews" id="cta-navbar-resources-reviews-en-test" tabindex="-1">Reviews</a></li>
                                        <li class="link" role="none"><a href="https://resources.malwarebytes.com/#analyst-reports" id="cta-navbar-resources-analyst-reports-en-test" tabindex="-1">Analyst Reports</a></li>
                                        <li class="link" role="none"><a href="https://resources.malwarebytes.com/casestudies/" id="cta-navbar-resources-casestudies-en-test" tabindex="-1">Case Studies</a></li>
                                        <li role="none"><a href="https://resources.malwarebytes.com/" id="cta-navbar-resources-viewall-en-test" class="bold-link" tabindex="-1">See all <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></a></li>

                                        <li class="title" role="none">Press & News</li>
                                        <li role="none"><a href="https://press.malwarebytes.com/" id="cta-navbar-resources-news-press-en-test" class="bold-link" tabindex="-1">Learn more <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="submenu-box divider">
                                <div class="submenu-content submenu-gradient">
                                    <ul>
                                        <li class="title" role="none">Events</li>
                                        <li>
                                            <img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/rsa2021.jpg" alt="RSA 2021" width="250px">
                                            <br><br>
                                            <p><span class="title">Featured Event:</span> RSA 2021</p>
                                        </li>
                                        <li role="none"><a href="https://www.rsaconference.com/usa" id="cta-navbar-resources-featured-rsa-en-text" class="bold-link" tabindex="-1">See Event <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="navitem has-dropdown" data-submenu="support-nav" tabindex="0">
                    <span>Support</span>
                    <div id="support-nav" class="submenu">
                        <div class="submenu-container">
                            <div class="submenu-box"></div>
                            <div class="submenu-box divider">
                                <a href="javascript:void(0)" data-submenu="support-nav" tabindex="-1" class="main-nav-item nav-back-link"><span class="back-arrow"></span> Support</a>
                                <div class="submenu-content">
                                    <ul class="submenu-content">
                                        <li class="title" role="none">Technical Support</li>
                                        <li class="link" role="none"><a href="https://support.malwarebytes.com/hc/en-us" id="cta-navbar-support-en-test" tabindex="-1">Support</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/services/" id="cta-navbar-support-business_services-en-test" tabindex="-1">Premium Services</a></li>
                                        <li class="link" role="none"><a href="https://forums.malwarebytes.com/" id="cta-navbar-support-forum-en-test" tabindex="-1">Forums</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/secure/" id="cta-navbar-support-vulnerability_disclosure-en-test" tabindex="-1">Vulnerability Disclosure</a></li>
                                    </ul>
                                    <div class="submenu-content submenu-gradient divider-top">
                                        <ul>
                                            <li role="none">
                                                <a href="https://www.youtube.com/channel/UCB7JQhkZpiyvGPufW2RPBoQ" id="cta-navbar-support-support_services-en-test" class="bold-link" tabindex="-1">
                                                    <img class="link-icon" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/icons/watch-personal-icon.svg" alt="Watch Icon">
                                                    Training for Personal Products
                                                </a>
                                            </li>
                                            <li role="none">
                                                <a href="//www.malwarebytes.com/business/academy/" id="cta-navbar-support-training_for_business-en-test" class="bold-link" tabindex="-1">
                                                    <img class="link-icon" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/icons/watch-business-icon.svg" alt="Watch Icon">
                                                    Training for Business Products
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="submenu-box divider">
                                <div class="submenu-content">
                                    <ul class="submenu-content submenu-gradient">
                                        <li class="title" role="none">Featured Content</li>
                                        <li role="none">
                                            <img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/privacy.svg" alt="Privacy Logo">
                                            <br>
                                            <br>
                                            <p>Activate Malwarebytes Privacy on Windows device.</p>
                                        </li>
                                        <li role="none"><a href="https://support.malwarebytes.com/hc/en-us/articles/360046199873-Activate-Malwarebytes-Privacy-on-Windows-device" id="cta-navbar-support-privacy_activation-en-test" class="bold-link" tabindex="-1">See Content <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                  <a id="cta-navbar-freedownload-main-en-test" href="//www.malwarebytes.com/mwb-download/thankyou/" class="free-download nav-download-btn">FREE DOWNLOAD</a>
                </div>
            </div>
            <div id="main-util-nav">
                <div class="navitem-caps">
                    <a href="//www.malwarebytes.com/contact/" id="cta-navbar-company-contactus-en-test">CONTACT US</a>
                </div>
                <div class="navitem-caps has-dropdown" data-submenu="company-nav" tabindex="0">
                    <span>COMPANY</span>
                    <div id="company-nav" class="submenu">
                        <div class="submenu-container">
                            <div class="submenu-box">
                                <a href="javascript:void(0)" data-submenu="company-nav" tabindex="-1" class="main-nav-item nav-back-link"><span class="back-arrow"></span> Company</a>
                                <ul>
                                    <li class="link" role="none"><a href="//www.malwarebytes.com/company/" id="cta-utilbar-company-aboutus-en-test" tabindex="-1">About Malwarebytes</a></li>
                                    <li class="link" role="none"><a href="https://jobs.malwarebytes.com/" id="cta-utilbar-company-careers-en-test" tabindex="-1">Careers</a></li>
                                    <li class="link" role="none"><a href="https://press.malwarebytes.com/" id="cta-utilbar-company-news-press-en-test" tabindex="-1">News & Press</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="navitem-caps has-dropdown" data-submenu="signin-nav" tabindex="0">
                    <span>SIGN IN</span>
                    <div id="signin-nav" class="submenu">
                        <div class="submenu-container">
                            <div class="submenu-box">
                                <a href="javascript:void(0)" data-submenu="signin-nav" tabindex="-1" class="main-nav-item nav-back-link"><span class="back-arrow"></span> Sign In</a>
                                <ul>
                                    <li class="link" role="none">
                                        <a href="https://my.malwarebytes.com/en/login/" id="cta-utilbar-login-myaccount-en-test" tabindex="-1">My Account</a>
                                    </li>
                                    <li class="link" role="none">
                                        <a href="https://cloud.malwarebytes.com/" id="cta-utilbar-login-cloud-console-en-test" tabindex="-1">Cloud Console</a>
                                    </li>
                                    <li class="link">
                                        <a href="https://partners.malwarebytes.com/English/" id="cta-utilbar-partner-portal-en-test">Partner Portal</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</nav>

<div id="labs-sub-nav">
    <div class="container">
        <div class="row">
            <div class="col-md-4 col-xs-6" id="search-section">
                <form id="search-form" onsubmit="submitSearchrightrail(event)" method="get">
                    <div class="searchbar-wrap-rightrail">
                        <label for="cta-labs-rightrail-search-submit-en" aria-label="cta-labs-rightrail-search-submit-en" aria-labelledby="cta-labs-rightrail-search-submit-en">
                            <input type="text" id="st-search-input-rightrail" class="st-search-input-rightrail"
                            placeholder="Search Labs" />
                        </label>
                        <button type="submit" id="cta-labs-rightrail-search-submit-en" aria-label="Submit your search query" /><span class=""><img
                                src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/search.svg" alt="Magnifying glass"></span>
                    </div>

                </form>
            </div>
            <div class="col-md-offset-4 col-md-4 col-xs-6" id="social">
                <div class="left col-lg-6 col-md-8 col-sm-7">
                    <a href="https://www.malwarebytes.com/newsletter/?email=&source=labs"
                        class="subscribe-btn">SUBSCRIBE</a>
                    <a href="https://blog.malwarebytes.com/feed/" target="_blank" class="socicon-rss" aria-label="Subscribe to Malwarebytes Labs RSS Feed"></a>
                </div>
                <div class="right col-lg-5 col-md-4 col-sm-4 col-xs-9">
                    <a class="social socicon-facebook" href="https://www.facebook.com/Malwarebytes/"
                        id="social-follow-facebook" target="_blank" aria-label="Visit Malwarebytes on Facebook"></a>
                    <a class="social socicon-twitter" href="https://twitter.com/malwarebytes" id="social-follow-twitter"
                        target="_blank" aria-label="Visit Malwarebytes on Twitter"></a>
                    <a class="social socicon-linkedin" href="https://www.linkedin.com/company/malwarebytes"
                        id="social-follow-linkedin" target="_blank" aria-label="Visit Malwarebytes on LinkedIn"></a>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">  
  $(function () {

    var navlinks = document.getElementsByClassName('has-dropdown');
    var mainNav = document.getElementById('main-nav-menu');
    var navBackLinks = document.getElementsByClassName('nav-back-link');
    var currentOpenNav = null;

    window.isMac = navigator.platform.match(/(Mac)/i) ? true : false;
    window.isWindows = navigator.userAgent.match(/(Windows)/i) ? true : false;
    window.isAndroid = navigator.userAgent.match(/(Android)/i) ? true : false;
    window.isiPhone = navigator.platform.match(/(iPhone)/i) ? true : false;
    window.isiPad = navigator.platform.match(/(iPad)/i) ? true : false;
    window.isChromeOS = (/\bCrOS\b/.test(navigator.userAgent)) ? true : false;

    var freeDownloadLinkElms = document.getElementsByClassName('free-download');
    var freeDownloadLink = "https://www.malwarebytes.com/mwb-download/thankyou/";

    if (isMac == true) {
      freeDownloadLink = "https://www.malwarebytes.com/mac-download/";
    }
    else if (isiPad || isiPhone) {
      freeDownloadLink = "https://go.onelink.me/app/633d1f14";
    }
    else if (isAndroid) {
      freeDownloadLink = "https://go.onelink.me/app/516cebeb";
    }
    else if (isChromeOS) {
      freeDownloadLink = "https://go.onelink.me/app/fe20dca8";
    }

    for(var i=0; i < freeDownloadLinkElms.length; i++) {
      freeDownloadLinkElms[i].setAttribute('href', freeDownloadLink);
    }

    var outsideClickClose = function(e) {
      closeNav(currentOpenNav);
    };

    var openNav = function(newNav, currentNav) {
      closeNav(currentNav);
      newNav.classList.add('open');
      var subMenu = newNav.getElementsByClassName('submenu')[0];
      if(isSubmenuTooLong(subMenu)) {
        subMenu.classList.add('submenu-scroll');
      } else {
        subMenu.classList.remove('submenu-scroll');
      }
      window.addEventListener('click', outsideClickClose);
      return newNav;
    };

    var isSubmenuTooLong = function(subMenuElm) {
      var subMenuContainer = subMenuElm.getElementsByClassName('submenu-container')[0];
      var subMenuContainerHeight = subMenuContainer.offsetHeight;
      var windowHeightMinusNav = window.innerHeight - 100;
      if(windowHeightMinusNav < subMenuContainerHeight) {
        return true;
      }
      return false;
    }

    var closeNav = function(currentNav) {
      if(!currentNav) return;
      window.removeEventListener('click', outsideClickClose);
      currentNav.classList.remove('open');
      currentNav.blur();
      currentOpenNav = null;
    };

    for(var i=0; i < navlinks.length; i++) {
      var navItem = navlinks[i];

      navItem.addEventListener('click', function(event) {
        event.stopPropagation();

        if(currentOpenNav && this.dataset.submenu === currentOpenNav.dataset.submenu) return;

        console.log('click');
        currentOpenNav = openNav(this, currentOpenNav);

      });

    };

    for(var i=0; i < navBackLinks.length; i++) {
      var navBackItem = navBackLinks[i];

      navBackItem.addEventListener('click', function(event) {
        event.stopPropagation();
        console.log('back click');
        closeNav(currentOpenNav);
      });
    }

    document.getElementById('mb-nav-icon').addEventListener('click', function(e) {

      if(this.classList.contains('open')) {
        document.documentElement.style.overflow = null;
        this.classList.remove('open');
        mainNav.classList.remove('open');
        closeNav(currentOpenNav);
      } else {
        document.documentElement.style.overflow = 'hidden';
        this.classList.add('open');
        mainNav.classList.add('open');
      }

    });

    var b2bRegex = /^\/business\/|^\/pricing\/business\/|^\/education\/|^\/finance\/|^\/healthcare\/|^\/partners\//;

    if(b2bRegex.test(window.location.pathname)){
      $('.pricing-link').attr('href', '/pricing/business/');
    }

  })
</script>
 

 
<!--
Start of DoubleClick Floodlight Tag: Please do not remove
Activity name of this tag: security blog articles
URL of the webpage where the tag is expected to be placed: https://blog.malwarebytes.com/
This tag must be placed between the <body> and </body> tags, as close as possible to the opening tag.
Creation Date: 05/20/2016
-->
<script type="text/plain" class="optanon-category-4">
var axel = Math.random() + "";
var a = axel * 10000000000000;
$('body').append('<iframe src="https://5118230.fls.doubleclick.net/activityi;src=5118230;type=count0;cat=secur00;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;ord=1;num=' + a + '?" width="1" height="1" frameborder="0" style="display:none"></iframe>');
</script>
<noscript>
<iframe src="https://5118230.fls.doubleclick.net/activityi;src=5118230;type=count0;cat=secur00;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;ord=1;num=1?" width="1" height="1" frameborder="0" style="display:none"></iframe>
</noscript>
<!-- End of DoubleClick Floodlight Tag: Please do not remove -->


<div class="wrapper" id="post">
           

  
  
<article id="single-post" class="h-entry">
  <section>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "NewsArticle",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://google.com/article"
  },
  "headline": "The Hidden Bee infection chain, part 1: the stegano pack",
  "image": {
    "@type": "ImageObject",
    "url": "https://blog.malwarebytes.com/wp-content/uploads/2019/08/shutterstock_1341482126-604x270.jpg",
    "height": 405,
    "width": 720
  },
  "datePublished": "August 15, 2019",
  "dateModified": "August 18, 2019",
  "author": {
    "@type": "Person",
    "name": "hasherezade"
  },
   "publisher": {
    "@type": "Organization",
    "name": "Malwarebytes",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.malwarebytes.com/images/mb-logo-2.png",
      "width": 600,
      "height": 60
    }
  },
  "description": "The Hidden Bee cryptominer has a complex and multi-layered internal structure that is unusual among cybercrime toolkits. That&#039;s why we&#039;re dedicating a series of posts to exploring its elements and updates made during one year of its evolution. "
}
</script>

<div class="container">
  <div class="row">

    <div class="col-md-8" id="content">
      <div>
          <P><img src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/shutterstock_1341482126-900x506.jpg" alt="The Hidden Bee infection chain, part 1: the stegano pack"></P>
            <p class="breadcrumbs hidden-xs"><a href="https://blog.malwarebytes.com/category/threat-analysis/" rel="category tag">Threat analysis</a></p>
       <h1 class="entry-title p-name">
					The Hidden Bee infection chain, part 1: the stegano pack				</h1>
      <p class="small">Posted: <span class="published"><time class="dt-published" datetime="August 15, 2019">August 15, 2019</time></span> by <span class="vcard author p-author h-card"><a href="https://blog.malwarebytes.com/author/hasherezade/" title="Posts by hasherezade" rel="author">hasherezade</a></span> 
       
       <!-- shows last modified date if modified from original post -->
        <br>Last updated: <span class='updated'><time class='dt-updated' datetime='August 18, 2019'>August 18, 2019</time></span>        
      </p>
      <div class="entry-summary p-summary" style="display:none;">The Hidden Bee cryptominer has a complex and multi-layered internal structure that is unusual among cybercrime toolkits. That's why we're dedicating a series of posts to exploring its elements and updates made during one year of its evolution. </div>
           <div class="post-content entry-content e-content" id="articleBody" itemprop="articleBody"> 
<p>About a year ago, <a rel="noreferrer noopener" aria-label="we described Hidden Bee miner delivered by the Underminer Exploit Kit (opens in a new tab)" href="https://blog.malwarebytes.com/threat-analysis/2018/07/hidden-bee-miner-delivered-via-improved-drive-by-download-toolkit/" target="_blank">we described the Hidden Bee miner delivered by the Underminer Exploit Kit</a>. </p>



<p>Hidden Bee has a complex and multi-layered internal structure that is unusual among cybercrime toolkits, making it an interesting phenomenon on the threat landscape. That&#8217;s why we&#8217;re dedicating a series of posts to exploring particular elements and updates made during one year of its evolution. </p>



<p>Recently, we decided to revisit this interesting miner, <a rel="noreferrer noopener" href="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/" target="_blank">describing its loader</a> that starts the infection from a single malicious executable. This post will present an alternative loader that is deployed when the infection starts from the Underminer Exploit Kit. It is analogous to the loader we described in the following posts from 2018: [<a rel="noreferrer noopener" href="https://blog.malwarebytes.com/threat-analysis/2018/07/hidden-bee-miner-delivered-via-improved-drive-by-download-toolkit/" target="_blank">1</a>] and [<a rel="noreferrer noopener" href="https://blog.malwarebytes.com/threat-analysis/2018/08/reversing-malware-in-a-custom-format-hidden-bee-elements/" target="_blank">2</a>]. </p>



<h3 id="mce_22">The dropped payloads: an overview</h3>



<p>The first time we spotted Hidden Bee, it started the infection from a flash exploit. It downloaded and injected two elements with WASM extensions that in reality were executable modules in a custom format. We described them in detail <a rel="noreferrer noopener" aria-label="here (opens in a new tab)" href="https://blog.malwarebytes.com/threat-analysis/2018/08/reversing-malware-in-a-custom-format-hidden-bee-elements/" target="_blank">here</a>. </p>



<figure class="wp-block-image"><img data-attachment-id="39999" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/queried_urls_-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/queried_urls_.png" data-orig-size="780,58" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="queried_urls_" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/queried_urls_-300x22.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/queried_urls_-600x45.png" loading="lazy" width="780" height="58" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/queried_urls_.png" alt="" class="wp-image-39999" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/queried_urls_.png 780w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/queried_urls_-300x22.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/queried_urls_-600x45.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/queried_urls_-767x58.png 767w" sizes="(max-width: 780px) 100vw, 780px" /><figcaption>The files with WASM extensions, observed a year ago</figcaption></figure>



<p>Those elements were the initial loaders, responsible for initiating <a rel="noreferrer noopener" aria-label="the infection chain, that at the end resulted in installing the miner (opens in a new tab)" href="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/" target="_blank">the infection chain that at the end installed the miner</a>.</p>



<p>Nowadays, those elements have changed. If we take a look at the elements dropped by the same EK today, we will no longer find those WASM extensions. Instead, we encounter various multimedia files: a WAV (alternatively two WAVs), a JPEG, and a PNG. </p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/08/download_png.png" data-rel="lightbox-image-0" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="39866" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/download_png/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/download_png.png" data-orig-size="780,194" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="download_png" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/download_png-300x75.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/download_png-600x149.png" loading="lazy" width="780" height="194" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/download_png.png" alt="" class="wp-image-39866" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/download_png.png 780w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/download_png-300x75.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/download_png-600x149.png 600w" sizes="(max-width: 780px) 100vw, 780px" /></a><figcaption>The elements downloaded nowadays: WAV, JPG, PNG</figcaption></figure>



<p>The WAV files are downloaded by iexplore.exe, the browser where the exploit is run. In contrast, the images are downloaded at later stages of infection. For example, the JPG is always downloaded from the dllhost.exe process. The PNG is often downloaded from yet another process.</p>



<p>In some runs, we observed the PNG to be downloaded instead of the JPG:</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/05/dropped_payloads2.png" target="_blank" rel="noreferrer noopener" data-rel="lightbox-image-1" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="38761" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/dropped_payloads2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/dropped_payloads2.png" data-orig-size="959,122" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="dropped_payloads2" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/dropped_payloads2-300x38.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/dropped_payloads2-600x76.png" loading="lazy" width="959" height="122" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/dropped_payloads2.png" alt="" class="wp-image-38761" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/dropped_payloads2.png 959w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/dropped_payloads2-300x38.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/dropped_payloads2-600x76.png 600w" sizes="(max-width: 959px) 100vw, 959px" /></a><figcaption>Alternative: PNG being downloaded after WAV</figcaption></figure>



<p>We will start our journey of Hidden Bee analysis by looking at these files. Then, we will move to see the code responsible for processing them in order to reveal their hidden purpose.</p>



<p>The roadmap of the full described package:</p>



<figure class="wp-block-image"><img data-attachment-id="40119" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/steganopack_diag/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/steganopack_diag.png" data-orig-size="641,803" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="steganopack_diag" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/steganopack_diag-239x300.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/steganopack_diag-479x600.png" loading="lazy" width="641" height="803" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/steganopack_diag.png" alt="" class="wp-image-40119" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/steganopack_diag.png 641w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/steganopack_diag-239x300.png 239w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/steganopack_diag-479x600.png 479w" sizes="(max-width: 641px) 100vw, 641px" /><figcaption>Diagram showing the transitions between the elements</figcaption></figure>



<h4 id="mce_48">The downloaded WAV</h4>



<p>The WAV file sounds like grey noise, and we suspect that it is meant to hide some binary belonging to the malware. </p>



<figure class="wp-block-image"><img data-attachment-id="39768" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/wav_visualization/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/07/wav_visualization.png" data-orig-size="830,151" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="wav_visualization" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/07/wav_visualization-300x55.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/07/wav_visualization-600x109.png" loading="lazy" width="830" height="151" src="https://blog.malwarebytes.com/wp-content/uploads/2019/07/wav_visualization.png" alt="" class="wp-image-39768" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/07/wav_visualization.png 830w, https://blog.malwarebytes.com/wp-content/uploads/2019/07/wav_visualization-300x55.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/07/wav_visualization-600x109.png 600w" sizes="(max-width: 830px) 100vw, 830px" /><figcaption>An oscillogram of the WAV file</figcaption></figure>



<p>The data is unreadable, probably encrypted or obfuscated:</p>



<figure class="wp-block-image"><img data-attachment-id="38748" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/wav_bgn/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/wav_bgn.png" data-orig-size="626,197" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="wav_bgn" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/wav_bgn-300x94.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/wav_bgn-600x189.png" loading="lazy" width="626" height="197" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/wav_bgn.png" alt="" class="wp-image-38748" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/wav_bgn.png 626w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/wav_bgn-300x94.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/wav_bgn-600x189.png 600w" sizes="(max-width: 626px) 100vw, 626px" /></figure>



<p>We also found a repeating pattern inside, which looks like an encrypted padding. The size of the chunk is 8 bytes.</p>



<figure class="wp-block-image"><img data-attachment-id="38751" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/wav_pattern-3/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/wav_pattern-2.png" data-orig-size="609,97" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="wav_pattern" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/wav_pattern-2-300x48.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/wav_pattern-2-600x96.png" loading="lazy" width="609" height="97" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/wav_pattern-2.png" alt="" class="wp-image-38751" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/wav_pattern-2.png 609w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/wav_pattern-2-300x48.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/wav_pattern-2-600x96.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/wav_pattern-2-604x97.png 604w" sizes="(max-width: 609px) 100vw, 609px" /><figcaption>The repeating pattern inside the file: 8 bytes long</figcaption></figure>



<p>This time, using the repeating pattern as an XOR key didn&#8217;t help in getting a readable result, so probably some more complex block cipher was used.</p>



<h4>The JPG</h4>



<p>Below is a sample JPG, downloaded from the URL in the format: <code>/views/[unique_string].jpg</code></p>



<p>In contrast to the WAV content, the JPG always looks like a valid image. (Interestingly, all the JPGs we observed have a consistent theme of manga-styled girls.) However, if we take a closer look at the image, we can see that some data is appended at the end.</p>



<figure class="wp-block-image"><img data-attachment-id="38726" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/malware_girl/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/malware_girl.png" data-orig-size="533,467" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="malware_girl" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/malware_girl-300x263.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/malware_girl.png" loading="lazy" width="533" height="467" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/malware_girl.png" alt="" class="wp-image-38726" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/malware_girl.png 533w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/malware_girl-300x263.png 300w" sizes="(max-width: 533px) 100vw, 533px" /></figure>



<p>Let&#8217;s analyze the JPG and try to extract the payload. </p>



<p>First, I opened the image in a hexeditor (i.e. HxD). The size of the full image is 156,005 bytes. The last 118,762 bytes belong to the malware. So, we need remove the first 37,243 bytes (156,005-118,762=37,243) in order to get the payload.</p>



<figure class="wp-block-image"><img data-attachment-id="38728" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/payload_jpg/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/payload_jpg.png" data-orig-size="633,183" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="payload_jpg" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/payload_jpg-300x87.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/payload_jpg-600x173.png" loading="lazy" width="633" height="183" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/payload_jpg.png" alt="" class="wp-image-38728" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/payload_jpg.png 633w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/payload_jpg-300x87.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/payload_jpg-600x173.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/payload_jpg-630x183.png 630w" sizes="(max-width: 633px) 100vw, 633px" /><figcaption>The appended part of the JPG</figcaption></figure>



<p>The payload does not look like a valid code, so it is probably obfuscated. Let&#8217;s try the easiest option first and see if there are any candidates for the XOR key. We can see that the payload has padding at the end:</p>



<figure class="wp-block-image"><img data-attachment-id="38729" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/payload_padding/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/payload_padding.png" data-orig-size="627,129" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="payload_padding" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/payload_padding-300x62.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/payload_padding-600x123.png" loading="lazy" width="627" height="129" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/payload_padding.png" alt="" class="wp-image-38729" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/payload_padding.png 627w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/payload_padding-300x62.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/payload_padding-600x123.png 600w" sizes="(max-width: 627px) 100vw, 627px" /></figure>



<p>Let&#8217;s try to apply the repeating character (in the given example it is 0xE5) as an XOR key. This is the result (<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://malshare.com/sample.php?action=detail&amp;hash=1953032199142ea8c5872107da8f2297" target="_blank">1953032199142ea8c5872107da8f2297</a>):</p>



<figure class="wp-block-image"><img data-attachment-id="38730" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/rcx_package/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rcx_package.png" data-orig-size="626,245" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="rcx_package" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rcx_package-300x117.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rcx_package-600x235.png" loading="lazy" width="626" height="245" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rcx_package.png" alt="" class="wp-image-38730" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rcx_package.png 626w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/rcx_package-300x117.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/rcx_package-600x235.png 600w" sizes="(max-width: 626px) 100vw, 626px" /></figure>



<p>Repeating the experiment on various payloads, we can see that the result always start from the keyword <code>!rcx</code>. As we know from analyzing <a rel="noreferrer noopener" aria-label="other elements of Hidden Bee (opens in a new tab)" href="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/" target="_blank">other elements of Hidden Bee</a>, the authors of this malware decided to use various custom formats named after <a rel="noreferrer noopener" aria-label="64 bit Intel registers (opens in a new tab)" href="https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/x64-architecture" target="_blank">64-bit Intel registers</a>. We also encountered packages starting from <code>!rbx</code>  and <code>!rsi</code> at different layers. So, this is the first element in the chain that uses this convention.</p>



<p>When we load the <code>!rcx</code> module into IDA, we can confirm that it contains valid code. More detailed explanation about the <code>!rcx</code>  format will be given later on in this article.</p>



<h4 id="mce_79">The PNG</h4>



<p>Let&#8217;s have a look at a sample PNG, download from the &#8220;captcha.png&#8221; (URL format: <code>/images/captcha.png?mod=attachment&amp;u=[unique_id]</code>):</p>



<figure class="wp-block-image"><img data-attachment-id="38763" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/captcha_png/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/captcha_png.png" data-orig-size="429,238" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="captcha_png" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/captcha_png-300x166.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/captcha_png.png" loading="lazy" width="429" height="238" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/captcha_png.png" alt="" class="wp-image-38763" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/captcha_png.png 429w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/captcha_png-300x166.png 300w" sizes="(max-width: 429px) 100vw, 429px" /></figure>



<p>Although it is a PNG in a valid format, it looks like noise. It probably represents bytes of some encrypted data. An attempt of converting PNG to raw bytes didn&#8217;t give any readable results. We need to analyze the code in order to discover what it hides.</p>



<h3 id="mce_73">Code analysis: the initial SWF file </h3>



<p>The initial SWF file is embedded on the website and responsible for serving the exploit. If we look inside it, we will not find anything malicious at first. However, among the binary data we can find another suspicious WAV as an audio asset:</p>



<figure class="wp-block-image"><img data-attachment-id="38752" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/assets/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/assets.png" data-orig-size="395,197" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="assets" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/assets-300x150.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/assets.png" loading="lazy" width="395" height="197" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/assets.png" alt="" class="wp-image-38752" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/assets.png 395w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/assets-300x150.png 300w" sizes="(max-width: 395px) 100vw, 395px" /></figure>



<p>The beginning of the file:</p>



<figure class="wp-block-image"><img data-attachment-id="38753" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/audio_in_swf/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/audio_in_swf.png" data-orig-size="743,128" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="audio_in_swf" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/audio_in_swf-300x52.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/audio_in_swf-600x103.png" loading="lazy" width="743" height="128" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/audio_in_swf.png" alt="" class="wp-image-38753" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/audio_in_swf.png 743w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/audio_in_swf-300x52.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/audio_in_swf-600x103.png 600w" sizes="(max-width: 743px) 100vw, 743px" /></figure>



<p>This SWF file also contains a decoder for it:</p>



<figure class="wp-block-image"><img data-attachment-id="38754" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/decide_wav/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/decide_wav.png" data-orig-size="614,548" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="decide_wav" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/decide_wav-300x268.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/decide_wav-600x536.png" loading="lazy" width="614" height="548" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/decide_wav.png" alt="" class="wp-image-38754" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/decide_wav.png 614w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/decide_wav-300x268.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/decide_wav-600x536.png 600w" sizes="(max-width: 614px) 100vw, 614px" /></figure>



<p>The function &#8220;decode&#8221; takes four parameters. The first of them is the byte array containing the WAV asset: That is the content to be decoded. The second argument is an MD5 (the &#8220;setup&#8221; function is an MD5 implementation) made of concatenation of the AppId and the AppToken: That is probably the encryption key. The third parameter is a salt (probably the initialization vector of the crypto).</p>



<p>The salt is fetched from the HTML page, where the Flash component is embedded:</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/05/salt_passed.png" target="_blank" rel="noreferrer noopener" data-rel="lightbox-image-2" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="38764" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/salt_passed/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/salt_passed.png" data-orig-size="886,298" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="salt_passed" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/salt_passed-300x101.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/salt_passed-600x202.png" loading="lazy" width="886" height="298" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/salt_passed.png" alt="" class="wp-image-38764" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/salt_passed.png 886w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/salt_passed-300x101.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/salt_passed-600x202.png 600w" sizes="(max-width: 886px) 100vw, 886px" /></a></figure>



<h4 id="mce_22">Alternative case: two WAV files</h4>



<p>Sometimes, rather than embedding the WAV containing the Flash exploit, authors use another model of delivering it. They store the URL to the WAV, and then they retrieve the file.</p>



<p>In the below example, we can see how this model is applied to Hidden Bee. The salt, along with the WAV URL, are both stored in the Javascript embedded in the HTML:</p>



<figure class="wp-block-image"><img data-attachment-id="39839" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/external_audio_res/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/external_audio_res.png" data-orig-size="731,331" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="external_audio_res" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/external_audio_res-300x136.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/external_audio_res-600x272.png" loading="lazy" width="731" height="331" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/external_audio_res.png" alt="" class="wp-image-39839" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/external_audio_res.png 731w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/external_audio_res-300x136.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/external_audio_res-600x272.png 600w" sizes="(max-width: 731px) 100vw, 731px" /></figure>



<p>The Flash file first loads it and then decodes as the next step:</p>



<figure class="wp-block-image"><img data-attachment-id="39840" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/external_audio_load/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/external_audio_load.png" data-orig-size="595,387" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="external_audio_load" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/external_audio_load-300x195.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/external_audio_load.png" loading="lazy" width="595" height="387" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/external_audio_load.png" alt="" class="wp-image-39840" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/external_audio_load.png 595w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/external_audio_load-300x195.png 300w" sizes="(max-width: 595px) 100vw, 595px" /></figure>



<p>Looking at the traffic capture, we can see that in this case, not one, but <em>two</em> WAV files are downloaded:</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/08/external_audio1.png" data-rel="lightbox-image-3" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="39841" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/external_audio1/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/external_audio1.png" data-orig-size="863,94" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="external_audio1" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/external_audio1-300x33.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/external_audio1-600x65.png" loading="lazy" width="863" height="94" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/external_audio1.png" alt="" class="wp-image-39841" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/external_audio1.png 863w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/external_audio1-300x33.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/external_audio1-600x65.png 600w" sizes="(max-width: 863px) 100vw, 863px" /></a><figcaption>A case when two WAV files were downloaded (and none embedded in the Flash)</figcaption></figure>



<p>The algorithms used to encrypt the content of the first WAV may vary and sometimes the algorithm is supplied as one of the parameters. After the content is fetched, the data from the WAV files is decoded using one of the available algorithms:</p>



<figure class="wp-block-image"><img data-attachment-id="39843" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/decode_read_content/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_read_content.png" data-orig-size="605,121" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="decode_read_content" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_read_content-300x60.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_read_content-600x120.png" loading="lazy" width="605" height="121" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_read_content.png" alt="" class="wp-image-39843" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_read_content.png 605w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_read_content-300x60.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_read_content-600x120.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_read_content-604x121.png 604w" sizes="(max-width: 605px) 100vw, 605px" /></figure>



<p>We can see that the expected content is a Flash file that is then loaded:</p>



<figure class="wp-block-image"><img data-attachment-id="39844" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/run_new_clip/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/run_new_clip.png" data-orig-size="644,104" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="run_new_clip" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/run_new_clip-300x48.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/run_new_clip-600x97.png" loading="lazy" width="644" height="104" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/run_new_clip.png" alt="" class="wp-image-39844" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/run_new_clip.png 644w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/run_new_clip-300x48.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/run_new_clip-600x97.png 600w" sizes="(max-width: 644px) 100vw, 644px" /></figure>



<h4>The &#8220;decode&#8221; function</h4>



<p>The function &#8220;decode&#8221; is imported from the package &#8220;com.google&#8221;:</p>



<figure class="wp-block-image"><img data-attachment-id="39741" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/google_decode/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/07/google_decode.png" data-orig-size="475,54" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="google_decode" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/07/google_decode-300x34.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/07/google_decode.png" loading="lazy" width="475" height="54" src="https://blog.malwarebytes.com/wp-content/uploads/2019/07/google_decode.png" alt="" class="wp-image-39741" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/07/google_decode.png 475w, https://blog.malwarebytes.com/wp-content/uploads/2019/07/google_decode-300x34.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/07/google_decode-470x54.png 470w" sizes="(max-width: 475px) 100vw, 475px" /></figure>



<p>The full decompiled code is available <a rel="noreferrer noopener" aria-label="here (opens in a new tab)" href="https://gist.github.com/malwarezone/3aea44e1d4c66821f92b1092461fb815" target="_blank">here</a>.</p>



<p>When we look inside, we see that the code is slightly obfuscated:</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/07/google_decode_obf.png" data-rel="lightbox-image-4" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="39742" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/google_decode_obf/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/07/google_decode_obf.png" data-orig-size="1033,367" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="google_decode_obf" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/07/google_decode_obf-300x107.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/07/google_decode_obf-600x213.png" loading="lazy" width="1033" height="367" src="https://blog.malwarebytes.com/wp-content/uploads/2019/07/google_decode_obf.png" alt="" class="wp-image-39742" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/07/google_decode_obf.png 1033w, https://blog.malwarebytes.com/wp-content/uploads/2019/07/google_decode_obf-300x107.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/07/google_decode_obf-600x213.png 600w" sizes="(max-width: 1033px) 100vw, 1033px" /></a></figure>



<p>Looking at the decompiled code, we see some interesting constants. For example, &#8211;889275714 in hex is 0xCAFEBABE. As we found during <a rel="noreferrer noopener" aria-label="analysis of other Hidden Bee's elements (opens in a new tab)" href="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/" target="_blank">analysis of other Hidden Bee elements</a>, this DWORD was used by the same authors before as a magic number identifying one of the custom formats.</p>



<figure class="wp-block-image"><img data-attachment-id="39743" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/cafebabe/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/07/cafebabe.png" data-orig-size="448,570" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="cafebabe" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/07/cafebabe-236x300.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/07/cafebabe.png" loading="lazy" width="448" height="570" src="https://blog.malwarebytes.com/wp-content/uploads/2019/07/cafebabe.png" alt="" class="wp-image-39743" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/07/cafebabe.png 448w, https://blog.malwarebytes.com/wp-content/uploads/2019/07/cafebabe-236x300.png 236w" sizes="(max-width: 448px) 100vw, 448px" /></figure>



<p>Internally, there are references to a function from another module: E_ENCRYPT_process_bytes(). Inside this function, we see calls suggesting that the <a rel="noreferrer noopener" aria-label="Rabbit Cipher (opens in a new tab)" href="https://en.wikipedia.org/wiki/Rabbit_(cipher)" target="_blank">Rabbit Cipher</a> has been used:</p>



<figure class="wp-block-image"><img data-attachment-id="39746" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/rabbit_cipher/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/07/rabbit_cipher.png" data-orig-size="466,460" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="rabbit_cipher" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/07/rabbit_cipher-300x296.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/07/rabbit_cipher.png" loading="lazy" width="466" height="460" src="https://blog.malwarebytes.com/wp-content/uploads/2019/07/rabbit_cipher.png" alt="" class="wp-image-39746" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/07/rabbit_cipher.png 466w, https://blog.malwarebytes.com/wp-content/uploads/2019/07/rabbit_cipher-300x296.png 300w" sizes="(max-width: 466px) 100vw, 466px" /></figure>



<p>Rabbit uses a 128-bit key (the same length as the MD5 hash that was mentioned before) and a 64-bit initialization vector. (In different runs, a different encryption algorithm may be selected.)</p>



<p>After the decoding process is complete, the revealed content is loaded:</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/07/load_on_complete.png" data-rel="lightbox-image-5" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="39745" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/load_on_complete/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/07/load_on_complete.png" data-orig-size="795,412" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="load_on_complete" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/07/load_on_complete-300x155.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/07/load_on_complete-600x311.png" loading="lazy" width="795" height="412" src="https://blog.malwarebytes.com/wp-content/uploads/2019/07/load_on_complete.png" alt="" class="wp-image-39745" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/07/load_on_complete.png 795w, https://blog.malwarebytes.com/wp-content/uploads/2019/07/load_on_complete-300x155.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/07/load_on_complete-600x311.png 600w" sizes="(max-width: 795px) 100vw, 795px" /></a></figure>



<h4 id="mce_29">The first WAV: a Flash exploit</h4>



<p>The decoded WAV contains a package with two elements embedded: a Flash file (movies.swf) and the configuration file (config.cfg). The decrypted data starts from the magic DWORD 0xCAFEBABE, which we noticed in the code of the previous SWF.</p>



<figure class="wp-block-image"><img data-attachment-id="39835" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/maybe_decoded/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/maybe_decoded.png" data-orig-size="626,264" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="maybe_decoded" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/maybe_decoded-300x127.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/maybe_decoded-600x253.png" loading="lazy" width="626" height="264" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/maybe_decoded.png" alt="" class="wp-image-39835" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/maybe_decoded.png 626w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/maybe_decoded-300x127.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/maybe_decoded-600x253.png 600w" sizes="(max-width: 626px) 100vw, 626px" /></figure>



<p>The Flash file (movies.swf) contains an embedded exploit. In the analyzed case, the exploit used is <a rel="noreferrer noopener" aria-label="CVE-2015-5122  (opens in a new tab)" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-5122" target="_blank">CVE-2015-5122</a>, however, a different exploit may be used on a different machine:</p>



<figure class="wp-block-image"><img data-attachment-id="39836" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/exploit_flash/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/exploit_flash.png" data-orig-size="270,225" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="exploit_flash" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/exploit_flash.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/exploit_flash.png" loading="lazy" width="270" height="225" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/exploit_flash.png" alt="" class="wp-image-39836" /></figure>



<p>The payload (shellcode) is stored in form of an array (binary version available here: <a rel="noreferrer noopener" aria-label="9aec11ff93b9df14f060f78fbb1b47a2 (opens in a new tab)" href="https://malshare.com/sample.php?action=detail&amp;hash=9aec11ff93b9df14f060f78fbb1b47a2" target="_blank">9aec11ff93b9df14f060f78fbb1b47a2</a>):</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/08/payload32.png" data-rel="lightbox-image-6" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="39837" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/payload32/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/payload32.png" data-orig-size="798,260" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="payload32" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/payload32-300x98.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/payload32-600x195.png" loading="lazy" width="798" height="260" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/payload32.png" alt="" class="wp-image-39837" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/payload32.png 798w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/payload32-300x98.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/payload32-600x195.png 600w" sizes="(max-width: 798px) 100vw, 798px" /></a></figure>



<p>The configuration file (config.cfg) contains the URL to another WAV file. </p>



<p>The payload is padded with NOP (0x90) bytes, and the parameters, including the configuration, are filled there before the payload runs.</p>



<figure class="wp-block-image"><img data-attachment-id="40013" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/params_filled-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/params_filled-1.png" data-orig-size="471,401" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="params_filled" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/params_filled-1-300x255.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/params_filled-1.png" loading="lazy" width="471" height="401" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/params_filled-1.png" alt="" class="wp-image-40013" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/params_filled-1.png 471w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/params_filled-1-300x255.png 300w" sizes="(max-width: 471px) 100vw, 471px" /><figcaption>The fragment of the code feeding the configuration into the payload</figcaption></figure>



<h4 id="mce_55">The shellcode: downloading the second WAV</h4>



<p>The second WAV, in contrast to the first one, is always downloaded and never embedded. It is retrieved by the &#8220;PayloadWin32&#8221; shellcode (<a rel="noreferrer noopener" href="https://malshare.com/sample.php?action=detail&amp;hash=9aec11ff93b9df14f060f78fbb1b47a2" target="_blank">9aec11ff93b9df14f060f78fbb1b47a2</a>), deployed after the successful exploitation.</p>



<p>Looking inside this shellcode, we find the function that is responsible for downloading and decrypting another WAV. The shellcode uses parameters that were filled by the previous layer. This buffer contains the URL that will be queried and the key that will be used for decryption of the payload. It loads functions from wininet.dll using their checksums. After the initialization steps, it queries the supplied URL. The expected result is a buffer with a header typical for WAV files.</p>



<figure class="wp-block-image"><img data-attachment-id="39979" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/download_wav/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/download_wav.png" data-orig-size="700,362" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="download_wav" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/download_wav-300x155.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/download_wav-600x310.png" loading="lazy" width="700" height="362" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/download_wav.png" alt="" class="wp-image-39979" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/download_wav.png 700w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/download_wav-300x155.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/download_wav-600x310.png 600w" sizes="(max-width: 700px) 100vw, 700px" /></figure>



<p>As we already suspected, the data of the WAV (starting from the offset 0x2C) contains the encrypted content. Indeed, blocks that are 8 bytes long are decrypted in a loop:</p>



<figure class="wp-block-image"><img data-attachment-id="39980" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/decrypting_loop/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decrypting_loop.png" data-orig-size="428,319" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="decrypting_loop" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decrypting_loop-300x224.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decrypting_loop.png" loading="lazy" width="428" height="319" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decrypting_loop.png" alt="" class="wp-image-39980" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decrypting_loop.png 428w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/decrypting_loop-300x224.png 300w" sizes="(max-width: 428px) 100vw, 428px" /></figure>



<p>After the decryption is complete, the next module will be revealed. It is interesting to take a look at the expected header of the payload to learn which format is used for the output element. This time, the decoded data is supposed to start with the following magic numbers: 0x01, 0x04, &#8230;, 0x10.</p>



<figure class="wp-block-image"><img data-attachment-id="39981" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/check_and_call_payload/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_and_call_payload.png" data-orig-size="701,384" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="check_and_call_payload" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_and_call_payload-300x164.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_and_call_payload-600x329.png" loading="lazy" width="701" height="384" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_and_call_payload.png" alt="" class="wp-image-39981" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_and_call_payload.png 701w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_and_call_payload-300x164.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_and_call_payload-600x329.png 600w" sizes="(max-width: 701px) 100vw, 701px" /></figure>



<h4 id="mce_27">The second WAV: an executable in proprietary format</h4>



<p>On the illustration below, we can see how the data of the WAV looks after being decrypted (<a rel="noreferrer noopener" aria-label="9b37c9ec19a53007d450b9b9c8febbe2 (opens in a new tab)" href="https://malshare.com/sample.php?action=detail&amp;hash=9b37c9ec19a53007d450b9b9c8febbe2" target="_blank">9b37c9ec19a53007d450b9b9c8febbe2</a>):</p>



<figure class="wp-block-image"><img data-attachment-id="39889" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/decode_riff_stage2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_riff_stage2.png" data-orig-size="456,216" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="decode_riff_stage2" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_riff_stage2-300x142.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_riff_stage2.png" loading="lazy" width="456" height="216" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_riff_stage2.png" alt="" class="wp-image-39889" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_riff_stage2.png 456w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_riff_stage2-300x142.png 300w" sizes="(max-width: 456px) 100vw, 456px" /></figure>



<p>This is an executable component that is loaded into Internet Explorer. After it decodes the imports, it starts to look much more familiar:</p>



<figure class="wp-block-image"><img data-attachment-id="39890" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/riff_after_decode/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/riff_after_decode.png" data-orig-size="451,152" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="riff_after_decode" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/riff_after_decode-300x101.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/riff_after_decode.png" loading="lazy" width="451" height="152" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/riff_after_decode.png" alt="" class="wp-image-39890" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/riff_after_decode.png 451w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/riff_after_decode-300x101.png 300w" sizes="(max-width: 451px) 100vw, 451px" /></figure>



<p>We can see that it follows an analogical structure to the one described in last year&#8217;s article.</p>



<p>This module is first executed within Internet Explorer. Then, it creates another process (dllhost.exe) in a suspended state:</p>



<figure class="wp-block-image"><img data-attachment-id="39892" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/create_process_from_payl/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/create_process_from_payl.png" data-orig-size="521,295" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="create_process_from_payl" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/create_process_from_payl-300x170.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/create_process_from_payl.png" loading="lazy" width="521" height="295" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/create_process_from_payl.png" alt="" class="wp-image-39892" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/create_process_from_payl.png 521w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/create_process_from_payl-300x170.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/create_process_from_payl-400x225.png 400w" sizes="(max-width: 521px) 100vw, 521px" /></figure>



<p>It injects its original copy there (<a rel="noreferrer noopener" aria-label="769a05f0eddd6ef2ebdd13618b244758 (opens in a new tab)" href="https://malshare.com/sample.php?action=detail&amp;hash=769a05f0eddd6ef2ebdd13618b244758" target="_blank">769a05f0eddd6ef2ebdd13618b244758</a>):</p>



<figure class="wp-block-image"><img data-attachment-id="39894" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/encoded_version_injected/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/encoded_version_injected.png" data-orig-size="621,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="encoded_version_injected" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/encoded_version_injected-300x223.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/encoded_version_injected-600x446.png" loading="lazy" width="600" height="446" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/encoded_version_injected-600x446.png" alt="" class="wp-image-39894" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/encoded_version_injected-600x446.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/encoded_version_injected-300x223.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/encoded_version_injected.png 621w" sizes="(max-width: 600px) 100vw, 600px" /></figure>



<p>Then it redirects execution to its loading function. Below, we can see the Entry Point of the implanted module within dllhost.exe.</p>



<figure class="wp-block-image"><img data-attachment-id="39893" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/implanted_module_ep/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/implanted_module_ep.png" data-orig-size="524,321" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="implanted_module_ep" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/implanted_module_ep-300x184.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/implanted_module_ep.png" loading="lazy" width="524" height="321" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/implanted_module_ep.png" alt="" class="wp-image-39893" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/implanted_module_ep.png 524w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/implanted_module_ep-300x184.png 300w" sizes="(max-width: 524px) 100vw, 524px" /></figure>



<p>A detailed analysis of the execution flow of this module and its format will be given later in the article.</p>



<p>At this point, it is important to note that the dllhost.exe is the module that further downloads the aforementioned images.</p>



<h3>The modules with the custom format</h3>



<p>The module with the custom format is analogous to the one <a rel="noreferrer noopener" aria-label="described before (opens in a new tab)" href="https://blog.malwarebytes.com/threat-analysis/2018/08/reversing-malware-in-a-custom-format-hidden-bee-elements/" target="_blank">described before</a>. However, we can see that it has significantly evolved. </p>



<p>There are changes in the header, as well as improvements in the implementation.</p>



<h4>Changes in the custom format</h4>



<p>The new header is similar to the <a rel="noreferrer noopener" aria-label=" previous one (opens in a new tab)" href="https://blog.malwarebytes.com/threat-analysis/2018/08/reversing-malware-in-a-custom-format-hidden-bee-elements/#" target="_blank">previous one</a>. The few details that have changed are: the magic number at the beginning (from 0x1000<strong>03</strong>01 to 0x1000<strong>04</strong>01), and the format in which the DLLs are stored (the length of a DLL name has been added). That&#8217;s why we will refer to this format as &#8220;0x10000401 format.&#8221;</p>



<p>Another change is that now the names of the DLLs are obfuscated by a simple XOR with 1 byte character. They are deobfuscated just before being loaded.</p>



<figure class="wp-block-image"><img data-attachment-id="39899" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/loading_func_by_name/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/loading_func_by_name.png" data-orig-size="324,382" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="loading_func_by_name" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/loading_func_by_name-254x300.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/loading_func_by_name.png" loading="lazy" width="324" height="382" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/loading_func_by_name.png" alt="" class="wp-image-39899" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/loading_func_by_name.png 324w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/loading_func_by_name-254x300.png 254w" sizes="(max-width: 324px) 100vw, 324px" /></figure>



<p>Summing up, we can visualize the new format in the following way:</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/08/new_hdr-2.png" data-rel="lightbox-image-7" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="39901" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/new_hdr-3/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/new_hdr-2.png" data-orig-size="804,597" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="new_hdr" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/new_hdr-2-300x223.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/new_hdr-2-600x446.png" loading="lazy" width="804" height="597" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/new_hdr-2.png" alt="" class="wp-image-39901" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/new_hdr-2.png 804w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/new_hdr-2-300x223.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/new_hdr-2-600x446.png 600w" sizes="(max-width: 804px) 100vw, 804px" /></a></figure>



<h4 id="mce_43">Obfuscation used</h4>



<p>This time, authors decide to obfuscate all the strings used inside the module. Now all the strings are decoded just before use.</p>



<figure class="wp-block-image"><img data-attachment-id="39868" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/decode_and_use/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_and_use.png" data-orig-size="335,121" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="decode_and_use" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_and_use-300x108.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_and_use.png" loading="lazy" width="335" height="121" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_and_use.png" alt="" class="wp-image-39868" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_and_use.png 335w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_and_use-300x108.png 300w" sizes="(max-width: 335px) 100vw, 335px" /><figcaption>Example: decoding the string before the use</figcaption></figure>



<p>The decoding algorithm is simple, based on XOR:</p>



<figure class="wp-block-image"><img data-attachment-id="39929" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/decode_memory/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_memory.png" data-orig-size="403,364" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="decode_memory" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_memory-300x271.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_memory.png" loading="lazy" width="403" height="364" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_memory.png" alt="" class="wp-image-39929" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_memory.png 403w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_memory-300x271.png 300w" sizes="(max-width: 403px) 100vw, 403px" /><figcaption>The string-decoding algorithm</figcaption></figure>



<h3>Inside the images downloader</h3>



<p>Let&#8217;s look inside the first module in the 0x10000401 format that we encountered. This module is an initial stage, and its role is to download and unpack the other components. One such component is in a CAB format (that&#8217;s why we can see the Cabinet.dll among the imported DLLs). </p>



<p>The role of this module is similar to the first &#8220;WASM&#8221; mentioned in our post a year ago. However, the current version is not only better protected, but also comes with some improvements. This time the downloaded content is hidden in the images. So, analyzing this element can help us to understand how the used stenography works.</p>



<p>First, we can see that the URLs are retrieved from their Base64 form:</p>



<figure class="wp-block-image"><img data-attachment-id="39871" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/decoding_urls-3/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decoding_urls.png" data-orig-size="577,125" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="decoding_urls" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decoding_urls-300x65.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decoding_urls.png" loading="lazy" width="577" height="125" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decoding_urls.png" alt="" class="wp-image-39871" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decoding_urls.png 577w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/decoding_urls-300x65.png 300w" sizes="(max-width: 577px) 100vw, 577px" /></figure>



<p>This string decodes to a list containing URLs of the PNG and JPG files that are going to be downloaded. For each sample, this set is unique. None of the  URLs can be reused: the server gives a response only once. An example of a URL set:</p>



<p><pre>http://38.75.137.9:9088/pubs/wiki.php?id=937a4eadd6f5a94b3738a58dcc79ca13
http://38.75.137.9:9088/images/captcha.png?mod=attachment&u=357e27e8af72925144ec1db2421d0cc5&lt
http://38.75.137.9:9088/views/q5ul78uv4b4q8bg8d95canrsns.jpg
</pre></p>



<p>So, we can confirm that this module is the one responsible for downloading and processing the observed images. Indeed, inside we can find the functions responsible for their decoding.</p>



<h4>Decoding the JPG</h4>



<p>After the payload is retrieved, the JPG header is validated.</p>



<figure class="wp-block-image"><img data-attachment-id="39874" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/check_jpg_hdr/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_jpg_hdr.png" data-orig-size="403,257" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="check_jpg_hdr" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_jpg_hdr-300x191.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_jpg_hdr.png" loading="lazy" width="403" height="257" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_jpg_hdr.png" alt="" class="wp-image-39874" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_jpg_hdr.png 403w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_jpg_hdr-300x191.png 300w" sizes="(max-width: 403px) 100vw, 403px" /></figure>



<p>Then, the payload is decoded by simply using an XOR with the last byte. The decoded content is expected to start from the !rcx magic ID.</p>



<figure class="wp-block-image"><img data-attachment-id="39875" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/xor_decoded/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/xor_decoded.png" data-orig-size="317,350" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="xor_decoded" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/xor_decoded-272x300.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/xor_decoded.png" loading="lazy" width="317" height="350" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/xor_decoded.png" alt="" class="wp-image-39875" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/xor_decoded.png 317w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/xor_decoded-272x300.png 272w" sizes="(max-width: 317px) 100vw, 317px" /></figure>



<p>After decoding the content, the hash of the !rcx module is validated with the help of SHA256 hash. The valid hash is stored in the module&#8217;s header and compared with the calculated hash of the file content.</p>



<figure class="wp-block-image"><img data-attachment-id="39876" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/validate_sha265_hash/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/validate_sha265_hash.png" data-orig-size="268,503" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="validate_sha265_hash" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/validate_sha265_hash-160x300.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/validate_sha265_hash.png" loading="lazy" width="268" height="503" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/validate_sha265_hash.png" alt="" class="wp-image-39876" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/validate_sha265_hash.png 268w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/validate_sha265_hash-160x300.png 160w" sizes="(max-width: 268px) 100vw, 268px" /></figure>



<p>If the validation passed, the shellcode stored in the !rcx module is loaded. More details about the execution flow will be given later.</p>



<figure class="wp-block-image"><img data-attachment-id="39877" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/load_shellc/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/load_shellc.png" data-orig-size="327,343" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="load_shellc" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/load_shellc-286x300.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/load_shellc.png" loading="lazy" width="327" height="343" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/load_shellc.png" alt="" class="wp-image-39877" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/load_shellc.png 327w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/load_shellc-286x300.png 286w" sizes="(max-width: 327px) 100vw, 327px" /></figure>



<p>The !rcx package has a simple header:</p>



<figure class="wp-block-image"><img data-attachment-id="39878" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/rcx_package-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/rcx_package.png" data-orig-size="744,283" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="rcx_package" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/rcx_package-300x114.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/rcx_package-600x228.png" loading="lazy" width="744" height="283" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/rcx_package.png" alt="" class="wp-image-39878" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/rcx_package.png 744w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/rcx_package-300x114.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/rcx_package-600x228.png 600w" sizes="(max-width: 744px) 100vw, 744px" /></figure>



<h4>Decoding the PNG</h4>



<p>Retrieving the content from the PNG is more complex.</p>



<figure class="wp-block-image"><img data-attachment-id="39905" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/captcha-4/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/captcha-1.png" data-orig-size="82,82" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="captcha" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/captcha-1.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/captcha-1.png" loading="lazy" width="82" height="82" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/captcha-1.png" alt="" class="wp-image-39905" /><figcaption>&#8220;captcha.png&#8221; &#8211; the encrypted CAB file</figcaption></figure>



<p>First, after downloading, the PNG header is checked:</p>



<figure class="wp-block-image"><img data-attachment-id="39879" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/check_the_png/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_the_png.png" data-orig-size="249,245" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="check_the_png" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_the_png.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_the_png.png" loading="lazy" width="249" height="245" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_the_png.png" alt="" class="wp-image-39879" /></figure>



<p>The function decoding the PNG has the following flow:</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_and_load_coresdb.png" data-rel="lightbox-image-8" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="39971" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/decode_and_load_coresdb/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_and_load_coresdb.png" data-orig-size="776,649" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="decode_and_load_coresdb" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_and_load_coresdb-300x251.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_and_load_coresdb-600x502.png" loading="lazy" width="776" height="649" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_and_load_coresdb.png" alt="" class="wp-image-39971" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_and_load_coresdb.png 776w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_and_load_coresdb-300x251.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_and_load_coresdb-600x502.png 600w" sizes="(max-width: 776px) 100vw, 776px" /></a></figure>



<p>It converts the PNG into byte content and decrypts it with the help of <a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://en.wikipedia.org/wiki/ARIA_(cipher)" target="_blank">ARIA cipher</a>. The result should be a CAB format. The unpacked CAB is supposed to contain a module &#8220;bin/i386/core.sdb&#8221; that also occurred in our previous encounters with Hidden Bee.</p>



<p>The authors are careful not to reuse URLs as well as encryption keys. That&#8217;s why the Aria key is different for every unique payload. It is stored just after the end of the 0x10000401 module :</p>



<figure class="wp-block-image"><img data-attachment-id="40015" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/aria_key_appended/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/aria_key_appended.png" data-orig-size="609,65" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="aria_key_appended" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/aria_key_appended-300x32.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/aria_key_appended-600x64.png" loading="lazy" width="609" height="65" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/aria_key_appended.png" alt="" class="wp-image-40015" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/aria_key_appended.png 609w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/aria_key_appended-300x32.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/aria_key_appended-600x64.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/aria_key_appended-604x65.png 604w" sizes="(max-width: 609px) 100vw, 609px" /><figcaption>Key format: WORD key length; BYTE key_bytes[];</figcaption></figure>



<p>During the module&#8217;s loading, the key is rewritten into another memory area, from which it is used to decrypt the downloaded module.</p>



<figure class="wp-block-image"><img data-attachment-id="40017" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/copy_the_key/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/copy_the_key.png" data-orig-size="630,456" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="copy_the_key" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/copy_the_key-300x217.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/copy_the_key-600x434.png" loading="lazy" width="630" height="456" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/copy_the_key.png" alt="" class="wp-image-40017" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/copy_the_key.png 630w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/copy_the_key-300x217.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/copy_the_key-600x434.png 600w" sizes="(max-width: 630px) 100vw, 630px" /></figure>



<p>The CAB file retrieved from the PNG is available here: <a rel="noreferrer noopener" aria-label="001bdc26b2845dcf839f67a8760c6839 (opens in a new tab)" href="https://malshare.com/sample.php?action=detail&amp;hash=001bdc26b2845dcf839f67a8760c6839" target="_blank">001bdc26b2845dcf839f67a8760c6839</a></p>



<figure class="wp-block-image"><img data-attachment-id="39903" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/inside_the_cab/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/inside_the_cab.png" data-orig-size="491,109" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="inside_the_cab" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/inside_the_cab-300x67.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/inside_the_cab.png" loading="lazy" width="491" height="109" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/inside_the_cab.png" alt="" class="wp-image-39903" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/inside_the_cab.png 491w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/inside_the_cab-300x67.png 300w" sizes="(max-width: 491px) 100vw, 491px" /></figure>



<p>It contains core.sdb (<a rel="noreferrer noopener" aria-label="d1a2fdc79c154b120a0e52c46a73478d (opens in a new tab)" href="https://malshare.com/sample.php?action=detail&amp;hash=d1a2fdc79c154b120a0e52c46a73478d" target="_blank">d1a2fdc79c154b120a0e52c46a73478d</a>). That is a second module in Hidden Bee&#8217;s custom format.</p>



<figure class="wp-block-image"><img data-attachment-id="39904" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/core_sdb_hdr-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/core_sdb_hdr.png" data-orig-size="724,266" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="core_sdb_hdr" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/core_sdb_hdr-300x110.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/core_sdb_hdr-600x220.png" loading="lazy" width="724" height="266" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/core_sdb_hdr.png" alt="" class="wp-image-39904" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/core_sdb_hdr.png 724w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/core_sdb_hdr-300x110.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/core_sdb_hdr-600x220.png 600w" sizes="(max-width: 724px) 100vw, 724px" /></figure>



<h3 id="mce_36">Inside core.sdb</h3>



<p>This module (retrieved from the PNG) is a second downloader component in the 0x10000401 format. This time, it uses a custom TCP-based protocol, referenced by the authors as SLTP. (This protocol was also used by the analogical component seen one year ago). The embedded links:</p>



<p><code>sltp://dns.howtocom.site:1108/minimal.bin?id=998 sltp://bbs.favcom.space:1108/setup.bin?id=999 </code></p>



<h4 id="mce_50">Execution flow</h4>



<ol><li>Checks for blacklisted processes. If any are detected, exits.</li><li>Removes functions: <code>DbgBreakPoint</code>, <code>DbgUserBreakPoint</code> by overwriting their beginning with the RET instruction.</li><li>Checks if the malware is already installed. If yes, exits.</li><li>Creates an installation mutex <code>{71BB7F1C-D700-4487-B9C6-6DD9863DFE91}-ins.</code></li><li>If the module was run with the flag==1:<ol><li>Connects to the first address:  <code>sltp://dns.howtocom.site:1108/minimal.bin?id=998 </code></li><li>Sets an environment variable <code>INSTALL_SOURCE</code> to the value given as an argument.</li><li>Runs the downloaded next stage module.</li></ol></li><li>If the module was run with the flag!=1:<ol><li>Performs checks against VM. If detected, exits.</li><li>Connects to the second address: <code>sltp://bbs.favcom.space:1108/setup.bin?id=999</code>. This time, appends the victim&#8217;s fingerprint to the URL. Format: <code>&lt;URL&gt;&amp;sid=&lt;INSTALL_SID&gt;&amp;sz=&lt;unique machine ID: 16 bytes hex&gt;&amp;os=&lt;Windows version number&gt;&amp;ar=&lt;architecture&gt;</code></li><li>Runs the downloaded next stage module.</li></ol></li></ol>



<h4>Defensive checks</h4>



<p>At this stage, many anti-analysis checks are deployed. First, there are checks to detect if any of the blacklisted processes are running. The enumeration of the processes is implemented using a low-level function: <code>NtQuerySystemInformation</code> with a parameter 5 (<code>SystemProcessInformation</code>).</p>



<figure class="wp-block-image"><img data-attachment-id="39908" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/search_blacklisted/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/search_blacklisted.png" data-orig-size="714,486" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="search_blacklisted" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/search_blacklisted-300x204.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/search_blacklisted-600x408.png" loading="lazy" width="714" height="486" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/search_blacklisted.png" alt="" class="wp-image-39908" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/search_blacklisted.png 714w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/search_blacklisted-300x204.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/search_blacklisted-600x408.png 600w" sizes="(max-width: 714px) 100vw, 714px" /></figure>



<p>The blacklist contains popular debuggers and sniffers:</p>



<p>&#8220;devenv.exe&#8221; , &#8220;wireshark.exe&#8221;,  &#8220;vmacthlp.exe&#8221;, &#8220;procmon.exe&#8221;, &#8220;ollydbg.exe&#8221;, &#8220;idag.exe&#8221;,  &#8220;ImmunityDebugger.exe&#8221;,  &#8220;windbg.exe&#8221;<br /> &#8220;EHSniffer.exe&#8221;,  &#8220;iris.exe&#8221;,  &#8220;procexp.exe&#8221;,  &#8220;filemon.exe&#8221;,  &#8220;fiddler.exe&#8221;</p>



<p>The names of the processes are obfuscated, so they are not visible on the strings list. If any of those processes are detected, the execution of the module terminates.</p>



<p>Another function deploys a set of anti-VM checks. The anti-VM checks include:</p>



<figure class="wp-block-image"><img data-attachment-id="39967" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/check_sets1/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_sets1.png" data-orig-size="297,169" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="check_sets1" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_sets1.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_sets1.png" loading="lazy" width="297" height="169" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_sets1.png" alt="" class="wp-image-39967" /></figure>



<p>CPUID with EAX=40000000 (<a rel="noreferrer noopener" aria-label="a  check for Hypervisor's Brand (opens in a new tab)" href="https://rayanfam.com/topics/defeating-malware-anti-vm-techniques-cpuid-based-instructions/" target="_blank">a check for Hypervisor&#8217;s Brand</a>):</p>



<figure class="wp-block-image"><img data-attachment-id="39933" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/cpuid_check1/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/cpuid_check1.png" data-orig-size="391,66" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="cpuid_check1" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/cpuid_check1-300x51.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/cpuid_check1.png" loading="lazy" width="391" height="66" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/cpuid_check1.png" alt="" class="wp-image-39933" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/cpuid_check1.png 391w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/cpuid_check1-300x51.png 300w" sizes="(max-width: 391px) 100vw, 391px" /></figure>



<figure class="wp-block-image"><img data-attachment-id="39934" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/cpuid_2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/cpuid_2.png" data-orig-size="272,107" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="cpuid_2" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/cpuid_2.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/cpuid_2.png" loading="lazy" width="272" height="107" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/cpuid_2.png" alt="" class="wp-image-39934" /></figure>



<p>The VMWAre I/O Port (more details [<a rel="noreferrer noopener" aria-label="here (opens in a new tab)" href="https://handlers.sans.org/tliston/ThwartingVMDetection_Liston_Skoudis.pdf" target="_blank">here</a>]):</p>



<figure class="wp-block-image"><img data-attachment-id="39931" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/vmware_in-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/vmware_in-1.png" data-orig-size="405,106" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="vmware_in" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/vmware_in-1-300x79.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/vmware_in-1.png" loading="lazy" width="405" height="106" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/vmware_in-1.png" alt="" class="wp-image-39931" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/vmware_in-1.png 405w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/vmware_in-1-300x79.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/vmware_in-1-400x106.png 400w" sizes="(max-width: 405px) 100vw, 405px" /></figure>



<p>VPCEXT instruction (more details [<a rel="noreferrer noopener" aria-label="here (opens in a new tab)" href="https://shasaurabh.blogspot.com/2017/07/virtual-machine-detection-techniques.html" target="_blank">here</a>])</p>



<figure class="wp-block-image"><img data-attachment-id="39932" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/vpcext_based/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/vpcext_based.png" data-orig-size="394,93" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="vpcext_based" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/vpcext_based-300x71.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/vpcext_based.png" loading="lazy" width="394" height="93" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/vpcext_based.png" alt="" class="wp-image-39932" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/vpcext_based.png 394w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/vpcext_based-300x71.png 300w" sizes="(max-width: 394px) 100vw, 394px" /></figure>



<p>Checking <a rel="noreferrer noopener" aria-label="the list of common VM vendors (opens in a new tab)" href="https://wiki.osdev.org/CPUID" target="_blank">the list of common VM vendors</a>:</p>



<figure class="wp-block-image"><img data-attachment-id="39968" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/check_vm2-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_vm2-1.png" data-orig-size="511,482" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="check_vm2" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_vm2-1-300x283.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_vm2-1.png" loading="lazy" width="511" height="482" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_vm2-1.png" alt="" class="wp-image-39968" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_vm2-1.png 511w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_vm2-1-300x283.png 300w" sizes="(max-width: 511px) 100vw, 511px" /></figure>



<p>Checking the BIOS versions typical for virtual environments:</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_reg_keys.png" data-rel="lightbox-image-9" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="39969" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/check_reg_keys/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_reg_keys.png" data-orig-size="1067,590" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="check_reg_keys" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_reg_keys-300x166.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_reg_keys-600x332.png" loading="lazy" width="1067" height="590" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_reg_keys.png" alt="" class="wp-image-39969" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_reg_keys.png 1067w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_reg_keys-300x166.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_reg_keys-600x332.png 600w" sizes="(max-width: 1067px) 100vw, 1067px" /></a></figure>



<p>Detection of any of the features suggesting a VM results in termination of the component.</p>



<h4>Downloading new modules</h4>



<p>The next elements of HiddenBee are downloaded over the custom &#8220;STLP&#8221; protocol. </p>



<figure class="wp-block-image"><img data-attachment-id="40034" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/check_sltp_protocol/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_sltp_protocol.png" data-orig-size="310,132" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="check_sltp_protocol" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_sltp_protocol-300x128.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_sltp_protocol.png" loading="lazy" width="310" height="132" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_sltp_protocol.png" alt="" class="wp-image-40034" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_sltp_protocol.png 310w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/check_sltp_protocol-300x128.png 300w" sizes="(max-width: 310px) 100vw, 310px" /></figure>



<p>The raw TCP socket created to communicate using the SLTP protocol:</p>



<figure class="wp-block-image"><img data-attachment-id="40037" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/sltp_socket-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/sltp_socket-1.png" data-orig-size="791,664" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="sltp_socket" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/sltp_socket-1-300x252.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/sltp_socket-1-600x504.png" loading="lazy" width="791" height="664" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/sltp_socket-1.png" alt="" class="wp-image-40037" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/sltp_socket-1.png 791w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/sltp_socket-1-300x252.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/sltp_socket-1-600x504.png 600w" sizes="(max-width: 791px) 100vw, 791px" /></figure>



<p>The communication is encrypted. We can see that the expected output is a shellcode that is loaded and executed:</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/08/load_new_module-1.png" data-rel="lightbox-image-10" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="39970" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/load_new_module-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/load_new_module-1.png" data-orig-size="813,648" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="load_new_module" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/load_new_module-1-300x239.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/load_new_module-1-600x478.png" loading="lazy" width="813" height="648" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/load_new_module-1.png" alt="" class="wp-image-39970" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/load_new_module-1.png 813w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/load_new_module-1-300x239.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/load_new_module-1-600x478.png 600w" sizes="(max-width: 813px) 100vw, 813px" /></a></figure>



<p>The way in which it is loaded reminds me of the elements we described recently in &#8220;<a rel="noreferrer noopener" aria-label="Hidden Bee - let's go down the rabbit hole (opens in a new tab)" href="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/" target="_blank">Hidden Bee: Let&#8217;s go down the rabbit hole</a>&#8220;. The current module loads a list of functions that will be passed to the next module. It is a minimalistic, custom version of Import Table. It also passes the memory with the downloaded filesystem to be used for further loading of components.</p>



<h3 id="mce_22">The !rcx package</h3>



<p>This element retrieves the custom filesystem used by this malware. As we know from previous analysis, Hidden Bee uses its own, custom filesystems that are mounted in the memory of the malware and passed to its components. This filesystem is important for the execution flow because it contains many other components that are supposed to be installed on the attacked system in order to continue the infection.</p>



<p>As mentioned before, unpacking the JPG gave us an !rcx package. After this package is downloaded, and its SHA256 checksum is validated, it is repackaged. First, at the end of the !rcx package, the list of URLs (JPG, PNG) from the previous module is copied. Then, the ARIA key is copied. The size of the module and its SHA256 hash are updated. Then, the execution is redirected to the first stage shellcode fetched from the !rcx.</p>



<p>This shellcode was the one that we saw at first, after decoding the !rcx package from the JPG. Yet, looking at this part, we do not see anything malicious. The elements that are more important are well protected and revealed at the next execution stages.</p>



<p>The shellcode from the !rcx package is executed in two stages. The first one unpacks and prepares the second. First, it loads its own imports using hardcoded names of libraries.</p>



<figure class="wp-block-image"><img data-attachment-id="39974" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/hardcoded_names-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/hardcoded_names-1.png" data-orig-size="302,244" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="hardcoded_names" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/hardcoded_names-1-300x242.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/hardcoded_names-1.png" loading="lazy" width="302" height="244" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/hardcoded_names-1.png" alt="" class="wp-image-39974" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/hardcoded_names-1.png 302w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/hardcoded_names-1-300x242.png 300w" sizes="(max-width: 302px) 100vw, 302px" /></figure>



<p>The checksums of the functions that are going to be used are stored in the module and compared with the names calculated by the function: </p>



<figure class="wp-block-image"><img data-attachment-id="39972" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/checksum_algo/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/checksum_algo.png" data-orig-size="424,292" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="checksum_algo" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/checksum_algo-300x207.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/checksum_algo.png" loading="lazy" width="424" height="292" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/checksum_algo.png" alt="" class="wp-image-39972" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/checksum_algo.png 424w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/checksum_algo-300x207.png 300w" sizes="(max-width: 424px) 100vw, 424px" /><figcaption>The checksum calculation algorithm</figcaption></figure>



<p>It uses the functions from kernel32.dll: GetProcessHeap, VirtualAlloc, VirtualFree, and from ntdll.dll: RtlAllocateHeap, RtlFreeHeap, NtQueryInformationProcess.</p>



<p>The repackaged !rcx module is supposed to be supplied as one of the arguments at the Entry Point of the first shellcode. It is most important because the second stage shellcode will be unpacked from the supplied !rcx package.</p>



<figure class="wp-block-image"><img data-attachment-id="38759" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/rcx_arg-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rcx_arg-1.png" data-orig-size="323,114" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="rcx_arg" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rcx_arg-1-300x106.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rcx_arg-1.png" loading="lazy" width="323" height="114" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rcx_arg-1.png" alt="" class="wp-image-38759" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rcx_arg-1.png 323w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/rcx_arg-1-300x106.png 300w" sizes="(max-width: 323px) 100vw, 323px" /><figcaption>Checking the !rcx magic (first stage shellcode)</figcaption></figure>



<p> A new memory area is allocated, and the second stage shellcode is unpacked there.</p>



<figure class="wp-block-image"><img data-attachment-id="39976" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/decode_and_call_next/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_and_call_next.png" data-orig-size="856,559" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="decode_and_call_next" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_and_call_next-300x196.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_and_call_next-600x392.png" loading="lazy" width="856" height="559" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_and_call_next.png" alt="" class="wp-image-39976" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_and_call_next.png 856w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_and_call_next-300x196.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/decode_and_call_next-600x392.png 600w" sizes="(max-width: 856px) 100vw, 856px" /><figcaption>Decoding and calling next module</figcaption></figure>



<p>Inside the second shellcode, we see strings referencing further components of the Hidden Bee malware:</p>



<p><code>
/bin/i386/preload<br />
/bin/i386/coredll.bin
</code></p>



<p>The role of the second stage is unpacking another part from the !rcx: an !rdx package. </p>



<figure class="wp-block-image"><img data-attachment-id="40022" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/decrypt_rdx_func/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decrypt_rdx_func.png" data-orig-size="614,470" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="decrypt_rdx_func" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decrypt_rdx_func-300x230.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decrypt_rdx_func-600x459.png" loading="lazy" width="614" height="470" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decrypt_rdx_func.png" alt="" class="wp-image-40022" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decrypt_rdx_func.png 614w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/decrypt_rdx_func-300x230.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/decrypt_rdx_func-600x459.png 600w" sizes="(max-width: 614px) 100vw, 614px" /></figure>



<figure class="wp-block-image"><img data-attachment-id="39975" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/rdx_check/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/rdx_check.png" data-orig-size="309,89" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="rdx_check" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/rdx_check-300x86.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/rdx_check.png" loading="lazy" width="309" height="89" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/rdx_check.png" alt="" class="wp-image-39975" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/rdx_check.png 309w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/rdx_check-300x86.png 300w" sizes="(max-width: 309px) 100vw, 309px" /><figcaption>Checking the !rdx magic (second stage shellcode)</figcaption></figure>



<p>From our previous experience, we know that the !rdx package is a custom filesystem containing modules. Indeed, after the decryption is complete, the custom filesystem is revealed:</p>



<figure class="wp-block-image"><img data-attachment-id="40019" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/08/the-hidden-bee-infection-chain-part-1-the-stegano-pack/attachment/decrypt_rdx_filesystem/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decrypt_rdx_filesystem.png" data-orig-size="478,723" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="decrypt_rdx_filesystem" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decrypt_rdx_filesystem-198x300.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decrypt_rdx_filesystem-397x600.png" loading="lazy" width="478" height="723" src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decrypt_rdx_filesystem.png" alt="" class="wp-image-40019" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/08/decrypt_rdx_filesystem.png 478w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/decrypt_rdx_filesystem-198x300.png 198w, https://blog.malwarebytes.com/wp-content/uploads/2019/08/decrypt_rdx_filesystem-397x600.png 397w" sizes="(max-width: 478px) 100vw, 478px" /></figure>



<p>So the part that was hidden in the JPG is, in reality, a package that decrypts the custom filesystem and deploys the next stage modules: <code>/bin/i386/preload</code> and <code>/bin/i386/coredll.bin</code>. This filesystem has even more elements that are loaded at later stages of the infection. Their full functionality will be described in the next article in our series.</p>



<h3>Even more hidden</h3>



<p>From the beginning, Hidden Bee malware has been well designed and innovative. Looking at one year of its evolution, we can be sure that the authors are serious about making it even more stealthy—and they don&#8217;t stop improving it.</p>



<p>Although the initial dropper uses components analogous to ones observed in the past, revealing their encrypted content now takes many more steps and much more patience. The additional difficulty in the analysis is introduced by the fact that the URLs and encryption keys are never reused, and work only for a single session.</p>



<p>The team behind this malware is skilled and determined. We expect that the Hidden Bee malware won&#8217;t be going extinct anytime soon.</p>
</div>
        
      <div class="share-section">
          <p><b>SHARE THIS ARTICLE</b></p>
         


         <a class="socicon-facebook" target="_blank" href="http://www.facebook.com/sharer.php?u=https%3A%2F%2Fblog.malwarebytes.com%2F%3Fp%3D38724&t=The+Hidden+Bee+infection+chain%2C+part+1%3A+the+stegano+pack" id="social-share-facebook" aria-label="Share this post on Facebook"></a>
         <a class="socicon-twitter" target="_blank" href="https://twitter.com/intent/tweet?text=The+Hidden+Bee+infection+chain%2C+part+1%3A+the+stegano+pack+https%3A%2F%2Fblog.malwarebytes.com%2F%3Fp%3D38724&via=Malwarebytes" id="social-share-twitter" aria-label="Share this post on Twitter"></a> 
        
          <a class="socicon-linkedin" target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fblog.malwarebytes.com%2F%3Fp%3D38724&title=The+Hidden+Bee+infection+chain%2C+part+1%3A+the+stegano+pack&summary=&source=" id="social-share-linkedin" aria-label="Share this post on LinkedIn"></a>
          

        
          
        </div>
      <hr />
      <div class="comments-section">
        <p><b>COMMENTS</b></p>
<div id="disqus_thread"></div>
</div>
        </div>
      <hr />
      <div class="related-articles">
        <p><b>RELATED ARTICLES</b></p>
    <div class="post">
      <div class="large-card">
                  <div class="thumb">
            <a href="https://blog.malwarebytes.com/mac/2019/06/new-mac-cryptominer-malwarebytes-detects-as-bird-miner-runs-by-emulating-linux/ ">
            <img src="https://blog.malwarebytes.com/wp-content/uploads/2019/06/shutterstock_489366043-604x270.jpg" alt="New Mac cryptominer Malwarebytes detects as Bird Miner runs by emulating Linux">
            </a>
          </div>
                    <div class="content">
            <p class="breadcrumbs hidden-xs"><a href="https://blog.malwarebytes.com/category/mac/" rel="category tag">Mac</a></p>
            
                      <h2><a href="https://blog.malwarebytes.com/mac/2019/06/new-mac-cryptominer-malwarebytes-detects-as-bird-miner-runs-by-emulating-linux/ ">New Mac cryptominer Malwarebytes detects as Bird Miner runs by emulating Linux</a></h2>
            
          </div>
        </div>
                      <p class="desc"> June 20, 2019 - A new Mac cryptominer we call Bird Miner was found on pirated music production software that interestingly runs via Linux. Learn how this unique malware attempts, and ultimately fails, at using stealth techniques.</p>
            <div class="post-action"><a href="https://blog.malwarebytes.com/mac/2019/06/new-mac-cryptominer-malwarebytes-detects-as-bird-miner-runs-by-emulating-linux/" class="continue-read">CONTINUE READING</a><a class="num-comments" href="https://blog.malwarebytes.com/mac/2019/06/new-mac-cryptominer-malwarebytes-detects-as-bird-miner-runs-by-emulating-linux/#disqus_thread"><span class="dsq-postid" data-dsqidentifier="39161 https://blog.malwarebytes.com/?p=39161">No Comments</span></a></div>
          </div> 

            <div class="post">
      <div class="large-card">
                  <div class="thumb">
            <a href="https://blog.malwarebytes.com/malwarebytes-news/ctnt-report/2019/01/2019-state-malware-report-trojans-cryptominers-dominate-threat-landscape/ ">
            <img src="https://blog.malwarebytes.com/wp-content/uploads/2016/04/MB_LABS-01-604x270.png" alt="2019 State of Malware report: Trojans and cryptominers dominate threat landscape">
            </a>
          </div>
                    <div class="content">
            <p class="breadcrumbs hidden-xs"><a href="https://blog.malwarebytes.com/category/malwarebytes-news/ctnt-report/" rel="category tag">CTNT report</a> | <a href="https://blog.malwarebytes.com/category/malwarebytes-news/" rel="category tag">Malwarebytes news</a></p>
            
                      <h2><a href="https://blog.malwarebytes.com/malwarebytes-news/ctnt-report/2019/01/2019-state-malware-report-trojans-cryptominers-dominate-threat-landscape/ ">2019 State of Malware report: Trojans and cryptominers dominate threat landscape</a></h2>
            
          </div>
        </div>
                      <p class="desc"> January 23, 2019 - The 2019 State of Malware report is here. Learn what Malwarebytes Labs researchers discovered about the top global threats for businesses and consumers in 2018, and predictions for 2019.</p>
            <div class="post-action"><a href="https://blog.malwarebytes.com/malwarebytes-news/ctnt-report/2019/01/2019-state-malware-report-trojans-cryptominers-dominate-threat-landscape/" class="continue-read">CONTINUE READING</a><a class="num-comments" href="https://blog.malwarebytes.com/malwarebytes-news/ctnt-report/2019/01/2019-state-malware-report-trojans-cryptominers-dominate-threat-landscape/#disqus_thread"><span class="dsq-postid" data-dsqidentifier="26902 https://blog.malwarebytes.com/?p=26902">No Comments</span></a></div>
          </div> 

            <div class="post">
      <div class="large-card">
                  <div class="thumb">
            <a href="https://blog.malwarebytes.com/threat-analysis/2018/12/mac-malware-combines-empyre-backdoor-and-xmrig-miner/ ">
            <img src="https://blog.malwarebytes.com/wp-content/uploads/2018/12/shutterstock_320446367-604x270.jpg" alt="Mac malware combines EmPyre backdoor and XMRig miner">
            </a>
          </div>
                    <div class="content">
            <p class="breadcrumbs hidden-xs"><a href="https://blog.malwarebytes.com/category/threat-analysis/mac-threat-analysis/" rel="category tag">Mac</a> | <a href="https://blog.malwarebytes.com/category/threat-analysis/" rel="category tag">Threat analysis</a></p>
            
                      <h2><a href="https://blog.malwarebytes.com/threat-analysis/2018/12/mac-malware-combines-empyre-backdoor-and-xmrig-miner/ ">Mac malware combines EmPyre backdoor and XMRig miner</a></h2>
            
          </div>
        </div>
                      <p class="desc"> December 7, 2018 - New Mac malware is using the EmPyre backdoor and the XMRig cryptominer to drain processor power—and possibly worse.</p>
            <div class="post-action"><a href="https://blog.malwarebytes.com/threat-analysis/2018/12/mac-malware-combines-empyre-backdoor-and-xmrig-miner/" class="continue-read">CONTINUE READING</a><a class="num-comments" href="https://blog.malwarebytes.com/threat-analysis/2018/12/mac-malware-combines-empyre-backdoor-and-xmrig-miner/#disqus_thread"><span class="dsq-postid" data-dsqidentifier="26544 https://blog.malwarebytes.com/?p=26544">No Comments</span></a></div>
          </div> 

            <div class="post">
      <div class="large-card">
                  <div class="thumb">
            <a href="https://blog.malwarebytes.com/security-world/privacy-security-world/2018/10/tighten-security-increase-privacy-browser/ ">
            <img src="https://blog.malwarebytes.com/wp-content/uploads/2018/10/shutterstock_572527735-604x270.jpg" alt="How to tighten security and increase privacy on your browser">
            </a>
          </div>
                    <div class="content">
            <p class="breadcrumbs hidden-xs"><a href="https://blog.malwarebytes.com/category/security-world/privacy-security-world/" rel="category tag">Privacy</a> | <a href="https://blog.malwarebytes.com/category/security-world/" rel="category tag">Security world</a></p>
            
                      <h2><a href="https://blog.malwarebytes.com/security-world/privacy-security-world/2018/10/tighten-security-increase-privacy-browser/ ">How to tighten security and increase privacy on your browser</a></h2>
            
          </div>
        </div>
                      <p class="desc"> October 31, 2018 - Is your browser secure and private enough by design or do you need to worry about security, privacy, fingerprinting, ads, and cookies yourself?</p>
            <div class="post-action"><a href="https://blog.malwarebytes.com/security-world/privacy-security-world/2018/10/tighten-security-increase-privacy-browser/" class="continue-read">CONTINUE READING</a><a class="num-comments" href="https://blog.malwarebytes.com/security-world/privacy-security-world/2018/10/tighten-security-increase-privacy-browser/#disqus_thread"><span class="dsq-postid" data-dsqidentifier="26071 https://blog.malwarebytes.com/?p=26071">No Comments</span></a></div>
          </div> 

            <div class="post">
      <div class="large-card">
                  <div class="thumb">
            <a href="https://blog.malwarebytes.com/threat-analysis/2018/03/malicious-cryptomining-and-the-blacklist-conundrum/ ">
            <img src="https://blog.malwarebytes.com/wp-content/uploads/2018/03/shutterstock_758242897-604x270.jpg" alt="Malicious cryptomining and the blacklist conundrum">
            </a>
          </div>
                    <div class="content">
            <p class="breadcrumbs hidden-xs"><a href="https://blog.malwarebytes.com/category/threat-analysis/cryptomining/" rel="category tag">Cryptomining</a> | <a href="https://blog.malwarebytes.com/category/threat-analysis/" rel="category tag">Threat analysis</a></p>
            
                      <h2><a href="https://blog.malwarebytes.com/threat-analysis/2018/03/malicious-cryptomining-and-the-blacklist-conundrum/ ">Malicious cryptomining and the blacklist conundrum</a></h2>
            
          </div>
        </div>
                      <p class="desc"> March 26, 2018 - When threat actors take to free and disposable cloud services, the battle against malicious cryptomining becomes a lot more difficult.</p>
            <div class="post-action"><a href="https://blog.malwarebytes.com/threat-analysis/2018/03/malicious-cryptomining-and-the-blacklist-conundrum/" class="continue-read">CONTINUE READING</a><a class="num-comments" href="https://blog.malwarebytes.com/threat-analysis/2018/03/malicious-cryptomining-and-the-blacklist-conundrum/#disqus_thread"><span class="dsq-postid" data-dsqidentifier="22595 https://blog.malwarebytes.com/?p=22595">No Comments</span></a></div>
          </div> 

          
        
      
      </div>
      
      
      
    </div>
    <div class="col-md-4" id="right-rail">
      <hr class="visible-xs visible-sm">



<!-- AUTHOR MODULE -->
<div class="right-rail-section author-info">
      <p><b>ABOUT THE AUTHOR</b></p>
              <div class="small-card">
            <img alt='' src='https://secure.gravatar.com/avatar/5d5dda1e7e00492cdb89a26415b1fa8f?s=96&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/5d5dda1e7e00492cdb89a26415b1fa8f?s=192&#038;d=identicon&#038;r=g 2x' class='avatar avatar-96 photo' height='96' width='96' loading='lazy'/>            <div class="content">
              <p class="details">
              <span class="name"><a href="https://blog.malwarebytes.com/author/hasherezade/" title="Posts by hasherezade" rel="author">hasherezade</a></span>
                
                                <span class="author-twitter"><a href="https://www.twitter.com/hasherezade" class="socicon-twitter" aria-label="See @hasherezade's tweets on Twitter"></a></span>
                                
                
                              <br/><span class="title">Malware Intelligence Analyst </span>
                            </p>

                            <p class="desc">Unpacks malware with as much joy as a kid unpacking candies.</p>
                          </div>
          </div>
      </div>

<!-- SUB CATEGORIES -->
      


	


         
<!-- TOP THREATS -->
    </div>
  </div>
</div>
  
</section>
</article>
  
  
      </div>


<script type="text/plain" class="optanon-category-3">
  var embeds = document.getElementsByClassName('embedded-video');
  var alts = document.getElementsByClassName('embedded-video-alt');
  if(embeds && alts) {
    for(var i = 0; i < embeds.length; i++) {
      embeds[i].src = embeds[i].dataset.src;
      embeds[i].style.display = 'inline-block';
    }

    for(var i = 0; i < alts.length; i++) {
      alts[i].style.display = 'none';
    }
  }
</script>

<script type="text/javascript">
    setTimeout(function() {
        var alts = document.getElementsByClassName('embedded-video-alt');
        for( i = 0; i < alts.length; i++) {
            alts[i].style.background = "none";
        }
    }, 2500);
</script>


<script type="text/plain" class="optanon-category-4">
  $("script[src='https://malwarebytesunpacked.disqus.com/embed.js']").each(function() {
    var scriptSrc = $(this).attr("src");
    var newScript = "<script type='text/javascript' async='' src='" + scriptSrc + "'>";
    $(this).before(newScript).remove();
  });
  
  $("link[href*='https://c.disquscdn.com/next/embed/lounge.bundle'], link[href*='https://c.disquscdn.com/next/embed/common.bundle']").each(function() {
    /**/
  });
  
</script>


<!-- for Labs Nav -->
<script>
var urlID = "blog";
</script>
<script src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/js/labs-nav.js"></script>
<section id="labs-links">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
      <div class="lablink">
        <p><a href="/authors/" id="cta-labs-footernavigation-linkto-contributors-en"><img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/footer/contributors.svg" alt="Silouette of person"><br>
            Contributors</a></p>

      </div>

      <div class="lablink">
        <p><a href="/threats/" id="cta-labs-footernavigation-linkto-threatcenter-en"><img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/footer/threat-center.svg" alt="Malware"><br>
            Threat Center</a></p>
            
      </div>

      <div class="lablink">
        <p><a href="/glossary/" id="cta-labs-footernavigation-linkto-glossary-en"><img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/footer/glossary.svg" alt="Book with bookmark"><br>
            Glossary</a></p>
            
      </div>

      <div class="lablink">
        <p><a href="/tech-support-scams/" id="cta-labs-footernavigation-linkto-scams-en"><img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/footer/scams.svg" alt="Suspicious person"><br>
            Scams</a></p>
            
      </div>

      <div class="lablink">
        <p><a href="/write/" id="cta-labs-footernavigation-linkto-writeforlabs-en"><img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/footer/write.svg" alt="Pencil"><br>
            Write for Labs</a></p>
            
      </div>
</div>
    </div>
  </div>
</section>


<footer class="refresh-footer">
    <div class="container">
        <div class="row links-row">
            <!-- newsletter -->
            <div class="col-md-3 col-xs-12 col-md-push-9 newsletter-col">
                <div class="row soc-icon-row newsletter-icons hidden-xs hidden-sm">
                    <div class="footer-soc-icon">
                        <a id="cta-footer-social-twitter-en" class="social socicon-twitter"
                           href="https://twitter.com/malwarebytes" aria-label="Visit Malwarebytes on Twitter"></a>
                    </div>
                    <div class="footer-soc-icon">
                        <a id="cta-footer-social-facebook-en" class="social socicon-facebook"
                           href="https://www.facebook.com/Malwarebytes/"
                           aria-label="Visit Malwarebytes on Facebook"></a>
                    </div>
                    <div class="footer-soc-icon">
                        <a id="cta-footer-social-linkedin-en" class="social socicon-linkedin"
                           href="https://www.linkedin.com/company/malwarebytes"
                           aria-label="Visit Malwarebytes on LinkedIn"></a>
                    </div>
                    <div class="footer-soc-icon">
                        <a id="cta-footer-social-youtube-en" class="social socicon-youtube"
                           href="https://www.youtube.com/user/Malwarebytes"
                           aria-label="Visit Malwarebytes on YouTube"></a>
                    </div>
                    <div class="footer-soc-icon">
                        <a id="cta-footer-social-instagram-en" class="social socicon-instagram-v2"
                           href="https://www.instagram.com/malwarebytesofficial/"
                           aria-label="Visit Malwarebytes on Instagram"></a>
                    </div>
                </div>
                <div class="row newsletter-refresh">
                    <div class="col-xs-12">
                        <h4>Cybersecurity info you can't do without</h4>
                        <p>Want to stay informed on the latest news in cybersecurity? Sign up for our newsletter and
                            learn
                            how to protect your computer from threats.</p>
                    </div>
                    <div class="col-xs-12">
                        <form class="newsletter-form form-inline" action="//www.malwarebytes.com/newsletter/" _lpchecked="1">
                            <div class="email-input">
                                <label for="cta-footer-newsletter-input-email-en"
                                       aria-label="cta-footer-newsletter-input-email-en"
                                       aria-labelledby="cta-footer-newsletter-input-email-en">
                                    <input type="text" class="email-input-field"
                                           id="cta-footer-newsletter-input-email-en" name="email"
                                           placeholder="Email address">
                                </label>
                                <input name="source" type="hidden" value="">
                                <input type="submit" class="submit-bttn" id="cta-footer-newsletter-subscribe-email-en"
                                       value="">
                            </div>
                        </form>
                    </div>
                </div>

            </div>
            <!--logo col-->
            <div class="col-md-2 col-xs-12 col-md-pull-3 footer-col">
                <div class="footer-logo hidden-xs hidden-sm">
                    <svg width="160px" height="25px" viewBox="0 0 160 25" version="1.1"
                         xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g id="Symbols" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <g id="Footer-desktop" transform="translate(-165.000000, -68.000000)" fill="#FFFFFF">
                                <g id="Footer">
                                    <g id="Group-3">
                                        <g transform="translate(165.000000, 68.000000)">
                                            <g id="logo">
                                                <path
                                                        d="M104.620758,6.81492418 L104.53414,6.84800885 L104.53414,0.579460088 C104.53414,0.43037976 104.412794,0.314384104 104.256721,0.347468775 L102.436133,0.61294337 C102.314787,0.61294337 102.245333,0.728939026 102.245333,0.844934683 L102.245333,19.1016943 C102.245333,19.21769 102.33235,19.3340842 102.436133,19.3340842 C104.01363,19.6820712 105.99069,19.8315502 107.221712,19.8315502 C112.440783,19.8315502 113.151295,17.4434746 113.151295,14.840548 L113.151295,10.0313123 C113.151295,7.27890681 111.7642,5.86981868 109.076628,5.86981868 C107.135093,5.86981868 105.52247,6.36728459 104.620758,6.81492418 M110.827761,9.96514299 L110.827761,14.923459 C110.827761,16.7805854 110.238195,17.9078559 107.394949,17.9078559 C106.441346,17.9078559 105.504907,17.8249449 104.586031,17.7256909 L104.551304,17.7256909 L104.551304,8.85421552 L104.586031,8.85421552 C105.418288,8.47274526 107.152257,7.82580042 108.504625,7.82580042 C110.100084,7.80945739 110.827761,8.48908829 110.827761,9.96514299"
                                                        id="Fill-1"></path>
                                                <path
                                                        d="M116.202745,6.1348548 L114.469175,6.1348548 C114.313102,6.1348548 114.191357,6.28433374 114.226483,6.43341407 L118.612898,19.3675277 C118.647625,19.4835233 118.734244,19.516608 118.85559,19.516608 L119.375701,19.516608 C119.531774,19.516608 119.653519,19.6656883 119.618792,19.8151673 L117.884823,24.657089 C117.850095,24.8061694 117.971441,24.9556483 118.127115,24.9556483 L119.739738,24.9556483 C119.861084,24.9556483 119.930539,24.8727373 119.982829,24.8061694 L121.924763,19.5496927 L126.467251,6.43341407 C126.501978,6.28433374 126.380632,6.1348548 126.224559,6.1348548 L124.49059,6.1348548 C124.369244,6.1348548 124.300189,6.21776579 124.247898,6.28433374 L120.571996,17.2118421 C120.485377,17.4438334 120.173231,17.4438334 120.103776,17.2118421 L116.497727,6.28433374 C116.393945,6.21776579 116.306927,6.1348548 116.202745,6.1348548"
                                                        id="Fill-3"></path>
                                                <path
                                                        d="M137.858597,10.8605816 L137.858597,14.9068768 C137.858597,18.2731425 139.592566,19.8153666 143.389415,19.8153666 C145.002038,19.8153666 146.787898,19.549892 148.088375,19.135337 C148.21012,19.1022524 148.278776,18.9862567 148.245246,18.8702611 L148.001756,17.57677 C147.967029,17.4276897 147.846082,17.3447787 147.68961,17.3942064 C146.146441,17.7756766 144.759346,17.9582402 143.545887,17.9582402 C140.615224,17.9582402 140.112676,16.9796514 140.112676,14.8901352 L140.112676,13.9450297 C140.112676,13.7955508 140.234022,13.7126398 140.355368,13.7126398 L148.261612,13.7126398 C148.417685,13.7126398 148.504703,13.5966441 148.504703,13.4806485 L148.504703,10.9765773 C148.504703,7.57762552 146.805461,5.9524905 143.251304,5.9524905 C139.713512,5.86957951 137.858597,7.54454085 137.858597,10.8605816 L137.858597,10.8605816 Z M140.147005,10.7115013 C140.147005,8.63912529 141.135734,7.72710446 143.303195,7.72710446 C145.43553,7.72710446 146.302515,8.58929898 146.302515,10.7115013 L146.302515,11.6566068 C146.302515,11.8056871 146.181568,11.8885981 146.059823,11.8885981 L140.372931,11.8885981 C140.216858,11.8885981 140.12984,11.7726025 140.12984,11.6566068 L140.12984,10.7115013 L140.147005,10.7115013 Z"
                                                        id="Fill-5"></path>
                                                <path
                                                        d="M155.370725,11.888638 C152.995299,11.3254013 152.925845,11.0599267 152.925845,9.50135967 C152.925845,8.20786859 153.289883,7.76022899 155.370725,7.76022899 C156.359056,7.76022899 157.780479,7.87622465 158.977173,8.10821596 C159.133246,8.14169924 159.254193,8.02530497 159.254193,7.87622465 L159.375938,6.54925028 C159.375938,6.43325463 159.28892,6.31725897 159.185537,6.2841743 C158.075461,6.0186997 156.740656,5.86922077 155.474907,5.86922077 C151.954679,5.86922077 150.654601,6.84780955 150.654601,9.46827499 C150.654601,12.2202819 150.966747,12.9166545 154.45145,13.7457643 C157.260368,14.3927091 157.451169,14.5417895 157.451169,16.0840135 C157.451169,17.5269835 157.087131,17.9746231 154.763597,17.9746231 C153.65392,17.9746231 152.232497,17.7924581 151.053366,17.5269835 C150.897293,17.4938989 150.775548,17.5600682 150.74122,17.7095471 L150.498528,18.9532119 C150.463801,19.0692076 150.533255,19.1852032 150.654601,19.2182879 C151.799005,19.5997581 153.532974,19.8652327 154.885342,19.8652327 C158.95961,19.8652327 159.705248,18.5717417 159.705248,16.0011025 C159.722812,13.1323027 159.167974,12.8006588 155.370725,11.888638"
                                                        id="Fill-7"></path>
                                                <path
                                                        d="M48.2703991,19.417075 L45.7389002,6.3669657 C45.704173,6.21788537 45.8255189,6.06840643 45.9819912,6.06840643 L48.7909092,6.06840643 C48.9118559,6.06840643 49.033601,6.15131742 49.033601,6.25097004 L50.541643,14.1103733 C50.5763703,14.3762465 50.940408,14.3762465 51.0098626,14.1438566 L53.4547428,6.2342284 C53.489071,6.11823275 53.5760887,6.0520634 53.6974346,6.0520634 L57.0268626,6.0520634 C57.1478094,6.0520634 57.2168648,6.13497439 57.2691553,6.2342284 L59.7140355,14.1438566 C59.8006542,14.3762465 60.1475278,14.3762465 60.1822551,14.1103733 L61.6902971,6.25097004 C61.7250244,6.13497439 61.8120422,6.06840643 61.9333881,6.06840643 L64.7423061,6.06840643 C64.8979801,6.06840643 65.019326,6.21788537 64.9845987,6.3669657 L62.4359357,19.417075 C62.4012085,19.5330706 62.314989,19.5996386 62.1932439,19.5996386 L58.5177407,19.5996386 C58.3959956,19.5996386 58.326541,19.5167276 58.2746497,19.417075 L55.5874768,10.6452522 C55.500459,10.4132609 55.1883127,10.4132609 55.1192573,10.6452522 L52.4320843,19.417075 C52.3973571,19.5330706 52.3103393,19.5996386 52.1889934,19.5996386 L48.5130909,19.5996386 C48.391745,19.5996386 48.3051264,19.5330706 48.2703991,19.417075"
                                                        id="Fill-9"></path>
                                                <path
                                                        d="M44.1961309,17.1122293 C42.9303814,17.1122293 42.5312173,16.5816787 42.5312173,15.0725394 L42.5312173,5.27270015 L42.5312173,1.40856993 C42.5312173,1.25948961 42.4098714,1.14309534 42.2541974,1.17657862 L39.2025876,1.59113354 C39.0812417,1.59113354 39.0117872,1.70752781 39.0117872,1.82352347 L39.0117872,1.93951912 L39.0117872,5.27270015 L39.0117872,15.437268 C39.0117872,18.505373 40.9537207,19.8650334 43.554275,19.8650334 C43.8320932,19.8650334 44.733805,19.8315502 45.2535167,19.7817238 C45.3748626,19.7817238 45.4962085,19.6657282 45.4962085,19.5497325 L45.4962085,17.3940469 C45.4962085,17.2449666 45.3748626,17.1620556 45.2191885,17.1620556 C44.8723149,17.1122293 44.4040954,17.1122293 44.1961309,17.1122293"
                                                        id="Fill-11"></path>
                                                <path
                                                        d="M87.0914657,9.02011721 C85.8257163,9.55066779 84.8030578,10.114303 83.658255,10.8274172 C83.5720356,10.8605019 83.5373083,10.9434129 83.5373083,11.0099808 L83.5373083,19.3672486 C83.5373083,19.5167276 83.4155633,19.5996386 83.2942174,19.5996386 L80.2426076,19.5996386 C80.0865344,19.5996386 79.9999158,19.4832443 79.9999158,19.3672486 L79.9999158,6.78152062 C79.9999158,6.66552497 80.0865344,6.54952931 80.1907163,6.54952931 L82.7222152,6.13457578 C82.8782883,6.10149111 82.9996342,6.21748676 82.9996342,6.31713939 L83.1209801,7.1793339 C83.1557074,7.36189752 83.3636719,7.4448085 83.5197451,7.32881284 C84.317275,6.83134694 85.5834236,6.20114373 86.6060821,5.85275815 C86.7621553,5.81967348 86.9178293,5.88624143 86.9178293,6.03532176 L87.1956475,8.68847327 C87.2475389,8.85429524 87.1784835,8.93720622 87.0914657,9.02011721"
                                                        id="Fill-13"></path>
                                                <path
                                                        d="M134.217781,17.9744637 C132.795559,17.9744637 132.709339,17.3777438 132.709339,16.4322396 L132.709339,8.22405217 C132.709339,8.07497184 132.830286,7.99206086 132.951632,7.99206086 L136.28106,7.99206086 C136.402406,7.99206086 136.523353,7.90914987 136.523353,7.76006955 L136.679825,6.43349379 C136.679825,6.28401485 136.55808,6.1680192 136.437133,6.1680192 L132.951632,6.1680192 C132.795559,6.1680192 132.709339,6.05202354 132.709339,5.93562927 L132.709339,2.81889375 C132.709339,2.66941482 132.587594,2.55302055 132.431521,2.58650383 L130.611333,2.85197843 C130.489987,2.85197843 130.420532,2.96757547 130.420532,3.08357113 L130.420532,5.95237092 C130.420532,6.10184985 130.299186,6.18476084 130.17784,6.18476084 L128.20118,6.18476084 C128.045107,6.18476084 127.958089,6.3007565 127.958089,6.41675215 L127.958089,7.74332791 C127.958089,7.89240823 128.079834,7.97531922 128.20118,7.97531922 L130.17784,7.97531922 C130.333914,7.97531922 130.420532,8.09171348 130.420532,8.20770914 L130.420532,16.7638836 C130.420532,18.9195692 131.408863,19.7817637 133.853344,19.7817637 C134.408581,19.7817637 134.96302,19.748679 135.518257,19.6326834 C135.639603,19.5995987 135.708659,19.5166877 135.708659,19.4006921 L135.708659,18.0741163 C135.708659,17.9246374 135.552985,17.8086417 135.43124,17.8417264 C134.980184,17.941379 134.581818,17.9744637 134.217781,17.9744637"
                                                        id="Fill-15"></path>
                                                <path
                                                        d="M97.3387274,6.21776579 C96.5930888,5.91920652 95.6394857,5.72029988 94.4084635,5.72029988 C93.0213682,5.72029988 91.9631841,5.95229119 91.131326,6.31741841 C89.1893925,7.22943924 88.565499,9.00365459 88.565499,10.9600349 L88.565499,14.5586906 C88.565499,17.7423926 90.0216497,19.698773 94.2523903,19.781684 L95.2403216,19.781684 C96.3847251,19.781684 97.58102,19.6656883 98.6739314,19.5162094 C98.7948781,19.4831247 98.916224,19.3675277 98.8639335,19.251532 L98.8639335,19.1351377 L98.5869136,17.2780114 C97.5119646,17.3940071 96.5755256,17.4274903 95.5009757,17.4274903 C92.9000223,17.4274903 92.1024923,16.7143762 92.1024923,15.1888938 L92.1024923,14.7408556 L92.1024923,14.111051 L99.7313172,14.111051 C99.8873903,14.111051 99.974009,13.9946567 99.974009,13.878661 L99.974009,12.8506446 L99.974009,11.1920263 C99.9396808,9.02039623 99.4016076,7.07996031 97.3387274,6.21776579 L97.3387274,6.21776579 Z M96.8182174,11.5906368 C96.8182174,11.7397171 96.6972706,11.8226281 96.5755256,11.8226281 L92.0677651,11.8226281 L92.0677651,10.644734 C92.0677651,9.35164156 92.6569313,8.48944704 94.4084635,8.48944704 C94.599264,8.48944704 94.8068293,8.48944704 94.9980289,8.52293033 C96.2985057,8.70509533 96.8182174,9.5505482 96.8182174,10.644734 L96.8182174,11.5906368 Z"
                                                        id="Fill-17"></path>
                                                <path
                                                        d="M10.6807539,21.9044842 L10.7673725,21.9044842 C10.9230465,21.9044842 11.0443924,21.7825165 11.0443924,21.6257607 C11.0443924,21.5033739 10.9577738,21.3466181 10.8020998,21.3466181 L10.715082,21.3466181 L10.5242816,21.31183 C7.31659864,20.6839687 4.94157208,17.8070392 4.94157208,14.4414006 C4.94157208,13.0121568 5.37506432,11.6520699 6.12030375,10.5539413 C6.24204881,10.3967664 6.4324501,10.2747986 6.64081377,10.4667616 L11.7038116,15.6271281 C11.7377405,15.6619161 11.8247583,15.7143078 11.8942129,15.7143078 C11.9808315,15.7143078 12.050286,15.6795197 12.0850133,15.6271281 L17.1823392,10.5015496 C17.3731397,10.3095867 17.5467761,10.3447939 17.6509579,10.5363377 C18.3961974,11.6520699 18.8296896,12.9949723 18.8296896,14.4242161 C18.8296896,16.2197822 18.1535056,17.8418273 17.0434301,19.0799464 C17.009102,19.1147344 16.9572107,19.1671261 16.9224834,19.2019141 C16.9224834,19.2367022 16.8877561,19.2890938 16.8877561,19.3238818 C16.8877561,19.4810567 17.009102,19.6030245 17.1651752,19.6030245 L17.1999025,19.6030245 C17.2346297,19.6030245 17.2865211,19.5682364 17.3212484,19.5682364 C24.0830887,16.7084914 23.7713415,9.94368351 23.7713415,9.94368351 C23.7713415,6.09017397 21.9503548,2.62059033 19.1418359,0.441098316 C19.0204901,0.353918635 18.8296896,0.353918635 18.7426718,0.475886362 L12.1025765,7.24111341 C11.9808315,7.36308113 11.790031,7.36308113 11.6690843,7.24111341 L4.97590019,0.475886362 C4.8545543,0.353918635 4.69888029,0.353918635 4.57753439,0.441098316 C1.82050776,2.62059033 -7.98328266e-05,6.03778233 -7.98328266e-05,9.94368351 C-7.98328266e-05,16.1502062 4.66415301,21.2766229 10.6807539,21.9044842"
                                                        id="Fill-19"></path>
                                                <path
                                                        d="M29.9264125,5.80321087 C28.6953903,5.80321087 27.3949136,5.88612185 26.1638914,6.06828685 C26.0425455,6.10177013 25.9211996,6.21776579 25.9730909,6.33376145 L26.25051,8.37345139 C26.2852373,8.48944704 26.3722551,8.6054427 26.5275299,8.6054427 C27.6723326,8.48944704 28.4179712,8.45636237 29.5795388,8.45636237 C32.1800931,8.45636237 32.9780222,9.16907795 32.9780222,10.694959 L32.9780222,11.6073784 C32.9780222,11.7564587 32.8566763,11.8393697 32.7349313,11.8393697 L29.4577938,11.8393697 C26.5798204,11.8393697 24.8634147,13.2317162 24.8634147,15.768872 C24.8634147,18.1071213 26.7534568,19.781684 29.6146653,19.781684 C31.4001264,19.781684 32.1114369,19.516608 32.7006031,18.9860574 C32.8566763,18.8365785 33.1340954,18.9525741 33.1340954,19.1351377 L33.1340954,19.3177014 C33.1340954,19.4667817 33.2554413,19.5496927 33.3767872,19.5496927 L36.2547605,19.5496927 C36.4108337,19.5496927 36.4978515,19.433697 36.4978515,19.3177014 L36.4978515,10.794213 C36.5321796,7.42834589 34.0876985,5.80321087 29.9264125,5.80321087 L29.9264125,5.80321087 Z M33.0123503,14.5750336 C33.0123503,16.2830796 31.8332195,17.4107487 29.9264125,17.4107487 C28.4702617,17.4107487 27.7070599,16.8801981 27.7070599,15.7856137 C27.7070599,14.5750336 28.5045898,14.0775677 29.9264125,14.0775677 L32.7349313,14.0775677 C32.8914036,14.0775677 32.9780222,14.1935633 32.9780222,14.3099576 L32.9780222,14.5750336 L33.0123503,14.5750336 Z"
                                                        id="Fill-21"></path>
                                                <path
                                                        d="M70.879694,5.80321087 C69.649071,5.80321087 68.3485943,5.88612185 67.1175721,6.06828685 C66.9962262,6.10177013 66.8748803,6.21776579 66.9267717,6.33376145 L67.2041908,8.37345139 C67.238918,8.48944704 67.3255366,8.6054427 67.4812107,8.6054427 C68.6260134,8.48944704 69.371652,8.45636237 70.5332196,8.45636237 C73.1337739,8.45636237 73.931703,9.16907795 73.931703,10.694959 L73.931703,11.6073784 C73.931703,11.7564587 73.8099579,11.8393697 73.688612,11.8393697 L70.4118737,11.8393697 C67.5335012,11.8393697 65.8170954,13.2317162 65.8170954,15.768872 C65.8170954,18.1071213 67.7071376,19.781684 70.5679469,19.781684 C72.353408,19.781684 73.0647185,19.516608 73.6538847,18.9860574 C73.8099579,18.8365785 74.0877761,18.9525741 74.0877761,19.1351377 L74.0877761,19.3177014 C74.0877761,19.4667817 74.209122,19.5496927 74.3304679,19.5496927 L77.2084413,19.5496927 C77.3645145,19.5496927 77.4515323,19.433697 77.4515323,19.3177014 L77.4515323,10.794213 C77.5377517,7.42834589 75.0413792,5.80321087 70.879694,5.80321087 L70.879694,5.80321087 Z M73.9660311,14.5750336 C73.9660311,16.2830796 72.7869003,17.4107487 70.879694,17.4107487 C69.4235433,17.4107487 68.6603415,16.8801981 68.6603415,15.7856137 C68.6603415,14.5750336 69.4578714,14.0775677 70.879694,14.0775677 L73.688612,14.0775677 C73.8450844,14.0775677 73.931703,14.1935633 73.931703,14.3099576 L73.931703,14.5750336 L73.9660311,14.5750336 Z"
                                                        id="Fill-23"></path>
                                            </g>
                                        </g>
                                    </g>
                                </g>
                            </g>
                        </g>
                    </svg>
                </div>
                <p class="col-header imagine-title">Imagine a world without malware. We do. </p>

                <p>
                    <a href="//www.malwarebytes.com/for-home/" id="cta-footernavigation-company-linkto-for_home-en" class="for-home-link-en">FOR
                        PERSONAL</a>
                </p>
                <p>
                    <a href="//www.malwarebytes.com/business/" id="cta-footernavigation-company-linkto-for_business-en">FOR
                        BUSINESS</a>
                </p>

            </div>
            <!-- company -->
            <div class="col-md-2 col-xs-12 col-md-pull-3 footer-col company-col">
                <p class="col-header">COMPANY</p>
                <p>
                    <a href="//www.malwarebytes.com/company/" id="cta-footernavigation-company-linkto-about_us-en">ABOUT
                        US</a>
                </p>
                <p>
                    <a href="https://jobs.malwarebytes.com/"
                       id="cta-footernavigation-learn-linkto-careers-en">CAREERS</a>
                </p>
                <p>
                    <a href="https://press.malwarebytes.com/"
                       id="cta-footernavigation-learn-linkto-news_and_press-en">NEWS AND
                        PRESS</a>
                </p>
            </div>
            <!-- my account -->
            <div class="col-md-2 col-xs-12 col-md-pull-3 footer-col">
                <p class="col-header">MY ACCOUNT</p>
                <p>
                    <a href="https://my.malwarebytes.com/en/login"
                       id="cta-footernavigation-myaccount-linkto-sign_in-en">SIGN
                        IN</a>
                </p>
            </div>
            <!-- contact us -->
            <div class="col-md-3 col-xs-12 col-md-pull-3 footer-col">
                <p class="col-header">CONTACT US</p>
                <p>
                    <a href="https://support.malwarebytes.com/hc/en-us" class="pillar-page-lightbox"
                       id="cta-footernavigation-contactus-linkto-get_support-en">GET
                        SUPPORT</a>
                </p>
                <p>
                    <a href="https://www.malwarebytes.com/contact/" class="pillar-page-lightbox"
                       id="cta-footernavigation-contactus-linkto-contact_sales-en">CONTACT
                        SALES</a>
                </p>
                <div class="address">
                    <!-- icon here -->
                    <div class="hq">
                        <img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/footer/ic-pin-map.svg" alt="Map pin">
                        <div class="address-text">
                            3979 Freedom Circle, 12th Floor<br />Santa Clara, CA 95054
                        </div>
                    </div>
                    <div class="local hidden outside-na">
                        <img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/footer/ic-pin-map.svg" alt="Map pin">
                        <div class="address-text">
                            One Albert Quay, 2nd Floor<br />Cork T12 X8N6<br />Ireland
                        </div>
                    </div>
                </div>

            </div>

        </div>
        <div class="row soc-icon-row hidden-md hidden-lg">
            <div class="footer-soc-icon">
                <a id="cta-footer-social-twitter-en" class="social socicon-twitter"
                   href="https://twitter.com/malwarebytes" aria-label="Visit Malwarebytes on Twitter"></a>
            </div>
            <div class="footer-soc-icon">
                <a id="cta-footer-social-facebook-en" class="social socicon-facebook"
                   href="https://www.facebook.com/Malwarebytes/" aria-label="Visit Malwarebytes on Facebook"></a>
            </div>
            <div class="footer-soc-icon">
                <a id="cta-footer-social-linkedin-en" class="social socicon-linkedin"
                   href="https://www.linkedin.com/company/malwarebytes"
                   aria-label="Visit Malwarebytes on LinkedIn"></a>
            </div>
            <div class="footer-soc-icon">
                <a id="cta-footer-social-youtube-en" class="social socicon-youtube"
                   href="https://www.youtube.com/user/Malwarebytes" aria-label="Visit Malwarebytes on YouTube"></a>
            </div>
            <div class="footer-soc-icon">
                <a id="cta-footer-social-instagram-en" class="social socicon-instagram-v2"
                   href="https://www.instagram.com/malwarebytesofficial/"
                   aria-label="Visit Malwarebytes on Instagram"></a>
            </div>
        </div>

    </div>
    <div class="footer-bottom">
        <div class="container">
            <div class="row">
                <div class="col-xs-10 col-md-2">
                    <div class="lang-select-container">
                        <img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/footer/world.svg" alt="Globe icon">
                        &nbsp;&nbsp; <a href="#" class="language-select col-header"
                                        id="cta-footernavigation-linkto-languageselect-en">English</a>
                    </div>
                </div>
                <div class="col-xs-12 col-md-10 legal-list-col">
                    <div class="legal-list">
                        <div class="legal-link">
                            <a class="legal" href="//www.malwarebytes.com/legal/" id="cta-footernavigation-linkto-legal-en">Legal</a>
                        </div>
                        <div class="legal-link">
                            <a class="legal" href="//www.malwarebytes.com/privacy/" id="cta-footernavigation-linkto-privacy-en">Privacy</a>
                        </div>
                        <div class="legal-link">
                            <a class="legal" href="//www.malwarebytes.com/accessibility/"
                               id="cta-footernavigation-linkto-accessibility-en">Accessibility</a>
                        </div>

                        <div class="legal-link legal-last">
                            <a class="legal" href="//www.malwarebytes.com/tos/" id="cta-footernavigation-linkto-tos-en">Terms of Service</a>
                        </div>
                    </div>
                    <br class="hidden-md hidden-lg">
                    <p class="p-year">&copy;
                        <script>
                          $(document).ready(function () {
                            var d = new Date();
                            var year = d.getFullYear();
                            $(".currentYear").text(year);
                          });
                        </script><span class="currentYear"></span> All Rights Reserved</p>
                </div>
            </div>

        </div>
    </div>

</footer>

<!-- language select overlay -->
<section id="overlay-lang" class="text-center text-white" style="overflow-y: scroll;">
  <div class="container">
    <div class="row center-row">
      <div class="col-md-10">
     
        <p class="h2">Select your language</p>
      </div>
    </div>
    <div class="row center-row">
      <div class="col-md-5">
        <div class="text-center">
          <ul class="list-unstyled" id="intl-sites">
            </ul>
        </div>
      </div>
      
    </div>
  </div>
</section>
<!-- pillar page select overlay -->
<section id="pillar-pages" class="text-white overlay" style="overflow-y: scroll; display: none;">
  <div class="container">
    <div class="row">
      <div class="col-md-10">
        <p class="h2"><a href="https://www.malwarebytes.com/cybersecurity/" id="cta-labs-footernavigation-lightbox-learn-linkto-cybersecurity-en">Cybersecurity basics</a></p>
        <p>Your intro to everything relating to cyberthreats, and how to stop them.</p>
      </div>
    </div>
    <div class="row"> 
      <div class="col-md-8 pillar-pages-list">
              
              
              
            </div>
    </div>
  </div>
</section>
 <script>
  overlay('.language-select', '#overlay-lang');
  overlay('.pillar-page-lightbox', '#pillar-pages');
</script>

	<div style="display:none">
	<div class="grofile-hash-map-5d5dda1e7e00492cdb89a26415b1fa8f">
	</div>
	</div>
<link rel='stylesheet' id='jetpack-carousel-css'  href='https://blog.malwarebytes.com/wp-content/plugins/jetpack/modules/carousel/jetpack-carousel.css?ver=9.4' type='text/css' media='all' />
<script type='text/javascript' id='disqus_count-js-extra'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"malwarebytesunpacked"};
/* ]]> */
</script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-content/plugins/disqus-comment-system/public/js/comment_count.js?ver=3.0.21' id='disqus_count-js'></script>
<script type='text/javascript' id='disqus_embed-js-extra'>
/* <![CDATA[ */
var embedVars = {"disqusConfig":{"integration":"wordpress 3.0.21"},"disqusIdentifier":"38724 https:\/\/blog.malwarebytes.com\/?p=38724","disqusShortname":"malwarebytesunpacked","disqusTitle":"The Hidden Bee infection chain, part 1: the stegano pack","disqusUrl":"https:\/\/blog.malwarebytes.com\/threat-analysis\/2019\/08\/the-hidden-bee-infection-chain-part-1-the-stegano-pack\/","postId":"38724"};
/* ]]> */
</script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-content/plugins/disqus-comment-system/public/js/comment_embed.js?ver=3.0.21' id='disqus_embed-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-includes/js/imagesloaded.min.js?ver=4.1.4' id='imagesloaded-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-includes/js/masonry.min.js?ver=4.2.2' id='masonry-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-includes/js/jquery/jquery.masonry.min.js?ver=3.1.2b' id='jquery-masonry-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/js/functions.js?ver=2013-07-18' id='mb_labs-script-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-includes/js/wp-embed.min.js?ver=5.6.2' id='wp-embed-js'></script>
<script type='text/javascript' id='jetpack-carousel-js-extra'>
/* <![CDATA[ */
var jetpackCarouselStrings = {"widths":[370,700,1000,1200,1400,2000],"is_logged_in":"","lang":"en","ajaxurl":"https:\/\/blog.malwarebytes.com\/wp-admin\/admin-ajax.php","nonce":"d36e4f7e5d","display_exif":"1","display_comments":"1","display_geo":"1","single_image_gallery":"1","single_image_gallery_media_file":"","background_color":"black","comment":"Comment","post_comment":"Post Comment","write_comment":"Write a Comment...","loading_comments":"Loading Comments...","download_original":"View full size <span class=\"photo-size\">{0}<span class=\"photo-size-times\">\u00d7<\/span>{1}<\/span>","no_comment_text":"Please be sure to submit some text with your comment.","no_comment_email":"Please provide an email address to comment.","no_comment_author":"Please provide your name to comment.","comment_post_error":"Sorry, but there was an error posting your comment. Please try again later.","comment_approved":"Your comment was approved.","comment_unapproved":"Your comment is in moderation.","camera":"Camera","aperture":"Aperture","shutter_speed":"Shutter Speed","focal_length":"Focal Length","copyright":"Copyright","comment_registration":"1","require_name_email":"0","login_url":"https:\/\/blog.malwarebytes.com\/wp-login.php?redirect_to=https%3A%2F%2Fblog.malwarebytes.com%2Fthreat-analysis%2F2019%2F08%2Fthe-hidden-bee-infection-chain-part-1-the-stegano-pack%2F","blog_id":"1","meta_data":["camera","aperture","shutter_speed","focal_length","copyright"],"local_comments_commenting_as":"<p id=\"jp-carousel-commenting-as\">You must be <a href=\"#\" class=\"jp-carousel-comment-login\">logged in<\/a> to post a comment.<\/p>"};
/* ]]> */
</script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-content/plugins/jetpack/_inc/build/carousel/jetpack-carousel.min.js?ver=9.4' id='jetpack-carousel-js'></script>
<script src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/js/standard-search-results-footer.js" type="text/javascript"></script>
<script type="text/javascript">
  var countryError, country;
  $.browser = {};
  (function() {
    $.browser.msie = false;
    $.browser.version = 0;
    if (navigator.userAgent.match(/MSIE ([0-9]+)\./)) {
      $.browser.msie = true;
      $.browser.version = RegExp.$1;
    }
  })();
  // Use Microsoft XDR for IE8/9
  if ($.browser.msie && window.XDomainRequest && $.browser.version < 10) {
    //console.log("browser is IE less than 10");

    var xdr = new XDomainRequest();
    xdr.open("GET", "https://genesis.malwarebytes.com/api/v1/wai.gif");
    xdr.onload = function() {
      //console.log("onload function");
      // use xdr.responseText for ie8/9, since unable to specify JSON accept request header
      var dom = new ActiveXObject("Microsoft.XMLDOM");
      var data = $.parseJSON(xdr.responseText);
      //console.log("IE data: " + data);
      dom.async = false;
      if (data == null || typeof(data) == "undefined") {
        // console.log("data is null or undefined");
        window.countryError = data["error"]["errorCode"];
      }
      window.country = data["location"]["countryCode"];
      //console.log("IE country in geo: " + country);
    };
    // function to call when an error occurs
    xdr.onerror = function() {
      //console.log("onerror XDR");
      window.countryError = data["error"]["errorCode"];
    };
    //console.log("before the send");
    xdr.send();
    //console.log("after the function");
  } else { // not IE 8/9, so use AJAX
    $.ajax({
      url: "https://genesis.malwarebytes.com/api/v1/wai.gif",
      type: "GET",
      crossDomain: true,
      dataType: "json",
      success: function(data) {
        //set country     
        //console.log("in success" + JSON.stringify(data));
        window.country = data["location"]["countryCode"];
      },
      error: function(data, jqXHR, textStatus, errorThrown) {
        //      console.log('geohtml genesis error POST1: ' + JSON.stringify(data)); 
        //      console.log("jqXHR: " + jqXHR);
        //      console.log("textStatus: " + textStatus);
        //      console.log("errorThrown: " + errorThrown);
        window.countryError = data["error"]["errorCode"];
      },
      async: false
    });
  }
</script>

<script type="text/plain" class="optanon-category-4">
  $("script[src='https://malwarebytesunpacked.disqus.com/embed.js']").each(function() {
    var scriptSrc = $(this).attr("src");
    var newScript = "<script type='text/javascript' async='' src='" + scriptSrc + "'>";
    $(this).before(newScript).remove();
  });
</script>

<!--replace with onetrust -->

<!---->

<script>
/*
  function enableCookies() {
    //fire inline scripts
    $('.ce-script').each(function() {
      var scripts = $(this).text();
      var scriptParent = $(this).parent();
      //console.log($(this).attr('data-ce-src'));
      if (!$(this).attr('data-ce-src')) {
        //console.log('no attribute')
          //fire marketo forms
        if (scripts.indexOf("MktoForms2") > -1) {
          
          //set interval for mkto
          var mktoInt = setInterval(function() {
            if(typeof(MktoForms2) !== "undefined") {
              clearInterval(mktoInt);
              $(scriptParent).append('<script>' + scripts + '<\/script>');
              $(scriptParent).append("<script>(function(d,b,a,s,e){ var t = b.createElement(a),fs = b.getElementsByTagName(a)[0]; t.async=1; t.id=e; t.src=('https:'==document.location.protocol ? 'https://' : 'http://') + s; fs.parentNode.insertBefore(t, fs); })(window,document,'script','scripts.demandbase.com/HWyTnY16.min.js','demandbase_js_lib');<\/script>");
              
            }
          }, 10);
        } else {

          $(scriptParent).append('<script>' + scripts + '<\/script>');
        }
      } else {
        var attr = $(this).attr('data-ce-src');
        $(this).attr('src', attr);
        //console.log('attribute is: ' + attr);
        $(scriptParent).append('<script src="' + attr + '"><\/script>');
      }
      //console.log(scripts);
    });
    
    //iframes
    
    $('.ce-iframe').each(function() {
      var iframesrc = $(this).attr('data-ce-src');
      $(this).attr('src', iframesrc);
    });
    
    
  }

  var gdprCountries = [
    "BE",
    "BG",
    "CZ",
    "DK",
    "DE",
    "EE",
    "IE",
    "EL",
    "ES",
    "FR",
    "HR",
    "IT",
    "CY",
    "LV",
    "LT",
    "LU",
    "HU",
    "MT",
    "NL",
    "AT",
    "PL",
    "PT",
    "RO",
    "SI",
    "SK",
    "FI",
    "SE",
    "UK",
    "GB"
  ];
  //read user preference cookie
  var cookiePreference = $.cookie('ce-cookie');
  

  
  
  //cookie config
  if (gdprCountries.indexOf(country) > -1) {
    if (cookiePreference === "N" && cookiePreference !== "Y") {
      $(window).load(function() {
        $('a[href*="https://my.malwarebytes"]').attr('href','https://www.malwarebytes.com/myaccount-consent');
        //$('form[id*="mktoForm"]').append('<p>To view this content you need to enable cookies. <br>' + '<a style="text-decoration: underline;" href="#" class="ce-accept">Enable All Cookies</a>' + '</p>');
      });

    } else {
      enableCookies();
    }

    //variable for cookies to fire or not
    //var cookies = "no";

    //if (cookies === "yes") {
    //  enableCookies();
    //}
    
    //remove for onetrust
    COOKIES_ENABLER.init({
      scriptClass: 'ce-script',
      iframeClass: 'ce-iframe',
      acceptClass: 'ce-accept',
      dismissClass: 'ce-dismiss',
      disableClass: 'ce-disable',
      bannerClass: 'ce-banner',
      bannerHTML: '<p>By continuing to browse our website or by clicking "Accept All Cookies," you agree to the storing of first- and third-party cookies on your device to enhance site navigation, analyze site usage, and assist in our marketing efforts. <a href="https://www.malwarebytes.com/privacy/" style="margin-left:0;" id="cta-labs-cookiegdpr-linkto-privacypolicy-en">Privacy and Cookie Policy</a><br>' + '<a href="#" class="ce-accept bluecta-sm" style="width: auto; padding-left:10px; padding-right:10px;" id="cta-labs-cookiegdpr-acceptallcookies-en">' + 'Accept All Cookies' + '</a>' + '<a href="#" class="ce-disable ce-disable" id="cta-labs-cookiegdpr-disableallcookies-en">Disable Cookies</a>' + '</p>',
      eventScroll: false,
      scrollOffset: 200,
      clickOutside: false,
      cookieName: 'ce-cookie',
      cookieDuration: '365',
      wildcardDomain: true,
      iframesPlaceholder: true,
      iframesPlaceholderHTML: '<p>To view this content you need to enable cookies. <br>' + '<a style="text-decoration: underline;" href="#" class="ce-accept"  id="cta-labs-cookiegdpr-enablecookies-viaiframe-en">Enable All Cookies</a>' + '</p>',
      iframesPlaceholderClass: 'ce-iframe-placeholder',
      // Callbacks
      onEnable: function() {
        //enableCookies();
      },
      onDismiss: function() {
        //console.log('the banner has been dismissed');
      },
      onDisable: function() {
        $('a[href*="https://my.malwarebytes"]').attr('href','https://www.malwarebytes.com/myaccount-consent');
        $('form[id*="mktoForm"]').append('<p id="consent-message">To view this content you need to enable cookies. <br>' + '<a style="text-decoration: underline;" href="#" class="ce-accept">Enable All Cookies</a>' + '</p>');
        $('#consent-message .ce-accept').click(function() {
          setTimeout(function() {
            window.location.reload()
          }, 250);
          $('#consent-message').remove();
        });
      }
    });
  } else {
    enableCookies();
  }
  */
</script>
<style>
  .ce-banner {
    display: block;
    position: fixed;
    width: 100vw;
    background: #fff;
    bottom: 0;
    left: 0;
    z-index: 99999;
    box-sizing: border-box;
    padding: 20px;
    text-align: center;
    box-shadow: 0px 0px 20px #424242;
  }
  
  .ce-banner a {
    margin: 0 10px;
  }
</style>
<script>
$(document).ready(function() {
  $.getJSON("https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/pillarpages.json", function(allpillarpages){
    number_of_pillar_pages_to_show = 5;
    var pillar_card_slug;

    function pillar_card() {
      if (typeof allpillarpages[i].uri === "undefined") { 
        var pillar_card_slug = allpillarpages[i].pillarpage.replace(" ", "-").toLowerCase();
      }
      else {
        var pillar_card_slug = allpillarpages[i].uri;
      }
      var pillar_card_html = '<div class="col-md-3"><p><a href="https://www.malwarebytes.com/' + pillar_card_slug + '/" id="cta-labs-footernavigation-lightbox-learn-linkto-' + pillar_card_slug + '-en">' + allpillarpages[i].pillarpage +'</a></p></div>';
      
      var pillar_card_list_html = '<p><a href="https://www.malwarebytes.com/' + pillar_card_slug + '/" id="cta-labs-footernavigation-learn-linkto-' + pillar_card_slug + '-en">' + allpillarpages[i].pillarpage +'</a></p>'
      
      $("section#pillar-pages .pillar-pages-list").append(pillar_card_html);
      
      if ([i] < number_of_pillar_pages_to_show) {
        $("footer .pillar-pages-list").append(pillar_card_list_html);
      }
    };
    for (i=0;i<allpillarpages.length;i++) {
      pillar_card();
    } 
  });
});
</script>
<script>
$(document).ready(function() {
  $.getJSON("https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/intl-sites.json", function(intlSites){

    function listIntlSites() {
      let indCountry = '<li><a href="' + intlSites[i].url + '/" class="' + intlSites[i].country + '-site" id="cta-labs-footer-linkto-' + intlSites[i].country + '_site-en">' + intlSites[i].lang + '</a></li>'
      $("#intl-sites").append(indCountry);
    };
    for (i=0;i<intlSites.length;i++) {
            listIntlSites();
          }  
  });
});
</script>
</body>
</html>