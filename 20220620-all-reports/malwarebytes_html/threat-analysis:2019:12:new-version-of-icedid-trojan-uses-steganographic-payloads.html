<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>

  
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
    <!-- Taken from www.malwarebytes.com -->
  <!-- Fav Ico -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel='shortcut icon' href='//www.malwarebytes.com/images/favicon.ico' type='image/x-icon' />
  <link rel="apple-touch-icon" sizes="57x57" href="//www.malwarebytes.com/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="//www.malwarebytes.com/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="//www.malwarebytes.com/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="//www.malwarebytes.com/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="//www.malwarebytes.com/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="//www.malwarebytes.com/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="//www.malwarebytes.com/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="//www.malwarebytes.com/apple-touch-icon-152x152.png">
  <link rel="icon" type="image/png" href="//www.malwarebytes.com/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="///www.malwarebytes.com/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="//www.malwarebytes.com/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="//www.malwarebytes.com/manifest.json">
  <meta name="msapplication-TileColor" content="#2b5797">
  <meta name="msapplication-TileImage" content="//www.malwarebytes.com/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">
  
<title>

New version of IcedID Trojan uses steganographic payloads - | Malwarebytes Labs  </title>
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="https://blog.malwarebytes.com/xmlrpc.php">

  
	<!-- Meta Tag Manager -->
	<meta property="fb:app_id" content="358351844222748" />
	<!-- / Meta Tag Manager -->

	<!-- This site is optimized with the Yoast SEO plugin v15.9 - https://yoast.com/wordpress/plugins/seo/ -->
	<meta name="description" content="We take a deep dive into the IcedID Trojan, describing the distribution, new payloads, and functionality of this advanced malware." />
	<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
	<link rel="canonical" href="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/" />
	<meta property="og:locale" content="en_US" />
	<meta property="og:type" content="article" />
	<meta property="og:title" content="New version of IcedID Trojan uses steganographic payloads -" />
	<meta property="og:description" content="We take a deep dive into the IcedID Trojan, describing the distribution, new payloads, and functionality of this advanced malware." />
	<meta property="og:url" content="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/" />
	<meta property="og:site_name" content="Malwarebytes Labs" />
	<meta property="article:published_time" content="2019-12-03T18:06:13+00:00" />
	<meta property="article:modified_time" content="2020-01-10T12:37:20+00:00" />
	<meta property="og:image" content="https://blog.malwarebytes.com/wp-content/uploads/2019/11/shutterstock_724512754-1.png" />
	<meta property="og:image:width" content="800" />
	<meta property="og:image:height" content="400" />
	<meta name="twitter:card" content="summary" />
	<meta name="twitter:creator" content="@malwarebytes" />
	<meta name="twitter:site" content="@malwarebytes" />
	<meta name="twitter:label1" content="Written by">
	<meta name="twitter:data1" content="Threat Intelligence Team">
	<meta name="twitter:label2" content="Est. reading time">
	<meta name="twitter:data2" content="21 minutes">
	<script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://blog.malwarebytes.com/#website","url":"https://blog.malwarebytes.com/","name":"Malwarebytes Labs","description":"The Security Blog From Malwarebytes","potentialAction":[{"@type":"SearchAction","target":"https://blog.malwarebytes.com/?s={search_term_string}","query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"ImageObject","@id":"https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/#primaryimage","inLanguage":"en-US","url":"https://blog.malwarebytes.com/wp-content/uploads/2019/11/shutterstock_724512754-1.png","width":800,"height":400},{"@type":"WebPage","@id":"https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/#webpage","url":"https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/","name":"New version of IcedID Trojan uses steganographic payloads -","isPartOf":{"@id":"https://blog.malwarebytes.com/#website"},"primaryImageOfPage":{"@id":"https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/#primaryimage"},"datePublished":"2019-12-03T18:06:13+00:00","dateModified":"2020-01-10T12:37:20+00:00","author":{"@id":"https://blog.malwarebytes.com/#/schema/person/4d881617b9245231b3fc06670c79ffeb"},"description":"We take a deep dive into the IcedID Trojan, describing the distribution, new payloads, and functionality of this advanced malware.","breadcrumb":{"@id":"https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/#breadcrumb"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/"]}]},{"@type":"BreadcrumbList","@id":"https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://blog.malwarebytes.com/","url":"https://blog.malwarebytes.com/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/","url":"https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/","name":"New version of IcedID Trojan uses steganographic payloads"}}]},{"@type":"Person","@id":"https://blog.malwarebytes.com/#/schema/person/4d881617b9245231b3fc06670c79ffeb","name":"Threat Intelligence Team","image":{"@type":"ImageObject","@id":"https://blog.malwarebytes.com/#personlogo","inLanguage":"en-US","url":"https://secure.gravatar.com/avatar/147cd7280d6ece931e4488a3a10809d9?s=96&d=identicon&r=g","caption":"Threat Intelligence Team"}}]}</script>
	<!-- / Yoast SEO plugin. -->


<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel='dns-prefetch' href='//v0.wordpress.com' />
<link rel="alternate" type="application/rss+xml" title="Malwarebytes Unpacked" href="http://blog.malwarebytes.org/feed/" />
<link rel="alternate" type="application/rss+xml" title="Malwarebytes Unpacked | Comments" href="http://blog.malwarebytes.org/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Malwarebytes Labs &raquo; New version of IcedID Trojan uses steganographic payloads Comments Feed" href="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/blog.malwarebytes.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.6.2"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css'  href='https://blog.malwarebytes.com/wp-includes/css/dist/block-library/style.min.css?ver=5.6.2' type='text/css' media='all' />
<style id='wp-block-library-inline-css' type='text/css'>
.has-text-align-justify{text-align:justify;}
</style>
<link rel='stylesheet' id='responsive-lightbox-prettyphoto-css'  href='https://blog.malwarebytes.com/wp-content/plugins/responsive-lightbox/assets/prettyphoto/prettyPhoto.min.css?ver=2.3.2' type='text/css' media='all' />
<link crossorigin="anonymous" rel='stylesheet' id='mb_labs-fonts-css'  href='//fonts.googleapis.com/css?family=Source+Sans+Pro%3A300%2C400%2C700%2C300italic%2C400italic%2C700italic%7CBitter%3A400%2C700&#038;subset=latin%2Clatin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='genericons-css'  href='https://blog.malwarebytes.com/wp-content/plugins/jetpack/_inc/genericons/genericons/genericons.css?ver=3.1' type='text/css' media='all' />
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-includes/js/jquery/jquery.min.js?ver=3.5.1' id='jquery-core-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.3.2' id='jquery-migrate-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-content/plugins/responsive-lightbox/assets/prettyphoto/jquery.prettyPhoto.min.js?ver=2.3.2' id='responsive-lightbox-prettyphoto-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-includes/js/underscore.min.js?ver=1.8.3' id='underscore-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-content/plugins/responsive-lightbox/assets/infinitescroll/infinite-scroll.pkgd.min.js?ver=5.6.2' id='responsive-lightbox-infinite-scroll-js'></script>
<script type='text/javascript' id='responsive-lightbox-js-extra'>
/* <![CDATA[ */
var rlArgs = {"script":"prettyphoto","selector":"lightbox","customEvents":"","activeGalleries":"1","animationSpeed":"normal","slideshow":"0","slideshowDelay":"5000","slideshowAutoplay":"0","opacity":"0.75","showTitle":"1","allowResize":"1","allowExpand":"1","width":"1080","height":"720","separator":"\/","theme":"pp_default","horizontalPadding":"20","hideFlash":"0","wmode":"opaque","videoAutoplay":"0","modal":"0","deeplinking":"0","overlayGallery":"1","keyboardShortcuts":"1","social":"0","woocommerce_gallery":"0","ajaxurl":"https:\/\/blog.malwarebytes.com\/wp-admin\/admin-ajax.php","nonce":"9646d3573c"};
/* ]]> */
</script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-content/plugins/responsive-lightbox/js/front.js?ver=2.3.2' id='responsive-lightbox-js'></script>
<link rel="https://api.w.org/" href="https://blog.malwarebytes.com/wp-json/" /><link rel="alternate" type="application/json" href="https://blog.malwarebytes.com/wp-json/wp/v2/posts/40994" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://blog.malwarebytes.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://blog.malwarebytes.com/wp-includes/wlwmanifest.xml" /> 
<link rel='shortlink' href='https://blog.malwarebytes.com/?p=40994' />
<link rel="alternate" type="application/json+oembed" href="https://blog.malwarebytes.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblog.malwarebytes.com%2Fthreat-analysis%2F2019%2F12%2Fnew-version-of-icedid-trojan-uses-steganographic-payloads%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://blog.malwarebytes.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblog.malwarebytes.com%2Fthreat-analysis%2F2019%2F12%2Fnew-version-of-icedid-trojan-uses-steganographic-payloads%2F&#038;format=xml" />
	<style type="text/css" id="mb_labs-header-css">
			.site-header {
			background: url(https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/headers/circle.png) no-repeat scroll top;
			background-size: 1600px auto;
		}
		</style>
	<link rel="amphtml" href="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/amp/">    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.css" />
	<link rel="stylesheet" type="text/css" href="//www.malwarebytes.com/css/style.css?12-20-2016" />
	<link rel="stylesheet" type="text/css" href="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/style.css?03-03-2021" />


  <script src="//www.malwarebytes.com/js/jquery-1.11.3.min.js" type="text/javascript"></script>

<!-- OneTrust Cookies Consent Notice (Production Standard, malwarebytes.com, en-GB) start -->

<script src="https://optanon.blob.core.windows.net/consent/9530a107-0af8-4204-a2c2-217efb78222b.js" type="text/javascript" charset="UTF-8"></script>

<script type="text/javascript">

function OptanonWrapper() { }

</script>

<!-- OneTrust Cookies Consent Notice (Production Standard, malwarebytes.com, en-GB) end -->

  <script src="//www.malwarebytes.com/js/bootstrap.js" type="text/javascript"></script>
  <script src="//www.malwarebytes.com/js/ie-fixes/respond.min.js" type="text/javascript"></script>

<script src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/modernizr.js"></script>
<!--[if gte IE 9]><!-->
<script type="text/javascript" src="//www.malwarebytes.com/js/nav-resize.js"></script>
<!--<![endif]-->
	
  <script src="//www.malwarebytes.com/js/flexibility.js"></script>

  <!--<script src="//www.malwarebytes.com/js/nav.js"></script>-->
  <script>
function readCookie(name) {
  var nameEQ = name + "=";
  var ca = document.cookie.split(';');
  for (var i = 0; i < ca.length; i++) {
    var c = ca[i];
    while (c.charAt(0) == ' ') c = c.substring(1, c.length);
    if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
  }
  return null;
}

//disable functions based on cookie preference
var acceptCookies = readCookie('ce-cookie');
if (acceptCookies === "N") {
    $('body').css('visibility','visible');
    function setCookie() {
        return false;
    }
}
  
  
  
</script>
 
  <script src="//www.malwarebytes.com/js/global.js"></script>

  <script src="//www.malwarebytes.com/js/xs.js"></script>
  <script src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/js/search.js"></script>

<link rel="amphtml" href="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/amp/">
<script>
$(document).ready(function() {
  $("link[rel=amphtml]").each(function(){
    amphtml = $(this).attr("href");
    $(this).attr("href",amphtml.replace("/?amp","/amp"));
  });
});
</script>

<!-- New nav -->
  <link href="//www.malwarebytes.com/css/NEW-NAV.css" rel="stylesheet" type="text/css">
  <script src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/js/new-nav.js" type="text/javascript"></script>

  
</head>
<body>
<!-- Google Tag Manager -->
<noscript>
<iframe src="//www.googletagmanager.com/ns.html?id=GTM-MKSKW3"
height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MKSKW3');</script> 
<!-- End Google Tag Manager --> 

  
  

<!-- global nav -->
<nav id="mbnav" class="abtest">
    <div id="nav-background"></div>
    <div class="nav-container">
        <div class="logo">
            <a href="/" id="cta-navbar-company-logo-en-test">
                <!--<img src="https://blog.malwarebytes.com/wp-content/themes/labs.malwarebytes.org-1.7d/images/labs-log-w-tagline.svg" id="mb-labs-logo">-->
                <script>
                  $('document').ready(function () {
                    setTimeout(function () {
                      $('#main-logo, #logo-tagline').attr('class', 'changed');
                    }, 3000);
                    setTimeout(function () {
                      $('#main-logo, #logo-tagline').attr('class', '');
                    }, 7000);
                  })
                </script>

                <svg version="1.1" id="main-logo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="-672 235.9 278.5 31.1" style="enable-background:new -672 235.9 254.5 31.1;" xml:space="preserve" class="" aria-labelledby="malwarebytes-main-logo-title malwarebytes-main-logo-desc" role="img">
    <title id="malwarebytes-main-logo-title">The official Malwarebytes logo</title>
                    <desc id="malwarebytes-main-logo-desc">The official Malwarebytes logo in a blue font</desc>
                    <image src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/malwarebytes-labs-logo.png" xlink:href=""></image>
                    <style type="text/css">
                        .st0 {
                            fill: #0D3ECC !important;
                        }

                        .st1 {
                            fill: #414042;
                        }

                        .st2 {
                            fill: none;
                        }

                        .st3 {
                            enable-background: new;
                        }

                        .st4 {
                            fill: #FFFFFF;
                        }
                    </style>
                    <path id="logo-icon" class="st0" d="M-659.1,263.1C-659,263.1-659,263.1-659.1,263.1c0.3,0,0.4-0.2,0.4-0.4c0-0.2-0.1-0.3-0.3-0.4h-0.1h-0.2
  c-3.8-0.8-6.8-4.2-6.8-8.2c0-1.7,0.5-3.3,1.4-4.7c0.1-0.2,0.4-0.3,0.6-0.1l6.1,6.2c0.1,0.1,0.2,0.1,0.3,0.1s0.2,0,0.3-0.1l6.2-6.1
  c0.2-0.2,0.4-0.2,0.6,0c0.9,1.3,1.4,2.9,1.4,4.7c0,2.2-0.8,4.1-2.1,5.6c0,0-0.1,0.1-0.1,0.2v0.1c0,0.2,0.2,0.3,0.3,0.3l0,0
  c0,0,0.1,0,0.2-0.1c8.1-3.5,7.8-11.5,7.8-11.5c0-4.6-2.2-8.8-5.6-11.4c-0.2-0.1-0.4-0.1-0.5,0l-8.1,8.1c-0.2,0.2-0.4,0.2-0.5,0
  l-8.1-8.1c-0.1-0.1-0.4-0.2-0.5,0c-3.4,2.6-5.6,6.8-5.6,11.4l0,0C-672,256.2-666.3,262.3-659.1,263.1"></path>
                    <g id="logo-maintext">
                        <polygon class="st1" points="-446.9,260.3 -454.3,242.4 -461.7,260.4 -459.7,260.4 -458.3,256.8 -453.5,256.8 -457.4,254.5
    -454.3,246.9 -450.3,257.1 -453.8,257.1 -446.8,260.3   "></polygon>
                        <path class="st0" d="M-545.7,244L-545.7,244l-0.1-7.8c0-0.2-0.2-0.3-0.4-0.3l-2.2,0.3c-0.2,0-0.3,0.2-0.3,0.3v23.1
    c0,0.2,0.1,0.3,0.2,0.3c1.9,0.4,4.3,0.6,5.8,0.6c6.3,0,7.2-3,7.2-6.3v-6c0-3.5-1.6-5.3-4.9-5.3C-542.6,242.8-544.6,243.5-545.7,244
    z M-538.2,248v6.3c0,2.3-0.7,3.8-4.2,3.8c-1.2,0-2.3-0.1-3.4-0.2h-0.1v-11.3l0,0c1-0.5,3.1-1.3,4.7-1.3
    C-539.1,245.3-538.2,246.1-538.2,248z"></path>
                        <path class="st0" d="M-531.7,243.2h-2.1c-0.2,0-0.4,0.2-0.3,0.4l5.3,16.3c0,0.1,0.2,0.2,0.3,0.2h0.6c0.2,0,0.4,0.2,0.3,0.4
    l-2.1,6.1c-0.1,0.2,0.1,0.4,0.3,0.4h2c0.1,0,0.2-0.1,0.3-0.2l2.3-6.6l5.5-16.6c0.1-0.2-0.1-0.4-0.3-0.4h-2.1
    c-0.1,0-0.2,0.1-0.3,0.2l-4.4,13.8c-0.1,0.3-0.5,0.3-0.6,0l-4.4-13.8C-531.4,243.3-531.6,243.2-531.7,243.2z"></path>
                        <path class="st0" d="M-505.6,249.2v5.1c0,4.2,2.1,6.2,6.7,6.2c2,0,4.1-0.3,5.7-0.9c0.2,0,0.2-0.2,0.2-0.4l-0.3-1.6
    c0-0.2-0.2-0.3-0.4-0.2c-1.9,0.5-3.5,0.7-5,0.7c-3.5,0-4.1-1.3-4.1-3.8v-1.2c0-0.2,0.1-0.3,0.3-0.3h9.6c0.2,0,0.3-0.1,0.3-0.3v-3.2
    c0-4.3-2.1-6.4-6.3-6.4C-503.3,242.8-505.6,245-505.6,249.2z M-502.8,248.9c0-2.6,1.2-3.8,3.8-3.8s3.7,1.1,3.7,3.8v1.2
    c0,0.2-0.1,0.3-0.3,0.3h-6.9c-0.2,0-0.3-0.1-0.3-0.3L-502.8,248.9L-502.8,248.9z"></path>
                        <path class="st0" d="M-484.4,250.5c-2.9-0.7-3-1.1-3-3c0-1.6,0.4-2.2,2.9-2.2c1.2,0,2.9,0.2,4.3,0.4c0.2,0,0.4-0.1,0.4-0.3l0.2-1.7
    c0-0.2-0.1-0.3-0.2-0.3c-1.3-0.3-2.9-0.5-4.5-0.5c-4.2,0-5.8,1.2-5.8,4.5c0,3.5,0.4,4.4,4.6,5.4c3.4,0.8,3.6,1,3.6,2.9
    c0,1.8-0.4,2.4-3.2,2.4c-1.3,0-3.1-0.2-4.5-0.6c-0.2,0-0.4,0.1-0.4,0.2l-0.3,1.6c0,0.2,0.1,0.3,0.2,0.4c1.4,0.5,3.5,0.8,5.1,0.8
    c4.9,0,5.8-1.6,5.8-4.9C-479.2,252-479.8,251.6-484.4,250.5z"></path>
                        <g>
                            <path class="st0" d="M-613.7,259.9l-3-16.5c0-0.2,0.1-0.4,0.3-0.4h3.4c0.2,0,0.3,0.1,0.3,0.2l1.8,9.9c0,0.3,0.5,0.4,0.6,0l3-10
      c0-0.1,0.2-0.2,0.3-0.2h4c0.1,0,0.2,0.1,0.3,0.2l2.9,10c0.1,0.3,0.5,0.3,0.6,0l1.8-9.9c0-0.2,0.2-0.2,0.3-0.2h3.4
      c0.2,0,0.3,0.2,0.3,0.4l-3,16.5c0,0.2-0.2,0.2-0.3,0.2h-4.5c-0.1,0-0.2-0.1-0.3-0.2l-3.3-11c-0.1-0.3-0.5-0.3-0.6,0l-3.3,11
      c0,0.1-0.2,0.2-0.3,0.2h-4.5C-613.5,260.2-613.7,260.1-613.7,259.9z"></path>
                        </g>
                        <path class="st0" d="M-618.6,257c-1.5,0-2-0.7-2-2.6v-12.3v-4.9c0-0.2-0.2-0.3-0.4-0.3l-3.6,0.5c-0.2,0-0.3,0.2-0.3,0.3v0.2v4.2
    v12.8c0,3.9,2.4,5.6,5.5,5.6c0.3,0,1.5,0,2-0.1c0.2,0,0.3-0.2,0.3-0.3v-2.7c0-0.2-0.2-0.3-0.3-0.3C-617.8,257-618.3,257-618.6,257z
    "></path>
                        <g>
                            <path class="st0" d="M-566.9,246.8c-1.5,0.7-2.7,1.4-4.2,2.3c-0.1,0-0.2,0.2-0.2,0.3v10.5c0,0.2-0.1,0.3-0.3,0.3h-3.7
      c-0.2,0-0.3-0.1-0.3-0.3V244c0-0.2,0.1-0.3,0.2-0.3l3.1-0.5c0.2,0,0.3,0.1,0.4,0.2l0.2,1.1c0,0.2,0.3,0.3,0.5,0.2
      c0.9-0.6,2.5-1.5,3.7-1.9c0.2-0.1,0.4,0.1,0.4,0.3l0.4,3.3C-566.7,246.6-566.7,246.7-566.9,246.8z"></path>
                        </g>
                        <path class="st0" d="M-510,258.1c-1.7,0-1.8-0.8-1.8-2v-10.3c0-0.2,0.1-0.3,0.3-0.3h4c0.2,0,0.3-0.1,0.3-0.3l0.2-1.7
    c0-0.2-0.1-0.4-0.3-0.4h-4.2c-0.2,0-0.3-0.1-0.3-0.3v-3.9c0-0.2-0.2-0.3-0.4-0.3l-2.2,0.3c-0.2,0-0.3,0.2-0.3,0.3v3.7
    c0,0.2-0.1,0.3-0.3,0.3h-2.4c-0.2,0-0.3,0.1-0.3,0.3v1.7c0,0.2,0.1,0.3,0.3,0.3h2.4c0.2,0,0.3,0.1,0.3,0.3v10.8
    c0,2.7,1.2,3.8,4.2,3.8c0.7,0,1.3-0.1,2-0.2c0.2,0,0.2-0.2,0.2-0.3v-1.6c0-0.2-0.2-0.3-0.4-0.3C-509.1,258.1-509.5,258.1-510,258.1
    z"></path>
                        <path class="st2" d="M-557.3,246.2c-0.2,0-0.4,0-0.7,0c-2.1,0-2.8,1.1-2.8,2.7v1.5l0,0h5.4c0.2,0,0.3-0.1,0.3-0.3v-1.2
    C-555.1,247.4-555.7,246.4-557.3,246.2z"></path>
                        <path class="st0" d="M-554.5,243.3c-0.9-0.4-2.1-0.6-3.5-0.6c-1.6,0-3,0.3-4,0.8c-2.3,1.1-3.1,3.4-3.1,5.9v4.5c0,4,1.8,6.5,6.9,6.6
    c0.4,0,0.8,0,1.2,0c1.4,0,2.8-0.2,4.2-0.4c0.2,0,0.3-0.2,0.3-0.4v-0.2l-0.4-2.3l0,0c-1.3,0.1-2.4,0.2-3.7,0.2l0,0
    c-3.1,0-4.1-0.9-4.1-2.8V254l0,0v-0.8l0,0h9.2c0.2,0,0.3-0.1,0.3-0.3v-1.3v-2.1C-551.3,246.8-552,244.4-554.5,243.3z M-555.1,250.1
    c0,0.2-0.1,0.3-0.3,0.3h-5.4l0,0v-1.5c0-1.6,0.7-2.7,2.8-2.7c0.2,0,0.5,0,0.7,0c1.6,0.2,2.2,1.3,2.2,2.7V250.1z"></path>
                        <path class="st0" d="M-635.8,242.8c-1.5,0-3.1,0.1-4.5,0.3c-0.2,0-0.3,0.2-0.2,0.4l0.4,2.6c0,0.2,0.2,0.3,0.3,0.3
    c1.4-0.2,2.3-0.2,3.7-0.2c3.1,0,4.1,0.9,4.1,2.8v1.1c0,0.2-0.1,0.3-0.3,0.3h-4c-3.5,0-5.5,1.8-5.5,5c0,3,2.3,5.1,5.7,5.1
    c2.2,0,3-0.3,3.7-1c0.2-0.2,0.5,0,0.5,0.2v0.2c0,0.2,0.1,0.3,0.3,0.3h3.4c0.2,0,0.3-0.1,0.3-0.3V249
    C-627.9,244.8-630.8,242.8-635.8,242.8z M-632.1,253.8c0,2.1-1.5,3.6-3.7,3.6c-1.8,0-2.7-0.7-2.7-2.1c0-1.5,0.9-2.1,2.7-2.1h3.4
    c0.2,0,0.3,0.1,0.3,0.3V253.8z"></path>
                        <path class="st0" d="M-586.4,242.8c-1.5,0-3.1,0.1-4.5,0.3c-0.2,0-0.3,0.2-0.2,0.4l0.4,2.6c0,0.2,0.2,0.3,0.3,0.3
    c1.4-0.2,2.3-0.2,3.7-0.2c3.1,0,4.1,0.9,4.1,2.8v1.1c0,0.2-0.1,0.3-0.3,0.3h-4c-3.5,0-5.5,1.8-5.5,5c0,3,2.3,5.1,5.7,5.1
    c2.2,0,3-0.3,3.7-1c0.2-0.2,0.5,0,0.5,0.2v0.2c0,0.2,0.1,0.3,0.3,0.3h3.5c0.2,0,0.3-0.1,0.3-0.3V249
    C-578.4,244.8-581.4,242.8-586.4,242.8z M-582.7,253.8c0,2.1-1.5,3.6-3.7,3.6c-1.8,0-2.7-0.7-2.7-2.1c0-1.5,0.9-2.1,2.7-2.1h3.4
    c0.2,0,0.3,0.1,0.3,0.3C-582.7,253.5-582.7,253.8-582.7,253.8z"></path>
                        <path class="st1" d="M-424,260.4c-2.2,0-4.6-0.5-6.9-1.4l0.5-1.8c2.1,0.7,4.4,1.2,6.3,1.2c2.7,0,4.3-1.1,4.3-2.6
    c0-1.3-0.8-2-4.7-3.5c-4.4-1.6-5.9-2.8-5.9-5.4c0-2.8,2.3-4,6.4-4c1.8,0,4.3,0.3,6,0.9l-0.4,1.8c-1.7-0.4-3.7-0.7-5.5-0.7
    c-3,0-4.2,0.5-4.2,2c0,1.6,1.1,2.2,5.1,3.7c4.4,1.7,5.5,2.7,5.5,5.1C-417.4,258.5-420,260.4-424,260.4z"></path>
                        <g>
                            <path class="st1" d="M-462.7,260.3h-7.5c-1,0-1.6-0.4-1.9-0.7c-0.6-0.7-0.6-1.5-0.6-1.8v-15h1.8V258c0,0.1,0,0.3,0.1,0.4
      c0.1,0.1,0.4,0.2,0.5,0.2h7.5L-462.7,260.3L-462.7,260.3z"></path>
                        </g>
                        B <path class="st1" d="M-432.2,255.4c0-2.1-1-3.8-3.1-4.6c1.3-0.7,2.3-2,2.3-3.8c0-2.6-2-4.1-5.5-4.1h-7v14.5l0,0v0.4
    c0,0.2,0,1.1,0.6,1.8c0.3,0.4,0.9,0.7,1.9,0.7h4.9h0.1l0,0h0.3l0,0C-433.9,260.2-432.2,258-432.2,255.4z M-443.6,244.6h5.1
    c2.5,0,3.7,0.8,3.7,2.6s-1.2,3-3.5,3h-5.3L-443.6,244.6L-443.6,244.6z M-436.8,258.5h-6.2c-0.2,0-0.4,0-0.5-0.2
    c-0.1-0.1-0.1-0.4-0.1-0.4v-6h5.9c2.5,0,3.7,1.5,3.6,3.4C-434.2,257-435.1,258.2-436.8,258.5z"></path>
                    </g>
    </svg>
                <p id="logo-tagline" class="">We research. You level up.</p>
            </a>
        </div>
        <div id="mb-nav-icon" type="button" data-target="#navbar" data-toggle="collapse" role="button" aria-label="Open mobile menu" tabindex="0" aria-pressed="true" aria-haspopup="true" aria-expanded="false" aria-controls="navbar">&nbsp;
            <span class="firstline">&nbsp;</span>
            <span class="secondline">&nbsp;</span>
            <span class="thirdline">&nbsp;</span>
        </div>
        <div id="main-nav-menu">
            <div id="main-top-nav">
                <div class="navitem has-dropdown" data-submenu="personal-nav" tabindex="0" aria-haspopup="true" >
                    <span>Personal</span>
                    <div class="submenu">
                        <div class="submenu-container submenu-container-full">
                            <div class="submenu-box divider" role="menuitem">
                                <a href="javascript:void(0)"  data-submenu="personal-nav" tabindex="-1" class="main-nav-item nav-back-link"><span class="back-arrow"></span> Personal</a>
                                <div class="submenu-content">
                                    <ul>
                                        <li class="title" role="none">Security & Antivirus</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/premium/" id="cta-navbar-windows-en-test" tabindex="-1">Malwarebytes for Windows</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/mac/" id="cta-navbar-mac-en-test" tabindex="-1">Malwarebytes for Mac</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/chromebook/" id="cta-navbar-chromebook-en-test" tabindex="-1">Malwarebytes for Chromebook</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/browserguard/" id="cta-navbar-browserguard-en-test" tabindex="-1">Malwarebytes Browser Guard</a></li>
                                        <li role="none"><a href="//www.malwarebytes.com/for-home/" id="cta-press-navbar-forhome-en-test" class="bold-link" tabindex="-1">Overview <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="submenu-box divider">
                                <div class="submenu-content">
                                    <ul>
                                        <li class="title" role="none">Security & Antivirus for Mobile</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/android/" id="cta-navbar-android-en-test" tabindex="-1">Malwarebytes for Android</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/ios/" id="cta-navbar-ios-en-test" tabindex="-1">Malwarebytes for iOS</a></li>

                                        <li class="title" role="none">Online Privacy</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/vpn/" id="cta-navbar-malwarebytes-privacy-en-test" tabindex="-1">Malwarebytes Privacy VPN</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="submenu-box divider">
                                <div class="submenu-content submenu-gradient">
                                    <ul>
                                        <li class="title" role="none">Get Started</li>
                                        <li role="none">
                                            <a href="//www.malwarebytes.com/for-home/products/" id="cta-navbar-viewall-en-test" class="bold-link" tabindex="-1">
                                                <img class="link-icon" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/icons/personal-icon.svg" alt="Personal Icon">
                                                Explore all Personal Products
                                            </a>
                                        </li>
                                        <li role="none">
                                            <a href="//www.malwarebytes.com/pricing/" id="cta-navbar-pricing-en-test" class="bold-link" tabindex="-1">
                                                <img class="link-icon" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/icons/pricing-icon.svg" alt="Pricing Icon">
                                                Explore Pricing
                                            </a>
                                        </li>
                                        <li role="none">
                                            <a id="cta-navbar-freedownload-personaldropdown-en-test" href="//www.malwarebytes.com/mwb-download/thankyou/" class="free-download link-box" tabindex="-1">
                                                <div>
                                                    <h4>Free Trial of Malwarebytes Premium</h4>
                                                    <p>Protect your devices, your data, and your privacy—at home or on the go.</p>
                                                    <span class="cta-text">Get free trial <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></span>
                                                </div>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="navitem has-dropdown" data-submenu="business-nav" tabindex="0">
                    <span>Business</span>
                    <div id="business-nav" class="submenu">
                        <div class="submenu-container submenu-container-full">
                            <div class="submenu-box divider">
                                <a href="javascript:void(0)" data-submenu="business-nav" tabindex="-1" class="main-nav-item nav-back-link"><span class="back-arrow"></span> Business</a>
                                <div class="submenu-content">
                                    <ul>
                                        <li class="title" role="none">Security & Antivirus</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/cloud/" id="cta-navbar-forbusiness-nebula-en-test" tabindex="-1">Malwarebytes Nebula - Cloud Hosted Security Platform</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/endpoint-protection/" id="cta-navbar-forbusiness-ep-en-test" tabindex="-1">Malwarebytes Endpoint Protection</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/edr/" id="cta-navbar-forbusiness-edr-en-test" tabindex="-1">Malwarebytes Endpoint Detection & Response</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/incident-response/" id="cta-navbar-forbusiness-ir-en-test" tabindex="-1">Malwarebytes Incident Response</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/crowdstrike/" id="cta-navbar-forbusiness-crowdstrike-en-test" tabindex="-1">Malwarebytes Remediation for CrowdStrike</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/teams/" id="cta-navbar-forbusiness-teams-en-test" tabindex="-1">Malwarebytes for Teams</a></li>
                                        <li class="title" role="none">Services</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/services/malware-removal/" id="cta-navbar-forbusiness-malwareremovalservice-en-test" tabindex="-1">Malwarebytes Malware Removal</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="submenu-box divider">
                                <div class="submenu-content">
                                    <ul>
                                        <li class="title" role="none">Server Protection</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/endpoint-protection/server-security/" id="cta-navbar-forbusiness-ep-server-security-en-test" tabindex="-1">Malwarebytes Endpoint Protection for Servers</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/edr/server-security/" id="cta-navbar-forbusiness-edr-server-security-en-test" tabindex="-1">Malwarebytes Endpoint Detection and Response for Servers</a></li>

                                        <li class="title" role="none">Solutions</li>
                                        <li class="subtitle" role="none">BUSINESS SOLUTIONS</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/solutions/small-business/" id="cta-navbar-forbusiness-solutions-small-business-en-test" tabindex="-1">Small Business Antivirus</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/solutions/mid-market/" id="cta-navbar-forbusiness-solutions-mid-market-en-test" tabindex="-1">Secure Remote Workers</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/solutions/enterprise/" id="cta-navbar-forbusiness-solutions-enterprise-en-test" tabindex="-1">Enterprise Antivirus and Cybersecurity</a></li>

                                        <li class="subtitle" role="none">INDUSTRY SOLUTIONS</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/education/" id="cta-navbar-forbusiness-education-en-test" tabindex="-1">Education</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/finance/" id="cta-navbar-forbusiness-finance-en-test" tabindex="-1">Finance</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/healthcare/" id="cta-navbar-forbusiness-healthcare-en-test" tabindex="-1">Healthcare</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="submenu-box divider">
                                <div class="submenu-content submenu-gradient">
                                    <ul>
                                        <li class="title" role="none">Get Started</li>
                                        <li role="none">
                                            <a href="//www.malwarebytes.com/business/" id="cta-navbar-forbusiness-en-test" class="bold-link" tabindex="-1">
                                                <img class="link-icon" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/icons/business-icon.svg" alt="Business Icon">
                                                Explore all Business Products
                                            </a>
                                        </li>
                                        <li role="none">
                                            <a href="//www.malwarebytes.com/pricing/business/" id="cta-navbar-forbusiness-pricing-en-test" class="bold-link" tabindex="-1">
                                                <img class="link-icon" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/icons/pricing-icon.svg" alt="Pricing Icon">
                                                Explore Pricing
                                            </a>
                                        </li>
                                        <li role="none">
                                            <a id="cta-navbar-businesstrial-businessdropdown-en-test" href="//www.malwarebytes.com/business/request_trial/?ref=nav" class="link-box" tabindex="-1">
                                                <div class="biz">
                                                    <h4>Get a Free Trial</h4>
                                                    <p>Secure your endpoints and servers with industry-leading protection, detection, and response solutions.</p>
                                                    <span class="cta-text">Get Started <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></span>
                                                </div>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="navitem" tabindex="0">
                    <a href="//www.malwarebytes.com/pricing/" class="pricing-link" id="cta-navbar-pricing-en-test" ><span>Pricing</span></a>
                </div>
                <div class="navitem has-dropdown" data-submenu="partners-nav" tabindex="0">
                    <span>Partners</span>
                    <div id="partner-nav" class="submenu">
                        <div class="submenu-container">
                            <div class="submenu-box"></div>
                            <div class="submenu-box divider">
                                <a  href="javascript:void(0)" data-submenu="partner-nav" tabindex="-1" class="main-nav-item nav-back-link"><span class="back-arrow"></span> Partners</a>
                                <div class="submenu-content">
                                    <div class="submenu-content submenu-gradient">
                                        <ul>
                                            <li role="none">
                                                <a href="//www.malwarebytes.com/partners/" id="cta-navbar-partners-explore-partnerships-en-test" class="bold-link" tabindex="-1">
                                                    <img class="link-icon" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/icons/partner-icon.svg" alt="Partner Icon">
                                                    Explore Partnerships
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <ul class="submenu-content divider-top">
                                        <li class="title" role="none">Partner Solutions</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/partners/solution-providers/" id="cta-navbar-partners-solution-providers-en-test" tabindex="-1">Resellers</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/partners/managed-service-providers/" id="cta-navbar-partners-managed-service-providers-en-test" tabindex="-1">Managed Service Providers</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/techbench/" id="cta-navbar-partners-computer-repair-en-test" tabindex="-1">Computer Repair</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/integrations/" id="cta-navbar-partners-tech-partnerships-en-test" tabindex="-1">Technology Partners</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="submenu-box divider">
                                <div class="submenu-content submenu-gradient">
                                    <ul>
                                        <li class="title" role="none">Partner Success Story</li>
                                        <li class="partner-highlight" role="none">
                                            <div>
                                                <img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/partners/optimus-systems.webp" onerror='this.onerror = null; this.src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/partners/optimus-systems.png"' alt="Optimus Systems Logo">
                                            </div>
                                            <div class="name">Marek Drummond</div>
                                            <div class="position">Managing Director at Optimus Systems</div>
                                            <p>"Thanks to the Malwarebytes MSP program, we have this high-quality product in our stack. It’s a great addition, and I have confidence that customers’ systems are protected."</p>
                                        </li>
                                        <li role="none"><a href="https://resources.malwarebytes.com/casestudy/optimus-systems-delivers-trusted-desktop-security-services-malwarebytes-managed-services-provider/" id="cta-navbar-partners-featured-optimus-en-test" class="bold-link" tabindex="-1">See full story <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="navitem has-dropdown" data-submenu="resources-nav" tabindex="0">
                    <span>Resources</span>
                    <div id="resources-nav" class="submenu">
                        <div class="submenu-container submenu-container-full">
                            <div class="submenu-box divider">
                                <a  href="javascript:void(0)" data-submenu="resources-nav" tabindex="-1" class="main-nav-item nav-back-link"><span class="back-arrow"></span> Resources</a>
                                <div class="submenu-content">
                                    <ul>
                                        <li class="title" role="none">Learn About Cybersecurity</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/antivirus/" id="cta-navbar-resources-antivirus-en-test" tabindex="-1">Antivirus</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/malware/" id="cta-navbar-resources-malware-en-test" tabindex="-1">Malware</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/ransomware/" id="cta-navbar-resources-ransomware-en-test" tabindex="-1">Ransomware</a></li>
                                        <li role="none"><a href="//www.malwarebytes.com/cybersecurity/" id="cta-navbar-resources-pillarhub-en-test" class="bold-link" tabindex="-1">See all <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></a></li>

                                        <li class="title" role="none">Malwarebytes Labs</li>
                                        <li role="none"><a href="https://blog.malwarebytes.com/" id="cta-navbar-resources-blog-en-test" class="bold-link" tabindex="-1">Explore <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="submenu-box divider">
                                <div class="submenu-content">
                                    <ul>
                                        <li class="title" role="none">Business Resources</li>
                                        <li class="link" role="none"><a href="https://resources.malwarebytes.com/#reviews" id="cta-navbar-resources-reviews-en-test" tabindex="-1">Reviews</a></li>
                                        <li class="link" role="none"><a href="https://resources.malwarebytes.com/#analyst-reports" id="cta-navbar-resources-analyst-reports-en-test" tabindex="-1">Analyst Reports</a></li>
                                        <li class="link" role="none"><a href="https://resources.malwarebytes.com/casestudies/" id="cta-navbar-resources-casestudies-en-test" tabindex="-1">Case Studies</a></li>
                                        <li role="none"><a href="https://resources.malwarebytes.com/" id="cta-navbar-resources-viewall-en-test" class="bold-link" tabindex="-1">See all <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></a></li>

                                        <li class="title" role="none">Press & News</li>
                                        <li role="none"><a href="https://press.malwarebytes.com/" id="cta-navbar-resources-news-press-en-test" class="bold-link" tabindex="-1">Learn more <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="submenu-box divider">
                                <div class="submenu-content submenu-gradient">
                                    <ul>
                                        <li class="title" role="none">Events</li>
                                        <li>
                                            <img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/rsa2021.jpg" alt="RSA 2021" width="250px">
                                            <br><br>
                                            <p><span class="title">Featured Event:</span> RSA 2021</p>
                                        </li>
                                        <li role="none"><a href="https://www.rsaconference.com/usa" id="cta-navbar-resources-featured-rsa-en-text" class="bold-link" tabindex="-1">See Event <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="navitem has-dropdown" data-submenu="support-nav" tabindex="0">
                    <span>Support</span>
                    <div id="support-nav" class="submenu">
                        <div class="submenu-container">
                            <div class="submenu-box"></div>
                            <div class="submenu-box divider">
                                <a href="javascript:void(0)" data-submenu="support-nav" tabindex="-1" class="main-nav-item nav-back-link"><span class="back-arrow"></span> Support</a>
                                <div class="submenu-content">
                                    <ul class="submenu-content">
                                        <li class="title" role="none">Technical Support</li>
                                        <li class="link" role="none"><a href="https://support.malwarebytes.com/hc/en-us" id="cta-navbar-support-en-test" tabindex="-1">Support</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/services/" id="cta-navbar-support-business_services-en-test" tabindex="-1">Premium Services</a></li>
                                        <li class="link" role="none"><a href="https://forums.malwarebytes.com/" id="cta-navbar-support-forum-en-test" tabindex="-1">Forums</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/secure/" id="cta-navbar-support-vulnerability_disclosure-en-test" tabindex="-1">Vulnerability Disclosure</a></li>
                                    </ul>
                                    <div class="submenu-content submenu-gradient divider-top">
                                        <ul>
                                            <li role="none">
                                                <a href="https://www.youtube.com/channel/UCB7JQhkZpiyvGPufW2RPBoQ" id="cta-navbar-support-support_services-en-test" class="bold-link" tabindex="-1">
                                                    <img class="link-icon" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/icons/watch-personal-icon.svg" alt="Watch Icon">
                                                    Training for Personal Products
                                                </a>
                                            </li>
                                            <li role="none">
                                                <a href="//www.malwarebytes.com/business/academy/" id="cta-navbar-support-training_for_business-en-test" class="bold-link" tabindex="-1">
                                                    <img class="link-icon" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/icons/watch-business-icon.svg" alt="Watch Icon">
                                                    Training for Business Products
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="submenu-box divider">
                                <div class="submenu-content">
                                    <ul class="submenu-content submenu-gradient">
                                        <li class="title" role="none">Featured Content</li>
                                        <li role="none">
                                            <img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/privacy.svg" alt="Privacy Logo">
                                            <br>
                                            <br>
                                            <p>Activate Malwarebytes Privacy on Windows device.</p>
                                        </li>
                                        <li role="none"><a href="https://support.malwarebytes.com/hc/en-us/articles/360046199873-Activate-Malwarebytes-Privacy-on-Windows-device" id="cta-navbar-support-privacy_activation-en-test" class="bold-link" tabindex="-1">See Content <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                  <a id="cta-navbar-freedownload-main-en-test" href="//www.malwarebytes.com/mwb-download/thankyou/" class="free-download nav-download-btn">FREE DOWNLOAD</a>
                </div>
            </div>
            <div id="main-util-nav">
                <div class="navitem-caps">
                    <a href="//www.malwarebytes.com/contact/" id="cta-navbar-company-contactus-en-test">CONTACT US</a>
                </div>
                <div class="navitem-caps has-dropdown" data-submenu="company-nav" tabindex="0">
                    <span>COMPANY</span>
                    <div id="company-nav" class="submenu">
                        <div class="submenu-container">
                            <div class="submenu-box">
                                <a href="javascript:void(0)" data-submenu="company-nav" tabindex="-1" class="main-nav-item nav-back-link"><span class="back-arrow"></span> Company</a>
                                <ul>
                                    <li class="link" role="none"><a href="//www.malwarebytes.com/company/" id="cta-utilbar-company-aboutus-en-test" tabindex="-1">About Malwarebytes</a></li>
                                    <li class="link" role="none"><a href="https://jobs.malwarebytes.com/" id="cta-utilbar-company-careers-en-test" tabindex="-1">Careers</a></li>
                                    <li class="link" role="none"><a href="https://press.malwarebytes.com/" id="cta-utilbar-company-news-press-en-test" tabindex="-1">News & Press</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="navitem-caps has-dropdown" data-submenu="signin-nav" tabindex="0">
                    <span>SIGN IN</span>
                    <div id="signin-nav" class="submenu">
                        <div class="submenu-container">
                            <div class="submenu-box">
                                <a href="javascript:void(0)" data-submenu="signin-nav" tabindex="-1" class="main-nav-item nav-back-link"><span class="back-arrow"></span> Sign In</a>
                                <ul>
                                    <li class="link" role="none">
                                        <a href="https://my.malwarebytes.com/en/login/" id="cta-utilbar-login-myaccount-en-test" tabindex="-1">My Account</a>
                                    </li>
                                    <li class="link" role="none">
                                        <a href="https://cloud.malwarebytes.com/" id="cta-utilbar-login-cloud-console-en-test" tabindex="-1">Cloud Console</a>
                                    </li>
                                    <li class="link">
                                        <a href="https://partners.malwarebytes.com/English/" id="cta-utilbar-partner-portal-en-test">Partner Portal</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</nav>

<div id="labs-sub-nav">
    <div class="container">
        <div class="row">
            <div class="col-md-4 col-xs-6" id="search-section">
                <form id="search-form" onsubmit="submitSearchrightrail(event)" method="get">
                    <div class="searchbar-wrap-rightrail">
                        <label for="cta-labs-rightrail-search-submit-en" aria-label="cta-labs-rightrail-search-submit-en" aria-labelledby="cta-labs-rightrail-search-submit-en">
                            <input type="text" id="st-search-input-rightrail" class="st-search-input-rightrail"
                            placeholder="Search Labs" />
                        </label>
                        <button type="submit" id="cta-labs-rightrail-search-submit-en" aria-label="Submit your search query" /><span class=""><img
                                src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/search.svg" alt="Magnifying glass"></span>
                    </div>

                </form>
            </div>
            <div class="col-md-offset-4 col-md-4 col-xs-6" id="social">
                <div class="left col-lg-6 col-md-8 col-sm-7">
                    <a href="https://www.malwarebytes.com/newsletter/?email=&source=labs"
                        class="subscribe-btn">SUBSCRIBE</a>
                    <a href="https://blog.malwarebytes.com/feed/" target="_blank" class="socicon-rss" aria-label="Subscribe to Malwarebytes Labs RSS Feed"></a>
                </div>
                <div class="right col-lg-5 col-md-4 col-sm-4 col-xs-9">
                    <a class="social socicon-facebook" href="https://www.facebook.com/Malwarebytes/"
                        id="social-follow-facebook" target="_blank" aria-label="Visit Malwarebytes on Facebook"></a>
                    <a class="social socicon-twitter" href="https://twitter.com/malwarebytes" id="social-follow-twitter"
                        target="_blank" aria-label="Visit Malwarebytes on Twitter"></a>
                    <a class="social socicon-linkedin" href="https://www.linkedin.com/company/malwarebytes"
                        id="social-follow-linkedin" target="_blank" aria-label="Visit Malwarebytes on LinkedIn"></a>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">  
  $(function () {

    var navlinks = document.getElementsByClassName('has-dropdown');
    var mainNav = document.getElementById('main-nav-menu');
    var navBackLinks = document.getElementsByClassName('nav-back-link');
    var currentOpenNav = null;

    window.isMac = navigator.platform.match(/(Mac)/i) ? true : false;
    window.isWindows = navigator.userAgent.match(/(Windows)/i) ? true : false;
    window.isAndroid = navigator.userAgent.match(/(Android)/i) ? true : false;
    window.isiPhone = navigator.platform.match(/(iPhone)/i) ? true : false;
    window.isiPad = navigator.platform.match(/(iPad)/i) ? true : false;
    window.isChromeOS = (/\bCrOS\b/.test(navigator.userAgent)) ? true : false;

    var freeDownloadLinkElms = document.getElementsByClassName('free-download');
    var freeDownloadLink = "https://www.malwarebytes.com/mwb-download/thankyou/";

    if (isMac == true) {
      freeDownloadLink = "https://www.malwarebytes.com/mac-download/";
    }
    else if (isiPad || isiPhone) {
      freeDownloadLink = "https://go.onelink.me/app/633d1f14";
    }
    else if (isAndroid) {
      freeDownloadLink = "https://go.onelink.me/app/516cebeb";
    }
    else if (isChromeOS) {
      freeDownloadLink = "https://go.onelink.me/app/fe20dca8";
    }

    for(var i=0; i < freeDownloadLinkElms.length; i++) {
      freeDownloadLinkElms[i].setAttribute('href', freeDownloadLink);
    }

    var outsideClickClose = function(e) {
      closeNav(currentOpenNav);
    };

    var openNav = function(newNav, currentNav) {
      closeNav(currentNav);
      newNav.classList.add('open');
      var subMenu = newNav.getElementsByClassName('submenu')[0];
      if(isSubmenuTooLong(subMenu)) {
        subMenu.classList.add('submenu-scroll');
      } else {
        subMenu.classList.remove('submenu-scroll');
      }
      window.addEventListener('click', outsideClickClose);
      return newNav;
    };

    var isSubmenuTooLong = function(subMenuElm) {
      var subMenuContainer = subMenuElm.getElementsByClassName('submenu-container')[0];
      var subMenuContainerHeight = subMenuContainer.offsetHeight;
      var windowHeightMinusNav = window.innerHeight - 100;
      if(windowHeightMinusNav < subMenuContainerHeight) {
        return true;
      }
      return false;
    }

    var closeNav = function(currentNav) {
      if(!currentNav) return;
      window.removeEventListener('click', outsideClickClose);
      currentNav.classList.remove('open');
      currentNav.blur();
      currentOpenNav = null;
    };

    for(var i=0; i < navlinks.length; i++) {
      var navItem = navlinks[i];

      navItem.addEventListener('click', function(event) {
        event.stopPropagation();

        if(currentOpenNav && this.dataset.submenu === currentOpenNav.dataset.submenu) return;

        console.log('click');
        currentOpenNav = openNav(this, currentOpenNav);

      });

    };

    for(var i=0; i < navBackLinks.length; i++) {
      var navBackItem = navBackLinks[i];

      navBackItem.addEventListener('click', function(event) {
        event.stopPropagation();
        console.log('back click');
        closeNav(currentOpenNav);
      });
    }

    document.getElementById('mb-nav-icon').addEventListener('click', function(e) {

      if(this.classList.contains('open')) {
        document.documentElement.style.overflow = null;
        this.classList.remove('open');
        mainNav.classList.remove('open');
        closeNav(currentOpenNav);
      } else {
        document.documentElement.style.overflow = 'hidden';
        this.classList.add('open');
        mainNav.classList.add('open');
      }

    });

    var b2bRegex = /^\/business\/|^\/pricing\/business\/|^\/education\/|^\/finance\/|^\/healthcare\/|^\/partners\//;

    if(b2bRegex.test(window.location.pathname)){
      $('.pricing-link').attr('href', '/pricing/business/');
    }

  })
</script>
 

 
<!--
Start of DoubleClick Floodlight Tag: Please do not remove
Activity name of this tag: security blog articles
URL of the webpage where the tag is expected to be placed: https://blog.malwarebytes.com/
This tag must be placed between the <body> and </body> tags, as close as possible to the opening tag.
Creation Date: 05/20/2016
-->
<script type="text/plain" class="optanon-category-4">
var axel = Math.random() + "";
var a = axel * 10000000000000;
$('body').append('<iframe src="https://5118230.fls.doubleclick.net/activityi;src=5118230;type=count0;cat=secur00;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;ord=1;num=' + a + '?" width="1" height="1" frameborder="0" style="display:none"></iframe>');
</script>
<noscript>
<iframe src="https://5118230.fls.doubleclick.net/activityi;src=5118230;type=count0;cat=secur00;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;ord=1;num=1?" width="1" height="1" frameborder="0" style="display:none"></iframe>
</noscript>
<!-- End of DoubleClick Floodlight Tag: Please do not remove -->


<div class="wrapper" id="post">
           

  
  
<article id="single-post" class="h-entry">
  <section>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "NewsArticle",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://google.com/article"
  },
  "headline": "New version of IcedID Trojan uses steganographic payloads",
  "image": {
    "@type": "ImageObject",
    "url": "https://blog.malwarebytes.com/wp-content/uploads/2019/11/shutterstock_724512754-1-604x270.png",
    "height": 405,
    "width": 720
  },
  "datePublished": "December 3, 2019",
  "dateModified": "January 10, 2020",
  "author": {
    "@type": "Person",
    "name": "Threat Intelligence Team"
  },
   "publisher": {
    "@type": "Organization",
    "name": "Malwarebytes",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.malwarebytes.com/images/mb-logo-2.png",
      "width": 600,
      "height": 60
    }
  },
  "description": "We take a deep dive into the IcedID Trojan, describing the new payloads of this advanced malware."
}
</script>

<div class="container">
  <div class="row">

    <div class="col-md-8" id="content">
      <div>
          <P><img src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/shutterstock_724512754-1.png" alt="New version of IcedID Trojan uses steganographic payloads"></P>
            <p class="breadcrumbs hidden-xs"><a href="https://blog.malwarebytes.com/category/threat-analysis/" rel="category tag">Threat analysis</a></p>
       <h1 class="entry-title p-name">
					New version of IcedID Trojan uses steganographic payloads				</h1>
      <p class="small">Posted: <span class="published"><time class="dt-published" datetime="December 3, 2019">December 3, 2019</time></span> by <span class="vcard author p-author h-card"><a href="https://blog.malwarebytes.com/author/threatintelligence/" title="Posts by Threat Intelligence Team" rel="author">Threat Intelligence Team</a></span> 
       
       <!-- shows last modified date if modified from original post -->
        <br>Last updated: <span class='updated'><time class='dt-updated' datetime='January 10, 2020'>January 10, 2020</time></span>        
      </p>
      <div class="entry-summary p-summary" style="display:none;">We take a deep dive into the IcedID Trojan, describing the new payloads of this advanced malware.</div>
           <div class="post-content entry-content e-content" id="articleBody" itemprop="articleBody"> 
<p><em>This blog post was authored by @hasherezade, with contributions from @siri_urz and Jérôme Segura.</em></p>



<p>Security firm Proofpoint recently <a rel="noreferrer noopener" aria-label="published (opens in a new tab)" href="https://www.proofpoint.com/us/threat-insight/post/ta2101-plays-government-imposter-distribute-malware-german-italian-and-us" target="_blank">published a report</a> about a series of malspam campaigns they attribute to a threat actor called TA2101. Originally targeting German and Italian users with Cobalt Strike and Maze ransomware, the later wave of malicious emails were aimed at the US and pushing the IcedID Trojan.</p>



<p>During our analysis of this spam campaign, we noticed changes in how the payload was implemented, in particular with some code rewritten and new obfuscation. For example, the IcedID Trojan is now being delivered via <a rel="noreferrer noopener" aria-label="steganography (opens in a new tab)" href="https://en.wikipedia.org/wiki/Steganography" target="_blank">steganography</a>, as the data is encrypted and encoded with the content of a valid PNG image. According to our research, those changes were introduced <a rel="noreferrer noopener" aria-label="in September 2019 (opens in a new tab)" href="http://www.malware-traffic-analysis.net/2019/09/16/index2.html" target="_blank">in September 2019</a> (while <a rel="noreferrer noopener" aria-label="in August 2019 (opens in a new tab)" href="https://www.malware-traffic-analysis.net/2019/08/12/index.html" target="_blank">in August 2019</a> the old loader was still in use).</p>



<p>The main IcedID module is stored without the typical PE header and is run by a dedicated loader that uses a custom headers structure. Our security analyst @hasherezade previously described this technique in a talk at the SAS conference (<a rel="noreferrer noopener" aria-label="Funky Malware Formats (opens in a new tab)" href="https://speakerdeck.com/hshrzd/funky-malware-formats" target="_blank">Funky Malware Formats</a>). </p>



<p>In this blog post, we take a closer look at these new payloads and describe their technical details.</p>



<h3>Distribution</h3>



<p>Our spam honeypot collected a large number of malicious emails containing the &#8220;USPS Delivery Unsuccessful Attempt Notification&#8221; subject line.</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/11/email_headers.png" data-rel="lightbox-image-0" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="41356" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/email_headers/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/email_headers.png" data-orig-size="1014,345" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="email_headers" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/email_headers-300x102.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/email_headers-600x204.png" loading="lazy" width="1014" height="345" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/email_headers.png" alt="" class="wp-image-41356" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/email_headers.png 1014w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/email_headers-300x102.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/email_headers-600x204.png 600w" sizes="(max-width: 1014px) 100vw, 1014px" /></a></figure>



<p>Each of these emails contains a Microsoft Word document as attachment allegedly coming from the United States Postal Service. The content of the document is designed to lure the victim into enabling macros by insinuating that the content had been encoded.</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/11/phish.png" data-rel="lightbox-image-1" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="41032" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/phish-10/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/phish.png" data-orig-size="1035,890" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="phish" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/phish-300x258.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/phish-600x516.png" loading="lazy" width="600" height="516" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/phish-600x516.png" alt="" class="wp-image-41032" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/phish-600x516.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/phish-300x258.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/phish.png 1035w" sizes="(max-width: 600px) 100vw, 600px" /></a></figure>



<p>Having a look at the embedded macros, we can see the following elements:</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/11/macros1.png" data-rel="lightbox-image-2" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="41033" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/macros1/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/macros1.png" data-orig-size="1200,744" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="macros1" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/macros1-300x186.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/macros1-600x372.png" loading="lazy" width="600" height="372" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/macros1-600x372.png" alt="" class="wp-image-41033" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/macros1-600x372.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/macros1-300x186.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/macros1.png 1200w" sizes="(max-width: 600px) 100vw, 600px" /></a></figure>



<p>There is a fake error message displayed to the victim, but more importantly, the IcedID Trojan authors have hidden the malicious instructions within a UserForm as labels.</p>



<div class="wp-block-image"><figure class="aligncenter is-resized"><img data-attachment-id="41034" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/macro_data/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/macro_data.png" data-orig-size="423,417" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="macro_data" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/macro_data-300x296.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/macro_data.png" loading="lazy" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/macro_data.png" alt="" class="wp-image-41034" width="423" height="417" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/macro_data.png 423w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/macro_data-300x296.png 300w" sizes="(max-width: 423px) 100vw, 423px" /><figcaption>The labels containing numerical ASCII values </figcaption></figure></div>



<p>The macro grabs the text from the labels, converts it, and uses during execution:</p>



<pre class="wp-block-preformatted">url1 = Dcr(GH1.Label1.Caption)<br />path1 = Dcr(GH1.Label2.Caption)</pre>



<p>For example: </p>



<p><em>104 116 116 112 58 47 47 49 48 52 46 49 54 56 46 49 57 56 46 50 51 48 47 119 111 114 100 117 112 100 46 116 109 112</em><br />converts to:&nbsp;http://104.168.198.230/wordupd.tmp</p>



<pre class="wp-block-preformatted"><em>67,58,92,87,105,110,100,111,119,115,92,84,101,109,112,92,101,114,101,100,46,116,109,112</em><br />converts to: C:\Windows\Temp\ered.tmp</pre>



<p>The file wordupd.tmp is an executable downloaded with the help of the URLDownloadToFileA function, saved to the given path and run. Moving on, we will take a closer look at the functionality and implementation of the downloaded sample.</p>



<h3>Behavioral analysis</h3>



<p>As it had before, IcedID has been observed making an injection into <em>svchost</em>, and running under its cover. Depending on the configuration, it may or may not download other executables, including <a rel="noreferrer noopener" aria-label="TrickBot (opens in a new tab)" href="https://blog.malwarebytes.com/trojans/2019/09/trickbot-adds-new-trick-to-its-arsenal-tampering-with-trusted-texts/" target="_blank">TrickBot</a>.</p>



<h4>Dropped files</h4>



<p>The malware drops various files on the disk. For example, in %APPDATA%, it saves the steganographically obfuscated payload (<em>photo.png</em>) and an update of the downloader:</p>



<figure class="wp-block-image"><img data-attachment-id="41265" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/drops/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/drops.png" data-orig-size="385,225" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="drops" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/drops-300x175.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/drops.png" loading="lazy" width="385" height="225" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/drops.png" alt="" class="wp-image-41265" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/drops.png 385w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/drops-300x175.png 300w" sizes="(max-width: 385px) 100vw, 385px" /></figure>



<p>It also creates a new folder with a random name, where it saves a downloaded configuration in encrypted form:</p>



<figure class="wp-block-image"><img data-attachment-id="41266" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/configs-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/configs.png" data-orig-size="444,145" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="configs" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/configs-300x98.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/configs.png" loading="lazy" width="444" height="145" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/configs.png" alt="" class="wp-image-41266" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/configs.png 444w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/configs-300x98.png 300w" sizes="(max-width: 444px) 100vw, 444px" /></figure>



<p>Inside the %TEMP% folder, it drops some non-malicious helper elements: <em>sqlite32.dll</em> (that will be used for reading SQLite browser databases found in web browsers), and a certificate that will be used for intercepting traffic:</p>



<figure class="wp-block-image"><img data-attachment-id="41264" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/temp_dropped/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/temp_dropped.png" data-orig-size="543,146" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="temp_dropped" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/temp_dropped-300x81.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/temp_dropped.png" loading="lazy" width="543" height="146" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/temp_dropped.png" alt="" class="wp-image-41264" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/temp_dropped.png 543w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/temp_dropped-300x81.png 300w" sizes="(max-width: 543px) 100vw, 543px" /></figure>



<p>Looking at the certificate, we can see that it was signed by VeriSign:</p>



<figure class="wp-block-image"><img data-attachment-id="41267" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/fakecert_tmp/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/fakecert_tmp.png" data-orig-size="628,567" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="fakecert_tmp" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/fakecert_tmp-300x271.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/fakecert_tmp-600x542.png" loading="lazy" width="600" height="542" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/fakecert_tmp-600x542.png" alt="" class="wp-image-41267" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/fakecert_tmp-600x542.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/fakecert_tmp-300x271.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/fakecert_tmp.png 628w" sizes="(max-width: 600px) 100vw, 600px" /></figure>



<h4>Persistence</h4>



<p>The application achieves persistence with the help of a scheduled task:</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/11/scheduled_task.png" data-rel="lightbox-image-3" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="41288" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/scheduled_task/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/scheduled_task.png" data-orig-size="806,210" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="scheduled_task" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/scheduled_task-300x78.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/scheduled_task-600x156.png" loading="lazy" width="806" height="210" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/scheduled_task.png" alt="" class="wp-image-41288" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/scheduled_task.png 806w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/scheduled_task-300x78.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/scheduled_task-600x156.png 600w" sizes="(max-width: 806px) 100vw, 806px" /></a></figure>



<p>The task has two triggers: at the user login and at the scheduled hour.</p>



<h4 id="mce_31">Overview of the traffic</h4>



<p>Most of the traffic is SSL encrypted. We can also see the use of websockets and addresses in a format such as &#8220;<em>data2php?&lt;key&gt;</em>&#8220;,  &#8220;<em>data3.php?&lt;key&gt;</em>&#8220;.</p>



<figure class="wp-block-image"><img data-attachment-id="40999" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/ice_id_beacon/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/ice_id_beacon.png" data-orig-size="498,290" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="ice_id_beacon" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/ice_id_beacon-300x175.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/ice_id_beacon.png" loading="lazy" width="498" height="290" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/ice_id_beacon.png" alt="" class="wp-image-40999" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/ice_id_beacon.png 498w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/ice_id_beacon-300x175.png 300w" sizes="(max-width: 498px) 100vw, 498px" /></figure>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/11/websocket_comm2.png" data-rel="lightbox-image-4" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="41263" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/websocket_comm2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/websocket_comm2.png" data-orig-size="1060,323" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="websocket_comm2" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/websocket_comm2-300x91.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/websocket_comm2-600x183.png" loading="lazy" width="1060" height="323" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/websocket_comm2.png" alt="" class="wp-image-41263" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/websocket_comm2.png 1060w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/websocket_comm2-300x91.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/websocket_comm2-600x183.png 600w" sizes="(max-width: 1060px) 100vw, 1060px" /></a></figure>



<h4>Attacking browsers</h4>



<p>The IcedID Trojan is known as a banking Trojan, and indeed, one of its important features is the ability to steal data related to banking transactions. For this purpose, it injects its implants into browsers, hooks the API, and performs a <a rel="noreferrer noopener" aria-label="Man-In-The-Browser attack (opens in a new tab)" href="https://en.wikipedia.org/wiki/Man-in-the-browser" target="_blank">Man-In-The-Browser attack</a>.</p>



<p>Inside the memory of the infected <em>svchost</em> process we can see the strings with the configuration for webinjects. Webinjects are modular (typically HTML and JavaScript code injected into a web page for the purpose of stealing data).</p>



<figure class="wp-block-image"><img data-attachment-id="41262" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/injects_overview/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/injects_overview.png" data-orig-size="773,468" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="injects_overview" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/injects_overview-300x182.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/injects_overview-600x363.png" loading="lazy" width="773" height="468" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/injects_overview.png" alt="" class="wp-image-41262" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/injects_overview.png 773w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/injects_overview-300x182.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/injects_overview-600x363.png 600w" sizes="(max-width: 773px) 100vw, 773px" /><figcaption>Webinjects configuration in the memory of infected svchost</figcaption></figure>



<p>The core bot that runs inside the memory of <em>svchost</em> observes processes running on the system, and injects more implants into browsers. For example, looking at Mozilla Firefox:</p>



<figure class="wp-block-image"><img data-attachment-id="41270" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/firefox_implant/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/firefox_implant.png" data-orig-size="587,245" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="firefox_implant" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/firefox_implant-300x125.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/firefox_implant.png" loading="lazy" width="587" height="245" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/firefox_implant.png" alt="" class="wp-image-41270" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/firefox_implant.png 587w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/firefox_implant-300x125.png 300w" sizes="(max-width: 587px) 100vw, 587px" /><figcaption>The IcedID implant in the browser&#8217;s memory</figcaption></figure>



<p>By scanning the process with <a rel="noreferrer noopener" aria-label="PE-sieve (opens in a new tab)" href="https://github.com/hasherezade/pe-sieve" target="_blank">PE-sieve</a>, we can detect that some of the DLLs inside the browser have been hooked and their execution was redirected to the malicious module.</p>



<p>In Firefox, the following hooks have been installed:</p>



<ul><li> nss3.dll : SSL_AuthCertificateHook-&gt;2c2202[2c1000+1202]</li><li>ws2_32.dll : connect-&gt;2c2728[2c1000+1728]</li></ul>



<p>A different set was observed in Internet Explorer:</p>



<ul><li> mswsock : hook_0[7852]-&gt;525d0[<em>implant_code</em>+15d0]</li><li>ws2_32.dll : connect-&gt;152728[<em>implant_code</em>+1728]</li></ul>



<p>The IcedID module running inside the browser&#8217;s memory is responsible for applying the webinjects installing malicious JavaScripts into attacked pages.</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/11/implant_fragment.png" data-rel="lightbox-image-5" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="41273" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/implant_fragment/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/implant_fragment.png" data-orig-size="1248,117" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="implant_fragment" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/implant_fragment-300x28.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/implant_fragment-600x56.png" loading="lazy" width="1248" height="117" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/implant_fragment.png" alt="" class="wp-image-41273" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/implant_fragment.png 1248w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/implant_fragment-300x28.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/implant_fragment-600x56.png 600w" sizes="(max-width: 1248px) 100vw, 1248px" /></a><figcaption>Fragment of the injected script</figcaption></figure>



<p>The content of the inlined webinject script is available here: <a href="https://gist.github.com/malwarezone/830f4a0e4506d35e376a288b20d21433#file-inject-js" target="_blank" rel="noreferrer noopener" aria-label="inject.js (opens in a new tab)">inject.js</a>.</p>



<p>It also communicates with the main bot that is inside the <em>svchost</em> process. The main bot coordinates the work of all the injected components, and sends the stolen data to the Command and Control server (CnC).</p>



<p>Due to the fact that the communication is protected by HTTPS, the malware must also install its own certificate. For example, this is the valid certificate for the Bank of America website:</p>



<figure class="wp-block-image"><img data-attachment-id="41271" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/legit_cert/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/legit_cert.png" data-orig-size="639,591" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="legit_cert" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/legit_cert-300x277.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/legit_cert-600x555.png" loading="lazy" width="639" height="591" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/legit_cert.png" alt="" class="wp-image-41271" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/legit_cert.png 639w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/legit_cert-300x277.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/legit_cert-600x555.png 600w" sizes="(max-width: 639px) 100vw, 639px" /></figure>



<p>And in contrast, the certificate used by the browser infected by IcedID:</p>



<figure class="wp-block-image"><img data-attachment-id="41272" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/fake_cert-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/fake_cert-1.png" data-orig-size="641,531" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="fake_cert" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/fake_cert-1-300x249.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/fake_cert-1-600x497.png" loading="lazy" width="641" height="531" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/fake_cert-1.png" alt="" class="wp-image-41272" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/fake_cert-1.png 641w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/fake_cert-1-300x249.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/fake_cert-1-600x497.png 600w" sizes="(max-width: 641px) 100vw, 641px" /></figure>



<h3>Overview of the changes</h3>



<p>As we mentioned, the core IcedID bot, as well as the dedicated loader, went through some refactoring. In this comparative analysis, we used the following old sample: <a rel="noreferrer noopener" aria-label="b8113a604e6c190bbd8b687fd2ba7386d4d98234f5138a71bcf15f0a3c812e91 (opens in a new tab)" href="https://www.virustotal.com/gui/file/b8113a604e6c190bbd8b687fd2ba7386d4d98234f5138a71bcf15f0a3c812e91/detection" target="_blank">b8113a604e6c190bbd8b687fd2ba7386d4d98234f5138a71bcf15f0a3c812e91</a></p>



<p>The detailed analysis of this payload can be found here: [<a rel="noreferrer noopener" href="https://www.fortinet.com/blog/threat-research/icedid-malware-analysis-part-one.html" target="_blank">1</a>][<a rel="noreferrer noopener" href="https://www.fortinet.com/blog/threat-research/icedid-malware-analysis-part-two.html" target="_blank">2</a>][<a rel="noreferrer noopener" href="https://www.fortinet.com/blog/threat-research/deep-dive-icedid-malware-analysis-of-child-processes.html" target="_blank">3</a>].</p>



<h4 id="mce_32">The old loader vs. new</h4>



<p>The loader of the previous version of the IcedID Trojan was described in detail <a rel="noreferrer noopener" aria-label="here (opens in a new tab)" href="https://medium.com/@dawid.golak/icedid-aka-bokbot-analysis-with-ghidra-560e3eccb766" target="_blank">here</a>, and <a rel="noreferrer noopener" aria-label="here (opens in a new tab)" href="https://www.fortinet.com/blog/threat-research/icedid-malware-analysis-part-one.html" target="_blank">here</a>. It was a packed PE file that used to load and inject a headerless PE.</p>



<figure class="wp-block-image"><img data-attachment-id="41359" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/ice_old/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/ice_old.png" data-orig-size="392,176" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="ice_old" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/ice_old-300x135.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/ice_old.png" loading="lazy" width="392" height="176" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/ice_old.png" alt="" class="wp-image-41359" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/ice_old.png 392w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/ice_old-300x135.png 300w" sizes="(max-width: 392px) 100vw, 392px" /></figure>



<p> The main module was injected into <em>svchost</em>:</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/11/injected_old_iceid.png" data-rel="lightbox-image-6" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="41011" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/injected_old_iceid/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/injected_old_iceid.png" data-orig-size="636,246" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="injected_old_iceid" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/injected_old_iceid-300x116.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/injected_old_iceid-600x232.png" loading="lazy" width="636" height="246" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/injected_old_iceid.png" alt="" class="wp-image-41011" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/injected_old_iceid.png 636w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/injected_old_iceid-300x116.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/injected_old_iceid-600x232.png 600w" sizes="(max-width: 636px) 100vw, 636px" /></a><figcaption>The implants in the svchost&#8217;s memory</figcaption></figure>



<p>The implanted PE was divided into two sections, and the first memory page (representing the header) was empty. This type of payload is more stealthy than a full PE injection (as is more common). However, it was possible to reconstruct the header and analyze the sample like a normal PE. (An example of the reconstructed payload is available here: <a rel="noreferrer noopener" aria-label="395d2d250b296fe3c7c5b681e5bb05548402a7eb914f9f7fcdccb741ad8ddfea (opens in a new tab)" href="https://www.virustotal.com/gui/file/395d2d250b296fe3c7c5b681e5bb05548402a7eb914f9f7fcdccb741ad8ddfea/detection" target="_blank">395d2d250b296fe3c7c5b681e5bb05548402a7eb914f9f7fcdccb741ad8ddfea</a>). </p>



<p>The redirection to the implant was implemented by hooking the <em>RtlExitUserProcess</em> function within svchost&#8217;s NTDLL. </p>



<figure class="wp-block-image"><img data-attachment-id="41012" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/injection_old/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/injection_old.png" data-orig-size="336,514" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="injection_old" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/injection_old-196x300.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/injection_old.png" loading="lazy" width="336" height="514" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/injection_old.png" alt="" class="wp-image-41012" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/injection_old.png 336w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/injection_old-196x300.png 196w" sizes="(max-width: 336px) 100vw, 336px" /></figure>



<p>When <em>svchost</em> tried to terminate, it instead triggered a jump into the injected PE&#8217;s entry point.</p>



<figure class="wp-block-image"><img data-attachment-id="41013" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/hooked_ntdll/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hooked_ntdll.png" data-orig-size="408,86" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="hooked_ntdll" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hooked_ntdll-300x63.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hooked_ntdll.png" loading="lazy" width="408" height="86" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hooked_ntdll.png" alt="" class="wp-image-41013" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hooked_ntdll.png 408w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/hooked_ntdll-300x63.png 300w" sizes="(max-width: 408px) 100vw, 408px" /><figcaption>The hooked RtlExitUserProcess redirects to payload&#8217;s EP</figcaption></figure>



<p>The loader was also filling the pointer to the data page within the payload. We can see this pointer being loaded at the beginning of the payload&#8217;s execution:</p>



<figure class="wp-block-image"><img data-attachment-id="41010" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/payloads_entry_point/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/payloads_entry_point.png" data-orig-size="553,485" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="payloads_entry_point" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/payloads_entry_point-300x263.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/payloads_entry_point.png" loading="lazy" width="553" height="485" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/payloads_entry_point.png" alt="" class="wp-image-41010" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/payloads_entry_point.png 553w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/payloads_entry_point-300x263.png 300w" sizes="(max-width: 553px) 100vw, 553px" /></figure>



<p>In the new implementation, there is one more intermediate loader element implemented as shellcode. The diagram below shows the new loading chain:</p>



<figure class="wp-block-image"><img data-attachment-id="41380" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/ice_new_ldr-3/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/ice_new_ldr-2.png" data-orig-size="675,294" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="ice_new_ldr" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/ice_new_ldr-2-300x131.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/ice_new_ldr-2-600x261.png" loading="lazy" width="675" height="294" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/ice_new_ldr-2.png" alt="" class="wp-image-41380" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/ice_new_ldr-2.png 675w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/ice_new_ldr-2-300x131.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/ice_new_ldr-2-600x261.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/ice_new_ldr-2-195x85.png 195w" sizes="(max-width: 675px) 100vw, 675px" /></figure>



<p>The shellcode has similar functionality that was previously implemented by the loader in form of a PE. First it injects itself into <em>svchost.</em></p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/11/svchost_implant_new.png" data-rel="lightbox-image-7" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="41016" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/svchost_implant_new/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/svchost_implant_new.png" data-orig-size="736,514" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="svchost_implant_new" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/svchost_implant_new-300x210.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/svchost_implant_new-600x419.png" loading="lazy" width="736" height="514" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/svchost_implant_new.png" alt="" class="wp-image-41016" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/svchost_implant_new.png 736w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/svchost_implant_new-300x210.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/svchost_implant_new-600x419.png 600w" sizes="(max-width: 736px) 100vw, 736px" /></a></figure>



<p>Then it decompresses and injects the payload, which as before is a headerless PE (analogical to the one described <a rel="noreferrer noopener" href="https://www.fortinet.com/blog/threat-research/deep-dive-icedid-malware-analysis-of-child-processes.html" target="_blank">here</a>).</p>



<figure class="wp-block-image"><img data-attachment-id="41048" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/implant_2-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/implant_2-1.png" data-orig-size="631,265" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="implant_2" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/implant_2-1-300x126.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/implant_2-1-600x252.png" loading="lazy" width="600" height="252" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/implant_2-1-600x252.png" alt="" class="wp-image-41048" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/implant_2-1-600x252.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/implant_2-1-300x126.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/implant_2-1-630x265.png 630w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/implant_2-1.png 631w" sizes="(max-width: 600px) 100vw, 600px" /></figure>



<h4 id="mce_32">Comparing the core</h4>



<p>The implementation of the core bot is modified. Yet, inside the code we can find some strings known from the previous sample, as well as a similar set of imported API functions. We can also see some matching strings and fragments of implemented logic.</p>



<figure class="wp-block-image"><img data-attachment-id="41050" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/check_clear_empty_old/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/check_clear_empty_old.png" data-orig-size="736,541" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="check_clear_empty_old" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/check_clear_empty_old-300x221.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/check_clear_empty_old-600x441.png" loading="lazy" width="600" height="441" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/check_clear_empty_old-600x441.png" alt="" class="wp-image-41050" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/check_clear_empty_old-600x441.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/check_clear_empty_old-300x221.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/check_clear_empty_old.png 736w" sizes="(max-width: 600px) 100vw, 600px" /><figcaption>Fragment of the code from the old implementation</figcaption></figure>



<p>Analogical fragment from the new sample:</p>



<figure class="wp-block-image"><img data-attachment-id="41051" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/check_clear_empty_new/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/check_clear_empty_new.png" data-orig-size="706,383" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="check_clear_empty_new" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/check_clear_empty_new-300x163.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/check_clear_empty_new-600x325.png" loading="lazy" width="600" height="325" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/check_clear_empty_new-600x325.png" alt="" class="wp-image-41051" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/check_clear_empty_new-600x325.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/check_clear_empty_new-300x163.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/check_clear_empty_new.png 706w" sizes="(max-width: 600px) 100vw, 600px" /><figcaption>Fragment of the code from the new implementation</figcaption></figure>



<p>Comparing both reconstructed samples with the help of BinDiff shows that there are quite a few differences and rewritten parts. Yet, there are parts of code that are the same in both, which proves that the codebase remained the same.</p>



<figure class="wp-block-image"><img data-attachment-id="41068" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/similar-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/similar.png" data-orig-size="882,352" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="similar" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/similar-300x120.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/similar-600x239.png" loading="lazy" width="600" height="239" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/similar-600x239.png" alt="" class="wp-image-41068" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/similar-600x239.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/similar-300x120.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/similar.png 882w" sizes="(max-width: 600px) 100vw, 600px" /><figcaption>Preview of the similar functions</figcaption></figure>



<figure class="wp-block-image"><img data-attachment-id="41069" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/rewritten/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/rewritten.png" data-orig-size="779,314" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="rewritten" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/rewritten-300x121.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/rewritten-600x242.png" loading="lazy" width="600" height="242" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/rewritten-600x242.png" alt="" class="wp-image-41069" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/rewritten-600x242.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/rewritten-300x121.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/rewritten.png 779w" sizes="(max-width: 600px) 100vw, 600px" /><figcaption>Preview of different/rewritten functions</figcaption></figure>



<p>Let&#8217;s follow the execution flow of all the elements from the new IcedID package.</p>



<h3>The downloader</h3>



<p>In the current delivery model, the first element of IcedID is a downloader. It is a PE file, packed by a crypter. The packing layer changes from sample to sample, so we will omit its description. After unpacking it, we get the plain version: <a rel="noreferrer noopener" href="https://www.virustotal.com/gui/file/5cac188fce6c235ae926c48bde0130036ce8860c864d6ae8e2dd1bd9fd2613e0/details" target="_blank">fbacdb66748e6ccb971a0a9611b065ac</a>.</p>



<p>Internally, this executable is simple and no further obfuscated. We can see that it first queries the CnC trying to fetch the second stage, requesting for a <em>photo.png</em>. It passes a generated ID to the URL. Example:</p>



<p>/photo.png?id=0198d464fe3e7f09ab0005000000fa00000000</p>



<figure class="wp-block-image"><img data-attachment-id="41154" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/photo_link_code/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/photo_link_code.png" data-orig-size="535,240" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="photo_link_code" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/photo_link_code-300x135.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/photo_link_code.png" loading="lazy" width="535" height="240" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/photo_link_code.png" alt="" class="wp-image-41154" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/photo_link_code.png 535w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/photo_link_code-300x135.png 300w" sizes="(max-width: 535px) 100vw, 535px" /><figcaption>Fragment of the function responsible for generating the image URL</figcaption></figure>



<p>The downloader fetches the PNG with the encoded payload. Then it loads the file, decodes it, and redirects the execution there. Below we can see the responsible function:</p>



<figure class="wp-block-image"><img data-attachment-id="41151" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/downloader_high_level/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/downloader_high_level.png" data-orig-size="721,464" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="downloader_high_level" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/downloader_high_level-300x193.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/downloader_high_level-600x386.png" loading="lazy" width="721" height="464" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/downloader_high_level.png" alt="" class="wp-image-41151" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/downloader_high_level.png 721w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/downloader_high_level-300x193.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/downloader_high_level-600x386.png 600w" sizes="(max-width: 721px) 100vw, 721px" /></figure>



<p>Once the PNG is downloaded, it will be saved on disk and can be loaded again at system restart. The downloader will turn into a runner of this obfuscated format. In this way, the core executable is revealed only in  memory and never stored on disk as an EXE file.</p>



<p>The &#8220;<em>photo.png</em>&#8221; looks like a valid graphic file:</p>



<figure class="wp-block-image"><img data-attachment-id="41014" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/payload_png/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/payload_png.png" data-orig-size="880,406" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="payload_png" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/payload_png-300x138.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/payload_png-600x277.png" loading="lazy" width="880" height="406" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/payload_png.png" alt="" class="wp-image-41014" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/payload_png.png 880w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/payload_png-300x138.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/payload_png-600x277.png 600w" sizes="(max-width: 880px) 100vw, 880px" /><figcaption>Preview of the &#8220;photo.png&#8221;</figcaption></figure>



<p>In this fragment of code, we can see that the data from the PNG (section starting from the tag &#8220;IDAT&#8221;) is first decoded to raw bytes, and then those bytes are passed to the further decoding function.</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/11/fetch_data_decode.png" data-rel="lightbox-image-8" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="41152" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/fetch_data_decode/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/fetch_data_decode.png" data-orig-size="1089,528" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="fetch_data_decode" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/fetch_data_decode-300x145.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/fetch_data_decode-600x291.png" loading="lazy" width="1089" height="528" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/fetch_data_decode.png" alt="" class="wp-image-41152" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/fetch_data_decode.png 1089w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/fetch_data_decode-300x145.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/fetch_data_decode-600x291.png 600w" sizes="(max-width: 1089px) 100vw, 1089px" /></a></figure>



<p>The algorithm used for decoding the bytes:</p>



<figure class="wp-block-image"><img data-attachment-id="41153" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/decoding_algo-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decoding_algo.png" data-orig-size="459,315" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="decoding_algo" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decoding_algo-300x206.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decoding_algo.png" loading="lazy" width="459" height="315" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decoding_algo.png" alt="" class="wp-image-41153" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decoding_algo.png 459w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/decoding_algo-300x206.png 300w" sizes="(max-width: 459px) 100vw, 459px" /></figure>



<p>The PNG is decrypted and injected into the downloader. In this case, the decoded content turns out to be a shellcode module rather than a PE.</p>



<figure class="wp-block-image"><img data-attachment-id="41156" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/call_shellcode_ep-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/call_shellcode_ep-1.png" data-orig-size="564,222" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="call_shellcode_ep" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/call_shellcode_ep-1-300x118.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/call_shellcode_ep-1.png" loading="lazy" width="564" height="222" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/call_shellcode_ep-1.png" alt="" class="wp-image-41156" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/call_shellcode_ep-1.png 564w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/call_shellcode_ep-1-300x118.png 300w" sizes="(max-width: 564px) 100vw, 564px" /><figcaption>The downloader redirecting the execution into the shellcode&#8217;s entry point</figcaption></figure>



<p>The loader passes to the shellcode one argument; that is the base at which it was loaded.</p>



<h3>The loader (shellcode)</h3>



<p>As mentioned before, this stage is implemented as a position-independent code (shellcode). The dumped sample is available here: <a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://www.virustotal.com/gui/file/05274e8c704b03ae90458b3456ac392cff6cd271ea0c2cdbf26368c78782ec45/details" target="_blank">624afab07528375d8146653857fbf90d</a>.</p>



<p>This shellcode-based loader replaced the previously described (sources: [<a rel="noreferrer noopener" aria-label="1 (opens in a new tab)" href="https://www.fortinet.com/blog/threat-research/icedid-malware-analysis-part-one.html" target="_blank">1</a>][<a rel="noreferrer noopener" aria-label="2 (opens in a new tab)" href="https://medium.com/@dawid.golak/icedid-aka-bokbot-analysis-with-ghidra-560e3eccb766" target="_blank">2</a>]) loader element that was implemented as a PE file. First, it runs within the downloader:</p>



<figure class="wp-block-image"><img data-attachment-id="40996" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/enter_in_shellcode/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/enter_in_shellcode.png" data-orig-size="478,293" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="enter_in_shellcode" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/enter_in_shellcode-300x184.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/enter_in_shellcode.png" loading="lazy" width="478" height="293" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/enter_in_shellcode.png" alt="" class="wp-image-40996" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/enter_in_shellcode.png 478w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/enter_in_shellcode-300x184.png 300w" sizes="(max-width: 478px) 100vw, 478px" /></figure>



<p>As we can see from the downloader&#8217;s code, the shellcode entry point must first be fetched from a simple header that is at the beginning of the decoded module. We see that this header stores more information that is essential for loading the next element:</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/11/shc_hdr-1.png" data-rel="lightbox-image-9" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="41232" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/shc_hdr-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/shc_hdr-1.png" data-orig-size="778,223" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="shc_hdr" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/shc_hdr-1-300x86.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/shc_hdr-1-600x172.png" loading="lazy" width="778" height="223" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/shc_hdr-1.png" alt="" class="wp-image-41232" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/shc_hdr-1.png 778w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/shc_hdr-1-300x86.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/shc_hdr-1-600x172.png 600w" sizes="(max-width: 778px) 100vw, 778px" /></a></figure>



<p>As this module is no longer a PE file, its analysis is more difficult. All the APIs used by the shellcode are resolved dynamically:</p>



<figure class="wp-block-image"><img data-attachment-id="41001" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/obfuscated_calls-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/obfuscated_calls-1.png" data-orig-size="507,376" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="obfuscated_calls" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/obfuscated_calls-1-300x222.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/obfuscated_calls-1.png" loading="lazy" width="507" height="376" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/obfuscated_calls-1.png" alt="" class="wp-image-41001" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/obfuscated_calls-1.png 507w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/obfuscated_calls-1-300x222.png 300w" sizes="(max-width: 507px) 100vw, 507px" /></figure>



<p>The strings are composed on the stack:</p>



<figure class="wp-block-image"><img data-attachment-id="41002" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/stack_string/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/stack_string.png" data-orig-size="520,269" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="stack_string" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/stack_string-300x155.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/stack_string.png" loading="lazy" width="520" height="269" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/stack_string.png" alt="" class="wp-image-41002" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/stack_string.png 520w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/stack_string-300x155.png 300w" sizes="(max-width: 520px) 100vw, 520px" /></figure>



<p>To make the deobfuscation easier, we can follow the obfuscated flow with the help of a PIN tracer. The log from the tracing of this stage (on a 32 bit system) shows APIs indicating code injection, along with their offsets:</p>



<p><code>09c;shellcode's Entry Point<br />
69b;ntdll.LdrLoadDll<br />
717;ntdll.LdrGetProcedureAddress<br />
7ab;ntdll.RtlWow64EnableFsRedirectionEx<br />
7cb;kernel32.CreateProcessA<br />
7d6;ntdll.RtlWow64EnableFsRedirectionEx<br />
7f0;ntdll.NtQuerySystemInformation<br />
8aa;ntdll.NtAllocateVirtualMemory<br />
8c6;ntdll.ZwWriteVirtualMemory<br />
8ee;ntdll.NtProtectVirtualMemory<br />
907;ntdll.NtQueueApcThread<br />
916;ntdll.ZwResumeThread</code></p>



<p>Indeed, the shellcode injects its own copy, passing its entry point to the APC Queue. This time, some additional parameters are added as a thread context.</p>



<figure class="wp-block-image"><img data-attachment-id="41015" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/set_injected/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/set_injected.png" data-orig-size="438,205" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="set_injected" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/set_injected-300x140.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/set_injected.png" loading="lazy" width="438" height="205" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/set_injected.png" alt="" class="wp-image-41015" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/set_injected.png 438w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/set_injected-300x140.png 300w" sizes="(max-width: 438px) 100vw, 438px" /><figcaption>Setting parameters of the injected thread</figcaption></figure>



<p>Once the shellcode is executed from inside <em>svchost</em>, an alternative path to the execution is taken. It becomes a loader for the core bot. The core element is stored in a compressed form within the shellcode&#8217;s body. First, it is decompressed. </p>



<p>From previous experiments, we know that the payload follows the typical structure of a PE file, yet it has no headers. Often, malware authors erase headers in memory once the payload is loaded. Yet, this is not the case. In order to make the payload stealthier, the authors didn&#8217;t store the original headers of this PE at all. Instead, they created their own minimalist header that is used by the internal loader. </p>



<p>First, the shellcode finds the next module by parsing its own header:</p>



<figure class="wp-block-image"><img data-attachment-id="41157" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/alloc_for_pe/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/alloc_for_pe.png" data-orig-size="656,551" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="alloc_for_pe" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/alloc_for_pe-300x252.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/alloc_for_pe-600x504.png" loading="lazy" width="656" height="551" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/alloc_for_pe.png" alt="" class="wp-image-41157" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/alloc_for_pe.png 656w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/alloc_for_pe-300x252.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/alloc_for_pe-600x504.png 600w" sizes="(max-width: 656px) 100vw, 656px" /></figure>



<p>The shellcode also loads the imports of the payload:</p>



<figure class="wp-block-image"><img data-attachment-id="41219" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/load_functions/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/load_functions.png" data-orig-size="580,400" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="load_functions" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/load_functions-300x207.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/load_functions.png" loading="lazy" width="580" height="400" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/load_functions.png" alt="" class="wp-image-41219" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/load_functions.png 580w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/load_functions-300x207.png 300w" sizes="(max-width: 580px) 100vw, 580px" /></figure>



<p>Below, we can see the fragment of code responsible for following the custom headers definition, and applying protection on pages. After the next element is loaded, execution is redirected to its entry point.</p>



<figure class="wp-block-image"><img data-attachment-id="41040" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/call_loaded_pe/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/call_loaded_pe.png" data-orig-size="558,214" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="call_loaded_pe" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/call_loaded_pe-300x115.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/call_loaded_pe.png" loading="lazy" width="558" height="214" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/call_loaded_pe.png" alt="" class="wp-image-41040" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/call_loaded_pe.png 558w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/call_loaded_pe-300x115.png 300w" sizes="(max-width: 558px) 100vw, 558px" /></figure>



<p>The entry point of the next module where the function expects the pointer to the data to be supplied:</p>



<figure class="wp-block-image"><img data-attachment-id="41041" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/ep_to_next/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/ep_to_next.png" data-orig-size="652,406" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="ep_to_next" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/ep_to_next-300x187.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/ep_to_next-600x374.png" loading="lazy" width="600" height="374" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/ep_to_next-600x374.png" alt="" class="wp-image-41041" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/ep_to_next-600x374.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/ep_to_next-300x187.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/ep_to_next.png 652w" sizes="(max-width: 600px) 100vw, 600px" /></figure>



<p>The supplied data is appended at the end of the shellcode, and contains: the path of the initial executable, the path of the downloaded payload (<em>photo.png</em>), and other data.</p>



<p>Note that described analysis was performed on a 32 bit system. In case of a 64bit system, the shellcode takes an alternative execution path, and a 64bit version of the payload is loaded with the help of  <a rel="noreferrer noopener" aria-label="Heaven's Gate technique (opens in a new tab)" href="https://blog.malwarebytes.com/threat-analysis/2018/01/a-coin-miner-with-a-heavens-gate/" target="_blank">Heaven&#8217;s Gate technique</a>. Yet, all the features of both payload&#8217;s versions are identical.</p>



<figure class="wp-block-image"><img data-attachment-id="41488" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/shellcode_hg/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/12/shellcode_hg.png" data-orig-size="351,100" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="shellcode_hg" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/12/shellcode_hg-300x85.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/12/shellcode_hg.png" loading="lazy" width="351" height="100" src="https://blog.malwarebytes.com/wp-content/uploads/2019/12/shellcode_hg.png" alt="" class="wp-image-41488" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/12/shellcode_hg.png 351w, https://blog.malwarebytes.com/wp-content/uploads/2019/12/shellcode_hg-300x85.png 300w" sizes="(max-width: 351px) 100vw, 351px" /><figcaption>The Heaven&#8217;s Gate within the shellcode: switch to 64 bit mode</figcaption></figure>



<h4>Reconstructing the PE</h4>



<p>In order to make analysis easier, it is always beneficial to reconstruct the valid PE header. There are two approaches to this problem:</p>



<ol><li>Manually finding and filling all the PE artifacts, such as: sections, imports, relocations (this becomes a problem in if all those elements are customized by the authors, as in <a rel="noreferrer noopener" aria-label="the case of Ocean Lotus sample that we described before (opens in a new tab)" href="https://blog.malwarebytes.com/threat-analysis/2019/04/funky-malware-format-found-in-ocean-lotus-sample/" target="_blank">the case of Ocean Lotus sample</a>)</li><li>Analyzing in detail the loader and reconstructing the PE from the custom header</li></ol>



<p>Since we have access to the loader&#8217;s code, we can go for the second, more reliable approach: Observe how the loader processes the data and reconstruct the meaning of the fields. </p>



<p>A fragment of the loader&#8217;s code where the sections are processed:</p>



<figure class="wp-block-image"><img data-attachment-id="41244" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/process_sections/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/process_sections.png" data-orig-size="655,312" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="process_sections" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/process_sections-300x143.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/process_sections-600x286.png" loading="lazy" width="655" height="312" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/process_sections.png" alt="" class="wp-image-41244" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/process_sections.png 655w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/process_sections-300x143.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/process_sections-600x286.png 600w" sizes="(max-width: 655px) 100vw, 655px" /></figure>



<p>The custom header reconstructed based on the analysis:</p>



<figure class="wp-block-image"><img data-attachment-id="41243" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/custom_hdr-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/custom_hdr.png" data-orig-size="588,337" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="custom_hdr" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/custom_hdr-300x172.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/custom_hdr.png" loading="lazy" width="588" height="337" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/custom_hdr.png" alt="" class="wp-image-41243" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/custom_hdr.png 588w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/custom_hdr-300x172.png 300w" sizes="(max-width: 588px) 100vw, 588px" /></figure>



<p>Fortunately, in this case the malware authors customized only the PE header. The Data Directory elements (imports and relocations) are kept in a standard form, so this part does not need to be converted.</p>



<p>The converter from this format to PE is available here:</p>



<p><a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://github.com/hasherezade/funky_malware_formats/tree/master/iced_id_parser" target="_blank">https://github.com/hasherezade/funky_malware_formats/tree/master/iced_id_parser</a></p>



<p>Interestingly, the old version of IcedID used a similar custom format, but with one modification. In the past, there was one more DWORD-sized field before the ImportDirector VA. So, the latest header is shorter by one DWORD than the previous one.</p>



<p>The module in the old format: <a href="https://www.virustotal.com/gui/file/bbd6b94deabb9ac4775befc3dc6b516656615c9295e71b39610cb83c4b005354/detection" target="_blank" rel="noreferrer noopener" aria-label="bbd6b94deabb9ac4775befc3dc6b516656615c9295e71b39610cb83c4b005354 (opens in a new tab)">bbd6b94deabb9ac4775befc3dc6b516656615c9295e71b39610cb83c4b005354</a></p>



<h3 id="mce_84">The core bot (headerless PE)</h3>



<p><a href="https://www.virustotal.com/gui/file/a5dcfe4896abc176108748289e5a6a85a3ed8528a7c5bf1dafe6f2f6bf826192/details" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">6aeb27d50512dbad7e529ffedb0ac153</a> &#8211; a reconstructed PE</p>



<p>Looking inside the strings of this module, we can guess that this element is responsible for all the core malicious operations performed by this malware. It communicates with the CnC server, reads the sqlite databases in order to steal cookies, installs its own certificate for Man-In-The-Browser attacks, and eventually downloads other modules.</p>



<p>We can see that this is the element that was responsible for generating the observed requests to the CnC:</p>



<figure class="wp-block-image"><img data-attachment-id="41053" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/data_url/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/data_url.png" data-orig-size="633,141" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="data_url" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/data_url-300x67.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/data_url-600x134.png" loading="lazy" width="633" height="141" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/data_url.png" alt="" class="wp-image-41053" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/data_url.png 633w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/data_url-300x67.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/data_url-600x134.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/data_url-630x141.png 630w" sizes="(max-width: 633px) 100vw, 633px" /></figure>



<p>During the run, the malware is under constant supervision from the CnC. The communication with the server is encrypted.</p>



<h4>String obfuscation</h4>



<p>The majority of the strings used by the malware are obfuscated and decoded before use. The algorithm used for decoding is simple:</p>



<figure class="wp-block-image"><img data-attachment-id="41086" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/decode_string-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decode_string.png" data-orig-size="436,261" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="decode_string" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decode_string-300x180.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decode_string.png" loading="lazy" width="436" height="261" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decode_string.png" alt="" class="wp-image-41086" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decode_string.png 436w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/decode_string-300x180.png 300w" sizes="(max-width: 436px) 100vw, 436px" /></figure>



<p>In order to decode the strings statically, we can reimplement the algorithm and supply to it encoded buffers. Another easier solution is a decoder that loads the original malware and uses its function, as well as the encoded buffers given by offset. Example available <a href="https://gist.github.com/hasherezade/3f1db9cf4629cf6afc09d5ff039fc541#file-ice_str-cpp" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">here</a>.</p>



<p>Decoding strings is important for the further analysis. Especially because, in this case, we can find some <a href="https://gist.github.com/hasherezade/3f1db9cf4629cf6afc09d5ff039fc541#file-bot_logs-csv" target="_blank" rel="noreferrer noopener" aria-label="debug strings left by the developers (opens in a new tab)">debug strings left by the developers</a>, informing us about the actions performed by the malware in particular fragments of code.</p>



<p>A list of some of the decoded strings is available <a rel="noreferrer noopener" aria-label="here (opens in a new tab)" href="https://gist.github.com/hasherezade/3f1db9cf4629cf6afc09d5ff039fc541#file-decoded-csv" target="_blank">here</a>.</p>



<h4 id="mce_31">Available actions</h4>



<p>The overview of the main function of the bot is given below:</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/12/main_bot_func.png" data-rel="lightbox-image-10" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="41416" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/main_bot_func/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/12/main_bot_func.png" data-orig-size="800,698" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="main_bot_func" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/12/main_bot_func-300x262.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/12/main_bot_func-600x524.png" loading="lazy" width="800" height="698" src="https://blog.malwarebytes.com/wp-content/uploads/2019/12/main_bot_func.png" alt="" class="wp-image-41416" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/12/main_bot_func.png 800w, https://blog.malwarebytes.com/wp-content/uploads/2019/12/main_bot_func-300x262.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/12/main_bot_func-600x524.png 600w" sizes="(max-width: 800px) 100vw, 800px" /></a></figure>



<p>The bot starts by opening a socket. Then, it beacons to the CnC and initializes threads for some specific actions: MiTM proxy, browser hooking engine, and a backconnect module (backdoor).</p>



<p>It also calls to a function that initializes handlers, responsible for managing a variety of available actions. The full list:</p>



<figure class="wp-block-image"><img data-attachment-id="41362" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/action_handlers/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/action_handlers.png" data-orig-size="397,694" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="action_handlers" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/action_handlers-172x300.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/action_handlers-343x600.png" loading="lazy" width="397" height="694" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/action_handlers.png" alt="" class="wp-image-41362" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/action_handlers.png 397w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/action_handlers-172x300.png 172w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/action_handlers-343x600.png 343w" sizes="(max-width: 397px) 100vw, 397px" /></figure>



<p>By analyzing closer to the handlers, we notice that similar to the first element, the main bot retrieves various elements as steganographically protected modules. The function responsible for decoding PNG files is analogical to the one found in the initial downloader:</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decode_png.png" data-rel="lightbox-image-11" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="41294" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/decode_png/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decode_png.png" data-orig-size="871,408" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="decode_png" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decode_png-300x141.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decode_png-600x281.png" loading="lazy" width="871" height="408" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decode_png.png" alt="" class="wp-image-41294" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decode_png.png 871w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/decode_png-300x141.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/decode_png-600x281.png 600w" sizes="(max-width: 871px) 100vw, 871px" /></a></figure>



<p>Those PNGs are used to carry the content of various updates for the malware. For example, an update to the list of URLs, but also other configuration files.</p>



<figure class="wp-block-image"><img data-attachment-id="41363" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/use_png_update/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/use_png_update.png" data-orig-size="725,89" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="use_png_update" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/use_png_update-300x37.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/use_png_update-600x74.png" loading="lazy" width="725" height="89" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/use_png_update.png" alt="" class="wp-image-41363" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/use_png_update.png 725w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/use_png_update-300x37.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/use_png_update-600x74.png 600w" sizes="(max-width: 725px) 100vw, 725px" /></figure>



<h4>Execution flow controlled by the CnC</h4>



<p>The malware&#8217;s backconnect feature allows the attacker to deploy various commands on the victim machine. The CnC can also instruct the bot to decode other malicious modules from inside that will be deployed in a new process. For example:</p>



<figure class="wp-block-image"><img data-attachment-id="41364" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/inject_vnc_module/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/inject_vnc_module.png" data-orig-size="790,544" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="inject_vnc_module" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/inject_vnc_module-300x207.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/inject_vnc_module-600x413.png" loading="lazy" width="790" height="544" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/inject_vnc_module.png" alt="" class="wp-image-41364" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/inject_vnc_module.png 790w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/inject_vnc_module-300x207.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/inject_vnc_module-600x413.png 600w" sizes="(max-width: 790px) 100vw, 790px" /></figure>



<p>If the particular command from the CnC is received, the bot will decompress another buffer that is stored inside the sample and inject it into a new instance of <em>svchost</em>. </p>



<figure class="wp-block-image"><img data-attachment-id="41366" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/inject_to_svchost/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/inject_to_svchost.png" data-orig-size="689,498" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="inject_to_svchost" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/inject_to_svchost-300x217.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/inject_to_svchost-600x434.png" loading="lazy" width="689" height="498" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/inject_to_svchost.png" alt="" class="wp-image-41366" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/inject_to_svchost.png 689w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/inject_to_svchost-300x217.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/inject_to_svchost-600x434.png 600w" sizes="(max-width: 689px) 100vw, 689px" /></figure>



<p>The way in which this injection is implemented reminds us of the older version of the loader. First, the buffer is decompressed with the help of RtlDecompressBuffer:</p>



<figure class="wp-block-image"><img data-attachment-id="41088" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/decompress_buf/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decompress_buf.png" data-orig-size="518,292" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="decompress_buf" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decompress_buf-300x169.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decompress_buf.png" loading="lazy" width="518" height="292" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decompress_buf.png" alt="" class="wp-image-41088" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decompress_buf.png 518w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/decompress_buf-300x169.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/decompress_buf-400x225.png 400w" sizes="(max-width: 518px) 100vw, 518px" /></figure>



<p>Then, memory is allocated at the preferred address 0x3000.</p>



<figure class="wp-block-image"><img data-attachment-id="41089" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/write_and_redirect/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/write_and_redirect.png" data-orig-size="636,199" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="write_and_redirect" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/write_and_redirect-300x94.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/write_and_redirect-600x188.png" loading="lazy" width="600" height="188" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/write_and_redirect-600x188.png" alt="" class="wp-image-41089" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/write_and_redirect-600x188.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/write_and_redirect-300x94.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/write_and_redirect.png 636w" sizes="(max-width: 600px) 100vw, 600px" /></figure>



<p>Some functions from NTDLL and other parameters will be copied to the structure, stored at the beginning of the shellcode.  </p>



<figure class="wp-block-image"><img data-attachment-id="41147" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/copy_params_to_shellc/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/copy_params_to_shellc.png" data-orig-size="510,543" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="copy_params_to_shellc" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/copy_params_to_shellc-282x300.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/copy_params_to_shellc.png" loading="lazy" width="510" height="543" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/copy_params_to_shellc.png" alt="" class="wp-image-41147" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/copy_params_to_shellc.png 510w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/copy_params_to_shellc-282x300.png 282w" sizes="(max-width: 510px) 100vw, 510px" /></figure>



<p>We can see there are some functions that will be used by the shellcode to load another embedded PE.</p>



<p>Similar to in the old loader, the redirection to the new entry point is implemented via hook set on the RtlExitUserProcess function:</p>



<figure class="wp-block-image"><img data-attachment-id="41090" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/hook_exit_user_process/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_exit_user_process.png" data-orig-size="714,380" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="hook_exit_user_process" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_exit_user_process-300x160.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_exit_user_process-600x319.png" loading="lazy" width="714" height="380" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_exit_user_process.png" alt="" class="wp-image-41090" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_exit_user_process.png 714w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_exit_user_process-300x160.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_exit_user_process-600x319.png 600w" sizes="(max-width: 714px) 100vw, 714px" /></figure>



<p>After the buffer gets decompressed, we can see another piece of shellcode:</p>



<figure class="wp-block-image"><img data-attachment-id="41091" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/decompressed_buf2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decompressed_buf2.png" data-orig-size="520,514" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="decompressed_buf2" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decompressed_buf2-300x297.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decompressed_buf2.png" loading="lazy" width="520" height="514" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decompressed_buf2.png" alt="" class="wp-image-41091" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decompressed_buf2.png 520w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/decompressed_buf2-300x297.png 300w" sizes="(max-width: 520px) 100vw, 520px" /></figure>



<p>This shellcode is an analogical loader of the headerless PE module. We can see inside the custom version of PE header that will be used by the loader:</p>



<figure class="wp-block-image"><img data-attachment-id="41092" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/custom_pe/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/custom_pe.png" data-orig-size="524,128" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="custom_pe" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/custom_pe-300x73.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/custom_pe.png" loading="lazy" width="524" height="128" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/custom_pe.png" alt="" class="wp-image-41092" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/custom_pe.png 524w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/custom_pe-300x73.png 300w" sizes="(max-width: 524px) 100vw, 524px" /><figcaption>The custom header, containing minimal info from the PE header</figcaption></figure>



<p>Dumped shellcode: <a href="https://www.virustotal.com/gui/file/469ef3aedd47dc820d9d64a253652d7436abe6a5afb64c3722afb1ac83c3a3e1/detection" target="_blank" rel="noreferrer noopener" aria-label="469ef3aedd47dc820d9d64a253652d7436abe6a5afb64c3722afb1ac83c3a3e1 (opens in a new tab)">469ef3aedd47dc820d9d64a253652d7436abe6a5afb64c3722afb1ac83c3a3e1</a></p>



<p>This element is an additional backdoor, deploying on demand <a rel="noreferrer noopener" aria-label="a hidden VNC (opens in a new tab)" href="https://www.malwaretech.com/2015/09/hidden-vnc-for-beginners.html" target="_blank">a hidden VNC</a>. It is also referenced by the authors by the name &#8220;HDESK bot&#8221; (Help Desk bot) because it gives the attacker direct access to the victim machine, as if it were a help-desk service. Converted to PE: <a rel="noreferrer noopener" aria-label="2959091ac9e2a544407a2ecc60ba941b (opens in a new tab)" href="https://www.virustotal.com/gui/file/27c946b90987e04c3989e17e33b5dac8d5e0033199213a16d70657c58efc5031/details" target="_blank">2959091ac9e2a544407a2ecc60ba941b</a></p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/11/vnc_module.png" data-rel="lightbox-image-12" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="41331" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/vnc_module/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/vnc_module.png" data-orig-size="628,505" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="vnc_module" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/vnc_module-300x241.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/vnc_module-600x482.png" loading="lazy" width="628" height="505" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/vnc_module.png" alt="" class="wp-image-41331" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/vnc_module.png 628w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/vnc_module-300x241.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/vnc_module-600x482.png 600w" sizes="(max-width: 628px) 100vw, 628px" /></a><figcaption>The &#8220;HDESK bot&#8221; deploys a<a rel="noreferrer noopener" aria-label=" hidden VNC  (opens in a new tab)" href="https://www.malwaretech.com/2015/09/hidden-vnc-for-beginners.html" target="_blank"> hidden VNC</a> to control the victim machine</figcaption></figure>



<p>Below, we will analyze the selected features implemented by the core bot. Note that many of the features are deployed on demand—depending on the command given by the CnC. In the observed case, the bot was also used as a downloader of the secondary malware, TrickBot.</p>



<h4>Installing its own certificate</h4>



<p>The malware installs its own certificate. First it drops the generated file into the %TEMP% folder. Then, the file is loaded and added to the Windows certificate store.</p>



<figure class="wp-block-image"><img data-attachment-id="41149" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/create_and_add/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/create_and_add.png" data-orig-size="583,253" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="create_and_add" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/create_and_add-300x130.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/create_and_add.png" loading="lazy" width="583" height="253" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/create_and_add.png" alt="" class="wp-image-41149" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/create_and_add.png 583w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/create_and_add-300x130.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/create_and_add-195x85.png 195w" sizes="(max-width: 583px) 100vw, 583px" /></figure>



<p>Fragment of Certificate generation function:<br /></p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/11/selfsigned_cert.png" data-rel="lightbox-image-13" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="41291" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/selfsigned_cert/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/selfsigned_cert.png" data-orig-size="823,516" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="selfsigned_cert" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/selfsigned_cert-300x188.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/selfsigned_cert-600x376.png" loading="lazy" width="823" height="516" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/selfsigned_cert.png" alt="" class="wp-image-41291" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/selfsigned_cert.png 823w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/selfsigned_cert-300x188.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/selfsigned_cert-600x376.png 600w" sizes="(max-width: 823px) 100vw, 823px" /></a></figure>



<p>Calling the function to add the certificate to store:</p>



<figure class="wp-block-image"><img data-attachment-id="41150" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/add_to_store/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/add_to_store.png" data-orig-size="458,337" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="add_to_store" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/add_to_store-300x221.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/add_to_store.png" loading="lazy" width="458" height="337" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/add_to_store.png" alt="" class="wp-image-41150" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/add_to_store.png 458w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/add_to_store-300x221.png 300w" sizes="(max-width: 458px) 100vw, 458px" /></figure>



<h4>Stealing passwords from IE</h4>



<p>We can see that this bot goes after various saved credentials. Among the different methods used, we identified stealing data from the Credential Store. The used method is similar to the one described <a rel="noreferrer noopener" aria-label="here (opens in a new tab)" href="https://securityxploded.com/iepasswordsecrets.php" target="_blank">here</a>.</p>



<p>We can see that it uses the mentioned GUID &#8220;abe2869f-9b47-4cd9-a358-c22904dba7f7&#8221; that was used to salt the credentials. After reading the credentials from the store, the bot undoes the salting operation in order to get the plaintext.</p>



<figure class="wp-block-image"><img data-attachment-id="41070" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/salting_with_guid/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/salting_with_guid.png" data-orig-size="656,196" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="salting_with_guid" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/salting_with_guid-300x90.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/salting_with_guid-600x179.png" loading="lazy" width="600" height="179" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/salting_with_guid-600x179.png" alt="" class="wp-image-41070" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/salting_with_guid-600x179.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/salting_with_guid-300x90.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/salting_with_guid.png 656w" sizes="(max-width: 600px) 100vw, 600px" /></figure>



<h4>Stealing saved email credentials</h4>



<p>The bot is trying to use every opportunity to extract passwords from the victim machine, also going after saved email credentials.</p>



<figure class="wp-block-image"><img data-attachment-id="41338" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/steal_email_password/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/steal_email_password.png" data-orig-size="604,663" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="steal_email_password" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/steal_email_password-273x300.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/steal_email_password-547x600.png" loading="lazy" width="604" height="663" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/steal_email_password.png" alt="" class="wp-image-41338" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/steal_email_password.png 604w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/steal_email_password-273x300.png 273w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/steal_email_password-547x600.png 547w" sizes="(max-width: 604px) 100vw, 604px" /></figure>



<h4>Stealing cookies</h4>



<p>As we observed during the behavioral analysis, the malware drops the sqlite3.dll in the temp folder. This module is further loaded and used to perform queries to browsers&#8217; databases with saved cookies.</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/12/download_sql_module.png" data-rel="lightbox-image-14" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="41399" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/download_sql_module/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/12/download_sql_module.png" data-orig-size="757,202" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="download_sql_module" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/12/download_sql_module-300x80.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/12/download_sql_module-600x160.png" loading="lazy" width="757" height="202" src="https://blog.malwarebytes.com/wp-content/uploads/2019/12/download_sql_module.png" alt="" class="wp-image-41399" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/12/download_sql_module.png 757w, https://blog.malwarebytes.com/wp-content/uploads/2019/12/download_sql_module-300x80.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/12/download_sql_module-600x160.png 600w" sizes="(max-width: 757px) 100vw, 757px" /></a><figcaption>Fragment of code responsible for loading sqlite module</figcaption></figure>



<p>The malware searches the files containing cookies of  particular browsers:</p>



<figure class="wp-block-image"><img data-attachment-id="41292" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/search_cookie/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/search_cookie.png" data-orig-size="336,132" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="search_cookie" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/search_cookie-300x118.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/search_cookie.png" loading="lazy" width="336" height="132" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/search_cookie.png" alt="" class="wp-image-41292" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/search_cookie.png 336w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/search_cookie-300x118.png 300w" sizes="(max-width: 336px) 100vw, 336px" /></figure>



<p>We can see the content of the queries after decoding strings:</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/11/select_cookies.png" data-rel="lightbox-image-15" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="41337" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/select_cookies/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/select_cookies.png" data-orig-size="763,144" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="select_cookies" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/select_cookies-300x57.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/select_cookies-600x113.png" loading="lazy" width="763" height="144" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/select_cookies.png" alt="" class="wp-image-41337" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/select_cookies.png 763w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/select_cookies-300x57.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/select_cookies-600x113.png 600w" sizes="(max-width: 763px) 100vw, 763px" /></a><figcaption>SELECT host, path, isSecure, expiry, name, value FROM moz_cookies</figcaption></figure>



<p>It targets Firefox, as well as Chrome and Chromium-based browsers:</p>



<figure class="wp-block-image"><img data-attachment-id="41402" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/chromium_browsers/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/12/chromium_browsers.png" data-orig-size="557,483" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="chromium_browsers" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/12/chromium_browsers-300x260.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/12/chromium_browsers.png" loading="lazy" width="557" height="483" src="https://blog.malwarebytes.com/wp-content/uploads/2019/12/chromium_browsers.png" alt="" class="wp-image-41402" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/12/chromium_browsers.png 557w, https://blog.malwarebytes.com/wp-content/uploads/2019/12/chromium_browsers-300x260.png 300w" sizes="(max-width: 557px) 100vw, 557px" /><figcaption>The list of targeted Chromium browsers</figcaption></figure>



<p>Fragment of the code performing queries:</p>



<figure class="wp-block-image"><img data-attachment-id="41404" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/steal_autofill/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/12/steal_autofill.png" data-orig-size="747,230" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="steal_autofill" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/12/steal_autofill-300x92.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/12/steal_autofill-600x185.png" loading="lazy" width="747" height="230" src="https://blog.malwarebytes.com/wp-content/uploads/2019/12/steal_autofill.png" alt="" class="wp-image-41404" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/12/steal_autofill.png 747w, https://blog.malwarebytes.com/wp-content/uploads/2019/12/steal_autofill-300x92.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/12/steal_autofill-600x185.png 600w" sizes="(max-width: 747px) 100vw, 747px" /></figure>



<p>The list of queries to the Chrome&#8217;s database:</p>



<pre class="wp-block-preformatted">SELECT name, value FROM autofill<br /><br />SELECT guid, company_name, street_address, city, state, zipcode, country_code FROM autofill_profiles<br /><br />SELECT guid, number FROM autofill_profile_phones<br /><br />SELECT guid, first_name, middle_name, last_name, full_name FROM autofill_profile_names<br /><br />SELECT card_number_encrypted, length(card_number_encrypted), name_on_card, expiration_month || "/" ||expiration_year FROM credit_cards<br /><br />SELECT origin_url,username_value,length(password_value),password_value FROM logins WHERE username_value &lt;&gt; ''<br /><br />SELECT host_key, path, is_secure, (case expires_utc when 0 then 0 else (expires_utc / 1000000) - 11644473600 end), name, length(encrypted_value), encrypted_value FROM cookies</pre>



<p>The list of queries to the Firefox&#8217;s database:</p>



<pre class="wp-block-preformatted">SELECT host, path, isSecure, expiry, name, value FROM moz_cookies<br /><br />SELECT fieldname, value FROM moz_formhistory</pre>



<p>All the found files are packed into a TAR archive and sent to the CnC.</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/11/fiefox_cookies.png" data-rel="lightbox-image-16" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="41340" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/fiefox_cookies/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/fiefox_cookies.png" data-orig-size="711,494" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="fiefox_cookies" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/fiefox_cookies-300x208.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/fiefox_cookies-600x417.png" loading="lazy" width="711" height="494" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/fiefox_cookies.png" alt="" class="wp-image-41340" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/fiefox_cookies.png 711w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/fiefox_cookies-300x208.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/fiefox_cookies-600x417.png 600w" sizes="(max-width: 711px) 100vw, 711px" /></a></figure>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/11/cookies_tar.png" data-rel="lightbox-image-17" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="41368" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/cookies_tar/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/cookies_tar.png" data-orig-size="900,578" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="cookies_tar" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/cookies_tar-300x193.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/cookies_tar-600x385.png" loading="lazy" width="900" height="578" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/cookies_tar.png" alt="" class="wp-image-41368" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/cookies_tar.png 900w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/cookies_tar-300x193.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/cookies_tar-600x385.png 600w" sizes="(max-width: 900px) 100vw, 900px" /></a></figure>



<p>Similarly, it creates a &#8220;<em>passff.tar</em>&#8221; archive with stolen Firefox profiles:</p>



<figure class="wp-block-image"><img data-attachment-id="41339" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/stealing_pass_db/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/stealing_pass_db.png" data-orig-size="489,647" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="stealing_pass_db" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/stealing_pass_db-227x300.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/stealing_pass_db-453x600.png" loading="lazy" width="453" height="600" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/stealing_pass_db-453x600.png" alt="" class="wp-image-41339" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/stealing_pass_db-453x600.png 453w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/stealing_pass_db-227x300.png 227w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/stealing_pass_db.png 489w" sizes="(max-width: 453px) 100vw, 453px" /></figure>



<h4 id="mce_37">Hooking browsers</h4>



<p>As mentioned earlier, the malware attacks and hooks browsers. Since the analogical functionality is achieved by different functions within different browsers, a set of installed hooks may be unique for each. </p>



<p>First, the malware searches for targets among the running processes. It uses the following algorithm:</p>



<figure class="wp-block-image"><img data-attachment-id="41293" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/check_browser/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/check_browser.png" data-orig-size="931,636" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="check_browser" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/check_browser-300x205.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/check_browser-600x410.png" loading="lazy" width="931" height="636" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/check_browser.png" alt="" class="wp-image-41293" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/check_browser.png 931w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/check_browser-300x205.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/check_browser-600x410.png 600w" sizes="(max-width: 931px) 100vw, 931px" /></figure>



<p>It is similar to the one from the previous version (described <a rel="noreferrer noopener" href="https://www.fortinet.com/blog/threat-research/deep-dive-icedid-malware-analysis-of-child-processes/_jcr_content/root/responsivegrid/image_547012751.img.png/1563813325832/iceid3-08.png" target="_blank" data-rel="lightbox-image-18" data-rl_title="" data-rl_caption="" title="">here</a>), yet we can see a few changes, i.e. the checksums are modified, and some additional checks are added. Yet, the list of the attacked browsers is the same, including the most popular ones: Firefox, MS Edge, Internet Explorer, and Chrome.</p>



<p>The browsers are first infected with the dedicated IcedID module. Just like all the modules in this edition of IcedID, the browser implant is a headerless PE file. Its reconstructed version is available here: <a rel="noreferrer noopener" aria-label="9e0c27746c11866c61dec17f1edfd2693245cd257dc0de2478c956b594bb2eb3 (opens in a new tab)" href="https://www.virustotal.com/gui/file/9e0c27746c11866c61dec17f1edfd2693245cd257dc0de2478c956b594bb2eb3/detection" target="_blank">9e0c27746c11866c61dec17f1edfd2693245cd257dc0de2478c956b594bb2eb3</a>. </p>



<p>After being injected, this module finds the appropriate DLLs in the memory of the process and sets redirections to its own code:</p>



<figure class="wp-block-image"><img data-attachment-id="41299" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/to_hook_module/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/to_hook_module.png" data-orig-size="416,112" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="to_hook_module" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/to_hook_module-300x81.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/to_hook_module.png" loading="lazy" width="416" height="112" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/to_hook_module.png" alt="" class="wp-image-41299" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/to_hook_module.png 416w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/to_hook_module-300x81.png 300w" sizes="(max-width: 416px) 100vw, 416px" /></figure>



<p>Parsing the instructions and installing the hooks:</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/11/write_jmp_hook.png" data-rel="lightbox-image-19" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="41300" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/write_jmp_hook/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/write_jmp_hook.png" data-orig-size="665,454" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="write_jmp_hook" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/write_jmp_hook-300x205.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/write_jmp_hook-600x410.png" loading="lazy" width="665" height="454" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/write_jmp_hook.png" alt="" class="wp-image-41300" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/write_jmp_hook.png 665w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/write_jmp_hook-300x205.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/write_jmp_hook-600x410.png 600w" sizes="(max-width: 665px) 100vw, 665px" /></a></figure>



<p>Then, the selected API functions are intercepted and redirected to the plugin. Usually the hooks are installed at the beginning of functions, but there are exceptions to this rule. For example, in case of Internet Explorer, a function within the <em>mswsock.dll</em> has been intercepted in between:</p>



<figure class="wp-block-image"><img data-attachment-id="41289" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/in_mswsock/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/in_mswsock.png" data-orig-size="846,123" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="in_mswsock" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/in_mswsock-300x44.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/in_mswsock-600x87.png" loading="lazy" width="846" height="123" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/in_mswsock.png" alt="" class="wp-image-41289" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/in_mswsock.png 846w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/in_mswsock-300x44.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/in_mswsock-600x87.png 600w" sizes="(max-width: 846px) 100vw, 846px" /></figure>



<p>Looking at the elements in memory involved in intercepting the calls: the browser implant (headerless PE), and the additional memory page:</p>



<figure class="wp-block-image"><img data-attachment-id="41301" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/hook_elements/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_elements.png" data-orig-size="583,313" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="hook_elements" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_elements-300x161.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_elements.png" loading="lazy" width="583" height="313" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_elements.png" alt="" class="wp-image-41301" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_elements.png 583w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_elements-300x161.png 300w" sizes="(max-width: 583px) 100vw, 583px" /></figure>



<p>Example of the hook in Firefox:</p>



<p>Step 1: the function <em>SSL_AuthCertificateHook</em> has a jump redirecting to the implanted module:</p>



<figure class="wp-block-image"><img data-attachment-id="41302" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/hook_step1/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_step1.png" data-orig-size="584,157" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="hook_step1" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_step1-300x81.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_step1.png" loading="lazy" width="584" height="157" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_step1.png" alt="" class="wp-image-41302" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_step1.png 584w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_step1-300x81.png 300w" sizes="(max-width: 584px) 100vw, 584px" /></figure>



<p>Step 2: The implanted module calls the code from the additional page with appropriate parameters:</p>



<figure class="wp-block-image"><img data-attachment-id="41303" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/hook_step2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_step2.png" data-orig-size="546,70" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="hook_step2" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_step2-300x38.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_step2.png" loading="lazy" width="546" height="70" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_step2.png" alt="" class="wp-image-41303" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_step2.png 546w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_step2-300x38.png 300w" sizes="(max-width: 546px) 100vw, 546px" /></figure>



<p>Step 3: The code at the additional page is a patched fragment of the original function. After executing the modified code, it goes back to the original DLL.</p>



<figure class="wp-block-image"><img data-attachment-id="41304" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/hook_step3/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_step3.png" data-orig-size="541,317" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="hook_step3" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_step3-300x176.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_step3.png" loading="lazy" width="541" height="317" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_step3.png" alt="" class="wp-image-41304" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_step3.png 541w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/hook_step3-300x176.png 300w" sizes="(max-width: 541px) 100vw, 541px" /></figure>



<p>The functionality of this hook didn&#8217;t change from the previous version.</p>



<h4 id="mce_35">Webinjects</h4>



<p>The bot gets the configuration from the CnC in the form of .DAT files that were mentioned before. First, the file is decoded by RC4 algorithm. The output must start from the &#8220;zeus&#8221; keyword, and is further encoded by a custom algorithm. Scripts dedicated for each site are identified by a script ID.</p>



<figure class="wp-block-image"><img data-attachment-id="41298" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/decode_zeus_config/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decode_zeus_config.png" data-orig-size="713,684" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="decode_zeus_config" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decode_zeus_config-300x288.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decode_zeus_config-600x576.png" loading="lazy" width="713" height="684" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decode_zeus_config.png" alt="" class="wp-image-41298" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/decode_zeus_config.png 713w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/decode_zeus_config-300x288.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/decode_zeus_config-600x576.png 600w" sizes="(max-width: 713px) 100vw, 713px" /></figure>



<p>After the files are loaded and decoded, we can see the content:</p>



<figure class="wp-block-image"><img data-attachment-id="41277" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/script-14/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/script.png" data-orig-size="532,301" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="script" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/script-300x170.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/script.png" loading="lazy" width="532" height="301" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/script.png" alt="" class="wp-image-41277" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/script.png 532w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/script-300x170.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/script-400x225.png 400w" sizes="(max-width: 532px) 100vw, 532px" /></figure>



<p>There are multiple types of webinjects available to perform by the bot:</p>



<figure class="wp-block-image"><img data-attachment-id="41369" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/webinject_types/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/webinject_types.png" data-orig-size="708,619" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="webinject_types" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/webinject_types-300x262.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/11/webinject_types-600x525.png" loading="lazy" width="600" height="525" src="https://blog.malwarebytes.com/wp-content/uploads/2019/11/webinject_types-600x525.png" alt="" class="wp-image-41369" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/11/webinject_types-600x525.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/webinject_types-300x262.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/11/webinject_types.png 708w" sizes="(max-width: 600px) 100vw, 600px" /></figure>



<p>Depending on the configuration, the bot may replace some parts of the website&#8217;s code, or add some new, malicious scripts.</p>



<h4>Executing remote commands</h4>



<p>In case the commands implemented by the bot are not enough for the needs of the operator, the bot allows a feature of executing commands from the command line.</p>



<figure class="wp-block-image"><img data-attachment-id="41405" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/12/new-version-of-icedid-trojan-uses-steganographic-payloads/attachment/read_cli_param/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/12/read_cli_param.png" data-orig-size="664,246" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="read_cli_param" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/12/read_cli_param-300x111.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/12/read_cli_param-600x222.png" loading="lazy" width="664" height="246" src="https://blog.malwarebytes.com/wp-content/uploads/2019/12/read_cli_param.png" alt="" class="wp-image-41405" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/12/read_cli_param.png 664w, https://blog.malwarebytes.com/wp-content/uploads/2019/12/read_cli_param-300x111.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/12/read_cli_param-600x222.png 600w" sizes="(max-width: 664px) 100vw, 664px" /></figure>



<p>The output of the run commands is sent back to the malware via named pipe, and then supplied back to the CnC.</p>



<h3>Mature banker and stealer</h3>



<p>As we can see from the above analysis, IcedID is not only a banking Trojan, but a general-purpose stealer able to extract a variety of credentials. It can also work as a downloader for other modules, including covert ones, that look like harmless PNG files.</p>



<p>This bot is mature, written by experienced developers. It deploys various typical techniques, including Zeus-style webinjects, hooks for various browsers, hidden VNC, and backconnect. Its authors also used several known obfuscation techniques. In addition, the use of customized PE headers is an interesting bonus, slowing down static analysis.</p>



<p>In recent updates, the malware authors equipped the bot with steganography. It is not a novelty to see it in the threat landscape, but it is a feature that makes this malware a bit more stealthy.</p>



<h3>Indicators of Compromise</h3>



<p>Sandbox runs:</p>



<p>https://app.any.run/tasks/8595602a-fa98-4cfa-80d7-98925091dc48/<br />https://app.any.run/tasks/a7abba78-cf6d-4c68-b94c-4835d5becb13/</p>



<h3>MITRE</h3>



<ul><li>Execution:<ul><li>Command-Line Interface</li><li><strong>Execution through Module Load</strong></li><li><strong>Scheduled Task</strong></li><li>Scripting</li><li>Windows Managment Intstrumentation</li></ul></li></ul>



<ul><li>Persistence:<ul><li><strong>Registry Run Keys/ Startup Folder</strong></li><li><strong>Scheduled Task</strong></li></ul></li></ul>



<ul><li>Privilege Escalation<ul><li><strong>Scheduled Task</strong></li></ul></li></ul>



<ul><li>Defense Evasion<ul><li>Scripting</li></ul></li></ul>



<ul><li>Credential Access<ul><li><strong>Credentials in Files</strong></li><li>Credential Dumping</li></ul></li></ul>



<ul><li>Discovery<ul><li>Network Share Discovery</li><li>Query Registry</li><li>Remote System Discovery</li><li>System Information Discovery</li><li>System Network Configuration Discovery</li></ul></li></ul>



<ul><li>Lateral Movement<ul><li><strong>Remote File Copy</strong></li></ul></li></ul>



<p>Source: <a href="https://app.any.run/tasks/48414a33-3d66-4a46-afe5-c2003bb55ccf/" target="_blank" rel="noreferrer noopener" aria-label="https://app.any.run/tasks/48414a33-3d66-4a46-afe5-c2003bb55ccf/
 (opens in a new tab)">https://app.any.run/tasks/48414a33-3d66-4a46-afe5-c2003bb55ccf/<br /></a></p>



<h3>References</h3>



<p>About the old variants of IceID:</p>



<ul><li> Deep Dive Into IcedID Malware &#8211; by Kai Lu, Fortinet: [<a rel="noreferrer noopener" aria-label="1 (opens in a new tab)" href="https://www.fortinet.com/blog/threat-research/icedid-malware-analysis-part-one.html" target="_blank">1</a>][<a rel="noreferrer noopener" aria-label="2 (opens in a new tab)" href="https://www.fortinet.com/blog/threat-research/icedid-malware-analysis-part-two.html" target="_blank">2</a>][<a rel="noreferrer noopener" aria-label="3 (opens in a new tab)" href="https://www.fortinet.com/blog/threat-research/deep-dive-icedid-malware-analysis-of-child-processes.html" target="_blank">3</a>]</li><li><a href="https://medium.com/@dawid.golak/icedid-aka-bokbot-analysis-with-ghidra-560e3eccb766" target="_blank" rel="noreferrer noopener" aria-label="https://medium.com/@dawid.golak/icedid-aka-bokbot-analysis-with-ghidra-560e3eccb766 (opens in a new tab)">https://medium.com/@dawid.golak/icedid-aka-bokbot-analysis-with-ghidra-560e3eccb766</a></li></ul>
</div>
        
      <div class="share-section">
          <p><b>SHARE THIS ARTICLE</b></p>
         


         <a class="socicon-facebook" target="_blank" href="http://www.facebook.com/sharer.php?u=https%3A%2F%2Fblog.malwarebytes.com%2F%3Fp%3D40994&t=New+version+of+IcedID+Trojan+uses+steganographic+payloads" id="social-share-facebook" aria-label="Share this post on Facebook"></a>
         <a class="socicon-twitter" target="_blank" href="https://twitter.com/intent/tweet?text=New+version+of+IcedID+Trojan+uses+steganographic+payloads+https%3A%2F%2Fblog.malwarebytes.com%2F%3Fp%3D40994&via=Malwarebytes" id="social-share-twitter" aria-label="Share this post on Twitter"></a> 
        
          <a class="socicon-linkedin" target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fblog.malwarebytes.com%2F%3Fp%3D40994&title=New+version+of+IcedID+Trojan+uses+steganographic+payloads&summary=&source=" id="social-share-linkedin" aria-label="Share this post on LinkedIn"></a>
          

        
          
        </div>
      <hr />
      <div class="comments-section">
        <p><b>COMMENTS</b></p>
<div id="disqus_thread"></div>
</div>
        </div>
      <hr />
      <div class="related-articles">
        <p><b>RELATED ARTICLES</b></p>
    <div class="post">
      <div class="large-card">
                  <div class="thumb">
            <a href="https://blog.malwarebytes.com/threat-analysis/2020/12/advanced-cyber-attack-hits-private-and-public-sector-via-supply-chain-software-update/ ">
            <img src="https://blog.malwarebytes.com/wp-content/uploads/2020/12/shutterstock_735706717-1-604x270.png" alt="SolarWinds advanced cyberattack: What happened and what to do now">
            </a>
          </div>
                    <div class="content">
            <p class="breadcrumbs hidden-xs"><a href="https://blog.malwarebytes.com/category/threat-analysis/" rel="category tag">Threat analysis</a></p>
            
                      <h2><a href="https://blog.malwarebytes.com/threat-analysis/2020/12/advanced-cyber-attack-hits-private-and-public-sector-via-supply-chain-software-update/ ">SolarWinds advanced cyberattack: What happened and what to do now</a></h2>
            
          </div>
        </div>
                      <p class="desc"> December 14, 2020 - Possibly the largest hacking operation of 2020 was just unveiled. In this blog we share what we know and what you should do right now.</p>
            <div class="post-action"><a href="https://blog.malwarebytes.com/threat-analysis/2020/12/advanced-cyber-attack-hits-private-and-public-sector-via-supply-chain-software-update/" class="continue-read">CONTINUE READING</a><a class="num-comments" href="https://blog.malwarebytes.com/threat-analysis/2020/12/advanced-cyber-attack-hits-private-and-public-sector-via-supply-chain-software-update/#disqus_thread"><span class="dsq-postid" data-dsqidentifier="45862 https://blog.malwarebytes.com/?p=45862">No Comments</span></a></div>
          </div> 

            <div class="post">
      <div class="large-card">
                  <div class="thumb">
            <a href="https://blog.malwarebytes.com/security-world/2020/05/going-dark-encryption-and-law-enforcement/ ">
            <img src="https://blog.malwarebytes.com/wp-content/uploads/2017/07/key-604x270.jpg" alt="Going dark: encryption and law enforcement">
            </a>
          </div>
                    <div class="content">
            <p class="breadcrumbs hidden-xs"><a href="https://blog.malwarebytes.com/category/security-world/government/" rel="category tag">Government</a> | <a href="https://blog.malwarebytes.com/category/security-world/privacy-security-world/" rel="category tag">Privacy</a> | <a href="https://blog.malwarebytes.com/category/security-world/" rel="category tag">Security world</a></p>
            
                      <h2><a href="https://blog.malwarebytes.com/security-world/2020/05/going-dark-encryption-and-law-enforcement/ ">Going dark: encryption and law enforcement</a></h2>
            
          </div>
        </div>
                      <p class="desc"> May 22, 2020 - There's been a lot of talk recently about encryption and how law enforcement can't convict criminals without encryption keys. We beg to differ.</p>
            <div class="post-action"><a href="https://blog.malwarebytes.com/security-world/2020/05/going-dark-encryption-and-law-enforcement/" class="continue-read">CONTINUE READING</a><a class="num-comments" href="https://blog.malwarebytes.com/security-world/2020/05/going-dark-encryption-and-law-enforcement/#disqus_thread"><span class="dsq-postid" data-dsqidentifier="18886 https://blog.malwarebytes.com/?p=18886">No Comments</span></a></div>
          </div> 

            <div class="post">
      <div class="large-card">
                  <div class="thumb">
            <a href="https://blog.malwarebytes.com/privacy-2/2019/08/backdoors-are-a-security-vulnerability/ ">
            <img src="https://blog.malwarebytes.com/wp-content/uploads/2019/08/shutterstock_243947152-1-604x270.jpg" alt="Backdoors are a security vulnerability">
            </a>
          </div>
                    <div class="content">
            <p class="breadcrumbs hidden-xs"><a href="https://blog.malwarebytes.com/category/privacy-2/" rel="category tag">Privacy</a></p>
            
                      <h2><a href="https://blog.malwarebytes.com/privacy-2/2019/08/backdoors-are-a-security-vulnerability/ ">Backdoors are a security vulnerability</a></h2>
            
          </div>
        </div>
                      <p class="desc"> August 9, 2019 - Upset by their inability to access potentially vital evidence for criminal investigations, the federal government has, for years, pushed to convince tech companies to build backdoors that will, allegedly, only be used by law enforcement agencies. The problem, cybersecurity researchers say, is that those backdoors can easily be exploited by criminals.</p>
            <div class="post-action"><a href="https://blog.malwarebytes.com/privacy-2/2019/08/backdoors-are-a-security-vulnerability/" class="continue-read">CONTINUE READING</a><a class="num-comments" href="https://blog.malwarebytes.com/privacy-2/2019/08/backdoors-are-a-security-vulnerability/#disqus_thread"><span class="dsq-postid" data-dsqidentifier="39884 https://blog.malwarebytes.com/?p=39884">No Comments</span></a></div>
          </div> 

            <div class="post">
      <div class="large-card">
                  <div class="thumb">
            <a href="https://blog.malwarebytes.com/a-week-in-security/2019/07/a-week-in-security-july-15-21/ ">
            <img src="https://blog.malwarebytes.com/wp-content/uploads/2018/01/shutterstock_610335074-604x270.jpg" alt="A week in security (July 15 – 21)">
            </a>
          </div>
                    <div class="content">
            <p class="breadcrumbs hidden-xs"><a href="https://blog.malwarebytes.com/category/a-week-in-security/" rel="category tag">A week in security</a></p>
            
                      <h2><a href="https://blog.malwarebytes.com/a-week-in-security/2019/07/a-week-in-security-july-15-21/ ">A week in security (July 15 – 21)</a></h2>
            
          </div>
        </div>
                      <p class="desc"> July 22, 2019 - A roundup of cybersecurity news from July 15–21, including the Zoom camera vulnerability, Extenbro, Sodinokibi, Magecart, and cybersecurity challenges facing the education sector.</p>
            <div class="post-action"><a href="https://blog.malwarebytes.com/a-week-in-security/2019/07/a-week-in-security-july-15-21/" class="continue-read">CONTINUE READING</a><a class="num-comments" href="https://blog.malwarebytes.com/a-week-in-security/2019/07/a-week-in-security-july-15-21/#disqus_thread"><span class="dsq-postid" data-dsqidentifier="39631 https://blog.malwarebytes.com/?p=39631">No Comments</span></a></div>
          </div> 

            <div class="post">
      <div class="large-card">
                  <div class="thumb">
            <a href="https://blog.malwarebytes.com/threat-analysis/2018/12/mac-malware-combines-empyre-backdoor-and-xmrig-miner/ ">
            <img src="https://blog.malwarebytes.com/wp-content/uploads/2018/12/shutterstock_320446367-604x270.jpg" alt="Mac malware combines EmPyre backdoor and XMRig miner">
            </a>
          </div>
                    <div class="content">
            <p class="breadcrumbs hidden-xs"><a href="https://blog.malwarebytes.com/category/threat-analysis/mac-threat-analysis/" rel="category tag">Mac</a> | <a href="https://blog.malwarebytes.com/category/threat-analysis/" rel="category tag">Threat analysis</a></p>
            
                      <h2><a href="https://blog.malwarebytes.com/threat-analysis/2018/12/mac-malware-combines-empyre-backdoor-and-xmrig-miner/ ">Mac malware combines EmPyre backdoor and XMRig miner</a></h2>
            
          </div>
        </div>
                      <p class="desc"> December 7, 2018 - New Mac malware is using the EmPyre backdoor and the XMRig cryptominer to drain processor power—and possibly worse.</p>
            <div class="post-action"><a href="https://blog.malwarebytes.com/threat-analysis/2018/12/mac-malware-combines-empyre-backdoor-and-xmrig-miner/" class="continue-read">CONTINUE READING</a><a class="num-comments" href="https://blog.malwarebytes.com/threat-analysis/2018/12/mac-malware-combines-empyre-backdoor-and-xmrig-miner/#disqus_thread"><span class="dsq-postid" data-dsqidentifier="26544 https://blog.malwarebytes.com/?p=26544">No Comments</span></a></div>
          </div> 

          
        
      
      </div>
      
      
      
    </div>
    <div class="col-md-4" id="right-rail">
      <hr class="visible-xs visible-sm">



<!-- AUTHOR MODULE -->
<div class="right-rail-section author-info">
      <p><b>ABOUT THE AUTHOR</b></p>
              <div class="small-card">
            <img alt='' src='https://secure.gravatar.com/avatar/147cd7280d6ece931e4488a3a10809d9?s=96&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/147cd7280d6ece931e4488a3a10809d9?s=192&#038;d=identicon&#038;r=g 2x' class='avatar avatar-96 photo' height='96' width='96' loading='lazy'/>            <div class="content">
              <p class="details">
              <span class="name"><a href="https://blog.malwarebytes.com/author/threatintelligence/" title="Posts by Threat Intelligence Team" rel="author">Threat Intelligence Team</a></span>
                
                                
                
                              <br/><span class="title"></span>
                            </p>

                            <p class="desc"></p>
                          </div>
          </div>
      </div>

<!-- SUB CATEGORIES -->
      


	


         
<!-- TOP THREATS -->
    </div>
  </div>
</div>
  
</section>
</article>
  
  
      </div>


<script type="text/plain" class="optanon-category-3">
  var embeds = document.getElementsByClassName('embedded-video');
  var alts = document.getElementsByClassName('embedded-video-alt');
  if(embeds && alts) {
    for(var i = 0; i < embeds.length; i++) {
      embeds[i].src = embeds[i].dataset.src;
      embeds[i].style.display = 'inline-block';
    }

    for(var i = 0; i < alts.length; i++) {
      alts[i].style.display = 'none';
    }
  }
</script>

<script type="text/javascript">
    setTimeout(function() {
        var alts = document.getElementsByClassName('embedded-video-alt');
        for( i = 0; i < alts.length; i++) {
            alts[i].style.background = "none";
        }
    }, 2500);
</script>


<script type="text/plain" class="optanon-category-4">
  $("script[src='https://malwarebytesunpacked.disqus.com/embed.js']").each(function() {
    var scriptSrc = $(this).attr("src");
    var newScript = "<script type='text/javascript' async='' src='" + scriptSrc + "'>";
    $(this).before(newScript).remove();
  });
  
  $("link[href*='https://c.disquscdn.com/next/embed/lounge.bundle'], link[href*='https://c.disquscdn.com/next/embed/common.bundle']").each(function() {
    /**/
  });
  
</script>


<!-- for Labs Nav -->
<script>
var urlID = "blog";
</script>
<script src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/js/labs-nav.js"></script>
<section id="labs-links">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
      <div class="lablink">
        <p><a href="/authors/" id="cta-labs-footernavigation-linkto-contributors-en"><img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/footer/contributors.svg" alt="Silouette of person"><br>
            Contributors</a></p>

      </div>

      <div class="lablink">
        <p><a href="/threats/" id="cta-labs-footernavigation-linkto-threatcenter-en"><img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/footer/threat-center.svg" alt="Malware"><br>
            Threat Center</a></p>
            
      </div>

      <div class="lablink">
        <p><a href="/glossary/" id="cta-labs-footernavigation-linkto-glossary-en"><img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/footer/glossary.svg" alt="Book with bookmark"><br>
            Glossary</a></p>
            
      </div>

      <div class="lablink">
        <p><a href="/tech-support-scams/" id="cta-labs-footernavigation-linkto-scams-en"><img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/footer/scams.svg" alt="Suspicious person"><br>
            Scams</a></p>
            
      </div>

      <div class="lablink">
        <p><a href="/write/" id="cta-labs-footernavigation-linkto-writeforlabs-en"><img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/footer/write.svg" alt="Pencil"><br>
            Write for Labs</a></p>
            
      </div>
</div>
    </div>
  </div>
</section>


<footer class="refresh-footer">
    <div class="container">
        <div class="row links-row">
            <!-- newsletter -->
            <div class="col-md-3 col-xs-12 col-md-push-9 newsletter-col">
                <div class="row soc-icon-row newsletter-icons hidden-xs hidden-sm">
                    <div class="footer-soc-icon">
                        <a id="cta-footer-social-twitter-en" class="social socicon-twitter"
                           href="https://twitter.com/malwarebytes" aria-label="Visit Malwarebytes on Twitter"></a>
                    </div>
                    <div class="footer-soc-icon">
                        <a id="cta-footer-social-facebook-en" class="social socicon-facebook"
                           href="https://www.facebook.com/Malwarebytes/"
                           aria-label="Visit Malwarebytes on Facebook"></a>
                    </div>
                    <div class="footer-soc-icon">
                        <a id="cta-footer-social-linkedin-en" class="social socicon-linkedin"
                           href="https://www.linkedin.com/company/malwarebytes"
                           aria-label="Visit Malwarebytes on LinkedIn"></a>
                    </div>
                    <div class="footer-soc-icon">
                        <a id="cta-footer-social-youtube-en" class="social socicon-youtube"
                           href="https://www.youtube.com/user/Malwarebytes"
                           aria-label="Visit Malwarebytes on YouTube"></a>
                    </div>
                    <div class="footer-soc-icon">
                        <a id="cta-footer-social-instagram-en" class="social socicon-instagram-v2"
                           href="https://www.instagram.com/malwarebytesofficial/"
                           aria-label="Visit Malwarebytes on Instagram"></a>
                    </div>
                </div>
                <div class="row newsletter-refresh">
                    <div class="col-xs-12">
                        <h4>Cybersecurity info you can't do without</h4>
                        <p>Want to stay informed on the latest news in cybersecurity? Sign up for our newsletter and
                            learn
                            how to protect your computer from threats.</p>
                    </div>
                    <div class="col-xs-12">
                        <form class="newsletter-form form-inline" action="//www.malwarebytes.com/newsletter/" _lpchecked="1">
                            <div class="email-input">
                                <label for="cta-footer-newsletter-input-email-en"
                                       aria-label="cta-footer-newsletter-input-email-en"
                                       aria-labelledby="cta-footer-newsletter-input-email-en">
                                    <input type="text" class="email-input-field"
                                           id="cta-footer-newsletter-input-email-en" name="email"
                                           placeholder="Email address">
                                </label>
                                <input name="source" type="hidden" value="">
                                <input type="submit" class="submit-bttn" id="cta-footer-newsletter-subscribe-email-en"
                                       value="">
                            </div>
                        </form>
                    </div>
                </div>

            </div>
            <!--logo col-->
            <div class="col-md-2 col-xs-12 col-md-pull-3 footer-col">
                <div class="footer-logo hidden-xs hidden-sm">
                    <svg width="160px" height="25px" viewBox="0 0 160 25" version="1.1"
                         xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g id="Symbols" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <g id="Footer-desktop" transform="translate(-165.000000, -68.000000)" fill="#FFFFFF">
                                <g id="Footer">
                                    <g id="Group-3">
                                        <g transform="translate(165.000000, 68.000000)">
                                            <g id="logo">
                                                <path
                                                        d="M104.620758,6.81492418 L104.53414,6.84800885 L104.53414,0.579460088 C104.53414,0.43037976 104.412794,0.314384104 104.256721,0.347468775 L102.436133,0.61294337 C102.314787,0.61294337 102.245333,0.728939026 102.245333,0.844934683 L102.245333,19.1016943 C102.245333,19.21769 102.33235,19.3340842 102.436133,19.3340842 C104.01363,19.6820712 105.99069,19.8315502 107.221712,19.8315502 C112.440783,19.8315502 113.151295,17.4434746 113.151295,14.840548 L113.151295,10.0313123 C113.151295,7.27890681 111.7642,5.86981868 109.076628,5.86981868 C107.135093,5.86981868 105.52247,6.36728459 104.620758,6.81492418 M110.827761,9.96514299 L110.827761,14.923459 C110.827761,16.7805854 110.238195,17.9078559 107.394949,17.9078559 C106.441346,17.9078559 105.504907,17.8249449 104.586031,17.7256909 L104.551304,17.7256909 L104.551304,8.85421552 L104.586031,8.85421552 C105.418288,8.47274526 107.152257,7.82580042 108.504625,7.82580042 C110.100084,7.80945739 110.827761,8.48908829 110.827761,9.96514299"
                                                        id="Fill-1"></path>
                                                <path
                                                        d="M116.202745,6.1348548 L114.469175,6.1348548 C114.313102,6.1348548 114.191357,6.28433374 114.226483,6.43341407 L118.612898,19.3675277 C118.647625,19.4835233 118.734244,19.516608 118.85559,19.516608 L119.375701,19.516608 C119.531774,19.516608 119.653519,19.6656883 119.618792,19.8151673 L117.884823,24.657089 C117.850095,24.8061694 117.971441,24.9556483 118.127115,24.9556483 L119.739738,24.9556483 C119.861084,24.9556483 119.930539,24.8727373 119.982829,24.8061694 L121.924763,19.5496927 L126.467251,6.43341407 C126.501978,6.28433374 126.380632,6.1348548 126.224559,6.1348548 L124.49059,6.1348548 C124.369244,6.1348548 124.300189,6.21776579 124.247898,6.28433374 L120.571996,17.2118421 C120.485377,17.4438334 120.173231,17.4438334 120.103776,17.2118421 L116.497727,6.28433374 C116.393945,6.21776579 116.306927,6.1348548 116.202745,6.1348548"
                                                        id="Fill-3"></path>
                                                <path
                                                        d="M137.858597,10.8605816 L137.858597,14.9068768 C137.858597,18.2731425 139.592566,19.8153666 143.389415,19.8153666 C145.002038,19.8153666 146.787898,19.549892 148.088375,19.135337 C148.21012,19.1022524 148.278776,18.9862567 148.245246,18.8702611 L148.001756,17.57677 C147.967029,17.4276897 147.846082,17.3447787 147.68961,17.3942064 C146.146441,17.7756766 144.759346,17.9582402 143.545887,17.9582402 C140.615224,17.9582402 140.112676,16.9796514 140.112676,14.8901352 L140.112676,13.9450297 C140.112676,13.7955508 140.234022,13.7126398 140.355368,13.7126398 L148.261612,13.7126398 C148.417685,13.7126398 148.504703,13.5966441 148.504703,13.4806485 L148.504703,10.9765773 C148.504703,7.57762552 146.805461,5.9524905 143.251304,5.9524905 C139.713512,5.86957951 137.858597,7.54454085 137.858597,10.8605816 L137.858597,10.8605816 Z M140.147005,10.7115013 C140.147005,8.63912529 141.135734,7.72710446 143.303195,7.72710446 C145.43553,7.72710446 146.302515,8.58929898 146.302515,10.7115013 L146.302515,11.6566068 C146.302515,11.8056871 146.181568,11.8885981 146.059823,11.8885981 L140.372931,11.8885981 C140.216858,11.8885981 140.12984,11.7726025 140.12984,11.6566068 L140.12984,10.7115013 L140.147005,10.7115013 Z"
                                                        id="Fill-5"></path>
                                                <path
                                                        d="M155.370725,11.888638 C152.995299,11.3254013 152.925845,11.0599267 152.925845,9.50135967 C152.925845,8.20786859 153.289883,7.76022899 155.370725,7.76022899 C156.359056,7.76022899 157.780479,7.87622465 158.977173,8.10821596 C159.133246,8.14169924 159.254193,8.02530497 159.254193,7.87622465 L159.375938,6.54925028 C159.375938,6.43325463 159.28892,6.31725897 159.185537,6.2841743 C158.075461,6.0186997 156.740656,5.86922077 155.474907,5.86922077 C151.954679,5.86922077 150.654601,6.84780955 150.654601,9.46827499 C150.654601,12.2202819 150.966747,12.9166545 154.45145,13.7457643 C157.260368,14.3927091 157.451169,14.5417895 157.451169,16.0840135 C157.451169,17.5269835 157.087131,17.9746231 154.763597,17.9746231 C153.65392,17.9746231 152.232497,17.7924581 151.053366,17.5269835 C150.897293,17.4938989 150.775548,17.5600682 150.74122,17.7095471 L150.498528,18.9532119 C150.463801,19.0692076 150.533255,19.1852032 150.654601,19.2182879 C151.799005,19.5997581 153.532974,19.8652327 154.885342,19.8652327 C158.95961,19.8652327 159.705248,18.5717417 159.705248,16.0011025 C159.722812,13.1323027 159.167974,12.8006588 155.370725,11.888638"
                                                        id="Fill-7"></path>
                                                <path
                                                        d="M48.2703991,19.417075 L45.7389002,6.3669657 C45.704173,6.21788537 45.8255189,6.06840643 45.9819912,6.06840643 L48.7909092,6.06840643 C48.9118559,6.06840643 49.033601,6.15131742 49.033601,6.25097004 L50.541643,14.1103733 C50.5763703,14.3762465 50.940408,14.3762465 51.0098626,14.1438566 L53.4547428,6.2342284 C53.489071,6.11823275 53.5760887,6.0520634 53.6974346,6.0520634 L57.0268626,6.0520634 C57.1478094,6.0520634 57.2168648,6.13497439 57.2691553,6.2342284 L59.7140355,14.1438566 C59.8006542,14.3762465 60.1475278,14.3762465 60.1822551,14.1103733 L61.6902971,6.25097004 C61.7250244,6.13497439 61.8120422,6.06840643 61.9333881,6.06840643 L64.7423061,6.06840643 C64.8979801,6.06840643 65.019326,6.21788537 64.9845987,6.3669657 L62.4359357,19.417075 C62.4012085,19.5330706 62.314989,19.5996386 62.1932439,19.5996386 L58.5177407,19.5996386 C58.3959956,19.5996386 58.326541,19.5167276 58.2746497,19.417075 L55.5874768,10.6452522 C55.500459,10.4132609 55.1883127,10.4132609 55.1192573,10.6452522 L52.4320843,19.417075 C52.3973571,19.5330706 52.3103393,19.5996386 52.1889934,19.5996386 L48.5130909,19.5996386 C48.391745,19.5996386 48.3051264,19.5330706 48.2703991,19.417075"
                                                        id="Fill-9"></path>
                                                <path
                                                        d="M44.1961309,17.1122293 C42.9303814,17.1122293 42.5312173,16.5816787 42.5312173,15.0725394 L42.5312173,5.27270015 L42.5312173,1.40856993 C42.5312173,1.25948961 42.4098714,1.14309534 42.2541974,1.17657862 L39.2025876,1.59113354 C39.0812417,1.59113354 39.0117872,1.70752781 39.0117872,1.82352347 L39.0117872,1.93951912 L39.0117872,5.27270015 L39.0117872,15.437268 C39.0117872,18.505373 40.9537207,19.8650334 43.554275,19.8650334 C43.8320932,19.8650334 44.733805,19.8315502 45.2535167,19.7817238 C45.3748626,19.7817238 45.4962085,19.6657282 45.4962085,19.5497325 L45.4962085,17.3940469 C45.4962085,17.2449666 45.3748626,17.1620556 45.2191885,17.1620556 C44.8723149,17.1122293 44.4040954,17.1122293 44.1961309,17.1122293"
                                                        id="Fill-11"></path>
                                                <path
                                                        d="M87.0914657,9.02011721 C85.8257163,9.55066779 84.8030578,10.114303 83.658255,10.8274172 C83.5720356,10.8605019 83.5373083,10.9434129 83.5373083,11.0099808 L83.5373083,19.3672486 C83.5373083,19.5167276 83.4155633,19.5996386 83.2942174,19.5996386 L80.2426076,19.5996386 C80.0865344,19.5996386 79.9999158,19.4832443 79.9999158,19.3672486 L79.9999158,6.78152062 C79.9999158,6.66552497 80.0865344,6.54952931 80.1907163,6.54952931 L82.7222152,6.13457578 C82.8782883,6.10149111 82.9996342,6.21748676 82.9996342,6.31713939 L83.1209801,7.1793339 C83.1557074,7.36189752 83.3636719,7.4448085 83.5197451,7.32881284 C84.317275,6.83134694 85.5834236,6.20114373 86.6060821,5.85275815 C86.7621553,5.81967348 86.9178293,5.88624143 86.9178293,6.03532176 L87.1956475,8.68847327 C87.2475389,8.85429524 87.1784835,8.93720622 87.0914657,9.02011721"
                                                        id="Fill-13"></path>
                                                <path
                                                        d="M134.217781,17.9744637 C132.795559,17.9744637 132.709339,17.3777438 132.709339,16.4322396 L132.709339,8.22405217 C132.709339,8.07497184 132.830286,7.99206086 132.951632,7.99206086 L136.28106,7.99206086 C136.402406,7.99206086 136.523353,7.90914987 136.523353,7.76006955 L136.679825,6.43349379 C136.679825,6.28401485 136.55808,6.1680192 136.437133,6.1680192 L132.951632,6.1680192 C132.795559,6.1680192 132.709339,6.05202354 132.709339,5.93562927 L132.709339,2.81889375 C132.709339,2.66941482 132.587594,2.55302055 132.431521,2.58650383 L130.611333,2.85197843 C130.489987,2.85197843 130.420532,2.96757547 130.420532,3.08357113 L130.420532,5.95237092 C130.420532,6.10184985 130.299186,6.18476084 130.17784,6.18476084 L128.20118,6.18476084 C128.045107,6.18476084 127.958089,6.3007565 127.958089,6.41675215 L127.958089,7.74332791 C127.958089,7.89240823 128.079834,7.97531922 128.20118,7.97531922 L130.17784,7.97531922 C130.333914,7.97531922 130.420532,8.09171348 130.420532,8.20770914 L130.420532,16.7638836 C130.420532,18.9195692 131.408863,19.7817637 133.853344,19.7817637 C134.408581,19.7817637 134.96302,19.748679 135.518257,19.6326834 C135.639603,19.5995987 135.708659,19.5166877 135.708659,19.4006921 L135.708659,18.0741163 C135.708659,17.9246374 135.552985,17.8086417 135.43124,17.8417264 C134.980184,17.941379 134.581818,17.9744637 134.217781,17.9744637"
                                                        id="Fill-15"></path>
                                                <path
                                                        d="M97.3387274,6.21776579 C96.5930888,5.91920652 95.6394857,5.72029988 94.4084635,5.72029988 C93.0213682,5.72029988 91.9631841,5.95229119 91.131326,6.31741841 C89.1893925,7.22943924 88.565499,9.00365459 88.565499,10.9600349 L88.565499,14.5586906 C88.565499,17.7423926 90.0216497,19.698773 94.2523903,19.781684 L95.2403216,19.781684 C96.3847251,19.781684 97.58102,19.6656883 98.6739314,19.5162094 C98.7948781,19.4831247 98.916224,19.3675277 98.8639335,19.251532 L98.8639335,19.1351377 L98.5869136,17.2780114 C97.5119646,17.3940071 96.5755256,17.4274903 95.5009757,17.4274903 C92.9000223,17.4274903 92.1024923,16.7143762 92.1024923,15.1888938 L92.1024923,14.7408556 L92.1024923,14.111051 L99.7313172,14.111051 C99.8873903,14.111051 99.974009,13.9946567 99.974009,13.878661 L99.974009,12.8506446 L99.974009,11.1920263 C99.9396808,9.02039623 99.4016076,7.07996031 97.3387274,6.21776579 L97.3387274,6.21776579 Z M96.8182174,11.5906368 C96.8182174,11.7397171 96.6972706,11.8226281 96.5755256,11.8226281 L92.0677651,11.8226281 L92.0677651,10.644734 C92.0677651,9.35164156 92.6569313,8.48944704 94.4084635,8.48944704 C94.599264,8.48944704 94.8068293,8.48944704 94.9980289,8.52293033 C96.2985057,8.70509533 96.8182174,9.5505482 96.8182174,10.644734 L96.8182174,11.5906368 Z"
                                                        id="Fill-17"></path>
                                                <path
                                                        d="M10.6807539,21.9044842 L10.7673725,21.9044842 C10.9230465,21.9044842 11.0443924,21.7825165 11.0443924,21.6257607 C11.0443924,21.5033739 10.9577738,21.3466181 10.8020998,21.3466181 L10.715082,21.3466181 L10.5242816,21.31183 C7.31659864,20.6839687 4.94157208,17.8070392 4.94157208,14.4414006 C4.94157208,13.0121568 5.37506432,11.6520699 6.12030375,10.5539413 C6.24204881,10.3967664 6.4324501,10.2747986 6.64081377,10.4667616 L11.7038116,15.6271281 C11.7377405,15.6619161 11.8247583,15.7143078 11.8942129,15.7143078 C11.9808315,15.7143078 12.050286,15.6795197 12.0850133,15.6271281 L17.1823392,10.5015496 C17.3731397,10.3095867 17.5467761,10.3447939 17.6509579,10.5363377 C18.3961974,11.6520699 18.8296896,12.9949723 18.8296896,14.4242161 C18.8296896,16.2197822 18.1535056,17.8418273 17.0434301,19.0799464 C17.009102,19.1147344 16.9572107,19.1671261 16.9224834,19.2019141 C16.9224834,19.2367022 16.8877561,19.2890938 16.8877561,19.3238818 C16.8877561,19.4810567 17.009102,19.6030245 17.1651752,19.6030245 L17.1999025,19.6030245 C17.2346297,19.6030245 17.2865211,19.5682364 17.3212484,19.5682364 C24.0830887,16.7084914 23.7713415,9.94368351 23.7713415,9.94368351 C23.7713415,6.09017397 21.9503548,2.62059033 19.1418359,0.441098316 C19.0204901,0.353918635 18.8296896,0.353918635 18.7426718,0.475886362 L12.1025765,7.24111341 C11.9808315,7.36308113 11.790031,7.36308113 11.6690843,7.24111341 L4.97590019,0.475886362 C4.8545543,0.353918635 4.69888029,0.353918635 4.57753439,0.441098316 C1.82050776,2.62059033 -7.98328266e-05,6.03778233 -7.98328266e-05,9.94368351 C-7.98328266e-05,16.1502062 4.66415301,21.2766229 10.6807539,21.9044842"
                                                        id="Fill-19"></path>
                                                <path
                                                        d="M29.9264125,5.80321087 C28.6953903,5.80321087 27.3949136,5.88612185 26.1638914,6.06828685 C26.0425455,6.10177013 25.9211996,6.21776579 25.9730909,6.33376145 L26.25051,8.37345139 C26.2852373,8.48944704 26.3722551,8.6054427 26.5275299,8.6054427 C27.6723326,8.48944704 28.4179712,8.45636237 29.5795388,8.45636237 C32.1800931,8.45636237 32.9780222,9.16907795 32.9780222,10.694959 L32.9780222,11.6073784 C32.9780222,11.7564587 32.8566763,11.8393697 32.7349313,11.8393697 L29.4577938,11.8393697 C26.5798204,11.8393697 24.8634147,13.2317162 24.8634147,15.768872 C24.8634147,18.1071213 26.7534568,19.781684 29.6146653,19.781684 C31.4001264,19.781684 32.1114369,19.516608 32.7006031,18.9860574 C32.8566763,18.8365785 33.1340954,18.9525741 33.1340954,19.1351377 L33.1340954,19.3177014 C33.1340954,19.4667817 33.2554413,19.5496927 33.3767872,19.5496927 L36.2547605,19.5496927 C36.4108337,19.5496927 36.4978515,19.433697 36.4978515,19.3177014 L36.4978515,10.794213 C36.5321796,7.42834589 34.0876985,5.80321087 29.9264125,5.80321087 L29.9264125,5.80321087 Z M33.0123503,14.5750336 C33.0123503,16.2830796 31.8332195,17.4107487 29.9264125,17.4107487 C28.4702617,17.4107487 27.7070599,16.8801981 27.7070599,15.7856137 C27.7070599,14.5750336 28.5045898,14.0775677 29.9264125,14.0775677 L32.7349313,14.0775677 C32.8914036,14.0775677 32.9780222,14.1935633 32.9780222,14.3099576 L32.9780222,14.5750336 L33.0123503,14.5750336 Z"
                                                        id="Fill-21"></path>
                                                <path
                                                        d="M70.879694,5.80321087 C69.649071,5.80321087 68.3485943,5.88612185 67.1175721,6.06828685 C66.9962262,6.10177013 66.8748803,6.21776579 66.9267717,6.33376145 L67.2041908,8.37345139 C67.238918,8.48944704 67.3255366,8.6054427 67.4812107,8.6054427 C68.6260134,8.48944704 69.371652,8.45636237 70.5332196,8.45636237 C73.1337739,8.45636237 73.931703,9.16907795 73.931703,10.694959 L73.931703,11.6073784 C73.931703,11.7564587 73.8099579,11.8393697 73.688612,11.8393697 L70.4118737,11.8393697 C67.5335012,11.8393697 65.8170954,13.2317162 65.8170954,15.768872 C65.8170954,18.1071213 67.7071376,19.781684 70.5679469,19.781684 C72.353408,19.781684 73.0647185,19.516608 73.6538847,18.9860574 C73.8099579,18.8365785 74.0877761,18.9525741 74.0877761,19.1351377 L74.0877761,19.3177014 C74.0877761,19.4667817 74.209122,19.5496927 74.3304679,19.5496927 L77.2084413,19.5496927 C77.3645145,19.5496927 77.4515323,19.433697 77.4515323,19.3177014 L77.4515323,10.794213 C77.5377517,7.42834589 75.0413792,5.80321087 70.879694,5.80321087 L70.879694,5.80321087 Z M73.9660311,14.5750336 C73.9660311,16.2830796 72.7869003,17.4107487 70.879694,17.4107487 C69.4235433,17.4107487 68.6603415,16.8801981 68.6603415,15.7856137 C68.6603415,14.5750336 69.4578714,14.0775677 70.879694,14.0775677 L73.688612,14.0775677 C73.8450844,14.0775677 73.931703,14.1935633 73.931703,14.3099576 L73.931703,14.5750336 L73.9660311,14.5750336 Z"
                                                        id="Fill-23"></path>
                                            </g>
                                        </g>
                                    </g>
                                </g>
                            </g>
                        </g>
                    </svg>
                </div>
                <p class="col-header imagine-title">Imagine a world without malware. We do. </p>

                <p>
                    <a href="//www.malwarebytes.com/for-home/" id="cta-footernavigation-company-linkto-for_home-en" class="for-home-link-en">FOR
                        PERSONAL</a>
                </p>
                <p>
                    <a href="//www.malwarebytes.com/business/" id="cta-footernavigation-company-linkto-for_business-en">FOR
                        BUSINESS</a>
                </p>

            </div>
            <!-- company -->
            <div class="col-md-2 col-xs-12 col-md-pull-3 footer-col company-col">
                <p class="col-header">COMPANY</p>
                <p>
                    <a href="//www.malwarebytes.com/company/" id="cta-footernavigation-company-linkto-about_us-en">ABOUT
                        US</a>
                </p>
                <p>
                    <a href="https://jobs.malwarebytes.com/"
                       id="cta-footernavigation-learn-linkto-careers-en">CAREERS</a>
                </p>
                <p>
                    <a href="https://press.malwarebytes.com/"
                       id="cta-footernavigation-learn-linkto-news_and_press-en">NEWS AND
                        PRESS</a>
                </p>
            </div>
            <!-- my account -->
            <div class="col-md-2 col-xs-12 col-md-pull-3 footer-col">
                <p class="col-header">MY ACCOUNT</p>
                <p>
                    <a href="https://my.malwarebytes.com/en/login"
                       id="cta-footernavigation-myaccount-linkto-sign_in-en">SIGN
                        IN</a>
                </p>
            </div>
            <!-- contact us -->
            <div class="col-md-3 col-xs-12 col-md-pull-3 footer-col">
                <p class="col-header">CONTACT US</p>
                <p>
                    <a href="https://support.malwarebytes.com/hc/en-us" class="pillar-page-lightbox"
                       id="cta-footernavigation-contactus-linkto-get_support-en">GET
                        SUPPORT</a>
                </p>
                <p>
                    <a href="https://www.malwarebytes.com/contact/" class="pillar-page-lightbox"
                       id="cta-footernavigation-contactus-linkto-contact_sales-en">CONTACT
                        SALES</a>
                </p>
                <div class="address">
                    <!-- icon here -->
                    <div class="hq">
                        <img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/footer/ic-pin-map.svg" alt="Map pin">
                        <div class="address-text">
                            3979 Freedom Circle, 12th Floor<br />Santa Clara, CA 95054
                        </div>
                    </div>
                    <div class="local hidden outside-na">
                        <img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/footer/ic-pin-map.svg" alt="Map pin">
                        <div class="address-text">
                            One Albert Quay, 2nd Floor<br />Cork T12 X8N6<br />Ireland
                        </div>
                    </div>
                </div>

            </div>

        </div>
        <div class="row soc-icon-row hidden-md hidden-lg">
            <div class="footer-soc-icon">
                <a id="cta-footer-social-twitter-en" class="social socicon-twitter"
                   href="https://twitter.com/malwarebytes" aria-label="Visit Malwarebytes on Twitter"></a>
            </div>
            <div class="footer-soc-icon">
                <a id="cta-footer-social-facebook-en" class="social socicon-facebook"
                   href="https://www.facebook.com/Malwarebytes/" aria-label="Visit Malwarebytes on Facebook"></a>
            </div>
            <div class="footer-soc-icon">
                <a id="cta-footer-social-linkedin-en" class="social socicon-linkedin"
                   href="https://www.linkedin.com/company/malwarebytes"
                   aria-label="Visit Malwarebytes on LinkedIn"></a>
            </div>
            <div class="footer-soc-icon">
                <a id="cta-footer-social-youtube-en" class="social socicon-youtube"
                   href="https://www.youtube.com/user/Malwarebytes" aria-label="Visit Malwarebytes on YouTube"></a>
            </div>
            <div class="footer-soc-icon">
                <a id="cta-footer-social-instagram-en" class="social socicon-instagram-v2"
                   href="https://www.instagram.com/malwarebytesofficial/"
                   aria-label="Visit Malwarebytes on Instagram"></a>
            </div>
        </div>

    </div>
    <div class="footer-bottom">
        <div class="container">
            <div class="row">
                <div class="col-xs-10 col-md-2">
                    <div class="lang-select-container">
                        <img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/footer/world.svg" alt="Globe icon">
                        &nbsp;&nbsp; <a href="#" class="language-select col-header"
                                        id="cta-footernavigation-linkto-languageselect-en">English</a>
                    </div>
                </div>
                <div class="col-xs-12 col-md-10 legal-list-col">
                    <div class="legal-list">
                        <div class="legal-link">
                            <a class="legal" href="//www.malwarebytes.com/legal/" id="cta-footernavigation-linkto-legal-en">Legal</a>
                        </div>
                        <div class="legal-link">
                            <a class="legal" href="//www.malwarebytes.com/privacy/" id="cta-footernavigation-linkto-privacy-en">Privacy</a>
                        </div>
                        <div class="legal-link">
                            <a class="legal" href="//www.malwarebytes.com/accessibility/"
                               id="cta-footernavigation-linkto-accessibility-en">Accessibility</a>
                        </div>

                        <div class="legal-link legal-last">
                            <a class="legal" href="//www.malwarebytes.com/tos/" id="cta-footernavigation-linkto-tos-en">Terms of Service</a>
                        </div>
                    </div>
                    <br class="hidden-md hidden-lg">
                    <p class="p-year">&copy;
                        <script>
                          $(document).ready(function () {
                            var d = new Date();
                            var year = d.getFullYear();
                            $(".currentYear").text(year);
                          });
                        </script><span class="currentYear"></span> All Rights Reserved</p>
                </div>
            </div>

        </div>
    </div>

</footer>

<!-- language select overlay -->
<section id="overlay-lang" class="text-center text-white" style="overflow-y: scroll;">
  <div class="container">
    <div class="row center-row">
      <div class="col-md-10">
     
        <p class="h2">Select your language</p>
      </div>
    </div>
    <div class="row center-row">
      <div class="col-md-5">
        <div class="text-center">
          <ul class="list-unstyled" id="intl-sites">
            </ul>
        </div>
      </div>
      
    </div>
  </div>
</section>
<!-- pillar page select overlay -->
<section id="pillar-pages" class="text-white overlay" style="overflow-y: scroll; display: none;">
  <div class="container">
    <div class="row">
      <div class="col-md-10">
        <p class="h2"><a href="https://www.malwarebytes.com/cybersecurity/" id="cta-labs-footernavigation-lightbox-learn-linkto-cybersecurity-en">Cybersecurity basics</a></p>
        <p>Your intro to everything relating to cyberthreats, and how to stop them.</p>
      </div>
    </div>
    <div class="row"> 
      <div class="col-md-8 pillar-pages-list">
              
              
              
            </div>
    </div>
  </div>
</section>
 <script>
  overlay('.language-select', '#overlay-lang');
  overlay('.pillar-page-lightbox', '#pillar-pages');
</script>

	<div style="display:none">
	<div class="grofile-hash-map-147cd7280d6ece931e4488a3a10809d9">
	</div>
	</div>
<link rel='stylesheet' id='jetpack-carousel-css'  href='https://blog.malwarebytes.com/wp-content/plugins/jetpack/modules/carousel/jetpack-carousel.css?ver=9.4' type='text/css' media='all' />
<script type='text/javascript' id='disqus_count-js-extra'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"malwarebytesunpacked"};
/* ]]> */
</script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-content/plugins/disqus-comment-system/public/js/comment_count.js?ver=3.0.21' id='disqus_count-js'></script>
<script type='text/javascript' id='disqus_embed-js-extra'>
/* <![CDATA[ */
var embedVars = {"disqusConfig":{"integration":"wordpress 3.0.21"},"disqusIdentifier":"40994 https:\/\/blog.malwarebytes.com\/?p=40994","disqusShortname":"malwarebytesunpacked","disqusTitle":"New version of IcedID Trojan uses steganographic payloads","disqusUrl":"https:\/\/blog.malwarebytes.com\/threat-analysis\/2019\/12\/new-version-of-icedid-trojan-uses-steganographic-payloads\/","postId":"40994"};
/* ]]> */
</script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-content/plugins/disqus-comment-system/public/js/comment_embed.js?ver=3.0.21' id='disqus_embed-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-includes/js/imagesloaded.min.js?ver=4.1.4' id='imagesloaded-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-includes/js/masonry.min.js?ver=4.2.2' id='masonry-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-includes/js/jquery/jquery.masonry.min.js?ver=3.1.2b' id='jquery-masonry-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/js/functions.js?ver=2013-07-18' id='mb_labs-script-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-includes/js/wp-embed.min.js?ver=5.6.2' id='wp-embed-js'></script>
<script type='text/javascript' id='jetpack-carousel-js-extra'>
/* <![CDATA[ */
var jetpackCarouselStrings = {"widths":[370,700,1000,1200,1400,2000],"is_logged_in":"","lang":"en","ajaxurl":"https:\/\/blog.malwarebytes.com\/wp-admin\/admin-ajax.php","nonce":"bc04e17e90","display_exif":"1","display_comments":"1","display_geo":"1","single_image_gallery":"1","single_image_gallery_media_file":"","background_color":"black","comment":"Comment","post_comment":"Post Comment","write_comment":"Write a Comment...","loading_comments":"Loading Comments...","download_original":"View full size <span class=\"photo-size\">{0}<span class=\"photo-size-times\">\u00d7<\/span>{1}<\/span>","no_comment_text":"Please be sure to submit some text with your comment.","no_comment_email":"Please provide an email address to comment.","no_comment_author":"Please provide your name to comment.","comment_post_error":"Sorry, but there was an error posting your comment. Please try again later.","comment_approved":"Your comment was approved.","comment_unapproved":"Your comment is in moderation.","camera":"Camera","aperture":"Aperture","shutter_speed":"Shutter Speed","focal_length":"Focal Length","copyright":"Copyright","comment_registration":"1","require_name_email":"0","login_url":"https:\/\/blog.malwarebytes.com\/wp-login.php?redirect_to=https%3A%2F%2Fblog.malwarebytes.com%2Fthreat-analysis%2F2019%2F12%2Fnew-version-of-icedid-trojan-uses-steganographic-payloads%2F","blog_id":"1","meta_data":["camera","aperture","shutter_speed","focal_length","copyright"],"local_comments_commenting_as":"<p id=\"jp-carousel-commenting-as\">You must be <a href=\"#\" class=\"jp-carousel-comment-login\">logged in<\/a> to post a comment.<\/p>"};
/* ]]> */
</script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-content/plugins/jetpack/_inc/build/carousel/jetpack-carousel.min.js?ver=9.4' id='jetpack-carousel-js'></script>
<script src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/js/standard-search-results-footer.js" type="text/javascript"></script>
<script type="text/javascript">
  var countryError, country;
  $.browser = {};
  (function() {
    $.browser.msie = false;
    $.browser.version = 0;
    if (navigator.userAgent.match(/MSIE ([0-9]+)\./)) {
      $.browser.msie = true;
      $.browser.version = RegExp.$1;
    }
  })();
  // Use Microsoft XDR for IE8/9
  if ($.browser.msie && window.XDomainRequest && $.browser.version < 10) {
    //console.log("browser is IE less than 10");

    var xdr = new XDomainRequest();
    xdr.open("GET", "https://genesis.malwarebytes.com/api/v1/wai.gif");
    xdr.onload = function() {
      //console.log("onload function");
      // use xdr.responseText for ie8/9, since unable to specify JSON accept request header
      var dom = new ActiveXObject("Microsoft.XMLDOM");
      var data = $.parseJSON(xdr.responseText);
      //console.log("IE data: " + data);
      dom.async = false;
      if (data == null || typeof(data) == "undefined") {
        // console.log("data is null or undefined");
        window.countryError = data["error"]["errorCode"];
      }
      window.country = data["location"]["countryCode"];
      //console.log("IE country in geo: " + country);
    };
    // function to call when an error occurs
    xdr.onerror = function() {
      //console.log("onerror XDR");
      window.countryError = data["error"]["errorCode"];
    };
    //console.log("before the send");
    xdr.send();
    //console.log("after the function");
  } else { // not IE 8/9, so use AJAX
    $.ajax({
      url: "https://genesis.malwarebytes.com/api/v1/wai.gif",
      type: "GET",
      crossDomain: true,
      dataType: "json",
      success: function(data) {
        //set country     
        //console.log("in success" + JSON.stringify(data));
        window.country = data["location"]["countryCode"];
      },
      error: function(data, jqXHR, textStatus, errorThrown) {
        //      console.log('geohtml genesis error POST1: ' + JSON.stringify(data)); 
        //      console.log("jqXHR: " + jqXHR);
        //      console.log("textStatus: " + textStatus);
        //      console.log("errorThrown: " + errorThrown);
        window.countryError = data["error"]["errorCode"];
      },
      async: false
    });
  }
</script>

<script type="text/plain" class="optanon-category-4">
  $("script[src='https://malwarebytesunpacked.disqus.com/embed.js']").each(function() {
    var scriptSrc = $(this).attr("src");
    var newScript = "<script type='text/javascript' async='' src='" + scriptSrc + "'>";
    $(this).before(newScript).remove();
  });
</script>

<!--replace with onetrust -->

<!---->

<script>
/*
  function enableCookies() {
    //fire inline scripts
    $('.ce-script').each(function() {
      var scripts = $(this).text();
      var scriptParent = $(this).parent();
      //console.log($(this).attr('data-ce-src'));
      if (!$(this).attr('data-ce-src')) {
        //console.log('no attribute')
          //fire marketo forms
        if (scripts.indexOf("MktoForms2") > -1) {
          
          //set interval for mkto
          var mktoInt = setInterval(function() {
            if(typeof(MktoForms2) !== "undefined") {
              clearInterval(mktoInt);
              $(scriptParent).append('<script>' + scripts + '<\/script>');
              $(scriptParent).append("<script>(function(d,b,a,s,e){ var t = b.createElement(a),fs = b.getElementsByTagName(a)[0]; t.async=1; t.id=e; t.src=('https:'==document.location.protocol ? 'https://' : 'http://') + s; fs.parentNode.insertBefore(t, fs); })(window,document,'script','scripts.demandbase.com/HWyTnY16.min.js','demandbase_js_lib');<\/script>");
              
            }
          }, 10);
        } else {

          $(scriptParent).append('<script>' + scripts + '<\/script>');
        }
      } else {
        var attr = $(this).attr('data-ce-src');
        $(this).attr('src', attr);
        //console.log('attribute is: ' + attr);
        $(scriptParent).append('<script src="' + attr + '"><\/script>');
      }
      //console.log(scripts);
    });
    
    //iframes
    
    $('.ce-iframe').each(function() {
      var iframesrc = $(this).attr('data-ce-src');
      $(this).attr('src', iframesrc);
    });
    
    
  }

  var gdprCountries = [
    "BE",
    "BG",
    "CZ",
    "DK",
    "DE",
    "EE",
    "IE",
    "EL",
    "ES",
    "FR",
    "HR",
    "IT",
    "CY",
    "LV",
    "LT",
    "LU",
    "HU",
    "MT",
    "NL",
    "AT",
    "PL",
    "PT",
    "RO",
    "SI",
    "SK",
    "FI",
    "SE",
    "UK",
    "GB"
  ];
  //read user preference cookie
  var cookiePreference = $.cookie('ce-cookie');
  

  
  
  //cookie config
  if (gdprCountries.indexOf(country) > -1) {
    if (cookiePreference === "N" && cookiePreference !== "Y") {
      $(window).load(function() {
        $('a[href*="https://my.malwarebytes"]').attr('href','https://www.malwarebytes.com/myaccount-consent');
        //$('form[id*="mktoForm"]').append('<p>To view this content you need to enable cookies. <br>' + '<a style="text-decoration: underline;" href="#" class="ce-accept">Enable All Cookies</a>' + '</p>');
      });

    } else {
      enableCookies();
    }

    //variable for cookies to fire or not
    //var cookies = "no";

    //if (cookies === "yes") {
    //  enableCookies();
    //}
    
    //remove for onetrust
    COOKIES_ENABLER.init({
      scriptClass: 'ce-script',
      iframeClass: 'ce-iframe',
      acceptClass: 'ce-accept',
      dismissClass: 'ce-dismiss',
      disableClass: 'ce-disable',
      bannerClass: 'ce-banner',
      bannerHTML: '<p>By continuing to browse our website or by clicking "Accept All Cookies," you agree to the storing of first- and third-party cookies on your device to enhance site navigation, analyze site usage, and assist in our marketing efforts. <a href="https://www.malwarebytes.com/privacy/" style="margin-left:0;" id="cta-labs-cookiegdpr-linkto-privacypolicy-en">Privacy and Cookie Policy</a><br>' + '<a href="#" class="ce-accept bluecta-sm" style="width: auto; padding-left:10px; padding-right:10px;" id="cta-labs-cookiegdpr-acceptallcookies-en">' + 'Accept All Cookies' + '</a>' + '<a href="#" class="ce-disable ce-disable" id="cta-labs-cookiegdpr-disableallcookies-en">Disable Cookies</a>' + '</p>',
      eventScroll: false,
      scrollOffset: 200,
      clickOutside: false,
      cookieName: 'ce-cookie',
      cookieDuration: '365',
      wildcardDomain: true,
      iframesPlaceholder: true,
      iframesPlaceholderHTML: '<p>To view this content you need to enable cookies. <br>' + '<a style="text-decoration: underline;" href="#" class="ce-accept"  id="cta-labs-cookiegdpr-enablecookies-viaiframe-en">Enable All Cookies</a>' + '</p>',
      iframesPlaceholderClass: 'ce-iframe-placeholder',
      // Callbacks
      onEnable: function() {
        //enableCookies();
      },
      onDismiss: function() {
        //console.log('the banner has been dismissed');
      },
      onDisable: function() {
        $('a[href*="https://my.malwarebytes"]').attr('href','https://www.malwarebytes.com/myaccount-consent');
        $('form[id*="mktoForm"]').append('<p id="consent-message">To view this content you need to enable cookies. <br>' + '<a style="text-decoration: underline;" href="#" class="ce-accept">Enable All Cookies</a>' + '</p>');
        $('#consent-message .ce-accept').click(function() {
          setTimeout(function() {
            window.location.reload()
          }, 250);
          $('#consent-message').remove();
        });
      }
    });
  } else {
    enableCookies();
  }
  */
</script>
<style>
  .ce-banner {
    display: block;
    position: fixed;
    width: 100vw;
    background: #fff;
    bottom: 0;
    left: 0;
    z-index: 99999;
    box-sizing: border-box;
    padding: 20px;
    text-align: center;
    box-shadow: 0px 0px 20px #424242;
  }
  
  .ce-banner a {
    margin: 0 10px;
  }
</style>
<script>
$(document).ready(function() {
  $.getJSON("https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/pillarpages.json", function(allpillarpages){
    number_of_pillar_pages_to_show = 5;
    var pillar_card_slug;

    function pillar_card() {
      if (typeof allpillarpages[i].uri === "undefined") { 
        var pillar_card_slug = allpillarpages[i].pillarpage.replace(" ", "-").toLowerCase();
      }
      else {
        var pillar_card_slug = allpillarpages[i].uri;
      }
      var pillar_card_html = '<div class="col-md-3"><p><a href="https://www.malwarebytes.com/' + pillar_card_slug + '/" id="cta-labs-footernavigation-lightbox-learn-linkto-' + pillar_card_slug + '-en">' + allpillarpages[i].pillarpage +'</a></p></div>';
      
      var pillar_card_list_html = '<p><a href="https://www.malwarebytes.com/' + pillar_card_slug + '/" id="cta-labs-footernavigation-learn-linkto-' + pillar_card_slug + '-en">' + allpillarpages[i].pillarpage +'</a></p>'
      
      $("section#pillar-pages .pillar-pages-list").append(pillar_card_html);
      
      if ([i] < number_of_pillar_pages_to_show) {
        $("footer .pillar-pages-list").append(pillar_card_list_html);
      }
    };
    for (i=0;i<allpillarpages.length;i++) {
      pillar_card();
    } 
  });
});
</script>
<script>
$(document).ready(function() {
  $.getJSON("https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/intl-sites.json", function(intlSites){

    function listIntlSites() {
      let indCountry = '<li><a href="' + intlSites[i].url + '/" class="' + intlSites[i].country + '-site" id="cta-labs-footer-linkto-' + intlSites[i].country + '_site-en">' + intlSites[i].lang + '</a></li>'
      $("#intl-sites").append(indCountry);
    };
    for (i=0;i<intlSites.length;i++) {
            listIntlSites();
          }  
  });
});
</script>
</body>
</html>