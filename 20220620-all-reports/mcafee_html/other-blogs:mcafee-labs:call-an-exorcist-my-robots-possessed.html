<!DOCTYPE html>
<html lang="en-US">

    <head>

        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <link rel="profile" href="https://gmpg.org/xfn/11">
        <link rel="pingback" href="https://www.mcafee.com/xmlrpc.php">
                    <link rel="canonical" href="https://www.mcafee.com/blogs/other-blogs/mcafee-labs/call-an-exorcist-my-robots-possessed/">
                            <link rel="shortcut icon" href="https://www.mcafee.com/enterprise/en-us/img/favicon.ico">
        <!--<link rel="stylesheet" href="/wp-content/themes/securingtomorrow/css/responsive/blog.css" type="text/css">
        <link rel="stylesheet" href="/wp-content/themes/securingtomorrow/css/responsive/main.css" type="text/css">-->
        <link rel="stylesheet" href="/enterprise/www/css/main.min.css" type="text/css">
       
        	<script type="text/javascript">function theChampLoadEvent(e){var t=window.onload;if(typeof window.onload!="function"){window.onload=e}else{window.onload=function(){t();e()}}}</script>
		<script type="text/javascript">var theChampDefaultLang = 'en_US', theChampCloseIconPath = 'https://www.mcafee.com/wp-content/plugins/super-socializer/images/close.png';</script>
		<script> var theChampSiteUrl = 'https://www.mcafee.com/blogs', theChampVerified = 0, theChampEmailPopup = 0; </script>
		<style type="text/css">.the_champ_horizontal_sharing .theChampSharing{
					color: #fff;
				border-width: 0px;
		border-style: solid;
		border-color: transparent;
	}
		.the_champ_horizontal_sharing .theChampTCBackground{
		color:#666;
	}
		.the_champ_horizontal_sharing .theChampSharing:hover{
				border-color: transparent;
	}
	.the_champ_vertical_sharing .theChampSharing{
					color: #fff;
				border-width: 0px;
		border-style: solid;
		border-color: transparent;
	}
		.the_champ_vertical_sharing .theChampTCBackground{
		color:#666;
	}
		.the_champ_vertical_sharing .theChampSharing:hover{
				border-color: transparent;
	}
	@media screen and (max-width:783px){.the_champ_vertical_sharing{display:none!important}}div.heateor_ss_mobile_footer{display:none;}@media screen and (max-width:783px){i.theChampTCBackground{background-color:white!important}div.the_champ_bottom_sharing{width:100%!important;left:0!important;}div.the_champ_bottom_sharing li{width:12.5% !important;}div.the_champ_bottom_sharing .theChampSharing{width: 100% !important;}div.the_champ_bottom_sharing div.theChampTotalShareCount{font-size:1em!important;line-height:28px!important}div.the_champ_bottom_sharing div.theChampTotalShareText{font-size:.7em!important;line-height:0px!important}div.heateor_ss_mobile_footer{display:block;height:40px;}.the_champ_bottom_sharing{padding:0!important;display:block!important;width: auto!important;bottom:-2px!important;top: auto!important;}.the_champ_bottom_sharing .the_champ_square_count{line-height: inherit;}.the_champ_bottom_sharing .theChampSharingArrow{display:none;}.the_champ_bottom_sharing .theChampTCBackground{margin-right: 1.1em !important}}</style>
	
	<!-- This site is optimized with the Yoast SEO plugin v14.2 - https://yoast.com/wordpress/plugins/seo/ -->
	<title>Call an Exorcist! My Robot’s Possessed! | McAfee Blogs</title>
	<meta name="description" content="Overview As part of our continued goal of helping developers provide safer products for businesses and consumers, we here at McAfee Advanced Threat" />
	<meta name="robots" content="index, follow" />
	<meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
	<meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
	<meta property="og:locale" content="en_US" />
	<meta property="og:type" content="article" />
	<meta property="og:title" content="Call an Exorcist! My Robot’s Possessed! | McAfee Blogs" />
	<meta property="og:description" content="Overview As part of our continued goal of helping developers provide safer products for businesses and consumers, we here at McAfee Advanced Threat" />
	<meta property="og:url" content="/blogs/other-blogs/mcafee-labs/call-an-exorcist-my-robots-possessed/" />
	<meta property="og:site_name" content="McAfee Blogs" />
	<meta property="article:publisher" content="https://www.facebook.com/mcafee" />
	<meta property="article:published_time" content="2020-08-06T04:01:06+00:00" />
	<meta property="article:modified_time" content="2020-08-31T17:13:41+00:00" />
	<meta property="og:image" content="https://www.mcafee.com/wp-content/uploads/2020/02/iStock-954683756-min-2.jpg" />
	<meta property="og:image:width" content="1920" />
	<meta property="og:image:height" content="1280" />
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:creator" content="@ROPsicle" />
	<meta name="twitter:site" content="@mcafee" />
	<script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://www.mcafee.com/blogs/#website","url":"https://www.mcafee.com/blogs/","name":"McAfee Blogs","description":"Securing Tomorrow. Today.","potentialAction":[{"@type":"SearchAction","target":"https://www.mcafee.com/blogs/?s={search_term_string}","query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"ImageObject","@id":"https://www.mcafee.com/blogs/other-blogs/mcafee-labs/call-an-exorcist-my-robots-possessed/#primaryimage","inLanguage":"en-US","url":"/wp-content/uploads/2020/02/iStock-954683756-min-2.jpg","width":1920,"height":1280},{"@type":"WebPage","@id":"https://www.mcafee.com/blogs/other-blogs/mcafee-labs/call-an-exorcist-my-robots-possessed/#webpage","url":"https://www.mcafee.com/blogs/other-blogs/mcafee-labs/call-an-exorcist-my-robots-possessed/","name":"Call an Exorcist! My Robot\u2019s Possessed! | McAfee Blogs","isPartOf":{"@id":"https://www.mcafee.com/blogs/#website"},"primaryImageOfPage":{"@id":"https://www.mcafee.com/blogs/other-blogs/mcafee-labs/call-an-exorcist-my-robots-possessed/#primaryimage"},"datePublished":"2020-08-06T04:01:06+00:00","dateModified":"2020-08-31T17:13:41+00:00","author":{"@id":"https://www.mcafee.com/blogs/#/schema/person/0960bc8b469c17a5b3c781599ae13693"},"description":"Overview As part of our continued goal of helping developers provide safer products for businesses and consumers, we here at McAfee Advanced Threat","breadcrumb":{"@id":"https://www.mcafee.com/blogs/other-blogs/mcafee-labs/call-an-exorcist-my-robots-possessed/#breadcrumb"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://www.mcafee.com/blogs/other-blogs/mcafee-labs/call-an-exorcist-my-robots-possessed/"]}]},{"@type":"BreadcrumbList","@id":"https://www.mcafee.com/blogs/other-blogs/mcafee-labs/call-an-exorcist-my-robots-possessed/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"/blogs/","url":"/blogs/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"/blogs/other-blogs/","url":"/blogs/other-blogs/","name":"Other Blogs"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"/blogs/other-blogs/mcafee-labs/","url":"/blogs/other-blogs/mcafee-labs/","name":"McAfee Labs"}},{"@type":"ListItem","position":4,"item":{"@type":"WebPage","@id":"/blogs/other-blogs/mcafee-labs/call-an-exorcist-my-robots-possessed/","url":"/blogs/other-blogs/mcafee-labs/call-an-exorcist-my-robots-possessed/","name":"Call an Exorcist! My Robot\u2019s Possessed!"}}]},{"@type":["Person"],"@id":"https://www.mcafee.com/blogs/#/schema/person/0960bc8b469c17a5b3c781599ae13693","name":"Mark Bereza","description":"Mark Bereza is a Security Researcher and recent addition to McAfee's Advanced Threat Research team. An alumnus of Oregon State University's CS systems program, Mark's work has focused on vulnerability discovery and exploit development for embedded systems.","sameAs":["https://www.linkedin.com/in/mark-bereza/","https://twitter.com/@ROPsicle"]}]}</script>
	<!-- / Yoast SEO plugin. -->


<link rel='dns-prefetch' href='//stackpath.bootstrapcdn.com' />
<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="McAfee Blogs &raquo; Feed" href="https://www.mcafee.com/blogs/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.4.2"}};
			/*! This file is auto-generated */
			!function(e,a,t){var r,n,o,i,p=a.createElement("canvas"),s=p.getContext&&p.getContext("2d");function c(e,t){var a=String.fromCharCode;s.clearRect(0,0,p.width,p.height),s.fillText(a.apply(this,e),0,0);var r=p.toDataURL();return s.clearRect(0,0,p.width,p.height),s.fillText(a.apply(this,t),0,0),r===p.toDataURL()}function l(e){if(!s||!s.fillText)return!1;switch(s.textBaseline="top",s.font="600 32px Arial",e){case"flag":return!c([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])&&(!c([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!c([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]));case"emoji":return!c([55357,56424,55356,57342,8205,55358,56605,8205,55357,56424,55356,57340],[55357,56424,55356,57342,8203,55358,56605,8203,55357,56424,55356,57340])}return!1}function d(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(i=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},o=0;o<i.length;o++)t.supports[i[o]]=l(i[o]),t.supports.everything=t.supports.everything&&t.supports[i[o]],"flag"!==i[o]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[i[o]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(r=t.source||{}).concatemoji?d(r.concatemoji):r.wpemoji&&r.twemoji&&(d(r.twemoji),d(r.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css'  href='/wp-includes/css/dist/block-library/style.min.css?ver=5.4.2' type='text/css' media='all' />
<link rel='stylesheet' id='opinionStage_poll_oswp_style_css_set-css'  href='/wp-content/plugins/social-polls-by-opinionstage/gutenberg/poll/dist/blocks.style.build.css?ver=5.4.2' type='text/css' media='all' />
<link rel='stylesheet' id='opinionStage_trivia_oswp_style_css_set-css'  href='/wp-content/plugins/social-polls-by-opinionstage/gutenberg/trivia/dist/blocks.style.build.css?ver=5.4.2' type='text/css' media='all' />
<link rel='stylesheet' id='opinionStage_personality_oswp_style_css_set-css'  href='/wp-content/plugins/social-polls-by-opinionstage/gutenberg/personality/dist/blocks.style.build.css?ver=5.4.2' type='text/css' media='all' />
<link rel='stylesheet' id='opinionStage_survey_oswp_style_css_set-css'  href='/wp-content/plugins/social-polls-by-opinionstage/gutenberg/survey/dist/blocks.style.build.css?ver=5.4.2' type='text/css' media='all' />
<link rel='stylesheet' id='opinionStage_slideshow_oswp_style_css_set-css'  href='/wp-content/plugins/social-polls-by-opinionstage/gutenberg/slideshow/dist/blocks.style.build.css?ver=5.4.2' type='text/css' media='all' />
<link rel='stylesheet' id='opinionStage_form_oswp_style_css_set-css'  href='/wp-content/plugins/social-polls-by-opinionstage/gutenberg/form/dist/blocks.style.build.css?ver=5.4.2' type='text/css' media='all' />
<link rel='stylesheet' id='mpp_gutenberg-css'  href='/wp-content/plugins/metronet-profile-picture/dist/blocks.style.build.css?ver=2.3.8' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='/wp-includes/css/dashicons.min.css?ver=5.4.2' type='text/css' media='all' />
<link rel='stylesheet' id='wpmm_css-css'  href='/wp-content/plugins/wp-megamenu/assets/css/wpmm.css?ver=1.3.1' type='text/css' media='all' />
<link rel='stylesheet' id='wp_megamenu_generated_css-css'  href='/wp-content/uploads/wp-megamenu/wp-megamenu.css?ver=1.3.1' type='text/css' media='all' />
<link rel='stylesheet' id='featuresbox_css-css'  href='/wp-content/plugins/wp-megamenu/addons/wpmm-featuresbox/wpmm-featuresbox.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='postgrid_css-css'  href='/wp-content/plugins/wp-megamenu/addons/wpmm-gridpost/wpmm-gridpost.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wp-bootstrap-pro-fontawesome-cdn-css'  href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=5.4.2' type='text/css' media='all' />
<link rel='stylesheet' id='open-sans-google-font-css'  href='https://fonts.googleapis.com/css?family=Open+Sans%3A300%2C400&#038;ver=5.4.2' type='text/css' media='all' />
<link rel='stylesheet' id='theme-css-css'  href='/wp-content/themes/securingtomorrow/style.css?ver=5.4.2' type='text/css' media='all' />
<link rel='stylesheet' id='the_champ_frontend_css-css'  href='/wp-content/plugins/super-socializer/css/front.css?ver=7.12.37' type='text/css' media='all' />
<link rel='stylesheet' id='addtoany-css'  href='/wp-content/plugins/add-to-any/addtoany.min.css?ver=1.15' type='text/css' media='all' />
<link rel='stylesheet' id='poppins-css'  href='//fonts.googleapis.com/css?family=Poppins%3A100%2C100italic%2C200%2C200italic%2C300%2C300italic%2Cregular%2Citalic%2C500%2C500italic%2C600%2C600italic%2C700%2C700italic%2C800%2C800italic%2C900%2C900italic&#038;ver=1.3.1' type='text/css' media='all' />
<link rel='stylesheet' id='oswald-css'  href='//fonts.googleapis.com/css?family=Oswald%3A200%2C300%2Cregular%2C500%2C600%2C700&#038;ver=1.3.1' type='text/css' media='all' />
<script type='text/javascript' src='/wp-content/plugins/jquery-updater/js/jquery-3.4.1.min.js?ver=3.4.1'></script>
<script type='text/javascript' src='/wp-content/plugins/add-to-any/addtoany.min.js?ver=1.1'></script>
<script type='text/javascript' src='/wp-content/plugins/wp-megamenu/addons/wpmm-featuresbox/wpmm-featuresbox.js?ver=1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var postgrid_ajax_load = {"ajax_url":"https:\/\/www.mcafee.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='/wp-content/plugins/wp-megamenu/addons/wpmm-gridpost/wpmm-gridpost.js?ver=1'></script>
<!--[if lt IE 9]>
<script type='text/javascript' src='/wp-content/themes/securingtomorrow/js/html5.js?ver=3.7.0'></script>
<![endif]-->
<link rel='https://api.w.org/' href='https://www.mcafee.com/blogs/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://www.mcafee.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://www.mcafee.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.4.2" />
<link rel='shortlink' href='https://www.mcafee.com/blogs/?p=103530' />
<link rel="alternate" type="application/json+oembed" href="https://www.mcafee.com/blogs/wp-json/oembed/1.0/embed?url=%2Fblogs%2Fother-blogs%2Fmcafee-labs%2Fcall-an-exorcist-my-robots-possessed%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://www.mcafee.com/blogs/wp-json/oembed/1.0/embed?url=%2Fblogs%2Fother-blogs%2Fmcafee-labs%2Fcall-an-exorcist-my-robots-possessed%2F&#038;format=xml" />

<script data-cfasync="false">
window.a2a_config=window.a2a_config||{};a2a_config.callbacks=[];a2a_config.overlays=[];a2a_config.templates={};
(function(d,s,a,b){a=d.createElement(s);b=d.getElementsByTagName(s)[0];a.async=1;a.src="https://static.addtoany.com/menu/page.js";b.parentNode.insertBefore(a,b);})(document,"script");
</script>
<script>
var utag_data = {
tm_global_pagename:"",
tm_global_page_publish_date:"",
tm_global_businessunit:"consumer",
tm_global_sitesection:"",
tm_global_sitesection_level2:"",
tm_global_sitesection_level3:"",
tm_global_platform:"web",
tm_global_culture_code:"en-us",
tm_global_country:"united states",
tm_global_geo:"na",
tm_global_channel:"direct",
tm_global_affiliate_id:"",
tm_global_affiliate_name:"",
tm_global_campaign_id:"",
tm_global_page_version:"",
tm_global_pageurl:location.href,
tm_global_clientid :"",
tm_global_trafficsource:"",
tm_global_sourcetype:"blog",
tm_global_wssversion:"",
tm_global_coe:"",
tm_global_coe_level2:"",
tm_local_blogs_author:""
}
var sec=location.pathname.replace("/blogs","").split("/"); utag_data.tm_global_pagename="[consumer:web]";
if(sec.length > 2) {
for(i=1;i<sec.length-1;i++) {
utag_data.tm_global_pagename+="|"+sec[i];
if(i==1){utag_data.tm_global_sitesection=sec[i]}
if(i==2){utag_data.tm_global_sitesection_level2=sec[i]}
if(i==3){utag_data.tm_global_sitesection_level3=sec[i]}
}
}
else {
utag_data.tm_global_sitesection="Homepage"
utag_data.tm_global_pagename+="|Homepage"
}

var today = new Date(); var dd = today.getDate(); var mm = today.getMonth() + 1; var yyyy = today.getFullYear();
if (dd < 10) { dd = '0' + dd;    } 
if (mm < 10) {mm = '0' + mm;  } 
utag_data.tm_global_page_publish_date = dd + '/' + mm + '/' + yyyy;

</script>

<script>
	var ISOTOPE_CACHE 				=  [];
	var ISOTOPE_AJAX_URL 			= 'https://www.mcafee.com/wp-admin/admin-ajax.php';
	var ISOTOPE_AJAX_URL_ENDPOINT 	= 'https://www.mcafee.com/wp-content/plugins/ae-isotope/endpoint.php';
	var ISOTOPE_AJAX_ITEMS			= 25;
	var ISOTOPE_CURRENT_CATEGORY	= '';
</script>		<meta property="fb:app_id" content="346056175795920" />
					<meta property="fb:admins" content="100007220654854" />
			<style type="text/css">.wp-megamenu-wrap .wpmm-nav-wrap > ul.wp-megamenu li.wpmm_dropdown_menu ul.wp-megamenu-sub-menu li.menu-item-has-children.wp-megamenu-item-101284.wpmm-submenu-right > ul.wp-megamenu-sub-menu {left: 100%;}</style><style type="text/css"></style><link rel="icon" href="/wp-content/uploads/2018/11/cropped-favicon-32x32.png" sizes="32x32" />
<link rel="icon" href="/wp-content/uploads/2018/11/cropped-favicon-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="/wp-content/uploads/2018/11/cropped-favicon-180x180.png" />
<meta name="msapplication-TileImage" content="/wp-content/uploads/2018/11/cropped-favicon-270x270.png" />
         <link rel="stylesheet" href="/enterprise/www/css/blog.css" type="text/css">
                <script type="text/javascript">
            var digitalData = {"page":{"pageInfo":{"pageName":"other-blogs:mcafee-labs:call-an-exorcist-my-robots-possessed","pageNameGlobal":"call-an-exorcist-my-robots-possessed","pageLanguage":"English","pageType":"","country":"us","geo":"NA","onsiteSearchTerm":"","onsiteSearchType":"","category":{"category":"other-blogs","subCategory1":"mcafee-labs"},"author":"Mark Bereza","pubDate":"Aug 05, 2020","metaData":{"keywords":""}}},"user":{"userInfo":{"ip":"161.69.31.4"}}}        </script>
                <script type='application/ld+json'>{
            "@context": "http://schema.org",
            "@type": "Article",
            "mainEntityOfPage": {
                "@type": "WebPage",
                "@id": "https://www.mcafee.com/blogs/other-blogs/mcafee-labs/call-an-exorcist-my-robots-possessed/"
            },
           "headline": "Call an Exorcist! My Robot’s Possessed!",
            "image": ["https://www.mcafee.com/wp-content/uploads/2020/02/iStock-954683756-min-2.jpg"],	
            "datePublished": "2020-08-05",
            "dateModified": "Aug 31, 2020",
            "author": {
                "@type": "Person",           
                "name": ["Mark Bereza"]            
            },
            "publisher": {
                "@type": "Organization",
                "name": "McAfee",
                "logo": {
                    "@type": "ImageObject",
                    "url": "https://www.mcafee.com/enterprise/en-us/img/logos/mcafee-logo.png"
                }
            },
            "description": "OverviewAs part of our continued goal of helping developers provide safer products for businesses and consumers, we here at McAfee Advanced Threat Research (ATR) recently investigated temi, a teleconference robot produced by Robotemi Global Ltd. Our research led us to discover four separate vulnerabilities in the temi"        
            }
        </script>
        <style>
            #wp-megamenu-blog>.wpmm-nav-wrap ul.wp-megamenu>li>a{
                color:#ffffff !important;
            }
        </style> 
    
    <script>!function(){function o(n,i){if(n&&i)for(var r in i)i.hasOwnProperty(r)&&(void 0===n[r]?n[r]=i[r]:n[r].constructor===Object&&i[r].constructor===Object?o(n[r],i[r]):n[r]=i[r])}try{var n=decodeURIComponent("%7B%20%22BW%22%3A%20%7B%20%22test_https%22%3A%20true%20%7D%20%7D");if(n.length>0&&window.JSON&&"function"==typeof window.JSON.parse){var i=JSON.parse(n);void 0!==window.BOOMR_config?o(window.BOOMR_config,i):window.BOOMR_config=i}}catch(r){window.console&&"function"==typeof window.console.error&&console.error("mPulse: Could not parse configuration",r)}}();</script>
                          <script>!function(a){var e="https://s.go-mpulse.net/boomerang/",t="addEventListener";if("False"=="True")a.BOOMR_config=a.BOOMR_config||{},a.BOOMR_config.PageParams=a.BOOMR_config.PageParams||{},a.BOOMR_config.PageParams.pci=!0,e="https://s2.go-mpulse.net/boomerang/";if(window.BOOMR_API_key="LXNDQ-3SP7Y-P3JVN-Y4HAH-VQNKC",function(){function n(e){a.BOOMR_onload=e&&e.timeStamp||(new Date).getTime()}if(!a.BOOMR||!a.BOOMR.version&&!a.BOOMR.snippetExecuted){a.BOOMR=a.BOOMR||{},a.BOOMR.snippetExecuted=!0;var i,_,o,r=document.createElement("iframe");if(a[t])a[t]("load",n,!1);else if(a.attachEvent)a.attachEvent("onload",n);r.src="javascript:void(0)",r.title="",r.role="presentation",(r.frameElement||r).style.cssText="width:0;height:0;border:0;display:none;",o=document.getElementsByTagName("script")[0],o.parentNode.insertBefore(r,o);try{_=r.contentWindow.document}catch(O){i=document.domain,r.src="javascript:var d=document.open();d.domain='"+i+"';void(0);",_=r.contentWindow.document}_.open()._l=function(){var a=this.createElement("script");if(i)this.domain=i;a.id="boomr-if-as",a.src=e+"LXNDQ-3SP7Y-P3JVN-Y4HAH-VQNKC",BOOMR_lstart=(new Date).getTime(),this.body.appendChild(a)},_.write("<bo"+'dy onload="document._l();">'),_.close()}}(),"".length>0)if(a&&"performance"in a&&a.performance&&"function"==typeof a.performance.setResourceTimingBufferSize)a.performance.setResourceTimingBufferSize();!function(){if(BOOMR=a.BOOMR||{},BOOMR.plugins=BOOMR.plugins||{},!BOOMR.plugins.AK){var e=""=="true"?1:0,t="",n="fb23dtlikiwjgycyd43q-f-dd2683e39-clientnsv4-s.akamaihd.net",i={"ak.v":"30","ak.cp":"108209","ak.ai":parseInt("250743",10),"ak.ol":"0","ak.cr":5,"ak.ipv":4,"ak.proto":"http/1.1","ak.rid":"1c3e31fc","ak.r":37116,"ak.a2":e,"ak.m":"b","ak.n":"essl","ak.bpcip":"40.117.177.0","ak.cport":42208,"ak.gh":"23.200.158.136","ak.quicv":"","ak.tlsv":"tls1.3","ak.0rtt":"","ak.csrc":"-","ak.acc":"reno","ak.t":"1616387895","ak.ak":"hOBiQwZUYzCg5VSAfCLimQ==EsWhX2HslkwVaKMdWnXGIh7Y8Dd0eNywUkS6P/kpmAHVJqXL3aqvRtn4V5XKsc+wN+o72mmpTk3N0b4fohMaZqrbDuB7g9ftnMt8pJsrLYbopdn6O3pmy1NLbKndVjpgvIhayBI3V9uo+Ov6TAEMTAM4DG/P/d4zCYbusQFfyk4n2UKu3/JbIdRBbfA2PiJAG90HIYn9ipCOYjHOtEqpJ3ElUrwZfq0rXw4EUkCIuIJ7yjz5g7vHVZBrbeStu+KF8m0Yp0+b8UqdYWha69OyuzaOPmeDg1G1Y7ZvGJDBEkK1rxNy6ft/FITr1hgxevD8DBiYsr5IhFNu4s9unbd0HVRz5rassCNP4Vyh7meZRdfRfMBJPaglZmccRsDQkEFWdBWcJ4O1+fq0pdhdkv8PkkSjRXGixAJvmTb4HhmK5vo=","ak.pv":"141","ak.dpoabenc":""};if(""!==t)i["ak.ruds"]=t;var _={i:!1,av:function(e){var t="http.initiator";if(e&&(!e[t]||"spa_hard"===e[t]))i["ak.feo"]=void 0!==a.aFeoApplied?1:0,BOOMR.addVar(i)},rv:function(){var a=["ak.bpcip","ak.cport","ak.cr","ak.csrc","ak.gh","ak.ipv","ak.m","ak.n","ak.ol","ak.proto","ak.quicv","ak.tlsv","ak.0rtt","ak.r","ak.acc","ak.t"];BOOMR.removeVar(a)}};BOOMR.plugins.AK={akVars:i,akDNSPreFetchDomain:n,init:function(){if(!_.i){var a=BOOMR.subscribe;a("before_beacon",_.av,null,null),a("onbeacon",_.rv,null,null),_.i=!0}return this},is_complete:function(){return!0}}}}()}(window);</script></head>

    <body  class="post-template-default single single-post postid-103530 single-format-standard wp-megamenu" id="short-header">
        <script src="/wp-content/themes/securingtomorrow/js/header_enterprise.js"></script>
        <div id="wrapper">
            <div class="textwidget custom-html-widget"><style>
	.headerbarContainer {
    background: rgba(0,0,0,0.9);
}
</style>
<header id="header">  
	<div class="headerbarContainer">
		<div class="headerbarContent">
			<div class="logo">
				 <img src="https://www.mcafee.com/enterprise/en-us/img/icons/logo-white.svg" alt="McAfee Logo"/>
			</div>
			<div class="quicklinks">
			 	<a class="symbols-label" href="https://www.mcafee.com/consumer/en-us/store/m0/index.html"><span>For Home</span></a>
			 	<a class="symbols-label" href="/enterprise/en-us/home.html"><span>For Enterprise</span></a>
			 	<a class="symbols-label" href="/enterprise/en-us/global-contact-us.html"><i class="symbol-contact"></i></a>
			</div>
		</div>
	</div>
</header>



<style>


@media screen and (min-width: 1025px) {
.hero{height: 756px !important;}
.hero.medium {
    min-height: 0;
    height: 640px  !important;
}
.hero.small {
    min-height: 0;
    height: 510px  !important;
}
.hero.title {
    height: 350px  !important;
}
	}
</style> 
<script>
$("document").ready(function(){
    $(".hero.title h1").each(function() {
        if ($(this).text().length > 50) {
            $(this).addClass("pt")
        }
    });
});
</script></div>  
		
<section class="hero title">
    <div class="bg-stretch">
        <img src="https://www.mcafee.com/wp-content/themes/securingtomorrow/img/light-shield-pattern.png" alt="">
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-12 col-xs-12">
                <h1>Call an Exorcist! My Robot’s Possessed!</h1>
            </div>
        </div>
    </div>
</section>

<main id="main">

    <nav class="anchor-links">
        <div class="container medium">
            <div style="float:left">
<nav id="wp-megamenu-blog" class="wp-megamenu-wrap   ">
			<div class="wpmm-fullwidth-wrap"></div>
			<div class="wpmm-nav-wrap wpmm-main-wrap-blog">
				<a href="javascript:;" class="wpmm_mobile_menu_btn show-close-icon"><i class="fa fa-bars"></i> Menu</a> 
					<ul id="menu-mcafee-blog-navigation-new-05020" class="wp-megamenu" ><li id="wp-megamenu-item-101279" class="menu-item menu-item-type-custom menu-item-object-custom wp-megamenu-item-101279  wpmm_mega_menu  wpmm-fadeindown wpmm-submenu-right"><a href="#">Consumer <b class="fa fa-angle-down"></b> </a>
<ul class="wp-megamenu-sub-menu" >
	<li id="wp-megamenu-item-918567692141193097" class="wpmm-row wp-megamenu-item-918567692141193097 wpmm-submenu-right">
	<ul class="wp-megamenu-sub-menu" >
		<li id="wp-megamenu-item-3224074724237435392" class="wpmm-col wpmm-col-12 wp-megamenu-item-3224074724237435392 wpmm-submenu-right">
		<ul class="wp-megamenu-sub-menu" >
			<li class="menu-item wpmm-type-widget menu-widget-class wpmm-type-widget wp-megamenu-item-101279 wpmm-submenu-right"><div class="menu-consumer-category-container"><ul id="menu-consumer-category" class="menu"><li id="menu-item-97453" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-97453"><a href="/blogs/consumer/hackable/">Hackable? Podcast</a></li>
<li id="menu-item-97424" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-97424"><a href="/blogs/consumer/consumer-threat-notices/">Consumer Threat Notices</a></li>
<li id="menu-item-97425" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-97425"><a href="/blogs/consumer/family-safety/">Family Safety</a></li>
<li id="menu-item-97426" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-97426"><a href="/blogs/consumer/identity-protection/">Identity Protection</a></li>
<li id="menu-item-97427" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-97427"><a href="/blogs/consumer/mobile-and-iot-security/">Mobile and IoT Security</a></li>
<li id="menu-item-101334" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-101334"><a href="/blogs/consumer/">All Consumer Blogs</a></li>
</ul></div></li>
		</ul>
</li>
	</ul>
</li>
</ul>
</li>
<li id="wp-megamenu-item-101280" class="menu-item menu-item-type-custom menu-item-object-custom wp-megamenu-item-101280  wpmm_mega_menu  wpmm-fadeindown wpmm-submenu-right"><a href="#">Enterprise <b class="fa fa-angle-down"></b> </a>
<ul class="wp-megamenu-sub-menu" >
	<li id="wp-megamenu-item-7182229382515772298" class="wpmm-row wp-megamenu-item-7182229382515772298 wpmm-submenu-right">
	<ul class="wp-megamenu-sub-menu" >
		<li id="wp-megamenu-item-7320680682248756305" class="wpmm-col wpmm-col-12 wp-megamenu-item-7320680682248756305 wpmm-submenu-right">
		<ul class="wp-megamenu-sub-menu" >
			<li class="menu-item wpmm-type-widget menu-widget-class wpmm-type-widget wp-megamenu-item-101280 wpmm-submenu-right"><div class="menu-enterprise-category-container"><ul id="menu-enterprise-category" class="menu"><li id="menu-item-97421" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-97421"><a href="/blogs/enterprise/cloud-security/">Cloud Security</a></li>
<li id="menu-item-97451" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-97451"><a href="/blogs/enterprise/endpoint-security/">Endpoint Security</a></li>
<li id="menu-item-97422" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-97422"><a href="/blogs/enterprise/security-operations/">Security Operations</a></li>
<li id="menu-item-97452" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-97452"><a href="/blogs/enterprise/data-security/">Data Security</a></li>
<li id="menu-item-101336" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-101336"><a href="/blogs/enterprise/">All Enterprise Blogs</a></li>
</ul></div></li>
		</ul>
</li>
	</ul>
</li>
</ul>
</li>
<li id="wp-megamenu-item-101281" class="menu-item menu-item-type-custom menu-item-object-custom wp-megamenu-item-101281  wpmm_mega_menu  wpmm-fadeindown wpmm-submenu-right"><a href="#">Corporate <b class="fa fa-angle-down"></b> </a>
<ul class="wp-megamenu-sub-menu" >
	<li id="wp-megamenu-item-6261600088896425867" class="wpmm-row wp-megamenu-item-6261600088896425867 wpmm-submenu-right">
	<ul class="wp-megamenu-sub-menu" >
		<li id="wp-megamenu-item-6656392281148355522" class="wpmm-col wpmm-col-12 wp-megamenu-item-6656392281148355522 wpmm-submenu-right">
		<ul class="wp-megamenu-sub-menu" >
			<li class="menu-item wpmm-type-widget menu-widget-class wpmm-type-widget wp-megamenu-item-101281 wpmm-submenu-right"><div class="menu-other-blogs-container"><ul id="menu-other-blogs" class="menu"><li id="menu-item-97442" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-97442"><a href="/blogs/other-blogs/executive-perspectives/">Executive Perspectives</a></li>
<li id="menu-item-97441" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-97441"><a href="/blogs/other-blogs/mcafee-labs/">McAfee Labs</a></li>
<li id="menu-item-97443" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-97443"><a href="/blogs/other-blogs/life-at-mcafee/">Life at McAfee</a></li>
<li id="menu-item-97440" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-97440"><a href="/blogs/other-blogs/podcast/">Podcast</a></li>
<li id="menu-item-97444" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-97444"><a href="/blogs/other-blogs/mcafee-partners/">McAfee Partners</a></li>
<li id="menu-item-101340" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor menu-item-101340"><a href="/blogs/other-blogs/">All Corporate Blogs</a></li>
</ul></div></li>
		</ul>
</li>
	</ul>
</li>
</ul>
</li>
<li id="wp-megamenu-item-101282" class="menu-item menu-item-type-custom menu-item-object-custom wp-megamenu-item-101282  wpmm_dropdown_menu  wpmm-fadeindown wpmm-submenu-right"><a href="/blogs/authors/">Authors</a></li>
<li id="wp-megamenu-item-101283" class="menu-item menu-item-type-custom menu-item-object-custom wp-megamenu-item-101283  wpmm_dropdown_menu  wpmm-fadeindown wpmm-submenu-right"><a href="/blogs/subscribe/">Subscribe</a></li>
<li id="wp-megamenu-item-101284" class="menu-item menu-item-type-custom menu-item-object-custom wp-megamenu-item-101284  wpmm_mega_menu  wpmm-fadeindown wpmm-submenu-right"><a href="#"><span class='wpmm-selected-icon wpmm-selected-icon-left'><i class='fa fa-globe'></i></span> <b class="fa fa-angle-down"></b> </a>
<ul class="wp-megamenu-sub-menu" >
	<li id="wp-megamenu-item-7429595386818972558" class="wpmm-row wp-megamenu-item-7429595386818972558 wpmm-submenu-right">
	<ul class="wp-megamenu-sub-menu" >
		<li id="wp-megamenu-item-7601685110932393509" class="wpmm-col wpmm-col-12 wp-megamenu-item-7601685110932393509 wpmm-submenu-right">
		<ul class="wp-megamenu-sub-menu" >
			<li class="menu-item wpmm-type-widget menu-widget-class wpmm-type-widget wp-megamenu-item-101284 wpmm-submenu-right"><div class="menu-languages-category-container"><ul id="menu-languages-category" class="menu"><li id="menu-item-97433" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-97433"><a href="/blogs/languages/italia/">Italia</a></li>
<li id="menu-item-97434" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-97434"><a href="/blogs/languages/japanese/">日本語</a></li>
<li id="menu-item-97435" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-97435"><a href="/blogs/languages/espanol/">Español</a></li>
<li id="menu-item-97436" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-97436"><a href="/blogs/languages/francais/">Français</a></li>
<li id="menu-item-97437" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-97437"><a href="/blogs/languages/german/">German</a></li>
<li id="menu-item-97438" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-97438"><a href="/blogs/languages/portugues/">Português</a></li>
<li id="menu-item-101338" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-101338"><a href="/blogs/languages/">All Language Blogs</a></li>
</ul></div></li>
		</ul>
</li>
	</ul>
</li>
</ul>
</li>
<li id="wp-megamenu-item-" class="wpmm-social-link wpmm-social-link- wp-megamenu-item-  wpmm_dropdown_menu  wpmm-fadeindown wpmm-submenu-right"><a target="_blank" ><i class=""></i></a></li>
</ul>
			</div>
		</nav>            </div>
            <div class="anchors right">
                <form role="search" method="get" class="blog-search search-form" action="https://www.mcafee.com/blogs/">
                    <button type="submit" class="search-submit"><i class="symbol-arrow-forward"></i></button>
                    <input type="search" class="search-field" placeholder="Search Blogs" value="" name="s" />


                </form>  
            </div>

        </div>
    </nav>

    <div class="wrap-section padding-top-xs"> 
        <div class="container medium">
 
        <div class="breadcrumb-container theme1">
            <ul itemscope itemtype="http://schema.org/BreadcrumbList">
                
                    <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"><a itemprop="item" title="Mcafee" href="/"><span itemprop="name">Mcafee</span></a><span class="separator">/</span><meta itemprop="position" content="1"></li>
                    
                    <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"><a itemprop="item" title="Home" href="https://www.mcafee.com/blogs"><span itemprop="name">Home</span></a><span class="separator">/</span><meta itemprop="position" content="2"></li>
                    
                    <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"><a itemprop="item" title="Other Blogs" href="/blogs/other-blogs/"><span itemprop="name">Other Blogs</span></a><span class="separator">/</span><meta itemprop="position" content="3"></li>
                    
                    <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"><a itemprop="item" title="McAfee Labs" href="/blogs/other-blogs/mcafee-labs/"><span itemprop="name">McAfee Labs</span></a><span class="separator">/</span><meta itemprop="position" content="4"></li>
                    
                    <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"><a itemprop="item" title="Call an Exorcist My Robots Possessed" href="#"><span itemprop="name">Call an Exorcist My Robots Possessed</span></a><meta itemprop="position" content="5"></li>
                                   </ul>
        </div>
        <style type="text/css">
            .breadcrumb-container {
                font-size: 13px;
            }
            .breadcrumb-container ul {
                margin: 0;
                padding: 0;
            }
            .breadcrumb-container li {
                box-sizing: unset;
                display: inline-block;
                margin: 0;
                padding: 0;
            }
            .breadcrumb-container li a {
                box-sizing: unset;
                padding: 0 10px;
            }
            .breadcrumb-container {
                font-size: 12px  !important;
                padding: 0px;
                margin: 0px;
            }
            .breadcrumb-container li a{
                color:  #c01818  !important;
                font-size:  12px  !important;
                line-height:  12px  !important;
            }
            .breadcrumb-container li .separator {
                color: #53565a  !important;
                font-size:  12px  !important;
            }
                            .breadcrumb-container li:last-child .separator {
                    display: none;
                }
                
							
							
.breadcrumb-container.theme1 li {
	margin: 0;
	padding: 0;
}							
							
.breadcrumb-container.theme1 a {
	background: ;
	display: inline-block;
	margin: 0 5px;
	padding: 5px 10px;
	text-decoration: none;
}

.breadcrumb-container{}
.breadcrumb-container ul{}
.breadcrumb-container li{}
.breadcrumb-container a{}
.breadcrumb-container .separator{}
        </style>
                </div>		 
    </div>

    <div class="wrap-section padding-small article">  
        <div class="container medium"> 
            <div class="border-line"></div>

            <div class="author-block padding-bottom-xs">
                <img class="author" src="/wp-content/uploads/2019/08/headshot-267x300.png" />
                <div class="meta">By <a href="/blogs/author/mark-bereza/" title="Posts by Mark Bereza" class="author url fn" rel="author">Mark Bereza</a> on Aug 05, 2020</div>
            </div>

                    <h2><a name="Toc45545095"></a><span lang="EN-US">Overview</span></h2>
<p>As part of our continued goal of helping developers provide safer products for businesses and consumers, we here at McAfee Advanced Threat Research (ATR) recently investigated <em>temi</em>, a teleconference robot produced by Robotemi Global Ltd. Our research led us to discover four separate vulnerabilities in the temi robot, which this paper will describe in great detail. These include:</p>
<ol>
<li>CVE-2020-16170 – Use of Hard-Coded Credentials</li>
<li>CVE-2020-16168 – Origin Validation Error</li>
<li>CVE-2020-16167 – Missing Authentication for Critical Function</li>
<li>CVE-2020-16169 – Authentication Bypass Using an Alternate Path of Channel</li>
</ol>
<p>Together, these vulnerabilities could be used by a malicious actor to spy on temi’s video calls, intercept calls intended for another user, and even remotely operate temi – all with zero authentication.</p>
<p>Per McAfee’s vulnerability disclosure policy, we reported our findings to Robotemi Global Ltd. on March 5, 2020. Shortly thereafter, they responded and began an ongoing dialogue with ATR while they worked to adopt the mitigations we outlined in our disclosure report. As of July 15, 2020, these vulnerabilities have been successfully patched – mitigated in version 120 of the temi&#8217;s Robox OS and all versions after 1.3.7931 of the temi Android app. We commend Robotemi for their prompt response and willingness to collaborate throughout this process. We’d go so far as to say this has been one of the most responsive, proactive, and efficient vendors McAfee has had the pleasure of working with.</p>
<p>This paper is intended as a long-form technical analysis of the vulnerability discovery process, the exploits made possible by the vulns, and the potential impact such exploits may have. Those interested in a higher-level, less technical overview of these findings should refer to our summary blog post <a href="https://www.mcafee.com/blogs/other-blogs/mcafee-labs/robot-character-analysis-reveals-trust-issues/">here</a>.</p>
<h2><a name="Toc45545096"></a>Contents</h2>
<p><a href="#Toc45545095">Overview</a><br />
<a href="#Toc45545096">Contents</a><br />
<a href="#Toc45545097">What is temi</a><br />
<a href="#Toc45545098">Normal Operation of temi</a><br />
<a href="#Toc45545099">Initial Recon</a><br />
<a href="#Toc45545100">Port Scanning</a><br />
<a href="#Toc45545101">Capturing Traffic</a><br />
<a href="#Toc45545102">Getting a Shell</a><br />
<a href="#Toc45545103">Finding temi’s Code</a><br />
<a href="#Toc45545104">Reversing the Code for Video Calls</a><br />
<a href="#Toc45545105">Brute-Forcing the Channel Name as an Attack Vector</a><br />
<a href="#Toc45545106">Exploring MQTT Attack Vectors</a><br />
<a href="#Toc45545107">Overview</a><br />
<a href="#Toc45545108">Modifying the temi Phone App</a><br />
<a href="#Toc45545109">The Relationship Between Robot IDs and MQTT Topics</a><br />
<a href="#Toc45545110">How are MQTT Call Invite Messages Published?</a><br />
<a href="#Toc45545111">Intercepting Calls</a><br />
<a href="#Toc45545112">Problem: temi Won’t Answer My Calls</a><br />
<a href="#Toc45545113">Solution: Become an OWNER</a><br />
<a href="#Toc45545114">Adding an OWNER: Phone App’s Perspective</a><br />
<a href="#Toc45545115">Adding an OWNER: temi’s Perspective</a><br />
<a href="#Toc45545116">Detour: Sneaking Onto temi’s Contact List</a><br />
<a href="#Toc45545117">Gaining OWNER Privileges</a><br />
<a href="#Toc45545118">Refining the Exploits</a><br />
<a href="#Toc45545119">Impact</a><br />
<a href="#Toc45545120">Conclusion</a></p>
<h2><a name="Toc45545097"></a>What is temi?</h2>
<p>Robots.</p>
<p>The final frontier.</p>
<p>For an Android tablet ‘brain’ sitting atop a 4-foot-tall robot, temi packs a lot of sensors into a small form factor. These include 360° LIDAR, three different cameras, five proximity sensors, and even an Inertial Measurement Unit  (IMU) sensor, which is a sort of accelerometer + gyroscope + magnetometer all-in-one. All these work together to give temi something close to the ability to move autonomously through a space while avoiding any obstacles. If it weren’t for the nefarious forces of stairs and curbs, temi would be unstoppable.</p>
<p><img class="aligncenter wp-image-103533 size-full" src="/wp-content/uploads/2020/07/temi.jpg" alt="" width="1920" height="1080" srcset="/wp-content/uploads/2020/07/temi.jpg 1920w, /wp-content/uploads/2020/07/temi-300x169.jpg 300w, /wp-content/uploads/2020/07/temi-1024x576.jpg 1024w, /wp-content/uploads/2020/07/temi-768x432.jpg 768w, /wp-content/uploads/2020/07/temi-1536x864.jpg 1536w, /wp-content/uploads/2020/07/temi-205x115.jpg 205w" sizes="(max-width: 1920px) 100vw, 1920px" /></p>
<p>Robotemi markets its robot as being used primarily for teleconferencing. Articles linked from the temi website describe the robot’s applications in various industries: Connected Living recently partnered with temi for use in elder care, the Kellog’s café in NYC adopted temi to “enhance the retail experience”, and corporate staffing company Collabera uses temi to “improve cross-office communication.” Despite its slogan of “personal robot”, it appears that temi is designed for both consumer <em>and</em> enterprise applications, and it’s the latter that really got us at McAfee Advanced Threat Research interested in it as a research target. Its growing presence in the medical space, which temi’s creators have accommodated by stepping up production to 1,000 units a month, is especially interesting given the greatly increased demand for remote doctor’s visits. What would a compromised temi mean for its users, whether it be the mother out on business, or the patient being diagnosed via robotic proxy? We placed our preorder and set out to find out.</p>
<h2><a name="Toc45545098"></a>Normal Operation of temi</h2>
<p>Once it finally arrived, we got to setting it up the way any user might: we unboxed it, plugged in its charging dock, and connected it to WiFi. Normal operation of the temi robot is done through the use of its smart phone app, and at first startup temi prompted us to scan a QR code with the app. The phone used to scan the QR code becomes temi’s “admin”, allowing you to control the robot remotely by simply calling it. Temi can have many contacts outside of its singular admin, and becoming a contact is fairly straightforward. Whenever you launch the temi phone app, it scans your phone’s contacts and automatically adds any numbers that have been registered with the temi app to the app’s contact list. If any of those contacts happens to be a temi admin, you can call their temi simply by clicking that contact, as shown in <u>Figure 1</u>.</p>
<p><img class="aligncenter size-full wp-image-103536" src="/wp-content/uploads/2020/07/selecting-a-contact.png" alt="" width="1432" height="755" srcset="/wp-content/uploads/2020/07/selecting-a-contact.png 1432w, /wp-content/uploads/2020/07/selecting-a-contact-300x158.png 300w, /wp-content/uploads/2020/07/selecting-a-contact-1024x540.png 1024w, /wp-content/uploads/2020/07/selecting-a-contact-768x405.png 768w, /wp-content/uploads/2020/07/selecting-a-contact-205x108.png 205w" sizes="(max-width: 1432px) 100vw, 1432px" /></p>
<p style="text-align: center;">Figure 1: Selecting a contact from the temi phone app</p>
<p>In this way, users of the phone app besides temi’s admin can still call a temi robot using this method. Since initiating a call with a temi allows you to remotely operate it in addition to seeing through its camera and hearing through its microphone, giving anyone the ability to call your temi could prove… problematic. Temi’s creators address this exact issue on their FAQ page, as shown in <u>Figure 2</u>.</p>
<p><img class="aligncenter size-full wp-image-103539" src="/wp-content/uploads/2020/07/connect-to-temi.png" alt="" width="826" height="270" srcset="/wp-content/uploads/2020/07/connect-to-temi.png 826w, /wp-content/uploads/2020/07/connect-to-temi-300x98.png 300w, /wp-content/uploads/2020/07/connect-to-temi-768x251.png 768w, /wp-content/uploads/2020/07/connect-to-temi-205x67.png 205w" sizes="(max-width: 826px) 100vw, 826px" /></p>
<p style="text-align: center;">Figure 2: &#8220;Can anyone connect to my temi?&#8221;, from the temi&#8217;s FAQ page</p>
<p>The first line here is a bit misleading, since adding a temi&#8217;s admin as a phone contact seems to be sufficient to call that temi – the admin does not need to also have you added as a phone contact for this to work. That being said, this doesn’t mean that just anyone can start controlling your temi; &#8220;physical permission on the robot side&#8221; is required for calls made by users that aren&#8217;t temi&#8217;s admin or explicitly authorized by said admin. In practice, this corresponds to a call notification on the temi&#8217;s screen that the user can either answer or decline. In other words, it’s no more or less “secure” than receiving cold calls on your cell phone.</p>
<p>As for the last line, which refers to an admin’s ability to grant certain users the option to “hop in” to the robot, this is also done through the phone app by simply selecting the “Invite New Member” option from the temi’s contact entry in the app, and then selecting one or more users from the app’s contact list to “invite”, as shown in <u>Figure 3</u>.</p>
<p><img class="aligncenter size-full wp-image-103542" src="/wp-content/uploads/2020/07/special-permissions.png" alt="" width="1009" height="561" srcset="/wp-content/uploads/2020/07/special-permissions.png 1009w, /wp-content/uploads/2020/07/special-permissions-300x167.png 300w, /wp-content/uploads/2020/07/special-permissions-768x427.png 768w, /wp-content/uploads/2020/07/special-permissions-205x114.png 205w" sizes="(max-width: 1009px) 100vw, 1009px" /></p>
<p style="text-align: center;">Figure 3: How to grant users special permissions from the phone app</p>
<p>Once a call has been established between the robot and a phone user, which either party may initiate, the phone user can do things like manually drive the robot around, add, remove, and navigate to saved locations, patrol between saved locations, control its volume, and more.</p>
<p><img class="aligncenter size-full wp-image-103545" src="/wp-content/uploads/2020/07/driving-temi.jpg" alt="" width="943" height="532" srcset="/wp-content/uploads/2020/07/driving-temi.jpg 943w, /wp-content/uploads/2020/07/driving-temi-300x169.jpg 300w, /wp-content/uploads/2020/07/driving-temi-768x433.jpg 768w, /wp-content/uploads/2020/07/driving-temi-205x116.jpg 205w" sizes="(max-width: 943px) 100vw, 943px" /></p>
<p style="text-align: center;">Figure 4: Driving the temi using the phone app</p>
<p>Due to the level of control afforded to temi’s callers, the calling functionality quickly became a priority during our investigation of the temi robot.</p>
<h2><a name="Toc45545099"></a>Initial Recon</h2>
<h3><a name="Toc45545100"></a>Port Scanning</h3>
<p>While a robot was certainly a bit different from our typical targets, we began our reconnaissance with methods that have stood the test of time: port scans, packet captures, and a local shell.</p>
<p><img class="aligncenter size-full wp-image-103548" src="/wp-content/uploads/2020/07/Nmap.png" alt="" width="975" height="363" srcset="/wp-content/uploads/2020/07/Nmap.png 975w, /wp-content/uploads/2020/07/Nmap-300x112.png 300w, /wp-content/uploads/2020/07/Nmap-768x286.png 768w, /wp-content/uploads/2020/07/Nmap-205x76.png 205w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 5: Running Nmap on the temi</p>
<p>An Nmap scan revealed only one open port: TCP port 4443. Immediately we knew that Nmap’s classification of this port being used for Pharos, a “secure office printing solution for your business”, was almost certainly wrong. Instead, it was likely that this port was being used for TLS communication as an alternative to the standard 443. While good to know, this didn’t tell us much about the type of traffic temi expected on this port, or even what service(s) was handling that traffic, so we moved on.</p>
<h3><a name="Toc45545101"></a>Capturing Traffic</h3>
<p>Next on our checklist was to obtain some captures of the robot’s network traffic, focusing on traffic generated during boot, during an update, and during a video call.</p>
<p>Traffic captured when temi was booting up but otherwise idling showed three unique external IP addresses being accessed: 98.137.246.7, 54.85.186.18, and 34.206.180.208.</p>
<p>Running <a href="https://linux.die.net/man/1/nslookup">nslookup</a> on these IPs revealed that the first pointed to some Yahoo! media server, likely used for its news app, while the other two appeared to be AWS instances.</p>
<p><img class="aligncenter size-full wp-image-104583" src="/wp-content/uploads/2020/08/nslookup-5.png" alt="" width="975" height="279" srcset="/wp-content/uploads/2020/08/nslookup-5.png 975w, /wp-content/uploads/2020/08/nslookup-5-300x86.png 300w, /wp-content/uploads/2020/08/nslookup-5-768x220.png 768w, /wp-content/uploads/2020/08/nslookup-5-205x59.png 205w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 6: Running nslookup on IPs accessed by temi</p>
<p>As for the data being sent/received, there wasn’t much to look at. The Yahoo! address was being accessed via HTTP (port 80), but the TCP packets had no payload. As for the AWS addresses, these were being accessed via TLS (port 443) and the data was encrypted.</p>
<p>For updates, temi accessed “temi-ota-updates.s3-accelerate.amazonaws.com”, which was almost certainly a custom AWS instance set up by the folks at Robotemi. As with the other traffic to AWS, the updates were being encrypted.</p>
<h3><a name="Toc45545102"></a>Getting a Shell</h3>
<p>In order to prod deeper, we needed a local shell on our temi. Fortunately, wireless connections via <a href="https://developer.android.com/studio/command-line/adb">Android Debug Bridge, or ADB</a>, could be enabled through temi’s settings from its touchscreen. Better still, the shell provided through ADB had root privileges, although the device itself was not “rooted”. This was likely done to help facilitate “temi Developers”, since the temi website has <a href="https://www.robotemi.com/developers/">an entire portal dedicated to helping users develop custom apps for their robot</a>.</p>
<p>Unfortunately, the default shell granted via ADB was fairly stripped down, and each reboot would mean having to manually reopen temi’s ADB port from its touchscreen before being able to connect to it again. Furthermore, this method required the temi software to be running in order to access our shell, which would leave us without recourse if our prodding somehow bricked that software. This was far from ideal.</p>
<p>While commands like <a href="https://developer.android.com/studio/command-line/adb#copyfiles">adb push</a> made moving custom ARM binaries for bash, <a href="https://busybox.net/">busybox</a>, and ssh onto temi fairly trivial, getting anything to run on boot proved more challenging. For starters, temi did not have the standard /etc/init.d/ directory. Additionally, the primary scripts that would run on boot, like /init.rc, would be loaded directly from the boot image, meaning any edits made to them would not persist across reboots. This was likely by design as part of Android’s SELinux security model – we would have to be a little more creative if we wanted to convince temi to start an SSH server on boot.</p>
<p>Digging through the contents of /init.rc, however, gave us a clue:</p>
<p><img class="aligncenter size-full wp-image-103557" src="/wp-content/uploads/2020/07/interesting-entry.png" alt="" width="1090" height="232" srcset="/wp-content/uploads/2020/07/interesting-entry.png 1090w, /wp-content/uploads/2020/07/interesting-entry-300x64.png 300w, /wp-content/uploads/2020/07/interesting-entry-1024x218.png 1024w, /wp-content/uploads/2020/07/interesting-entry-768x163.png 768w, /wp-content/uploads/2020/07/interesting-entry-205x44.png 205w" sizes="(max-width: 1090px) 100vw, 1090px" /></p>
<p style="text-align: center;">Figure 7: Interesting entry in /init.rc</p>
<p>For those unfamiliar with Android’s Init language,</p>
<p style="text-align: left; padding-left: 40px;">“The init language is used in plain text files that take the .rc file extension. There are typically multiple of these in multiple locations on the system, described below.<br />
/init.rc is the primary .rc file and is loaded by the init executable at the beginning of its execution. It is responsible for the initial set up of the system.” – <a href="https://android.googlesource.com/platform/system/core/+/master/init/README.md">Android docs</a>.</p>
<p>The entry shown in <u>Figure 7</u>, one of the hundreds contained in temi’s init.rc, tells the system to launch the service “flash_recovery” during boot with the argument “/system/bin/install-recovery.sh”. The “class main” is just a label used to group entries together, and “oneshot” just means “do not restart the service when it exits.” This entry stood out to us because it was invoking a script located in /system/bin/, which was <strong>not</strong> loaded from the boot image, meaning any changes should stick. While the /system partition is read-only by default, our root privileges made it trivial to temporarily remount /system as read-write in order to add the following line to the end: “/system/bin/sshd”. With that, we had a reliable means of getting a root shell on our temi to explore further.</p>
<h3><a name="Toc45545103"></a>Finding temi’s Code</h3>
<p>The first thing we did with our newfound freedom was run netstat:</p>
<p><img class="aligncenter size-full wp-image-103560" src="/wp-content/uploads/2020/07/netstat.png" alt="" width="975" height="448" srcset="/wp-content/uploads/2020/07/netstat.png 975w, /wp-content/uploads/2020/07/netstat-300x138.png 300w, /wp-content/uploads/2020/07/netstat-768x353.png 768w, /wp-content/uploads/2020/07/netstat-205x94.png 205w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 8: Running netstat</p>
<p style="text-align: left;">It appeared that most networking, including the open port 4443 we found using Nmap earlier, was being handled by “com.roboteam.teamy.usa”. Based on the name alone, this was likely the main temi software running on the robot. Additionally, the name looked more like the name of an Android package than a native binary. We confirmed this by running:</p>
<p><img class="aligncenter size-full wp-image-103563" src="/wp-content/uploads/2020/07/binary.png" alt="" width="820" height="194" srcset="/wp-content/uploads/2020/07/binary.png 820w, /wp-content/uploads/2020/07/binary-300x71.png 300w, /wp-content/uploads/2020/07/binary-768x182.png 768w, /wp-content/uploads/2020/07/binary-205x49.png 205w" sizes="(max-width: 820px) 100vw, 820px" /></p>
<p style="text-align: center;">Figure 9: Trying to find the binary for com.roboteam.teamy.usa in /proc</p>
<p>app_process32 (or app_process64, depending on architecture), is the binary used by Android for running Android apps, meaning we were looking for an APK, not an ELF. Under this assumption, we instead tried to find the code for this process using Android’s <a href="http://adbcommand.com/adbshell/pm">pm</a> command:</p>
<p><img class="aligncenter size-full wp-image-103566" src="/wp-content/uploads/2020/07/looking-for-the-APK.png" alt="" width="975" height="139" srcset="/wp-content/uploads/2020/07/looking-for-the-APK.png 975w, /wp-content/uploads/2020/07/looking-for-the-APK-300x43.png 300w, /wp-content/uploads/2020/07/looking-for-the-APK-768x109.png 768w, /wp-content/uploads/2020/07/looking-for-the-APK-205x29.png 205w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 10: Looking for the APK for &#8220;com.roboteam.teamy.usa&#8221;</p>
<p>Sure enough, we had our APK.</p>
<p>Typically, every installed app on Android has a corresponding data directory, and we were able to find the one for this package under /data/data/com.roboteam.teamy.usa:</p>
<p><img class="aligncenter size-full wp-image-103569" src="/wp-content/uploads/2020/07/data-directory.png" alt="" width="1074" height="194" srcset="/wp-content/uploads/2020/07/data-directory.png 1074w, /wp-content/uploads/2020/07/data-directory-300x54.png 300w, /wp-content/uploads/2020/07/data-directory-1024x185.png 1024w, /wp-content/uploads/2020/07/data-directory-768x139.png 768w, /wp-content/uploads/2020/07/data-directory-205x37.png 205w" sizes="(max-width: 1074px) 100vw, 1074px" /></p>
<p style="text-align: center;">Figure 11: data directory for &#8220;com.roboteam.teamy.usa&#8221;</p>
<p>The lib/ directory contained native code used by the package:</p>
<p><img class="aligncenter size-full wp-image-103572" src="/wp-content/uploads/2020/07/native-code.png" alt="" width="975" height="260" srcset="/wp-content/uploads/2020/07/native-code.png 975w, /wp-content/uploads/2020/07/native-code-300x80.png 300w, /wp-content/uploads/2020/07/native-code-768x205.png 768w, /wp-content/uploads/2020/07/native-code-205x55.png 205w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 12: native code used by &#8220;com.roboteam.teamy.usa&#8221;</p>
<p>After looking into several of these libraries, libagora-rtc-sdk-jni.so in particular stood out to us since it was part of <a href="https://www.agora.io/en/">Agora</a>, a platform that provides SDKs for voice, video, and Real-Time-Messaging (RTM) services. It was likely that temi was using Agora to implement its video calling functionality – the functionality we were most interested in.</p>
<p>By looking at this binary’s strings, we were also able to determine that temi was using version 2.3.1 of the Agora Video SDK:</p>
<p><img class="aligncenter size-full wp-image-103575" src="/wp-content/uploads/2020/07/finding-Agora-SDK.png" alt="" width="975" height="149" srcset="/wp-content/uploads/2020/07/finding-Agora-SDK.png 975w, /wp-content/uploads/2020/07/finding-Agora-SDK-300x46.png 300w, /wp-content/uploads/2020/07/finding-Agora-SDK-768x117.png 768w, /wp-content/uploads/2020/07/finding-Agora-SDK-205x31.png 205w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 13: Finding the Agora SDK version using strings</p>
<p>Of course, we were equally interested in the code for the temi phone app, which we obtained through the use of <a href="https://play.google.com/store/apps/details?id=com.ext.ui&amp;hl=en_US">APK Extractor</a> and ADB. We were also curious to see if the Android phone app used the same version of the Agora SDK, which we checked by comparing their MD5 hashes:</p>
<p><img class="aligncenter size-full wp-image-103578" src="/wp-content/uploads/2020/07/comparing-MD5-hashes.png" alt="" width="1714" height="380" srcset="/wp-content/uploads/2020/07/comparing-MD5-hashes.png 1714w, /wp-content/uploads/2020/07/comparing-MD5-hashes-300x67.png 300w, /wp-content/uploads/2020/07/comparing-MD5-hashes-1024x227.png 1024w, /wp-content/uploads/2020/07/comparing-MD5-hashes-768x170.png 768w, /wp-content/uploads/2020/07/comparing-MD5-hashes-1536x341.png 1536w, /wp-content/uploads/2020/07/comparing-MD5-hashes-205x45.png 205w" sizes="(max-width: 1714px) 100vw, 1714px" /></p>
<p style="text-align: center;">Figure 14: Comparing MD5 hashes for libagora between temi robot and temi phone app</p>
<p>Sure enough, they were the identical.</p>
<h2><a name="Toc45545104"></a>Reversing the Code for Video Calls</h2>
<p>The next step was to begin reversing these apps in order to better understand how they worked. We decided to start by looking at the phone app’s code, since it was easier to test the behavior of the phone app compared to the robot.</p>
<p>In order to decompile and analyze the APK, we used <a href="https://github.com/skylot/jadx">JADX</a>. Although there are many Java decompilers out there that work on Android code, JADX stood out to us due to its various features:</p>
<ul>
<li>It can open APK files directly (will convert .dex to .jar and merge multiple .dex files automatically)</li>
<li>It handles modern Java features like nested classes and inline lambda functions better than most other decompilers</li>
<li>For any class being viewed, you can click on the &#8220;smali&#8221; tab to see the smali code</li>
<li>It displays line numbers synchronized with the corresponding .line directives in the bytecode, making it easier to map decompiled Java code back to the original bytecode</li>
<li>You can right-click on any method, member, or class to see its usage or declaration</li>
</ul>
<p>The temi Android phone app, like most non-trivial Android apps, was massive. Instead of groping in the dark and hoping to stumble upon some interesting code, we decided to take a more targeted approach. From the outset, we knew that our focus was on temi’s calling functionality since this would provide the greatest impact for any attacker. We also now knew that temi was using the Agora SDK to implement this calling functionality. After looking through <a href="https://docs.agora.io/en/faq/API%20Reference/java/v2.3.1/classio_1_1agora_1_1rtc_1_1_rtc_engine.html">Agora’s Java API Reference for Android (v2.3.1)</a>, we decided that the function joinChannel() would be a good place to start our investigation:</p>
<p><img class="aligncenter size-full wp-image-103581" src="/wp-content/uploads/2020/07/Agora-documentation.png" alt="" width="937" height="414" srcset="/wp-content/uploads/2020/07/Agora-documentation.png 937w, /wp-content/uploads/2020/07/Agora-documentation-300x133.png 300w, /wp-content/uploads/2020/07/Agora-documentation-768x339.png 768w, /wp-content/uploads/2020/07/Agora-documentation-205x91.png 205w" sizes="(max-width: 937px) 100vw, 937px" /></p>
<p style="text-align: center;">Figure 15: Agora&#8217;s documentation for joinChannel()</p>
<p>By opening libagora-rtc-sdk-jni.so in IDA and looking at its exports, we were able to find a function called nativeJoinChannel() at the offset 0xD4484:</p>
<p><img class="aligncenter size-full wp-image-103584" src="/wp-content/uploads/2020/07/libagora-exports.jpg" alt="" width="465" height="170" srcset="/wp-content/uploads/2020/07/libagora-exports.jpg 465w, /wp-content/uploads/2020/07/libagora-exports-300x110.jpg 300w, /wp-content/uploads/2020/07/libagora-exports-205x75.jpg 205w" sizes="(max-width: 465px) 100vw, 465px" /></p>
<p style="text-align: center;">Figure 16: Some of libagora&#8217;s exports</p>
<p>Using JADX’s search feature, we found a function with the same name in the decompiled code, located on line 960 in the class RtcEngineImpl:</p>
<p><img class="aligncenter size-full wp-image-103587" src="/wp-content/uploads/2020/07/native-Agora-methods.png" alt="" width="975" height="227" srcset="/wp-content/uploads/2020/07/native-Agora-methods.png 975w, /wp-content/uploads/2020/07/native-Agora-methods-300x70.png 300w, /wp-content/uploads/2020/07/native-Agora-methods-768x179.png 768w, /wp-content/uploads/2020/07/native-Agora-methods-205x48.png 205w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 17: Native Agora methods in RtcEngineImpl</p>
<p>From here, we began the tedious process of working backwards to trace the call chain for video calls all the way to their entry points. We did this by looking for the method that invoked nativeJoinChannel(), then looking for the method that invoked that method, and so on. The return on investment for our tireless efforts was the following:</p>
<p><a href="/wp-content/uploads/2020/07/Code_Flow_Diagram_White_BG.png"><img class="aligncenter wp-image-104403 size-large" src="/wp-content/uploads/2020/07/Code_Flow_Diagram_White_BG-1024x746.png" alt="" width="1024" height="746" srcset="/wp-content/uploads/2020/07/Code_Flow_Diagram_White_BG-1024x746.png 1024w, /wp-content/uploads/2020/07/Code_Flow_Diagram_White_BG-300x219.png 300w, /wp-content/uploads/2020/07/Code_Flow_Diagram_White_BG-768x559.png 768w, /wp-content/uploads/2020/07/Code_Flow_Diagram_White_BG-1536x1119.png 1536w, /wp-content/uploads/2020/07/Code_Flow_Diagram_White_BG-2048x1492.png 2048w, /wp-content/uploads/2020/07/Code_Flow_Diagram_White_BG-177x129.png 177w" sizes="(max-width: 1024px) 100vw, 1024px" /></a></p>
<p>&nbsp;</p>
<p style="text-align: center;">Figure 18: Code flow diagram for the various ways of making video calls using the temi phone app</p>
<p>At a high level, the code for outgoing calls has four entry-points, and these map 1-to-1 with the four ways of initiating a call from the temi phone app:</p>
<ol>
<li>Select a contact and hit “Call”. This will call that contact’s phone directly, not their temi. This corresponds to the “Contact Details → Contact Call” code path outlined in the graph (green region).</li>
<li>Select a contact and, if they have a temi robot, hit “Connect”. This will call their temi and corresponds to the “Contact Details → Robot Call” code path outlined in the graph (orange region).</li>
<li>Go to the app’s “Recents” tab and select one of the contacts/robots you have recently called or have called you. This will call that contact or robot and corresponds to the “Recent Calls → Call” code path outlined in the graph (blue region).</li>
<li>If you are an admin, select your temi from beneath the “My temi” heading on the “Contacts” tab and hit the “Connect” button from the following screen, also known as the Robot Details screen. This will call your temi and corresponds to the “Robot Details → Call” code path outlined in the graph (red region).</li>
</ol>
<p>The classes and methods contained within the colored regions handle rendering the screens from which calls can be initiated and the binding of these buttons to the code that actually handles calling. No matter the entry point, all outgoing calls converge at TelepresenceService.initiateCall(), so it’s worth taking a closer look at this method:</p>
<p><img class="aligncenter size-full wp-image-103593" src="/wp-content/uploads/2020/07/TelepresenceService.png" alt="" width="975" height="227" srcset="/wp-content/uploads/2020/07/TelepresenceService.png 975w, /wp-content/uploads/2020/07/TelepresenceService-300x70.png 300w, /wp-content/uploads/2020/07/TelepresenceService-768x179.png 768w, /wp-content/uploads/2020/07/TelepresenceService-205x48.png 205w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 19: TelepresenceService.initiateCall()</p>
<p>And here are the four ways it is invoked:</p>
<p>Contact Details → Contact Call</p>
<p><img class="aligncenter size-full wp-image-103596" src="/wp-content/uploads/2020/07/contact-call.png" alt="" width="1431" height="191" srcset="/wp-content/uploads/2020/07/contact-call.png 1431w, /wp-content/uploads/2020/07/contact-call-300x40.png 300w, /wp-content/uploads/2020/07/contact-call-1024x137.png 1024w, /wp-content/uploads/2020/07/contact-call-768x103.png 768w, /wp-content/uploads/2020/07/contact-call-205x27.png 205w" sizes="(max-width: 1431px) 100vw, 1431px" /></p>
<p style="text-align: center;">Figure 20: Invoking initiateCall() from Contact Details → Contact Call</p>
<p>Contact Details → Robot Call</p>
<p><img class="aligncenter size-full wp-image-103599" src="/wp-content/uploads/2020/07/robot-call.png" alt="" width="1431" height="191" srcset="/wp-content/uploads/2020/07/robot-call.png 1431w, /wp-content/uploads/2020/07/robot-call-300x40.png 300w, /wp-content/uploads/2020/07/robot-call-1024x137.png 1024w, /wp-content/uploads/2020/07/robot-call-768x103.png 768w, /wp-content/uploads/2020/07/robot-call-205x27.png 205w" sizes="(max-width: 1431px) 100vw, 1431px" /></p>
<p style="text-align: center;">Figure 21: Invoking initiateCall() from Contact Details → Robot Call</p>
<p>Recent Calls → Call</p>
<p><img class="aligncenter size-full wp-image-103602" src="/wp-content/uploads/2020/07/recent-calls.png" alt="" width="1431" height="191" srcset="/wp-content/uploads/2020/07/recent-calls.png 1431w, /wp-content/uploads/2020/07/recent-calls-300x40.png 300w, /wp-content/uploads/2020/07/recent-calls-1024x137.png 1024w, /wp-content/uploads/2020/07/recent-calls-768x103.png 768w, /wp-content/uploads/2020/07/recent-calls-205x27.png 205w" sizes="(max-width: 1431px) 100vw, 1431px" /></p>
<p style="text-align: center;">Figure 22: Invoking initiateCall() from Recent Calls → Call</p>
<p>Robot Details → Call</p>
<p><img class="aligncenter size-full wp-image-103605" src="/wp-content/uploads/2020/07/robot-details.png" alt="" width="1431" height="191" srcset="/wp-content/uploads/2020/07/robot-details.png 1431w, /wp-content/uploads/2020/07/robot-details-300x40.png 300w, /wp-content/uploads/2020/07/robot-details-1024x137.png 1024w, /wp-content/uploads/2020/07/robot-details-768x103.png 768w, /wp-content/uploads/2020/07/robot-details-205x27.png 205w" sizes="(max-width: 1431px) 100vw, 1431px" /></p>
<p style="text-align: center;">Figure 23: Invoking initiateCall() from Robot Details → Call</p>
<p>The first parameter is an ID used to identify the callee. For temi robots, this appears to be something called a “robot ID”, whereas for contacts it is obtained via a call to getContactId(). Interestingly, for recent calls, which can be either a contact <em>or</em> a robot, the ID is obtained via a call to getMd5PhoneNumber(), which is a bit strange since temi does not (as far as we can tell) have a phone number. We will expand on this later.</p>
<p>The second parameter is a string denoting the caller’s type. Since we were looking at exclusively phone app code here, we assumed that “typeUser” denotes a caller using the phone app.</p>
<p>The third parameter is the callee’s display name – straightforward enough.</p>
<p>The fourth and final parameter is of a custom enum type that denotes the <em>callee’s</em> type. If calling a temi, its type is CallContactType.TEMI_CALL; otherwise, it’s CallContactType.CONTACT_CALL. Note that for the Recent Calls entry point, this value is obtained dynamically, which makes sense since this path handles calls to both contacts and temis.</p>
<p>It’s also worth noting that initiateCall() invokes InvitationManager.createInvitation() in order to create an Invitation object which represents the “call invitation” to be sent to the callee:</p>
<p><img class="aligncenter size-full wp-image-103608" src="/wp-content/uploads/2020/07/call-invitation.png" alt="" width="1430" height="128" srcset="/wp-content/uploads/2020/07/call-invitation.png 1430w, /wp-content/uploads/2020/07/call-invitation-300x27.png 300w, /wp-content/uploads/2020/07/call-invitation-1024x92.png 1024w, /wp-content/uploads/2020/07/call-invitation-768x69.png 768w, /wp-content/uploads/2020/07/call-invitation-205x18.png 205w" sizes="(max-width: 1430px) 100vw, 1430px" /></p>
<p style="text-align: center;">Figure 24: InvitationManager.createInvitation()</p>
<p>From there, as seen on line 223 of <u>Figure 19</u>, initiateCall() passes the result of Utils.getRandomSessionId() as the first parameter to createInvitation(), which becomes the sessionId:</p>
<p><img class="aligncenter size-full wp-image-103611" src="/wp-content/uploads/2020/07/25.png" alt="" width="1430" height="168" srcset="/wp-content/uploads/2020/07/25.png 1430w, /wp-content/uploads/2020/07/25-300x35.png 300w, /wp-content/uploads/2020/07/25-1024x120.png 1024w, /wp-content/uploads/2020/07/25-768x90.png 768w, /wp-content/uploads/2020/07/25-205x24.png 205w" sizes="(max-width: 1430px) 100vw, 1430px" /></p>
<p style="text-align: center;">Figure 25: Utils.getRandomSessionId()</p>
<p>All this is doing is randomly generating an integer between 100,000 and 999,999, inclusive. In other words, the sessionId is always a positive, six-digit decimal number.</p>
<p>By tracing this value all the way down the call chain to Agora’s nativeJoinChannel(), we discovered that this sessionId becomes the “channelName” parameter described in <u>Figure 15</u> – the unique identifier for the chatroom for that particular call.  The propagation of this channel name can be seen in <u>Figure 18</u>; the <strong>bolded</strong> parameter in each method call contains the channel name.</p>
<h2><a name="Toc45545105"></a>Brute-Forcing the Channel Name as an Attack Vector</h2>
<p>So why were we so interested in the Agora channel name? Well, if we look back at <u>Figure 15</u>, we can see that it is one of only two fields needed to join a channel since the third and fourth fields are labeled optional. The only other required field is the “token”, but looking closer at the documentation reveals that “in most circumstances, the static App ID suffices”, and in those cases the token “is optional and can be set as null”:</p>
<p><img class="aligncenter size-full wp-image-103614" src="/wp-content/uploads/2020/07/token-parameter.jpg" alt="" width="882" height="179" srcset="/wp-content/uploads/2020/07/token-parameter.jpg 882w, /wp-content/uploads/2020/07/token-parameter-300x61.jpg 300w, /wp-content/uploads/2020/07/token-parameter-768x156.jpg 768w, /wp-content/uploads/2020/07/token-parameter-205x42.jpg 205w" sizes="(max-width: 882px) 100vw, 882px" /></p>
<p style="text-align: center;">Figure 26: Agora documentation for joinChannel&#8217;s &#8220;token&#8221; parameter</p>
<p>Our next question was, does temi use a token or does it use a static App ID? We quickly answered that question by looking at how the temi phone app was calling joinChannel():</p>
<p><img class="aligncenter size-full wp-image-103617" src="/wp-content/uploads/2020/07/joinchannel.png" alt="" width="975" height="129" srcset="/wp-content/uploads/2020/07/joinchannel.png 975w, /wp-content/uploads/2020/07/joinchannel-300x40.png 300w, /wp-content/uploads/2020/07/joinchannel-768x102.png 768w, /wp-content/uploads/2020/07/joinchannel-205x27.png 205w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 27: Agora&#8217;s joinChannel() API function being called from AgoraEngine.joinChannel()</p>
<p>Sure enough, the token parameter is being set to null.</p>
<p>This was starting to look promising – if the static App ID and channel name are all that’s needed to join an Agora video call and we already knew that temi’s channel names are restricted to six-digit values, then it might be plausible to join existing temi calls through brute force means. All we would need is this “App ID”.</p>
<p>Looking back at the Agora docs, we looked for which API functions actually use this App Id. As it turned out, there was only one: RtcEngine.create().</p>
<p><img class="aligncenter size-full wp-image-103620" src="/wp-content/uploads/2020/07/RtcEngine.png" alt="" width="975" height="756" srcset="/wp-content/uploads/2020/07/RtcEngine.png 975w, /wp-content/uploads/2020/07/RtcEngine-300x233.png 300w, /wp-content/uploads/2020/07/RtcEngine-768x595.png 768w, /wp-content/uploads/2020/07/RtcEngine-166x129.png 166w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 28: Agora documentation for RtcEngine.create()</p>
<p>Put briefly, the App ID is a static value issued to developers that is unique to each project and is used as a sort of namespace, segregating different users of Agora’s servers. This ensures that temi users can only use Agora to call other temi users. Since any temi phone app user should be able to call any temi (or other user), there should be a single App ID shared by all temi robots. We decided to take a look at how temi’s code was invoking RtcEngine.create() to see if we could track down the App ID:</p>
<p><img class="aligncenter size-full wp-image-103623" src="/wp-content/uploads/2020/07/App-ID.png" alt="" width="624" height="208" srcset="/wp-content/uploads/2020/07/App-ID.png 624w, /wp-content/uploads/2020/07/App-ID-300x100.png 300w, /wp-content/uploads/2020/07/App-ID-205x68.png 205w" sizes="(max-width: 624px) 100vw, 624px" /></p>
<p style="text-align: center;">Figure 29: AgoraEngine.ensureRtcEngineReadyLock()</p>
<p>Well, that’s not good.</p>
<p>In our view, this was already a vulnerability, denoted by CVE-2020-16170 and having a CVSS score of 8.2. A dedicated attacker would have no problem iterating over all 900,000 possible channel names. Worse yet, doing so would let the attacker “spray and pray”, allowing them to connect to any ongoing temi call without needing to know anything about their victims.</p>
<p>While we certainly couldn’t test such an exploit against a production server, we did decide to test whether an attacker could join an existing temi call knowing only the App ID and channel name in advance. To facilitate this, we used an Android phone to call our temi, making sure to run <a href="https://developer.android.com/studio/command-line/logcat">logcat</a> on the phone before the call started. Doing so, we were able to capture the invitation message containing the channel name (labeled “sessionId”) as it was being sent to the <a href="https://square.github.io/okhttp/">OkHttp</a> client, which then logged it:</p>
<p><img class="aligncenter size-full wp-image-103626" src="/wp-content/uploads/2020/07/finding-the-channel-name.png" alt="" width="975" height="128" srcset="/wp-content/uploads/2020/07/finding-the-channel-name.png 975w, /wp-content/uploads/2020/07/finding-the-channel-name-300x39.png 300w, /wp-content/uploads/2020/07/finding-the-channel-name-768x101.png 768w, /wp-content/uploads/2020/07/finding-the-channel-name-205x27.png 205w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 30: Finding the channel name for the call using logcat</p>
<p>Using the hardcoded App ID and the channel name obtained from the logs we were able to successfully join an ongoing call and get both audio and video from at least one of the other callers, proving that this is a viable attack vector.</p>
<p>Although exploitation of this vulnerability utilizes Agora’s video calling API, its existence is a result of temi’s specific implementation of the SDK. While the decision to hardcode temi’s Agora App ID into the phone app is the root cause of this vulnerability, its impact could also have been substantially mitigated by utilizing a token or by allowing a broader range of channel names. Either of these would have rendered the brute-force attack vector incredibly difficult, if not impossible.</p>
<h2><a name="Toc45545106"></a>Exploring MQTT Attack Vectors</h2>
<h3><a name="Toc45545107"></a>Overview</h3>
<p>Outside of a brute-force method involving joining existing temi calls by trying every possible channel ID, it would be useful to have a more targeted attack vector. Moreover, while joining a call using the brute-force method would let an attacker spy on users, it would not grant them control of the robot itself – we wanted a method that would let us do both. Fortunately, this level of control is already available during normal operation of the temi robot + phone app.</p>
<p>Although temi uses Agora to facilitate video calls, notifying users of incoming calls, through ringing or otherwise, is not a feature implemented by Agora. In the case of temi, this functionality is implemented using <a href="http://mqtt.org/">MQTT</a>. MQTT is a publish/subscribe (pub/sub) connectivity protocol designed for &#8220;machine-to-machine (M2M)/Internet of Things&#8221; communication. In it, communications are categorized into &#8220;topics&#8221; and clients can either &#8220;subscribe&#8221; to these topics to receive all their related messages, &#8220;publish&#8221; their own messages to these topics, or both. These topics are structured into a hierarchy delineated in a manner very similar to UNIX-style filesystem naming schemes, with a forward slash (&#8220;/&#8221;) separating different topic &#8220;levels&#8221;. Communication between clients is facilitated via a system known as a &#8220;<a href="https://en.wikipedia.org/wiki/MQTT#MQTT_broker">broker</a>&#8220;, usually implemented as a remote server, which handles establishing and closing connections, message delivery, and client authentication.</p>
<p>Unfortunately, there were several hurdles we would need to overcome in order to leverage temi&#8217;s calling functionality as an unauthorized &#8220;attacker&#8221;.</p>
<p>Firstly, a targeted attack method requires, at a minimum, a reliable way of uniquely identifying the target. In other words, if you are interested in hacking Bob&#8217;s temi, you need a way to pick out Bob&#8217;s temi from every other temi. A softer but equally important requirement is that this identifier must be one that an attacker could plausibly obtain. The more difficult the identifier is to obtain, the more contrived and unrealistic any attack vectors that rely on this identifier become. As an example, a name or phone number might be a plausible identifier; a social security number, less so.</p>
<p>Reversing temi&#8217;s MQTT implementation in its phone app code had revealed a promising potential identifier. We discovered that each robot has its own MQTT topics that it listens on, which are identified using its MQTT client ID, otherwise known as its robot ID. The robot ID for a temi can be easily obtained through normal operation of the phone app by simply adding one of its users as a phone contact, a method we had described previously. This is because the temi phone app allows the user to call any temi registered to a phone number in the user&#8217;s contacts list, which requires that temi&#8217;s robot ID. If the phone app already has access to this information locally, then it should be hypothetically possible to pull this information from the app.</p>
<p>Second, we needed a way to communicate with temi. If calling is facilitated through the publishing of MQTT messages to certain topics, we needed to find a way to publish our own messages to these same topics. On that note, if all MQTT messages must first pass through the broker, we needed a way to trick the broker into thinking we were a trusted MQTT client and bypass any authentication that might be in place.</p>
<p>One way to overcome this hurdle would be to alter the existing temi phone app. <a href="https://medium.com/swlh/reverse-engineering-and-modifying-an-android-game-apk-ctf-c617151b874c">Modifying third party Android apps</a> is a well-known process and would let us leverage the code already present for sending MQTT messages instead of writing this code from scratch. Furthermore, since the phone app requires nothing more than the phone number of one of temi&#8217;s users in order to call it (and thus, publish MQTT messages on its topics), this means that the phone app must have a way of authenticating with the broker. If we could send custom MQTT messages to arbitrary topics from the context of a &#8220;trusted&#8221; phone app, then we likely wouldn&#8217;t need to worry about authentication.</p>
<p>This left us with our third and final hurdle: privilege escalation. Although cold calling a temi robot is not difficult to achieve, it does not grant us the ability to remotely operate the robot on its own. This is because calling temi in this way causes it to ring and requires the call to be accepted on temi&#8217;s end via its touchscreen. Only temi&#8217;s admin, the user who registered it via QR code scan, and privileged users manually selected by this admin may directly control temi without any user interaction on the other end. Thus, we needed to find a way to escalate our privilege so that temi would pick up our calls automatically.</p>
<p>If MQTT is the primary means of communication between temi and its phone app users, and admins can manage the privilege levels of users directly from the phone app, it stands to reason that privilege management is likely performed through MQTT. Thus, if we could alter the phone app to spoof a privilege escalation MQTT message, we could overcome this hurdle, as well.</p>
<h3><a name="Toc45545108"></a>Modifying the temi Phone App</h3>
<p>Since our entire plan hinged on us being able to alter the bytecode of the phone app without either breaking the app or preventing it from authenticating with the various remote servers it communicates with, we decided to first confirm that this was even possible. To accomplish this, we used a combination of ADB, <a href="https://ibotpeaches.github.io/Apktool/">Apktool</a>, <a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html">Keytool</a>, and <a href="https://docs.oracle.com/javase/7/docs/technotes/tools/windows/jarsigner.html">Jarsigner</a>.</p>
<p>We began by unpacking the APK file for the temi phone app using Apktool:</p>
<p><img class="aligncenter size-full wp-image-103629" src="/wp-content/uploads/2020/07/unpacking-the-temi-phone-app.png" alt="" width="1430" height="87" srcset="/wp-content/uploads/2020/07/unpacking-the-temi-phone-app.png 1430w, /wp-content/uploads/2020/07/unpacking-the-temi-phone-app-300x18.png 300w, /wp-content/uploads/2020/07/unpacking-the-temi-phone-app-1024x62.png 1024w, /wp-content/uploads/2020/07/unpacking-the-temi-phone-app-768x47.png 768w, /wp-content/uploads/2020/07/unpacking-the-temi-phone-app-205x12.png 205w" sizes="(max-width: 1430px) 100vw, 1430px" /></p>
<p style="text-align: center;">Figure 31: Unpacking the temi phone app</p>
<p>Next, we searched the unpacked APK for the file or code we wanted to modify. For our proof-of-concept, we decided to simply change the label for the “Call” button, since it would be immediately obvious whether or not it worked. In many Android apps, the strings used for buttons are typically not hardcoded and are instead loaded from a resource file. In this case, they were loaded from the file res/values/strings.xml:</p>
<p><img class="aligncenter size-full wp-image-103632" src="/wp-content/uploads/2020/07/searching-for-the-call-button-label.png" alt="" width="975" height="143" srcset="/wp-content/uploads/2020/07/searching-for-the-call-button-label.png 975w, /wp-content/uploads/2020/07/searching-for-the-call-button-label-300x44.png 300w, /wp-content/uploads/2020/07/searching-for-the-call-button-label-768x113.png 768w, /wp-content/uploads/2020/07/searching-for-the-call-button-label-205x30.png 205w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 32: Searching for the call button label in strings.xml</p>
<p>It looked like line 108 contained the label we wanted to change. We simply replaced “Call” with “PWN” and saved our changes.</p>
<p><em>Note: For less trivial modifications, like the ones we would need to make later, this process would naturally be more involved. Since even the most sophisticated Java decompilers are unable to produce code that will actually compile for non-trivial apps, meaningful modifications usually mean having to read and modify </em><a href="https://github.com/JesusFreke/smali"><em>smali</em></a><em>, the assembler for Android’s Dalvik bytecode. That being said, we found that the best approach to making meaningful changes to a complex app like temi’s is to <strong>read Java, write smali</strong>. By this, we mean that it&#8217;s better to do your reversing on decompiled Java code and only look at the nigh-hieroglyphic smali code once you know exactly what changes you want to make and what class to make it in.</em></p>
<p>Once our modification had been made, we used Apktool again to repack the APK:</p>
<p><img class="aligncenter size-full wp-image-103635" src="/wp-content/uploads/2020/07/repacking-modified-app.png" alt="" width="1430" height="87" srcset="/wp-content/uploads/2020/07/repacking-modified-app.png 1430w, /wp-content/uploads/2020/07/repacking-modified-app-300x18.png 300w, /wp-content/uploads/2020/07/repacking-modified-app-1024x62.png 1024w, /wp-content/uploads/2020/07/repacking-modified-app-768x47.png 768w, /wp-content/uploads/2020/07/repacking-modified-app-205x12.png 205w" sizes="(max-width: 1430px) 100vw, 1430px" /></p>
<p style="text-align: center;">Figure 33: Repacking our modified app</p>
<p>Our next step was to sign the modified APK. This is because Android refuses to install any unsigned APKs, even through ADB. First, we generated a key using Keytool:</p>
<p><img class="aligncenter size-full wp-image-103638" src="/wp-content/uploads/2020/07/generating-the-key.png" alt="" width="1430" height="87" srcset="/wp-content/uploads/2020/07/generating-the-key.png 1430w, /wp-content/uploads/2020/07/generating-the-key-300x18.png 300w, /wp-content/uploads/2020/07/generating-the-key-1024x62.png 1024w, /wp-content/uploads/2020/07/generating-the-key-768x47.png 768w, /wp-content/uploads/2020/07/generating-the-key-205x12.png 205w" sizes="(max-width: 1430px) 100vw, 1430px" /></p>
<p style="text-align: center;">Figure 34: Generating the key we will use to sign the modified app</p>
<p>and then we used our key to sign the APK using Jarsigner:</p>
<p><img class="aligncenter size-full wp-image-103641" src="/wp-content/uploads/2020/07/signing-the-modified-app.png" alt="" width="1430" height="87" srcset="/wp-content/uploads/2020/07/signing-the-modified-app.png 1430w, /wp-content/uploads/2020/07/signing-the-modified-app-300x18.png 300w, /wp-content/uploads/2020/07/signing-the-modified-app-1024x62.png 1024w, /wp-content/uploads/2020/07/signing-the-modified-app-768x47.png 768w, /wp-content/uploads/2020/07/signing-the-modified-app-205x12.png 205w" sizes="(max-width: 1430px) 100vw, 1430px" /></p>
<p style="text-align: center;">Figure 35: Signing the modified app</p>
<p>Finally, we installed the modified APK onto an Android phone using ADB:</p>
<p><img class="aligncenter size-full wp-image-103644" src="/wp-content/uploads/2020/07/installing-modified-app.png" alt="" width="1430" height="168" srcset="/wp-content/uploads/2020/07/installing-modified-app.png 1430w, /wp-content/uploads/2020/07/installing-modified-app-300x35.png 300w, /wp-content/uploads/2020/07/installing-modified-app-1024x120.png 1024w, /wp-content/uploads/2020/07/installing-modified-app-768x90.png 768w, /wp-content/uploads/2020/07/installing-modified-app-205x24.png 205w" sizes="(max-width: 1430px) 100vw, 1430px" /></p>
<p style="text-align: center;">Figure 36: Installing the modified app</p>
<p>After launching the app and selecting one of our contacts, we were greeted with a pleasant sight:</p>
<p><img class="aligncenter size-full wp-image-103647" src="/wp-content/uploads/2020/07/testing-modified-app.jpg" alt="" width="1080" height="921" srcset="/wp-content/uploads/2020/07/testing-modified-app.jpg 1080w, /wp-content/uploads/2020/07/testing-modified-app-300x256.jpg 300w, /wp-content/uploads/2020/07/testing-modified-app-1024x873.jpg 1024w, /wp-content/uploads/2020/07/testing-modified-app-768x655.jpg 768w, /wp-content/uploads/2020/07/testing-modified-app-151x129.jpg 151w" sizes="(max-width: 1080px) 100vw, 1080px" /></p>
<p style="text-align: center;">Figure 37: Testing the modified app</p>
<p>Furthermore, the change we made did not seem to impact the app’s functionality; we could still make and receive calls, add contacts, etc.</p>
<p>In our view, this was a vulnerability, later denoted by CVE-2020-16168 and having a CVSS score of 6.5. An altered and potentially malicious app could still access the various cloud resources and user information made available to the temi app because no integrity checks were performed by either the app or the remote servers to ensure that the app had not been modified. As we’ll demonstrate later, the presence of this vulnerability made various other attack vectors possible.</p>
<h3><a name="Toc45545109"></a>The Relationship Between Robot IDs and MQTT Topics</h3>
<p>In the overview section, we made the claim that &#8220;each robot has its own MQTT topics that it listens on, which are identified using temi&#8217;s MQTT client ID, otherwise known as its robot ID.” Here we will outline how we came to this conclusion and the specific format of a few of the topics that temi and its phone app subscribe/publish to.</p>
<p>Since we knew that temi uses MQTT to handle calling notifications, a natural place to start our investigation was the code used by the phone app to initiate calls. Moving down the call chain, we saw that the robot ID was being passed to the sendInitInvitation() method of the TelepresenceService class:</p>
<p><img class="aligncenter size-full wp-image-103650" src="/wp-content/uploads/2020/07/InvitationManager.png" alt="" width="975" height="380" srcset="/wp-content/uploads/2020/07/InvitationManager.png 975w, /wp-content/uploads/2020/07/InvitationManager-300x117.png 300w, /wp-content/uploads/2020/07/InvitationManager-768x299.png 768w, /wp-content/uploads/2020/07/InvitationManager-205x80.png 205w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 38: InvitationManagerImpl.sendInitInvitation()</p>
<p>Here, the robot ID is used in two different places. On line 82, an MqttDelegateApi.Topic object is created with the name &#8220;users/&lt;ROBOT_ID&gt;/status&#8221;, <em>implying that each robot has its own MQTT topic category for its status and the robot ID itself is used to uniquely identify these topics</em>. Next, on line 87, we see one of many <a href="https://github.com/ReactiveX/RxJava">RxJava</a> functions (the others have been omitted) with the robot ID passed as a parameter to it. This function’s only purpose is to call InvitationManagerImpl.sendInviteMsg(), passing along the Invitation and the robot ID as its arguments:</p>
<p><img class="aligncenter size-full wp-image-103653" src="/wp-content/uploads/2020/07/invitation-and-robot-ID.png" alt="" width="975" height="743" srcset="/wp-content/uploads/2020/07/invitation-and-robot-ID.png 975w, /wp-content/uploads/2020/07/invitation-and-robot-ID-300x229.png 300w, /wp-content/uploads/2020/07/invitation-and-robot-ID-768x585.png 768w, /wp-content/uploads/2020/07/invitation-and-robot-ID-169x129.png 169w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 39: InvitationManagerImpl.sendInviteMsg()</p>
<p>This function is of particular interest because we see the construction of another MQTT topic name on line 332, this time taking the form &#8220;client/&lt;ROBOT_ID&gt;/invite&#8221;. Presumably, this is the topic format used when publishing call invitations to specific temi robots (and, likely, phone contacts).</p>
<p>Additionally, the anonymous function executed via doOnSuccess() uses MqttManager.publish() (line 359) to actually publish the call invitation on the callee&#8217;s call invite topic. This information would become useful when we later tried to send custom MQTT messages to our temi in order to facilitate privilege escalation.</p>
<h3><a name="Toc45545110"></a>How are MQTT Call Invite Messages Published?</h3>
<p>If we were to publish our own MQTT messages, we would need a robust understanding of the code used by the temi phone app to publish arbitrary MQTT messages, which appears to be this MqttManagerImpl.publish() method.</p>
<p>To determine what was actually being passed to publish(), we needed to go through what each of the RxJava functions in InvitationManagerImpl.sendInviteMsg() was doing. Referring back to <u>Figure 39</u>:</p>
<ul>
<li>On lines 331-339, <a href="http://reactivex.io/documentation/operators/zip.html">Single.zip()</a> is called, which simply creates a Pair from the MQTT topic string (&#8220;client/&lt;ROBOT_ID&gt;/invite&#8221;) and the Invitation object.</li>
<li>On lines 340-355, <a href="http://reactivex.io/documentation/operators/flatmap.html">Single.flatMap()</a> is called, which adds a timestamp to the Invitation object inside the Pair.</li>
<li>Presuming successful execution of the previous flatMap() call, <a href="https://www.oreilly.com/library/view/learning-rxjava/9781787120426/ac721fa0-e59e-4a16-9173-17175a1b83ea.xhtml">Single.doOnSuccess()</a> is called on lines 356-372. As mentioned previously, this is where the call to MqttManagerImpl.publish() occurs. Since this doOnSuccess() operates on the value returned by the previous call to flatMap(), the arguments being passed to publish() are:</li>
</ul>
<table>
<tbody>
<tr>
<td width="361"><strong>Argument</strong></td>
<td width="210"><strong>Description</strong></td>
</tr>
<tr>
<td width="361">(String) pair.first</td>
<td width="210">The MQTT topic string</td>
</tr>
<tr>
<td width="361">new Gson().toJson((Invitation) pair.second)</td>
<td width="210">The Invitation object as JSON</td>
</tr>
<tr>
<td width="361">0</td>
<td width="210">The integer “0”</td>
</tr>
<tr>
<td width="361">false</td>
<td width="210">The boolean “false”</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>While it was obvious that the first argument is the MQTT topic the message is being published on and the second argument is the message itself, it was not immediately obvious what the third and fourth arguments were for. Digging down into the source code of the MQTT package being used (<a href="https://www.eclipse.org/paho/files/javadoc/org/eclipse/paho/client/mqttv3/package-summary.html">org.eclipse.paho.client.mqttv3</a>) revealed their purpose:</p>
<p><img class="aligncenter size-full wp-image-103656" src="/wp-content/uploads/2020/07/purpose.png" alt="" width="975" height="142" srcset="/wp-content/uploads/2020/07/purpose.png 975w, /wp-content/uploads/2020/07/purpose-300x44.png 300w, /wp-content/uploads/2020/07/purpose-768x112.png 768w, /wp-content/uploads/2020/07/purpose-205x30.png 205w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 40: MqttAsyncClient.publish()</p>
<p>After passing through a couple MqttManagerImpl methods, the four arguments listed above become the first four arguments passed to this internal publish() method. The JSON string (second argument), is converted from a string to a byte array in the interim; the rest of the arguments are unchanged.</p>
<p>Knowing this, it was clear that the second argument is indeed the MQTT message, the third argument is the <a href="https://www.hivemq.com/blog/mqtt-essentials-part-6-mqtt-quality-of-service-levels/">QoS</a>, and the fourth argument is a flag that specifies whether or not the message should be <a href="https://www.hivemq.com/blog/mqtt-essentials-part-8-retained-messages/">retained</a>. A QoS value of “0” means that the message will be delivered to clients subscribed to the topic at most once. A retained flag of “false” means that new subscribers to the topic will not receive the most recent published message upon subscription.</p>
<h3><a name="Toc45545111"></a>Intercepting Calls</h3>
<p>As we&#8217;ve already established, every temi robot has a unique MQTT client ID and many of the topics it subscribes to contain this ID to indicate that they are intended for that specific robot. If users of the temi phone app can receive calls in addition to making them, it stands to reason that they must also have a unique MQTT client ID – a robot ID equivalent. If there was an easy way to discover the client ID of another phone app user, it might be possible to subscribe to their topics and thus receive calls intended for them, making it worthy of investigation.</p>
<p>If we refer back to <u>Figure 22</u>, we saw that if a call is initiated from the Recent Calls screen, a method called getMd5PhoneNumber() is used to obtain the client ID of the callee. While a temi doesn’t have a phone number to speak of, we began to suspect that the client ID for users of the temi phone app might just be an MD5 hash of their phone number.</p>
<p>Although we could have followed the code in order to track down exactly where this value comes from, we thought it might be easier to simply verify our suspicions. To do this, we first took the MD5 hash of the temi admin’s phone number and then performed a string search for this hash in every temi-related file we had access to.</p>
<p><img class="aligncenter size-full wp-image-103659" src="/wp-content/uploads/2020/07/Google-Voice-number.png" alt="" width="1080" height="619" srcset="/wp-content/uploads/2020/07/Google-Voice-number.png 1080w, /wp-content/uploads/2020/07/Google-Voice-number-300x172.png 300w, /wp-content/uploads/2020/07/Google-Voice-number-1024x587.png 1024w, /wp-content/uploads/2020/07/Google-Voice-number-768x440.png 768w, /wp-content/uploads/2020/07/Google-Voice-number-205x117.png 205w" sizes="(max-width: 1080px) 100vw, 1080px" /></p>
<p style="text-align: center;">Figure 41: The Google Voice number used to register with temi</p>
<p><img class="aligncenter size-full wp-image-103662" src="/wp-content/uploads/2020/07/MD5-hash-of-the-phone-number.png" alt="" width="1876" height="388" srcset="/wp-content/uploads/2020/07/MD5-hash-of-the-phone-number.png 1876w, /wp-content/uploads/2020/07/MD5-hash-of-the-phone-number-300x62.png 300w, /wp-content/uploads/2020/07/MD5-hash-of-the-phone-number-1024x212.png 1024w, /wp-content/uploads/2020/07/MD5-hash-of-the-phone-number-768x159.png 768w, /wp-content/uploads/2020/07/MD5-hash-of-the-phone-number-1536x318.png 1536w, /wp-content/uploads/2020/07/MD5-hash-of-the-phone-number-205x42.png 205w" sizes="(max-width: 1876px) 100vw, 1876px" /></p>
<p style="text-align: center;">Figure 42: Taking the MD5 hash of the phone number</p>
<p>Sure enough, this hash appeared in two places. First, it appeared in the primary SQLite 3 database file for the temi app running on the robot itself. More specifically, it appears in the “RecentCallModel” table under the “userId” column for the table&#8217;s only entry. Based on the table&#8217;s name and sole entry, this is almost certainly used to store temi&#8217;s recent calls, as its admin was the only user it had called at this point.</p>
<p><img class="aligncenter size-full wp-image-103665" src="/wp-content/uploads/2020/07/matching-string.png" alt="" width="1320" height="288" srcset="/wp-content/uploads/2020/07/matching-string.png 1320w, /wp-content/uploads/2020/07/matching-string-300x65.png 300w, /wp-content/uploads/2020/07/matching-string-1024x223.png 1024w, /wp-content/uploads/2020/07/matching-string-768x168.png 768w, /wp-content/uploads/2020/07/matching-string-205x45.png 205w" sizes="(max-width: 1320px) 100vw, 1320px" /></p>
<p style="text-align: center;">Figure 43: The matching string in temi&#8217;s RecentCallModel table, part of its SQLite 3 Database</p>
<p>The second match was in the log output we saved after running logcat on our temi earlier, the same log output seen in <u>Figure 30</u>:</p>
<p><img class="aligncenter size-full wp-image-103668" src="/wp-content/uploads/2020/07/matching-strings.png" alt="" width="975" height="240" srcset="/wp-content/uploads/2020/07/matching-strings.png 975w, /wp-content/uploads/2020/07/matching-strings-300x74.png 300w, /wp-content/uploads/2020/07/matching-strings-768x189.png 768w, /wp-content/uploads/2020/07/matching-strings-205x50.png 205w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 44: Matching strings in the logcat output recorded earlier</p>
<p>This log output appears to conclusively confirm our suspicions. With what we knew now, these log messages appeared to be JSON data being sent to/received from the MQTT broker. Moreover, the &#8220;topic&#8221; string in the first result exactly matched the MQTT topic format string found on line 82 of <u>Figure 38</u>. The only difference is that in that case, the string between “users/” and “/status” was the robot ID; here, it was an MD5 hash of the user’s phone number.</p>
<p>Since we now knew that</p>
<ol>
<li>temi robots and phone app users received calls on the topic &#8220;client/&lt;CLIENT_ID&gt;/invite&#8221;, where &#8220;&lt;CLIENT_ID&gt;&#8221; is the MQTT client ID of the callee,</li>
<li>the MQTT client ID for phone app users was simply an MD5 hash of the phone number used to register with the app, and</li>
<li>we could alter the existing phone app,</li>
</ol>
<p>it stood to reason that we could modify the app to subscribe to another user’s call invite topic in order to intercept calls intended for that user as long as we knew the user’s phone number. In theory, this would allow an attacker to effectively impersonate another user and spy on them by intercepting their calls. The question then became: What code needs to be modified in order to get this to happen? Well, we&#8217;re looking at a situation where temi initiates a call with its admin and an attacker attempts to intercept that call. In the case of calls initiated by the phone app, we discovered that call invitations are sent via InvitationManagerImpl.sendInviteMsg(), which publishes the call invite message on the topic &#8220;client/&lt;ROBOT ID&gt;/invite&#8221;. We suspected a similar approach was being used when a call is initiated from a temi to a phone user and decided to investigate to confirm.</p>
<p>Luckily for us, the exact same InvitationManagerImpl.sendInviteMsg() method could be found in the temi robot’s code, and it even seemed to function identically. Thus, it was probably safe to assume that the robot initiates calls with phone users in the same way: by publishing a call invitation to the topic &#8220;client/&lt;CLIENT ID&gt;/invite&#8221;, CLIENT_ID being the MQTT client ID of the callee.</p>
<p>If the caller publishes their call invites to a certain MQTT topic, it follows that the callee must subscribe to that same topic to receive the invite. Now that we knew the format of the call invite topic, the next step was to track down the code used by the Android app to subscribe to this topic so we could alter it to subscribe to the temi admin&#8217;s topic instead.</p>
<p>Performing a string search for this pattern in the decompiled phone app&#8217;s code produced three unique results:</p>
<p><img class="aligncenter size-full wp-image-103674" src="/wp-content/uploads/2020/07/45.png" alt="" width="1430" height="189" srcset="/wp-content/uploads/2020/07/45.png 1430w, /wp-content/uploads/2020/07/45-300x40.png 300w, /wp-content/uploads/2020/07/45-1024x135.png 1024w, /wp-content/uploads/2020/07/45-768x102.png 768w, /wp-content/uploads/2020/07/45-205x27.png 205w" sizes="(max-width: 1430px) 100vw, 1430px" /></p>
<p style="text-align: center;">Figure 45: Searching for &#8220;client/.+/invite&#8221;</p>
<p>The second result we recognized as being part of the code used to generate an outgoing call invitation. Thus, we were only interested in the first and third results.</p>
<p>We began by looking at the first result, found on line 170 of InvitationManagerImpl.java:</p>
<p><img class="aligncenter size-full wp-image-103677" src="/wp-content/uploads/2020/07/46.png" alt="" width="624" height="190" srcset="/wp-content/uploads/2020/07/46.png 624w, /wp-content/uploads/2020/07/46-300x91.png 300w, /wp-content/uploads/2020/07/46-205x62.png 205w" sizes="(max-width: 624px) 100vw, 624px" /></p>
<p style="text-align: center;">Figure 46: InvitationManagerImpl.sendInviteAbortMsg()</p>
<p>This reference is part of the method InvitationManagerImpl.sendInvitationAbortMsg(). Since we were interested in the code that subscribes to the call invite topic and not the code that publishes messages to it, we moved on.</p>
<p>The third result was found on line 523 of MqttManagerImpl.java:</p>
<p><img class="aligncenter size-full wp-image-103680" src="/wp-content/uploads/2020/07/47.png" alt="" width="1430" height="128" srcset="/wp-content/uploads/2020/07/47.png 1430w, /wp-content/uploads/2020/07/47-300x27.png 300w, /wp-content/uploads/2020/07/47-1024x92.png 1024w, /wp-content/uploads/2020/07/47-768x69.png 768w, /wp-content/uploads/2020/07/47-205x18.png 205w" sizes="(max-width: 1430px) 100vw, 1430px" /></p>
<p style="text-align: center;">Figure 47: MqttManagerImpl.buildInviteTopic()</p>
<p>This didn’t tell us anything about how the generated topic is used, so we took a step back and looked at what code invokes this method:</p>
<p><img class="aligncenter size-full wp-image-103683" src="/wp-content/uploads/2020/07/48.png" alt="" width="975" height="674" srcset="/wp-content/uploads/2020/07/48.png 975w, /wp-content/uploads/2020/07/48-300x207.png 300w, /wp-content/uploads/2020/07/48-768x531.png 768w, /wp-content/uploads/2020/07/48-187x129.png 187w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 48: MqttManagerImpl.lambda$initMqttClient$13()</p>
<p>The call to buildInviteTopic() can be seen on line 408. There&#8217;s a lot going on in this method, but at a high level it appears that it is responsible for setting the callback functions for the MqttManager, which are being defined inline. More specifically, the invite topic string generated by buildInviteTopic() is used in the connectComplete() callback function, where it is passed as the first parameter to MqttManagerImpl.subscribe().</p>
<p>As expected, MqttManager&#8217;s subscribe() method is used to a subscribe to a particular MQTT topic, with the first parameter being the topic string:</p>
<p><img class="size-full wp-image-103686 aligncenter" src="/wp-content/uploads/2020/07/49.png" alt="" width="975" height="408" srcset="/wp-content/uploads/2020/07/49.png 975w, /wp-content/uploads/2020/07/49-300x126.png 300w, /wp-content/uploads/2020/07/49-768x321.png 768w, /wp-content/uploads/2020/07/49-205x86.png 205w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 49: MqttMangerImpl.subscribe()</p>
<p>Thus, it appeared that we had found the code being used to subscribe to the call invite MQTT topic. Based on these findings, we decided the simplest approach would be to change the call to MqttManagerImpl.subscribe() on line 408 of <u>Figure 48</u> – instead of passing it the topic string returned by MqttManagerImpl.buildInviteTopic(), we would instead hard-code it to pass the temi admin&#8217;s call invite MQTT topic string.</p>
<p>Using this approach, we were able to construct a modified temi phone app that would receive all calls intended for another user, as shown in the following video:</p>
<p align="center"><iframe src="https://www.youtube.com/embed/dyHcxiZ_z9E" width="560" height="315" frameborder="0" allowfullscreen="allowfullscreen"></iframe></p>
<p>Here, the vulnerability was the lack of any authentication when publishing or subscribing to arbitrary topics, denoted by CVE-2020-16167 and having a CVSS score of 8.6. At a minimum, a check should have been made to ensure that clients cannot subscribe to another client’s topics.</p>
<h3><a name="Toc45545112"></a>Problem: temi Won’t Answer My Calls</h3>
<p>Our next goal was to gain the ability initiate a call with a temi and have it automatically answer. As mentioned previously, this capability is typically reserved for the temi’s admin and users explicitly authorized by the admin. Thus, if an attacker wishes to spy on a temi user, they would need to trick temi into thinking the call is originating from one of these authorized users.</p>
<p>With no other leads, we began searching through the robot’s codebase for keywords related to user permissions, ownership, admin, etc. until we found a very promising enum class:</p>
<p><img class="aligncenter size-full wp-image-103689" src="/wp-content/uploads/2020/07/class-used.png" alt="" width="975" height="254" srcset="/wp-content/uploads/2020/07/class-used.png 975w, /wp-content/uploads/2020/07/class-used-300x78.png 300w, /wp-content/uploads/2020/07/class-used-768x200.png 768w, /wp-content/uploads/2020/07/class-used-205x53.png 205w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 50: Class used for delineating the various roles held by temi&#8217;s users</p>
<p>This enum is used in com.roboteam.teamy.users.User, the class used to store information about individual temi users, with User.role being an object of the Role enum class:</p>
<p><img class="aligncenter size-full wp-image-103692" src="/wp-content/uploads/2020/07/51.png" alt="" width="975" height="338" srcset="/wp-content/uploads/2020/07/51.png 975w, /wp-content/uploads/2020/07/51-300x104.png 300w, /wp-content/uploads/2020/07/51-768x266.png 768w, /wp-content/uploads/2020/07/51-205x71.png 205w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 51: Class used to describe individual temi users/contacts</p>
<p>Going back to <u>Figure 50</u>, if we assume that Role.ADMIN refers to the user that originally registered temi and that Role.CONTACT refers to a normal user, then Role.OWNER likely refers to a user that has been authorized to &#8220;hop in&#8221; to the robot by the admin. To verify this, we looked for places in the code where this enum is used. There are 59 unique references to the Role class, but we&#8217;ll only be looking at the pertinent ones here.</p>
<p>The first reference we’ll be looking at appears on lines 351 and 357 of ConferencePresenter.handleViewForCallTypes():</p>
<p><img class="aligncenter size-full wp-image-103695" src="/wp-content/uploads/2020/07/52.png" alt="" width="975" height="548" srcset="/wp-content/uploads/2020/07/52.png 975w, /wp-content/uploads/2020/07/52-300x169.png 300w, /wp-content/uploads/2020/07/52-768x432.png 768w, /wp-content/uploads/2020/07/52-205x115.png 205w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 52: ConferencePresenter.handleViewForCallTypes()</p>
<p>On line 351, a string comparison is performed between this.resourcesLoader.getString(R.string.privacy_support_support_caller_name) and this.callerDisplayName; if the two match, a new User is created with a role of CONTACT. So just what is this string that the ‘if’ statement is checking against? We decided to take a look at where this constant is defined:</p>
<p><img class="aligncenter size-full wp-image-103698" src="/wp-content/uploads/2020/07/53.png" alt="" width="975" height="73" srcset="/wp-content/uploads/2020/07/53.png 975w, /wp-content/uploads/2020/07/53-300x22.png 300w, /wp-content/uploads/2020/07/53-768x58.png 768w, /wp-content/uploads/2020/07/53-205x15.png 205w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 53: Searching for &#8220;privacy_support_support_caller_name&#8221;</p>
<p>Taken together, this means that if the caller&#8217;s display name is exactly &#8220;Support&#8221;, a new User is created with CONTACT privileges. This check likely exists in the event that a member of temi&#8217;s support staff calls a user. While this was certainly interesting, it is a niche scenario.</p>
<p>What happens if the caller&#8217;s name is not &#8220;Support&#8221;? In that case, the else statement on line 352 is hit, which simply sets user to the result of getUserbyPeerId():</p>
<p><img class="aligncenter size-full wp-image-103701" src="/wp-content/uploads/2020/07/54.png" alt="" width="975" height="268" srcset="/wp-content/uploads/2020/07/54.png 975w, /wp-content/uploads/2020/07/54-300x82.png 300w, /wp-content/uploads/2020/07/54-768x211.png 768w, /wp-content/uploads/2020/07/54-205x56.png 205w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 54: ConferencePresenter.getUserByPeerId()</p>
<p>This method tries to obtain the User associated with the current caller by performing a lookup in temi&#8217;s UsersRepository using the caller&#8217;s MQTT client ID. If the lookup succeeds, the found User is returned; if it fails, a new User is created with Role.CONTACT privileges.</p>
<p>As mentioned previously, <u>Figure 52</u> contains two references to the Role class. Let&#8217;s now look at the second reference, found on line 357. Here, the role of the user is checked. If they are either an ADMIN or an OWNER, temi:</p>
<ul>
<li>waits 1.5 seconds (line 362)</li>
<li>checks if the call hasn&#8217;t already ended (line 365)</li>
<li>if it hasn&#8217;t, answers the incoming call (line 370)</li>
</ul>
<p>Otherwise, the function returns after setting the app&#8217;s view for an incoming call.</p>
<h2><a name="Toc45545113"></a>Solution: Become an OWNER</h2>
<p>To recap what we&#8217;ve learned thus far:</p>
<ul>
<li>The role of ADMIN appears to be reserved for the user that originally registers temi via QR code scan.</li>
<li>If the user calling temi <em><u>is not</u></em> recognized, a new User object is created for them with CONTACT privileges.</li>
<li>If the user calling temi <em><u>is</u></em> recognized, their role is checked:
<ul>
<li>If they are a CONTACT, temi waits for the call to be answered via touchscreen.</li>
<li>If they are either an ADMIN or an OWNER, temi answers the call automatically<strong>. This is the behavior we want.</strong></li>
</ul>
</li>
</ul>
<p>Scanning the temi&#8217;s QR code for the purposes of registration is only possible when temi is first powered on or after performing a factory reset. Thus, the attacker cannot realistically make themselves an ADMIN. And since CONTACT privileges are insufficient to get temi to pick up automatically, our best bet was to figure out how to obtain the role of OWNER.</p>
<h3><a name="Toc45545114"></a>Adding an OWNER: Phone App’s Perspective</h3>
<p>Although we knew that it was possible to promote a user to an OWNER using the phone app and we <em>suspected</em> that was achieved via MQTT, we still weren’t sure of what goes on “under the hood” to make that happen.</p>
<p>After some searching, we found that AddOwnersPresenter.addOwners() is called whenever an admin selects one or more users to be granted OWNER privileges:</p>
<p><img class="aligncenter size-full wp-image-103704" src="/wp-content/uploads/2020/07/55.png" alt="" width="975" height="254" srcset="/wp-content/uploads/2020/07/55.png 975w, /wp-content/uploads/2020/07/55-300x78.png 300w, /wp-content/uploads/2020/07/55-768x200.png 768w, /wp-content/uploads/2020/07/55-205x53.png 205w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 55: AddOwnersPresenter.addOwners(), trimmed</p>
<p>Here, selectedIds refers to the MQTT client IDs of the users selected to be promoted and robotId refers to the MQTT client ID of the temi robot this method is granting permissions for.</p>
<p>The majority of this method’s body has been trimmed because we’re really only concerned with what’s happening on lines 104-106, which seems to handle sending the request to add an OWNER – the rest of the method is dedicated to logging and updating local databases to reflect the new OWNERs.</p>
<p>This request is sent by first fetching the unique private key used to identify this app’s instance (line 101), and then creating a new AddRemoveOwnersRequest using the selectedIds, robotId, and this private key:</p>
<p><img class="aligncenter size-full wp-image-103707" src="/wp-content/uploads/2020/07/56.png" alt="" width="1430" height="1316" srcset="/wp-content/uploads/2020/07/56.png 1430w, /wp-content/uploads/2020/07/56-300x276.png 300w, /wp-content/uploads/2020/07/56-1024x942.png 1024w, /wp-content/uploads/2020/07/56-768x707.png 768w, /wp-content/uploads/2020/07/56-140x129.png 140w" sizes="(max-width: 1430px) 100vw, 1430px" /></p>
<p style="text-align: center;">Figure 56: AddRemoveOwnersRequest</p>
<p>The constructor for AddRemoveOwnersRequest creates a timestamp for the request, then creates a new AddOwnersRequestRequest, which contains the body of the request, and finally uses the passed in privateKey in order generate a signature for the AddOwnersRequestRequest. In other words, AddRemoveOwnersRequest is nothing more than a wrapper for the real request and is used to store its signature.</p>
<p>We decided to look at this AddOwnersRequestRequest object next. While the ownerIds, robotId, and timestamp members were mostly self-explanatory, source and type were less so. Looking back at line 8, we saw that source was being set to a hardcoded value of “ADMIN”, which seemed to imply that this was the origin of the request. Looking back at line 6, we saw that type is simply the passed in OwnersRequestType enum (in our case, OWNERS_ADD_TYPE) converted to a string. This enum, defined near the bottom of the class, can take on two values: OWNERS_ADD_TYPE and OWNERS_REMOVE_TYPE. This implied that this same structure was recycled for requests meant to demote OWNERs back to CONTACTs.</p>
<p>Thus, we determined that AddRemoveOwnersRequests had the following structure:</p>
<p><img class="aligncenter size-full wp-image-103710" src="/wp-content/uploads/2020/07/57.png" alt="" width="721" height="114" srcset="/wp-content/uploads/2020/07/57.png 721w, /wp-content/uploads/2020/07/57-300x47.png 300w, /wp-content/uploads/2020/07/57-205x32.png 205w" sizes="(max-width: 721px) 100vw, 721px" /></p>
<p style="text-align: center;">Figure 57: Anatomy of an AddRemoveOwnersRequest</p>
<p>Now that we knew the structure of these requests, we next wanted to know how they were being sent and where. To this end, we decided to look at OwnersApi.addOwners(), which, according to <u>Figure 55</u>, is actually sending the AddRemoveOwnersRequest.</p>
<p><img class="aligncenter size-full wp-image-103713" src="/wp-content/uploads/2020/07/58.png" alt="" width="975" height="353" srcset="/wp-content/uploads/2020/07/58.png 975w, /wp-content/uploads/2020/07/58-300x109.png 300w, /wp-content/uploads/2020/07/58-768x278.png 768w, /wp-content/uploads/2020/07/58-205x74.png 205w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 58: OwnersApi.addOwners()</p>
<p>The body of this method didn’t tell us much, but the imports for the OwnersApi class gave us a clue: this was using the <a href="https://square.github.io/retrofit/">Retrofit 2 HTTP Client for Android</a>, which is typically used to send HTTP requests to a REST API. According to <a href="https://code.tutsplus.com/tutorials/sending-data-with-retrofit-2-http-client-for-android--cms-27845">this Retrofit tutorial</a>, the @POST annotation “indicates that we want to execute a POST request when this method is called” and “the argument value for the @POST annotation is the endpoint.” The @Body annotation, on the other hand, indicates that we want the AddRemoveOwnersRequest to serve as the body of the POST request.</p>
<p>Okay, so this method is simply sending the request to add an OWNER via POST to some REST server at the endpoint “ownership/admin/add/owners”. Our next question became: Where is this REST server located?</p>
<p>Part 5 of that same Retrofit tutorial told us that the getClient() method is typically used to obtain/create a Retrofit instance, and the only argument it takes is a string containing the URL for the REST server. Searching for “getClient()” in the phone app’s code led us to ApiClient.getClient():</p>
<p><img class="aligncenter size-full wp-image-103716" src="/wp-content/uploads/2020/07/59.png" alt="" width="1430" height="128" srcset="/wp-content/uploads/2020/07/59.png 1430w, /wp-content/uploads/2020/07/59-300x27.png 300w, /wp-content/uploads/2020/07/59-1024x92.png 1024w, /wp-content/uploads/2020/07/59-768x69.png 768w, /wp-content/uploads/2020/07/59-205x18.png 205w" sizes="(max-width: 1430px) 100vw, 1430px" /></p>
<p style="text-align: center;">Figure 59: ApiClient.getClient()</p>
<p>Working backwards from this method, we were able to track down the server’s URL:</p>
<p><img class="aligncenter size-full wp-image-103719" src="/wp-content/uploads/2020/07/URLs-for-MQTT-broker-and-REST-server.png" alt="" width="624" height="56" srcset="/wp-content/uploads/2020/07/URLs-for-MQTT-broker-and-REST-server.png 624w, /wp-content/uploads/2020/07/URLs-for-MQTT-broker-and-REST-server-300x27.png 300w, /wp-content/uploads/2020/07/URLs-for-MQTT-broker-and-REST-server-205x18.png 205w" sizes="(max-width: 624px) 100vw, 624px" /></p>
<p style="text-align: center;">Figure 60: URLs for the MQTT broker and REST server</p>
<p>This URL confirmed that the recipient of this request was <em>not</em> the temi robot and it was <em>not</em> being sent via MQTT, contrary to our initial assumptions. This begged the question: If the phone app wasn’t sending these requests to temi, how was temi being notified of any updates to the privileges of its users? We hypothesized that this REST server was simply a middleman whose job was to authenticate all requests to add/remove OWNERs by checking the request’s signature against the admin’s public key that was saved during temi’s initial registration process. This extra level of authentication made sense since privilege management was a particularly sensitive functionality. Presumably, this same REST server would then forward the request to the robot if it determined that the request’s signature was valid.</p>
<p>We took some time trying to send these requests from a user that wasn’t temi’s admin, but they failed, lending some credence to our theory. This was looking like a dead end.</p>
<h3><a name="Toc45545115"></a>Adding an OWNER: temi’s Perspective</h3>
<p>Well, if we couldn’t successfully spoof the request the phone app sends to the REST server, perhaps we could instead spoof the request the server sends to temi, bypassing the authentication mechanism altogether. We started looking for the code temi used to handle these requests.</p>
<p>Searching specifically for &#8220;Role.OWNER&#8221; in the temi&#8217;s decompiled code led us to OwnersController$getUsersRepository$2.apply():</p>
<p><img class="aligncenter size-full wp-image-103722" src="/wp-content/uploads/2020/07/61.png" alt="" width="975" height="227" srcset="/wp-content/uploads/2020/07/61.png 975w, /wp-content/uploads/2020/07/61-300x70.png 300w, /wp-content/uploads/2020/07/61-768x179.png 768w, /wp-content/uploads/2020/07/61-205x48.png 205w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 61: OwnersController$getUsersRepository$2.apply()</p>
<p>Starting with OwnersController$getUsersRepository$2, we moved up the call chain in an attempt to discover how temi processes requests to add OWNERs. More concretely, this was accomplished through a liberal use of the &#8220;Find Usage&#8221; feature in JADX, which can be done by simply right-clicking virtually any symbol. Although convenient, &#8220;Find Usage&#8221; would often fail when the method in question was not invoked directly, such as when an implementation of an abstract class/interface served as the middleman. In such cases, we would perform a string search for instances where the method was invoked in the smali code. To help separate invocations from declarations, we took advantage of the smali syntax for method calls, which consisted of the name of the class the method belonged to, followed by a right arrow (-&gt;), followed by the method&#8217;s signature.</p>
<p>As an example, &#8220;Find Usage&#8221; failed for the accept() method of the class UsersAdminTopicListener$listenToUserAdminTopic$1, so to find where it&#8217;s invoked, we ran:</p>
<p><img class="aligncenter size-full wp-image-103725" src="/wp-content/uploads/2020/07/62.png" alt="" width="1430" height="128" srcset="/wp-content/uploads/2020/07/62.png 1430w, /wp-content/uploads/2020/07/62-300x27.png 300w, /wp-content/uploads/2020/07/62-1024x92.png 1024w, /wp-content/uploads/2020/07/62-768x69.png 768w, /wp-content/uploads/2020/07/62-205x18.png 205w" sizes="(max-width: 1430px) 100vw, 1430px" /></p>
<p style="text-align: center;">Figure 62: Searching for UsersAdminTopicListener$listenToUserAdminTopic$1.accept() in the smali code</p>
<p>For especially indirect invocations, like dependency injection, more creative means had to be used, but a combination of &#8220;Find Usage&#8221; and string searches such as these got us 99% of the way there.</p>
<p>Using this approach, we found that the mechanism begins with the UsersAdminTopicListener class, which, as the name suggests, handles listening on temi&#8217;s “users admin” topic. Moving down the call chain from here, we found out how messages received on this topic are processed by temi and ultimately used to alter the Role, or privilege level, of certain contacts. Based on our earlier analysis, it was likely that the REST server would forward the request sent by the phone app to this MQTT topic.</p>
<p>We found that the bulk of the work is performed by a method called listenToUserAdminTopic():</p>
<p><img class="aligncenter size-full wp-image-103728" src="/wp-content/uploads/2020/07/63.png" alt="" width="1430" height="373" srcset="/wp-content/uploads/2020/07/63.png 1430w, /wp-content/uploads/2020/07/63-300x78.png 300w, /wp-content/uploads/2020/07/63-1024x267.png 1024w, /wp-content/uploads/2020/07/63-768x200.png 768w, /wp-content/uploads/2020/07/63-205x53.png 205w" sizes="(max-width: 1430px) 100vw, 1430px" /></p>
<p style="text-align: center;">Figure 63: UsersAdminTopicListener.listenToUserAdminTopic()</p>
<p>This function does several things. First, on line 50, it creates a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> object by calling UsersAdminTopicListener.getOwnerRequestFlowable(). Next, on lines 51-56, it subscribes to this Flowable and for each emitted OwnersRequest, it calls OwnersController.handle$app_usaDemoRelease() upon success or simply logs upon failure.</p>
<p>We decided to first look at the code for getOwnerRequestFlowable():</p>
<p><img class="aligncenter size-full wp-image-103731" src="/wp-content/uploads/2020/07/64.png" alt="" width="1430" height="722" srcset="/wp-content/uploads/2020/07/64.png 1430w, /wp-content/uploads/2020/07/64-300x151.png 300w, /wp-content/uploads/2020/07/64-1024x517.png 1024w, /wp-content/uploads/2020/07/64-768x388.png 768w, /wp-content/uploads/2020/07/64-205x104.png 205w" sizes="(max-width: 1430px) 100vw, 1430px" /></p>
<p style="text-align: center;">Figure 64: UsersAdminTopicListener.getOwnerRequestFlowable()</p>
<ul>
<li>It begins by first converting an Observable obtained via mqttPipeline.observe() into a Flowable.</li>
<li>Next, it throws out all emitted MqttMessages whose topic doesn&#8217;t match the regex &#8220;users/.+/admin&#8221; via <a href="http://reactivex.io/documentation/operators/filter.html">RxJava&#8217;s filter() method</a>.</li>
<li><a href="http://reactivex.io/documentation/operators/map.html">RxJava&#8217;s map() method</a> is then used convert the body of the MqttMessage from JSON to an object of the OwnersMessage</li>
<li>Finally, map() is used a second time to extract and return the OwnersRequest from each OwnersMessage.</li>
</ul>
<p>At this point, we decided it would be useful to understand the structure of OwnersRequests and OwnersMessages, since these seem to be key to temi’s privilege management mechanisms:</p>
<p><img class="aligncenter size-full wp-image-103734" src="/wp-content/uploads/2020/07/anatomy-of-an-OwnersMessage.png" alt="" width="601" height="94" srcset="/wp-content/uploads/2020/07/anatomy-of-an-OwnersMessage.png 601w, /wp-content/uploads/2020/07/anatomy-of-an-OwnersMessage-300x47.png 300w, /wp-content/uploads/2020/07/anatomy-of-an-OwnersMessage-205x32.png 205w" sizes="(max-width: 601px) 100vw, 601px" /></p>
<p style="text-align: center;">Figure 65: Anatomy of an OwnersMessage</p>
<p>Put briefly, each OwnersMessage is nothing more than a wrapper for an OwnersRequest, which consists of ownerIds, a list of the MQTT client IDs of the users whose privileges are being modified, and type, which indicates whether the request is trying to promote a CONTACT to an OWNER (OWNERS_ADD) or demote an OWNER back to a CONTACT (OWNERS_REMOVE).</p>
<p>Comparing this to <u>Figure 57</u>, an OwnersMessage appears to be an AddRemoveOwnersRequest without the signature. Similarly, an OwnersRequest appears to be a stripped-down AddOwnersRequestRequest, with the robotId, source, and timestamp omitted. This meshes well with our earlier hypothesis that the REST server’s job is to authenticate and forward AddRemoveOwnersRequests to the temi robot. The signature, timestamp, and source would be omitted since they’ve already been verified by the server; the robotId, while needed by the server to know where to forward the request, becomes redundant once the request reaches temi.</p>
<p>Our next step was to figure out what handle$app_usaDemoRelease() does. Since it’s quite the rabbit hole, however, we will summarize its effects in lieu of venturing down it:</p>
<ol>
<li>It queries the Users table in temi’s local database for all users with IDs matching any of the ones in the OwnersRequest’s ownerIds</li>
<li>It replaces the Role for each of these users with one corresponding to the OwnersRequest’s type: OWNERS_ADD→ OWNER, OWNERS_REMOVE → CONTACT.</li>
<li>It updates temi’s Users table with the updated user information.</li>
</ol>
<p>This was promising, since it meant that we could potentially trick temi into promoting an arbitrary user/contact to an OWNER simply by crafting a custom OwnersRequest and publishing it on temi&#8217;s &#8220;users/&lt;ROBOT_ID&gt;/admin&#8221; topic, thereby bypassing the authentication server entirely.</p>
<p>Unfortunately, part 1 above reveals a potential obstacle for this plan: since temi will only process OwnersRequests for users already present in its local Users table, we must first add ourselves to this table for this strategy to succeed. Recalling our earlier analysis of how temi handles unrecognized callers, one way of accomplishing this was to simply cold call temi, which would cause it to automatically add the caller to its contacts list. This was far from ideal, however, since cold calling  temi without already having the role of OWNER or ADMIN would cause it to ring and display the caller&#8217;s username on its screen, potentially alerting temi’s users that something weird is going on.</p>
<h3><a name="Toc45545116"></a>Detour: Sneaking Onto temi’s Contact List</h3>
<p>Before continuing on, we decided to take a brief detour to find a better way for an attacker to add themselves to temi’s contact list.</p>
<p>From our prior investigation into how temi implements its various privilege levels through the use of Roles, we discovered that temi uses the User class to define its various users. Thus, it follows that any code used to add a new user to temi&#8217;s local contact list would first create a new User object, so that&#8217;s exactly what we searched for.</p>
<p><img class="aligncenter size-full wp-image-103737" src="/wp-content/uploads/2020/07/searching-temi-code.png" alt="" width="1430" height="189" srcset="/wp-content/uploads/2020/07/searching-temi-code.png 1430w, /wp-content/uploads/2020/07/searching-temi-code-300x40.png 300w, /wp-content/uploads/2020/07/searching-temi-code-1024x135.png 1024w, /wp-content/uploads/2020/07/searching-temi-code-768x102.png 768w, /wp-content/uploads/2020/07/searching-temi-code-205x27.png 205w" sizes="(max-width: 1430px) 100vw, 1430px" /></p>
<p style="text-align: center;">Figure 66: Searching temi&#8217;s code for &#8220;new User(&#8220;, trimmed</p>
<p><u>Figure 66</u> shows the result that we followed up on, the others have been omitted. The name of the containing class, SyncContactsController, sounded promising on its own since syncing contacts from temi’s ADMIN would likely involve adding new contacts without needing to start a call, which was exactly what we were trying to do.</p>
<p>Using largely the same strategy we employed for tracing the code flow for adding OWNERs (JADX&#8217;s &#8220;Find Usage&#8221; feature + grepping the smali code), we were able to trace the code flow all the way back to the app&#8217;s entry point. With a more holistic understanding of the mechanism used to sync contacts, we realized that the process is ultimately kicked off by SyncContactsTopicListener.subscribeMqttPipeline():</p>
<p><img class="aligncenter size-full wp-image-103740" src="/wp-content/uploads/2020/07/67.png" alt="" width="975" height="435" srcset="/wp-content/uploads/2020/07/67.png 975w, /wp-content/uploads/2020/07/67-300x134.png 300w, /wp-content/uploads/2020/07/67-768x343.png 768w, /wp-content/uploads/2020/07/67-205x91.png 205w" sizes="(max-width: 975px) 100vw, 975px" /></p>
<p style="text-align: center;">Figure 67: SyncContactsTopicListener.subscribeMqttPipeline()</p>
<p>The first thing this method does is take this.mqttPipeline and turns it first into an <a href="http://reactivex.io/documentation/observable.html">Observable </a>(using MqttPipeline.observe()) and then into a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> (using RxJavaInterop.toV2Flowable()), as seen on lines 29 and 30.</p>
<p>Essentially, this.mqttPipeline acts as a relay. Incoming MQTT messages are pushed to the relay using its push() method, which it then relays to all its observers.</p>
<p>The output of this relay is then filtered on lines 31-38 to only return MQTT messages received on topics matching the regex &#8220;synccontacts/.+&#8221;. Based on the other MQTT topic strings we&#8217;ve seen up to this point –</p>
<ul>
<li>&#8220;users/&lt;CLIENT_ID&gt;/status&#8221;</li>
<li>&#8220;users/&lt;CLIENT_ID&gt;/admin&#8221;</li>
<li>&#8220;client/&lt;CLIENT_ID&gt;/invite&#8221;</li>
</ul>
<p>– we were fairly certain temi’s client ID goes after the forward slash. Thus, temi appeared to be listening on the MQTT topic “synccontacts/&lt;CLIENT_ID&gt;” for messages regarding contact synchronization.</p>
<p>On lines 39-43, the now-filtered MQTT messages emitted by the relay are passed to a call to RxJava&#8217;s <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html#map-io.reactivex.functions.Function-">map()</a> function, which converts each incoming MQTT message from JSON to an object of the SyncContactsMessage class. We quickly determined that SyncContactsMessages had the following structure:</p>
<p style="text-align: center;"><img class="aligncenter size-full wp-image-103743" src="/wp-content/uploads/2020/07/68.png" alt="" width="401" height="94" srcset="/wp-content/uploads/2020/07/68.png 401w, /wp-content/uploads/2020/07/68-300x70.png 300w, /wp-content/uploads/2020/07/68-205x48.png 205w" sizes="(max-width: 401px) 100vw, 401px" /><br />
Figure 68: Anatomy of a SyncContactsMessage</p>
<p>Put briefly, each SyncContactsMessage consisted of a senderClientId, a string holding the MQTT client ID of the request’s sender, and contacts, a list of ContactEntry objects. Each ContactEntry object in the list corresponded to a contact to be synced to temi’s contact list, containing both their clientId and their name.</p>
<p>Finally, on lines 45-49, SyncContactsController.save() would be called on each SyncContactsMessage spit out by the prior call to map():</p>
<p><img class="aligncenter size-full wp-image-104385" src="/wp-content/uploads/2020/07/69.png" alt="" width="1430" height="1131" srcset="/wp-content/uploads/2020/07/69.png 1430w, /wp-content/uploads/2020/07/69-300x237.png 300w, /wp-content/uploads/2020/07/69-1024x810.png 1024w, /wp-content/uploads/2020/07/69-768x607.png 768w, /wp-content/uploads/2020/07/69-163x129.png 163w" sizes="(max-width: 1430px) 100vw, 1430px" /></p>
<p style="text-align: center;">Figure 69: SyncContactsController.save()</p>
<p>This method is doing a lot, but we’ll focus on only the most pertinent side-effects:</p>
<ul>
<li>On lines 53-62, <strong>all messages where the </strong><strong>senderClientId</strong><strong> does not match the temi admin&#8217;s client ID are discarded</strong>. This will become important later.</li>
<li>On lines 63-75, the list of contacts is extracted from the SyncContactsMessage and is used to build a list of User objects – one per contact. The Users produced by this method are initialized in the following manner:</li>
</ul>
<table>
<tbody>
<tr>
<td width="120"><strong>Member</strong></td>
<td width="300"><strong>Assigned Value</strong></td>
</tr>
<tr>
<td width="120">User.id</td>
<td width="300">ContactEntry.clientId</td>
</tr>
<tr>
<td width="120">User.name</td>
<td width="300">ContactEntry.name</td>
</tr>
<tr>
<td width="120">User.picUrl</td>
<td width="300">&#8220;&#8221;</td>
</tr>
<tr>
<td width="120">User.role</td>
<td width="300">Role.CONTACT</td>
</tr>
<tr>
<td width="120">User.userId</td>
<td width="300">SyncContactsMessage.senderClientId</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<ul>
<li>On lines 81-85, our newly-minted list of User objects is passed to insertOrUpdateContact(). This method writes the list of Users to the Users table in temi’s SQLite 3 database, completely overwriting temi’s old contacts list in the process.</li>
</ul>
<p>So now that we knew how an ADMIN’s contacts are synced to their temi, how could we leverage that knowledge to add ourselves to temi’s contact list in a discrete fashion? Well, if we could publish a message to temi&#8217;s synccontacts MQTT topic, we could add ourselves as a contact. Although temi does perform a check to make sure that the sender of the message is its ADMIN, it makes the mistake of trusting that the contents of the message accurately reflect the actual sender. In theory, there&#8217;s nothing stopping us from publishing a SyncContactsMessage from one client ID and setting the senderClientId field in the message to a completely different ID – the ADMIN&#8217;s client ID, for example.</p>
<p>Based on our understanding of how the temi robot parses MQTT requests to sync contacts, we crafted a JSON message that should decode into a valid SyncContactsMessage object and would add our &#8220;attack&#8221; phone to temi&#8217;s contacts:</p>
<p><img class="aligncenter size-full wp-image-103746" src="/wp-content/uploads/2020/07/70.png" alt="" width="1430" height="87" srcset="/wp-content/uploads/2020/07/70.png 1430w, /wp-content/uploads/2020/07/70-300x18.png 300w, /wp-content/uploads/2020/07/70-1024x62.png 1024w, /wp-content/uploads/2020/07/70-768x47.png 768w, /wp-content/uploads/2020/07/70-205x12.png 205w" sizes="(max-width: 1430px) 100vw, 1430px" /></p>
<p style="text-align: center;">Figure 70: Our custom SyncContactsMessage in JSON format</p>
<p>This message was crafted using the following rationale:</p>
<ol>
<li>Objects in JSON are indicated via curly braces (<strong>{}</strong>). Since the entire message contents are being converted into a single SyncContactsMessageobject, it follows that the contents should be contained within a pair of curly braces, representing the SyncContactsMessage object itself.</li>
<li>A SyncContactsMessagecontains a senderClientId, a string indicating the client ID of the &#8220;sender&#8221; of the message. Thus, we added an element to our object with the key &#8220;senderClientId&#8221; and the string &#8220;060f62296e1ab8d0272b623f2f08f915&#8221; – the client ID of the temi&#8217;s admin – as its value.</li>
<li>A SyncContactsMessagealso contains contacts, a list of ContactEntry Thus, we added an element with the key &#8220;contacts&#8221; and a new list as its value. In JSON, lists are indicated via square brackets (<strong>[]</strong>).</li>
<li>In our case, the contacts list contains only a single ContactEntry – one corresponding to the &#8220;attack&#8221; phone, so we added a single pair of curly braces to the list to indicate the contents of this single ContactEntry.</li>
<li>Each ContactEntry contains a clientId. Thus, we added an element to the object with the key &#8220;clientId&#8221; and the string &#8220;fe5d7af42433f0b6fb6875b6d640931b&#8221; – the client ID of the &#8220;attack&#8221; phone – as its value.</li>
<li>Each ContactEntry also contains a name. Thus, we added a second element to the object with the key &#8220;name&#8221; and the string &#8220;Test&#8221; as its value. This simply represents the display name for the contact, so we could set it to basically whatever we liked.</li>
<li>As for spacing and newlines, we referred to the <a href="https://github.com/google/gson/blob/master/UserGuide.md">Gson User Guide</a>, since that’s the library temi was using to perform JSON serialization/deserialization. The guide states:</li>
</ol>
<p>“The default JSON output that is provided by Gson is a compact JSON format. This means that there will not be any whitespace in the output JSON structure. Therefore, there will be no whitespace between field names and its value, object fields, and objects within arrays in the JSON output.&#8221;</p>
<p>As a result, whitespace and newlines have been omitted.</p>
<p>Now that we understood where to publish the request and what the request should look like, the next step was figuring out how to alter the temi phone app to send this request. Since we were aiming for a simple proof-of-concept, we prioritized ease and speed of implementation over robustness or elegance when considering which code to change. To this end, it made sense to leverage the code already present in the app that was dedicated to publishing MQTT messages since it would minimize the amount of code we needed to change and thus reduce the risk of introducing unintended bugs into our altered app – an ever-present risk when directly modifying an app&#8217;s bytecode. While the phone app publishes many MQTT messages to various topics during its runtime, we decided to try using the phone app&#8217;s video calling functionality. This had the obvious advantage of giving us clear control over when and how often the MQTT message is published, since calls are always initiated by hitting the &#8220;Connect&#8221; or &#8220;Call&#8221; buttons. Ultimately, we decided to leverage InvitationManagerImpl.sendInviteMsg() for this purpose. If we refer back to <u>Figure 39</u> and our section “How are MQTT Call Invite Messages Published?”, the reason for this becomes apparent: sendInviteMsg() has a direct interface to MqttManagerImpl.publish(), the underlying method temi uses to publish arbitrary MQTT messages, while still being specific to the call chain for outgoing video calls. This meant that it would only get executed unless when we manually initiated a call from the app.</p>
<p>Running our altered app resulted in our attack phone being added to temi’s contact list, as shown in the following video:</p>
<p align="center"><iframe src="https://www.youtube.com/embed/cR0NkxBUisA" width="560" height="315" frameborder="0" allowfullscreen="allowfullscreen"></iframe></p>
<h3><a name="Toc45545117"></a>Gaining OWNER Privileges</h3>
<p>All that was left was for us to craft and publish a custom OwnersMessage in order to gain OWNER privileges on our temi. As before, we began by crafting the JSON for the message itself:</p>
<p><img class="aligncenter size-full wp-image-103749" src="/wp-content/uploads/2020/07/71.png" alt="" width="1430" height="87" srcset="/wp-content/uploads/2020/07/71.png 1430w, /wp-content/uploads/2020/07/71-300x18.png 300w, /wp-content/uploads/2020/07/71-1024x62.png 1024w, /wp-content/uploads/2020/07/71-768x47.png 768w, /wp-content/uploads/2020/07/71-205x12.png 205w" sizes="(max-width: 1430px) 100vw, 1430px" /></p>
<p style="text-align: center;">Figure 71: Our custom OwnersMessage in JSON format</p>
<p>This message was crafted using the following rationale:</p>
<ol>
<li>Since the entire message contents are being converted into a single OwnersMessage object, it follows that the contents should be contained within a pair of curly braces, representing the OwnersMessage object itself.</li>
<li>An OwnersMessage contains a request, an object of the OwnersRequest class, and nothing else. Thus, we added an element with the key &#8220;request&#8221; and a new object as its value. The contents of this inner object will become our OwnersRequest.</li>
<li>An OwnersRequest contains a type, an enum specifying the type of request. In our case we want to add an OWNER, so we added an element with the key &#8220;type&#8221; and the string &#8220;OWNERS_ADD&#8221; as its value. As for why we&#8217;re expressing this enum value as a string, it&#8217;s because <a href="https://futurestud.io/tutorials/gson-advanced-mapping-of-enums">this article</a> shows that Gson&#8217;s default behavior is to express enum values as strings corresponding to the name of the enum value.</li>
<li>An OwnersRequest also contains ownerIds, a list of strings enumerating the temi contacts the request should apply to. In our case, the list contains only a single ID – the ID of the &#8220;attack&#8221; phone, which is just the MD5 hash of its phone number.</li>
<li>As before, spaces and newlines have been omitted, per the Gson User Guide.</li>
</ol>
<p>Fortunately, we were able to leverage the code modifications we used to publish our SyncContactsMessage, since the only things changing were the MQTT topic we’re publishing to and the contents of the message.</p>
<p>Our full test consisted of running our first modified app in order to add ourselves to temi’s contact list, followed by our second modified app in order to perform privilege escalation, as shown in the following video:</p>
<p align="center"><iframe src="https://www.youtube.com/embed/56JoHb4bioI" width="560" height="315" frameborder="0" allowfullscreen="allowfullscreen"></iframe></p>
<p>The call appeared to be fully functional, and we were able to drive temi around, navigate to its saved locations, and receive its audio/video feeds. All an attacker needed to make this possible was the phone number of one of temi’s contacts.</p>
<p>This authentication bypass was the final and most impactful vulnerability we discovered in the temi robot, denoted by CVE-2020-16169 and having a CVSS score of 9.4. To better understand how this an auth bypass, let’s compare temi’s privilege management during normal operation:</p>
<p><img class="aligncenter size-full wp-image-103752" src="/wp-content/uploads/2020/07/privilege-management.png" alt="" width="1169" height="591" srcset="/wp-content/uploads/2020/07/privilege-management.png 1169w, /wp-content/uploads/2020/07/privilege-management-300x152.png 300w, /wp-content/uploads/2020/07/privilege-management-1024x518.png 1024w, /wp-content/uploads/2020/07/privilege-management-768x388.png 768w, /wp-content/uploads/2020/07/privilege-management-205x104.png 205w" sizes="(max-width: 1169px) 100vw, 1169px" /></p>
<p style="text-align: center;">Figure 72: temi&#8217;s privilege management during normal operation</p>
<p>to how it looks using our modified app:</p>
<p><img class="aligncenter size-full wp-image-103755" src="/wp-content/uploads/2020/07/modified-app.png" alt="" width="1169" height="451" srcset="/wp-content/uploads/2020/07/modified-app.png 1169w, /wp-content/uploads/2020/07/modified-app-300x116.png 300w, /wp-content/uploads/2020/07/modified-app-1024x395.png 1024w, /wp-content/uploads/2020/07/modified-app-768x296.png 768w, /wp-content/uploads/2020/07/modified-app-205x79.png 205w" sizes="(max-width: 1169px) 100vw, 1169px" /></p>
<p style="text-align: center;">Figure 73: temi&#8217;s privilege management with auth bypass</p>
<p>As you can see, although authentication <em>is</em> in place for adding OWNERs, it can be circumvented entirely by simply spoofing the MQTT message temi expects to receive from the REST server post-authentication.</p>
<h2><a name="Toc45545118"></a>Refining the Exploits</h2>
<p>Once our exploits had the capabilities we initially set out to obtain, we got to work refining them. We created a single modified app that combined all of the MQTT attack vectors we previously outlined: it could intercept calls and send both MQTT messages necessary to obtain OWNER privileges, all with a single button press. Furthermore, we added some additional logic to automatically extract the client IDs required by our custom MQTT messages from the app’s contact list, meaning our app would work on any temi robot. To see all these features in action, please refer to the video below:</p>
<p align="center"><iframe src="https://www.youtube.com/embed/_YKs31sotB0" width="560" height="315" frameborder="0" allowfullscreen="allowfullscreen"></iframe></p>
<h2><a name="Toc45545119"></a>Impact</h2>
<p>At this point it would be prudent to take a step back, review the combined capabilities of the exploits we’ve outlined, and consider what impact these might have in a real-world setting.</p>
<p>At the time of discovery, the vulnerabilities in the temi robot meant that an attacker could join any ongoing temi call simply by using a custom Agora app initialized with temi’s hardcoded App ID and iterating over all 900,000 possible channel names – certainly feasible with modern computing power. This becomes more plausible if one considers that our testing revealed that joining a temi call this way does not notify either of the existing call participants that another user is present, since the apps were only designed with 1-on-1 calling in mind. The fact that the attacker needs no information on the victims makes this attack vector worrisome, but it also means that the attacker has no control over who he or she spies on using this method. Realistically, a malicious actor might use this exploit as a means of reconnaissance – by collecting data on arbitrary temi users, they could follow up on the more “promising” ones later with one of the targeted attack vectors. Given temi’s limited adoption by consumers but ramping adoption in industries such as healthcare, the odds are in the attacker’s favor that they stumble upon sensitive information.</p>
<p>Furthermore, if an attacker has a specific victim in mind, they could leverage the lack of per-topic authentication in temi’s MQTT implementation in order to intercept calls between a user and their temi. The plausibility of this particular attack vector is difficult to evaluate. On the one hand, the only information the attacker needs is the victim’s phone number, and telemarketers consistently remind us that this is a very low bar. On the other hand, this exploit’s behavior during our testing proved somewhat inconsistent. At times, the user running the exploit could listen in on the call as a third party with the call participants being none the wiser. At other times, the user running the exploit would disconnect the original caller and take their place. It is easy to imagine scenarios where both of these outcomes are desirable to a malicious actor, and neither bodes well for the privacy of the user being targeted. It is also important to note that although we focused on using this vulnerability to intercept calls, it can also be used to intercept all sorts of notifications intended for another user: contacts being added, when temi goes online/offline, its current location, etc. While less flashy than intercepting a call, this approach is more discreet and might allow a dedicated attacker to learn a user’s routine, only showing their hand to listen in when it would be most impactful.</p>
<p>Of the possible attack vectors, we believe that the ability to call and control a temi remotely, leveraging the authentication bypass present in temi’s privilege management mechanism, is the most impactful. The bar for this attack vector is arguably even lower than the previous, as the attacker would only need the phone number of <em>any</em> of temi’s contacts – it need not be its admin. In our testing, none of the steps involved in leveraging this exploit notify temi’s admin in any way that something is amiss; they are not notified that the attacker has added themselves to the robot’s contact list nor that they have gained raised privileges. Since this method does not cause temi to ring, an observer would have to see the attacker move temi or have a good look at its touchscreen during the attack to know something nefarious was going on. This level of control and subtlety becomes especially problematic when we consider some of temi’s applications in industry. In April of this year, Robotemi Global Ltd. stepped up production to 1,000 units per month in response to <a href="https://www.calcalistech.com/ctech/articles/0,7340,L-3809114,00.html">Israel’s Ministries of Defense and Health choosing temi to assist with patients in their COVID-19 wards</a>. In South Korea, <a href="https://jewishnews.timesofisrael.com/how-israeli-health-tech-is-helping-combat-coronavirus/">temi sees use in both public places and nursing homes</a>, helping to facilitate social distancing. Besides the obvious impact of compromising patients’ sensitive medical information during remote doctor’s visits, the ability to have eyes and ears into a hospital is worrying in its own right. It isn’t difficult to imagine what a malicious agent might do with an overheard network password, access code to a sensitive area, or the location and condition of a person of interest.</p>
<h2><a name="Toc45545120"></a>Conclusion</h2>
<p>The findings outlined in this paper highlight the importance of secure coding practices and security auditing for cutting edge technologies, particularly in the IoT space. When an IoT camera evolves into one that can also drive around your home or business and even assist medical patients, the need to properly secure who can access it only becomes more important. While history has demonstrated that any sufficiently complex software is bound to have vulnerabilities, there are many steps we can take to substantially raise the bar for bad actors. In our view, these responsibilities are shared between vendors, consumers, and the security industry as a whole.</p>
<p>First and foremost, vendors can ensure they are employing proper security hygiene when designing products. Often, best practices consist not of novel, out-of-the-box thinking, but rather adopting time-tested guidelines like the <em>principle of least privilege</em>. In the case of temi, application of this principle likely would have addressed CVE-2020-16167, which allows clients to subscribe/publish to topics they have no business accessing. Considerations for security should also extend beyond the development phase, with third-party security auditing being a powerful tool that allows vendors to discover and patch vulnerabilities before the bad guys get ahold of them. Taking vulnerability disclosure seriously and cooperating with the bodies that report them can often net similar benefits, and this is an area Robotemi excelled in.</p>
<p>Consumers of these technologies, at either the individual or enterprise level, also share some of the responsibility. Companies should ideally vet all technologies before widespread adoption, particularly if these technologies have access to customer information. It goes without saying that greater risk warrants greater scrutiny. Individuals, while typically having fewer resources, can also take certain precautions. Placing IoT devices on a VLAN, a virtually segregated subnetwork, reduces the risk that a vulnerability in one device will compromise your entire network. Staying up to date on important vulnerabilities can also help inform consumers’ purchasing decisions, although the presence of vulnerabilities is often less illuminating than if/how a company chooses to address them.</p>
<p>Finally, we in the security industry also have an obligation towards moving the needle in the realm of security, one that we hope research such as this embodies. One of our goals here at McAfee ATR is to identify and illuminate a broad spectrum of threats in today’s complex and constantly evolving landscape. While we take seriously our obligation to inform vendors of our findings in a timely and responsible fashion, it is only through cooperation that the best results are possible. Our partnership with Robotemi on addressing these vulnerabilities was a perfect example of this. They responded quickly to our private disclosure report, outlined to us their plans for mitigations and an associated timeline, and maintained a dialogue with us throughout the whole process. We even received feedback that they have further emphasized security in their products by approaching all development discussions with a security-first mindset as a result of this disclosure. The ultimate result is a product that is more secure for all who use it.</p>
        </div>
    </div>

    <div class="wrap-section">  
        <div class="container medium">
            <h3>About the Author</h3>
        </div>
    </div>

    <div class="wrap-section padding-small bg-light-gray author-container">  
        <div class="container medium"> 


                <div class="row">
                    <div class="col-sm-2 col-xs-4 text-center">
                        <a href="/blogs/author/mark-bereza/"><img class="author" src="/wp-content/uploads/2019/08/headshot-267x300.png" /></a>
                        <ul class="social-networks">
                <li><a href="https://twitter.com/@ROPsicle" rel="nofollow" target="_blank"><i class="symbol-twitter"></i><span>Twitter</span></a></li><li><a href="https://www.linkedin.com/in/mark-bereza/" rel="nofollow" target="_blank"><i class="symbol-linkedin"></i><span>LinkedIn</span></a></li>                        </ul>
                    </div>
                    <div class="col-sm-10 col-xs-8">
                        <h3 class="red"><a href="/blogs/author/mark-bereza/">Mark Bereza</a></h3>
                        <p>Mark Bereza is a Security Researcher and recent addition to McAfee's Advanced Threat Research team. An alumnus of Oregon State University's CS systems program, Mark's work has focused on vulnerability discovery and exploit development for embedded systems.</p>						
                        <a href="/blogs/author/mark-bereza/" class="caret-link">Read more posts from Mark Bereza </a>
                    </div>
                </div><br/>
                                    </div>
    </div>

    <div class="wrap-section padding-top-xs">  
        <div class="container medium"> 
            <div class="row">
                            <div class="col-sm-6 col-xs-6">
            <a href="/blogs/languages/francais/technologie-mcafee-utile-pour-vous-aider-a-proteger-votre-vie-en-ligne/" rel="prev"><i class="fa fa-angle-left" aria-hidden="true"></i> Previous Article</a> 
                </div>
                <div class="col-sm-6 col-xs-6 text-right">
<a href="/blogs/other-blogs/mcafee-labs/robot-character-analysis-reveals-trust-issues/" rel="next">Next Article <i class="fa fa-angle-right" aria-hidden="true"></i></a>                </div>
            </div>
        </div>
    </div>
    <div class="wrap-section padding-top-xs"> 
        <div class="container medium">
                    <p class="small rule">Categories: <a href="/blogs/other-blogs/mcafee-labs/" rel="category tag">McAfee Labs</a><br /> 
            </p>	

        </div>		 
    </div>
    <div class="container medium">
                    <ol class="commentlist">
                    </ol>
             
    </div>
    
    <div class="wrap-section padding-top-small">  
        <div class="container medium">
                                </div>
    </div>
        <div class="wrap-section bg-red bg-image padding-medium" id="subscribe">
      <div class="container medium">
        <div class="row">
          <div class="col-sm-12">
            <div class="cta-component text-center">
              <h3>Subscribe to McAfee Securing Tomorrow Blogs</h3>
                         <form method="get" action="/blogs/subscribe/" class="form-inline">
            
              <input type="text" placeholder="Email address" name="subscriber_email" />
          
            <button type="submit" class="btn transparent">Subscribe</button>
          </form>
              
            </div>
          </div>
        </div>
      </div>
    </div>

</main>
<!--Footer of en-us starts here --> 
    
	<aside class="tools">
		<a href="#wrapper" class="back-to-top">Back to top</a>
	</aside>
  
  <div class="textwidget custom-html-widget"><div class="wrap-section padding-bottom-medium padding-top-small bg-dark-gray" id="footer">
    <div class="container medium">           
      <div class="row">
         <div class="col-sm-6 breadcrumb">
        	<ul class="breadcrumb-list">
        		<li><a class="symbols-label first" href="/blogs"><i class="symbol-shield"></i><span>McAfee Home</span></a></li>
        		<li><a class="symbols-label" href="/blogs"><i class="symbol-arrow-forward"></i><span>Securing Tomorrow</span></a></li>
					 </ul>
				</div>
        <div class="col-sm-6 social">
          <!-- <a id="usbl-integrated-button" class="symbols-label" href=""><i class="symbol-feedback"></i><span>Feedback</span></a> -->
          <ul class="social-networks">
            <li><a href="https://twitter.com/mcafee" title="Twitter" target="_blank" rel="noopener noreferrer"><i class="symbol-twitter"></i><span>Twitter</span></a></li>
            <li><a href="http://www.facebook.com/mcafee" title="Facebook" target="_blank" rel="noopener noreferrer"><i class="symbol-facebook"></i><span>Facebook</span></a></li>
            <li><a href="https://www.linkedin.com/company/2336?trk=prof-exp-company-name" title="LinkedIn" target="_blank" rel="noopener noreferrer"><i class="symbol-linkedin"></i><span>LinkedIn</span></a></li>
            <li><a href="http://www.youtube.com/mcafee" title="YouTube" target="_blank" rel="noopener noreferrer"><i class="symbol-youtube"></i><span>YouTube</span></a></li>
            <li><a href="/blogs/" title="Blog" target="_blank" rel="noopener noreferrer"><i class="symbol-blog"></i><span>Blog</span></a></li>
					</ul>
        </div>
      </div>
      <hr />
      <div class="row">
        <div class="col-sm-3">
          <a class="symbols-label" href="/enterprise/en-us/about/region-selector.html"><i class="symbol-language"></i><span>United States / English</span></a>
        </div>
        <div class="col-sm-9">
           <a href="//www.scanalert.com/RatingVerify?ref=www.mcafee.com" target="_blank" class="mcafee-secure" rel="noopener noreferrer"><img src="https://www.mcafee.com/enterprise/en-us/img/v1/common/logo-mcafee-secure.svg" alt="McAfee SECURE"/></a>
          <ul class="footer-menu">
            <li><a href="/enterprise/en-us/about/legal/privacy.html">Privacy</a></li>
            <li><a href="/enterprise/en-us/about/legal/notices.html">Legal Notices</a></li>
            <li><a href="/enterprise/en-us/about/legal/contracts-terms.html">Legal Contracts &amp; Terms</a></li>
            <li><a href="/enterprise/en-us/site-map.html">Site Map</a></li>
            <li>Copyright ©2020 McAfee, LLC</li>
          </ul>
        </div>
      </div>          
    </div>            	
  </div>
</div></div>


</body>	
<script type="text/javascript">
   if ($('div.author-block .meta').length > 0) {
      utag_data.tm_local_blogs_author = $('div.author-block .meta').text().split(' on ')[0].replace("By","").trim();
    }
    (function(a,b,c,d){
    a='//tags.tiqcdn.com/utag/mcafee/consumer-main/prod/utag.js'; // Note: Please use prod for production version and dev for dev version before release
    b=document;c='script';d=b.createElement(c);d.src=a;d.type='text/java'+c;d.async=true;
    a=b.getElementsByTagName(c)[0];a.parentNode.insertBefore(d,a);
    })();
</script>

<script type='text/javascript' src='/wp-content/plugins/metronet-profile-picture/js/mpp-frontend.js?ver=2.3.8'></script>
<script type='text/javascript'>
/* Highlight Search Terms 1.5 ( RavanH - http://status301.net/wordpress-plugins/highlight-search-terms/ ) */
var hlst_query = []; var hlst_areas = ["#groups-dir-list","#members-dir-list","div.bbp-topic-content,div.bbp-reply-content,li.bbp-forum-info,.bbp-topic-title,.bbp-reply-title","article","div.hentry","div.post","#content","#main","div.content","#middle","#container","div.container","div.page","#wrapper","body"];
</script>
<script type='text/javascript' src='/wp-content/plugins/highlight-search-terms/hlst-extend.min.js?ver=1.5'></script>
<script type='text/javascript' src='/wp-content/plugins/social-polls-by-opinionstage/public/js/shortcodes.js?ver=19.6.31'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpmm_object = {"ajax_url":"https:\/\/www.mcafee.com\/wp-admin\/admin-ajax.php","wpmm_responsive_breakpoint":"767px","wpmm_disable_mobile":"false"};
/* ]]> */
</script>
<script type='text/javascript' src='/wp-content/plugins/wp-megamenu/assets/js/wpmm.js?ver=1.3.1'></script>
<script type='text/javascript' src='/wp-content/themes/securingtomorrow/js/theme-script.js?ver=5.4.2'></script>
<script type='text/javascript' src='/wp-content/themes/securingtomorrow/js/skip-link-focus-fix.min.js?ver=20151215'></script>
<script type='text/javascript' src='/wp-content/plugins/super-socializer/js/front/social_login/general.js?ver=7.12.37'></script>
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=5.4.2'></script>
	
<script src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js?ver=10faaf528e636a046163bdb6753031b2"></script>
<script src="/wp-content/themes/securingtomorrow/js/jquery-lib.js"></script>
<script src="/wp-content/themes/securingtomorrow/js/main.js"></script>
<script src="/wp-content/themes/securingtomorrow/js/general_footer.js"></script>
<!-- Consumer Facebook Pixel Code -->
<script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '187610925152304');
  fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=187610925152304&ev=PageView&noscript=1"/></noscript>
<!-- End Facebook Pixel Code -->

<!-- Start linkedIn pixel -->
<script type="text/javascript">
_linkedin_partner_id = "68395";
window._linkedin_data_partner_ids = window._linkedin_data_partner_ids || [];
window._linkedin_data_partner_ids.push(_linkedin_partner_id);
</script><script type="text/javascript">
(function(){var s = document.getElementsByTagName("script")[0];
var b = document.createElement("script");
b.type = "text/javascript";b.async = true;
b.src = "https://snap.licdn.com/li.lms-analytics/insight.min.js";
s.parentNode.insertBefore(b, s);})();
</script>
<noscript>
<img height="1" width="1" style="display:none;" alt="" src="https://dc.ads.linkedin.com/collect/?pid=68395&fmt=gif" />
</noscript>
<!-- End linkedIn pixel -->

<!-- Twitter universal website tag code -->
<script>
!function(e,t,n,s,u,a){e.twq||(s=e.twq=function(){s.exe?s.exe.apply(s,arguments):s.queue.push(arguments);
},s.version='1.1',s.queue=[],u=t.createElement(n),u.async=!0,u.src='//static.ads-twitter.com/uwt.js',
a=t.getElementsByTagName(n)[0],a.parentNode.insertBefore(u,a))}(window,document,'script');
// Insert Twitter Pixel ID and Standard Event data below
twq('init','nxlgc');
twq('track','PageView');
</script>
<!-- Twitter universal website tag code -->

<script>
/* <![CDATA[ */
var google_conversion_id = 975085349;
var google_custom_params = window.google_tag_params;
var google_remarketing_only = true;
/* ]]> */
document.write('\x3Cscript type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js">\x3C/script>');
//document.write('\x3Cnoscript>\x3Cimg height="1" width="1" style="border-style:none;display:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/975085349/?guid=ON&script=0"/>\x3C/noscript>');
</script>

<!-- Enterprise Facebook Pixel Code -->
<script>
// load Facebook
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '766537420057144');
fbq('track', "PageView");

//document.write('\x3Cnoscript>\x3Cimg height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=766537420057144&ev=PageView&noscript=1" />\x3C/noscript>');
</script>
<!-- Facebook Pixel Code -->

<!-- Adobe Launch START -->
<script src="//assets.adobedtm.com/launch-ENc117a6a508e14a879398dd6f37ed54a3.min.js"></script>
<!-- Adobe Launch END -->
<script>_satellite.pageBottom()</script>
</html>


<style>
    .commentlist {
        display: none;
    }
</style>
<!-- This website is like a Rocket, isn't it? Performance optimized by WP Rocket. Learn more: https://wp-rocket.me - Debug: cached@1616227653 -->