<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="google-site-verification" content="RHQeasQqjasbRt5asY6atZYbs5tr10gFBevDt2HRhW0" />
<link rel="pingback" href="https://nakedsecurity.sophos.com/xmlrpc.php">
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5VK6LTK');</script>
<!-- End Google Tag Manager -->

<meta name="description" content="SophosLabs gets under the skin of the bad guys&#039; latest attempt to drop ransomware on to your PCs" />
<meta name="keywords" content="malware, microsoft, pdf, phishing, ransomware, security threats, sophoslabs, spam, windows, exploits, microsoft excel, microsoft office, microsoft word, sophoslabs, vba, visual basic for applications" />
<title>Wolf in sheep&#8217;s clothing: a SophosLabs investigation into delivering malware via VBA &#8211; Naked Security</title>
<meta name='robots' content='max-image-preview:large' />
<!-- Jetpack Site Verification Tags -->
<meta name="google-site-verification" content="I9dHFo-YhnK2MfAHn-20V4GnWrOttVUYyISGamyU41M" />
<meta name="msvalidate.01" content="7D8D1FA2892142B1543D2CBCD07FB88F" />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel='dns-prefetch' href='//v0.wordpress.com' />
<link rel="alternate" type="application/rss+xml" title="Naked Security &raquo; Feed" href="https://nakedsecurity.sophos.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Naked Security &raquo; Comments Feed" href="https://nakedsecurity.sophos.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Naked Security &raquo; Wolf in sheep&#8217;s clothing: a SophosLabs investigation into delivering malware via VBA Comments Feed" href="https://nakedsecurity.sophos.com/2017/05/31/wolf-in-sheeps-clothing-a-sophoslabs-investigation-into-delivering-malware-via-vba/feed/" />
<link rel='stylesheet' id='all-css-0' href='https://nakedsecurity.sophos.com/_static/??-eJyVz00KwjAQhuELmUwqttCFeJY0GUw0f2QmlN6+KXbnRpcD7wPfwFqETyY0iwSGCKwnhiVk8xbBL1XXDYi3gDL6JHtwgS5MToyJgR3G7igXlynhSuKqhvEE/8QiaEbiX80xVFvJrqJm4VqPq9SxfPnYRAnt6RPBC7no/tUsP/68D/KI92Eaxtuk1Kx2dxVjDA==' type='text/css' media='all' />
<style id='wp-block-library-inline-css'>
.has-text-align-justify{text-align:justify;}
</style>
<script type='text/javascript' src='https://nakedsecurity.sophos.com/_static/??-eJzTLy/QzcxLzilNSS3WzwKiwtLUokoopZebmaeXVayjj0+Rbm5melFiSSpUsX2uraGZoamxkaGpqXEWAK9AIhg='></script>
<link rel="https://api.w.org/" href="https://nakedsecurity.sophos.com/wp-json/" /><link rel="alternate" type="application/json" href="https://nakedsecurity.sophos.com/wp-json/wp/v2/posts/371433" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://nakedsecurity.sophos.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://nakedsecurity.sophos.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.7" />
<link rel="canonical" href="https://nakedsecurity.sophos.com/2017/05/31/wolf-in-sheeps-clothing-a-sophoslabs-investigation-into-delivering-malware-via-vba/" />
<link rel='shortlink' href='https://nakedsecurity.sophos.com/?p=371433' />
<link rel="alternate" type="application/json+oembed" href="https://nakedsecurity.sophos.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fnakedsecurity.sophos.com%2F2017%2F05%2F31%2Fwolf-in-sheeps-clothing-a-sophoslabs-investigation-into-delivering-malware-via-vba%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://nakedsecurity.sophos.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fnakedsecurity.sophos.com%2F2017%2F05%2F31%2Fwolf-in-sheeps-clothing-a-sophoslabs-investigation-into-delivering-malware-via-vba%2F&#038;format=xml" />
<style type='text/css'>img#wpstats{display:none}</style><link rel="amphtml" href="https://nakedsecurity.sophos.com/2017/05/31/wolf-in-sheeps-clothing-a-sophoslabs-investigation-into-delivering-malware-via-vba/amp/">
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Wolf in sheep&#8217;s clothing: a SophosLabs investigation into delivering malware via VBA" />
<meta property="og:url" content="https://nakedsecurity.sophos.com/2017/05/31/wolf-in-sheeps-clothing-a-sophoslabs-investigation-into-delivering-malware-via-vba/" />
<meta property="og:description" content="SophosLabs gets under the skin of the bad guys&#8217; latest attempt to drop ransomware on to your PCs" />
<meta property="article:published_time" content="2017-05-31T17:27:24+00:00" />
<meta property="article:modified_time" content="2017-06-01T12:11:24+00:00" />
<meta property="og:site_name" content="Naked Security" />
<meta property="og:image" content="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/shutterstock_527898781.jpg?w=775" />
<meta property="og:image:secure_url" content="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/shutterstock_527898781.jpg?w=775" />
<meta property="og:image:width" content="775" />
<meta property="og:image:height" content="405" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:site" content="@NakedSecurity" />
<meta name="twitter:text:title" content="Wolf in sheep&#8217;s clothing: a SophosLabs investigation into delivering malware via VBA" />
<meta name="twitter:image" content="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/shutterstock_527898781.jpg?w=640" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="fb:admins" content="28552295016" />

<!-- End Jetpack Open Graph Tags -->
<link rel="icon" href="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/03/cropped-sophos.png?w=32" sizes="32x32" />
<link rel="icon" href="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/03/cropped-sophos.png?w=192" sizes="192x192" />
<link rel="apple-touch-icon" href="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/03/cropped-sophos.png?w=180" />
<meta name="msapplication-TileImage" content="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/03/cropped-sophos.png?w=270" />
</head>
<body class="post-template-default single single-post postid-371433 single-format-standard" >
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5VK6LTK"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<div style="display: none">
<svg>
	<symbol id="sophos" viewBox="0 0 132 24">
		<path d="m111.82 22.176h11.64c3.267 0 4.65-0.2 5.74-0.896 1.715-1.063 2.804-3.26 2.804-5.62 0-1.928-0.658-3.89-1.647-4.888-1.288-1.33-3.035-1.828-6.271-1.828h-3.527c-1.586 0-2.754-0.067-3.412-0.365-0.794-0.367-1.256-1.165-1.256-2.161 0-1.165 0.56-2.03 1.486-2.264 0.692-0.163 1.498-0.163 3.574-0.198h10.419v-3.956h-11.473c-2.574 0-3.727 0.099-4.718 0.466-2.279 0.796-3.828 3.257-3.828 6.083 0 1.93 0.76 3.727 2.079 4.89 1.155 0.996 2.872 1.462 5.51 1.462h4.697c1.057 0 1.915 0.132 2.376 0.398 0.893 0.433 1.418 1.328 1.418 2.36 0 0.864-0.395 1.597-1.087 2.027-0.561 0.369-1.517 0.534-3.268 0.534h-11.256zm-111.35 0h11.64c3.267 0 4.652-0.2 5.741-0.896 1.714-1.063 2.803-3.26 2.803-5.62 0-1.928-0.66-3.89-1.65-4.888-1.285-1.33-3.034-1.828-6.27-1.828h-3.527c-1.584 0-2.751-0.067-3.41-0.365-0.792-0.367-1.253-1.165-1.253-2.161 0-1.165 0.56-2.03 1.484-2.264 0.693-0.163 1.496-0.163 3.574-0.198h10.42v-3.956h-11.477c-2.573 0-3.727 0.099-4.715 0.466-2.278 0.796-3.83 3.257-3.83 6.083 0 1.93 0.762 3.727 2.08 4.89 1.155 0.996 2.871 1.462 5.51 1.462h4.696c1.057 0 1.913 0.132 2.377 0.398 0.888 0.433 1.416 1.328 1.416 2.36 0 0.864-0.394 1.597-1.089 2.027-0.558 0.369-1.517 0.534-3.264 0.534h-11.256v3.956zm94.05-16.18c-0.68 1.076-1.003 2.803-1.003 5.122 0 5.088 1.747 7.405 5.63 7.405 3.822 0 5.568-2.317 5.568-7.34 0-5.092-1.715-7.373-5.568-7.373-2.102 0-3.754 0.784-4.627 2.186zm13.174-2.511c1.329 1.761 2.072 4.63 2.072 7.992 0 3.816-1.197 6.948-3.334 8.677-1.619 1.304-4.078 2.022-6.995 2.022-4.142 0-7.41-1.372-9.092-3.817-1.263-1.793-1.88-4.176-1.88-7.08 0-4.172 1.133-7.339 3.27-9.035 1.682-1.37 4.339-2.122 7.383-2.122 3.85 0 6.925 1.209 8.576 3.363zm-22.018-3.068h-4.596v8.908h-8.319v-8.908h-4.597v21.759h4.597v-8.97h8.318v8.97h4.596v-21.759zm-28.61 10.277c1.23 0 1.941-0.163 2.427-0.62 0.581-0.49 0.938-1.533 0.938-2.74 0-1.436-0.58-2.478-1.584-2.838-0.356-0.13-0.94-0.197-1.684-0.197h-6.344v6.395zm-6.247 11.481h-4.598v-21.758h10.78c3.786 0 5.114 0.39 6.538 1.991 1.264 1.37 1.942 3.163 1.942 5.088 0 2.284-0.904 4.404-2.394 5.676-1.262 1.077-2.43 1.402-4.888 1.402h-7.38zm-22.589-16.179c-0.682 1.076-1.004 2.803-1.004 5.122 0 5.088 1.748 7.405 5.634 7.405 3.818 0 5.568-2.317 5.568-7.34 0-5.092-1.716-7.373-5.568-7.373-2.106 0-3.757 0.784-4.63 2.186zm13.174-2.511c1.328 1.761 2.073 4.63 2.073 7.992 0 3.816-1.2 6.948-3.335 8.677-1.618 1.304-4.079 2.022-6.993 2.022-4.144 0-7.413-1.372-9.096-3.817-1.264-1.793-1.878-4.176-1.878-7.08 0-4.172 1.133-7.339 3.272-9.035 1.681-1.37 4.337-2.122 7.38-2.122 3.851 0 6.93 1.209 8.578 3.363z"></path>
	</symbol>
	<symbol id="twitter" viewBox="0 0 24 24">
 		<path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"></path>
 	</symbol>
	<symbol id="facebook" viewBox="0 0 24 24">
 		<path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"></path>
 	</symbol>
	<symbol id="instagram" viewBox="0 0 24 24">
		<path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"></path>
	</symbol>
	<symbol id="linkedin" viewBox="0 0 24 24">
		<path d="M4.98 3.5c0 1.381-1.11 2.5-2.48 2.5s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zm.02 4.5h-5v16h5v-16zm7.982 0h-4.968v16h4.969v-8.399c0-4.67 6.029-5.052 6.029 0v8.399h4.988v-10.131c0-7.88-8.922-7.593-11.018-3.714v-2.155z"></path>
	</symbol>
	<symbol id="rss" viewBox="0 0 24 24">
		<path d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z"></path>
	</symbol>
	<symbol id="reddit" viewBox="0 0 24 24">
		<path d="M24 11.779c0-1.459-1.192-2.645-2.657-2.645-.715 0-1.363.286-1.84.746-1.81-1.191-4.259-1.949-6.971-2.046l1.483-4.669 4.016.941-.006.058c0 1.193.975 2.163 2.174 2.163 1.198 0 2.172-.97 2.172-2.163s-.975-2.164-2.172-2.164c-.92 0-1.704.574-2.021 1.379l-4.329-1.015c-.189-.046-.381.063-.44.249l-1.654 5.207c-2.838.034-5.409.798-7.3 2.025-.474-.438-1.103-.712-1.799-.712-1.465 0-2.656 1.187-2.656 2.646 0 .97.533 1.811 1.317 2.271-.052.282-.086.567-.086.857 0 3.911 4.808 7.093 10.719 7.093s10.72-3.182 10.72-7.093c0-.274-.029-.544-.075-.81.832-.447 1.405-1.312 1.405-2.318zm-17.224 1.816c0-.868.71-1.575 1.582-1.575.872 0 1.581.707 1.581 1.575s-.709 1.574-1.581 1.574-1.582-.706-1.582-1.574zm9.061 4.669c-.797.793-2.048 1.179-3.824 1.179l-.013-.003-.013.003c-1.777 0-3.028-.386-3.824-1.179-.145-.144-.145-.379 0-.523.145-.145.381-.145.526 0 .65.647 1.729.961 3.298.961l.013.003.013-.003c1.569 0 2.648-.315 3.298-.962.145-.145.381-.144.526 0 .145.145.145.379 0 .524zm-.189-3.095c-.872 0-1.581-.706-1.581-1.574 0-.868.709-1.575 1.581-1.575s1.581.707 1.581 1.575-.709 1.574-1.581 1.574z"></path>
	</symbol>
</svg>
</div>
<div id="page" class="hfeed site">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

	
	<header id="masthead" class="site-header variation variation-3" role="banner">
		<div class="header-container">
			<div class="site-branding">
				<div class="site-title">
					<a title="Naked Security" href="https://nakedsecurity.sophos.com/" rel="home"><img src="https://nakedsecurity.sophos.com/wp-content/themes/sophosnews-2015/img/naked-security-logo-white@2x.png"></a>
					by
					<a title="sophos.com" href="https://www.sophos.com"><svg viewBox="0 0 132 24" class="icon sophos"><use xlink:href="#sophos"></use></svg></a>
				</div>
			</div><!-- .site-branding -->
			<nav id="site-navigation" class="main-navigation" role="navigation">
				<div class="container">
					<ul id="menu-variation-two" class="exit-links menu"><li id="menu-item-436509" class="products menu-item menu-item-type-custom menu-item-object-custom menu-item-436509"><a href="#">Products</a></li>
<li id="menu-item-436515" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-436515"><a href="https://www.sophos.com/en-us/products/free-tools.aspx">Free Tools</a></li>
<li id="menu-item-436531" class="search-toggle menu-item menu-item-type-custom menu-item-object-custom menu-item-436531"><a href="#">Search</a></li>
<li id="menu-item-436532" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-436532"><a href="https://home.sophos.com/en-us.aspx">Free Sophos Home</a></li>
</ul>				</div>
			</nav><!-- #site-navigation -->
			<div class="site-search-block">
	<form target="_top" role="search" class="search-form" method="get" action="https://nakedsecurity.sophos.com/">
        <fieldset>
            <div class="field">
				<input type="search" value="" name="s" class="search-field" placeholder="Search naked security...">
            </div>
            <div class="submit">
				<button type="submit" class="search-submit button">Go</button>
            </div>
        </fieldset>
    </form>
</div>
		</div><!-- .container -->
	</header>

	<div class="responsive-flyout-panel small-12 column active" style="opacity: 1; display: none;">
		<div class="modal-filler"></div>
	    <div class="productNavBox">
	        <div class="productNavContainer">
	            <div class="row prodRow">
	                <div class="prodListBox column large-9">
	                    <div class="row margin-0 highlightProduct">
	                        <div class="column medium-6">
	                            <a href="https://www.sophos.com/products/next-gen-firewall.aspx"><img src="https://www.sophos.com/medialibrary/2F4785DE8C3F43ECBD699A18F332FEEB.ashx">
	                                <div class="menu-section-header">
										<div class="menu-section-title">XG Firewall</div>
	                                	<div class="menu-section-subtitle">Next-Gen Firewall</div>
									</div>
	                            </a>
	                        </div>
	                        <div class="column medium-6">
	                            <a href="https://www.sophos.com/products/intercept-x.aspx"><img src="https://www.sophos.com/medialibrary/27111765D65A45D49A232925D2CE428B.ashx">
	                                <div class="menu-section-header">
										<div class="menu-section-title">Intercept X</div>
	                                	<div class="menu-section-subtitle">Next-Gen Endpoint</div>
									</div>
	                            </a>
	                        </div>
	                    </div>
	                    <div class="productList">
	                        <ul>
								<li>
									<a href="https://www.sophos.com/en-us/products/cloud-optix.aspx"><img src="https://www.sophos.com/medialibrary/SophosNext/Images/Products/Icons/sophos-cloud-optix-icon.svg">Sophos Cloud Optix</a>
								</li>
	                            <li>
	                                <a href="https://www.sophos.com/products/sophos-central.aspx"><img src="https://www.sophos.com/medialibrary/08EA66123F1B4DDE8FE5C9B578A7FAA7.ashx">Sophos Central</a>
	                            </li>
	                            <li>
	                                <a href="https://www.sophos.com/products/mobile-control.aspx"><img src="https://www.sophos.com/medialibrary/678FE994855047739F50D6C411184FA6.ashx">Sophos Mobile</a>
	                            </li>
	                            <li>
	                                <a href="https://www.sophos.com/products/server-security.aspx"><img src="https://www.sophos.com/medialibrary/01B80E7D7CD54EF8AC2E51C9C6EC0236.ashx">Intercept X for Server</a>
	                            </li>
	                            <li>
	                                <a href="https://www.sophos.com/products/secure-wifi.aspx"><img src="https://www.sophos.com/medialibrary/BEBD9C41BB4E480498514B29B92A145A.ashx">Secure Wi-Fi</a>
	                            </li>
	                            <li>
	                                <a href="https://www.sophos.com/products/phish-threat.aspx"><img src="https://www.sophos.com/medialibrary/DC9D1A7BA3964B0C9DAF1F1E68806B5A.ashx">Phish Threat</a>
	                            </li>
	                            <li>
	                                <a href="https://www.sophos.com/products/safeguard-encryption.aspx"><img src="https://www.sophos.com/medialibrary/8F51F06B62814B108D3B2763FF018E37.ashx">SafeGuard Encryption</a>
	                            </li>
	                            <li>
	                                <a href="https://www.sophos.com/products/sophos-email.aspx"><img src="https://www.sophos.com/medialibrary/597ADA0AF01A4A12B2B27239D0F9992C.ashx">Secure Email</a>
	                            </li>
	                            <li>
	                                <a href="https://www.sophos.com/products/unified-threat-management.aspx"><img src="https://www.sophos.com/medialibrary/8CB72BF5E1AD41F7894CE5E42101B0F3.ashx">SG UTM</a>
	                            </li>
	                            <li>
	                                <a href="https://www.sophos.com/products/secure-web-gateway.aspx"><img src="https://www.sophos.com/medialibrary/C586E372694547A1B207A61D87246BA7.ashx">Secure Web Gateway</a>
	                            </li>
	                        </ul>
	                    </div>
	                </div>
	                <div class="homeUserBox column large-3">
						<img src="https://www.sophos.com/medialibrary/3376DF5742A64AEE93FDB9DCA7291239.ashx">
						<div class="menu-section-title">For Home Users</div>
	                    <p>Sophos Home protects every Mac and PC in your home </p><a href="https://home.sophos.com/" target="_blank" class="greenSmallMenuBtn">Learn More</a>
					</div>
	            </div>
	            <div class="row blueRow">
	                <div class="column large-3 medium-6">
	                    <a href="https://www.sophos.com/products/free-tools.aspx"><img width="19" src="https://www.sophos.com/medialibrary/A1FF440D2BB84511B8C94D771D44E207.ashx">Free Security Tools</a>
	                </div>
	                <div class="column large-3 medium-6">
	                    <a href="https://www.sophos.com/products/free-trials.aspx"><img width="20" src="https://www.sophos.com/medialibrary/FCD3410ED2C347808D9DB8AC12C62DBD.ashx">Free Trials</a>
	                </div>
	                <div class="column large-3 medium-6">
	                    <a href="https://www.sophos.com/products/demos.aspx"><img width="18" src="https://www.sophos.com/medialibrary/50985180E5F54C94917A2A6508E24287.ashx">Product Demos</a>
	                </div>
	                <!-- <div class="column large-3 medium-6">
	                    <a href="javascript:fairfax.openLiveChatFromFlyoutLink();" class="flyout-live-chat-link"><img width="20" src="https://www.sophos.com/medialibrary/E24C5050837145F6A5C592E299BA2A0D.ashx">Live Sales Chat</a>
	                </div> -->
	            </div>
	        </div>
	    </div>
	</div>
	<script>

	jQuery(document).ready( function () {
		var productButton   = jQuery('nav .menu-item.products');
		var modalBackground = jQuery('.modal-filler');
		var flyoutMenu		= jQuery('.responsive-flyout-panel');
		var Sophos			= Sophos || {};

		Sophos.MenuTest = {};

		Sophos.MenuTest.open = function () {
				productButton.addClass('open');
				flyoutMenu.show();
				modalBackground.show();
		};

		Sophos.MenuTest.close = function () {
			productButton.removeClass('open');
			flyoutMenu.hide();
			modalBackground.hide();
		};

		Sophos.MenuTest.toggle = function () {
			if ( productButton.hasClass('open') ) {
				Sophos.MenuTest.close();
			} else {
				Sophos.MenuTest.open();
			}
		};

		productButton.click( Sophos.MenuTest.toggle );
		modalBackground.click( Sophos.MenuTest.close );
	});

	</script>

	
	<section class="about-panel">
	<div class="container">
	<div class="panel-content ">

		<div class="description"><span>Have you listened to our podcast? <a href="/podcast/">Listen now</a></span></div>

	</div> <!-- .panel-container -->
	</div> <!-- .container -->
	</section> <!-- .panel -->

	
	<div id="content" class="site-content">
		<div class="content-container">

</div> <!-- .container -->
</div> <!-- #content -->


	<section class="content-panel">
	<div class="container">
	<div class="panel-content framed-content-area">

		<main id="main" class="site-main" role="main">

	
		
<article id="post-371433" class="post-371433 post type-post status-publish format-standard has-post-thumbnail hentry category-malware category-microsoft category-pdf category-phishing-malware category-ransomware-malware category-security-threats category-sophoslabs category-spam category-windows tag-exploits tag-microsoft-excel tag-microsoft-office tag-microsoft-word tag-sophoslabs-2 tag-vba tag-visual-basic-for-applications">

	<header class="entry-header">
		<h1 class="entry-title">Wolf in sheep&#8217;s clothing: a SophosLabs investigation into delivering malware via VBA</h1>		<div class="entry-meta">
			<div>
				
	<span class="entry-published">
		<time class="entry-date published" datetime="2017-05-31T18:27:24+01:00">31 May 2017</time>
	</span>

					<a href="#comments" class="comment-box">
					<span class="count">4</span>
				</a>
					
	<span class="entry-categories">
	<a href="https://nakedsecurity.sophos.com/category/security-threats/malware/">Malware</a>, <a href="https://nakedsecurity.sophos.com/category/organisations/microsoft/">Microsoft</a>, <a href="https://nakedsecurity.sophos.com/category/technologies/pdf/">PDF</a>, <a href="https://nakedsecurity.sophos.com/category/security-threats/malware/phishing-malware/">Phishing</a>, <a href="https://nakedsecurity.sophos.com/category/security-threats/malware/ransomware-malware/">Ransomware</a>, <a href="https://nakedsecurity.sophos.com/category/security-threats/">Security threats</a>, <a href="https://nakedsecurity.sophos.com/category/sophoslabs/">SophosLabs</a>, <a href="https://nakedsecurity.sophos.com/category/security-threats/spam/">Spam</a>, <a href="https://nakedsecurity.sophos.com/category/technologies/operating-systems/windows/">Windows</a>	</span>

			</div>
	</header> <!-- .entry-header -->

    <div id="newsletter-signup" class="container top"></div>

			<div class="entry-featured-image">
			<img width="780" height="408" src="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/shutterstock_527898781.jpg?w=780&amp;h=408&amp;crop=1" class="attachment-hero-thumbnail size-hero-thumbnail wp-post-image" alt="" loading="lazy" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/shutterstock_527898781.jpg 1200w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/shutterstock_527898781.jpg?resize=300,157 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/shutterstock_527898781.jpg?resize=768,401 768w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/shutterstock_527898781.jpg?resize=1024,535 1024w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/shutterstock_527898781.jpg?resize=780,408 780w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/shutterstock_527898781.jpg?resize=100,52 100w" sizes="(max-width: 780px) 100vw, 780px" />					</div> <!-- .entry-featured-image -->
		
		<nav class="navigation post-navigation" role="navigation">
		<h2 class="screen-reader-text">Post navigation</h2>

		<div class="nav-links">
			<div class="nav-previous"><a href="https://nakedsecurity.sophos.com/2017/05/31/keybase-adds-end-to-end-encryption-to-messages-on-the-web/" rel="prev"><span class="nav-label">Previous</span><span class="nav-seperator">:</span><span class="nav-title"> Keybase adds end-to-end encryption to messages on the web</span></a></div><div class="nav-next"><a href="https://nakedsecurity.sophos.com/2017/05/31/news-in-brief-nasa-sends-probe-to-the-sun-subway-gets-phone-coverage-facebook-pushes-back/" rel="next"><span class="nav-label">Next</span><span class="nav-seperator">:</span><span class="nav-title"> News in brief: NASA sends probe to the Sun; subway gets phone coverage; Facebook pushes back</span></a></div>		</div>
		<!-- .nav-links -->
	</nav><!-- .navigation -->
	
	<div class="entry-content">
		<div class="entry-prefix">
			<div class="entry-author">
				
	
					<span class="by">by</span>
			<a href="https://nakedsecurity.sophos.com/author/bill-brenner/" title="Posts by Bill Brenner" class="author url fn" rel="author">Bill Brenner</a>		
	
				</div>
			<div class="entry-sharing">
				
	<ul class="block social share">
		<li class="facebook"><a href="https://www.facebook.com/share.php?u=https%3A%2F%2Fnakedsecurity.sophos.com%2F2017%2F05%2F31%2Fwolf-in-sheeps-clothing-a-sophoslabs-investigation-into-delivering-malware-via-vba%2F&title=Wolf+in+sheep%E2%80%99s+clothing%3A+a+SophosLabs+investigation+into+delivering+malware+via+VBA" data-title="Wolf in sheep’s clothing: a SophosLabs investigation into delivering malware via VBA" title="Share on Facebook"><svg style="height: 20px;" viewBox="0 0 100 100" class="icon facebook"><use xlink:href="#facebook"></use></svg></a></li>
		<li class="twitter"><a href="https://twitter.com/intent/tweet?text=Wolf+in+sheep%E2%80%99s+clothing%3A+a+SophosLabs+investigation+into+delivering+malware+via+VBA+https%3A%2F%2Fnakedsecurity.sophos.com%2F%3Fp%3D371433" data-title="Wolf in sheep&#8217;s clothing: a SophosLabs investigation into delivering malware via VBA" title="Share on Twitter"><svg style="height: 20px;" viewBox="0 0 100 100" class="icon twitter"><use xlink:href="#twitter"></use></svg></a></li>
		<li class="linkedin"><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fnakedsecurity.sophos.com%2F2017%2F05%2F31%2Fwolf-in-sheeps-clothing-a-sophoslabs-investigation-into-delivering-malware-via-vba%2F&title=Wolf+in+sheep%E2%80%99s+clothing%3A+a+SophosLabs+investigation+into+delivering+malware+via+VBA" data-title="Wolf in sheep’s clothing: a SophosLabs investigation into delivering malware via VBA" title="Share on LinkedIn"><svg style="height: 20px;"  viewBox="0 0 100 100" class="icon linkedin"><use xlink:href="#linkedin"></use></svg></a></li>
		<li class="reddit"><a href="https://reddit.com/submit/?url=https%3A%2F%2Fnakedsecurity.sophos.com%2F2017%2F05%2F31%2Fwolf-in-sheeps-clothing-a-sophoslabs-investigation-into-delivering-malware-via-vba%2F&title=Wolf+in+sheep%E2%80%99s+clothing%3A+a+SophosLabs+investigation+into+delivering+malware+via+VBA" title="Share on Reddit"><svg style="height: 20px;"  viewBox="0 0 100 100" class="icon reddit"><use xlink:href="#reddit"></use></svg></a></li>

			</ul>

				</div>
		</div>
		<p style="background-color:#e8e8e8;padding:.8em;margin-bottom:1.6em;text-align:center;font-size:85%;"><em>Thanks to <strong>Graham Chantry</strong> of SophosLabs for the behind-the-scenes work on this article.</em></p>
<p>The document threat landscape has in recent years been dominated by <a href="https://nakedsecurity.sophos.com/2017/04/11/microsoft-patches-word-zero-day-booby-trap-exploit/">Microsoft Word and Excel spreadsheet malware</a>. This is thanks, in no small part, to the drastic resurgence of Visual Basic for Applications (VBA) being used as a delivery method for malicious payloads.</p>
<p>It&#8217;s a topic we&#8217;ve delved into before, <a href="https://news.sophos.com/en-us/2015/09/28/why-word-malware-is-basic/">most notably in this article</a> from senior Sophos technologist Paul Ducklin. As he did back then, researcher Graham Chantry recently dug into the data and mechanics of the trend as seen from the SophosLabs&#8217; perspective for an updated picture of the problem. What follows are his updated findings for the last six months.</p>
<h2>By the numbers</h2>
<p>First, some statistics that show the current state of affairs. In the pie chart on the left, we see that 68% of the file types used to deliver malware in the last six months were Word. Excel spreadsheets accounted for 15% and PDFs accounted for 13%. When it comes to the threat type, we see in the right-hand chart that 81% is VBA based, while embedded droppers account for 10% and phishing is 6%.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-12-52-43-pm.png"><img loading="lazy" class="size-full wp-image-371501 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-12-52-43-pm.png" alt="" width="640" height="353" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-12-52-43-pm.png 918w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-12-52-43-pm.png?resize=300,165 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-12-52-43-pm.png?resize=768,423 768w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-12-52-43-pm.png?resize=100,55 100w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>VBA Droppers first started to surface in <a href="https://nakedsecurity.sophos.com/2014/07/07/remember-macro-viruses-infected-word-and-excel-files-theyre-back/">July 2014</a> and became synonymous with the banking Trojan <a href="https://nakedsecurity.sophos.com/2015/10/15/dridex-botnet-taken-down-multi-million-bank-fraud-suspect-arrested/">Dridex</a> when they started to utilize them in aggressive spam campaigns. Since then, we have seen VBA Droppers used with a variety of other payloads that have evolved from simple 10-line droppers to verbose, complex and heavily obfuscated code.</p>
<p>And it’s not just the code that the bad guys have experimented with. In the same time period, Chantry said SophosLabs has seen attackers utilize a variety of file formats, such as the short-lived <a href="https://nakedsecurity.sophos.com/2015/03/06/from-the-labs-new-developments-in-microsoft-office-malware/">Office 2003 Standalone XML format</a>, the MHTML Web Archive format and, in much rarer cases, embedding Office files within other document formats such as RTF and PDF.</p>
<h2>The Matryoshka doll approach</h2>
<p>The latter of these file formats has actually become far less rare. In just the last few weeks SophosLabs noticed a significant increase in the number of ransomware campaigns housing VBA droppers in PDF documents.</p>
<p><span class="s1"><aside id="sophos_ad-3" class="widget sophos-inline-ad sophos_widget_ad">				<style></style>
				<div class="sophos_widget_ad"><a href="https://www.sophos.com/en-us/products/managed-threat-response.aspx" class="s-ad-threat-hunter__link-wrapper">
  <div class="s-ad-threat-hunter">
    <div class="s-ad-threat-hunter__title">
      OTHERS STOP AT NOTIFICATION. WE TAKE ACTION
    </div>
    <div class="s-ad-threat-hunter__text">
      Get 24/7 managed threat hunting, detection, and response delivered by
      Sophos experts
    </div>
    <div class="s-ad-threat-hunter__action">
      <span class="s-button s-button--bright-green"> Learn&nbsp;more </span>
    </div>
  </div>
</a></div>
			</aside></span></p>
<p><span class="s1">SophosLabs discovered one spam campaign where <a href="https://news.sophos.com/en-us/2017/02/13/sophoslabs-malware-forecast-points-to-rising-iot-threats-more-ransomware/">ransomware</a></span><span class="s1"> was downloaded and run by a macro hidden inside a Word document that was in turn nested within a PDF, <a href="https://nakedsecurity.sophos.com/2017/04/24/ransomware-hidden-inside-a-word-document-thats-hidden-inside-a-pdf/">like a Russian matryoshka doll</a>. The ransomware in this case appeared to be a variant of <a href="https://nakedsecurity.sophos.com/2016/02/17/locky-ransomware-what-you-need-to-know/">Locky</a>.</span></p>
<p class="p1"><span class="s1">Most antivirus filters know how to recognize suspicious macros in documents, but hiding those document inside a PDF could be a successful way to sidestep it.</span></p>
<p>These attachments arrived in spam emails where the body was entirely empty, but the subjects started with either “Document”, “File” or “Copy” followed by a series of random numbers (File_78564545). The distinct lack of social engineering suggested the crooks are relying on curiosity alone for victims to open the enclosed PDF.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-21-13-am.png"><img loading="lazy" class="size-full wp-image-371438 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-21-13-am.png" alt="" width="640" height="433" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-21-13-am.png 1428w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-21-13-am.png?resize=300,203 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-21-13-am.png?resize=768,520 768w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-21-13-am.png?resize=1024,693 1024w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-21-13-am.png?resize=100,68 100w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>The PDF attachments themselves appear to always have a nonsensical filename such as “nm.pdf” (as shown in the screenshot above). If the recipient is naïve enough to open this attachment it will trigger the infection.</p>
<p>But before we replicate that, lets have a look at what’s actually inside this PDF file.</p>
<h2>Anatomy of a malicious PDF</h2>
<p>SophosLabs started by opening <em>nm.pdf</em> in a text editor and with little effort we can see an immediate red flag: the file contains an <em>OpenAction</em> event (see screenshot below). An <em>Openaction</em> event defines what will happen when the user first opens the document. In this case, the PDF reader will execute a JavaScript function called <em>submarine</em>. So what does this <em>submarine</em> function actually do? In order to find its definition, SophosLabs had to parse the remainder of the PDF.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-22-46-am.png"><img loading="lazy" class="size-full wp-image-371439 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-22-46-am.png" alt="" width="640" height="50" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-22-46-am.png 1754w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-22-46-am.png?resize=300,24 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-22-46-am.png?resize=768,60 768w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-22-46-am.png?resize=1024,81 1024w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-22-46-am.png?resize=1536,121 1536w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-22-46-am.png?resize=100,8 100w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>PDF files consist of objects that define all aspects of the document’s content, such as images, fonts and of course the actual text. The <em>OpenAction</em> screenshot (above) can also help illustrate the format of a simple PDF object. Each object starts with a unique Index number (in this case decimal 14) and a version number (in this case version 0). The actual contents of the object are housed between the header <em>obj</em> and the footer <em>endobj</em>.</p>
<p>PDF objects can also indirectly reference each other and they do so via these unique index numbers.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-24-31-am.png"><img loading="lazy" class="size-full wp-image-371440 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-24-31-am.png" alt="" width="640" height="512" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-24-31-am.png 958w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-24-31-am.png?resize=300,240 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-24-31-am.png?resize=768,614 768w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-24-31-am.png?resize=88,70 88w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>In the screenshot above we can see that Object 14 (which holds our <em>OpenAction</em> event) references object 13, which itself references object 11, which references object 7 which finally references object 6. Object 6 is what is known as a “stream object” and the format tells us that it is 380 bytes in length and that its content is <em>Flate</em> encoded. This is illegible content when shown in text editor, so SophosLabs deflated it.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-25-41-am.png"><img loading="lazy" class="size-full wp-image-371441 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-25-41-am.png" alt="" width="640" height="339" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-25-41-am.png 876w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-25-41-am.png?resize=300,159 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-25-41-am.png?resize=768,407 768w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-25-41-am.png?resize=100,53 100w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>The screenshot above is Object 6’s deflated stream and right at the bottom is that <em>submarine</em> function for which Labs was searching. Unlike most modern JavaScript malware, this code was very straightforward, with little to no obfuscation.</p>
<p><em>Submarine</em> consists of a single call to <em>abc</em>, which is a pointer to the inbuilt <em>exportDataObject</em> API. This API extracts an embedded file (in this case HGG4X.docm) and saves it to disk. If the <em>nLaunch</em> argument is non-zero the application will also open the extracted file in the default application. In this case the value of <em>nLaunch</em> is set to 2 which will result in the embedded file being saved to a temporary directory and then opened.</p>
<p>The next question was: where is HGG4X.docm? By tracking back to the root object (14), SophosLabs saw that Object 13 not only references JavaScript in object 11 but it also references “Embedded Files” in object 12.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-27-12-am.png"><img loading="lazy" class=" wp-image-371442 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-27-12-am.png" alt="" width="684" height="692" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-27-12-am.png 505w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-27-12-am.png?resize=296,300 296w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-27-12-am.png?resize=69,70 69w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-27-12-am.png?resize=32,32 32w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-27-12-am.png?resize=50,50 50w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-27-12-am.png?resize=64,64 64w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-27-12-am.png?resize=96,96 96w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-27-12-am.png?resize=128,128 128w" sizes="(max-width: 684px) 100vw, 684px" /></a></p>
<p>The next question was where HGG4X.docm was hidden. By tracking back to the root object (14), we saw that Object 13 not only references JavaScript in object 11 but it also references “Embedded Files” in object 12.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-28-42-am.png"><img loading="lazy" class=" wp-image-371443 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-28-42-am.png" alt="" width="618" height="350" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-28-42-am.png 470w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-28-42-am.png?resize=300,170 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-28-42-am.png?resize=100,57 100w" sizes="(max-width: 618px) 100vw, 618px" /></a></p>
<p>Chantry said:</p>
<blockquote><p>Unlike most document malware these days, the social engineering effort leaves a lot to the imagination: it simply asks you politely to open the embedded document. But if our user is naive enough to open an attachment from an unknown recipient, there is a good chance they’ll be naive enough to follow these instructions. We click “OK”; the JavaScript completes its mission and HGG4X.docm is dropped and opened into Microsoft Word.</p></blockquote>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-29-41-am.png"><img loading="lazy" class=" wp-image-371444 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-29-41-am.png" alt="" width="578" height="329" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-29-41-am.png 471w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-29-41-am.png?resize=300,171 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-29-41-am.png?resize=100,57 100w" sizes="(max-width: 578px) 100vw, 578px" /></a></p>
<p>As we anticipated, the second the user opens the attachment, the JavaScript kicks in and attempts to open the embedded VBA document. It’s not plain sailing; however, as Adobe Reader identifies that this might be something malicious and suspends the action. In order for the infection to continue the user will have to explicitly approve it.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-31-05-am.png"><img loading="lazy" class="size-full wp-image-371445 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-31-05-am.png" alt="" width="640" height="325" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-31-05-am.png 761w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-31-05-am.png?resize=300,153 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-31-05-am.png?resize=100,51 100w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>Only two lines into the program, the Labs found the first indicator of something malicious, starting with an unconditional jump. As there is no label between the <em>Goto</em> statement and where it’s jumping to, the code wedged between them is unreachable (aka dead code). This is not very common in clean files as developers will often remove unused code. This sort of trick is <a href="https://nakedsecurity.sophos.com/2015/03/06/from-the-labs-new-developments-in-microsoft-office-malware/">very common among VBA downloaders</a> and aims to try and confuse analysts trying to reverse engineer it. Unlike most samples that utilize this trick, however, the dead code in this file appears to be clean code snippets, likely taken from MSDN’s or other online resources.</p>
<h2>Ingenious methods</h2>
<p>Jumping over the junk code we see that <em>Synomati</em> starts by creating an Object (of type <em>Cooper</em>) and immediately calls one of its methods. Strangely, it doesn’t reference the method directly though, instead using the VBA function <em>CallByName</em>. This technique of calling an Object’s method allows the caller to specify the name of the method as a string argument rather than hardcoding it. In this code that name is stored in a <em>TextBox</em> component located on a VB form (called <em>Window1</em>).</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-32-21-am.png"><img loading="lazy" class=" wp-image-371446 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-32-21-am.png" alt="" width="629" height="372" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-32-21-am.png 511w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-32-21-am.png?resize=300,177 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-32-21-am.png?resize=100,59 100w" sizes="(max-width: 629px) 100vw, 629px" /></a></p>
<p>Above is the <em>Window1</em> VB Form as it appears in the Visual Basic editor. The red boxes indicate their names. Various attributes of these components are referenced throughout the program’s code.</p>
<p>Storing strings within form components is an ingenious method of concealing the true intentions of malicious code, as it’s often the strings that give the game away &#8211; eg suspicious IP addresses or calls to processes such as powershell.exe. We first started to see samples using this method in early 2016 but the majority of VBA droppers still prefer to obfuscate their strings, usually a variety of Xor, Base64 or RC4 encryption.</p>
<p>The <em>CallByName</em> function call from the previous screenshot was referring to the <em>Text</em> field of the TextBox <em>T2</em>. As seen in the bottom right corner of the form, that is the string “ratatu”. By searching for that expression in the <em>Cooper</em> class’s implementation, Labs found the method.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-33-40-am.png"><img loading="lazy" class=" wp-image-371447 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-33-40-am.png" alt="" width="490" height="181" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-33-40-am.png 349w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-33-40-am.png?resize=300,111 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-33-40-am.png?resize=100,37 100w" sizes="(max-width: 490px) 100vw, 490px" /></a></p>
<p>Just like its caller, <em>ratatu</em> also references strings stored in form components. This time though it’s in the <em>Tag</em> field of the ComboBox imaginatively named <em>ffrrggbb</em>.</p>
<p>The attribute isn’t visible from the Form Designer View so Labs needed to look at the properties tab for <em>ffrrggbb. </em>As you can see at the bottom of the screenshot below, the <em>Tag</em> field contains a long jumbled string.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-34-35-am.png"><img loading="lazy" class=" wp-image-371448 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-34-35-am.png" alt="" width="543" height="408" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-34-35-am.png 427w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-34-35-am.png?resize=300,226 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-34-35-am.png?resize=93,70 93w" sizes="(max-width: 543px) 100vw, 543px" /></a></p>
<p><em>Ratatu</em> uses the VBA split function to divide this string into an array of smaller strings using the delimiter “FSUKE.”</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-35-38-am.png"><img loading="lazy" class="size-full wp-image-371449 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-35-38-am.png" alt="" width="166" height="227" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-35-38-am.png 166w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-35-38-am.png?resize=51,70 51w" sizes="(max-width: 166px) 100vw, 166px" /></a></p>
<p>The resulting array is a veritable who’s who of VBA dropper strings and, based on this information alone, Labs confidently predicted that the code was likely to download and run something. The array is stored in the variable <em>AsStringName</em> which is global in scope. This means it will be accessible from every other subroutine or function.</p>
<p>Another global variable is <em>Vaucher</em> which is assigned on the following line. The value it’s set to is at offset 0 of this newly created array <em>“Microsoft.XMLHTTP.”</em> This is because <em>FreshID</em> is a constant set to 0; so (0+0 * 2 / 13) is just a deliberately verbose method of declaring 0.</p>
<p>The function then proceeds to call <em>SubMui</em>. The IF statement at the start of the subroutine is always true for this file (the <em>ActiveDocument.Kind</em> property is 0) so it proceeds to create 4 ActiveX objects using the strings from the global array we populated earlier.</p>
<p>Crucially, <em>SubMui</em> also generates another string array using the exact same <em>Split</em> method. This time, however, the delimiter is stored in the <em>Label</em> component named <em>Command</em> (string value “V”). This array is stored in the global variable <em>MovedPermanently</em> and contains four URIs that all point to the payload.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-38-30-am.png"><img loading="lazy" class=" wp-image-371451 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-38-30-am.png" alt="" width="355" height="137" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-38-30-am.png 215w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-38-30-am.png?resize=100,39 100w" sizes="(max-width: 355px) 100vw, 355px" /></a></p>
<p>So we now have four ActiveX objects and also an array of URIs to download but <em>SubMui</em> isn’t finished. It also generates a path to the user’s “temp” directory, and it does so, by calling the <em>Environment</em> method of the recently created <em>WScript.Shell</em> ActiveX object. This method returns a dictionary of Environment variables for the current process. Using this object it looks up the value for the Environment Variable “Temp” and assign the value to the variable <em>PUKALA_LAKOPPC</em>.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-39-22-am.png"><img loading="lazy" class=" wp-image-371452 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-39-22-am.png" alt="" width="510" height="199" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-39-22-am.png 423w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-39-22-am.png?resize=300,117 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-39-22-am.png?resize=100,39 100w" sizes="(max-width: 510px) 100vw, 510px" /></a></p>
<p>At this point the code passed the baton to the misleadingly named <em>MoveSheets</em> subroutine, as its name is wholly unrepresentative of its functionality. This subroutine actually loops through the <em>MovedPermanantly</em> array (which contains all those dodgy URIs) and calls <em>SaveDataCSVToolStripMenuItem_Click</em> for each one.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-40-39-am.png"><img loading="lazy" class=" wp-image-371453 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-40-39-am.png" alt="" width="520" height="280" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-40-39-am.png 457w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-40-39-am.png?resize=300,161 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-40-39-am.png?resize=100,54 100w" sizes="(max-width: 520px) 100vw, 520px" /></a></p>
<p>Although we haven&#8217;t yet analyzed the <em>SaveDataCSVToolStripMenuItem_Click</em> subroutine at this point, it predicted that it’s likely downloading something, as the <em>Status</em> field of the <em>Microsoft.XMLHTTP</em> object (stored in <em>CuPro</em>) is being checked immediately after the call.</p>
<p>The HTTP status code 200 signifies that a request has been successful, so the IF condition here will raise a <em>runtime error</em> if a download was unsuccessful. In VBA, <em>runtime errors</em> can be caught and processed by <em>error handlers</em> defined using an <em>On Error</em> statement. <em>MoveSheets</em> defines an <em>error handler</em> at the label <em>d13</em>. All this label does though is to call <em>Next</em> which jumps back to the start of the <em>For</em> loop. Essentially if the download failed for any reason we get the next URI in the array and carry on.</p>
<p>By implementing this functionality, the bad guys ensure that if one of their domains is taken down before the victim opens the document there are still three others in the queue waiting to serve up the payload.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-41-49-am.png"><img loading="lazy" class=" wp-image-371454 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-41-49-am.png" alt="" width="503" height="245" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-41-49-am.png 435w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-41-49-am.png?resize=300,146 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-41-49-am.png?resize=412,200 412w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-41-49-am.png?resize=100,49 100w" sizes="(max-width: 503px) 100vw, 503px" /></a></p>
<h2>Cooper&#8217;s Challenge</h2>
<p>So, on to another misleadingly named <em>SaveDataCSVToolStripMenuItem_Click </em>subroutine and we can see it starts by creating a full path to the current URI using the “http” string hidden in the <em>ZK </em>component. Similar to the <em>Synomati</em> function we also create a <em>Cooper</em> object to call its <em>Challenge</em> method. Note The IF condition is redundant as the parameter <em>e</em> is always less than 488.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-42-48-am.png"><img loading="lazy" class=" wp-image-371455 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-42-48-am.png" alt="" width="523" height="96" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-42-48-am.png 381w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-42-48-am.png?resize=300,55 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-42-48-am.png?resize=100,18 100w" sizes="(max-width: 523px) 100vw, 523px" /></a></p>
<p><em>Cooper’s</em> <em>Challenge</em> method has a pretty basic implementation. It consists of two calls to the same subroutine:  <em>Vgux</em>. The first of these calls has the parameter value set to 1 and the second with the value set to 8. If we navigate to <em>Vgux</em>’s code we can see that its behavior is in fact dependent on these values.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-44-03-am.png"><img loading="lazy" class=" wp-image-371456 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-44-03-am.png" alt="" width="520" height="391" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-44-03-am.png 463w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-44-03-am.png?resize=300,225 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-44-03-am.png?resize=93,70 93w" sizes="(max-width: 520px) 100vw, 520px" /></a></p>
<p>If the parameter is set to 1 it calls the <em>Open</em> method (of our “Microsoft.XMLHTTP” object) to initialize it as a <em>GET</em> request and to set the URI to download. The second time round, when the parameter is 8, it will call the <em>setRequestHandler</em> to initialize the <em>User-Agent</em> field.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-45-17-am.png"><img loading="lazy" class=" wp-image-371457 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-45-17-am.png" alt="" width="523" height="99" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-45-17-am.png 396w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-45-17-am.png?resize=300,57 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-45-17-am.png?resize=100,19 100w" sizes="(max-width: 523px) 100vw, 523px" /></a></p>
<p>So when we return to <em>SaveDataCSVToolStripMenuItem_Click</em> we now know our “Microsoft.XMLHTTP” object is initialized with all the right values and is ready to go. Predictably the next operation is to call <em>Send</em> on the object which will initiate the download of the payload.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-47-05-am.png"><img loading="lazy" class=" wp-image-371458 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-47-05-am.png" alt="" width="431" height="207" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-47-05-am.png 279w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-47-05-am.png?resize=100,48 100w" sizes="(max-width: 431px) 100vw, 431px" /></a></p>
<p>Regardless of whether the download succeeds of fails the code flow returns to the <em>MoveSheets</em> subroutine. As we touched on before if any failure occurs we simply retrieve the next URI in the array and repeat the process until one succeeds or we run out of URIs. Whichever happens first?</p>
<p>In the case of the Labs&#8217; investigation, the first HTTP download was successful so they proceeded to call the function <em>Assimptota6</em>, which immediately calls <em>PUKALA_ProjectSpeed</em>. Again the bad guys have attempted to complicate analysis by embedding dead code but, if we disregard that, it’s clear it’s just responsible for creating file paths for the dropped payload.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-48-05-am.png"><img loading="lazy" class="size-full wp-image-371459 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-48-05-am.png" alt="" width="528" height="403" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-48-05-am.png 528w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-48-05-am.png?resize=300,229 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-48-05-am.png?resize=92,70 92w" sizes="(max-width: 528px) 100vw, 528px" /></a></p>
<p>The function makes use of the temporary directory path stored in <em>PUKALA_LAKOPPC</em> (which we in <em>SubMui</em>) to generate two file paths stored in the global variables: <em>PUKALA_Project</em> and <em>PUKALA_ProjectBBB</em>. Note the integer value <em>ProjectDarvin</em>, which is included in both file paths, signifies which URI served up the payload: 20 indicates the first URI, 22 the second, 24 for the third and so on. The actual file paths generated can be seen in the table below.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-49-01-am.png"><img loading="lazy" class=" wp-image-371460 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-49-01-am.png" alt="" width="513" height="83" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-49-01-am.png 383w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-49-01-am.png?resize=300,49 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-49-01-am.png?resize=100,16 100w" sizes="(max-width: 513px) 100vw, 513px" /></a></p>
<p>Returning to the caller <em>Assimptota6</em> and we find more redundant code. The conditional branch highlighted in red can never be true as the parameter <em>NumHoja</em> is always 22.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-50-05-am.png"><img loading="lazy" class="size-full wp-image-371461 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-50-05-am.png" alt="" width="480" height="237" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-50-05-am.png 480w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-50-05-am.png?resize=300,148 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-50-05-am.png?resize=100,49 100w" sizes="(max-width: 480px) 100vw, 480px" /></a></p>
<p>When we filter out this irrelevant code we can see that this function uses the <em>Adodb.Stream</em> object, we created earlier, to write the payload to a file on disk. It does so by first opening a stream of binary data, populating it with the content of the download and writing that stream back to disk using the <em>SaveToFile</em> method.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-52-10-am.png"><img loading="lazy" class="size-full wp-image-371462 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-52-10-am.png" alt="" width="517" height="223" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-52-10-am.png 517w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-52-10-am.png?resize=300,129 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-52-10-am.png?resize=100,43 100w" sizes="(max-width: 517px) 100vw, 517px" /></a></p>
<p>You might have noticed that the path of the file being written to is <em>PUKALA_ProjectBBB</em>. So let’s pause the program just after the <em>SaveToFile</em> call and take a look at what was actually written to <em>eewadro20</em>. The contents of the file don’t appear to be a recognizable file format; it appears to just be a series of random bytes. So we can probably make an educated guess that the payload is encrypted in some manner. So let’s resume the code execution and see how the program makes use of it.</p>
<p><em>Assimptota6</em> finishes up by calling the similarly titled <em>Assimptota4</em>. As the screenshot above shows, it consists of only two lines of code. Before delving into the subroutine call on the first line we can look ahead to the second line to see if that gives us any clues to what it’s trying to do. This line of code uses the <em>Shell.Application</em> object; we created earlier, to run the file <em>pitupi20.exe</em>. Of course this file doesn’t exist yet, so we know <em>WidthA</em> must be responsible for creating it. Looking at the arguments passed into WidthA only strengthens this assumption as it includes:</p>
<ul>
<li>the path to the file containing the encrypted payload</li>
<li>the path to the Windows executable file that will be executed</li>
<li>a string that appears to be some form of decryption key</li>
</ul>
<p>&nbsp;</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-53-54-am.png"><img loading="lazy" class=" wp-image-371464 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-53-54-am.png" alt="" width="614" height="255" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-53-54-am.png 532w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-53-54-am.png?resize=300,125 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-53-54-am.png?resize=100,42 100w" sizes="(max-width: 614px) 100vw, 614px" /></a></p>
<p>When we jump into <em>WidthA</em>’s definition we can see that it reads the contents of the encrypted payload into the byte array <em>Gbbb</em> and later writes this array into the Windows executable file. Sandwiched between these two operations is a subroutine call to <em>Subfunc</em> which ominously takes our payload byte array and the decryption key as arguments. So it’s no longer a question of if it’s a decryption routine anymore it’s just a question of how does it decrypt it.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-55-15-am.png"><img loading="lazy" class=" wp-image-371465 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-55-15-am.png" alt="" width="559" height="490" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-55-15-am.png 476w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-55-15-am.png?resize=300,263 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-55-15-am.png?resize=80,70 80w" sizes="(max-width: 559px) 100vw, 559px" /></a></p>
<p>Stepping into <em>SubFunc,</em> Labs saw that it started by translating the decryption string <em>&#8220;QOfPWKYMzQzNuuzBQGeax2Lkh3Y0oWEl&#8221;</em> into an array of bytes using the VBA function <em>StrConv</em>. It then proceeded to perform an exclusive or (Xor) operation on each byte in the encrypted payload with the bytes in the decryption key array. Note the function <em>Ashnorog</em> is just a wrapper function for the expression <em>bb</em> Xor <em>aa</em>.</p>
<p>The diagram below shows the first 8 bytes of the encrypted payload array (at the top), the bytes in the decryption key array (in the middle) and the encrypted byte array after the <em>Xor</em> operation which we have renamed <strong>Decrypted Payload</strong> for readability.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-56-15-am.png"><img loading="lazy" class="size-full wp-image-371466 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-56-15-am.png" alt="" width="437" height="174" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-56-15-am.png 437w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-56-15-am.png?resize=300,119 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-56-15-am.png?resize=100,40 100w" sizes="(max-width: 437px) 100vw, 437px" /></a></p>
<p>In the first iteration of the loop <em>CeLaP4</em> (the variable that is used to index the arrays) is set to 0. So we take the byte at index 0 of the Encrypted Payload (1c) and we <em>Xor</em> it with the byte at index 0 of the Decryption Key (51). The result of this operation (4D) is then written back into the encrypted payload array at index 0. The next iteration in the loop will <em>Xor</em> the bytes at index 1 (15 and 4F) and the result is written back to offset 1 (5A). This process continues until every byte in the array has been decrypted.</p>
<p>Note here that the Encrypted Payload Array is larger than the Decryption Key Array so we can’t <em>Xor</em> at the same offset in both arrays for every iteration. The code caters for this, however, by performing a <em>Mod</em> division of the index of the Encrypted Payload Array with the length of the Decryption Key Array. This means when the index reaches the last byte of the Decryption Key Array the next iteration will use the first byte in the array.</p>
<p>At this point, Labs let the decryption loop complete in the debugger and paused it just after <em>WidthA</em> has written the decrypted payload to “pitupi.exe”. Opening this file in a binary editor, Labs finally had a Windows executable payload.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-57-17-am.png"><img loading="lazy" class=" wp-image-371467 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-57-17-am.png" alt="" width="536" height="158" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-57-17-am.png 461w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-57-17-am.png?resize=300,89 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-57-17-am.png?resize=100,30 100w" sizes="(max-width: 536px) 100vw, 536px" /></a></p>
<p>Resuming the program, <em>Assimptota4</em> proceeded to launch the newly decrypted payload using the <em>Shell.Application</em> object.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-58-43-am.png"><img loading="lazy" class=" wp-image-371468 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-58-43-am.png" alt="" width="536" height="93" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-58-43-am.png 473w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-58-43-am.png?resize=300,52 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-58-43-am.png?resize=100,17 100w" sizes="(max-width: 536px) 100vw, 536px" /></a></p>
<p>It then delivered the payload and executed it. This Windows executable now runs hidden in the background looking for files of interest and encrypting them. After a very short period of time, the inevitable ransom note and wallpaper change follows.</p>
<p><a href="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-59-32-am.png"><img loading="lazy" class=" wp-image-371469 aligncenter" src="https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-59-32-am.png" alt="" width="568" height="437" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-59-32-am.png 468w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-59-32-am.png?resize=300,231 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2017/05/screen-shot-2017-05-31-at-9-59-32-am.png?resize=91,70 91w" sizes="(max-width: 568px) 100vw, 568px" /></a></p>
<h2>Enter Jaff</h2>
<p>This ransomware calls itself Jaff and the bad news for the user is those treasured family pictures and tomorrow’s big presentation have all been renamed with .jaff extensions and their contents replaced with encrypted blobs. Chantry said:</p>
<blockquote><p>The code analyzed in this paper is a far cry from those <a href="https://nakedsecurity.sophos.com/2014/09/17/vba-injectors/">simple VBA downloader templates</a> we saw at the start of the VBA boom back in September 2014. These samples conceal their strings in Form components, pollute useful code with redundant code and encrypt their payloads until the very last minute. All of this in no doubt in a bid to bypass AV detection that will look for specific strings or functions. The fact the functionality is split between so many procedures, however, and that it intermixes clean code with malicious suggested that it is also trying to prevent analysts from building a narrative when reverse engineering it.</p></blockquote>
<h2>Now what?</h2>
<p>Just why the bad guys have decided to start hiding VBA Downloaders in PDF documents we can only speculate, but a good argument could be the tarnished reputation of Office documents as email attachments and perhaps a misguided interpretation of PDFs being somehow safer. IT administrators might by now have decided to automatically block VBA documents from entering their network, but it’s less likely they will have done so for PDFs. For want of a better analogy, it’s very much the wolf in sheep’s clothing.</p>
<p>Any AV vendor worth its muster can easily extract theses embedded file and this sort of attack requires the victim to have both PDF and Office software. That paired with the need for another level of social engineering means there are plenty of reasons the trend might not continue. In fact, this isn’t even the first time Labs has seen Office document malware being paired with PDF. The <a href="https://www.sophos.com/en-us/medialibrary/PDFs/technical%20papers/CVE-2012-0158-An-Anatomy-of-a-Prolific-Exploit.PDF">notorious CVE-2012-0158 vulnerability</a> was exploited using PDF as a parent file but did so only briefly. Could VBA PDF files follow the same fate?</p>
<p>SophosLabs certainly isn&#8217;t betting against it.</p>
<p>Sophos detects the PDF and embedded Office Document as Troj/DocDl-IYE and the dropped Jaff payload as Mal/Ransom-FD. Our customers are protected.</p>
<p><br />
</p>
			</div> <!-- .entry-content -->
	<ul class="block social follow">
		<li>
			<svg style="height: 24px" viewBox="0 0 24 24" class="icon twitter"><use xlink:href="#twitter"></use></svg>
			<p>Follow <strong><a href="https://twitter.com/nakedsecurity">@NakedSecurity on Twitter</a></strong> for the latest computer security news.</p>
		</li>
		<li>
			<svg style="height: 24px" viewBox="0 0 24 24" class="icon instagram"><use xlink:href="#instagram"></use></svg>
			<p>Follow <strong><a href="https://www.instagram.com/nakedsecurity/">@NakedSecurity on Instagram</a></strong> for exclusive pics, gifs, vids and LOLs!</p>
		</li>
	</ul>
</article><!-- #post-## -->

		<div class="free-tools-block">
			<h2 class="block-title">Free tools</h2>

<div class="ns-free-tools">
	<div class="ns-free-tools__item ns-free-tools__item--sophos-home">
		<a class="ns-free-tools__link" href="https://home.sophos.com/en-us.aspx?cmp=701j0000001eLpnAAE">
			<img src="https://nakedsecurity.sophos.com/wp-content/themes/sophosnews-2015/img/free-tools/sophos-home@2x.png" alt="Sophos Home" class="ns-free-tools__image" width="166" height="100">
			<h4 class="ns-free-tools__title">
				Sophos Home			</h4>
			<div class="ns-free-tools__sub-title">
				Protect personal PCs and Macs			</div>
		</a>
	</div>
	<div class="ns-free-tools__item ns-free-tools__item--hitman-pro">
		<a class="ns-free-tools__link" href="https://www.hitmanpro.com/en-us/hmp.aspx">
			<img src="https://nakedsecurity.sophos.com/wp-content/themes/sophosnews-2015/img/free-tools/hitman-pro@2x.png" alt="Hitman Pro" class="ns-free-tools__image" width="154" height="100">
			<h4 class="ns-free-tools__title">
				Hitman Pro			</h4>
			<div class="ns-free-tools__sub-title">
				Find and remove malware			</div>
		</a>
	</div>
	<div class="ns-free-tools__item ns-free-tools__item--intercept-x">
		<a class="ns-free-tools__link" href="https://www.sophos.com/en-us/products/free-tools/sophos-mobile-security-free-edition.aspx">
			<img src="https://nakedsecurity.sophos.com/wp-content/themes/sophosnews-2015/img/free-tools/mobile-security-android@2x.png" alt="Sophos Intercept X for Mobile" class="ns-free-tools__image" width="96" height="110">
			<h4 class="ns-free-tools__title">
				Intercept X for Mobile			</h4>
			<div class="ns-free-tools__sub-title">
				Protect Android devices			</div>
		</a>
	</div>
</div>
		</div>

			<nav class="navigation post-navigation" role="navigation">
		<h2 class="screen-reader-text">Post navigation</h2>

		<div class="nav-links">
			<div class="nav-previous"><a href="https://nakedsecurity.sophos.com/2017/05/31/keybase-adds-end-to-end-encryption-to-messages-on-the-web/" rel="prev"><span class="nav-label">Previous</span><span class="nav-seperator">:</span><span class="nav-title"> Keybase adds end-to-end encryption to messages on the web</span></a></div><div class="nav-next"><a href="https://nakedsecurity.sophos.com/2017/05/31/news-in-brief-nasa-sends-probe-to-the-sun-subway-gets-phone-coverage-facebook-pushes-back/" rel="next"><span class="nav-label">Next</span><span class="nav-seperator">:</span><span class="nav-title"> News in brief: NASA sends probe to the Sun; subway gets phone coverage; Facebook pushes back</span></a></div>		</div>
		<!-- .nav-links -->
	</nav><!-- .navigation -->
	
	
	</main><!-- #main -->

	</div> <!-- .panel-container -->
	</div> <!-- .container -->
	</section> <!-- .panel -->

	
	
	<section class="comments-panel">
	<div class="container">
	<div class="panel-content framed-content-area">

			
<div id="comments" class="comments-area">

			<h2 class="comments-title">
			4 comments on &ldquo;<span>Wolf in sheep&#8217;s clothing: a SophosLabs investigation into delivering malware via VBA</span>&rdquo;		</h2>

		<ol class="comment-list">
					<li id="comment-4760926" class="comment even thread-even depth-1 parent">
			<article id="div-comment-4760926" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/4c11f977ea96e96f1a1852fad982b15d?s=50&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/4c11f977ea96e96f1a1852fad982b15d?s=100&#038;d=mm&#038;r=g 2x' class='avatar avatar-50 photo' height='50' width='50' loading='lazy'/>						<b class="fn">RichardD</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://nakedsecurity.sophos.com/2017/05/31/wolf-in-sheeps-clothing-a-sophoslabs-investigation-into-delivering-malware-via-vba/#comment-4760926"><time datetime="2017-05-31T18:50:13+01:00">May 31, 2017 at 6:50 pm</time></a>					</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>&#8220;We’ve censored parts of the domain names.&#8221;<br />
Except you forgot to do that in the screenshot, so the first two are clearly visible. 🙂</p>
<div class="cs-rating pd-rating" id="pd_rating_holder_7238218_comm_4760926"></div>
<script type="text/javascript" charset="UTF-8"><!--//--><![CDATA[//><!--
PDRTJS_settings_7238218_comm_4760926={"id":7238218,"unique_id":"wp-comment-4760926","title":"%26quot%3BWeve%20censored%20parts%20of%20the%20domain%20names.%26quot%3BExcept%20you%20forgot%20to%20do%20that%20in%20the%20screenshot%2C%20so%20the%20first%20two%20are%20clearly%20visible.%20%3A%29%E2%80%A6","permalink":"https:\/\/nakedsecurity.sophos.com\/2017\/05\/31\/wolf-in-sheeps-clothing-a-sophoslabs-investigation-into-delivering-malware-via-vba\/#comment-4760926","item_id":"_comm_4760926"};
//--><!]]></script>
<script type="text/javascript" charset="UTF-8" src="https://polldaddy.com/js/rating/rating.js"></script>				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://nakedsecurity.sophos.com/2017/05/31/wolf-in-sheeps-clothing-a-sophoslabs-investigation-into-delivering-malware-via-vba/?replytocom=4760926#respond' data-commentid="4760926" data-postid="371433" data-belowelement="div-comment-4760926" data-respondelement="respond" data-replyto="Reply to RichardD" aria-label='Reply to RichardD'>Reply</a></div>			</article><!-- .comment-body -->
		<ul class="children">
		<li id="comment-4761038" class="comment byuser comment-author-wjbrenner bypostauthor odd alt depth-2">
			<article id="div-comment-4761038" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/3b2920e6fe250fbb023d1014d6041d95?s=50&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/3b2920e6fe250fbb023d1014d6041d95?s=100&#038;d=mm&#038;r=g 2x' class='avatar avatar-50 photo' height='50' width='50' loading='lazy'/>						<b class="fn">Bill Brenner</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://nakedsecurity.sophos.com/2017/05/31/wolf-in-sheeps-clothing-a-sophoslabs-investigation-into-delivering-malware-via-vba/#comment-4761038"><time datetime="2017-05-31T21:25:36+01:00">May 31, 2017 at 9:25 pm</time></a>					</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Thanks for catching that, Richard. All better now!</p>
<div class="cs-rating pd-rating" id="pd_rating_holder_7238218_comm_4761038"></div>
<script type="text/javascript" charset="UTF-8"><!--//--><![CDATA[//><!--
PDRTJS_settings_7238218_comm_4761038={"id":7238218,"unique_id":"wp-comment-4761038","title":"Thanks%20for%20catching%20that%2C%20Richard.%20All%20better%20now%21%E2%80%A6","permalink":"https:\/\/nakedsecurity.sophos.com\/2017\/05\/31\/wolf-in-sheeps-clothing-a-sophoslabs-investigation-into-delivering-malware-via-vba\/#comment-4761038","item_id":"_comm_4761038"};
//--><!]]></script>
<script type="text/javascript" charset="UTF-8" src="https://polldaddy.com/js/rating/rating.js"></script>				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://nakedsecurity.sophos.com/2017/05/31/wolf-in-sheeps-clothing-a-sophoslabs-investigation-into-delivering-malware-via-vba/?replytocom=4761038#respond' data-commentid="4761038" data-postid="371433" data-belowelement="div-comment-4761038" data-respondelement="respond" data-replyto="Reply to Bill Brenner" aria-label='Reply to Bill Brenner'>Reply</a></div>			</article><!-- .comment-body -->
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li id="comment-4761683" class="comment even thread-odd thread-alt depth-1">
			<article id="div-comment-4761683" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/07bb71860310df72121f2a02a1c129e2?s=50&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/07bb71860310df72121f2a02a1c129e2?s=100&#038;d=mm&#038;r=g 2x' class='avatar avatar-50 photo' height='50' width='50' loading='lazy'/>						<b class="fn">Spryte</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://nakedsecurity.sophos.com/2017/05/31/wolf-in-sheeps-clothing-a-sophoslabs-investigation-into-delivering-malware-via-vba/#comment-4761683"><time datetime="2017-06-01T15:59:17+01:00">June 1, 2017 at 3:59 pm</time></a>					</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Long ago when I first started automating spreadsheets, documents and creating PDF &#8220;forms&#8221; for users to complete I realized the potential for misuse and have always been particularly wary of these attachments/documents.<br />
Also in those days any &#8220;Scripiting Language&#8221; (VBScipt or JavaScript) could be added to Adobe Pro for automation or other purposes.<br />
It has been a long time since those days but the rise of VBA as a malicious tool does not surprise me in the least. It is a very powerful programming platform, a lot more than creating a wee macro to copy a column to a new worksheet..<br />
On an alternate point, when I Download any office document or PDF (and I download many) there is an option in my browser&#8217;s Download Manager to Analyze the file with the default Antivirus/Antimalware product registered to my computer. This is an option I Always use, even from &#8220;trusted&#8221; sites.</p>
<div class="cs-rating pd-rating" id="pd_rating_holder_7238218_comm_4761683"></div>
<script type="text/javascript" charset="UTF-8"><!--//--><![CDATA[//><!--
PDRTJS_settings_7238218_comm_4761683={"id":7238218,"unique_id":"wp-comment-4761683","title":"Long%20ago%20when%20I%20first%20started%20automating%20spreadsheets%2C%20documents%20and%20creating%20PDF%20%26quot%3Bforms%26quot%3B%20for%20users%20to%20complete%20I%20realized%20the%20potential%20for%20misuse%20and%20have%20always%20been%20particularly%20wary%20of%20these%E2%80%A6","permalink":"https:\/\/nakedsecurity.sophos.com\/2017\/05\/31\/wolf-in-sheeps-clothing-a-sophoslabs-investigation-into-delivering-malware-via-vba\/#comment-4761683","item_id":"_comm_4761683"};
//--><!]]></script>
<script type="text/javascript" charset="UTF-8" src="https://polldaddy.com/js/rating/rating.js"></script>				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://nakedsecurity.sophos.com/2017/05/31/wolf-in-sheeps-clothing-a-sophoslabs-investigation-into-delivering-malware-via-vba/?replytocom=4761683#respond' data-commentid="4761683" data-postid="371433" data-belowelement="div-comment-4761683" data-respondelement="respond" data-replyto="Reply to Spryte" aria-label='Reply to Spryte'>Reply</a></div>			</article><!-- .comment-body -->
		</li><!-- #comment-## -->
		<li id="comment-4762453" class="comment odd alt thread-even depth-1">
			<article id="div-comment-4762453" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/453bf2dce81aec8e34340e3340e9621b?s=50&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/453bf2dce81aec8e34340e3340e9621b?s=100&#038;d=mm&#038;r=g 2x' class='avatar avatar-50 photo' height='50' width='50' loading='lazy'/>						<b class="fn">James</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://nakedsecurity.sophos.com/2017/05/31/wolf-in-sheeps-clothing-a-sophoslabs-investigation-into-delivering-malware-via-vba/#comment-4762453"><time datetime="2017-06-02T19:17:14+01:00">June 2, 2017 at 7:17 pm</time></a>					</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>In Adobe Reader&#8217;s preferences, there is the option to disable JavaScript by removing a defaulted on check-box. Would disabling JavaScript prevent this attack?</p>
<div class="cs-rating pd-rating" id="pd_rating_holder_7238218_comm_4762453"></div>
<script type="text/javascript" charset="UTF-8"><!--//--><![CDATA[//><!--
PDRTJS_settings_7238218_comm_4762453={"id":7238218,"unique_id":"wp-comment-4762453","title":"In%20Adobe%20Reader%26%23039%3Bs%20preferences%2C%20there%20is%20the%20option%20to%20disable%20JavaScript%20by%20removing%20a%20defaulted%20on%20check-box.%20Would%20disabling%20JavaScript%20prevent%20this%20attack%3F%E2%80%A6","permalink":"https:\/\/nakedsecurity.sophos.com\/2017\/05\/31\/wolf-in-sheeps-clothing-a-sophoslabs-investigation-into-delivering-malware-via-vba\/#comment-4762453","item_id":"_comm_4762453"};
//--><!]]></script>
<script type="text/javascript" charset="UTF-8" src="https://polldaddy.com/js/rating/rating.js"></script>				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://nakedsecurity.sophos.com/2017/05/31/wolf-in-sheeps-clothing-a-sophoslabs-investigation-into-delivering-malware-via-vba/?replytocom=4762453#respond' data-commentid="4762453" data-postid="371433" data-belowelement="div-comment-4762453" data-respondelement="respond" data-replyto="Reply to James" aria-label='Reply to James'>Reply</a></div>			</article><!-- .comment-body -->
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		
	
	
		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">What do you think? <small><a rel="nofollow" id="cancel-comment-reply-link" href="/2017/05/31/wolf-in-sheeps-clothing-a-sophoslabs-investigation-into-delivering-malware-via-vba/#respond" style="display:none;">Cancel reply</a></small></h3><form action="https://nakedsecurity.sophos.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" /></p>
<p class="comment-form-email"><label for="email">Email</label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='371433' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="b18f0d6711" /></p><input type="hidden" id="ak_js" name="ak_js" value="173"/><textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100" style="display: none !important;"></textarea></form>	</div><!-- #respond -->
	
</div><!-- #comments -->
		<div class="comments-widget-area">
					</div>
	
	</div> <!-- .panel-container -->
	</div> <!-- .container -->
	</section> <!-- .panel -->

	

	<section class="recommended-panel">
	<div class="container">
	<div class="panel-content ">

		<h3 class="block-title">Recommended reads</h3>
	<div class="blocks">
		<article id="post-545375" class="card-slide">
	<div class="card-image">
		<div class="image-pointer"></div>
		<a href="https://nakedsecurity.sophos.com/2021/02/16/romance-scams-at-all-time-high-heres-what-you-need-to-know/"><div class="dynamic-image-frame">
		<div class="dynamic-image" style="background-image: url(https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2021/02/bh-1200.jpg?w=412&#038;h=200&#038;crop=1);"></div>
	</div></a>
	</div>
	<div class="card-content">
		<div class="meta-box">
			<div class="date-box">
				<span class="month">Feb</span><span class="day">16</span>
			</div>
 			<div class="author-box">
			<span class="by">by</span>
		Paul Ducklin	
	</div>
			<div class="comment-box">
				<span class="count">7</span>
			</div>
		</div>
		<h3 class="card-title"><a href="https://nakedsecurity.sophos.com/2021/02/16/romance-scams-at-all-time-high-heres-what-you-need-to-know/" rel="bookmark">Romance scams at all-time high: here&#8217;s what you need to know</a></h3>	</div>
</article> <!-- .card-article -->
<article id="post-563319" class="card-slide">
	<div class="card-image">
		<div class="image-pointer"></div>
		<a href="https://nakedsecurity.sophos.com/2021/03/19/serious-security-mac-supply-chain-backdoor-takes-aim-at-xcode-devs/"><div class="dynamic-image-frame">
		<div class="dynamic-image" style="background-image: url(https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2021/03/code-xcode-1200.jpg?w=412&#038;h=200&#038;crop=1);"></div>
	</div></a>
	</div>
	<div class="card-content">
		<div class="meta-box">
			<div class="date-box">
				<span class="month">Mar</span><span class="day">19</span>
			</div>
 			<div class="author-box">
			<span class="by">by</span>
		Paul Ducklin	
	</div>
			<div class="comment-box">
				<span class="count">0</span>
			</div>
		</div>
		<h3 class="card-title"><a href="https://nakedsecurity.sophos.com/2021/03/19/serious-security-mac-supply-chain-backdoor-takes-aim-at-xcode-devs/" rel="bookmark">Serious Security: Mac &#8220;XcodeSpy&#8221; backdoor takes aim at Xcode devs</a></h3>	</div>
</article> <!-- .card-article -->
<article id="post-560984" class="card-slide">
	<div class="card-image">
		<div class="image-pointer"></div>
		<a href="https://nakedsecurity.sophos.com/2021/03/10/150000-security-cameras-allegedly-breached-in-too-much-fun-hack/"><div class="dynamic-image-frame">
		<div class="dynamic-image" style="background-image: url(https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2021/03/cctv-1200.jpg?w=412&#038;h=200&#038;crop=1);"></div>
	</div></a>
	</div>
	<div class="card-content">
		<div class="meta-box">
			<div class="date-box">
				<span class="month">Mar</span><span class="day">10</span>
			</div>
 			<div class="author-box">
			<span class="by">by</span>
		Paul Ducklin	
	</div>
			<div class="comment-box">
				<span class="count">5</span>
			</div>
		</div>
		<h3 class="card-title"><a href="https://nakedsecurity.sophos.com/2021/03/10/150000-security-cameras-allegedly-breached-in-too-much-fun-hack/" rel="bookmark">150,000 security cameras allegedly breached in &#8220;too much fun&#8221; hack</a></h3>	</div>
</article> <!-- .card-article -->
	</div>

	</div> <!-- .panel-container -->
	</div> <!-- .container -->
	</section> <!-- .panel -->

	
	
	<footer id="colophon" class="site-footer" role="contentinfo">
		<div class="footer-container">
			<a href="#" class="js-collapse-footer"><svg style="height: 20px" viewBox="0 0 132 24" class="block icon sophos"><use xlink:href="#sophos"></use></svg></a>
			<div id="collapseFooter" class="blocks">
				<div class="sophos block">
					<ul id="menu-footer-primary" class="primary menu"><li id="menu-item-306737" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-306737"><a href="https://nakedsecurity.sophos.com/about/">About Naked Security</a></li>
<li id="menu-item-306754" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-306754"><a href="https://www.sophos.com/en-us/company.aspx">About Sophos</a></li>
<li id="menu-item-306747" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-306747"><a href="https://nakedsecurity.sophos.com/send-us-a-tip/">Send us a tip</a></li>
<li id="menu-item-323171" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-323171"><a href="/cookies-and-scripts/">Cookies</a></li>
<li id="menu-item-323170" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-323170"><a href="https://www.sophos.com/en-us/legal/sophos-group-privacy-policy.aspx">Privacy</a></li>
<li id="menu-item-323169" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-323169"><a href="https://www.sophos.com/en-us/legal.aspx">Legal</a></li>
</ul>				</div>
										<div class="news block">
							<ul id="menu-products-column-one" class="small menu"><li id="menu-item-306998" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-306998"><a href="https://www.sophos.com/en-us/products/intercept-x.aspx">Intercept X</a></li>
<li id="menu-item-440801" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-440801"><a href="https://www.sophos.com/en-us/products/server-security.aspx">Intercept X for Server</a></li>
<li id="menu-item-440802" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-440802"><a href="https://www.sophos.com/en-us/products/mobile-control.aspx">Intercept X for Mobile</a></li>
</ul>						</div>
											<div class="products block">
							<ul id="menu-products-column-two" class="small menu"><li id="menu-item-440803" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-440803"><a href="https://www.sophos.com/en-us/products/next-gen-firewall.aspx">XG Firewall</a></li>
<li id="menu-item-440805" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-440805"><a href="https://www.sophos.com/en-us/products/sophos-email.aspx">Sophos Email</a></li>
<li id="menu-item-440804" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-440804"><a href="https://www.sophos.com/en-us/products/secure-wifi.aspx">Sophos Wireless</a></li>
</ul>						</div>
											<div class="threats block">
							<ul id="menu-server-protection" class="small menu"><li id="menu-item-440806" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-440806"><a href="https://www.sophos.com/en-us/products/managed-threat-response.aspx">Managed Threat Response</a></li>
<li id="menu-item-448404" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-448404"><a href="https://www.sophos.com/en-us/products/cloud-optix.aspx">Cloud Optix</a></li>
<li id="menu-item-440807" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-440807"><a href="https://www.sophos.com/en-us/products/phish-threat.aspx">Phish Threat</a></li>
</ul>						</div>
								</div>
			<ul class="block social footer">
				<li class="twitter"><a rel="nofollow" href="https://twitter.com/NakedSecurity" title="Follow our team of security experts on Twitter"><svg style="height: 14px" viewBox="0 0 100 100" class="icon twitter"><use xlink:href="#twitter"></use></svg></a></li>
				<li class="facebook"><a rel="nofollow" href="https://www.facebook.com/SophosSecurity" title="Join over 250,000 people in our Facebook community"><svg style="height: 14px" viewBox="0 0 100 100" class="icon facebook"><use xlink:href="#facebook"></use></svg></a></li>
				<li class="instagram"><a rel="nofollow" href="https://www.instagram.com/nakedsecurity/" title="Follow Naked Security on Instagram"><svg style="height: 14px" viewBox="0 0 100 100" class="icon instagram"><use xlink:href="#instagram"></use></svg></a></li>
				<li class="linkedin"><a rel="nofollow" href="https://www.linkedin.com/company/5053/" title="Join the naked security discussion group on LinkedIn"><svg style="height: 14px" viewBox="0 0 100 100" class="icon linkedin"><use xlink:href="#linkedin"></use></svg></a></li>
				<li class="rss"><a rel="nofollow" href="/feed" title="Subscribe to our RSS feed"><svg style="height: 14px" viewBox="0 0 100 100" class="icon rss"><use xlink:href="#rss"></use></svg></a></li>
			</ul>

							<div class="vip-powered-wpcom">
					<span class="copyright">© 1997 - 2021 Sophos Ltd.</span>
					All rights reserved.
					Powered by <a href="https://wpvip.com/?utm_source=vip_powered_wpcom&#038;utm_medium=web&#038;utm_campaign=VIP%20Footer%20Credit&#038;utm_term=nakedsecurity.sophos.com" rel="generator nofollow" class="powered-by-wpcom">WordPress VIP</a>				</div>
					</div>
		<script type="text/javascript">
			window.cookieconsent_options = {
				"message":"This site uses cookies. By continuing to browse the site you are agreeing to our use of cookies.",
				"dismiss":"Got it!",
				"learnMore":"Learn More",
				"link":"/cookies-and-scripts",
				"theme":"https://nakedsecurity.sophos.com/wp-content/themes/sophosnews-2015/css/sophos.css"};
		</script>
	</footer><!-- #colophon -->
</div><!-- #page -->
<div id="survey-wrapper" class="mfp-hide"><div class="pd-embed" id="pd_1499706777" data-settings=""></div></div>
<script id='child-js-plugins-js-extra'>
var PG8Data = {"startPage":"1","maxPages":"0","nextLink":""};
</script>
<script id='child-js-core-js-extra'>
var Sophos = {"ajaxurl":"https:\/\/nakedsecurity.sophos.com\/wp-admin\/admin-ajax.php","nonce":"64f6810f0c"};
</script>
<script type='text/javascript' src='https://nakedsecurity.sophos.com/_static/??-eJyNjkEKwjAQRS9kOonYggvxKGLT0SZmJiGTULx9Q7HgwoXL+f89/sCSlI1ckAuUGQkFJKY5CuMi6qhND14ghfp0LJ2XA/wl2Jhxpx3bUKfGbTlRM1XGFN4dOf4FtRNpxOm73yepqs8zcH85ISxway48YqbGXuliBtOfBq3P2q8Rb09t'></script>
<script src='https://stats.wp.com/e-202112.js' defer></script>
<script>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:9.5.2',blog:'166161173',post:'371433',tz:'0',srv:'nakedsecurity.sophos.com'} ]);
	_stq.push([ 'clickTrackerInit', '166161173', '371433' ]);
</script>
</body>
</html>
