<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="google-site-verification" content="RHQeasQqjasbRt5asY6atZYbs5tr10gFBevDt2HRhW0" />
<link rel="pingback" href="https://nakedsecurity.sophos.com/xmlrpc.php">
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5VK6LTK');</script>
<!-- End Google Tag Manager -->

<meta name="description" content="Cryptography is hard. And cryptographic blunders can be hard to spot. This one was there for years..." />
<meta name="keywords" content="cryptography, vulnerability, crypto, cryptography, exploit, vulnerability" />
<title>Zerologon &#8211; hacking Windows servers with a bunch of zeros &#8211; Naked Security</title>
<meta name='robots' content='max-image-preview:large' />
<!-- Jetpack Site Verification Tags -->
<meta name="google-site-verification" content="I9dHFo-YhnK2MfAHn-20V4GnWrOttVUYyISGamyU41M" />
<meta name="msvalidate.01" content="7D8D1FA2892142B1543D2CBCD07FB88F" />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel='dns-prefetch' href='//v0.wordpress.com' />
<link rel="alternate" type="application/rss+xml" title="Naked Security &raquo; Feed" href="https://nakedsecurity.sophos.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Naked Security &raquo; Comments Feed" href="https://nakedsecurity.sophos.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Naked Security &raquo; Zerologon &#8211; hacking Windows servers with a bunch of zeros Comments Feed" href="https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/feed/" />
<link rel='stylesheet' id='all-css-0' href='https://nakedsecurity.sophos.com/_static/??-eJyVz00KwjAQhuELmUwjptCFeJY0HUw0f2QmlN6+KXbnRpcD7wPfwFqETza0BQksESyeGOaQ7VsEP1dTNyDeAsrok+zBBbqwOTEmBnYYu6NcXKaEK4nroPQJ/olFMIzEv5pjqFkku4qGhWs9rtLE8uVjEyW0p08EL+Ri+leT/PjzPsgj3tWo9G0ctJp2dx1jEg==' type='text/css' media='all' />
<style id='wp-block-library-inline-css'>
.has-text-align-justify{text-align:justify;}
</style>
<script type='text/javascript' src='https://nakedsecurity.sophos.com/_static/??-eJzTLy/QzcxLzilNSS3WzwKiwtLUokoopZebmaeXVayjj0+Rbm5melFiSSpUsX2uraGZoamxkaGpmWEWAK8/Ihc='></script>
<link rel="https://api.w.org/" href="https://nakedsecurity.sophos.com/wp-json/" /><link rel="alternate" type="application/json" href="https://nakedsecurity.sophos.com/wp-json/wp/v2/posts/525451" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://nakedsecurity.sophos.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://nakedsecurity.sophos.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.7" />
<link rel="canonical" href="https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/" />
<link rel='shortlink' href='https://nakedsecurity.sophos.com/?p=525451' />
<link rel="alternate" type="application/json+oembed" href="https://nakedsecurity.sophos.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fnakedsecurity.sophos.com%2F2020%2F09%2F17%2Fzerologon-hacking-windows-servers-with-a-bunch-of-zeros%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://nakedsecurity.sophos.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fnakedsecurity.sophos.com%2F2020%2F09%2F17%2Fzerologon-hacking-windows-servers-with-a-bunch-of-zeros%2F&#038;format=xml" />
<style type='text/css'>img#wpstats{display:none}</style><link rel="amphtml" href="https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/amp/">
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Zerologon &#8211; hacking Windows servers with a bunch of zeros" />
<meta property="og:url" content="https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/" />
<meta property="og:description" content="Cryptography is hard. And cryptographic blunders can be hard to spot. This one was there for years&#8230;" />
<meta property="article:published_time" content="2020-09-17T18:13:17+00:00" />
<meta property="article:modified_time" content="2020-09-23T22:03:09+00:00" />
<meta property="og:site_name" content="Naked Security" />
<meta property="og:image" content="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-1200.png?w=775" />
<meta property="og:image:secure_url" content="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-1200.png?w=775" />
<meta property="og:image:width" content="775" />
<meta property="og:image:height" content="405" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:creator" content="@NakedSecurity" />
<meta name="twitter:site" content="@NakedSecurity" />
<meta name="twitter:text:title" content="Zerologon &#8211; hacking Windows servers with a bunch of zeros" />
<meta name="twitter:image" content="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-1200.png?w=640" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="fb:admins" content="28552295016" />

<!-- End Jetpack Open Graph Tags -->
<link rel="icon" href="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/03/cropped-sophos.png?w=32" sizes="32x32" />
<link rel="icon" href="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/03/cropped-sophos.png?w=192" sizes="192x192" />
<link rel="apple-touch-icon" href="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/03/cropped-sophos.png?w=180" />
<meta name="msapplication-TileImage" content="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/03/cropped-sophos.png?w=270" />
</head>
<body class="post-template-default single single-post postid-525451 single-format-standard" >
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5VK6LTK"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<div style="display: none">
<svg>
	<symbol id="sophos" viewBox="0 0 132 24">
		<path d="m111.82 22.176h11.64c3.267 0 4.65-0.2 5.74-0.896 1.715-1.063 2.804-3.26 2.804-5.62 0-1.928-0.658-3.89-1.647-4.888-1.288-1.33-3.035-1.828-6.271-1.828h-3.527c-1.586 0-2.754-0.067-3.412-0.365-0.794-0.367-1.256-1.165-1.256-2.161 0-1.165 0.56-2.03 1.486-2.264 0.692-0.163 1.498-0.163 3.574-0.198h10.419v-3.956h-11.473c-2.574 0-3.727 0.099-4.718 0.466-2.279 0.796-3.828 3.257-3.828 6.083 0 1.93 0.76 3.727 2.079 4.89 1.155 0.996 2.872 1.462 5.51 1.462h4.697c1.057 0 1.915 0.132 2.376 0.398 0.893 0.433 1.418 1.328 1.418 2.36 0 0.864-0.395 1.597-1.087 2.027-0.561 0.369-1.517 0.534-3.268 0.534h-11.256zm-111.35 0h11.64c3.267 0 4.652-0.2 5.741-0.896 1.714-1.063 2.803-3.26 2.803-5.62 0-1.928-0.66-3.89-1.65-4.888-1.285-1.33-3.034-1.828-6.27-1.828h-3.527c-1.584 0-2.751-0.067-3.41-0.365-0.792-0.367-1.253-1.165-1.253-2.161 0-1.165 0.56-2.03 1.484-2.264 0.693-0.163 1.496-0.163 3.574-0.198h10.42v-3.956h-11.477c-2.573 0-3.727 0.099-4.715 0.466-2.278 0.796-3.83 3.257-3.83 6.083 0 1.93 0.762 3.727 2.08 4.89 1.155 0.996 2.871 1.462 5.51 1.462h4.696c1.057 0 1.913 0.132 2.377 0.398 0.888 0.433 1.416 1.328 1.416 2.36 0 0.864-0.394 1.597-1.089 2.027-0.558 0.369-1.517 0.534-3.264 0.534h-11.256v3.956zm94.05-16.18c-0.68 1.076-1.003 2.803-1.003 5.122 0 5.088 1.747 7.405 5.63 7.405 3.822 0 5.568-2.317 5.568-7.34 0-5.092-1.715-7.373-5.568-7.373-2.102 0-3.754 0.784-4.627 2.186zm13.174-2.511c1.329 1.761 2.072 4.63 2.072 7.992 0 3.816-1.197 6.948-3.334 8.677-1.619 1.304-4.078 2.022-6.995 2.022-4.142 0-7.41-1.372-9.092-3.817-1.263-1.793-1.88-4.176-1.88-7.08 0-4.172 1.133-7.339 3.27-9.035 1.682-1.37 4.339-2.122 7.383-2.122 3.85 0 6.925 1.209 8.576 3.363zm-22.018-3.068h-4.596v8.908h-8.319v-8.908h-4.597v21.759h4.597v-8.97h8.318v8.97h4.596v-21.759zm-28.61 10.277c1.23 0 1.941-0.163 2.427-0.62 0.581-0.49 0.938-1.533 0.938-2.74 0-1.436-0.58-2.478-1.584-2.838-0.356-0.13-0.94-0.197-1.684-0.197h-6.344v6.395zm-6.247 11.481h-4.598v-21.758h10.78c3.786 0 5.114 0.39 6.538 1.991 1.264 1.37 1.942 3.163 1.942 5.088 0 2.284-0.904 4.404-2.394 5.676-1.262 1.077-2.43 1.402-4.888 1.402h-7.38zm-22.589-16.179c-0.682 1.076-1.004 2.803-1.004 5.122 0 5.088 1.748 7.405 5.634 7.405 3.818 0 5.568-2.317 5.568-7.34 0-5.092-1.716-7.373-5.568-7.373-2.106 0-3.757 0.784-4.63 2.186zm13.174-2.511c1.328 1.761 2.073 4.63 2.073 7.992 0 3.816-1.2 6.948-3.335 8.677-1.618 1.304-4.079 2.022-6.993 2.022-4.144 0-7.413-1.372-9.096-3.817-1.264-1.793-1.878-4.176-1.878-7.08 0-4.172 1.133-7.339 3.272-9.035 1.681-1.37 4.337-2.122 7.38-2.122 3.851 0 6.93 1.209 8.578 3.363z"></path>
	</symbol>
	<symbol id="twitter" viewBox="0 0 24 24">
 		<path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"></path>
 	</symbol>
	<symbol id="facebook" viewBox="0 0 24 24">
 		<path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"></path>
 	</symbol>
	<symbol id="instagram" viewBox="0 0 24 24">
		<path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"></path>
	</symbol>
	<symbol id="linkedin" viewBox="0 0 24 24">
		<path d="M4.98 3.5c0 1.381-1.11 2.5-2.48 2.5s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zm.02 4.5h-5v16h5v-16zm7.982 0h-4.968v16h4.969v-8.399c0-4.67 6.029-5.052 6.029 0v8.399h4.988v-10.131c0-7.88-8.922-7.593-11.018-3.714v-2.155z"></path>
	</symbol>
	<symbol id="rss" viewBox="0 0 24 24">
		<path d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z"></path>
	</symbol>
	<symbol id="reddit" viewBox="0 0 24 24">
		<path d="M24 11.779c0-1.459-1.192-2.645-2.657-2.645-.715 0-1.363.286-1.84.746-1.81-1.191-4.259-1.949-6.971-2.046l1.483-4.669 4.016.941-.006.058c0 1.193.975 2.163 2.174 2.163 1.198 0 2.172-.97 2.172-2.163s-.975-2.164-2.172-2.164c-.92 0-1.704.574-2.021 1.379l-4.329-1.015c-.189-.046-.381.063-.44.249l-1.654 5.207c-2.838.034-5.409.798-7.3 2.025-.474-.438-1.103-.712-1.799-.712-1.465 0-2.656 1.187-2.656 2.646 0 .97.533 1.811 1.317 2.271-.052.282-.086.567-.086.857 0 3.911 4.808 7.093 10.719 7.093s10.72-3.182 10.72-7.093c0-.274-.029-.544-.075-.81.832-.447 1.405-1.312 1.405-2.318zm-17.224 1.816c0-.868.71-1.575 1.582-1.575.872 0 1.581.707 1.581 1.575s-.709 1.574-1.581 1.574-1.582-.706-1.582-1.574zm9.061 4.669c-.797.793-2.048 1.179-3.824 1.179l-.013-.003-.013.003c-1.777 0-3.028-.386-3.824-1.179-.145-.144-.145-.379 0-.523.145-.145.381-.145.526 0 .65.647 1.729.961 3.298.961l.013.003.013-.003c1.569 0 2.648-.315 3.298-.962.145-.145.381-.144.526 0 .145.145.145.379 0 .524zm-.189-3.095c-.872 0-1.581-.706-1.581-1.574 0-.868.709-1.575 1.581-1.575s1.581.707 1.581 1.575-.709 1.574-1.581 1.574z"></path>
	</symbol>
</svg>
</div>
<div id="page" class="hfeed site">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

	
	<header id="masthead" class="site-header variation variation-3" role="banner">
		<div class="header-container">
			<div class="site-branding">
				<div class="site-title">
					<a title="Naked Security" href="https://nakedsecurity.sophos.com/" rel="home"><img src="https://nakedsecurity.sophos.com/wp-content/themes/sophosnews-2015/img/naked-security-logo-white@2x.png"></a>
					by
					<a title="sophos.com" href="https://www.sophos.com"><svg viewBox="0 0 132 24" class="icon sophos"><use xlink:href="#sophos"></use></svg></a>
				</div>
			</div><!-- .site-branding -->
			<nav id="site-navigation" class="main-navigation" role="navigation">
				<div class="container">
					<ul id="menu-variation-two" class="exit-links menu"><li id="menu-item-436509" class="products menu-item menu-item-type-custom menu-item-object-custom menu-item-436509"><a href="#">Products</a></li>
<li id="menu-item-436515" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-436515"><a href="https://www.sophos.com/en-us/products/free-tools.aspx">Free Tools</a></li>
<li id="menu-item-436531" class="search-toggle menu-item menu-item-type-custom menu-item-object-custom menu-item-436531"><a href="#">Search</a></li>
<li id="menu-item-436532" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-436532"><a href="https://home.sophos.com/en-us.aspx">Free Sophos Home</a></li>
</ul>				</div>
			</nav><!-- #site-navigation -->
			<div class="site-search-block">
	<form target="_top" role="search" class="search-form" method="get" action="https://nakedsecurity.sophos.com/">
        <fieldset>
            <div class="field">
				<input type="search" value="" name="s" class="search-field" placeholder="Search naked security...">
            </div>
            <div class="submit">
				<button type="submit" class="search-submit button">Go</button>
            </div>
        </fieldset>
    </form>
</div>
		</div><!-- .container -->
	</header>

	<div class="responsive-flyout-panel small-12 column active" style="opacity: 1; display: none;">
		<div class="modal-filler"></div>
	    <div class="productNavBox">
	        <div class="productNavContainer">
	            <div class="row prodRow">
	                <div class="prodListBox column large-9">
	                    <div class="row margin-0 highlightProduct">
	                        <div class="column medium-6">
	                            <a href="https://www.sophos.com/products/next-gen-firewall.aspx"><img src="https://www.sophos.com/medialibrary/2F4785DE8C3F43ECBD699A18F332FEEB.ashx">
	                                <div class="menu-section-header">
										<div class="menu-section-title">XG Firewall</div>
	                                	<div class="menu-section-subtitle">Next-Gen Firewall</div>
									</div>
	                            </a>
	                        </div>
	                        <div class="column medium-6">
	                            <a href="https://www.sophos.com/products/intercept-x.aspx"><img src="https://www.sophos.com/medialibrary/27111765D65A45D49A232925D2CE428B.ashx">
	                                <div class="menu-section-header">
										<div class="menu-section-title">Intercept X</div>
	                                	<div class="menu-section-subtitle">Next-Gen Endpoint</div>
									</div>
	                            </a>
	                        </div>
	                    </div>
	                    <div class="productList">
	                        <ul>
								<li>
									<a href="https://www.sophos.com/en-us/products/cloud-optix.aspx"><img src="https://www.sophos.com/medialibrary/SophosNext/Images/Products/Icons/sophos-cloud-optix-icon.svg">Sophos Cloud Optix</a>
								</li>
	                            <li>
	                                <a href="https://www.sophos.com/products/sophos-central.aspx"><img src="https://www.sophos.com/medialibrary/08EA66123F1B4DDE8FE5C9B578A7FAA7.ashx">Sophos Central</a>
	                            </li>
	                            <li>
	                                <a href="https://www.sophos.com/products/mobile-control.aspx"><img src="https://www.sophos.com/medialibrary/678FE994855047739F50D6C411184FA6.ashx">Sophos Mobile</a>
	                            </li>
	                            <li>
	                                <a href="https://www.sophos.com/products/server-security.aspx"><img src="https://www.sophos.com/medialibrary/01B80E7D7CD54EF8AC2E51C9C6EC0236.ashx">Intercept X for Server</a>
	                            </li>
	                            <li>
	                                <a href="https://www.sophos.com/products/secure-wifi.aspx"><img src="https://www.sophos.com/medialibrary/BEBD9C41BB4E480498514B29B92A145A.ashx">Secure Wi-Fi</a>
	                            </li>
	                            <li>
	                                <a href="https://www.sophos.com/products/phish-threat.aspx"><img src="https://www.sophos.com/medialibrary/DC9D1A7BA3964B0C9DAF1F1E68806B5A.ashx">Phish Threat</a>
	                            </li>
	                            <li>
	                                <a href="https://www.sophos.com/products/safeguard-encryption.aspx"><img src="https://www.sophos.com/medialibrary/8F51F06B62814B108D3B2763FF018E37.ashx">SafeGuard Encryption</a>
	                            </li>
	                            <li>
	                                <a href="https://www.sophos.com/products/sophos-email.aspx"><img src="https://www.sophos.com/medialibrary/597ADA0AF01A4A12B2B27239D0F9992C.ashx">Secure Email</a>
	                            </li>
	                            <li>
	                                <a href="https://www.sophos.com/products/unified-threat-management.aspx"><img src="https://www.sophos.com/medialibrary/8CB72BF5E1AD41F7894CE5E42101B0F3.ashx">SG UTM</a>
	                            </li>
	                            <li>
	                                <a href="https://www.sophos.com/products/secure-web-gateway.aspx"><img src="https://www.sophos.com/medialibrary/C586E372694547A1B207A61D87246BA7.ashx">Secure Web Gateway</a>
	                            </li>
	                        </ul>
	                    </div>
	                </div>
	                <div class="homeUserBox column large-3">
						<img src="https://www.sophos.com/medialibrary/3376DF5742A64AEE93FDB9DCA7291239.ashx">
						<div class="menu-section-title">For Home Users</div>
	                    <p>Sophos Home protects every Mac and PC in your home </p><a href="https://home.sophos.com/" target="_blank" class="greenSmallMenuBtn">Learn More</a>
					</div>
	            </div>
	            <div class="row blueRow">
	                <div class="column large-3 medium-6">
	                    <a href="https://www.sophos.com/products/free-tools.aspx"><img width="19" src="https://www.sophos.com/medialibrary/A1FF440D2BB84511B8C94D771D44E207.ashx">Free Security Tools</a>
	                </div>
	                <div class="column large-3 medium-6">
	                    <a href="https://www.sophos.com/products/free-trials.aspx"><img width="20" src="https://www.sophos.com/medialibrary/FCD3410ED2C347808D9DB8AC12C62DBD.ashx">Free Trials</a>
	                </div>
	                <div class="column large-3 medium-6">
	                    <a href="https://www.sophos.com/products/demos.aspx"><img width="18" src="https://www.sophos.com/medialibrary/50985180E5F54C94917A2A6508E24287.ashx">Product Demos</a>
	                </div>
	                <!-- <div class="column large-3 medium-6">
	                    <a href="javascript:fairfax.openLiveChatFromFlyoutLink();" class="flyout-live-chat-link"><img width="20" src="https://www.sophos.com/medialibrary/E24C5050837145F6A5C592E299BA2A0D.ashx">Live Sales Chat</a>
	                </div> -->
	            </div>
	        </div>
	    </div>
	</div>
	<script>

	jQuery(document).ready( function () {
		var productButton   = jQuery('nav .menu-item.products');
		var modalBackground = jQuery('.modal-filler');
		var flyoutMenu		= jQuery('.responsive-flyout-panel');
		var Sophos			= Sophos || {};

		Sophos.MenuTest = {};

		Sophos.MenuTest.open = function () {
				productButton.addClass('open');
				flyoutMenu.show();
				modalBackground.show();
		};

		Sophos.MenuTest.close = function () {
			productButton.removeClass('open');
			flyoutMenu.hide();
			modalBackground.hide();
		};

		Sophos.MenuTest.toggle = function () {
			if ( productButton.hasClass('open') ) {
				Sophos.MenuTest.close();
			} else {
				Sophos.MenuTest.open();
			}
		};

		productButton.click( Sophos.MenuTest.toggle );
		modalBackground.click( Sophos.MenuTest.close );
	});

	</script>

	
	<section class="about-panel">
	<div class="container">
	<div class="panel-content ">

		<div class="description"><span>Have you listened to our podcast? <a href="/podcast/">Listen now</a></span></div>

	</div> <!-- .panel-container -->
	</div> <!-- .container -->
	</section> <!-- .panel -->

	
	<div id="content" class="site-content">
		<div class="content-container">

</div> <!-- .container -->
</div> <!-- #content -->


	<section class="content-panel">
	<div class="container">
	<div class="panel-content framed-content-area">

		<main id="main" class="site-main" role="main">

	
		
<article id="post-525451" class="post-525451 post type-post status-publish format-standard has-post-thumbnail hentry category-cryptography category-featured category-vulnerability tag-crypto tag-cryptography tag-exploit tag-vulnerability-2">

	<header class="entry-header">
		<h1 class="entry-title">Zerologon &#8211; hacking Windows servers with a bunch of zeros</h1>		<div class="entry-meta">
			<div>
				
	<span class="entry-published">
		<time class="entry-date published" datetime="2020-09-17T19:13:17+01:00">17 Sep 2020</time>
	</span>

					<a href="#comments" class="comment-box">
					<span class="count">14</span>
				</a>
					
	<span class="entry-categories">
	<a href="https://nakedsecurity.sophos.com/category/cryptography/">Cryptography</a>, <a href="https://nakedsecurity.sophos.com/category/security-threats/vulnerability/">Vulnerability</a>	</span>

			</div>
	</header> <!-- .entry-header -->

    <div id="newsletter-signup" class="container top"></div>

			<div class="entry-featured-image">
			<img width="780" height="408" src="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-1200.png?w=780&amp;h=408&amp;crop=1" class="attachment-hero-thumbnail size-hero-thumbnail wp-post-image" alt="" loading="lazy" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-1200.png 1200w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-1200.png?resize=300,157 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-1200.png?resize=768,401 768w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-1200.png?resize=1024,535 1024w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-1200.png?resize=780,408 780w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-1200.png?resize=100,52 100w" sizes="(max-width: 780px) 100vw, 780px" />					</div> <!-- .entry-featured-image -->
		
		<nav class="navigation post-navigation" role="navigation">
		<h2 class="screen-reader-text">Post navigation</h2>

		<div class="nav-links">
			<div class="nav-previous"><a href="https://nakedsecurity.sophos.com/2020/09/14/naked-security-live-should-you-worry-about-your-wallpaper/" rel="prev"><span class="nav-label">Previous</span><span class="nav-seperator">:</span><span class="nav-title"> Naked Security Live &#8211; &#8220;Should you worry about your wallpaper?&#8221;</span></a></div><div class="nav-next"><a href="https://nakedsecurity.sophos.com/2020/09/18/a-real-life-maze-ransomware-attack-if-at-first-you-dont-succeed/" rel="next"><span class="nav-label">Next</span><span class="nav-seperator">:</span><span class="nav-title"> A real-life Maze ransomware attack &#8211; &#8220;If at first you don&#8217;t succeed&#8230;&#8221;</span></a></div>		</div>
		<!-- .nav-links -->
	</nav><!-- .navigation -->
	
	<div class="entry-content">
		<div class="entry-prefix">
			<div class="entry-author">
				
	
					<span class="by">by</span>
			<a href="https://nakedsecurity.sophos.com/author/paul-ducklin/" title="Posts by Paul Ducklin" class="author url fn" rel="author">Paul Ducklin</a>		
	
				</div>
			<div class="entry-sharing">
				
	<ul class="block social share">
		<li class="facebook"><a href="https://www.facebook.com/share.php?u=https%3A%2F%2Fnakedsecurity.sophos.com%2F2020%2F09%2F17%2Fzerologon-hacking-windows-servers-with-a-bunch-of-zeros%2F&title=Zerologon+%E2%80%93+hacking+Windows+servers+with+a+bunch+of+zeros" data-title="Zerologon – hacking Windows servers with a bunch of zeros" title="Share on Facebook"><svg style="height: 20px;" viewBox="0 0 100 100" class="icon facebook"><use xlink:href="#facebook"></use></svg></a></li>
		<li class="twitter"><a href="https://twitter.com/intent/tweet?text=Zerologon+%E2%80%93+hacking+Windows+servers+with+a+bunch+of+zeros+https%3A%2F%2Fnakedsecurity.sophos.com%2F%3Fp%3D525451" data-title="Zerologon &#8211; hacking Windows servers with a bunch of zeros" title="Share on Twitter"><svg style="height: 20px;" viewBox="0 0 100 100" class="icon twitter"><use xlink:href="#twitter"></use></svg></a></li>
		<li class="linkedin"><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fnakedsecurity.sophos.com%2F2020%2F09%2F17%2Fzerologon-hacking-windows-servers-with-a-bunch-of-zeros%2F&title=Zerologon+%E2%80%93+hacking+Windows+servers+with+a+bunch+of+zeros" data-title="Zerologon – hacking Windows servers with a bunch of zeros" title="Share on LinkedIn"><svg style="height: 20px;"  viewBox="0 0 100 100" class="icon linkedin"><use xlink:href="#linkedin"></use></svg></a></li>
		<li class="reddit"><a href="https://reddit.com/submit/?url=https%3A%2F%2Fnakedsecurity.sophos.com%2F2020%2F09%2F17%2Fzerologon-hacking-windows-servers-with-a-bunch-of-zeros%2F&title=Zerologon+%E2%80%93+hacking+Windows+servers+with+a+bunch+of+zeros" title="Share on Reddit"><svg style="height: 20px;"  viewBox="0 0 100 100" class="icon reddit"><use xlink:href="#reddit"></use></svg></a></li>

			</ul>

				</div>
		</div>
		<p>The big, bad bug of the week is called <strong>Zerologon</strong>.</p>
<p>As you can probably tell from the name, it involves Windows &#8211; everyone else talks about logging <i>in</i>, but on Windows you&#8217;ve always very definitely logged <i>on</i> &#8211; and it is an authentication bypass, because it lets you get away with using a zero-length password.</p>
<p>You&#8217;ll also see it referred to as CVE-2020-1472, and the good news is that it was patched in Microsoft&#8217;s <a href="https://news.sophos.com/en-us/2020/08/11/the-1337est-print-spooler-bug-fixed-in-august-2020s-patch-tuesday/" rel="nofollow">August 2020 update</a>.</p>
<p>In other words, if you practise proper patching, you don&#8217;t need to panic. (Yes, that&#8217;s an undisguised hint: if you haven&#8217;t patched your Windows servers yet from back in August 2020, please go and do so now, for everyone&#8217;s sake, not just your own.)</p>
<p>Nevertheless, Zerologon is a fascinating story that reminds us all of two very important lessons, namely that:</p>
<ol>
<li><strong>Cryptography is hard to get right.</strong></li>
<li><strong>Cryptographic blunders can take years to spot.</strong></li>
</ol>
<p>The gory details of the bug weren&#8217;t disclosed by Microsoft back in August 2020, but researchers at Dutch cybersecurity company Secura dug into the affected Windows component, Netlogon, and figured out a bunch of serious <a href="https://www.secura.com/pathtoimg.php?id=2055" rel="nofollow">cryptographic holes</a> in the unpatched version, and how to exploit them.</p>
<p>In this article, we aren&#8217;t going to construct an attack or show you how to create network packets to exploit the flaw, but we are going to look at the cryptographic problems that lay unnoticed in the Microsoft Netlogon Remote Protocol for many years.</p>
<p>After all, those who cannot remember history are condemned to repeat it.</p>
<aside id="sophos_ad-3" class="widget sophos-inline-ad sophos_widget_ad">				<style></style>
				<div class="sophos_widget_ad"><a href="https://www.sophos.com/en-us/products/managed-threat-response.aspx" class="s-ad-threat-hunter__link-wrapper">
  <div class="s-ad-threat-hunter">
    <div class="s-ad-threat-hunter__title">
      OTHERS STOP AT NOTIFICATION. WE TAKE ACTION
    </div>
    <div class="s-ad-threat-hunter__text">
      Get 24/7 managed threat hunting, detection, and response delivered by
      Sophos experts
    </div>
    <div class="s-ad-threat-hunter__action">
      <span class="s-button s-button--bright-green"> Learn&nbsp;more </span>
    </div>
  </div>
</a></div>
			</aside>
<h2>Authenticating via Netlogon</h2>
<p>Netlogon is a network protocol that, in its own words, &#8220;is a remote procedure call (RPC) interface that is used for user and machine authentication on domain-based networks.&#8221;</p>
<p>At 280 pages, the <a href="https://winprotocoldoc.blob.core.windows.net/productionwindowsarchives/MS-NRPC/%5BMS-NRPC%5D.pdf" rel="nofollow">Netlogon Remote Protocol Specification</a> &#8211; it&#8217;s an open specification these days, not proprietary to Microsoft &#8211; is a lot shorter than Bluetooth, but far longer than any programming team can take in over a period of months or years, let alone days or weeks.</p>
<p>Its length comes in part from the fact that there are often many different ways of doing the same thing, somtimes with multiple different fallback algorithms that have been kept on to ensure backwards compatibility with older devices.</p>
<p>Ironically, perhaps, Section 5, <em>Security Considerations</em>, has just two short parts: a one-page subsection entitled <em>Security Considerations for Implementors</em>, and a brief (though admittedly useful) table called <em>Index of Security Parameters</em> that links to various important sections in the specification.</p>
<figure id="attachment_525454" aria-describedby="caption-attachment-525454" style="width: 720px" class="wp-caption aligncenter"><img loading="lazy" src="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-index-720.png" class="size-full wp-image-525454" alt="" width="720" height="570" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-index-720.png 720w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-index-720.png?resize=300,238 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-index-720.png?resize=88,70 88w" sizes="(max-width: 720px) 100vw, 720px" /><figcaption id="caption-attachment-525454" class="wp-caption-text">Netlogon Protocol security parameters list.<br />The highlighted items are the ones we look at in this article.</figcaption></figure>
<h2>Getting started with Netlogon</h2>
<p>A client computer that wants to communicate with a Netlogon server such as a Windows domain controller starts by sending eight random bytes (what&#8217;s often called a <em>nonce</em>, short for <em>number used once</em>) to the server.</p>
<p>The server replies with 8 random bytes of its own, as explained in section 3.1.4.1, <em>Session-Key Negotiation</em>:</p>
<pre>    REQUEST --&gt; ClientChallenge (8 random bytes, e.g. 452fdbfd2e38b9e0) --&gt;     
     REPLY &lt;-- ServerChallenge (8 random bytes, e.g. 7696398fe5417372) &lt;-- </pre>
<p>As shown above, Microsoft refers to these nonces as <code>ClientChallenge</code> (CC) and <code>ServerChallenge</code> (SC) respectively, if you want to match up this discussion with the protocol documentation.</p>
<p>Both sides then scramble up the two random strings together with a shared secret to concoct a one-off encryption key, known as the <code>SessionKey</code> (SK).</p>
<p>On a Windows network, the secret component is the domain password of the computer you&#8217;re connecting from.</p>
<p>On the client, this is stored securely by Windows in the registry; on the domain controller, it&#8217;s stored in the Active Directory database.</p>
<p>This <code>SessionKey</code> scrambling is done using the keyed cryptographic hash called <a href="https://nakedsecurity.sophos.com/2013/11/20/serious-security-how-to-store-your-users-passwords-safely/">HMAC-SHA256</a>.</p>
<p>The algorithm is specified in section 3.1.4.3.1, <em>AES Session-Key</em>, and in pseudocode it looks like this:</p>
<p><img loading="lazy" src="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-sk-720.png" class="aligncenter size-full wp-image-525457" alt="" width="720" height="250" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-sk-720.png 720w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-sk-720.png?resize=300,104 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-sk-720.png?resize=100,35 100w" sizes="(max-width: 720px) 100vw, 720px" /></p>
<p>Assuming that the client requesting access has the same password stored locally as the Netlogon server has on record centrally, and given that each side has already told the other its 8-byte random challenge, both sides should now have arrived at the same, one-off <code>SessionKey</code> value (SK) to secure the rest of their communication.</p>
<p>This session key setup avoids using the secret password directly in encrypting Netlogon traffic, and ensures a unique key for each session, into which both parties inject their own randomness. (This is a common approach: setting up a WPA-2 wireless connection using a pre-shared key follows a <a href="https://nakedsecurity.sophos.com/2017/10/16/wi-fi-at-risk-from-krack-attacks-heres-what-to-do/">similar process</a>.)</p>
<p>In theory, the server could blindly assume that the client knows the real password by simply accepting encrypted function calls immediately; if the client had cheated so far by using a made-up password, the requests wouldn&#8217;t decrypt properly and the ruse would fail.</p>
<p>Good practice, however, says that each end should verify the other first, for example by encrypting a known test string that the other end can validate, and that&#8217;s what happens next.</p>
<p>Obviously, the client can&#8217;t share the session key directly because that would let anyone else on the network sniff it out and hijack the session.</p>
<p>Instead, the client proves that it knows the session key by encrypting the <code>ClientChallenge</code> that it committed to at the start, using the <code>SessionKey</code> it just calculated.</p>
<p>Microsoft calls this the <em>Netlogon Credential Computation</em>, detailed in section 3.1.4.4.1:</p>
<p><img loading="lazy" src="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-credcomp-720-1.png" class="aligncenter size-full wp-image-525460" alt="" width="720" height="100" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-credcomp-720-1.png 720w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-credcomp-720-1.png?resize=300,42 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-credcomp-720-1.png?resize=100,14 100w" sizes="(max-width: 720px) 100vw, 720px" /></p>
<p>At the other end, the server does the same thing in reverse, and verifies that the original <code>ClientChallenge</code> comes out correctly when the ciphertext is decrypted with the session key.</p>
<p>At this point, it looks as though an imposter client is stuck.</p>
<p>Without the right secret password, which you can only get by already having administrator-level access to a trusted computer on the network, you won&#8217;t get the same session key as the server.</p>
<p>Without the right session key, you won&#8217;t produce an encrypted version of your original 8-byte random string that the server will accept to authenticate you.</p>
<h2>A chink in the armour</h2>
<p>At this point, if you&#8217;re interested in cryptography, you&#8217;re probably wondering, &#8220;What on earth is the encryption algorithm dubbed <code>AES-128-CFB8</code> in the pseudocode above?&#8221;</p>
<p>Let&#8217;s investigate.</p>
<p>AES, short for <em>Advanced Encryption Standard,</em> sounds like a good choice because it&#8217;s currently accepted as a strong algorithm with no known security holes.</p>
<p>Also, a key size of 128 bits is currently regarded as satisfactory because it would take too long to try all possible 2<sup>128</sup> keys, even if you harnessed all of the world&#8217;s computing power for yourself.</p>
<p style="background-color: #e8e8e8;font-size: 80%;padding: 1em 2em;margin: 2em 0">For the record: AES doesn&#8217;t use any internal calculations that could be sped up with so-called <a href="https://nakedsecurity.sophos.com/2019/02/07/serious-security-post-quantum-cryptography-and-why-we-are-getting-it/">quantum algorithms</a>, so it is considered <a href="https://nakedsecurity.sophos.com/2019/02/07/serious-security-post-quantum-cryptography-and-why-we-are-getting-it/">post-quantum secure</a>. Even if a truly powerful quantum computer were built tomorrow, it wouldn&#8217;t be of any special use, so far as we know, in cracking AES faster than we can with regular computers today.</p>
<p>But algorithms like AES can be used in many different modes, and not all of them are suitable for all purposes.</p>
<p>The best-known mode, which you can think of as &#8220;straight encryption&#8221;, is called <code>AES-128-ECB</code>, and it scrambles 16 bytes of input at a time, directly producing 16 bytes of output.</p>
<p>Note that we&#8217;ve simplified these diagrams by pretending that AES-128 works on 4 bytes (32 bits) at a time instead of 16 bytes (128 bits), but the underlying principles are still clear:</p>
<p><img loading="lazy" src="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-ecb-720.png" class="aligncenter size-full wp-image-525462" alt="" width="720" height="241" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-ecb-720.png 720w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-ecb-720.png?resize=300,100 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-ecb-720.png?resize=100,33 100w" sizes="(max-width: 720px) 100vw, 720px" /></p>
<p>ECB stands for <em>Electronic Code Book</em>, because the cipher in this mode does indeed work like an unimaginably large codebook.</p>
<p style="background-color: #e8e8e8;font-size: 80%;padding: 1em 2em;margin: 2em 0">The codebook moniker is entirely theoretical. In practice, you would need a different codebook for every one of the 2<sup>128</sup> different keys, with each book listing every one of the encryption values for each of the 2<sup>128</sup> different 16-byte input strings. And you would need a further 2<sup>128</sup> (that&#8217;s 300 million million million million million million) codebooks to list all the possible decryptions, too, if you ever had the space or time to unscramble what you had previously encrypted.</p>
<p>Unfortunately, the simplicity of codebook mode is also a weakness, because any time there is repeated text in one of the input blocks, you&#8217;ll know because you&#8217;ll get a repeat in the ciphertext, too:</p>
<p><img loading="lazy" src="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-ecb-problem-720.png" class="aligncenter size-full wp-image-525463" alt="" width="720" height="238" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-ecb-problem-720.png 720w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-ecb-problem-720.png?resize=300,99 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-ecb-problem-720.png?resize=100,33 100w" sizes="(max-width: 720px) 100vw, 720px" /></p>
<p>At best, ECB leaks whether there are any patterns in the input, something that an encryption algorithm should conceal.</p>
<p>At worst, it means that if ever you figure out what the plaintext was in one part of the input &#8211; a chapter heading, for example, or part of a Bitcoin address &#8211; you will automatically be able to decrypt that text everywhere else it appears.</p>
<p>Various solutions exist to use block-based encryption algorithms so they don&#8217;t reveal repeated patterns, and one of them is <em>Cipher Feedback</em> (CFB) mode, which works like this:</p>
<p><img loading="lazy" src="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-cfb-720.png" class="aligncenter size-full wp-image-525465" alt="" width="720" height="416" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-cfb-720.png 720w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-cfb-720.png?resize=300,173 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-cfb-720.png?resize=100,58 100w" sizes="(max-width: 720px) 100vw, 720px" /></p>
<p>Instead of encrypting the plaintext blocks with AES each time, you encrypt the last block of ciphertext instead, and then XOR that &#8220;keystream&#8221; with the next block of plaintext.</p>
<p>That way, even if you get two identical plaintext blocks in a row, the ciphertext won&#8217;t repeat.</p>
<p>Of course, there is no ciphertext block to use at the outset, so <code>AES-128-CFB</code> mode requires not only a key of 16 bytes for the encryption engine, but also an <em>initialisation vector</em> (IV) of 16 bytes as an up-front input to get the keystream started.</p>
<p>Note that the IV can, and usually is, shared along with the ciphertext &#8211; the IV doesn&#8217;t need to be kept secret, because the secrecy of the encryption is provided by the key that controls the AES encryption engine.</p>
<p>Nevertheless, a CFB initialisation vector should be chosen randomly, and should never be re-used, especially with the same AES key.</p>
<h2>CFB8 explained</h2>
<p>One disadvantage that AES-ECB and AES-CFB have in common is that until you have a full 16-byte block of input, you can&#8217;t produce any output, because they can&#8217;t work on partial blocks &#8211; AES is designed to mix-and-swap-and-mince-and-munge chunks of 128 bits at a time.</p>
<p>That also means you are stuck if you have any leftover bytes at the end, for example if you have 67 bytes to encrypt, which is 4×16 + 3.</p>
<p>You need to figure out a way to pad out the last block to the right size, and then reliably work out whether there were any extra bytes added on that need to be stripped off when you decrypt the data.</p>
<p>One solution to this is AES-CFB8, a mode that we have never heard of anyone using in real life before, but that is designed to use a full 128-bit AES mixing cycle for every <i>byte</i> of input, so you can encrypt even just a single character without any padding.</p>
<p>Instead of encrypting the last full block of ciphertext to create the next full block of keystream data, you use just the first byte of the keystream each time and XOR it with one plaintext byte rather than a 16-byte plaintext block.</p>
<p>Then you chop off the keystream byte you just used and add the new ciphertext byte on at the end of the keystream, giving you a full block of data to encrypt to generate the next keystream byte:</p>
<p><img loading="lazy" src="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-cfb8-720.png" class="aligncenter size-full wp-image-525467" alt="" width="720" height="713" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-cfb8-720.png 720w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-cfb8-720.png?resize=150,150 150w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-cfb8-720.png?resize=300,297 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-cfb8-720.png?resize=71,70 71w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-cfb8-720.png?resize=32,32 32w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-cfb8-720.png?resize=50,50 50w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-cfb8-720.png?resize=64,64 64w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-cfb8-720.png?resize=96,96 96w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-cfb8-720.png?resize=128,128 128w" sizes="(max-width: 720px) 100vw, 720px" /></p>
<h2>Netlogon CFB8 considered harmful</h2>
<p>Sadly, the way that Netlogon uses <code>AES-128-CFB8</code> is significantly less secure than it should be.</p>
<p>Secura researchers spotted the problem very quickly when perusing the Microsoft documentation, where the algorithm is not defined generically (as we listed it above), but given in a dangerously simplified form.</p>
<p>Section 3.1.4.4.1 specifies the <i>AES Credential [Computation]</i> process as follows:</p>
<pre>    If AES support is negotiated between the client and the server, 
   the Netlogon  credentials are computed using the AES-128 encryption 
   algorithm in 8-bit CFB  mode with a zero initialization vector. 
   [Sk below is short for SessionKey]     

      ComputeNetlogonCredential(Input, Sk, Output)       
         SET IV = 0       
         CALL AesEncrypt(Input, Sk, IV, Output) </pre>
<p>You probably spotted the cryptographic blunder already: &#8220;the credentials are computed [&#8230;] <i>with a zero initialization vector</i>.&#8221;</p>
<p>As we already mentioned, IVs are supposed to be randomly chosen, and used only once with any key &#8211; indeed, that&#8217;s why they are often referred to as <em>nonces</em>, for <em>numbers used onc</em>e.</p>
<p>But there&#8217;s an even bigger problem with an all-zero IV in CFB8 mode, as Secura discovered.</p>
<p>You can visualise the problem if you use an all-zero IV plus an all-zero block of plaintext bytes:</p>
<p><img loading="lazy" src="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-cfb8-problem-720.png" class="aligncenter size-full wp-image-525468" alt="" width="720" height="712" srcset="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-cfb8-problem-720.png 720w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-cfb8-problem-720.png?resize=300,297 300w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-cfb8-problem-720.png?resize=71,70 71w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-cfb8-problem-720.png?resize=32,32 32w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-cfb8-problem-720.png?resize=50,50 50w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-cfb8-problem-720.png?resize=64,64 64w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-cfb8-problem-720.png?resize=96,96 96w, https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-cfb8-problem-720.png?resize=128,128 128w" sizes="(max-width: 720px) 100vw, 720px" /></p>
<p>Because AES is a high-quality cipher with no known statistical biases, you can put in any input and encrypt it with any key, and the chance of each individual bit in the output being zero (or one) is 50%.</p>
<p>Every output bit&#8217;s value is like a digital coin toss.</p>
<p>So the chance of the first output byte being zero is the same as the chance that the first 8 output bits are all zero, which is 50% × 50% × 50% &#8230; eight times over (50% is just another way of writing 0.50, which is the same as 1/2).</p>
<p>50%<sup>8</sup> is 2<sup>-8</sup>, or 1/256.</p>
<p>Remember that probability.</p>
<p>In the diagram above we&#8217;ve assumed that the first output byte did indeed come out as zero, and you can see that if that happens, the entire encryption process essentially gets &#8220;locked into&#8221; an all-zero state.</p>
<p>The keystream byte (black) comes out as 00, so when you XOR it with the first plaintext byte (pink) of 00 you get a ciphertext byte (red) of 00.</p>
<p>Then, when you chop the first 00 off the left hand end of the IV (white) and append the new ciphertext 00 at the end, you are right back where you started, with another all-zero IV and a remaining plaintext buffer of all zeros.</p>
<p>When you encrypt the &#8220;new&#8221; IV with the key, you get exactly the same result as before, because all your inputs are the same again, and out comes another keystream byte of 00, which XORs with the next plaintext 00 to produce another ciphertext byte of 00, which feeds back into the IV to make it all zero again.</p>
<h2>How to trick Netlogon</h2>
<p>Secura&#8217;s researchers quickly realised what would happen if they tried to authenticate to a Netlogon server over and over again using a <code>ClientChallenge</code> nonce consisting of 8 zeros.</p>
<p>Roughly once in every 256 times the server would randomly concoct a session key for which the correctly-encrypted version of their all-zero <code>ClientChallenge</code>&#8230;</p>
<p>&#8230;would itself be all zeros.</p>
<figure id="attachment_525474" aria-describedby="caption-attachment-525474" style="width: 720px" class="wp-caption aligncenter"><img loading="lazy" src="https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/09/zlo-zerofinding-720-1.gif" class="size-full wp-image-525474" alt="" width="720" height="404"><figcaption id="caption-attachment-525474" class="wp-caption-text">We tried an al-zero IV with an all-zero ClientChallenge 2560 times.<br />One in 256 times the key chosen gave all-zero output too.</figcaption></figure>
<p>In other words, by submitting a <code>ClientChallenge</code> of 0000000000000000 and then blindly also submitting a <em>Netlogon Credential Computation</em> (see above) of 0000000000000000, they&#8217;d get the credential computation correct by chance 1/256 of the time, even though they had no idea what the right <code>SessionKey</code> value should be because they had no idea what secret password to use.</p>
<p>Simply put, 1/256 of the time, they ended up in a situation where they could always produce correctly-encrypted data to transmit to the server, without having a clue what the password or session key was, <i>as long as they only ever needed to encrypt zeros</i>!</p>
<p>Better yet, the server would automatically notify them when they hit the jackpot by accepting their credential submission.</p>
<h2>Surely that&#8217;s not exploitable?</h2>
<p>By now you are probably thinking, &#8220;What&#8217;s the chance that every time they needed to submit an encrypted authentication token or to supply encrypted password data, they&#8217;d only ever need to encrypt zeros?&#8221;</p>
<p>We wondered that too, but our intrepid researchers found a way.</p>
<p>One of the Netlogon password functions, <code>NetrServerPasswordSet2</code> (section 3.4.5.2.5), can be called remotely from a Netlogon session that has already got past the <em>Netlogon Credential Computation</em> check.</p>
<p>This function, which does what its name suggests and changes the server password, requires the caller to correctly encrypt two chunks of data:</p>
<ul>
<li>The original <code>ClientChallenge</code>, treated as a 64-bit number, with the current time (in what&#8217;s known as &#8220;Posix seconds&#8221; or Unix epoch form) added to it. This data is used as an authentication check to ensure it&#8217;s still the same client program trying to do the password change.</li>
<li>A buffer of 516 bytes that specifies the new password, formatted as (512-N) bytes of random data, followed by N bytes specifying the password, followed by the password length N expressed as a 4-byte number.</li>
</ul>
<p>The <code>ClientChallenge</code> is all zeros, because that was needed to get the exploit started in the first place, but the current time in Posix seconds is something close to this:</p>
<pre>    $ date --utc +%s 
   1600300026 </pre>
<p>Posix time denotes the number of seconds since the start of the Unix epoch, which began, by definition, at 1970-01-01T00:00:00Z, a date now more than 50 years in the past.</p>
<p>The researchers found themselves on the horns of a dilemma: the <code>ClientChallenge</code> was zero, but the time was not, so the sum of those two numbers couldn&#8217;t be zero, and therefore wouldn&#8217;t encrypt to zero&#8230;</p>
<p>&#8230;and therefore the attackers would need the original session key after all, and to get the session key they would need to know a valid password for a suitable computer on the network.</p>
<p>What to do?</p>
<p>Well, the researchers just pretended it was 1970 all over again, used a timestamp of zero added to a <code>ClientChallenge</code> of zero&#8230;</p>
<p>&#8230;and the server didn&#8217;t mind &#8211; there was apparently no check to see if the timestamp was decades in the past.</p>
<p>Of course, the 516 all-zero bytes that the researchers now needed to supply in the encrypted password buffer forced them to specify a password length of zero, which you might think would be disallowed by the server.</p>
<p>But the researchers tried it anyway&#8230;</p>
<p>&#8230;and the server didn&#8217;t mind that either, setting its own Active Directory password to &lt;no password at all&gt;.</p>
<h2>What next?</h2>
<p>Happily &#8211; or perhaps slightly less unhappily &#8211; the password change that they were able make didn&#8217;t reset the server&#8217;s actual login password, so the researchers couldn&#8217;t simply login directly and take over the server via a conventional Windows desktop.</p>
<p>However, they did report that by changing the Active Directory password of the domain controller itself, they <a href="https://www.secura.com/pathtoimg.php?id=2055" rel="nofollow">were able to</a>:</p>
<blockquote><p>extract all user hashes from the domain through the Domain Replication Service (DRS) protocol. This includes domain administrator hashes (including the ‘krbtgt’ key, which can used to create golden tickets) that could then be used to login to the Domain Controller (using a standard pass-the-hash attack) and update the computer password stored in the Domain Controllers’s local registry.</p>
</blockquote>
<p>In other words, complete network compromise.</p>
<p>All because of an over-simplified cryptographic specification that involved the cardinal sin of an all-zero initialisation vector every time.</p>
<p>Of course, that flaw was compounded by several other programmatic oversights where stricter attention to security and correctness could have prevented this attack, including:</p>
<ul>
<li><strong>Allowing an all-zero </strong><code>ClientChallenge</code><strong> in the first place.</strong> We&#8217;d assume that the most likely cause of an all-zero buffer at the start of the Netlogon process would be an incorrectly initialised or buggy client program, so we&#8217;d reject it as a precaution anyway.</li>
<li><strong>Allowing a zero-length password.</strong> Given that Windows already has a secure mechanism for storing shared secrets, and relies on it heavily anyway, it seems unnecessary to allow blank passwords at all, even for accounts where no humans are ever expected to log on.</li>
<li><strong>Allowing a date-based authentication field in which the timestamp could not possibly be correct.</strong> We&#8217;d be inclined to treat this as a warning of a buggy client or an attempt to pull off a security trick.</li>
</ul>
<h2>What to do?</h2>
<p>This bug opens a serious security hole to anyone already inside your organisation, and perhaps even to outsiders, depending on the topology of your network.</p>
<p>If you haven&#8217;t applied the August 2020 patch yet, you need to do so &#8211; you aren&#8217;t just letting yourself down, you&#8217;re letting everyone else down too by making your network an easier target for crooks, and therefore making it more likely that you will be the source of security problems for other people.</p>
<p>In addition:</p>
<ul>
<li><strong>Don&#8217;t take cryptographic shortcuts</strong> such as choosing an encryption mode that&#8217;s convenient for your application, but then taking liberties with how you use it because that&#8217;s convenient for your programmers.</li>
<li><strong>Program defensively whenever you are accepting untrusted data,</strong> especially if the data can easily be checked for obviously forged or incorrect values such as timestamps 50 years in the past.</li>
<li><strong>Retire old parts of your products or specifications as soon as you can after better ones are available.</strong> Although the exploit in this case relied on updated parts of the Netlogon protocol, such as using AES instead of falling back to older algorithms, you can argue that this bug might have been found far sooner if the protocol specification were not encumbered with so many alternative ways of doing all sort of security-related checks.</li>
</ul>
<p>But the big thing to remember here is: <strong>patch early, patch often</strong>.</p>
<hr style="margin-top: 2em">
			</div> <!-- .entry-content -->
	<ul class="block social follow">
		<li>
			<svg style="height: 24px" viewBox="0 0 24 24" class="icon twitter"><use xlink:href="#twitter"></use></svg>
			<p>Follow <strong><a href="https://twitter.com/nakedsecurity">@NakedSecurity on Twitter</a></strong> for the latest computer security news.</p>
		</li>
		<li>
			<svg style="height: 24px" viewBox="0 0 24 24" class="icon instagram"><use xlink:href="#instagram"></use></svg>
			<p>Follow <strong><a href="https://www.instagram.com/nakedsecurity/">@NakedSecurity on Instagram</a></strong> for exclusive pics, gifs, vids and LOLs!</p>
		</li>
	</ul>
</article><!-- #post-## -->

		<div class="free-tools-block">
			<h2 class="block-title">Free tools</h2>

<div class="ns-free-tools">
	<div class="ns-free-tools__item ns-free-tools__item--sophos-home">
		<a class="ns-free-tools__link" href="https://home.sophos.com/en-us.aspx?cmp=701j0000001eLpnAAE">
			<img src="https://nakedsecurity.sophos.com/wp-content/themes/sophosnews-2015/img/free-tools/sophos-home@2x.png" alt="Sophos Home" class="ns-free-tools__image" width="166" height="100">
			<h4 class="ns-free-tools__title">
				Sophos Home			</h4>
			<div class="ns-free-tools__sub-title">
				Protect personal PCs and Macs			</div>
		</a>
	</div>
	<div class="ns-free-tools__item ns-free-tools__item--hitman-pro">
		<a class="ns-free-tools__link" href="https://www.hitmanpro.com/en-us/hmp.aspx">
			<img src="https://nakedsecurity.sophos.com/wp-content/themes/sophosnews-2015/img/free-tools/hitman-pro@2x.png" alt="Hitman Pro" class="ns-free-tools__image" width="154" height="100">
			<h4 class="ns-free-tools__title">
				Hitman Pro			</h4>
			<div class="ns-free-tools__sub-title">
				Find and remove malware			</div>
		</a>
	</div>
	<div class="ns-free-tools__item ns-free-tools__item--intercept-x">
		<a class="ns-free-tools__link" href="https://www.sophos.com/en-us/products/free-tools/sophos-mobile-security-free-edition.aspx">
			<img src="https://nakedsecurity.sophos.com/wp-content/themes/sophosnews-2015/img/free-tools/mobile-security-android@2x.png" alt="Sophos Intercept X for Mobile" class="ns-free-tools__image" width="96" height="110">
			<h4 class="ns-free-tools__title">
				Intercept X for Mobile			</h4>
			<div class="ns-free-tools__sub-title">
				Protect Android devices			</div>
		</a>
	</div>
</div>
		</div>

			<nav class="navigation post-navigation" role="navigation">
		<h2 class="screen-reader-text">Post navigation</h2>

		<div class="nav-links">
			<div class="nav-previous"><a href="https://nakedsecurity.sophos.com/2020/09/14/naked-security-live-should-you-worry-about-your-wallpaper/" rel="prev"><span class="nav-label">Previous</span><span class="nav-seperator">:</span><span class="nav-title"> Naked Security Live &#8211; &#8220;Should you worry about your wallpaper?&#8221;</span></a></div><div class="nav-next"><a href="https://nakedsecurity.sophos.com/2020/09/18/a-real-life-maze-ransomware-attack-if-at-first-you-dont-succeed/" rel="next"><span class="nav-label">Next</span><span class="nav-seperator">:</span><span class="nav-title"> A real-life Maze ransomware attack &#8211; &#8220;If at first you don&#8217;t succeed&#8230;&#8221;</span></a></div>		</div>
		<!-- .nav-links -->
	</nav><!-- .navigation -->
	
	
	</main><!-- #main -->

	</div> <!-- .panel-container -->
	</div> <!-- .container -->
	</section> <!-- .panel -->

	
	
	<section class="comments-panel">
	<div class="container">
	<div class="panel-content framed-content-area">

			
<div id="comments" class="comments-area">

			<h2 class="comments-title">
			14 comments on &ldquo;<span>Zerologon &#8211; hacking Windows servers with a bunch of zeros</span>&rdquo;		</h2>

		<ol class="comment-list">
					<li id="comment-6233323" class="comment even thread-even depth-1 parent">
			<article id="div-comment-6233323" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/3c2de7889ed8941aeaef2a188db4c5bd?s=50&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/3c2de7889ed8941aeaef2a188db4c5bd?s=100&#038;d=mm&#038;r=g 2x' class='avatar avatar-50 photo' height='50' width='50' loading='lazy'/>						<b class="fn">Malcolm Doody</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/#comment-6233323"><time datetime="2020-09-18T16:11:36+01:00">September 18, 2020 at 4:11 pm</time></a>					</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Typo &#8220;Cipher Feeback (CFB) mode&#8221; (just above the diagram)</p>
<div class="cs-rating pd-rating" id="pd_rating_holder_7238218_comm_6233323"></div>
<script type="text/javascript" charset="UTF-8"><!--//--><![CDATA[//><!--
PDRTJS_settings_7238218_comm_6233323={"id":7238218,"unique_id":"wp-comment-6233323","title":"Typo%20%26quot%3BCipher%20Feeback%20%28CFB%29%20mode%26quot%3B%20%28just%20above%20the%20diagram%29%E2%80%A6","permalink":"https:\/\/nakedsecurity.sophos.com\/2020\/09\/17\/zerologon-hacking-windows-servers-with-a-bunch-of-zeros\/#comment-6233323","item_id":"_comm_6233323"};
//--><!]]></script>
<script type="text/javascript" charset="UTF-8" src="https://polldaddy.com/js/rating/rating.js"></script>				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/?replytocom=6233323#respond' data-commentid="6233323" data-postid="525451" data-belowelement="div-comment-6233323" data-respondelement="respond" data-replyto="Reply to Malcolm Doody" aria-label='Reply to Malcolm Doody'>Reply</a></div>			</article><!-- .comment-body -->
		<ul class="children">
		<li id="comment-6233345" class="comment byuser comment-author-pducklin bypostauthor odd alt depth-2">
			<article id="div-comment-6233345" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/025c4bb891cbc5a1bb24a4854f823e48?s=50&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/025c4bb891cbc5a1bb24a4854f823e48?s=100&#038;d=mm&#038;r=g 2x' class='avatar avatar-50 photo' height='50' width='50' loading='lazy'/>						<b class="fn">Paul Ducklin</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/#comment-6233345"><time datetime="2020-09-18T16:24:41+01:00">September 18, 2020 at 4:24 pm</time></a>					</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Fixed! Thanks for the, ahem, feedback.</p>
<div class="cs-rating pd-rating" id="pd_rating_holder_7238218_comm_6233345"></div>
<script type="text/javascript" charset="UTF-8"><!--//--><![CDATA[//><!--
PDRTJS_settings_7238218_comm_6233345={"id":7238218,"unique_id":"wp-comment-6233345","title":"Fixed%21%20Thanks%20for%20the%2C%20ahem%2C%20feedback.%E2%80%A6","permalink":"https:\/\/nakedsecurity.sophos.com\/2020\/09\/17\/zerologon-hacking-windows-servers-with-a-bunch-of-zeros\/#comment-6233345","item_id":"_comm_6233345"};
//--><!]]></script>
<script type="text/javascript" charset="UTF-8" src="https://polldaddy.com/js/rating/rating.js"></script>				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/?replytocom=6233345#respond' data-commentid="6233345" data-postid="525451" data-belowelement="div-comment-6233345" data-respondelement="respond" data-replyto="Reply to Paul Ducklin" aria-label='Reply to Paul Ducklin'>Reply</a></div>			</article><!-- .comment-body -->
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li id="comment-6235047" class="comment even thread-odd thread-alt depth-1 parent">
			<article id="div-comment-6235047" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/?s=50&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/?s=100&#038;d=mm&#038;r=g 2x' class='avatar avatar-50 photo avatar-default' height='50' width='50' loading='lazy'/>						<b class="fn">Anonymous</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/#comment-6235047"><time datetime="2020-09-23T14:10:59+01:00">September 23, 2020 at 2:10 pm</time></a>					</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>There are still 3 typos in this article.</p>
<div class="cs-rating pd-rating" id="pd_rating_holder_7238218_comm_6235047"></div>
<script type="text/javascript" charset="UTF-8"><!--//--><![CDATA[//><!--
PDRTJS_settings_7238218_comm_6235047={"id":7238218,"unique_id":"wp-comment-6235047","title":"There%20are%20still%203%20typos%20in%20this%20article.%E2%80%A6","permalink":"https:\/\/nakedsecurity.sophos.com\/2020\/09\/17\/zerologon-hacking-windows-servers-with-a-bunch-of-zeros\/#comment-6235047","item_id":"_comm_6235047"};
//--><!]]></script>
<script type="text/javascript" charset="UTF-8" src="https://polldaddy.com/js/rating/rating.js"></script>				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/?replytocom=6235047#respond' data-commentid="6235047" data-postid="525451" data-belowelement="div-comment-6235047" data-respondelement="respond" data-replyto="Reply to " aria-label='Reply to '>Reply</a></div>			</article><!-- .comment-body -->
		<ul class="children">
		<li id="comment-6235118" class="comment byuser comment-author-pducklin bypostauthor odd alt depth-2">
			<article id="div-comment-6235118" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/025c4bb891cbc5a1bb24a4854f823e48?s=50&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/025c4bb891cbc5a1bb24a4854f823e48?s=100&#038;d=mm&#038;r=g 2x' class='avatar avatar-50 photo' height='50' width='50' loading='lazy'/>						<b class="fn">Paul Ducklin</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/#comment-6235118"><time datetime="2020-09-23T23:01:18+01:00">September 23, 2020 at 11:01 pm</time></a>					</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Well, I just found one. Tell you what. I&#8217;ll tell you mine and you can tell me yours, and therefore between us we can do something about all of them. </p>
<p>Mine was a mis-spelling of &#8220;documentation&#8221;.</p>
<p>What have you got there?</p>
<div class="cs-rating pd-rating" id="pd_rating_holder_7238218_comm_6235118"></div>
<script type="text/javascript" charset="UTF-8"><!--//--><![CDATA[//><!--
PDRTJS_settings_7238218_comm_6235118={"id":7238218,"unique_id":"wp-comment-6235118","title":"Well%2C%20I%20just%20found%20one.%20Tell%20you%20what.%20I%26%23039%3Bll%20tell%20you%20mine%20and%20you%20can%20tell%20me%20yours%2C%20and%20therefore%20between%20us%20we%20can%20do%20something%20about%20all%20of%20them.%20Mine%20was%20a%20mis-spelling%20of%20%26quot%3Bdocumentation%26quot%3B.Wha%E2%80%A6","permalink":"https:\/\/nakedsecurity.sophos.com\/2020\/09\/17\/zerologon-hacking-windows-servers-with-a-bunch-of-zeros\/#comment-6235118","item_id":"_comm_6235118"};
//--><!]]></script>
<script type="text/javascript" charset="UTF-8" src="https://polldaddy.com/js/rating/rating.js"></script>				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/?replytocom=6235118#respond' data-commentid="6235118" data-postid="525451" data-belowelement="div-comment-6235118" data-respondelement="respond" data-replyto="Reply to Paul Ducklin" aria-label='Reply to Paul Ducklin'>Reply</a></div>			</article><!-- .comment-body -->
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li id="comment-6235229" class="comment even thread-even depth-1 parent">
			<article id="div-comment-6235229" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/?s=50&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/?s=100&#038;d=mm&#038;r=g 2x' class='avatar avatar-50 photo avatar-default' height='50' width='50' loading='lazy'/>						<b class="fn">Max</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/#comment-6235229"><time datetime="2020-09-24T08:41:52+01:00">September 24, 2020 at 8:41 am</time></a>					</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>The best explanation of the vuln root cause. Thanks a lot!</p>
<div class="cs-rating pd-rating" id="pd_rating_holder_7238218_comm_6235229"></div>
<script type="text/javascript" charset="UTF-8"><!--//--><![CDATA[//><!--
PDRTJS_settings_7238218_comm_6235229={"id":7238218,"unique_id":"wp-comment-6235229","title":"The%20best%20explanation%20of%20the%20vuln%20root%20cause.%20Thanks%20a%20lot%21%E2%80%A6","permalink":"https:\/\/nakedsecurity.sophos.com\/2020\/09\/17\/zerologon-hacking-windows-servers-with-a-bunch-of-zeros\/#comment-6235229","item_id":"_comm_6235229"};
//--><!]]></script>
<script type="text/javascript" charset="UTF-8" src="https://polldaddy.com/js/rating/rating.js"></script>				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/?replytocom=6235229#respond' data-commentid="6235229" data-postid="525451" data-belowelement="div-comment-6235229" data-respondelement="respond" data-replyto="Reply to Max" aria-label='Reply to Max'>Reply</a></div>			</article><!-- .comment-body -->
		<ul class="children">
		<li id="comment-6235266" class="comment byuser comment-author-pducklin bypostauthor odd alt depth-2">
			<article id="div-comment-6235266" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/025c4bb891cbc5a1bb24a4854f823e48?s=50&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/025c4bb891cbc5a1bb24a4854f823e48?s=100&#038;d=mm&#038;r=g 2x' class='avatar avatar-50 photo' height='50' width='50' loading='lazy'/>						<b class="fn">Paul Ducklin</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/#comment-6235266"><time datetime="2020-09-24T10:42:18+01:00">September 24, 2020 at 10:42 am</time></a>					</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Thanks for your kind words. Glad you found it useful!</p>
<div class="cs-rating pd-rating" id="pd_rating_holder_7238218_comm_6235266"></div>
<script type="text/javascript" charset="UTF-8"><!--//--><![CDATA[//><!--
PDRTJS_settings_7238218_comm_6235266={"id":7238218,"unique_id":"wp-comment-6235266","title":"Thanks%20for%20your%20kind%20words.%20Glad%20you%20found%20it%20useful%21%E2%80%A6","permalink":"https:\/\/nakedsecurity.sophos.com\/2020\/09\/17\/zerologon-hacking-windows-servers-with-a-bunch-of-zeros\/#comment-6235266","item_id":"_comm_6235266"};
//--><!]]></script>
<script type="text/javascript" charset="UTF-8" src="https://polldaddy.com/js/rating/rating.js"></script>				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/?replytocom=6235266#respond' data-commentid="6235266" data-postid="525451" data-belowelement="div-comment-6235266" data-respondelement="respond" data-replyto="Reply to Paul Ducklin" aria-label='Reply to Paul Ducklin'>Reply</a></div>			</article><!-- .comment-body -->
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li id="comment-6235543" class="comment even thread-odd thread-alt depth-1 parent">
			<article id="div-comment-6235543" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/?s=50&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/?s=100&#038;d=mm&#038;r=g 2x' class='avatar avatar-50 photo avatar-default' height='50' width='50' loading='lazy'/>						<b class="fn">Pete Corrao</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/#comment-6235543"><time datetime="2020-09-25T14:37:18+01:00">September 25, 2020 at 2:37 pm</time></a>					</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>A great read!  Thanks for the graphics &#8211; they helped a lot with understanding the flow.</p>
<div class="cs-rating pd-rating" id="pd_rating_holder_7238218_comm_6235543"></div>
<script type="text/javascript" charset="UTF-8"><!--//--><![CDATA[//><!--
PDRTJS_settings_7238218_comm_6235543={"id":7238218,"unique_id":"wp-comment-6235543","title":"A%20great%20read%21%20%20Thanks%20for%20the%20graphics%20-%20they%20helped%20a%20lot%20with%20understanding%20the%20flow.%E2%80%A6","permalink":"https:\/\/nakedsecurity.sophos.com\/2020\/09\/17\/zerologon-hacking-windows-servers-with-a-bunch-of-zeros\/#comment-6235543","item_id":"_comm_6235543"};
//--><!]]></script>
<script type="text/javascript" charset="UTF-8" src="https://polldaddy.com/js/rating/rating.js"></script>				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/?replytocom=6235543#respond' data-commentid="6235543" data-postid="525451" data-belowelement="div-comment-6235543" data-respondelement="respond" data-replyto="Reply to Pete Corrao" aria-label='Reply to Pete Corrao'>Reply</a></div>			</article><!-- .comment-body -->
		<ul class="children">
		<li id="comment-6235549" class="comment byuser comment-author-pducklin bypostauthor odd alt depth-2">
			<article id="div-comment-6235549" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/025c4bb891cbc5a1bb24a4854f823e48?s=50&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/025c4bb891cbc5a1bb24a4854f823e48?s=100&#038;d=mm&#038;r=g 2x' class='avatar avatar-50 photo' height='50' width='50' loading='lazy'/>						<b class="fn">Paul Ducklin</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/#comment-6235549"><time datetime="2020-09-25T15:30:44+01:00">September 25, 2020 at 3:30 pm</time></a>					</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>A pleasure. Glad you found the graphics useful &#8211; they were fun to create but neded up being a LOT of work so I am happy to hear they were worth it!</p>
<div class="cs-rating pd-rating" id="pd_rating_holder_7238218_comm_6235549"></div>
<script type="text/javascript" charset="UTF-8"><!--//--><![CDATA[//><!--
PDRTJS_settings_7238218_comm_6235549={"id":7238218,"unique_id":"wp-comment-6235549","title":"A%20pleasure.%20Glad%20you%20found%20the%20graphics%20useful%20-%20they%20were%20fun%20to%20create%20but%20neded%20up%20being%20a%20LOT%20of%20work%20so%20I%20am%20happy%20to%20hear%20they%20were%20worth%20it%21%E2%80%A6","permalink":"https:\/\/nakedsecurity.sophos.com\/2020\/09\/17\/zerologon-hacking-windows-servers-with-a-bunch-of-zeros\/#comment-6235549","item_id":"_comm_6235549"};
//--><!]]></script>
<script type="text/javascript" charset="UTF-8" src="https://polldaddy.com/js/rating/rating.js"></script>				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/?replytocom=6235549#respond' data-commentid="6235549" data-postid="525451" data-belowelement="div-comment-6235549" data-respondelement="respond" data-replyto="Reply to Paul Ducklin" aria-label='Reply to Paul Ducklin'>Reply</a></div>			</article><!-- .comment-body -->
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li id="comment-6245614" class="comment even thread-even depth-1 parent">
			<article id="div-comment-6245614" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/e6f39055ec7b9f38ca99e4f8c995b090?s=50&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/e6f39055ec7b9f38ca99e4f8c995b090?s=100&#038;d=mm&#038;r=g 2x' class='avatar avatar-50 photo' height='50' width='50' loading='lazy'/>						<b class="fn">Jackson Wells</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/#comment-6245614"><time datetime="2020-10-30T13:44:43+00:00">October 30, 2020 at 1:44 pm</time></a>					</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Excellent write up on this exploit. This has helped me greatly.</p>
<div class="cs-rating pd-rating" id="pd_rating_holder_7238218_comm_6245614"></div>
<script type="text/javascript" charset="UTF-8"><!--//--><![CDATA[//><!--
PDRTJS_settings_7238218_comm_6245614={"id":7238218,"unique_id":"wp-comment-6245614","title":"Excellent%20write%20up%20on%20this%20exploit.%20This%20has%20helped%20me%20greatly.%E2%80%A6","permalink":"https:\/\/nakedsecurity.sophos.com\/2020\/09\/17\/zerologon-hacking-windows-servers-with-a-bunch-of-zeros\/#comment-6245614","item_id":"_comm_6245614"};
//--><!]]></script>
<script type="text/javascript" charset="UTF-8" src="https://polldaddy.com/js/rating/rating.js"></script>				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/?replytocom=6245614#respond' data-commentid="6245614" data-postid="525451" data-belowelement="div-comment-6245614" data-respondelement="respond" data-replyto="Reply to Jackson Wells" aria-label='Reply to Jackson Wells'>Reply</a></div>			</article><!-- .comment-body -->
		<ul class="children">
		<li id="comment-6245657" class="comment byuser comment-author-pducklin bypostauthor odd alt depth-2">
			<article id="div-comment-6245657" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/025c4bb891cbc5a1bb24a4854f823e48?s=50&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/025c4bb891cbc5a1bb24a4854f823e48?s=100&#038;d=mm&#038;r=g 2x' class='avatar avatar-50 photo' height='50' width='50' loading='lazy'/>						<b class="fn">Paul Ducklin</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/#comment-6245657"><time datetime="2020-10-30T16:21:08+00:00">October 30, 2020 at 4:21 pm</time></a>					</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Thanks for your kind words. Glad you found it useful.</p>
<div class="cs-rating pd-rating" id="pd_rating_holder_7238218_comm_6245657"></div>
<script type="text/javascript" charset="UTF-8"><!--//--><![CDATA[//><!--
PDRTJS_settings_7238218_comm_6245657={"id":7238218,"unique_id":"wp-comment-6245657","title":"Thanks%20for%20your%20kind%20words.%20Glad%20you%20found%20it%20useful.%E2%80%A6","permalink":"https:\/\/nakedsecurity.sophos.com\/2020\/09\/17\/zerologon-hacking-windows-servers-with-a-bunch-of-zeros\/#comment-6245657","item_id":"_comm_6245657"};
//--><!]]></script>
<script type="text/javascript" charset="UTF-8" src="https://polldaddy.com/js/rating/rating.js"></script>				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/?replytocom=6245657#respond' data-commentid="6245657" data-postid="525451" data-belowelement="div-comment-6245657" data-respondelement="respond" data-replyto="Reply to Paul Ducklin" aria-label='Reply to Paul Ducklin'>Reply</a></div>			</article><!-- .comment-body -->
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li id="comment-6253473" class="comment even thread-odd thread-alt depth-1 parent">
			<article id="div-comment-6253473" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/?s=50&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/?s=100&#038;d=mm&#038;r=g 2x' class='avatar avatar-50 photo avatar-default' height='50' width='50' loading='lazy'/>						<b class="fn">Issam</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/#comment-6253473"><time datetime="2020-11-15T18:20:32+00:00">November 15, 2020 at 6:20 pm</time></a>					</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Hi, I have many questions to ask but first, I&#8217;d like to thank you for writing this great article, it has been really helpful.</p>
<p>1. At one point you said: &#8220;At the other end, the server does the same thing in reverse, and verifies that the original ClientChallenge [&#8230;]&#8221;.<br />
Did you mean the &#8220;ClientCredential&#8221; which is sent in input using the NetrServerAuthenticate call? [3.1.4.1] step 5.</p>
<p>2. The researcher Tom Tervoort (in the white paper) said the client is using the NetrServerAuthenticate3 but why not the 1 or 2? [3.4.5.2] &amp; [3.1.4.1] step 5.</p>
<p>3. I didn&#8217;t really understand the part with the 50% chance. You said that &#8220;[&#8230;] the chance of each individual bit in the output being zero (or one) is 50%.&#8221;, why?<br />
And how come to the fact that the chance of the first output byte being zero is the same as the chance that the first 8 output bits are all zero?</p>
<p>4. Could you share the code you used to see the anomaly (&#8220;try-cfb8.lua&#8221;) or explain briefly how you programmed it?</p>
<p>Hoping you could answer my questions, thank you!</p>
<div class="cs-rating pd-rating" id="pd_rating_holder_7238218_comm_6253473"></div>
<script type="text/javascript" charset="UTF-8"><!--//--><![CDATA[//><!--
PDRTJS_settings_7238218_comm_6253473={"id":7238218,"unique_id":"wp-comment-6253473","title":"Hi%2C%20I%20have%20many%20questions%20to%20ask%20but%20first%2C%20I%26%23039%3Bd%20like%20to%20thank%20you%20for%20writing%20this%20great%20article%2C%20it%20has%20been%20really%20helpful.1.%20At%20one%20point%20you%20said%3A%20%26quot%3BAt%20the%20other%20end%2C%20the%20server%20does%20the%20same%20%E2%80%A6","permalink":"https:\/\/nakedsecurity.sophos.com\/2020\/09\/17\/zerologon-hacking-windows-servers-with-a-bunch-of-zeros\/#comment-6253473","item_id":"_comm_6253473"};
//--><!]]></script>
<script type="text/javascript" charset="UTF-8" src="https://polldaddy.com/js/rating/rating.js"></script>				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/?replytocom=6253473#respond' data-commentid="6253473" data-postid="525451" data-belowelement="div-comment-6253473" data-respondelement="respond" data-replyto="Reply to Issam" aria-label='Reply to Issam'>Reply</a></div>			</article><!-- .comment-body -->
		<ul class="children">
		<li id="comment-6253662" class="comment byuser comment-author-pducklin bypostauthor odd alt depth-2 parent">
			<article id="div-comment-6253662" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/025c4bb891cbc5a1bb24a4854f823e48?s=50&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/025c4bb891cbc5a1bb24a4854f823e48?s=100&#038;d=mm&#038;r=g 2x' class='avatar avatar-50 photo' height='50' width='50' loading='lazy'/>						<b class="fn">Paul Ducklin</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/#comment-6253662"><time datetime="2020-11-16T13:51:55+00:00">November 16, 2020 at 1:51 pm</time></a>					</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>1. The client encrypts its original ClientChallenge using its SessionKey, producing the ClientCredential. The server goes in reverse, and decrypts the received ClientCredential using its SessionKey. If an exact copy of the original ClientChallenge emerges from this decryption, then the server assumes that the client knows the correct SessionKey and therefore accepts the ClientCredential as an authentication token from then on.</p>
<p>2. I don&#8217;t know. Presumably because NetrServerAuthenticate3 is the currently recommended function to use? The &#8230;Authenticate2 and &#8230;Authenticate functions are noted as predecessors. If you are going to crack one of them, cracking the latest and greatest version is a better proof of concept that cracking an old version of the protocol. (If you manage to hack Windows XP, no one is going to be terribly impressed. If you do something similar on Windows 10, everyone will be.)</p>
<p>3. Picking a bit randomly is like tossing a coin, so there&#8217;s a 50:50 chance of 0 or 1, just like there&#8217;s a 50:50 chance of heads or tails. So getting a *byte* (8 bits that are all zero) is like tossing heads 8 times in a row. It will happen on average 0.5 x 0.5 x 0.5 x 0.5 x 0.5 x 0.5 x 0.5 x 0.5 of the time (one half times one half times one half&#8230; etc.), which is 1/256 (2 to the -8).</p>
<p>4. WordPress might mess this up a bit (copy and paste into a decent editor, I guess). I chose 2560 tries because at an anomaly rate of 1/256 you would therefore expect an average of 10 anomalies every run. If the anomalies happened truly randomly you would expect to see one every 2 to the 64/2560 runs, which would take a verrrrrrrry lonnnnnnnnng tiiiiiiiiiiiime.</p>
<p><code><br />
&nbsp;local&nbsp;cipher&nbsp;=&nbsp;require&nbsp;'openssl.cipher'<br />
&nbsp;local&nbsp;base&nbsp;&nbsp;&nbsp;=&nbsp;require&nbsp;'base'<br />
&nbsp;<br />
&nbsp;local&nbsp;iv&nbsp;=&nbsp;string.rep('\x00',16)&nbsp;--&nbsp;Always&nbsp;use&nbsp;an&nbsp;all-zero&nbsp;16-byte&nbsp;IV<br />
&nbsp;local&nbsp;pt&nbsp;=&nbsp;string.rep('\x00',&nbsp;8)&nbsp;--&nbsp;Always&nbsp;use&nbsp;8&nbsp;zero&nbsp;bytes&nbsp;as&nbsp;plaintext<br />
&nbsp;<br />
&nbsp;local&nbsp;tries&nbsp;=&nbsp;2560<br />
&nbsp;local&nbsp;weird&nbsp;=&nbsp;0<br />
&nbsp;<br />
&nbsp;for&nbsp;i&nbsp;=&nbsp;1,tries&nbsp;do<br />
&nbsp;&nbsp;&nbsp;&nbsp;local&nbsp;cfb8&nbsp;=&nbsp;cipher.new('aes-128-cfb8')&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Use&nbsp;the&nbsp;AES-128-CFB8&nbsp;cipher<br />
&nbsp;&nbsp;&nbsp;&nbsp;local&nbsp;key&nbsp;&nbsp;=&nbsp;io.open'/dev/urandom':read(16)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Use&nbsp;a&nbsp;different&nbsp;random&nbsp;key&nbsp;each&nbsp;time<br />
&nbsp;&nbsp;&nbsp;&nbsp;local&nbsp;ct&nbsp;&nbsp;&nbsp;=&nbsp;cfb8:encrypt(key,iv):final(pt)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Do&nbsp;the&nbsp;8-byte&nbsp;encryption<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Print&nbsp;out&nbsp;the&nbsp;key&nbsp;we&nbsp;used&nbsp;and&nbsp;the&nbsp;ciphertext&nbsp;returned.<br />
&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;These&nbsp;strings&nbsp;should&nbsp;both&nbsp;be&nbsp;decently&nbsp;pseudorandom.<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;io.write(string.format('%5d&nbsp;&nbsp;%s&nbsp;&nbsp;%s',i,base.hex(key),base.hex(ct)))<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;The&nbsp;ciphertext&nbsp;and&nbsp;the&nbsp;plaintext&nbsp;should&nbsp;be<br />
&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;identical&nbsp;so&nbsp;rarely&nbsp;as&nbsp;for&nbsp;it&nbsp;to&nbsp;be&nbsp;freaky<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;ct&nbsp;==&nbsp;pt&nbsp;then<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.write('&nbsp;***ANOMALY***')<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;weird&nbsp;=&nbsp;weird&nbsp;+&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;io.write('\n')<br />
&nbsp;end<br />
&nbsp;<br />
&nbsp;io.write('\n',weird,'&nbsp;one-in-a-quintillion&nbsp;anomalies&nbsp;in&nbsp;',tries,'&nbsp;tries.\n\n')<br />
&nbsp;io.write('Rate&nbsp;is&nbsp;1&nbsp;in&nbsp;',math.floor(tries/weird),'\n\n')</code></p>
<div class="cs-rating pd-rating" id="pd_rating_holder_7238218_comm_6253662"></div>
<script type="text/javascript" charset="UTF-8"><!--//--><![CDATA[//><!--
PDRTJS_settings_7238218_comm_6253662={"id":7238218,"unique_id":"wp-comment-6253662","title":"1.%20The%20client%20encrypts%20its%20original%20ClientChallenge%20using%20its%20SessionKey%2C%20producing%20the%20ClientCredential.%20The%20server%20goes%20in%20reverse%2C%20and%20decrypts%20the%20received%20ClientCredential%20using%20its%20SessionK%E2%80%A6","permalink":"https:\/\/nakedsecurity.sophos.com\/2020\/09\/17\/zerologon-hacking-windows-servers-with-a-bunch-of-zeros\/#comment-6253662","item_id":"_comm_6253662"};
//--><!]]></script>
<script type="text/javascript" charset="UTF-8" src="https://polldaddy.com/js/rating/rating.js"></script>				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/?replytocom=6253662#respond' data-commentid="6253662" data-postid="525451" data-belowelement="div-comment-6253662" data-respondelement="respond" data-replyto="Reply to Paul Ducklin" aria-label='Reply to Paul Ducklin'>Reply</a></div>			</article><!-- .comment-body -->
		<ul class="children">
		<li id="comment-6253728" class="comment even depth-3 parent">
			<article id="div-comment-6253728" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/?s=50&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/?s=100&#038;d=mm&#038;r=g 2x' class='avatar avatar-50 photo avatar-default' height='50' width='50' loading='lazy'/>						<b class="fn">Issam</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/#comment-6253728"><time datetime="2020-11-16T21:46:53+00:00">November 16, 2020 at 9:46 pm</time></a>					</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Thank you a lot for taking the time to answer my questions!</p>
<div class="cs-rating pd-rating" id="pd_rating_holder_7238218_comm_6253728"></div>
<script type="text/javascript" charset="UTF-8"><!--//--><![CDATA[//><!--
PDRTJS_settings_7238218_comm_6253728={"id":7238218,"unique_id":"wp-comment-6253728","title":"Thank%20you%20a%20lot%20for%20taking%20the%20time%20to%20answer%20my%20questions%21%E2%80%A6","permalink":"https:\/\/nakedsecurity.sophos.com\/2020\/09\/17\/zerologon-hacking-windows-servers-with-a-bunch-of-zeros\/#comment-6253728","item_id":"_comm_6253728"};
//--><!]]></script>
<script type="text/javascript" charset="UTF-8" src="https://polldaddy.com/js/rating/rating.js"></script>				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/?replytocom=6253728#respond' data-commentid="6253728" data-postid="525451" data-belowelement="div-comment-6253728" data-respondelement="respond" data-replyto="Reply to Issam" aria-label='Reply to Issam'>Reply</a></div>			</article><!-- .comment-body -->
		<ul class="children">
		<li id="comment-6253738" class="comment byuser comment-author-pducklin bypostauthor odd alt depth-4">
			<article id="div-comment-6253738" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/025c4bb891cbc5a1bb24a4854f823e48?s=50&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/025c4bb891cbc5a1bb24a4854f823e48?s=100&#038;d=mm&#038;r=g 2x' class='avatar avatar-50 photo' height='50' width='50' loading='lazy'/>						<b class="fn">Paul Ducklin</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/#comment-6253738"><time datetime="2020-11-16T22:35:04+00:00">November 16, 2020 at 10:35 pm</time></a>					</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>No worries, it was worth my time to go back and check the answers :&#045;)</p>
<div class="cs-rating pd-rating" id="pd_rating_holder_7238218_comm_6253738"></div>
<script type="text/javascript" charset="UTF-8"><!--//--><![CDATA[//><!--
PDRTJS_settings_7238218_comm_6253738={"id":7238218,"unique_id":"wp-comment-6253738","title":"No%20worries%2C%20it%20was%20worth%20my%20time%20to%20go%20back%20and%20check%20the%20answers%20%3A%26%23045%3B%29%E2%80%A6","permalink":"https:\/\/nakedsecurity.sophos.com\/2020\/09\/17\/zerologon-hacking-windows-servers-with-a-bunch-of-zeros\/#comment-6253738","item_id":"_comm_6253738"};
//--><!]]></script>
<script type="text/javascript" charset="UTF-8" src="https://polldaddy.com/js/rating/rating.js"></script>				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://nakedsecurity.sophos.com/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/?replytocom=6253738#respond' data-commentid="6253738" data-postid="525451" data-belowelement="div-comment-6253738" data-respondelement="respond" data-replyto="Reply to Paul Ducklin" aria-label='Reply to Paul Ducklin'>Reply</a></div>			</article><!-- .comment-body -->
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		
	
	
		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">What do you think? <small><a rel="nofollow" id="cancel-comment-reply-link" href="/2020/09/17/zerologon-hacking-windows-servers-with-a-bunch-of-zeros/#respond" style="display:none;">Cancel reply</a></small></h3><form action="https://nakedsecurity.sophos.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" /></p>
<p class="comment-form-email"><label for="email">Email</label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='525451' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="086b01ea6b" /></p><input type="hidden" id="ak_js" name="ak_js" value="12"/><textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100" style="display: none !important;"></textarea></form>	</div><!-- #respond -->
	
</div><!-- #comments -->
		<div class="comments-widget-area">
					</div>
	
	</div> <!-- .panel-container -->
	</div> <!-- .container -->
	</section> <!-- .panel -->

	

	<section class="recommended-panel">
	<div class="container">
	<div class="panel-content ">

		<h3 class="block-title">Recommended reads</h3>
	<div class="blocks">
		<article id="post-544375" class="card-slide">
	<div class="card-image">
		<div class="image-pointer"></div>
		<a href="https://nakedsecurity.sophos.com/2020/12/31/s3-ep13-a-chat-with-hacker-keren-elazari-podcast/"><div class="dynamic-image-frame">
		<div class="dynamic-image" style="background-image: url(https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/10/nean-with-mic-wt-1200.png?w=412&#038;h=200&#038;crop=1);"></div>
	</div></a>
	</div>
	<div class="card-content">
		<div class="meta-box">
			<div class="date-box">
				<span class="month">Dec</span><span class="day">31</span>
			</div>
 			<div class="author-box">
			<span class="by">by</span>
		Paul Ducklin	
	</div>
			<div class="comment-box">
				<span class="count">1</span>
			</div>
		</div>
		<h3 class="card-title"><a href="https://nakedsecurity.sophos.com/2020/12/31/s3-ep13-a-chat-with-hacker-keren-elazari-podcast/" rel="bookmark">S3 Ep13: A chat with hacker Keren Elazari [Podcast]</a></h3>	</div>
</article> <!-- .card-article -->
<article id="post-544987" class="card-slide">
	<div class="card-image">
		<div class="image-pointer"></div>
		<a href="https://nakedsecurity.sophos.com/2021/02/01/naked-security-live-what-if-my-password-manager-gets-hacked/"><div class="dynamic-image-frame">
		<div class="dynamic-image" style="background-image: url(https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2020/10/nslive-1200-3.png?w=412&#038;h=200&#038;crop=1);"></div>
	</div></a>
	</div>
	<div class="card-content">
		<div class="meta-box">
			<div class="date-box">
				<span class="month">Feb</span><span class="day">01</span>
			</div>
 			<div class="author-box">
			<span class="by">by</span>
		Paul Ducklin	
	</div>
			<div class="comment-box">
				<span class="count">30</span>
			</div>
		</div>
		<h3 class="card-title"><a href="https://nakedsecurity.sophos.com/2021/02/01/naked-security-live-what-if-my-password-manager-gets-hacked/" rel="bookmark">Naked Security Live &#8211; What if my password manager gets hacked?</a></h3>	</div>
</article> <!-- .card-article -->
<article id="post-561067" class="card-slide">
	<div class="card-image">
		<div class="image-pointer"></div>
		<a href="https://nakedsecurity.sophos.com/2021/03/17/serious-security-the-linux-kernel-bugs-that-surfaced-after-15-years/"><div class="dynamic-image-frame">
		<div class="dynamic-image" style="background-image: url(https://nakedsecurity.sophos.com/wp-content/uploads/sites/2/2021/03/3lb.001.png?w=412&#038;h=200&#038;crop=1);"></div>
	</div></a>
	</div>
	<div class="card-content">
		<div class="meta-box">
			<div class="date-box">
				<span class="month">Mar</span><span class="day">17</span>
			</div>
 			<div class="author-box">
			<span class="by">by</span>
		Paul Ducklin	
	</div>
			<div class="comment-box">
				<span class="count">5</span>
			</div>
		</div>
		<h3 class="card-title"><a href="https://nakedsecurity.sophos.com/2021/03/17/serious-security-the-linux-kernel-bugs-that-surfaced-after-15-years/" rel="bookmark">Serious Security: The Linux kernel bugs that surfaced after 15 years</a></h3>	</div>
</article> <!-- .card-article -->
	</div>

	</div> <!-- .panel-container -->
	</div> <!-- .container -->
	</section> <!-- .panel -->

	
	
	<footer id="colophon" class="site-footer" role="contentinfo">
		<div class="footer-container">
			<a href="#" class="js-collapse-footer"><svg style="height: 20px" viewBox="0 0 132 24" class="block icon sophos"><use xlink:href="#sophos"></use></svg></a>
			<div id="collapseFooter" class="blocks">
				<div class="sophos block">
					<ul id="menu-footer-primary" class="primary menu"><li id="menu-item-306737" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-306737"><a href="https://nakedsecurity.sophos.com/about/">About Naked Security</a></li>
<li id="menu-item-306754" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-306754"><a href="https://www.sophos.com/en-us/company.aspx">About Sophos</a></li>
<li id="menu-item-306747" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-306747"><a href="https://nakedsecurity.sophos.com/send-us-a-tip/">Send us a tip</a></li>
<li id="menu-item-323171" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-323171"><a href="/cookies-and-scripts/">Cookies</a></li>
<li id="menu-item-323170" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-323170"><a href="https://www.sophos.com/en-us/legal/sophos-group-privacy-policy.aspx">Privacy</a></li>
<li id="menu-item-323169" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-323169"><a href="https://www.sophos.com/en-us/legal.aspx">Legal</a></li>
</ul>				</div>
										<div class="news block">
							<ul id="menu-products-column-one" class="small menu"><li id="menu-item-306998" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-306998"><a href="https://www.sophos.com/en-us/products/intercept-x.aspx">Intercept X</a></li>
<li id="menu-item-440801" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-440801"><a href="https://www.sophos.com/en-us/products/server-security.aspx">Intercept X for Server</a></li>
<li id="menu-item-440802" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-440802"><a href="https://www.sophos.com/en-us/products/mobile-control.aspx">Intercept X for Mobile</a></li>
</ul>						</div>
											<div class="products block">
							<ul id="menu-products-column-two" class="small menu"><li id="menu-item-440803" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-440803"><a href="https://www.sophos.com/en-us/products/next-gen-firewall.aspx">XG Firewall</a></li>
<li id="menu-item-440805" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-440805"><a href="https://www.sophos.com/en-us/products/sophos-email.aspx">Sophos Email</a></li>
<li id="menu-item-440804" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-440804"><a href="https://www.sophos.com/en-us/products/secure-wifi.aspx">Sophos Wireless</a></li>
</ul>						</div>
											<div class="threats block">
							<ul id="menu-server-protection" class="small menu"><li id="menu-item-440806" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-440806"><a href="https://www.sophos.com/en-us/products/managed-threat-response.aspx">Managed Threat Response</a></li>
<li id="menu-item-448404" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-448404"><a href="https://www.sophos.com/en-us/products/cloud-optix.aspx">Cloud Optix</a></li>
<li id="menu-item-440807" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-440807"><a href="https://www.sophos.com/en-us/products/phish-threat.aspx">Phish Threat</a></li>
</ul>						</div>
								</div>
			<ul class="block social footer">
				<li class="twitter"><a rel="nofollow" href="https://twitter.com/NakedSecurity" title="Follow our team of security experts on Twitter"><svg style="height: 14px" viewBox="0 0 100 100" class="icon twitter"><use xlink:href="#twitter"></use></svg></a></li>
				<li class="facebook"><a rel="nofollow" href="https://www.facebook.com/SophosSecurity" title="Join over 250,000 people in our Facebook community"><svg style="height: 14px" viewBox="0 0 100 100" class="icon facebook"><use xlink:href="#facebook"></use></svg></a></li>
				<li class="instagram"><a rel="nofollow" href="https://www.instagram.com/nakedsecurity/" title="Follow Naked Security on Instagram"><svg style="height: 14px" viewBox="0 0 100 100" class="icon instagram"><use xlink:href="#instagram"></use></svg></a></li>
				<li class="linkedin"><a rel="nofollow" href="https://www.linkedin.com/company/5053/" title="Join the naked security discussion group on LinkedIn"><svg style="height: 14px" viewBox="0 0 100 100" class="icon linkedin"><use xlink:href="#linkedin"></use></svg></a></li>
				<li class="rss"><a rel="nofollow" href="/feed" title="Subscribe to our RSS feed"><svg style="height: 14px" viewBox="0 0 100 100" class="icon rss"><use xlink:href="#rss"></use></svg></a></li>
			</ul>

							<div class="vip-powered-wpcom">
					<span class="copyright">© 1997 - 2021 Sophos Ltd.</span>
					All rights reserved.
					Powered by <a href="https://wpvip.com/?utm_source=vip_powered_wpcom&#038;utm_medium=web&#038;utm_campaign=VIP%20Footer%20Credit&#038;utm_term=nakedsecurity.sophos.com" rel="generator nofollow" class="powered-by-wpcom">WordPress VIP</a>				</div>
					</div>
		<script type="text/javascript">
			window.cookieconsent_options = {
				"message":"This site uses cookies. By continuing to browse the site you are agreeing to our use of cookies.",
				"dismiss":"Got it!",
				"learnMore":"Learn More",
				"link":"/cookies-and-scripts",
				"theme":"https://nakedsecurity.sophos.com/wp-content/themes/sophosnews-2015/css/sophos.css"};
		</script>
	</footer><!-- #colophon -->
</div><!-- #page -->
<div id="survey-wrapper" class="mfp-hide"><div class="pd-embed" id="pd_1499706777" data-settings=""></div></div>
<script id='child-js-plugins-js-extra'>
var PG8Data = {"startPage":"1","maxPages":"0","nextLink":""};
</script>
<script id='child-js-core-js-extra'>
var Sophos = {"ajaxurl":"https:\/\/nakedsecurity.sophos.com\/wp-admin\/admin-ajax.php","nonce":"64f6810f0c"};
</script>
<script type='text/javascript' src='https://nakedsecurity.sophos.com/_static/??-eJyNjkEKwjAQRS9kOo2YggvxKGLT0SZmJiGTULx9Q7HgwoXL+f89/sCSlI1ckAuUGQkFJKY5CuMi6thrA14ghfp0LJ2XA/wl2Jhxpx3bUKfGbTlRM1XGFN4dOf4FtRNpxOm73yepqs8zcH85ISxway48YqbGXumiB21OQ2/02a8RfU9z'></script>
<script src='https://stats.wp.com/e-202112.js' defer></script>
<script>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:9.5.2',blog:'166161173',post:'525451',tz:'0',srv:'nakedsecurity.sophos.com'} ]);
	_stq.push([ 'clickTrackerInit', '166161173', '525451' ]);
</script>
</body>
</html>
