
<!doctype html>
<html lang="en-US">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="preload" href="https://www.paloaltonetworks.com/content/dam/pan/en_US/includes/clearbit-autocomplete.css" as="style">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://usageanalytics.coveo.com">
  <link rel="preconnect" href="https://paloaltonetworks.tt.omtrdc.net">
  <link rel="preconnect" href="https://platform.cloud.coveo.com">
  <link rel="preconnect" href="https://assets.adobedtm.com">
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js'></script>
  <!-- Adobe -->
<script type="text/javascript">
;(function(win, doc, style, timeout) {
var STYLE_ID = 'at-body-style';
function getParent() {
return doc.getElementsByTagName('head')[0];
}
function addStyle(parent, id, def) {
if (!parent) {
return;
}
var style = doc.createElement('style');
style.id = id;
style.innerHTML = def;
parent.appendChild(style);
}
function removeStyle(parent, id) {
if (!parent) {
return;
}
var style = doc.getElementById(id);
if (!style) {
return;
}
parent.removeChild(style);
}
addStyle(getParent(), STYLE_ID, style);
setTimeout(function() {
removeStyle(getParent(), STYLE_ID);
}, timeout);
}(window, document, "body {opacity: 0 !important}", 3000));
</script>
<script src="//assets.adobedtm.com/9273d4aedcd2/0d76ae0322d7/launch-425c423d843b.min.js" async></script>
<!-- End Adobe -->
  
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap" rel="stylesheet">

  <!-- Typekit -->
  <!--
  <script src="//use.typekit.net/itd3sep.js"></script>
  <script>try{Typekit.load({ async: true });}catch(e){}</script>-->
  <!-- End Typekit -->

 


    


<link rel="apple-touch-icon" sizes="57x57" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/favicon-194x194.png" sizes="194x194">
<link rel="icon" type="image/png" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/manifest.json">
<link rel="mask-icon" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/safari-pinned-tab.svg" color="#8ad3de">
<link rel="shortcut icon" href="https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/assets/images/icons/favicon.ico">
<meta name="msapplication-TileImage" content="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/mstile-144x144.png">
<meta name="msapplication-config" content="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/browserconfig.xml">
<meta name="msapplication-TileColor" content="#da532c">




  <!-- Start WP HEAD -->
  <link rel="alternate" hreflang="en" href="https://blog.paloaltonetworks.com/2016/09/unit-42-labyrenth-capture-the-flag-ctf-windows-track-7-9-solutions/" />

	<!-- This site is optimized with the Yoast SEO plugin v14.2 - https://yoast.com/wordpress/plugins/seo/ -->
	<title>LabyREnth Capture the Flag (CTF): Windows Track 7-9 Solutions</title>
	<meta name="description" content="How did you do? LabyREnth CTF solutions for Windows Track 7-9 are ready." />
	<meta name="robots" content="index, follow" />
	<meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
	<meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
	<link rel="canonical" href="https://blog.paloaltonetworks.com/2016/09/unit-42-labyrenth-capture-the-flag-ctf-windows-track-7-9-solutions/" />
	<meta property="og:locale" content="en_US" />
	<meta property="og:type" content="article" />
	<meta property="og:title" content="LabyREnth Capture the Flag (CTF): Windows Track 7-9 Solutions" />
	<meta property="og:description" content="How did you do? LabyREnth CTF solutions for Windows Track 7-9 are ready." />
	<meta property="og:url" content="https://blog.paloaltonetworks.com/2016/09/unit-42-labyrenth-capture-the-flag-ctf-windows-track-7-9-solutions/" />
	<meta property="og:site_name" content="Palo Alto Networks Blog" />
	<meta property="article:published_time" content="2016-09-23T00:55:58+00:00" />
	<meta property="article:modified_time" content="2016-09-29T16:46:27+00:00" />
	<meta property="og:image" content="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_1-500x325.png" />
	<!-- / Yoast SEO plugin. -->


<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Palo Alto Networks Blog &raquo; Feed" href="https://blog.paloaltonetworks.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Palo Alto Networks Blog &raquo; Comments Feed" href="https://blog.paloaltonetworks.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Palo Alto Networks Blog &raquo; LabyREnth Capture the Flag (CTF): Windows Track 7-9 Solutions Comments Feed" href="https://blog.paloaltonetworks.com/2016/09/unit-42-labyrenth-capture-the-flag-ctf-windows-track-7-9-solutions/feed/" />
<meta property="og:date_created" content="September 22, 2016 at 5:55 PM"/>
<meta property="og:post_image" content=""/>
<meta property="og:post_id" content="19505"/>
<meta property="og:post_total_likes" content="0"/>
<meta property="og:post_length" content="4278"/>
<meta property="og:category" content="Events"/>
<meta property="og:category_link" content="https://blog.paloaltonetworks.com/category/events/"/>
<meta property="og:author" content="Richard Wartell"/>
<meta property="og:author" content="Josh Grunzweig"/>
<meta property="og:author" content="Esmid Idrizovic"/>
<meta property="og:authorloginname" content="Richard Wartell"/>
<meta property="og:authorloginname" content="Josh Grunzweig"/>
<meta property="og:authorloginname" content="Esmid Idrizovic"/>
<meta property="og:authorlink" content="https://blog.paloaltonetworks.com/author/richard-wartell/"/>
<meta property="og:authorlink" content="https://blog.paloaltonetworks.com/author/josh-grunzweig/"/>
<meta property="og:authorlink" content="https://blog.paloaltonetworks.com/author/esmid-idrizovic/"/>
<meta property="og:author_image_link" content="https://blog.paloaltonetworks.com/wp-content/uploads/2017/05/unit42_400x400.jpg"/>
<meta property="og:author_image_link" content="https://blog.paloaltonetworks.com/wp-content/uploads/2017/05/unit42_400x400.jpg"/>
<meta property="og:author_image_link" content="https://blog.paloaltonetworks.com/wp-content/uploads/2020/03/panw_master-twitter-profile-pic-400x400-1.png"/>
<meta property="og:section" content="Palo Alto Networks"/>
<meta property="og:recent_views" content="344"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"BlogPosting","headline":"LabyREnth Capture the Flag (CTF): Windows Track 7-9 Solutions","name":"LabyREnth Capture the Flag (CTF): Windows Track 7-9 Solutions","description":"Welcome back to our blog series where we reveal the\u00a0solutions\u00a0to\u00a0LabyREnth, the Unit 42 Capture the Flag (CTF)\u00a0challenge. We\u2019ll be revealing the\u00a0solutions\u00a0to one challenge track per week. Next up, the Windows track challenges &hellip;","url":"https:\/\/blog.paloaltonetworks.com\/2016\/09\/unit-42-labyrenth-capture-the-flag-ctf-windows-track-7-9-solutions\/","mainEntityOfPage":"https:\/\/blog.paloaltonetworks.com\/2016\/09\/unit-42-labyrenth-capture-the-flag-ctf-windows-track-7-9-solutions\/","datePublished":"September 22, 2016","articleBody":"Welcome back to our blog series where we reveal the\u00a0solutions\u00a0to\u00a0LabyREnth, the Unit 42 Capture the Flag (CTF)\u00a0challenge. We\u2019ll be revealing the\u00a0solutions\u00a0to one challenge track per week. Next up, the Windows track challenges 7 through 9.\u00a0\r\nWindows 7 Challenge: Some guy found this pcap and executable. Ready, set, go!\r\nChallenge Created By: Josh Grunzweig @jgrunzweig\r\n\r\nFor this challenge, users were given both a PCAP and a Windows executable file. Taking a quick look at the PCAP file, we see there are a number of individual connections from 172.16.95.1 to 172.16.95.190, each about the same size.\r\n\r\n\r\nFigure 1 Connections in G0blinKing pcap file\r\nLooking at a specific connection, we see that each one is transferring a single byte of data at a time.\r\n\r\n\r\nFigure 2 Data in stream 0 for G0blinKing pcap file\r\nPresumably, we can come to the conclusion that some data is being sent from one host to another, one byte at a time. To determine what data has been generated, we need to look at the Windows executable file.\r\n\r\nOpening the file, we see a minor Easter egg, where the pdb string was overwritten.\r\n\r\n\r\nFigure 3 Overwritten pdb path\r\nUnfortunately for this file, it doesn\u2019t disassemble terribly well, and we see a number of functions that simply jump to the actual function containing the relevant code. This is just a byproduct of how the file was compiled. Looking through the code, however, we can see that the actual core functionality of the code starts at a function at offset 0x412300.\r\n\r\nPerforming a quick triage of the sample and the functions that are called, we can get a high-level overview of what is going on. Note that I\u2019ve renamed a few of the functions in the figure below based on guesses as to what the functions may be doing.\r\n\r\n\r\nFigure 4 Main function of executable\r\nSo, we can safely conclude that some form of encryption is being performed against the data contained in file.txt, it\u2019s then being encoded, and then sent across the network, where the PCAP was generated from. At this point we simply need to identify what is happening during encryption and encoding respectively.\r\n\r\nFor encryption, we track down a function that looks to be primarily responsible. We also identify a string aptly named \u2018AWildKeyAppears!\u2019, which is most likely going to be the key used for encryption. Looking at the beginning of this function, we identify a number of constants as seen in the following figure.\r\n\r\n\r\nFigure 5 Encryption function\r\nA number of these constants turn out to be red herrings. However, if we look at the constant of 0x9E3769B9, we see that this constant is used in the TEA\/XTEA encryption algorithms. Further review of this function shows us that we\u2019re simply dealing with XTEA, with a few red herrings thrown in. The following original source code shows what it looked like prior to compilation.\r\nunsigned int key[4] = {0x6c695741, 0x79654b64, 0x65707041, \r\n0x21737261};\r\n\r\n#define BLOCK_SIZE 8\r\n\r\nvoid xtea_encipher(unsigned int num_rounds, uint32_t v[2], \r\nuint32_t const key[4]) {\r\n    unsigned int i;\r\n    uint32_t j, o, s, h;\r\n    j = 0xBADA55;\r\n    uint32_t delta = 0x9e3769b9;\r\n    o = 0x4913092;\r\n    s = 0x12345678;\r\n    h = 0xDEADBEEF;\r\n    uint32_t v0=v[0], v1=v[1], sum=0;\r\n    for (i=0; i &lt; num_rounds; i++) {\r\n        v0 += (((v1 &lt;&lt; 4) ^ (v1 &gt;&gt; 5)) + v1) ^ (sum + key[sum &amp; \r\n3]);\r\n        j += 4092;\r\n        o -+ 4092;\r\n        for (int x = 8; x &lt; 32; x++) {\r\n          s = s*8;\r\n          j -= 64;\r\n          o -= 8;\r\n        }\r\n        h = 64;\r\n        sum += (delta + 4096);\r\n        v1 += (((v0 &lt;&lt; 4) ^ (v0 &gt;&gt; 5)) + v0) ^ (sum + \r\nkey[(sum&gt;&gt;11) &amp; 3]);\r\n    }\r\n    v[0]=v0; \r\n    v[1]=v1;\r\n}\r\n\r\nNow we can move onto the encoding function. At a quick glance, it looks to be base64. However, if we look at the alphabet, it does not look to be standard. The following is the traditional base64 alphabet.\r\n\r\nABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+\/\r\n\r\nThis is the alphabet discovered within the Windows executable.\r\n\r\nqtgJYKa8y5L4flzMQ\/BsGpSkHIjhVrm3NCAi9cbeXvuwDx+R6dO7ZPEno21T0UFW\r\n\r\nKnowing this, we can now create a script that will both parse the PCAP file and decrypt the contents sent across the wire. The following script was created to accomplish this.\r\nimport string\r\nimport dpkt\r\nimport sys\r\nimport base64\r\nimport struct\r\n\r\n\r\ndef xtea_decrypt(key,block, n=32, endian=\"!\"):\r\n  v0,v1 = struct.unpack(endian+\"2L\",block)\r\n  k = struct.unpack(endian+\"4L\",key)\r\n  delta,mask = 0x9e3779b9L,0xffffffffL\r\n  sum = (delta * n) &amp; mask\r\n  for round in range(n):\r\n    v1 = (v1 - (((v0&lt;&lt;4 ^ v0&gt;&gt;5) + v0) ^ (sum + k[sum&gt;&gt;11 &amp; \r\n3]))) &amp; mask\r\n    sum = (sum - delta) &amp; mask\r\n    v0 = (v0 - (((v1&lt;&lt;4 ^ v1&gt;&gt;5) + v1) ^ (sum + k[sum &amp; 3]))) &amp; \r\nmask\r\n  return struct.pack(endian+\"2L\",v0,v1)\r\n\r\nall_data = \"\"\r\n\r\ndef parse_pcap_file(filename):\r\n  global all_data\r\n  f = open(filename)\r\n  pcap = dpkt.pcap.Reader(f)\r\n  for ts, buf in pcap:\r\n    eth = dpkt.ethernet.Ethernet(buf)\r\n    ip = eth.data\r\n    tcp = ip.data\r\n    if tcp.dport == 8080 and len(tcp.data) &gt; 0:\r\n      all_data += tcp.data\r\n\r\nif __name__ == '__main__':\r\n  if len(sys.argv) &lt;= 1:\r\n    print \"%s [pcap file]\" % __file__\r\n    sys.exit(2)\r\n  parse_pcap_file(sys.argv[1])\r\n\r\nnew_b64_chars  = \r\n\"qtgJYKa8y5L4flzMQ\/BsGpSkHIjhVrm3NCAi9cbeXvuwDx+R6dO7ZPEno21T0UF\r\nW\"\r\nold_b64_chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+\r\n\/\"\r\n\r\nall_data = all_data.translate(string.maketrans(new_b64_chars, \r\nold_b64_chars))\r\ndata = base64.b64decode(all_data)\r\n\r\nresult = \"\"\r\nkey = 'AWildKeyAppears!'\r\nfor x in range(0, len(data)\/8):\r\n  o = xtea_decrypt(key, data[8*x:8*x+8], endian=\"&lt;\")\r\n  result += o\r\nprint result\r\n\r\nRunning this script against the provided PCAP file, we\u2019re presented with the following output.\r\nPADDINGPADDINGPADDINGPADDINGPADDINGPADDINGPADDINGPADDINGP\r\nPAN{did_1_mention_th0se_pupp3ts_fr34ked_m3_out_recent1y?}\r\nPADDINGPADDINGPADDINGhibobPADDINGPADDINGPADDINGPAD\r\n\r\nPAN{did_1_mention_th0se_pupp3ts_fr34ked_m3_out_recent1y?}\r\nWindows 8 Challenge: Prepare for windows kernel debugging! (smile)\r\nChallenge Created By: Esmid Idrizovic @xedi25\r\nInitial analysis\r\nWhen we open the file revloader.exe in a PE viewer we see that it\u2019s a PE64 file. The file contains three unencrypted resources in the RCData directory.\u00a0 We extract all three resource files to look at what\u2019s in these files.\r\n\r\n\r\nResources of revloader.exe\r\nResource 101\r\n\r\nThis file is also a PE64 and contains some version information strings, which tells us that it\u2019s DSEFix. DSEFix is a tool that can bypass the driver signature enforcement in Windows by using an exploit in a signed VirtualBox driver. By using DSEFix, you can disable DSE and load any driver you want. So it looks like we\u2019ll solve this challenge by using an unsigned windows driver.\r\n\r\n\r\n\r\nResource 102\r\n\r\nThis is the driver itself. It\u2019s also a PE64 and uses FLTMGR.SYS. In version information, we can see that it\u2019s a windows driver with the internal name revhunt.sys. We can also see that the file is not signed, so it makes sense that revloader.exe is going to use DSEFix to load the revhunt.sys.\r\n\r\nResource 103\r\n\r\nThis is an INF file for the driver. We can see that it\u2019s a mini file filter driver and that it uses the altitude 31337.\r\nRevloader\r\nLet\u2019s start with revloader.exe to verify that it\u2019s going to drop DSEFix driver and run DSEFix to disable windows driver signature enforcement. We can take a look at the import table to find important functions that might be used for this kind of work.\r\n\r\n\r\n\r\n \tLookupPrivilegeValueW\/AdjustTokenPrivilege: to acquire the missing rights to load a driver (\u201cSeLoadDriverPrivilege\u201d).\r\n \tLoadResource\/FindResource: to find a resource and map it to memory.\r\n \tCreateFileW: to create or access a file on the disk.\r\n \tWinExec: to execute a file.\r\n \tFilterLoad\/FilterUnload: to load and unload a mini filter driver.\r\n\r\nFollowing cross-references to FilterLoad we can see that the function to load the driver is at 0x140001800. That function uses InstallHinfSectionW with arguments \u201cDefaultInstall 132 &lt;filename.inf&gt;\u201d to install the driver and then uses FilterLoad to load the driver. If we follow that function back, we can see that this function has been called from main function and we can see that there are a few more interesting calls:\r\n\r\n\r\n\r\nWe can see that the function at 0x140001FD0 will be called with argument 101, 102, and 103. That means this function is probably accessing the embedded resources. If we look into that function we will see that it uses FindResourceW, SizeofResource, LoadResource, CreateFileW and WriteFile. We can rename that function to DropResource. After these three calls, it will call WinExec.\r\n\r\nThat means that revloader is dropping the resources to current directory (resource 101, 102, 103) and then executing dsefix.exe (resource 101) after it loads the mini file filter driver (resource 102 + 103).\r\n\r\nLet\u2019s run revloader.exe to load the driver into kernel and see if it works.\r\n\r\n\r\n\r\nWe can see the \u201cWelcome to revhunt x86-x64\u201d. Now let\u2019s analyze the driver and try to find the flag.\r\nRevhunt\r\nOpening revhunt.sys in IDA Pro we can see that in DriverEntry function there is a jump to 0x140007000. That looks like the real main function.\r\n\r\n\r\n\r\nWe can see that the driver is using some kernel anti-debugging functions like KdDebuggerNotPresent and KdDisableDebugger. That means if we attach a kernel debugger to our virtual machine, the function KdDisableDebugger will disconnect us. We would have to patch KdDebuggerNotPresent and KdDisableDebugger with NOP instruction or, since the driver is not signed, we can also patch the calls in the driver itself.\r\n\r\nWe can also see that the driver uses FltRegisterFilter and FltStartFiltering. Let\u2019s take a look at definition of FltRegisterFilter:\r\nNTSTATUS FltRegisterFilter(\r\n_In_\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0PDRIVER_OBJECT \u00a0\u00a0Driver,\r\n_In_\u00a0\u00a0const FLT_REGISTRATION *Registration,\r\n_Out_\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0PFLT_FILTER \u00a0\u00a0\u00a0\u00a0\u00a0*RetFilter\r\n);\r\n\r\nFltRegisterFilter takes a FLT_REGISTRATION structure as a second argument that contains information (flags, callback routines, etc.) for the registration of the mini file filter driver. The second argument for FltRegisterFilter in this case is:\r\nlea\u00a0\u00a0\u00a0\u00a0 rdx, unk_140003140\r\n\r\nWe can go to IDA Pro and set a structure at 0x140003140 as FLT_REGISTRATION but before we do that we have to load the correct type library: Windows Driver Kit 8 (kernel mode) - wdk8_km. You can also take any newer DDK libraries. Now we can set the correct structure:\r\n\r\n\r\n\r\nUsing that we can quickly identify what each sub-function is used for. We can also see that the flags for the structure are set to 0x02, which is FLTFL_REGISTRATION_SUPPORT_NPFS_MSFS. According to MSDN that means that the driver supports named pipes and mailslot requests as normal file events.\r\n\r\n\r\n\r\nNow let\u2019s do the same with OperationRegistration and set a structure of FLT_OPERATION_REGISTRATION:\r\n\r\n\r\n\r\nChecking quickly for PreOperation and PostOperation code, we can see that the really interesting code is going on in the PostOperation function, so let\u2019s analyze that.\r\nPostOperation callback\r\nBefore we start, we should set a new function definition in IDA Pro to the correct definition like in MSDN, it will make our analysis a lot easier (and if you use the Hex-Rays Decompiler it will decompile a lot better). So let\u2019s change the function definition to:\r\ntypedef FLT_POSTOP_CALLBACK_STATUS ( *PFLT_POST_OPERATION_CALLBACK)(\r\n_Inout_\u00a0\u00a0PFLT_CALLBACK_DATA \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Data,\r\n_In_\u00a0\u00a0\u00a0\u00a0\u00a0PCFLT_RELATED_OBJECTS \u00a0\u00a0\u00a0FltObjects,\r\n_In_opt_\u00a0PVOID \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0CompletionContext,\r\n_In_\u00a0\u00a0\u00a0\u00a0\u00a0FLT_POST_OPERATION_FLAGS Flags\r\n);\r\n\r\n__int64 __fastcall PostOperation(PFLT_CALLBACK_DATA\r\nCallbackData, PCFLT_RELATED_OBJECTS FltObjects, PVOID\r\nCompletionContext, FLT_POST_OPERATION_FLAGS Flags);\r\n\r\nBy loading the correct type libraries, we can simplify the analysis because that code looks easier to read:\r\n\r\n\r\n\r\nWe can see that the function is checking if the current FileObject is a mailslot event (FO_MAILSLOT), if the current file name of the object is 18 characters long, if \u201c\\gsrt.txt\u201d, and if the current event is opening the file. If that\u2019s the case, then it will use FltReadFile to read from the file and compare the content with encrypted data:\r\n\r\n\r\n\r\nSo let\u2019s quickly decode that using a python script:\r\ndata = [0x7F, 0x56, 0x71, 0x4E, 0x61, 0x52, 0x7D, 0x43, 0x7B, 0x19, 0x70, 0x58, 0x7E,\r\n0x37]\r\nfor x in range(0, 14):\r\nif (x % 2 == 0):\r\ndata[x] ^= 0x13\r\nelse:\r\ndata[x] ^= 0x37\r\nprint str (bytearray(data))\r\n\r\n$ python decoder.py\r\nlabyrenth.com\r\n\r\nThat means, we have to create a file named \u201c\\gsrt.txt\u201d with the content \u201clabyrenth.com\u201d and then open the file. After that we can see there is another byte array initialized on the stack and decode it using the same technique as before:\r\n\r\n\r\n\r\nLet us write that to our script and decode also that string.\r\ndata = [ 0x5C, 0x5F, 0x3D, 0x19, 0x3D, 0x17, 0x7C, 0x5C, 0x72, 0x4E, 0x3D, 0x19,\r\n0x3D, 0x19, 0x5A, 0x17, 0x7E, 0x52, 0x72, 0x59, 0x33, 0x7E, 0x43, 0x74,\r\n0x33, 0x58, 0x7D, 0x17, 0x2D, 0x0A, 0x33, 0x60, 0x7A, 0x59, 0x77, 0x58,\r\n0x64, 0x44, 0x33, 0x0F, 0x33, 0x40, 0x7C, 0x42, 0x7F, 0x53, 0x33, 0x5F,\r\n0x72, 0x41, 0x76, 0x17, 0x71, 0x52, 0x76, 0x59, 0x33, 0x52, 0x72, 0x44,\r\n0x7A, 0x52, 0x61, 0x17, 0x71, 0x42, 0x67, 0x17, 0x7E, 0x5A, 0x7E, 0x5A,\r\n0x78, 0x56, 0x6A, 0x17, 0x6A, 0x58, 0x66, 0x17, 0x72, 0x45, 0x76, 0x17,\r\n0x67, 0x5F, 0x76, 0x17, 0x61, 0x52, 0x65, 0x52, 0x61, 0x44, 0x76, 0x45,\r\n0x33, 0x5F, 0x76, 0x45, 0x76, 0x19, 0x19, 0x37]\r\n\r\nfor x in range(0, 104):\r\nif (x % 2 == 0):\r\ndata[x] ^= 0x13\r\nelse:\r\ndata[x] ^= 0x37\r\n\r\nprint str(bytearray(data))\r\n\r\n$ python decoder.py\r\nOh... okay....I mean IPC on &gt;= Windows 8 would have been easier but mmmmkay you are the reverser here.\r\n\r\nThat looks like a hint that tells us that we could have used Interprocess Communications (IPC) to do the same. If we scroll up again we will see that the sample was comparing the current FileObject.Flags with FO_MAILSLOT. That means if there was any Mailslot event it would have directly jumped to 0x140001405, which looks like an initialization function.\r\n\r\nIf we take a look into that function, we will see that it will allocate a memory address using ExAllocatePoolWithTag and save the result at 0x140004020, which I have named lpszBuffer.\r\n\r\n\r\n\r\nIf we take a look at the cross-references to lpszBuffer, we will see that it\u2019s used in four functions: PostOperation, InitBuffer, 0x14000181C, and Unload. We will look into 0x14000181C a little later but now let\u2019s go back to the PostOperation function and see what happens next.\r\n\r\nAfter the InitBuffer call, it will check the filename of the FileObject again and compare it with \u201c\\pan.flag\u201d. If that\u2019s correct, it will call the function 0x14000181C and it will print the flag using DbgPrint. That means that the decrypting routine is at 0x14000181C and that lpszBuffer will contain the decoded flag.\r\n\r\n\r\n\r\nNow let\u2019s take a look into the function at 0x14000181C. I have renamed that function to TestFlag.\r\nAnalyzing flag testing function\r\nAt the beginning of the function we can see that it uses FltReadFile again to read the content of the given FileObject. We can also see that it reads 58 bytes. The first four bytes are compared with \u201cPAN{\u201c.\r\n\r\n\r\n\r\nAfter that we can see first set of XOR data. It will take the next four bytes and XOR them with 0x1A1B1C1D and compare the result with 0x366C734A. It\u2019s time to start writing our decoder.\r\nkey = \"PAN{\"\r\nkey += (hex(0x366C734A ^ 0x1A1B1C1D)[2:]).decode('hex')[::-1]\r\n\r\nLooks good so far...\r\npython decoder.py\r\nPAN{Wow,\r\n\r\nLet\u2019s move on to the next characters. The next code segment is doing some shifting and XOR based on the result of KdDebuggerNotPresent. Function KdDebuggerNotPresent should return 1 if there is no debugger attached. We also have to reverse the order to get the correct key:\r\n\r\n\r\nkey += chr((0xB0 ^ 0xF0) &gt;&gt; 1)\r\n\r\nThe result is a space character (0x20 in hex). We can move on to the next character but we have to reverse the order again to get the correct character (instead of add, we have to use sub, etc.):\r\n\r\n\r\nkey += chr((0x56 ^0x20) - 4)\r\n\r\nNow we just have to continue to slowly decode the whole flag but it gets trickier with a call to 0x140001AFC. At this function it will try to access characters at different offsets and do weirder calculations:\r\n\r\n\r\n\r\nFor example, at 0x140001B41 it will load the fourth character and subtract 0x20 from it and multiply it with 3 [rax+rax*2] and then it will compare it with 0xC3. Optimizer can do some pretty cool stuff sometimes.\r\n\r\nAfter analyzing the whole function and its sub-functions, we get the following decoder script:\r\n# 0x14000190A\r\nkey = \"PAN{\"\r\nkey += (hex(0x366C734A ^ 0x1A1B1C1D)[2:]).decode('hex')[::-1]\r\nkey += chr((0xB0 ^ 0xF0) &gt;&gt; 1)\r\nkey += chr((0x56 ^0x20) - 4)\r\nkey += (hex((0x8888999900001110 &amp; 0xFFFFFFFFFFFFFFF0) ^ 0x0A9FAFCEA72656775))[2:-\r\n1].decode('hex')[::-1]\r\n# 0x140001AFC\r\nkey += chr(0x20)\r\nkey += chr(0x67 - 0x20)\r\nkey += chr(0x72)\r\nkey += chr(0xfc ^ 0x99)\r\nkey += chr((0xc3 \/ 3) + 0x20)\r\nkey += chr(0x3b ^ 0x4f)\r\nkey += chr(0x20)\r\nkey += chr((0x71 - 0x0f) ^ 0x0f)\r\nkey += chr((0x81 ^ 0x21) - 0x31)\r\nkey += chr(0x46 + 0x30)\r\nkey += chr((1 ^ 0x58) + 0x0c)\r\nkey += chr(0x73)\r\n# 0x140001BD4\r\nkey += chr(0x2c)\r\nkey += chr(0x20)\r\nkey += chr(0x1ac0 &gt;&gt; 6)\r\nkey += chr(0x328 \/ 8)\r\nkey += chr((0xe002 ^ 0xf2f2) \/ 0x30)\r\nkey += chr((0x9542 ^ 0x8942) &gt;&gt; 6)\r\nkey += chr(0x1f + 1)\r\nkey += chr(0x834 * 4 \/ 0x50)\r\nkey += chr((0x94dd ^ 0x83c1) \/ 0x33)\r\nkey += chr(0x1f + 1)\r\nkey += chr((0x1dd36c ^ 0x46) \/ 0x4142)\r\nkey += chr(0x328250 \/ 0x7373)\r\n# 0x140001CD8\r\nkey += chr((0xb6 ^ 0x32) \/ 3)\r\nkey += chr(0x40 - 0x20)\r\nkey += chr((0xd7 ^ 0x44) - 0x23)\r\nkey += chr((0xb2 ^ 0x21) - 0x21)\r\nkey += chr(0x1bc \/ 4)\r\nkey += chr((0x8f25 ^ 0x8875) &gt;&gt; 4)\r\nkey += chr(((0x0d6 ^ 0x0e4) \/ 2) &lt;&lt; 2)\r\nkey += chr((0x62 ^ 0x42) &amp; 0xfe)\r\n# 0x140001DB8\r\nkey += chr((0x70d49 ^ 0x48354) \/ 0x833)\r\nkey += chr((0x14c3a1 ^ 0x232221) \/ 0x8c40)\r\nkey += chr(0xA0 ^ 0x80)\r\n# 0x140001E2C\r\nkey += chr(0x5c ^ 0x25)\r\nkey += chr((0x20f63 ^ 0x23) \/ 0x4c0)\r\nkey += chr((0x242067 ^ 0x12567) \/ 0x5100)\r\nkey += chr(((0x61 ^ 0x21) &gt;&gt; 6) + 0x20)\r\nkey += '}'\r\n\r\nprint key\r\n\r\npython decoder.py\r\n\r\nPAN{Wow, reverser! Great moves, keep it up, proud of you!}\r\n\r\nTesting the flag\r\nNow we\u2019ll test the flag to confirm if everything is correct. We have to do following steps:\r\n\r\n \tCreate a file named \u201cgsrt.txt\u201d with content \u201clabyrenth.com\u201d\r\n \tOpen \u201cgsrt.txt\u201d to raise a FILE_OPEN event to initialize the buffer\r\n\r\n \tWe can also create a mailsot event instead of these two steps (we can use CreateMailslot + WriteFile)\r\n\r\n\r\n \tCreate a file named \u201cpan.flag\u201d with our flag \u201cPAN{\u2026}\u201d\r\n \tOpen \u201cpan.flag\u201d to raise a FILE_OPEN event to call the analyzing function\r\n \tAttach with DbgView to see the kernel debug output\r\n\r\nThe solution with creating a file is easier because we can make a batch file to do the job for us:\r\nSolution.bat\r\necho PAN{Wow, reverser! Great moves, keep it up, proud of you!} &gt; c:\\pan.flag\r\necho labyrenth.com&gt; c:\\gsrt.txt\r\nstart notepad c:\\gsrt.txt\r\nstart notepad c:\\pan.flag\r\n\r\nWe run revloader.exe and run our solution batch file and see what happens:\r\n\r\n\r\n\r\nAnd we can see in the last screenshot that the flag is correct and it gets printed out.\r\nWindows 9 Challenge: I think some holy dude wrote that crypter.\r\nChallenge Created By: Esmid Idrizovic @xedi25\r\nInitial analysis\r\nWhen we run the final challenge, we see a dialog where we have to enter 30 characters. We can also see that the icon is different and that it\u2019s the default Delphi 7 executable icon. If we enter any text and press enter we see that the label changes to \u201cWrong\u201d. That means that we have to enter the correct flag and press enter to verify it.\r\n\r\n\r\n\r\nIf we open that sample in a PE viewer, we see that it\u2019s using an unknown EXE crypter to hide its code (actually that crypter is Morphine 2.7 which is also written in Delphi). We can see that by looking at the import table there are just LoadLibraryA, GetProcAddress, and the PE sections.\r\n\r\n\r\n\r\nWe can solve this challenge pretty fast if we know what we have to look for. We want to identify the routine that is checking for a valid flag. We can start our analysis at the function which sets the status to \u201cWrong\u201d, but before we can do that we have to dump the executable so we can load it in IDA Pro.\r\nDump the executable\r\nWe can use Scylla x86 to dump the process, so let\u2019s execute the challenge and run Scylla. Select \u201cDelphiChallenge.exe\u201d, press \u201cIAT Autosearch\u201d, after that press \u201cGet Imports\u201d and Scylla should be able to find the imports.\u00a0 You can already see the correct imports in next screenshot:\r\n\r\n\r\n\r\nWe can save the PE dump using \u201cDump\u201d and \u201cFix dump\u201d functions in Scylla. We can\u2019t run that dumped file but it\u2019s enough for a static analysis in IDA Pro. We can dump the file correctly but it takes a few extra steps (see extra part).\r\nStatic analysis\r\nNow open the file in IDA Pro and go directly to \u201cstrings window\u201d by using Shift+F12. Search in strings window for \u201cWrong\u201d and you should see these 5 entries:\r\n\r\n\r\n\r\nIf we follow the first string using cross-references, we can see that it\u2019s referenced in sub_4C17BC and there is one more interesting string:\r\n\r\nIf byte_4C4C5C is nonzero then it will show \u201cCorrect!! You are so g00d\u201d. Following byte_4C4C5C we can see that its set to 1 at offset 0x004C127F and that function starts at offset 0x004C0E1C. This function looks like our testing flag routine.\r\n\r\n\r\n\r\nWe have identified pretty quickly the routine which is checking for the correct flag, now we have to analyze that function. It\u2019s pretty similar to Windows track challenge 8. We know that the flag must start with \u201cPAN{\u201c and we can see that the function is checking for that at the beginning:\r\n\r\n\r\n\r\nWe have to follow the function and revert the calculations again like in Windows challenge 8. The final decoder script would look like this:\r\nkey = \"PAN{\"\r\nkey += chr(0xcf ^ 0xab)\r\nkey += chr(0x1e ^ 0x2d)\r\nkey += chr(0x3e ^ 0x52)\r\nkey += chr(0x52 ^ 0x22)\r\nkey += chr(0x08 ^ 0x60)\r\nkey += chr(0x68 + 0x01)\r\nkey += chr(0xe5 ^ 0xba)\r\nkey += chr(0xd7 ^ 0xbe)\r\nkey += chr(0xe6 \/ 2)\r\nkey += chr((0x2f &lt;&lt; 1) + 1)\r\nkey += chr(0x194 &gt;&gt; 2)\r\nkey += chr((0x19 &lt;&lt; 1) + 2)\r\nkey += chr((0x1c0 ^ 0x0c) &gt;&gt; 2)\r\nkey += chr(((0x38 ^0x04) &lt;&lt; 1) + 1)\r\nkey += chr(((0x28 + 0x07) &lt;&lt; 1) + 1)\r\nkey += chr(((0x8c \/ 0x0A) &lt;&lt; 3) + 4)\r\nkey += chr(0x60 \/ 2)\r\nkey += chr(0x17c &gt;&gt; 2)\r\nkey += chr((0x59 ^ 0x60) &lt;&lt; 1)\r\nkey += chr((0x42 ^ 0x88) \/ 2)\r\nkey += chr((0x0c0 ^ 0x2c) \/ 2)\r\nkey += chr((0x16 &lt;&lt; 1) + 7)\r\nkey += chr((0x36 ^ 0x29a) \/ 6)\r\nkey += chr(((0x130f0 \/ 8) ^ 0x2486) \/ 8)\r\nkey += chr(((0x2950 ^0x25a0) \/ 0x30))\r\nkey += chr(0x7d)\r\nprint key\r\n\r\npython decoder.py\r\nPAN{d3lphi_is_e4sy_t0_rev3rSE}\r\n\r\nWe can now test and verify if that flag is correct.\r\n\r\n\r\nExtra: Manual unpacking\r\nIf we want do dump the process correctly we can use OllyDbg and OllyDump. To identify the original entry point (OEP) we can use the \u201cset hardware breakpoint at current ESP\u201d technique. For that we have to run the first instruction, go to the dump window and jump to the ESP. Then we can set a \u201cHardware, on access\u201d breakpoint at current address.\r\n\r\n\r\n\r\nIf we press F9 a few times we will reach the original entry point. Now we have to do some calculations and dump it to a new file.\r\n\r\n\r\n\r\nFor calculating the real OEP we need to know at which address the executable has been loaded.\r\n\r\n\r\n\r\nNow we just have to subtract these offsets and we get the correct offsets for OllyDump.\r\nCalculations:\r\nOEP: \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 0x00941b60\r\nAddress: \u00a0 \u00a0 \u00a0 \u00a00x008F0000\r\nSize: \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a00x001F0000\r\nImageBase: \u00a0 0x008F0000\r\n\r\nNew EP: \t(0x00941b60 - 0x008F0000) = 0x51B60\r\n\r\nNow let\u2019s fill that data into OllyDump and dump the file as \u201cdumped.exe\u201d:\r\n\r\n\r\n\r\nBut something is still wrong if we try to execute the unpacked sample:\r\n\r\n\r\n\r\nIt\u2019s probably the import table that causes problems, but we can use Scylla to fix that for us. For that we have to run DelphiChallenge.exe again (new process) and search for the import table. We also have to enter the correct entry point + image base:\r\nEP + Imagebase:\t0x51B60 + 0x8F0000 = 0x941B60\r\n\r\nNow we can use \u201cFix dump\u201d and fix the dumped.exe executable:\r\n\r\n\r\n\r\nScylla has created a new import table and now we can run the unpacked executable. Yey.\r\n\r\n\r\n\r\nLeave a comment below to share your thoughts about these challenges. Be sure to also check out how other threat researchers solved these challenges:\r\n\r\nWindows 7:\r\n\r\n \thttps:\/\/jmprsp.wordpress.com\/2016\/09\/08\/labyrenth-ctf-windows-track-challenge-7\/\r\n \thttps:\/\/github.com\/gray-panda\/grayrepo\/tree\/master\/2016_labyREnth\/win7_pcap\r\n \thttps:\/\/github.com\/uafio\/git\/blob\/master\/scripts\/labyREnth-2016\/labyrenth-2016-win-7.py\r\n \thttps:\/\/github.com\/11x256\/CTFs\/tree\/master\/2016\/LabyREnth\/7-PCAP\r\n \thttps:\/\/github.com\/spartansecurity\/Writeups\/blob\/master\/labyrenth2016\/windows.md#challenge-7\r\n\r\nWindows 8:\u00a0\r\n\r\n\r\n \thttps:\/\/jmprsp.wordpress.com\/2016\/09\/16\/labyrenth-ctf-windows-track-challenge-8\/\r\n \thttps:\/\/github.com\/gray-panda\/grayrepo\/tree\/master\/2016_labyREnth\/win8_revhunt\r\n \thttp:\/\/sibears.ru\/labs\/labyrenth2016-win-8\/\r\n \thttps:\/\/github.com\/uafio\/git\/blob\/master\/scripts\/labyREnth-2016\/labyrenth-2016-win-8.py\r\n \thttps:\/\/github.com\/11x256\/CTFs\/tree\/master\/2016\/LabyREnth\/8-Revhunt\r\n \thttps:\/\/github.com\/spartansecurity\/Writeups\/blob\/master\/labyrenth2016\/windows.md#challenge-8\r\n \thttp:\/\/findingvulns.blogspot.sg\/2016\/08\/labyrenth-ctf-2016-windows-track.html\r\n\r\nWindows 9:\r\n\r\n \thttps:\/\/jmprsp.wordpress.com\/2016\/09\/19\/labyrenth-ctf-windows-track-challenge-9\/\r\n \thttps:\/\/github.com\/gray-panda\/grayrepo\/tree\/master\/2016_labyREnth\/win9_delphichal\r\n \thttp:\/\/sibears.ru\/labs\/labyrenth2016-win-9\/\r\n \thttps:\/\/github.com\/uafio\/git\/blob\/master\/scripts\/labyREnth-2016\/labyrenth-2016-win-9.txt\r\n \thttps:\/\/github.com\/11x256\/CTFs\/tree\/master\/2016\/LabyREnth\/9-Delphi%20challenge\r\n \thttps:\/\/github.com\/spartansecurity\/Writeups\/blob\/master\/labyrenth2016\/windows.md#challenge-9\r\n","publisher":{"@type":"Organization","@id":"#panworg"},"image":{"@type":"ImageObject","url":"","width":"","height":""},"author":[{"@type":"Person","name":"Richard Wartell"},{"@type":"Person","name":"Josh Grunzweig"},{"@type":"Person","name":"Esmid Idrizovic"}]}</script>		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/blog.paloaltonetworks.com\/wp-includes\/js\/wp-emoji-release.min.js"}};
			/*! This file is auto-generated */
			!function(e,a,t){var r,n,o,i,p=a.createElement("canvas"),s=p.getContext&&p.getContext("2d");function c(e,t){var a=String.fromCharCode;s.clearRect(0,0,p.width,p.height),s.fillText(a.apply(this,e),0,0);var r=p.toDataURL();return s.clearRect(0,0,p.width,p.height),s.fillText(a.apply(this,t),0,0),r===p.toDataURL()}function l(e){if(!s||!s.fillText)return!1;switch(s.textBaseline="top",s.font="600 32px Arial",e){case"flag":return!c([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])&&(!c([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!c([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]));case"emoji":return!c([55357,56424,55356,57342,8205,55358,56605,8205,55357,56424,55356,57340],[55357,56424,55356,57342,8203,55358,56605,8203,55357,56424,55356,57340])}return!1}function d(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(i=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},o=0;o<i.length;o++)t.supports[i[o]]=l(i[o]),t.supports.everything=t.supports.everything&&t.supports[i[o]],"flag"!==i[o]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[i[o]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(r=t.source||{}).concatemoji?d(r.concatemoji):r.wpemoji&&r.twemoji&&(d(r.twemoji),d(r.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='crayon-css'  href='https://blog.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-classic-css'  href='https://blog.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://blog.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://blog.paloaltonetworks.com/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='contact-form-7-css'  href='https://blog.paloaltonetworks.com/wp-content/plugins/contact-form-7/includes/css/styles.css' type='text/css' media='all' />
<style id='contact-form-7-inline-css' type='text/css'>
.wpcf7 .wpcf7-recaptcha iframe {margin-bottom: 0;}.wpcf7 .wpcf7-recaptcha[data-align="center"] > div {margin: 0 auto;}.wpcf7 .wpcf7-recaptcha[data-align="right"] > div {margin: 0 0 0 auto;}
</style>
<link rel='stylesheet' id='dashicons-css'  href='https://blog.paloaltonetworks.com/wp-includes/css/dashicons.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='post-views-counter-frontend-css'  href='https://blog.paloaltonetworks.com/wp-content/plugins/post-views-counter/css/frontend.css' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-horizontal-list-0-css'  href='//blog.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-list-horizontal/style.css' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-post-translations-0-css'  href='//blog.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-post-translations/style.css' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-menu-item-0-css'  href='//blog.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/menu-item/style.css' type='text/css' media='all' />
<link rel='stylesheet' id='sage/css-css'  href='https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/styles/main.css' type='text/css' media='all' />
<script>if (document.location.protocol != "https:") {document.location = document.URL.replace(/^http:/i, "https:");}</script><script type='text/javascript' src='https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/scripts/jquery-3.5.1.min.js'></script>
<script type='text/javascript' src='https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/scripts/jquery-migrate-1.4.1.min.js'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/blog.paloaltonetworks.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://blog.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js'></script>
<link rel='https://api.w.org/' href='https://blog.paloaltonetworks.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://blog.paloaltonetworks.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://blog.paloaltonetworks.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.4.1" />
<link rel='shortlink' href='https://blog.paloaltonetworks.com/?p=19505' />
<link rel="alternate" type="application/json+oembed" href="https://blog.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblog.paloaltonetworks.com%2F2016%2F09%2Funit-42-labyrenth-capture-the-flag-ctf-windows-track-7-9-solutions%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://blog.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblog.paloaltonetworks.com%2F2016%2F09%2Funit-42-labyrenth-capture-the-flag-ctf-windows-track-7-9-solutions%2F&#038;format=xml" />
<meta name="generator" content="WPML ver:4.3.5 stt:180,186,114,3,12,9,81,84,87,129,138,6,162;" />
  <script>var $ = jQuery;</script>
    <!-- Unit42 Scripts -->
  <script type="text/javascript" src="https://www.paloaltonetworks.com/content/dam/pan/en_US/includes/attribution.js"></script>
  <!-- End Unit42 Scripts -->
<meta name="google-site-verification" content="G1onsZ_PNprWXTYsKyATpZKzp8IAJ1jlbavSwUDN5Uo" />
</head>
  <body data-rsssl=1 data-results-per-page="9" class="post-template-default single single-post postid-19505 single-format-standard unit-42-labyrenth-capture-the-flag-ctf-windows-track-7-9-solutions sidebar-primary">
    <!--[if IE]>
      <div class="alert alert-warning">
        You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.      </div>
    <![endif]-->
    <input type="hidden" id="searching" value=""/><header class="container-fluid container-blog sticky-top">
     
      <div class="pan-page-alert pan-page-alert-light">
    		<div class="pan-page-alert-text"><a href="https://www.paloaltonetworks.com/our-response-to-covid-19" data-page-track-value=":en_us: title :covid19" data-page-track="true">See our response to COVID-19</a></div>
    		<button type="button" class="pan-page-alert-close" aria-label="page alert close">
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1 1L6 6M6 6L11 1M6 6L1 11M6 6L11 11" stroke="#727272" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
          </button>
		  </div>
    
	
      <div class="container-xl">
        <div class="row">
          <div class="col-logo">
            <a href="https://www.paloaltonetworks.com" class="nav-logo" nav-track="true" nav-track-breadcrumb="nav:logo" aria-label="paloaltonetworks">
              <svg width="140" height="26" viewBox="0 0 140 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M59.4806 4.69592C57.6725 4.69592 55.7941 5.18876 53.4694 6.43377L54.7609 9.62741C56.7798 8.50019 58.4474 8.00735 59.6687 8.00735C61.0542 8.00735 61.6648 8.52395 61.6648 9.20483V9.25133C61.6648 9.72143 61.2887 9.97974 60.3733 10.0738L58.777 10.238C54.7847 10.6606 53.1409 12.3985 53.1409 14.7934V14.9577C53.1409 17.2359 55.0192 19.0203 57.6725 19.0203C59.4197 19.0203 60.9374 18.2826 61.8601 16.9807L62.1577 18.7857H65.7739V10.5904C65.7739 6.71584 63.5432 4.69592 59.4806 4.69592ZM59.1283 15.8969C57.7903 15.8969 57.1559 15.3803 57.1559 14.5816V14.5351C57.1559 13.8305 57.5547 13.3139 59.0105 13.1031L59.6449 13.0091C60.5717 12.8799 61.141 12.7095 61.6648 12.3923V13.4317C61.6648 15.0052 60.6781 15.8969 59.1283 15.8969Z" fill="black" class="logo-text"></path>
                <path d="M25.4785 4.78994L20.8529 0.164276L16.2272 4.78994L18.5281 7.09192L6.92834 18.6917L11.554 23.3174L16.1797 18.6917L13.8787 16.3908L25.4785 4.78994Z" fill="#FA582D" class="logo-icon"></path>
                <path d="M11.6001 0.164063L0 11.7642L4.62603 16.3902L16.2262 4.79009L11.6001 0.164063Z" fill="#FA582D" class="logo-icon"></path>
                <path d="M27.7795 7.09215L16.1793 18.6923L20.8054 23.3183L32.4055 11.7182L27.7795 7.09215Z" fill="#FA582D" class="logo-icon"></path>
                <path d="M72.2314 0H68.1223V18.7857H72.2314V0Z" fill="black" class="logo-text"></path>
                <path d="M46.2362 4.69592C44.3681 4.69592 42.8679 5.52249 42.0424 6.81709L41.7283 4.93046H38.1121V23.4806H42.2211V17.051C43.0033 18.2567 44.4828 19.0193 46.2362 19.0193C49.5238 19.0193 52.2009 16.1077 52.2009 12.0916V11.6215C52.2009 7.60853 49.5238 4.69592 46.2362 4.69592ZM47.974 11.9759C47.974 14.0888 46.8705 15.6159 45.0387 15.6159C43.2068 15.6159 42.1033 14.0898 42.1033 11.9759V11.7414C42.1033 9.62741 43.2068 8.10137 45.0387 8.10137C46.8705 8.10137 47.974 9.62741 47.974 11.7414V11.9759Z" fill="black" class="logo-text"></path>
                <path d="M127.672 4.69592C123.469 4.69592 120.51 7.6075 120.51 11.6236V12.0937C120.51 16.1087 123.469 19.0213 127.672 19.0213C131.875 19.0213 134.834 16.1097 134.834 12.0937V11.6236C134.834 7.60853 131.875 4.69592 127.672 4.69592ZM130.607 11.9759C130.607 14.0888 129.504 15.6159 127.672 15.6159C125.84 15.6159 124.736 14.0898 124.736 11.9759V11.7414C124.736 9.62741 125.84 8.10137 127.672 8.10137C129.504 8.10137 130.607 9.62741 130.607 11.7414V11.9759Z" fill="black" class="logo-text"></path>
                <path d="M138.709 5.54211V5.47185C138.709 5.07304 138.404 4.79097 137.864 4.79097H136.924V6.9514H137.371V6.22299H137.867L138.24 6.9514H138.733L138.274 6.09694C138.553 6.01119 138.709 5.80248 138.709 5.54211ZM137.37 5.18979H137.863C138.145 5.18979 138.261 5.28381 138.261 5.49562V5.51938C138.261 5.70742 138.144 5.82418 137.863 5.82418H137.37V5.18979Z" fill="black" class="logo-text"></path>
                <path d="M137.77 3.63997C136.502 3.63997 135.539 4.60292 135.539 5.87066C135.539 7.1384 136.502 8.10135 137.77 8.10135C139.037 8.10135 140 7.1384 140 5.87066C140 4.60292 139.037 3.63997 137.77 3.63997ZM137.77 7.79552C136.666 7.79552 135.868 6.99685 135.868 5.86963C135.868 4.7424 136.666 3.94373 137.77 3.94373C138.873 3.94373 139.672 4.7424 139.672 5.86963C139.672 6.99685 138.873 7.79552 137.77 7.79552Z" fill="black" class="logo-text"></path>
                <path d="M108.416 0H104.307V18.7857H108.416V0Z" fill="black" class="logo-text"></path>
                <path d="M116.518 15.6159C115.321 15.6159 114.875 15.029 114.875 13.7613V8.10136H119.712V4.93148H114.875V1.76057L110.766 2.3712V14.159C110.766 17.3764 112.409 19.0203 115.697 19.0203C117.153 19.0203 118.867 18.5739 120.276 17.7753L119.102 14.8637C118.279 15.31 117.129 15.6159 116.518 15.6159Z" fill="black" class="logo-text"></path>
                <path d="M95.6662 4.69592C93.8581 4.69592 91.9797 5.18876 89.655 6.43377L90.9465 9.62741C92.9654 8.50019 94.633 8.00735 95.8542 8.00735C97.2397 8.00735 97.8504 8.52395 97.8504 9.20483V9.25133C97.8504 9.72143 97.4743 9.97974 96.5589 10.0738L94.9626 10.238C90.9702 10.6606 89.3264 12.3985 89.3264 14.7934V14.9577C89.3264 17.2359 91.2048 19.0203 93.8581 19.0203C95.6042 19.0203 97.123 18.2826 98.0456 16.9807L98.3432 18.7857H101.959V10.5904C101.959 6.71584 99.7287 4.69592 95.6662 4.69592ZM95.3138 15.8969C93.9748 15.8969 93.3415 15.3803 93.3415 14.5816V14.5351C93.3415 13.8305 93.7403 13.3139 95.1961 13.1031L95.8304 13.0091C96.7572 12.8799 97.3265 12.7095 97.8493 12.3923V13.4317C97.8493 15.0052 96.8637 15.8969 95.3138 15.8969Z" fill="black" class="logo-text"></path>
                <path d="M81.2247 4.69592C77.0216 4.69592 74.0625 7.6075 74.0625 11.6236V12.0937C74.0625 16.1087 77.0216 19.0213 81.2247 19.0213C85.4278 19.0213 88.3869 16.1097 88.3869 12.0937V11.6236C88.3858 7.60853 85.4278 4.69592 81.2247 4.69592ZM84.159 11.9759C84.159 14.0888 83.0555 15.6159 81.2236 15.6159C79.3918 15.6159 78.2883 14.0898 78.2883 11.9759V11.7414C78.2883 9.62741 79.3918 8.10137 81.2236 8.10137C83.0555 8.10137 84.159 9.62741 84.159 11.7414V11.9759Z" fill="black" class="logo-text"></path>
                <path d="M98.0448 22.1168H99.0976L100.551 24.0334H100.566V22.1168H101.532V25.4964H100.513L99.0253 23.5312H99.0109V25.4964H98.0448V22.1168Z" fill="black" class="logo-text"></path>
                <path d="M102.816 22.1168H105.771L105.81 22.9372H103.826V23.4011H105.385V24.1491H103.826V24.676H105.868L105.829 25.4964H102.816V22.1168Z" fill="black" class="logo-text"></path>
                <path d="M107.925 22.9857H106.742L106.78 22.1168H110.088L110.127 22.9857H108.944V25.4964H107.925V22.9857Z" fill="black" class="logo-text"></path>
                <path d="M110.943 22.1168H112.024L112.574 24.4632H112.628L113.342 22.1168H114.333L115.032 24.4632H115.086L115.626 22.1168H116.66L115.771 25.4964H114.443L113.826 23.4589H113.797L113.168 25.4964H111.836L110.943 22.1168Z" fill="black" class="logo-text"></path>
                <path d="M117.404 23.8071C117.404 22.7057 118.152 22.0155 119.335 22.0155C120.518 22.0155 121.267 22.7057 121.267 23.8071C121.267 24.9085 120.519 25.5987 119.335 25.5987C118.152 25.5987 117.404 24.9075 117.404 23.8071ZM120.258 23.8071C120.258 23.2234 119.92 22.8752 119.335 22.8752C118.75 22.8752 118.412 23.2234 118.412 23.8071C118.412 24.3919 118.75 24.7391 119.33 24.7391C119.915 24.7391 120.258 24.3909 120.258 23.8071Z" fill="black" class="logo-text"></path>
                <path d="M122.364 22.1168H124.334C125.232 22.1168 125.672 22.5414 125.672 23.3287C125.672 23.8691 125.45 24.2369 125.015 24.4105L125.816 25.4974H124.668L124.045 24.6089H123.378V25.4974H122.364V22.1168ZM124.203 23.8164C124.54 23.8164 124.661 23.6284 124.661 23.3721C124.661 23.1159 124.54 22.933 124.203 22.933H123.377V23.8164H124.203Z" fill="black" class="logo-text"></path>
                <path d="M126.989 22.1168H128.003V23.3628H128.418L129.408 22.1168H130.548L130.553 22.1209L129.259 23.7389L130.625 25.4923L130.62 25.4964H129.437L128.414 24.1977H128.003V25.4964H126.989V22.1168Z" fill="black" class="logo-text"></path>
                <path d="M131.402 25.2743V24.3475H131.407C131.972 24.6326 132.523 24.7721 133 24.7721C133.363 24.7721 133.546 24.6853 133.546 24.5159C133.546 24.3464 133.425 24.3031 132.701 24.1873C131.909 24.0623 131.382 23.8247 131.382 23.1438C131.382 22.5115 131.938 22.0238 133.024 22.0238C133.459 22.0238 133.913 22.1158 134.333 22.2945V23.212L134.328 23.2172C133.927 22.9857 133.387 22.84 132.952 22.84C132.565 22.84 132.411 22.932 132.411 23.0859C132.411 23.2843 132.648 23.3029 133.242 23.4052C134.033 23.5405 134.56 23.7627 134.56 24.4777C134.56 25.0325 134.145 25.5884 132.953 25.5884C132.364 25.5884 131.895 25.4675 131.402 25.2743Z" fill="black" class="logo-text"></path>
              </svg>
            </a>
            <a href="https://blog.paloaltonetworks.com" class="nav-lockup active" >Blog</a>
          </div>
          <div class="col col-mobile">
            <button class="nav-toggle closed" id="nav-mobile-toggle">
              <svg class="menu-dashes open" width="21" height="16" viewBox="0 0 21 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <line x1="18.8125" y1="1.5" x2="1.5" y2="1.5" stroke="black" stroke-width="3" stroke-linecap="round"></line>
                <line x1="18.8125" y1="8" x2="1.5" y2="8" stroke="black" stroke-width="3" stroke-linecap="round"></line>
                <line x1="18.8125" y1="14.5" x2="1.5" y2="14.5" stroke="black" stroke-width="3" stroke-linecap="round"></line>
              </svg>
              <svg class="menu-x close" width="18" height="17" viewBox="0 0 18 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                <line x1="2.95117" y1="14.2207" x2="14.8534" y2="2.31847" stroke="black" stroke-width="3" stroke-linecap="round"></line>
                <line x1="1.5" y1="-1.5" x2="18.3323" y2="-1.5" transform="matrix(-0.707107 -0.707107 -0.707107 0.707107 14.998 16.3422)" stroke="black" stroke-width="3" stroke-linecap="round"></line>
              </svg>
                <span class="mobile-menu">Menu</span>
            </button>
          </div>
            <nav class="col col-navbar navbar" id="nav-mobile">
                <ul>
                    <li class="menu-item-home"><a href="https://blog.paloaltonetworks.com">Palo Alto Networks</a></li>
                                            
                    <li class="menu-item-object-net_sec_post">
                        <a href="https://blog.paloaltonetworks.com/network-security/">Network Security</a>
                    </li>
                    
                                            
                    <li class="menu-item-object-sase_post">
                        <a href="https://blog.paloaltonetworks.com/sase/">SASE</a>
                    </li>
                    
                                            
                    <li class="menu-item-object-cloud_sec_post">
                        <a href="https://blog.paloaltonetworks.com/prisma-cloud/">Cloud Native Security</a>
                    </li>
                    
                                            
                    <li class="menu-item-object-sec_ops_post">
                        <a href="https://blog.paloaltonetworks.com/security-operations/">Security Operations</a>
                    </li>
                    
                                        <li>
                <div class="search"  id="form-search">
                    <input type="text" name="search" autocomplete="off" id="postSearch1" placeholder="Search the Blog" />
                  
                    <button id="nav-search-open-toggle">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" >
                      <path d="M8.66675 15.3335C12.3487 15.3335 15.3335 12.3487 15.3335 8.66675C15.3335 4.9848 12.3487 2 8.66675 2C4.9848 2 2 4.9848 2 8.66675C2 12.3487 4.9848 15.3335 8.66675 15.3335Z" stroke="black" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"></path>
                      <path d="M18.0007 18.0001L13.3784 13.3778" stroke="black" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                  </button>
                  
                  <button id="nav-search-close-toggle">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" >
                      <line x1="2.95117" y1="14.2207" x2="14.8534" y2="2.31847" stroke="black" stroke-width="3" stroke-linecap="round"></line>
                      <line x1="1.5" y1="-1.5" x2="18.3323" y2="-1.5" transform="matrix(-0.707107 -0.707107 -0.707107 0.707107 14.998 16.3422)" stroke="black" stroke-width="3" stroke-linecap="round"></line>
                    </svg>
                  </button>
                  
                </div>
              </li>
                </ul>
                        </nav>
          
            
        </div>
      </div>
    </header>
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/masonry/4.2.2/masonry.pkgd.min.js"></script>-->
<script type="text/javascript">
    var main_nav_active_class = '';
    var main_nav_menu_item_name = 'menu-item-home';
    var str_subscription = '<div class="container-fluid container-newsletter-signup" >\
    <div class="container-lg">\
        <div class="row no-gutters row-newsletter-signup">\
            <div class="col-12 col-md-5 col-newsletter-signup-header">\
                <h2>Get updates!</h2>\
                <p class="lead">Sign up to receive the latest news</p>\
            </div>\
            <div class="col-12 col-md-7 col-newsletter-signup-form">\
                <form action="https://start.paloaltonetworks.com/index.php/leadCapture/save2" method="post" novalidate="" class="subscribe-form clearfix" name="Unit42_Subscribe" id="subscribe_form1">\
                    <input type="hidden" value="subscribe-unit42" name="FormName">\
    <input id="field14" type="hidden" name="Qualifying_Campaign__c" value="70170000000lBnb">\
                         <input type="hidden" value="1086" name="formid">\
                         <input type="hidden" value="531-OCS-018" name="munchkinId">\
                         <input type="hidden" value="19887" name="lpId">\
                         <input type="hidden" value="1086" name="formVid">\
                         <input type="hidden" name="mkto_opt-in" value="true">\
                <div class="row no-gutters row-newsletter-signup-input">\
                    <div class="col-10 col-sm-11 col-newsletter-signup-input">\
                        <input type="email" name="Email" placeholder="Enter your email" id="input-newsletter-signup" class="subscribe-field rounded business_email" autocomplete="off">\
                    </div>\
                    <div class="col-2 col-sm-1 col-newsletter-signup-button">\
                        <button type="submit" value="Subscribe" disabled="disabled">\
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="12" viewBox="0 0 16 12" fill="none">\
                            <path d="M1 6L14.3333 6" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\
                            <path d="M9.33301 1L14.333 6L9.33301 11" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\
                            </svg>\
                        </button>\
                    </div>\
                </div>\
                <div class="email_invalid_msg">Please enter a valid email.</div>\
                <div class="row row-legal-disclaimer">\
                    <div class="col-12 col-legal-disclaimer">\
                        <p class="legal-disclaimer">By submitting this form, you agree to our <a href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a> and acknowledge our <a href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy Statement</a>.</p>\
                    </div>\
                </div>\
                <div class="row row-recatcha d-none" id="row-recatcha">\
                    <div class="col-12 col-recatcha text-sm-center">\
                        <div id="captcha_container" class="google-recapth"></div>\
                    </div>\
                </div>\
                </form>\
            </div>\
        </div>\
    </div>\
</div>';
</script>
<article class="container-feed-master " id="main-container">
   <!--<div class="container-fluid container-breadcrumb"  data-aos="fade-in">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="https://blog.paloaltonetworks.com">Palo Alto Networks</a></li>
			          </ol>
        </nav>
    </div>-->
    
    <div class="container-fluid container-feed-article">
      <div class="container-lg">
        <div class="row row-feed-filters article-container container-inner" data-aos="fade-in" >
            <h1 class="blog-title">LabyREnth Capture the Flag (CTF): Windows Track 7-9 Solutions</h1>
              <div class="col-xs-12 col-sm-6 col-md-8 col-lg-8 col-xl-9 pad-0">
                   <div class="tags-item">
                    <a href="https://blog.paloaltonetworks.com/category/events/">Events</a>                    
                    <a href="https://blog.paloaltonetworks.com/tag/capture-the-flag/" rel="tag">capture the flag</a><a href="https://blog.paloaltonetworks.com/tag/ctf/" rel="tag">CTF</a><a href="https://blog.paloaltonetworks.com/tag/labyrenth/" rel="tag">LabyREnth</a><a href="https://blog.paloaltonetworks.com/tag/unit-42/" rel="tag">Unit 42</a><a href="https://blog.paloaltonetworks.com/tag/windows/" rel="tag">Windows</a>                  </div>
              </div>
              <div class="col-xs-12 col-sm-6 col-md-4 col-lg-4 col-xl-3 pad-0 mobile-links">
                   <ol class="react-items">
                    <li>
				
				
				7,856
			 people reacted</li>
                    <li class="line"></li>
                    <li>
                      <div class="metadata-likes ldc-ul_cont idc_ul_cont_not_liked_inner" onclick="alter_ul_post_values(this,'19505','like')">
                          <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M4.74998 15.9999H2.49999C2.10217 15.9999 1.72064 15.8419 1.43934 15.5606C1.15803 15.2793 1 14.8977 1 14.4999V9.24995C1 8.85213 1.15803 8.4706 1.43934 8.18929C1.72064 7.90799 2.10217 7.74996 2.49999 7.74996H4.74998M9.99994 6.24997V3.24999C9.99994 2.65325 9.76289 2.08096 9.34094 1.65901C8.91898 1.23705 8.34669 1 7.74996 1L4.74998 7.74996V15.9999H13.2099C13.5717 16.004 13.9227 15.8772 14.1983 15.6429C14.474 15.4086 14.6557 15.0826 14.7099 14.7249L15.7449 7.97496C15.7775 7.75997 15.763 7.54047 15.7024 7.33165C15.6418 7.12283 15.5365 6.92968 15.3938 6.7656C15.2511 6.60151 15.0745 6.47041 14.8761 6.38138C14.6777 6.29234 14.4623 6.2475 14.2449 6.24997H9.99994Z" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                          </svg>
                          <span>0</span>
                      </div>
                    </li>
                  </ol>
              </div>
              <div class="container-lg author-desc-row">
                <div class="col-8 author-desc">
                  <div class="metadata-thumbnail" >
                                          <div class="metadata-thumbnail-author" style="background-image: url('https://blog.paloaltonetworks.com/wp-content/uploads/2017/05/unit42_400x400.jpg')">
                                          </div>      
                  </div>
                  <div class="metadata-author" >
                    <span class="author-name">By <a href="https://blog.paloaltonetworks.com/author/richard-wartell/" title="Posts by Richard Wartell" class="author url fn" rel="author">Richard Wartell</a>, <a href="https://blog.paloaltonetworks.com/author/josh-grunzweig/" title="Posts by Josh Grunzweig" class="author url fn" rel="author">Josh Grunzweig</a> and <a href="https://blog.paloaltonetworks.com/author/esmid-idrizovic/" title="Posts by Esmid Idrizovic" class="author url fn" rel="author">Esmid Idrizovic</a></span><br /> 
                      <time datetime="2016-09-23T00:55:58+00:00">September 22, 2016 at 5:55 PM</time><br />
                      22 min. read
                  </div>
                </div>
                <!--<div class="col-6 social-items">
                      <span class="links">
                        <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4.28843 12.8112C4.28843 13.9855 3.32843 14.9375 2.1442 14.9375C0.959967 14.9375 0 13.9855 0 12.8112C0 11.6368 0.96 10.6848 2.14423 10.6848C3.32846 10.6848 4.28843 11.6368 4.28843 12.8112ZM10.1699 14.38C9.89019 9.2468 5.74406 5.13004 0.562199 4.85236C0.256339 4.83596 0 5.07967 0 5.38341V6.97945C0 7.25886 0.217299 7.49317 0.498449 7.5113C4.24282 7.75315 7.2442 10.7221 7.48858 14.4432C7.5069 14.722 7.74318 14.9375 8.0249 14.9375H9.63435C9.94068 14.9375 10.1864 14.6833 10.1699 14.38ZM14.9997 14.3896C14.7186 6.62601 8.41959 0.342913 0.552556 0.062845C0.250212 0.0520872 0 0.294304 0 0.594294V2.1903C0 2.47668 0.22885 2.70976 0.5174 2.72152C6.91848 2.9818 12.0562 8.07771 12.3187 14.4245C12.3305 14.7106 12.5655 14.9375 12.8544 14.9375H14.4638C14.7663 14.9375 15.0105 14.6894 14.9997 14.3896Z" fill="black"/>
                        </svg>
                      </span>
                      <span class="links">
                        <svg width="15" height="18" viewBox="0 0 15 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M11.7857 11.25C10.9286 11.25 10.1484 11.6016 9.57254 12.1781L6.28125 10.016C6.47879 9.35508 6.47879 8.64141 6.28125 7.98398L9.57254 5.82188C10.1484 6.39844 10.9286 6.75 11.7857 6.75C13.5603 6.75 15 5.23828 15 3.375C15 1.51172 13.5603 0 11.7857 0C10.0112 0 8.57143 1.51172 8.57143 3.375C8.57143 3.71953 8.62165 4.06406 8.71875 4.39102L5.42746 6.55312C4.85156 5.97656 4.07143 5.625 3.21429 5.625C1.43973 5.625 0 7.13672 0 9C0 10.8633 1.43973 12.375 3.21429 12.375C4.07143 12.375 4.85156 12.0234 5.42746 11.4469L8.71875 13.609C8.62165 13.9395 8.57143 14.2805 8.57143 14.625C8.57143 16.4883 10.0112 18 11.7857 18C13.5603 18 15 16.4883 15 14.625C15 12.7617 13.5603 11.25 11.7857 11.25ZM11.7857 1.6875C12.673 1.6875 13.3929 2.44336 13.3929 3.375C13.3929 4.30664 12.673 5.0625 11.7857 5.0625C10.8984 5.0625 10.1786 4.30664 10.1786 3.375C10.1786 2.44336 10.8984 1.6875 11.7857 1.6875ZM3.21429 10.6875C2.32701 10.6875 1.60714 9.93164 1.60714 9C1.60714 8.06836 2.32701 7.3125 3.21429 7.3125C4.10156 7.3125 4.82143 8.06836 4.82143 9C4.82143 9.93164 4.10156 10.6875 3.21429 10.6875ZM11.7857 16.3125C10.8984 16.3125 10.1786 15.5566 10.1786 14.625C10.1786 13.6934 10.8984 12.9375 11.7857 12.9375C12.673 12.9375 13.3929 13.6934 13.3929 14.625C13.3929 15.5566 12.673 16.3125 11.7857 16.3125Z" fill="black"/>
                        </svg>
                      </span>
                </div>-->
                <div class="col-4 social-items">
                  <div class="links">
                      <a href="http://feeds.feedburner.com/PaloAltoNetworks" target="_blank"><svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M4.28843 12.8112C4.28843 13.9855 3.32843 14.9375 2.1442 14.9375C0.959967 14.9375 0 13.9855 0 12.8112C0 11.6368 0.96 10.6848 2.14423 10.6848C3.32846 10.6848 4.28843 11.6368 4.28843 12.8112ZM10.1699 14.38C9.89019 9.2468 5.74406 5.13004 0.562199 4.85236C0.256339 4.83596 0 5.07967 0 5.38341V6.97945C0 7.25886 0.217299 7.49317 0.498449 7.5113C4.24282 7.75315 7.2442 10.7221 7.48858 14.4432C7.5069 14.722 7.74318 14.9375 8.0249 14.9375H9.63435C9.94068 14.9375 10.1864 14.6833 10.1699 14.38ZM14.9997 14.3896C14.7186 6.62601 8.41959 0.342913 0.552556 0.062845C0.250212 0.0520872 0 0.294304 0 0.594294V2.1903C0 2.47668 0.22885 2.70976 0.5174 2.72152C6.91848 2.9818 12.0562 8.07771 12.3187 14.4245C12.3305 14.7106 12.5655 14.9375 12.8544 14.9375H14.4638C14.7663 14.9375 15.0105 14.6894 14.9997 14.3896Z" fill="black"/>
                    </svg>
                    </a>
                  </div>
                  <div class="links">
                    <div class="dropdown dropup">
                      <a href="#!" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <svg width="15" height="18" viewBox="0 0 15 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M11.7857 11.25C10.9286 11.25 10.1484 11.6016 9.57254 12.1781L6.28125 10.016C6.47879 9.35508 6.47879 8.64141 6.28125 7.98398L9.57254 5.82188C10.1484 6.39844 10.9286 6.75 11.7857 6.75C13.5603 6.75 15 5.23828 15 3.375C15 1.51172 13.5603 0 11.7857 0C10.0112 0 8.57143 1.51172 8.57143 3.375C8.57143 3.71953 8.62165 4.06406 8.71875 4.39102L5.42746 6.55312C4.85156 5.97656 4.07143 5.625 3.21429 5.625C1.43973 5.625 0 7.13672 0 9C0 10.8633 1.43973 12.375 3.21429 12.375C4.07143 12.375 4.85156 12.0234 5.42746 11.4469L8.71875 13.609C8.62165 13.9395 8.57143 14.2805 8.57143 14.625C8.57143 16.4883 10.0112 18 11.7857 18C13.5603 18 15 16.4883 15 14.625C15 12.7617 13.5603 11.25 11.7857 11.25ZM11.7857 1.6875C12.673 1.6875 13.3929 2.44336 13.3929 3.375C13.3929 4.30664 12.673 5.0625 11.7857 5.0625C10.8984 5.0625 10.1786 4.30664 10.1786 3.375C10.1786 2.44336 10.8984 1.6875 11.7857 1.6875ZM3.21429 10.6875C2.32701 10.6875 1.60714 9.93164 1.60714 9C1.60714 8.06836 2.32701 7.3125 3.21429 7.3125C4.10156 7.3125 4.82143 8.06836 4.82143 9C4.82143 9.93164 4.10156 10.6875 3.21429 10.6875ZM11.7857 16.3125C10.8984 16.3125 10.1786 15.5566 10.1786 14.625C10.1786 13.6934 10.8984 12.9375 11.7857 12.9375C12.673 12.9375 13.3929 13.6934 13.3929 14.625C13.3929 15.5566 12.673 16.3125 11.7857 16.3125Z" fill="black"/>
                        </svg>
                      </a>

                      <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                        <div class="share-dropdown">
                          <p><strong>SHARE</strong></p>
                          <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fblog.paloaltonetworks.com%2F2016%2F09%2Funit-42-labyrenth-capture-the-flag-ctf-windows-track-7-9-solutions%2F" target="_blank">
                          <i class="fa fb-icon fa-facebook-official pop-up-icon" aria-hidden="true"></i></a>
                          
                          <a href="https://twitter.com/home?status=https%3A%2F%2Fblog.paloaltonetworks.com%2F2016%2F09%2Funit-42-labyrenth-capture-the-flag-ctf-windows-track-7-9-solutions%2F+-+LabyREnth+Capture+the+Flag+%28CTF%29%3A+Windows+Track+7-9+Solutions" target="_blank"><i class="fa tw-icon fa-twitter pop-up-icon" aria-hidden="true"></i></a>
                          <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fblog.paloaltonetworks.com%2F2016%2F09%2Funit-42-labyrenth-capture-the-flag-ctf-windows-track-7-9-solutions%2F&title=LabyREnth+Capture+the+Flag+%28CTF%29%3A+Windows+Track+7-9+Solutions&summary=&source=" target="_blank"><i class="fa lindn-icon fa-linkedin pop-up-icon" aria-hidden="true"></i></a>
                          <a href="//www.reddit.com/submit?url=https://blog.paloaltonetworks.com/2016/09/unit-42-labyrenth-capture-the-flag-ctf-windows-track-7-9-solutions/" target="_blank"><i class="fa blog-icon fa-stumbleupon-circle pop-up-icon" aria-hidden="true"></i></a>
                          
                          </div>                       
                        </div>
                      </div>
                    </div>
                </div>
              </div>
              <div class="entry-content article-description"><p>Welcome back to our blog series where we reveal the solutions to <a href="https://blog.paloaltonetworks.com/2016/07/unit42-announcing-the-labyrenth-capture-the-flag-ctf-challenge/" target="_blank">LabyREnth, the Unit 42 Capture the Flag (CTF)</a> challenge. We’ll be revealing the <a href="https://blog.paloaltonetworks.com/tag/ctf/" target="_blank">solutions</a> to one challenge track per week. Next up, the Windows track challenges 7 through 9. <span id="more-19505"></span></p>
<h3>Windows 7 Challenge: Some guy found this pcap and executable. Ready, set, go!</h3>
<p><em>Challenge Created By: Josh Grunzweig <a href="https://twitter.com/jgrunzweig" target="_blank">@jgrunzweig</a></em></p>
<p>For this challenge, users were given both a PCAP and a Windows executable file. Taking a quick look at the PCAP file, we see there are a number of individual connections from 172.16.95.1 to 172.16.95.190, each about the same size.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_1.png"><img class="size-large wp-image-19622 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_1-500x325.png" alt="windows_2_1" width="500" height="325" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_1-500x325.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_1-230x149.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_1-768x499.png 768w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_1-462x300.png 462w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_1-62x40.png 62w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_1.png 975w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p style="text-align: center;"><em>Figure 1 Connections in G0blinKing pcap file</em></p>
<p>Looking at a specific connection, we see that each one is transferring a single byte of data at a time.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_2.png"><img class="size-large wp-image-19619 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_2-500x263.png" alt="windows_2_2" width="500" height="263" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_2-500x263.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_2-230x121.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_2-768x404.png 768w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_2-510x268.png 510w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_2-76x40.png 76w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_2.png 975w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p style="text-align: center;"><em>Figure 2 Data in stream 0 for G0blinKing pcap file</em></p>
<p>Presumably, we can come to the conclusion that some data is being sent from one host to another, one byte at a time. To determine what data has been generated, we need to look at the Windows executable file.</p>
<p>Opening the file, we see a minor Easter egg, where the pdb string was overwritten.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_3.png"><img class="size-large wp-image-19616 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_3-500x113.png" alt="windows_2_3" width="500" height="113" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_3-500x113.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_3-230x52.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_3-768x174.png 768w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_3-510x116.png 510w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_3-176x40.png 176w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_3.png 974w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p style="text-align: center;"><em>Figure 3 Overwritten pdb path</em></p>
<p>Unfortunately for this file, it doesn’t disassemble terribly well, and we see a number of functions that simply jump to the actual function containing the relevant code. This is just a byproduct of how the file was compiled. Looking through the code, however, we can see that the actual core functionality of the code starts at a function at offset 0x412300.</p>
<p>Performing a quick triage of the sample and the functions that are called, we can get a high-level overview of what is going on. Note that I’ve renamed a few of the functions in the figure below based on guesses as to what the functions may be doing.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_4.png"><img class="size-full wp-image-19613 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_4.png" alt="windows_2_4" width="406" height="1350" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_4.png 406w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_4-230x765.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_4-90x300.png 90w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_4-12x40.png 12w" sizes="(max-width: 406px) 100vw, 406px" /></a></p>
<p style="text-align: center;"><em>Figure 4 Main function of executable</em></p>
<p>So, we can safely conclude that some form of encryption is being performed against the data contained in file.txt, it’s then being encoded, and then sent across the network, where the PCAP was generated from. At this point we simply need to identify what is happening during encryption and encoding respectively.</p>
<p>For encryption, we track down a function that looks to be primarily responsible. We also identify a string aptly named ‘AWildKeyAppears!’, which is most likely going to be the key used for encryption. Looking at the beginning of this function, we identify a number of constants as seen in the following figure.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_5.png"><img class="size-large wp-image-19610 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_5-500x468.png" alt="windows_2_5" width="500" height="468" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_5-500x468.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_5-230x215.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_5-768x718.png 768w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_5-321x300.png 321w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_5-43x40.png 43w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_5.png 975w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p style="text-align: center;"><em>Figure 5 Encryption function</em></p>
<p>A number of these constants turn out to be red herrings. However, if we look at the constant of 0x9E3769B9, we see that this constant is used in the TEA/XTEA encryption algorithms. Further review of this function shows us that we’re simply dealing with XTEA, with a few red herrings thrown in. The following original source code shows what it looked like prior to compilation.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c62b3d16053879737" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
unsigned int key[4] = {0x6c695741, 0x79654b64, 0x65707041, 
0x21737261};

#define BLOCK_SIZE 8

void xtea_encipher(unsigned int num_rounds, uint32_t v[2], 
uint32_t const key[4]) {
    unsigned int i;
    uint32_t j, o, s, h;
    j = 0xBADA55;
    uint32_t delta = 0x9e3769b9;
    o = 0x4913092;
    s = 0x12345678;
    h = 0xDEADBEEF;
    uint32_t v0=v[0], v1=v[1], sum=0;
    for (i=0; i &lt; num_rounds; i++) {
        v0 += (((v1 &lt;&lt; 4) ^ (v1 &gt;&gt; 5)) + v1) ^ (sum + key[sum &amp; 
3]);
        j += 4092;
        o -+ 4092;
        for (int x = 8; x &lt; 32; x++) {
          s = s*8;
          j -= 64;
          o -= 8;
        }
        h = 64;
        sum += (delta + 4096);
        v1 += (((v0 &lt;&lt; 4) ^ (v0 &gt;&gt; 5)) + v0) ^ (sum + 
key[(sum&gt;&gt;11) &amp; 3]);
    }
    v[0]=v0; 
    v[1]=v1;
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c62b3d16053879737-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d16053879737-2">2</div><div class="crayon-num" data-line="crayon-5f694c62b3d16053879737-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d16053879737-4">4</div><div class="crayon-num" data-line="crayon-5f694c62b3d16053879737-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d16053879737-6">6</div><div class="crayon-num" data-line="crayon-5f694c62b3d16053879737-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d16053879737-8">8</div><div class="crayon-num" data-line="crayon-5f694c62b3d16053879737-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d16053879737-10">10</div><div class="crayon-num" data-line="crayon-5f694c62b3d16053879737-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d16053879737-12">12</div><div class="crayon-num" data-line="crayon-5f694c62b3d16053879737-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d16053879737-14">14</div><div class="crayon-num" data-line="crayon-5f694c62b3d16053879737-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d16053879737-16">16</div><div class="crayon-num" data-line="crayon-5f694c62b3d16053879737-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d16053879737-18">18</div><div class="crayon-num" data-line="crayon-5f694c62b3d16053879737-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d16053879737-20">20</div><div class="crayon-num" data-line="crayon-5f694c62b3d16053879737-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d16053879737-22">22</div><div class="crayon-num" data-line="crayon-5f694c62b3d16053879737-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d16053879737-24">24</div><div class="crayon-num" data-line="crayon-5f694c62b3d16053879737-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d16053879737-26">26</div><div class="crayon-num" data-line="crayon-5f694c62b3d16053879737-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d16053879737-28">28</div><div class="crayon-num" data-line="crayon-5f694c62b3d16053879737-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d16053879737-30">30</div><div class="crayon-num" data-line="crayon-5f694c62b3d16053879737-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d16053879737-32">32</div><div class="crayon-num" data-line="crayon-5f694c62b3d16053879737-33">33</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c62b3d16053879737-1"><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-sy">[</span><span class="crayon-cn">4</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-cn">0x6c695741</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x79654b64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x65707041</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d16053879737-2"><span class="crayon-cn">0x21737261</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c62b3d16053879737-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d16053879737-4"><span class="crayon-p">#define BLOCK_SIZE 8</span></div><div class="crayon-line" id="crayon-5f694c62b3d16053879737-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d16053879737-6"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">xtea_encipher</span><span class="crayon-sy">(</span><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">num_rounds</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">uint32</span><span class="crayon-sy">_</span>t<span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5f694c62b3d16053879737-7"><span class="crayon-e">uint32_t </span><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-sy">[</span><span class="crayon-cn">4</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d16053879737-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c62b3d16053879737-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">uint32</span><span class="crayon-sy">_</span>t<span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">o</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">h</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d16053879737-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">j</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0xBADA55</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c62b3d16053879737-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">uint32_t </span><span class="crayon-v">delta</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0x9e3769b9</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d16053879737-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">o</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0x4913092</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c62b3d16053879737-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0x12345678</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d16053879737-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">h</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0xDEADBEEF</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c62b3d16053879737-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">uint32_t </span><span class="crayon-v">v0</span><span class="crayon-o">=</span><span class="crayon-v">v</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">v1</span><span class="crayon-o">=</span><span class="crayon-v">v</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sum</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d16053879737-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">num_rounds</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-o">++</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5f694c62b3d16053879737-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">v0</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">v1</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">v1</span><span class="crayon-h"> </span><span class="crayon-o">&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">v1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">sum</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-sy">[</span><span class="crayon-v">sum</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d16053879737-18"><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c62b3d16053879737-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">j</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">4092</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d16053879737-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">o</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">4092</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c62b3d16053879737-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">8</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">32</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-o">++</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d16053879737-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">s*</span><span class="crayon-cn">8</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c62b3d16053879737-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">j</span><span class="crayon-h"> </span><span class="crayon-o">-=</span><span class="crayon-h"> </span><span class="crayon-cn">64</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d16053879737-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">o</span><span class="crayon-h"> </span><span class="crayon-o">-=</span><span class="crayon-h"> </span><span class="crayon-cn">8</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c62b3d16053879737-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d16053879737-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">h</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">64</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c62b3d16053879737-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sum</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">delta</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">4096</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d16053879737-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">v1</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">v0</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">v0</span><span class="crayon-h"> </span><span class="crayon-o">&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">v0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">sum</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5f694c62b3d16053879737-29"><span class="crayon-v">key</span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-v">sum</span><span class="crayon-o">&gt;&gt;</span><span class="crayon-cn">11</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d16053879737-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5f694c62b3d16053879737-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">v</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">=</span><span class="crayon-v">v0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d16053879737-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">v</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-o">=</span><span class="crayon-v">v1</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c62b3d16053879737-33"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0037 seconds] -->
<p>Now we can move onto the encoding function. At a quick glance, it looks to be base64. However, if we look at the alphabet, it does not look to be standard. The following is the traditional base64 alphabet.</p>
<p>ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/</p>
<p>This is the alphabet discovered within the Windows executable.</p>
<p>qtgJYKa8y5L4flzMQ/BsGpSkHIjhVrm3NCAi9cbeXvuwDx+R6dO7ZPEno21T0UFW</p>
<p>Knowing this, we can now create a script that will both parse the PCAP file and decrypt the contents sent across the wire. The following script was created to accomplish this.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c62b3d23707832328" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
import string
import dpkt
import sys
import base64
import struct


def xtea_decrypt(key,block, n=32, endian="!"):
  v0,v1 = struct.unpack(endian+"2L",block)
  k = struct.unpack(endian+"4L",key)
  delta,mask = 0x9e3779b9L,0xffffffffL
  sum = (delta * n) &amp; mask
  for round in range(n):
    v1 = (v1 - (((v0&lt;&lt;4 ^ v0&gt;&gt;5) + v0) ^ (sum + k[sum&gt;&gt;11 &amp; 
3]))) &amp; mask
    sum = (sum - delta) &amp; mask
    v0 = (v0 - (((v1&lt;&lt;4 ^ v1&gt;&gt;5) + v1) ^ (sum + k[sum &amp; 3]))) &amp; 
mask
  return struct.pack(endian+"2L",v0,v1)

all_data = ""

def parse_pcap_file(filename):
  global all_data
  f = open(filename)
  pcap = dpkt.pcap.Reader(f)
  for ts, buf in pcap:
    eth = dpkt.ethernet.Ethernet(buf)
    ip = eth.data
    tcp = ip.data
    if tcp.dport == 8080 and len(tcp.data) &gt; 0:
      all_data += tcp.data

if __name__ == '__main__':
  if len(sys.argv) &lt;= 1:
    print "%s [pcap file]" % __file__
    sys.exit(2)
  parse_pcap_file(sys.argv[1])

new_b64_chars  = 
"qtgJYKa8y5L4flzMQ/BsGpSkHIjhVrm3NCAi9cbeXvuwDx+R6dO7ZPEno21T0UF
W"
old_b64_chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+
/"

all_data = all_data.translate(string.maketrans(new_b64_chars, 
old_b64_chars))
data = base64.b64decode(all_data)

result = ""
key = 'AWildKeyAppears!'
for x in range(0, len(data)/8):
  o = xtea_decrypt(key, data[8*x:8*x+8], endian="&lt;")
  result += o
print result</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-2">2</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-4">4</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-6">6</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-8">8</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-10">10</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-12">12</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-14">14</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-16">16</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-18">18</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-20">20</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-22">22</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-24">24</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-26">26</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-28">28</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-30">30</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-32">32</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-34">34</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-36">36</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-38">38</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-40">40</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-42">42</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-44">44</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-46">46</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-48">48</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-50">50</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-52">52</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d23707832328-54">54</div><div class="crayon-num" data-line="crayon-5f694c62b3d23707832328-55">55</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c62b3d23707832328-1"><span class="crayon-e">import </span><span class="crayon-t">string</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-2"><span class="crayon-e">import </span><span class="crayon-e">dpkt</span></div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-3"><span class="crayon-e">import </span><span class="crayon-e">sys</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-4"><span class="crayon-e">import </span><span class="crayon-e">base64</span></div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-5"><span class="crayon-e">import </span><span class="crayon-t">struct</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-6">&nbsp;</div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-8"><span class="crayon-e">def </span><span class="crayon-e">xtea_decrypt</span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-v">block</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">endian</span><span class="crayon-o">=</span><span class="crayon-s">"!"</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-9"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">v0</span><span class="crayon-sy">,</span><span class="crayon-v">v1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">struct</span><span class="crayon-sy">.</span><span class="crayon-e">unpack</span><span class="crayon-sy">(</span><span class="crayon-v">endian</span><span class="crayon-o">+</span><span class="crayon-s">"2L"</span><span class="crayon-sy">,</span><span class="crayon-v">block</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-10"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">k</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">struct</span><span class="crayon-sy">.</span><span class="crayon-e">unpack</span><span class="crayon-sy">(</span><span class="crayon-v">endian</span><span class="crayon-o">+</span><span class="crayon-s">"4L"</span><span class="crayon-sy">,</span><span class="crayon-v">key</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-11"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">delta</span><span class="crayon-sy">,</span><span class="crayon-v">mask</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0x9e3779b9L</span><span class="crayon-sy">,</span><span class="crayon-cn">0xffffffffL</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-12"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">sum</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e ">delta *</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span><span class="crayon-e">mask</span></div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-13"><span class="crayon-e">&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">round </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">v1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">v1</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">v0</span><span class="crayon-o">&lt;&lt;</span><span class="crayon-cn">4</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-v">v0</span><span class="crayon-o">&gt;&gt;</span><span class="crayon-cn">5</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">v0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">sum</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">[</span><span class="crayon-v">sum</span><span class="crayon-o">&gt;&gt;</span><span class="crayon-cn">11</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-15"><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span><span class="crayon-e">mask</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-16"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sum</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">sum</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">delta</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span><span class="crayon-e">mask</span></div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-17"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">v0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">v0</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">v1</span><span class="crayon-o">&lt;&lt;</span><span class="crayon-cn">4</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-v">v1</span><span class="crayon-o">&gt;&gt;</span><span class="crayon-cn">5</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">v1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">sum</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">[</span><span class="crayon-v">sum</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-18"><span class="crayon-e">mask</span></div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-19"><span class="crayon-e">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">struct</span><span class="crayon-sy">.</span><span class="crayon-e">pack</span><span class="crayon-sy">(</span><span class="crayon-v">endian</span><span class="crayon-o">+</span><span class="crayon-s">"2L"</span><span class="crayon-sy">,</span><span class="crayon-v">v0</span><span class="crayon-sy">,</span><span class="crayon-v">v1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-20">&nbsp;</div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-21"><span class="crayon-v">all_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">""</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-22">&nbsp;</div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-23"><span class="crayon-e">def </span><span class="crayon-e">parse_pcap_file</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-24"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-m">global</span><span class="crayon-h"> </span><span class="crayon-v">all</span><span class="crayon-sy">_</span>data</div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-25"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">f</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-26"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">pcap</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dpkt</span><span class="crayon-sy">.</span><span class="crayon-v">pcap</span><span class="crayon-sy">.</span><span class="crayon-e">Reader</span><span class="crayon-sy">(</span><span class="crayon-v">f</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-27"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">ts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">buf </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pcap</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">eth</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dpkt</span><span class="crayon-sy">.</span><span class="crayon-v">ethernet</span><span class="crayon-sy">.</span><span class="crayon-e">Ethernet</span><span class="crayon-sy">(</span><span class="crayon-v">buf</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">ip</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">eth</span><span class="crayon-sy">.</span><span class="crayon-e">data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-30"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">tcp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ip</span><span class="crayon-sy">.</span><span class="crayon-e">data</span></div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-31"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">tcp</span><span class="crayon-sy">.</span><span class="crayon-v">dport</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">8080</span><span class="crayon-h"> </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">tcp</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">all_data</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-v">tcp</span><span class="crayon-sy">.</span><span class="crayon-e">data</span></div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-33">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-34"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">__name__</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'__main__'</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-35"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">sys</span><span class="crayon-sy">.</span><span class="crayon-v">argv</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&lt;=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"%s [pcap file]"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">__file__</span></div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-37"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sys</span><span class="crayon-sy">.</span><span class="crayon-e">exit</span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-38"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">parse_pcap_file</span><span class="crayon-sy">(</span><span class="crayon-v">sys</span><span class="crayon-sy">.</span><span class="crayon-v">argv</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-39">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-40"><span class="crayon-v">new_b64_chars</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-41"><span class="crayon-s">"qtgJYKa8y5L4flzMQ/BsGpSkHIjhVrm3NCAi9cbeXvuwDx+R6dO7ZPEno21T0UF</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-42"><span class="crayon-s">W"</span></div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-43"><span class="crayon-v">old_b64_chars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-44"><span class="crayon-s">/"</span></div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-45">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-46"><span class="crayon-v">all_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">all_data</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-t">string</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-v">new_b64_chars</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-47"><span class="crayon-v">old_b64_chars</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-48"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">base64</span><span class="crayon-sy">.</span><span class="crayon-e">b64decode</span><span class="crayon-sy">(</span><span class="crayon-v">all_data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-49">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-50"><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">""</span></div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-51"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'AWildKeyAppears!'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-52"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">8</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-53"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">o</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">xtea_decrypt</span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-cn">8</span><span class="crayon-o">*</span><span class="crayon-v">x</span><span class="crayon-o">:</span><span class="crayon-cn">8</span><span class="crayon-o">*</span><span class="crayon-v">x</span><span class="crayon-o">+</span><span class="crayon-cn">8</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">endian</span><span class="crayon-o">=</span><span class="crayon-s">"&lt;"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d23707832328-54"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-i">o</span></div><div class="crayon-line" id="crayon-5f694c62b3d23707832328-55"><span class="crayon-e">print </span><span class="crayon-v">result</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0041 seconds] -->
<p>Running this script against the provided PCAP file, we’re presented with the following output.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c62b3d27722622751" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
PADDINGPADDINGPADDINGPADDINGPADDINGPADDINGPADDINGPADDINGP
PAN{did_1_mention_th0se_pupp3ts_fr34ked_m3_out_recent1y?}
PADDINGPADDINGPADDINGhibobPADDINGPADDINGPADDINGPAD</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c62b3d27722622751-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d27722622751-2">2</div><div class="crayon-num" data-line="crayon-5f694c62b3d27722622751-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c62b3d27722622751-1"><span class="crayon-e">PADDINGPADDINGPADDINGPADDINGPADDINGPADDINGPADDINGPADDINGP</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d27722622751-2"><span class="crayon-e">PAN</span><span class="crayon-sy">{</span><span class="crayon-v">did_1_mention_th0se_pupp3ts_fr34ked_m3_out_recent1y</span><span class="crayon-sy">?</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5f694c62b3d27722622751-3"><span class="crayon-v">PADDINGPADDINGPADDINGhibobPADDINGPADDINGPADDINGPAD</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>PAN{did_1_mention_th0se_pupp3ts_fr34ked_m3_out_recent1y?}</p>
<h3>Windows 8 Challenge: Prepare for windows kernel debugging! (smile)</h3>
<p><em>Challenge Created By: Esmid Idrizovic <a href="https://twitter.com/xedi25" target="_blank">@xedi25</a></em></p>
<h4>Initial analysis</h4>
<p>When we open the file revloader.exe in a PE viewer we see that it’s a PE64 file. The file contains three unencrypted resources in the RCData directory.  We extract all three resource files to look at what’s in these files.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_6.png"><img class="size-large wp-image-19607 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_6-500x287.png" alt="windows_2_6" width="500" height="287" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_6-500x287.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_6-230x132.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_6-768x441.png 768w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_6-510x293.png 510w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_6-70x40.png 70w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_6.png 872w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<h4>Resources of revloader.exe</h4>
<p><strong>Resource 101</strong></p>
<p>This file is also a PE64 and contains some version information strings, which tells us that it’s DSEFix. DSEFix is a tool that can bypass the driver signature enforcement in Windows by using an exploit in a signed VirtualBox driver. By using DSEFix, you can disable DSE and load any driver you want. So it looks like we’ll solve this challenge by using an unsigned windows driver.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_7.png"><img class="size-large wp-image-19604 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_7-500x399.png" alt="windows_2_7" width="500" height="399" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_7-500x399.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_7-230x184.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_7-376x300.png 376w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_7-50x40.png 50w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_7.png 729w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p><strong>Resource 102</strong></p>
<p>This is the driver itself. It’s also a PE64 and uses FLTMGR.SYS. In version information, we can see that it’s a windows driver with the internal name revhunt.sys. We can also see that the file is not signed, so it makes sense that revloader.exe is going to use DSEFix to load the revhunt.sys.</p>
<p><strong>Resource 103</strong></p>
<p>This is an INF file for the driver. We can see that it’s a mini file filter driver and that it uses the altitude 31337.</p>
<h4>Revloader</h4>
<p>Let’s start with revloader.exe to verify that it’s going to drop DSEFix driver and run DSEFix to disable windows driver signature enforcement. We can take a look at the import table to find important functions that might be used for this kind of work.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_8.png"><img class="size-large wp-image-19601 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_8-500x187.png" alt="windows_2_8" width="500" height="187" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_8-500x187.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_8-230x86.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_8-510x190.png 510w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_8-107x40.png 107w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_8.png 533w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<ul>
<li>LookupPrivilegeValueW/AdjustTokenPrivilege: to acquire the missing rights to load a driver (“SeLoadDriverPrivilege”).</li>
<li>LoadResource/FindResource: to find a resource and map it to memory.</li>
<li>CreateFileW: to create or access a file on the disk.</li>
<li>WinExec: to execute a file.</li>
<li>FilterLoad/FilterUnload: to load and unload a mini filter driver.</li>
</ul>
<p>Following cross-references to FilterLoad we can see that the function to load the driver is at 0x140001800. That function uses InstallHinfSectionW with arguments “DefaultInstall 132 &lt;filename.inf&gt;” to install the driver and then uses FilterLoad to load the driver. If we follow that function back, we can see that this function has been called from main function and we can see that there are a few more interesting calls:</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_9.png"><img class="size-full wp-image-19598 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_9.png" alt="windows_2_9" width="330" height="438" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_9.png 330w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_9-230x305.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_9-226x300.png 226w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_9-30x40.png 30w" sizes="(max-width: 330px) 100vw, 330px" /></a></p>
<p>We can see that the function at 0x140001FD0 will be called with argument 101, 102, and 103. That means this function is probably accessing the embedded resources. If we look into that function we will see that it uses FindResourceW, SizeofResource, LoadResource, CreateFileW and WriteFile. We can rename that function to DropResource. After these three calls, it will call WinExec.</p>
<p>That means that revloader is dropping the resources to current directory (resource 101, 102, 103) and then executing dsefix.exe (resource 101) after it loads the mini file filter driver (resource 102 + 103).</p>
<p>Let’s run revloader.exe to load the driver into kernel and see if it works.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_10.png"><img class="size-large wp-image-19595 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_10-500x319.png" alt="windows_2_10" width="500" height="319" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_10-500x319.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_10-230x147.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_10-471x300.png 471w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_10-63x40.png 63w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_10.png 745w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>We can see the “Welcome to revhunt x86-x64”. Now let’s analyze the driver and try to find the flag.</p>
<h4>Revhunt</h4>
<p>Opening revhunt.sys in IDA Pro we can see that in DriverEntry function there is a jump to 0x140007000. That looks like the real main function.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_11.png"><img class="size-large wp-image-19592 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_11-500x406.png" alt="windows_2_11" width="500" height="406" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_11-500x406.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_11-230x187.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_11-768x624.png 768w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_11-369x300.png 369w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_11-49x40.png 49w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_11.png 778w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>We can see that the driver is using some kernel anti-debugging functions like KdDebuggerNotPresent and KdDisableDebugger. That means if we attach a kernel debugger to our virtual machine, the function KdDisableDebugger will disconnect us. We would have to patch KdDebuggerNotPresent and KdDisableDebugger with NOP instruction or, since the driver is not signed, we can also patch the calls in the driver itself.</p>
<p>We can also see that the driver uses FltRegisterFilter and FltStartFiltering. Let’s take a look at definition of FltRegisterFilter:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c62b3d2b707768687" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
NTSTATUS FltRegisterFilter(
_In_        PDRIVER_OBJECT   Driver,
_In_  const FLT_REGISTRATION *Registration,
_Out_       PFLT_FILTER      *RetFilter
);</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c62b3d2b707768687-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d2b707768687-2">2</div><div class="crayon-num" data-line="crayon-5f694c62b3d2b707768687-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d2b707768687-4">4</div><div class="crayon-num" data-line="crayon-5f694c62b3d2b707768687-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c62b3d2b707768687-1"><span class="crayon-e">NTSTATUS </span><span class="crayon-e">FltRegisterFilter</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d2b707768687-2"><span class="crayon-v">_In</span><span class="crayon-sy">_</span>        <span class="crayon-v">PDRIVER</span><span class="crayon-sy">_</span>OBJECT<span class="crayon-h"> </span>  <span class="crayon-v">Driver</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5f694c62b3d2b707768687-3"><span class="crayon-v">_In</span><span class="crayon-sy">_</span>  <span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-e ">FLT_REGISTRATION *</span><span class="crayon-v">Registration</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d2b707768687-4"><span class="crayon-v">_Out</span><span class="crayon-sy">_</span>       <span class="crayon-v">PFLT</span><span class="crayon-sy">_</span>FILTER<span class="crayon-h"> </span>     <span class="crayon-o">*</span><span class="crayon-i">RetFilter</span></div><div class="crayon-line" id="crayon-5f694c62b3d2b707768687-5"><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>FltRegisterFilter takes a FLT_REGISTRATION structure as a second argument that contains information (flags, callback routines, etc.) for the registration of the mini file filter driver. The second argument for FltRegisterFilter in this case is:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c62b3d2f596661384" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
lea     rdx, unk_140003140</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c62b3d2f596661384-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c62b3d2f596661384-1"><span class="crayon-i">lea</span>    <span class="crayon-h"> </span><span class="crayon-v">rdx</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">unk_140003140</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can go to IDA Pro and set a structure at 0x140003140 as FLT_REGISTRATION but before we do that we have to load the correct type library: Windows Driver Kit 8 (kernel mode) &#8211; wdk8_km. You can also take any newer DDK libraries. Now we can set the correct structure:</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_12.png"><img class="size-large wp-image-19589 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_12-500x280.png" alt="windows_2_12" width="500" height="280" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_12-500x280.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_12-230x129.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_12-510x286.png 510w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_12-71x40.png 71w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_12.png 758w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>Using that we can quickly identify what each sub-function is used for. We can also see that the flags for the structure are set to 0x02, which is FLTFL_REGISTRATION_SUPPORT_NPFS_MSFS. According to MSDN that means that the driver supports named pipes and mailslot requests as normal file events.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_13.png"><img class="size-large wp-image-19586 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_13-500x55.png" alt="windows_2_13" width="500" height="55" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_13-500x55.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_13-230x25.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_13-768x85.png 768w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_13-510x56.png 510w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_13-240x26.png 240w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_13.png 953w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>Now let’s do the same with OperationRegistration and set a structure of FLT_OPERATION_REGISTRATION:</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_14.png"><img class="size-large wp-image-19583 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_14-500x69.png" alt="windows_2_14" width="500" height="69" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_14-500x69.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_14-230x32.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_14-768x106.png 768w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_14-510x71.png 510w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_14-240x33.png 240w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_14.png 975w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>Checking quickly for PreOperation and PostOperation code, we can see that the really interesting code is going on in the PostOperation function, so let’s analyze that.</p>
<h4>PostOperation callback</h4>
<p>Before we start, we should set a new function definition in IDA Pro to the correct definition like in MSDN, it will make our analysis a lot easier (and if you use the Hex-Rays Decompiler it will decompile a lot better). So let’s change the function definition to:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c62b3d31712800906" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
typedef FLT_POSTOP_CALLBACK_STATUS ( *PFLT_POST_OPERATION_CALLBACK)(
_Inout_  PFLT_CALLBACK_DATA       Data,
_In_     PCFLT_RELATED_OBJECTS    FltObjects,
_In_opt_ PVOID                    CompletionContext,
_In_     FLT_POST_OPERATION_FLAGS Flags
);

__int64 __fastcall PostOperation(PFLT_CALLBACK_DATA
CallbackData, PCFLT_RELATED_OBJECTS FltObjects, PVOID
CompletionContext, FLT_POST_OPERATION_FLAGS Flags);</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c62b3d31712800906-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d31712800906-2">2</div><div class="crayon-num" data-line="crayon-5f694c62b3d31712800906-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d31712800906-4">4</div><div class="crayon-num" data-line="crayon-5f694c62b3d31712800906-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d31712800906-6">6</div><div class="crayon-num" data-line="crayon-5f694c62b3d31712800906-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d31712800906-8">8</div><div class="crayon-num" data-line="crayon-5f694c62b3d31712800906-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d31712800906-10">10</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c62b3d31712800906-1"><span class="crayon-r">typedef</span><span class="crayon-h"> </span><span class="crayon-e">FLT_POSTOP_CALLBACK_STATUS</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">PFLT_POST_OPERATION_CALLBACK</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d31712800906-2"><span class="crayon-v">_Inout</span><span class="crayon-sy">_</span>  <span class="crayon-v">PFLT_CALLBACK</span><span class="crayon-sy">_</span>DATA<span class="crayon-h"> </span>      <span class="crayon-v">Data</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5f694c62b3d31712800906-3"><span class="crayon-v">_In</span><span class="crayon-sy">_</span>     <span class="crayon-v">PCFLT_RELATED</span><span class="crayon-sy">_</span>OBJECTS<span class="crayon-h"> </span>   <span class="crayon-v">FltObjects</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d31712800906-4"><span class="crayon-v">_In_opt</span><span class="crayon-sy">_</span> <span class="crayon-i">PVOID</span><span class="crayon-h"> </span>                   <span class="crayon-v">CompletionContext</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5f694c62b3d31712800906-5"><span class="crayon-v">_In</span><span class="crayon-sy">_</span>     <span class="crayon-e">FLT_POST_OPERATION_FLAGS </span><span class="crayon-i">Flags</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d31712800906-6"><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c62b3d31712800906-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d31712800906-8"><span class="crayon-e">__int64 </span><span class="crayon-e">__fastcall </span><span class="crayon-e">PostOperation</span><span class="crayon-sy">(</span><span class="crayon-e">PFLT_CALLBACK_DATA</span></div><div class="crayon-line" id="crayon-5f694c62b3d31712800906-9"><span class="crayon-v">CallbackData</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">PCFLT_RELATED_OBJECTS </span><span class="crayon-v">FltObjects</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">PVOID</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d31712800906-10"><span class="crayon-v">CompletionContext</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">FLT_POST_OPERATION_FLAGS </span><span class="crayon-v">Flags</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>By loading the correct type libraries, we can simplify the analysis because that code looks easier to read:</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_15.png"><img class="size-large wp-image-19580 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_15-500x365.png" alt="windows_2_15" width="500" height="365" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_15-500x365.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_15-230x168.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_15-411x300.png 411w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_15-55x40.png 55w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_15.png 719w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>We can see that the function is checking if the current FileObject is a mailslot event (FO_MAILSLOT), if the current file name of the object is 18 characters long, if “\gsrt.txt”, and if the current event is opening the file. If that’s the case, then it will use FltReadFile to read from the file and compare the content with encrypted data:</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_16.png"><img class="size-large wp-image-19577 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_16-500x115.png" alt="windows_2_16" width="500" height="115" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_16-500x115.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_16-230x53.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_16-768x176.png 768w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_16-510x117.png 510w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_16-174x40.png 174w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_16.png 975w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>So let’s quickly decode that using a python script:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c62b3d34928817735" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
data = [0x7F, 0x56, 0x71, 0x4E, 0x61, 0x52, 0x7D, 0x43, 0x7B, 0x19, 0x70, 0x58, 0x7E,
0x37]
for x in range(0, 14):
if (x % 2 == 0):
data[x] ^= 0x13
else:
data[x] ^= 0x37
print str (bytearray(data))

$ python decoder.py
labyrenth.com</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c62b3d34928817735-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d34928817735-2">2</div><div class="crayon-num" data-line="crayon-5f694c62b3d34928817735-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d34928817735-4">4</div><div class="crayon-num" data-line="crayon-5f694c62b3d34928817735-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d34928817735-6">6</div><div class="crayon-num" data-line="crayon-5f694c62b3d34928817735-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d34928817735-8">8</div><div class="crayon-num" data-line="crayon-5f694c62b3d34928817735-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d34928817735-10">10</div><div class="crayon-num" data-line="crayon-5f694c62b3d34928817735-11">11</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c62b3d34928817735-1"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0x7F</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x56</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x71</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x4E</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x61</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x52</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x7D</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x43</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x7B</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x19</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x70</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x58</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x7E</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d34928817735-2"><span class="crayon-cn">0x37</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5f694c62b3d34928817735-3"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">14</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d34928817735-4"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5f694c62b3d34928817735-5"><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">x</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">^=</span><span class="crayon-h"> </span><span class="crayon-cn">0x13</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d34928817735-6"><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5f694c62b3d34928817735-7"><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">x</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">^=</span><span class="crayon-h"> </span><span class="crayon-cn">0x37</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d34928817735-8"><span class="crayon-e">print </span><span class="crayon-e">str</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">bytearray</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d34928817735-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d34928817735-10"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">decoder</span><span class="crayon-sy">.</span><span class="crayon-e">py</span></div><div class="crayon-line" id="crayon-5f694c62b3d34928817735-11"><span class="crayon-v">labyrenth</span><span class="crayon-sy">.</span><span class="crayon-v">com</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>That means, we have to create a file named “\gsrt.txt” with the content “labyrenth.com” and then open the file. After that we can see there is another byte array initialized on the stack and decode it using the same technique as before:</p>
<p><a style="font-family: Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif; font-size: 16px; line-height: 1.5; background-color: #ffffff;" href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_17.png"><img class="size-large wp-image-19574 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_17-500x99.png" alt="windows_2_17" width="500" height="99" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_17-500x99.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_17-230x45.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_17-768x151.png 768w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_17-510x101.png 510w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_17-203x40.png 203w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_17.png 847w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>Let us write that to our script and decode also that string.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c62b3d36324180794" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
data = [ 0x5C, 0x5F, 0x3D, 0x19, 0x3D, 0x17, 0x7C, 0x5C, 0x72, 0x4E, 0x3D, 0x19,
0x3D, 0x19, 0x5A, 0x17, 0x7E, 0x52, 0x72, 0x59, 0x33, 0x7E, 0x43, 0x74,
0x33, 0x58, 0x7D, 0x17, 0x2D, 0x0A, 0x33, 0x60, 0x7A, 0x59, 0x77, 0x58,
0x64, 0x44, 0x33, 0x0F, 0x33, 0x40, 0x7C, 0x42, 0x7F, 0x53, 0x33, 0x5F,
0x72, 0x41, 0x76, 0x17, 0x71, 0x52, 0x76, 0x59, 0x33, 0x52, 0x72, 0x44,
0x7A, 0x52, 0x61, 0x17, 0x71, 0x42, 0x67, 0x17, 0x7E, 0x5A, 0x7E, 0x5A,
0x78, 0x56, 0x6A, 0x17, 0x6A, 0x58, 0x66, 0x17, 0x72, 0x45, 0x76, 0x17,
0x67, 0x5F, 0x76, 0x17, 0x61, 0x52, 0x65, 0x52, 0x61, 0x44, 0x76, 0x45,
0x33, 0x5F, 0x76, 0x45, 0x76, 0x19, 0x19, 0x37]

for x in range(0, 104):
if (x % 2 == 0):
data[x] ^= 0x13
else:
data[x] ^= 0x37

print str(bytearray(data))

$ python decoder.py
Oh... okay....I mean IPC on &amp;gt;= Windows 8 would have been easier but mmmmkay you are the reverser here.</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c62b3d36324180794-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d36324180794-2">2</div><div class="crayon-num" data-line="crayon-5f694c62b3d36324180794-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d36324180794-4">4</div><div class="crayon-num" data-line="crayon-5f694c62b3d36324180794-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d36324180794-6">6</div><div class="crayon-num" data-line="crayon-5f694c62b3d36324180794-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d36324180794-8">8</div><div class="crayon-num" data-line="crayon-5f694c62b3d36324180794-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d36324180794-10">10</div><div class="crayon-num" data-line="crayon-5f694c62b3d36324180794-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d36324180794-12">12</div><div class="crayon-num" data-line="crayon-5f694c62b3d36324180794-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d36324180794-14">14</div><div class="crayon-num" data-line="crayon-5f694c62b3d36324180794-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d36324180794-16">16</div><div class="crayon-num" data-line="crayon-5f694c62b3d36324180794-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d36324180794-18">18</div><div class="crayon-num" data-line="crayon-5f694c62b3d36324180794-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d36324180794-20">20</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c62b3d36324180794-1"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-cn">0x5C</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x5F</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x3D</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x19</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x3D</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x7C</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x5C</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x72</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x4E</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x3D</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x19</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d36324180794-2"><span class="crayon-cn">0x3D</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x19</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x5A</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x7E</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x52</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x72</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x59</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x33</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x7E</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x43</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x74</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5f694c62b3d36324180794-3"><span class="crayon-cn">0x33</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x58</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x7D</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x2D</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x0A</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x33</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x60</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x7A</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x59</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x77</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x58</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d36324180794-4"><span class="crayon-cn">0x64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x44</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x33</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x0F</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x33</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x40</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x7C</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x42</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x7F</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x53</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x33</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x5F</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5f694c62b3d36324180794-5"><span class="crayon-cn">0x72</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x41</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x76</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x71</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x52</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x76</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x59</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x33</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x52</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x72</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x44</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d36324180794-6"><span class="crayon-cn">0x7A</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x52</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x61</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x71</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x42</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x67</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x7E</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x5A</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x7E</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x5A</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5f694c62b3d36324180794-7"><span class="crayon-cn">0x78</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x56</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x6A</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x6A</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x58</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x66</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x72</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x45</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x76</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x17</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d36324180794-8"><span class="crayon-cn">0x67</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x5F</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x76</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x61</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x52</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x65</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x52</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x61</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x44</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x76</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x45</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5f694c62b3d36324180794-9"><span class="crayon-cn">0x33</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x5F</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x76</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x45</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x76</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x19</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x19</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x37</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d36324180794-10">&nbsp;</div><div class="crayon-line" id="crayon-5f694c62b3d36324180794-11"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">104</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d36324180794-12"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5f694c62b3d36324180794-13"><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">x</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">^=</span><span class="crayon-h"> </span><span class="crayon-cn">0x13</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d36324180794-14"><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5f694c62b3d36324180794-15"><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">x</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">^=</span><span class="crayon-h"> </span><span class="crayon-cn">0x37</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d36324180794-16">&nbsp;</div><div class="crayon-line" id="crayon-5f694c62b3d36324180794-17"><span class="crayon-e">print </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-e">bytearray</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d36324180794-18">&nbsp;</div><div class="crayon-line" id="crayon-5f694c62b3d36324180794-19"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">python </span><span class="crayon-v">decoder</span><span class="crayon-sy">.</span><span class="crayon-e">py</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d36324180794-20"><span class="crayon-v">Oh</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-v">okay</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-i">I</span><span class="crayon-h"> </span><span class="crayon-e">mean </span><span class="crayon-e">IPC </span><span class="crayon-v">on</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">Windows</span><span class="crayon-h"> </span><span class="crayon-cn">8</span><span class="crayon-h"> </span><span class="crayon-e">would </span><span class="crayon-e">have </span><span class="crayon-e">been </span><span class="crayon-e">easier </span><span class="crayon-e">but </span><span class="crayon-e">mmmmkay </span><span class="crayon-e">you </span><span class="crayon-e">are </span><span class="crayon-e">the </span><span class="crayon-e">reverser </span><span class="crayon-v">here</span><span class="crayon-sy">.</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0038 seconds] -->
<p>That looks like a hint that tells us that we could have used Interprocess Communications (IPC) to do the same. If we scroll up again we will see that the sample was comparing the current FileObject.Flags with FO_MAILSLOT. That means if there was any Mailslot event it would have directly jumped to 0x140001405, which looks like an initialization function.</p>
<p>If we take a look into that function, we will see that it will allocate a memory address using ExAllocatePoolWithTag and save the result at 0x140004020, which I have named lpszBuffer.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_18.png"><img class="size-large wp-image-19571 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_18-500x100.png" alt="windows_2_18" width="500" height="100" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_18-500x100.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_18-230x46.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_18-768x153.png 768w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_18-510x102.png 510w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_18-201x40.png 201w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_18.png 974w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>If we take a look at the cross-references to lpszBuffer, we will see that it’s used in four functions: PostOperation, InitBuffer, 0x14000181C, and Unload. We will look into 0x14000181C a little later but now let’s go back to the PostOperation function and see what happens next.</p>
<p>After the InitBuffer call, it will check the filename of the FileObject again and compare it with “\pan.flag”. If that’s correct, it will call the function 0x14000181C and it will print the flag using DbgPrint. That means that the decrypting routine is at 0x14000181C and that lpszBuffer will contain the decoded flag.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_19.png"><img class="size-large wp-image-19568 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_19-500x367.png" alt="windows_2_19" width="500" height="367" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_19-500x367.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_19-230x169.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_19-768x564.png 768w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_19-409x300.png 409w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_19-54x40.png 54w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_19.png 975w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>Now let’s take a look into the function at 0x14000181C. I have renamed that function to TestFlag.</p>
<h4>Analyzing flag testing function</h4>
<p>At the beginning of the function we can see that it uses FltReadFile again to read the content of the given FileObject. We can also see that it reads 58 bytes. The first four bytes are compared with “PAN{“.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_20.png"><img class="size-large wp-image-19565 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_20-500x144.png" alt="windows_2_20" width="500" height="144" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_20-500x144.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_20-230x66.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_20-768x221.png 768w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_20-510x147.png 510w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_20-139x40.png 139w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_20.png 868w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>After that we can see first set of XOR data. It will take the next four bytes and XOR them with 0x1A1B1C1D and compare the result with 0x366C734A. It’s time to start writing our decoder.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c62b3d3a451070666" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
key = "PAN{"
key += (hex(0x366C734A ^ 0x1A1B1C1D)[2:]).decode('hex')[::-1]</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c62b3d3a451070666-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d3a451070666-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c62b3d3a451070666-1"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"PAN{"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d3a451070666-2"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">hex</span><span class="crayon-sy">(</span><span class="crayon-cn">0x366C734A</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x1A1B1C1D</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">decode</span><span class="crayon-sy">(</span><span class="crayon-s">'hex'</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-o">::</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Looks good so far&#8230;</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c62b3d3c099974664" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
python decoder.py
PAN{Wow,</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c62b3d3c099974664-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d3c099974664-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c62b3d3c099974664-1"><span class="crayon-e">python </span><span class="crayon-v">decoder</span><span class="crayon-sy">.</span><span class="crayon-e">py</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d3c099974664-2"><span class="crayon-e">PAN</span><span class="crayon-sy">{</span><span class="crayon-v">Wow</span><span class="crayon-sy">,</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Let’s move on to the next characters. The next code segment is doing some shifting and XOR based on the result of KdDebuggerNotPresent. Function KdDebuggerNotPresent should return 1 if there is no debugger attached. We also have to reverse the order to get the correct key:</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_21.png"><img class="size-large wp-image-19562 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_21-500x81.png" alt="windows_2_21" width="500" height="81" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_21-500x81.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_21-230x37.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_21-510x83.png 510w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_21-240x40.png 240w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_21.png 721w" sizes="(max-width: 500px) 100vw, 500px" /></a></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c62b3d3e546768419" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
key += chr((0xB0 ^ 0xF0) &amp;gt;&amp;gt; 1)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c62b3d3e546768419-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c62b3d3e546768419-1"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0xB0</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0xF0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The result is a space character (0x20 in hex). We can move on to the next character but we have to reverse the order again to get the correct character (instead of add, we have to use sub, etc.):</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_22.png"><img class="size-large wp-image-19559 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_22-500x46.png" alt="windows_2_22" width="500" height="46" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_22-500x46.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_22-230x21.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_22-510x47.png 510w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_22-240x22.png 240w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_22.png 758w" sizes="(max-width: 500px) 100vw, 500px" /></a></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c62b3d41636479764" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
key += chr((0x56 ^0x20) - 4)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c62b3d41636479764-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c62b3d41636479764-1"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x56</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-cn">0x20</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Now we just have to continue to slowly decode the whole flag but it gets trickier with a call to 0x140001AFC. At this function it will try to access characters at different offsets and do weirder calculations:</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_23.png"><img class="size-large wp-image-19556 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_23-500x432.png" alt="windows_2_23" width="500" height="432" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_23-500x432.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_23-230x199.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_23-347x300.png 347w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_23-46x40.png 46w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_23.png 533w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>For example, at 0x140001B41 it will load the fourth character and subtract 0x20 from it and multiply it with 3 [rax+rax*2] and then it will compare it with 0xC3. Optimizer can do some pretty cool stuff sometimes.</p>
<p>After analyzing the whole function and its sub-functions, we get the following decoder script:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c62b3d43228451803" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# 0x14000190A
key = "PAN{"
key += (hex(0x366C734A ^ 0x1A1B1C1D)[2:]).decode('hex')[::-1]
key += chr((0xB0 ^ 0xF0) &amp;gt;&amp;gt; 1)
key += chr((0x56 ^0x20) - 4)
key += (hex((0x8888999900001110 &amp;amp; 0xFFFFFFFFFFFFFFF0) ^ 0x0A9FAFCEA72656775))[2:-
1].decode('hex')[::-1]
# 0x140001AFC
key += chr(0x20)
key += chr(0x67 - 0x20)
key += chr(0x72)
key += chr(0xfc ^ 0x99)
key += chr((0xc3 / 3) + 0x20)
key += chr(0x3b ^ 0x4f)
key += chr(0x20)
key += chr((0x71 - 0x0f) ^ 0x0f)
key += chr((0x81 ^ 0x21) - 0x31)
key += chr(0x46 + 0x30)
key += chr((1 ^ 0x58) + 0x0c)
key += chr(0x73)
# 0x140001BD4
key += chr(0x2c)
key += chr(0x20)
key += chr(0x1ac0 &amp;gt;&amp;gt; 6)
key += chr(0x328 / 8)
key += chr((0xe002 ^ 0xf2f2) / 0x30)
key += chr((0x9542 ^ 0x8942) &amp;gt;&amp;gt; 6)
key += chr(0x1f + 1)
key += chr(0x834 * 4 / 0x50)
key += chr((0x94dd ^ 0x83c1) / 0x33)
key += chr(0x1f + 1)
key += chr((0x1dd36c ^ 0x46) / 0x4142)
key += chr(0x328250 / 0x7373)
# 0x140001CD8
key += chr((0xb6 ^ 0x32) / 3)
key += chr(0x40 - 0x20)
key += chr((0xd7 ^ 0x44) - 0x23)
key += chr((0xb2 ^ 0x21) - 0x21)
key += chr(0x1bc / 4)
key += chr((0x8f25 ^ 0x8875) &amp;gt;&amp;gt; 4)
key += chr(((0x0d6 ^ 0x0e4) / 2) &amp;lt;&amp;lt; 2)
key += chr((0x62 ^ 0x42) &amp;amp; 0xfe)
# 0x140001DB8
key += chr((0x70d49 ^ 0x48354) / 0x833)
key += chr((0x14c3a1 ^ 0x232221) / 0x8c40)
key += chr(0xA0 ^ 0x80)
# 0x140001E2C
key += chr(0x5c ^ 0x25)
key += chr((0x20f63 ^ 0x23) / 0x4c0)
key += chr((0x242067 ^ 0x12567) / 0x5100)
key += chr(((0x61 ^ 0x21) &amp;gt;&amp;gt; 6) + 0x20)
key += '}'

print key

python decoder.py

PAN{Wow, reverser! Great moves, keep it up, proud of you!}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-2">2</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-4">4</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-6">6</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-8">8</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-10">10</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-12">12</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-14">14</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-16">16</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-18">18</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-20">20</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-22">22</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-24">24</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-26">26</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-28">28</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-30">30</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-32">32</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-34">34</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-36">36</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-38">38</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-40">40</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-42">42</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-44">44</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-46">46</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-48">48</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-50">50</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-52">52</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-54">54</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-56">56</div><div class="crayon-num" data-line="crayon-5f694c62b3d43228451803-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d43228451803-58">58</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c62b3d43228451803-1"><span class="crayon-p"># 0x14000190A</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-2"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"PAN{"</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-3"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">hex</span><span class="crayon-sy">(</span><span class="crayon-cn">0x366C734A</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x1A1B1C1D</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">decode</span><span class="crayon-sy">(</span><span class="crayon-s">'hex'</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-o">::</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-4"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0xB0</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0xF0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-5"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x56</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-cn">0x20</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-6"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">hex</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x8888999900001110</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">amp</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">0xFFFFFFFFFFFFFFF0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x0A9FAFCEA72656775</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-o">:</span><span class="crayon-o">-</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-7"><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">decode</span><span class="crayon-sy">(</span><span class="crayon-s">'hex'</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-o">::</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-8"><span class="crayon-p"># 0x140001AFC</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-9"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x20</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-10"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x67</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">0x20</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-11"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x72</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-12"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0xfc</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x99</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-13"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0xc3</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">0x20</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-14"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x3b</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x4f</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-15"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x20</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-16"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x71</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">0x0f</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x0f</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-17"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x81</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x21</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">0x31</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-18"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x46</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">0x30</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-19"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x58</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">0x0c</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-20"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x73</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-21"><span class="crayon-p"># 0x140001BD4</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-22"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x2c</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-23"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x20</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-24"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x1ac0</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">6</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-25"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x328</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">8</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-26"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0xe002</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0xf2f2</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">0x30</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-27"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x9542</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x8942</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">6</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-28"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x1f</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-29"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x834</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">0x50</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-30"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x94dd</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x83c1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">0x33</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-31"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x1f</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-32"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x1dd36c</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x46</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">0x4142</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-33"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x328250</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">0x7373</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-34"><span class="crayon-p"># 0x140001CD8</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-35"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0xb6</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x32</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-36"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x40</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">0x20</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-37"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0xd7</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x44</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">0x23</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-38"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0xb2</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x21</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">0x21</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-39"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x1bc</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-40"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x8f25</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x8875</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-41"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x0d6</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x0e4</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">lt</span><span class="crayon-sy">;</span><span class="crayon-o">&amp;</span><span class="crayon-v">lt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-42"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x62</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x42</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">amp</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">0xfe</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-43"><span class="crayon-p"># 0x140001DB8</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-44"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x70d49</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x48354</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">0x833</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-45"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x14c3a1</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x232221</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">0x8c40</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-46"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0xA0</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x80</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-47"><span class="crayon-p"># 0x140001E2C</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-48"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x5c</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x25</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-49"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x20f63</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x23</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">0x4c0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-50"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x242067</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x12567</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">0x5100</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-51"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x61</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x21</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">6</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">0x20</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-52"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-s">'}'</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-53">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-54"><span class="crayon-e">print </span><span class="crayon-e">key</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-55">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-56"><span class="crayon-e">python </span><span class="crayon-v">decoder</span><span class="crayon-sy">.</span><span class="crayon-e">py</span></div><div class="crayon-line" id="crayon-5f694c62b3d43228451803-57">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d43228451803-58"><span class="crayon-e">PAN</span><span class="crayon-sy">{</span><span class="crayon-v">Wow</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">reverser</span><span class="crayon-o">!</span><span class="crayon-h"> </span><span class="crayon-e">Great </span><span class="crayon-v">moves</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">keep </span><span class="crayon-e">it </span><span class="crayon-v">up</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">proud </span><span class="crayon-e">of </span><span class="crayon-v">you</span><span class="crayon-o">!</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0046 seconds] -->
<p></p>
<h4>Testing the flag</h4>
<p>Now we’ll test the flag to confirm if everything is correct. We have to do following steps:</p>
<ul>
<li>Create a file named “gsrt.txt” with content “labyrenth.com”</li>
<li>Open “gsrt.txt” to raise a FILE_OPEN event to initialize the buffer
<ul>
<li>We can also create a mailsot event instead of these two steps (we can use CreateMailslot + WriteFile)</li>
</ul>
</li>
<li>Create a file named “pan.flag” with our flag “PAN{…}”</li>
<li>Open “pan.flag” to raise a FILE_OPEN event to call the analyzing function</li>
<li>Attach with DbgView to see the kernel debug output</li>
</ul>
<p>The solution with creating a file is easier because we can make a batch file to do the job for us:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c62b3d46930107863" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
Solution.bat
echo PAN{Wow, reverser! Great moves, keep it up, proud of you!} &amp;gt; c:\pan.flag
echo labyrenth.com&amp;gt; c:\gsrt.txt
start notepad c:\gsrt.txt
start notepad c:\pan.flag</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c62b3d46930107863-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d46930107863-2">2</div><div class="crayon-num" data-line="crayon-5f694c62b3d46930107863-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d46930107863-4">4</div><div class="crayon-num" data-line="crayon-5f694c62b3d46930107863-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c62b3d46930107863-1"><span class="crayon-v">Solution</span><span class="crayon-sy">.</span><span class="crayon-e">bat</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d46930107863-2"><span class="crayon-e">echo</span><span class="crayon-h"> </span><span class="crayon-e">PAN</span><span class="crayon-sy">{</span><span class="crayon-v">Wow</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">reverser</span><span class="crayon-o">!</span><span class="crayon-h"> </span><span class="crayon-e">Great </span><span class="crayon-v">moves</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">keep </span><span class="crayon-e">it </span><span class="crayon-v">up</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">proud </span><span class="crayon-e">of </span><span class="crayon-v">you</span><span class="crayon-o">!</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-o">:</span><span class="crayon-sy">\</span><span class="crayon-v">pan</span><span class="crayon-sy">.</span><span class="crayon-e">flag</span></div><div class="crayon-line" id="crayon-5f694c62b3d46930107863-3"><span class="crayon-e">echo </span><span class="crayon-v">labyrenth</span><span class="crayon-sy">.</span><span class="crayon-v">com</span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-o">:</span><span class="crayon-sy">\</span><span class="crayon-v">gsrt</span><span class="crayon-sy">.</span><span class="crayon-e">txt</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d46930107863-4"><span class="crayon-e">start </span><span class="crayon-i">notepad</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-o">:</span><span class="crayon-sy">\</span><span class="crayon-v">gsrt</span><span class="crayon-sy">.</span><span class="crayon-e">txt</span></div><div class="crayon-line" id="crayon-5f694c62b3d46930107863-5"><span class="crayon-e">start </span><span class="crayon-i">notepad</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-o">:</span><span class="crayon-sy">\</span><span class="crayon-v">pan</span><span class="crayon-sy">.</span><span class="crayon-v">flag</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>We run revloader.exe and run our solution batch file and see what happens:</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_24.png"><img class="alignnone size-large wp-image-19553" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_24-500x352.png" alt="windows_2_24" width="500" height="352" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_24-500x352.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_24-230x162.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_24-768x541.png 768w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_24-426x300.png 426w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_24-57x40.png 57w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_24.png 932w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>And we can see in the last screenshot that the flag is correct and it gets printed out.</p>
<h3>Windows 9 Challenge: I think some holy dude wrote that crypter.</h3>
<p><em>Challenge Created By: Esmid Idrizovic <a href="https://twitter.com/xedi25" target="_blank">@xedi25</a></em></p>
<h4>Initial analysis</h4>
<p>When we run the final challenge, we see a dialog where we have to enter 30 characters. We can also see that the icon is different and that it’s the default Delphi 7 executable icon. If we enter any text and press enter we see that the label changes to “Wrong”. That means that we have to enter the correct flag and press enter to verify it.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_25.png"><img class="size-large wp-image-19550 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_25-500x101.png" alt="windows_2_25" width="500" height="101" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_25-500x101.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_25-230x46.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_25-768x154.png 768w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_25-510x103.png 510w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_25-199x40.png 199w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_25.png 890w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>If we open that sample in a PE viewer, we see that it’s using an unknown EXE crypter to hide its code (actually that crypter is Morphine 2.7 which is also written in Delphi). We can see that by looking at the import table there are just LoadLibraryA, GetProcAddress, and the PE sections.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_26.png"><img class="size-large wp-image-19547 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_26-500x287.png" alt="windows_2_26" width="500" height="287" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_26-500x287.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_26-230x132.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_26-510x293.png 510w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_26-70x40.png 70w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_26.png 763w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>We can solve this challenge pretty fast if we know what we have to look for. We want to identify the routine that is checking for a valid flag. We can start our analysis at the function which sets the status to “Wrong”, but before we can do that we have to dump the executable so we can load it in IDA Pro.</p>
<h4>Dump the executable</h4>
<p>We can use Scylla x86 to dump the process, so let’s execute the challenge and run Scylla. Select “DelphiChallenge.exe”, press “IAT Autosearch”, after that press “Get Imports” and Scylla should be able to find the imports.  You can already see the correct imports in next screenshot:</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_27.png"><img class="size-large wp-image-19544 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_27-500x491.png" alt="windows_2_27" width="500" height="491" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_27-500x491.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_27-230x226.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_27-768x754.png 768w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_27-306x300.png 306w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_27-41x40.png 41w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_27-32x32.png 32w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_27-64x64.png 64w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_27.png 867w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>We can save the PE dump using “Dump” and “Fix dump” functions in Scylla. We can’t run that dumped file but it’s enough for a static analysis in IDA Pro. We can dump the file correctly but it takes a few extra steps (see extra part).</p>
<h4>Static analysis</h4>
<p>Now open the file in IDA Pro and go directly to “strings window” by using Shift+F12. Search in strings window for “Wrong” and you should see these 5 entries:</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_28.png"><img class="size-large wp-image-19541 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_28-500x302.png" alt="windows_2_28" width="500" height="302" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_28-500x302.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_28-230x139.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_28-496x300.png 496w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_28-66x40.png 66w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_28.png 577w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>If we follow the first string using cross-references, we can see that it’s referenced in sub_4C17BC and there is one more interesting string:</p>
<p>If byte_4C4C5C is nonzero then it will show “Correct!! You are so g00d”. Following byte_4C4C5C we can see that its set to 1 at offset 0x004C127F and that function starts at offset 0x004C0E1C. This function looks like our testing flag routine.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_30.png"><img class="size-full wp-image-19535 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_30.png" alt="windows_2_30" width="469" height="525" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_30.png 469w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_30-230x257.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_30-268x300.png 268w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_30-36x40.png 36w" sizes="(max-width: 469px) 100vw, 469px" /></a></p>
<p>We have identified pretty quickly the routine which is checking for the correct flag, now we have to analyze that function. It’s pretty similar to Windows track challenge 8. We know that the flag must start with “PAN{“ and we can see that the function is checking for that at the beginning:</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_31.png"><img class="size-large wp-image-19532 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_31-500x263.png" alt="windows_2_31" width="500" height="263" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_31-500x263.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_31-230x121.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_31-510x268.png 510w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_31-76x40.png 76w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_31.png 517w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>We have to follow the function and revert the calculations again like in Windows challenge 8. The final decoder script would look like this:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c62b3d4a080061497" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
key = "PAN{"
key += chr(0xcf ^ 0xab)
key += chr(0x1e ^ 0x2d)
key += chr(0x3e ^ 0x52)
key += chr(0x52 ^ 0x22)
key += chr(0x08 ^ 0x60)
key += chr(0x68 + 0x01)
key += chr(0xe5 ^ 0xba)
key += chr(0xd7 ^ 0xbe)
key += chr(0xe6 / 2)
key += chr((0x2f &amp;lt;&amp;lt; 1) + 1)
key += chr(0x194 &amp;gt;&amp;gt; 2)
key += chr((0x19 &amp;lt;&amp;lt; 1) + 2)
key += chr((0x1c0 ^ 0x0c) &amp;gt;&amp;gt; 2)
key += chr(((0x38 ^0x04) &amp;lt;&amp;lt; 1) + 1)
key += chr(((0x28 + 0x07) &amp;lt;&amp;lt; 1) + 1)
key += chr(((0x8c / 0x0A) &amp;lt;&amp;lt; 3) + 4)
key += chr(0x60 / 2)
key += chr(0x17c &amp;gt;&amp;gt; 2)
key += chr((0x59 ^ 0x60) &amp;lt;&amp;lt; 1)
key += chr((0x42 ^ 0x88) / 2)
key += chr((0x0c0 ^ 0x2c) / 2)
key += chr((0x16 &amp;lt;&amp;lt; 1) + 7)
key += chr((0x36 ^ 0x29a) / 6)
key += chr(((0x130f0 / 8) ^ 0x2486) / 8)
key += chr(((0x2950 ^0x25a0) / 0x30))
key += chr(0x7d)
print key

python decoder.py
PAN{d3lphi_is_e4sy_t0_rev3rSE}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c62b3d4a080061497-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d4a080061497-2">2</div><div class="crayon-num" data-line="crayon-5f694c62b3d4a080061497-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d4a080061497-4">4</div><div class="crayon-num" data-line="crayon-5f694c62b3d4a080061497-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d4a080061497-6">6</div><div class="crayon-num" data-line="crayon-5f694c62b3d4a080061497-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d4a080061497-8">8</div><div class="crayon-num" data-line="crayon-5f694c62b3d4a080061497-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d4a080061497-10">10</div><div class="crayon-num" data-line="crayon-5f694c62b3d4a080061497-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d4a080061497-12">12</div><div class="crayon-num" data-line="crayon-5f694c62b3d4a080061497-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d4a080061497-14">14</div><div class="crayon-num" data-line="crayon-5f694c62b3d4a080061497-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d4a080061497-16">16</div><div class="crayon-num" data-line="crayon-5f694c62b3d4a080061497-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d4a080061497-18">18</div><div class="crayon-num" data-line="crayon-5f694c62b3d4a080061497-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d4a080061497-20">20</div><div class="crayon-num" data-line="crayon-5f694c62b3d4a080061497-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d4a080061497-22">22</div><div class="crayon-num" data-line="crayon-5f694c62b3d4a080061497-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d4a080061497-24">24</div><div class="crayon-num" data-line="crayon-5f694c62b3d4a080061497-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d4a080061497-26">26</div><div class="crayon-num" data-line="crayon-5f694c62b3d4a080061497-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d4a080061497-28">28</div><div class="crayon-num" data-line="crayon-5f694c62b3d4a080061497-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d4a080061497-30">30</div><div class="crayon-num" data-line="crayon-5f694c62b3d4a080061497-31">31</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c62b3d4a080061497-1"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"PAN{"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d4a080061497-2"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0xcf</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0xab</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d4a080061497-3"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x1e</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x2d</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d4a080061497-4"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x3e</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x52</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d4a080061497-5"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x52</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x22</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d4a080061497-6"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x08</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x60</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d4a080061497-7"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x68</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">0x01</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d4a080061497-8"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0xe5</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0xba</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d4a080061497-9"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0xd7</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0xbe</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d4a080061497-10"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0xe6</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d4a080061497-11"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x2f</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">lt</span><span class="crayon-sy">;</span><span class="crayon-o">&amp;</span><span class="crayon-v">lt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d4a080061497-12"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x194</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d4a080061497-13"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x19</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">lt</span><span class="crayon-sy">;</span><span class="crayon-o">&amp;</span><span class="crayon-v">lt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d4a080061497-14"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x1c0</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x0c</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d4a080061497-15"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x38</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-cn">0x04</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">lt</span><span class="crayon-sy">;</span><span class="crayon-o">&amp;</span><span class="crayon-v">lt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d4a080061497-16"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x28</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">0x07</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">lt</span><span class="crayon-sy">;</span><span class="crayon-o">&amp;</span><span class="crayon-v">lt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d4a080061497-17"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x8c</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">0x0A</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">lt</span><span class="crayon-sy">;</span><span class="crayon-o">&amp;</span><span class="crayon-v">lt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d4a080061497-18"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x60</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d4a080061497-19"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x17c</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d4a080061497-20"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x59</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x60</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">lt</span><span class="crayon-sy">;</span><span class="crayon-o">&amp;</span><span class="crayon-v">lt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d4a080061497-21"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x42</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x88</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d4a080061497-22"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x0c0</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x2c</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d4a080061497-23"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x16</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">lt</span><span class="crayon-sy">;</span><span class="crayon-o">&amp;</span><span class="crayon-v">lt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">7</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d4a080061497-24"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x36</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x29a</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">6</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d4a080061497-25"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x130f0</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">8</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-cn">0x2486</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">8</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d4a080061497-26"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">0x2950</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-cn">0x25a0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">0x30</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c62b3d4a080061497-27"><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-cn">0x7d</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d4a080061497-28"><span class="crayon-e">print </span><span class="crayon-e">key</span></div><div class="crayon-line" id="crayon-5f694c62b3d4a080061497-29">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d4a080061497-30"><span class="crayon-e">python </span><span class="crayon-v">decoder</span><span class="crayon-sy">.</span><span class="crayon-e">py</span></div><div class="crayon-line" id="crayon-5f694c62b3d4a080061497-31"><span class="crayon-e">PAN</span><span class="crayon-sy">{</span><span class="crayon-v">d3lphi_is_e4sy_t0_rev3rSE</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0031 seconds] -->
<p>We can now test and verify if that flag is correct.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_32.png"><img class="size-large wp-image-19529 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_32-500x101.png" alt="windows_2_32" width="500" height="101" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_32-500x101.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_32-230x46.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_32-510x103.png 510w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_32-198x40.png 198w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_32.png 654w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<h4>Extra: Manual unpacking</h4>
<p>If we want do dump the process correctly we can use OllyDbg and OllyDump. To identify the original entry point (OEP) we can use the “set hardware breakpoint at current ESP” technique. For that we have to run the first instruction, go to the dump window and jump to the ESP. Then we can set a “Hardware, on access” breakpoint at current address.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_33.png"><img class="size-large wp-image-19526 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_33-500x277.png" alt="windows_2_33" width="500" height="277" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_33-500x277.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_33-230x128.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_33-768x426.png 768w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_33-510x283.png 510w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_33-72x40.png 72w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_33.png 1017w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>If we press F9 a few times we will reach the original entry point. Now we have to do some calculations and dump it to a new file.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_34.png"><img class="size-large wp-image-19523 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_34-500x219.png" alt="windows_2_34" width="500" height="219" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_34-500x219.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_34-230x101.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_34-510x224.png 510w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_34-91x40.png 91w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_34.png 702w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>For calculating the real OEP we need to know at which address the executable has been loaded.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_35.png"><img class="size-large wp-image-19520 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_35-500x31.png" alt="windows_2_35" width="500" height="31" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_35-500x31.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_35-230x14.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_35-510x31.png 510w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_35-240x15.png 240w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_35.png 702w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>Now we just have to subtract these offsets and we get the correct offsets for OllyDump.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c62b3d4d111620040" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
Calculations:
OEP:               0x00941b60
Address:        0x008F0000
Size:                0x001F0000
ImageBase:   0x008F0000

New EP: 	(0x00941b60 - 0x008F0000) = 0x51B60</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c62b3d4d111620040-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d4d111620040-2">2</div><div class="crayon-num" data-line="crayon-5f694c62b3d4d111620040-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d4d111620040-4">4</div><div class="crayon-num" data-line="crayon-5f694c62b3d4d111620040-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c62b3d4d111620040-6">6</div><div class="crayon-num" data-line="crayon-5f694c62b3d4d111620040-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c62b3d4d111620040-1"><span class="crayon-v">Calculations</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d4d111620040-2"><span class="crayon-v">OEP</span><span class="crayon-o">:</span><span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-cn">0x00941b60</span></div><div class="crayon-line" id="crayon-5f694c62b3d4d111620040-3"><span class="crayon-v">Address</span><span class="crayon-o">:</span><span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-cn">0x008F0000</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d4d111620040-4"><span class="crayon-v">Size</span><span class="crayon-o">:</span><span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-h"> </span> <span class="crayon-cn">0x001F0000</span></div><div class="crayon-line" id="crayon-5f694c62b3d4d111620040-5"><span class="crayon-v">ImageBase</span><span class="crayon-o">:</span><span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-cn">0x008F0000</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c62b3d4d111620040-6">&nbsp;</div><div class="crayon-line" id="crayon-5f694c62b3d4d111620040-7"><span class="crayon-r">New</span><span class="crayon-h"> </span><span class="crayon-v">EP</span><span class="crayon-o">:</span><span class="crayon-h"> 	</span><span class="crayon-sy">(</span><span class="crayon-cn">0x00941b60</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">0x008F0000</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0x51B60</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Now let’s fill that data into OllyDump and dump the file as “dumped.exe”:</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_36.png"><img class="size-large wp-image-19517 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_36-500x404.png" alt="windows_2_36" width="500" height="404" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_36-500x404.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_36-230x186.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_36-371x300.png 371w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_36-49x40.png 49w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_36.png 533w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>But something is still wrong if we try to execute the unpacked sample:</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Something-wrong.png"><img class="size-full wp-image-19631 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Something-wrong.png" alt="something-wrong" width="440" height="162" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Something-wrong.png 440w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Something-wrong-230x85.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Something-wrong-109x40.png 109w" sizes="(max-width: 440px) 100vw, 440px" /></a></p>
<p>It’s probably the import table that causes problems, but we can use Scylla to fix that for us. For that we have to run DelphiChallenge.exe again (new process) and search for the import table. We also have to enter the correct entry point + image base:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c62b3d50684275141" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
EP + Imagebase:	0x51B60 + 0x8F0000 = 0x941B60</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c62b3d50684275141-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c62b3d50684275141-1"><span class="crayon-v">EP</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">Imagebase</span><span class="crayon-o">:</span><span class="crayon-h">	</span><span class="crayon-cn">0x51B60</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">0x8F0000</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0x941B60</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Now we can use “Fix dump” and fix the dumped.exe executable:</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_38.png"><img class="size-large wp-image-19511 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_38-500x541.png" alt="windows_2_38" width="500" height="541" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_38-500x541.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_38-230x249.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_38-277x300.png 277w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_38-37x40.png 37w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_38.png 607w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>Scylla has created a new import table and now we can run the unpacked executable. Yey.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_39.png"><img class="size-large wp-image-19508 aligncenter" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_39-500x118.png" alt="windows_2_39" width="500" height="118" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_39-500x118.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_39-230x54.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_39-768x181.png 768w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_39-510x120.png 510w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_39-170x40.png 170w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/09/Windows_2_39.png 975w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>Leave a comment below to share your thoughts about these challenges. Be sure to also check out how other threat researchers solved these challenges:</p>
<p><strong><span class="s1">Windows 7:</span></strong></p>
<ul>
<li class="p2"><span class="s2"><a href="https://jmprsp.wordpress.com/2016/09/08/labyrenth-ctf-windows-track-challenge-7">https://jmprsp.wordpress.com/2016/09/08/labyrenth-ctf-windows-track-challenge-7</a></span><span class="s3">/</span></li>
<li class="p2"><span class="s2"><a href="https://github.com/gray-panda/grayrepo/tree/master/2016_labyREnth/win7_pcap">https://github.com/gray-panda/grayrepo/tree/master/2016_labyREnth/win7_pcap</a></span></li>
<li class="p2"><span class="s2"><a href="https://github.com/uafio/git/blob/master/scripts/labyREnth-2016/labyrenth-2016-win-7.py">https://github.com/uafio/git/blob/master/scripts/labyREnth-2016/labyrenth-2016-win-7.py</a></span></li>
<li class="p2"><span class="s2"><a href="https://github.com/11x256/CTFs/tree/master/2016/LabyREnth/7-PCAP">https://github.com/11&#215;256/CTFs/tree/master/2016/LabyREnth/7-PCAP</a></span></li>
<li class="p2"><span class="s2"><a href="https://github.com/spartansecurity/Writeups/blob/master/labyrenth2016/windows.md#challenge-7">https://github.com/spartansecurity/Writeups/blob/master/labyrenth2016/windows.md#challenge-7</a></span></li>
</ul>
<p class="p1"><strong><span class="s1">Windows 8: </span></strong></p>
<ul>
<li class="p1"><span class="s2"><a href="https://jmprsp.wordpress.com/2016/09/16/labyrenth-ctf-windows-track-challenge-8">https://jmprsp.wordpress.com/2016/09/16/labyrenth-ctf-windows-track-challenge-8</a></span><span class="s3">/</span></li>
<li class="p2"><span class="s2"><a href="https://github.com/gray-panda/grayrepo/tree/master/2016_labyREnth/win8_revhunt">https://github.com/gray-panda/grayrepo/tree/master/2016_labyREnth/win8_revhunt</a></span></li>
<li class="p2"><span class="s2"><a href="http://sibears.ru/labs/labyrenth2016-win-8">http://sibears.ru/labs/labyrenth2016-win-8</a></span><span class="s3">/</span></li>
<li class="p2"><span class="s2"><a href="https://github.com/uafio/git/blob/master/scripts/labyREnth-2016/labyrenth-2016-win-8.py">https://github.com/uafio/git/blob/master/scripts/labyREnth-2016/labyrenth-2016-win-8.py</a></span></li>
<li class="p2"><span class="s2"><a href="https://github.com/11x256/CTFs/tree/master/2016/LabyREnth/8-Revhunt">https://github.com/11&#215;256/CTFs/tree/master/2016/LabyREnth/8-Revhunt</a></span></li>
<li class="p2"><span class="s2"><a href="https://github.com/spartansecurity/Writeups/blob/master/labyrenth2016/windows.md#challenge-8">https://github.com/spartansecurity/Writeups/blob/master/labyrenth2016/windows.md#challenge-8</a></span></li>
<li class="p2"><span class="s2"><a href="http://findingvulns.blogspot.sg/2016/08/labyrenth-ctf-2016-windows-track.html">http://findingvulns.blogspot.sg/2016/08/labyrenth-ctf-2016-windows-track.html</a></span></li>
</ul>
<p><strong><span class="s1">Win</span><span class="s1">dows 9:</span></strong></p>
<ul>
<li><span class="s2"><a href="https://jmprsp.wordpress.com/2016/09/19/labyrenth-ctf-windows-track-challenge-9">https://jmprsp.wordpress.com/2016/09/19/labyrenth-ctf-windows-track-challenge-9</a></span><span class="s3">/</span></li>
<li class="p2"><span class="s2"><a href="https://github.com/gray-panda/grayrepo/tree/master/2016_labyREnth/win9_delphichal">https://github.com/gray-panda/grayrepo/tree/master/2016_labyREnth/win9_delphichal</a></span></li>
<li class="p2"><span class="s2"><a href="http://sibears.ru/labs/labyrenth2016-win-9/">http://sibears.ru/labs/labyrenth2016-win-9/</a></span></li>
<li class="p2"><span class="s2"><a href="https://github.com/uafio/git/blob/master/scripts/labyREnth-2016/labyrenth-2016-win-9.txt">https://github.com/uafio/git/blob/master/scripts/labyREnth-2016/labyrenth-2016-win-9.txt</a></span></li>
<li class="p2"><span class="s2"><a href="https://github.com/11x256/CTFs/tree/master/2016/LabyREnth/9-Delphi%20challenge">https://github.com/11&#215;256/CTFs/tree/master/2016/LabyREnth/9-Delphi%20challenge</a></span></li>
<li class="p2"><span class="s2"><a href="https://github.com/spartansecurity/Writeups/blob/master/labyrenth2016/windows.md#challenge-9">https://github.com/spartansecurity/Writeups/blob/master/labyrenth2016/windows.md#challenge-9</a></span></li>
</ul>
</div>
            </div>

        </div>       
    </div>
  </article>


<script type="text/javascript">
    $('body').on('mouseover', '.idc_ul_cont_not_liked_inner', function(e) {
          $(this).find('svg').children('path').attr('stroke','#FF2E00');
          //$(this).attr('src','https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/blue-like-icon.png');
      });
      $('body').on('mouseout', '.idc_ul_cont_not_liked_inner', function(e) {
          $(this).find('svg').children('path').attr('stroke','#000000');
          //$(this).attr('src','https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/grey-like-icon.png');
      });
      
    $(document).ready(function(){
        //Moving single post page subscribe box one paragraph above from last
        var cont_width = $(".entry-content").width();
        cont_width = Math.round(cont_width/2);//
        var p_tag_found = false;
        var child_count = $( ".entry-content").children().length;
        var last_p_tag = ''; //2nd p tag 
        var p_tag_traverse_cnt = 0;
        var p_arr = [];
        var next_tag_is_image_container = false;
        for(var i = 0; i < child_count ; i++){
            var p_el = $('.entry-content').children().eq(i);
            /*
            var tag_name = $(p_el).prop('tagName');
            if(tag_name != 'UL' || tag_name == 'P'){
                continue
            }
            */
            
              var temp_text = $(p_el).html();
              temp_text = temp_text.trim();
              
              
              var found_in_child = $( p_el ).find( "img, iframe, video, figure" );
                
              if(temp_text == '&nbsp;' || temp_text == ''){
                 continue;
              }
              else{
                  p_arr.push(p_el);
              }
        }
        console.log(p_arr);
        

        $.each(p_arr, function (index,value) {
            
            if(next_tag_is_image_container){
                next_tag_is_image_container = false;
                return;
            }
            
            var found_img1 = $(p_arr[index]).find( "img, iframe, video, figure" );//finding any image
            var found_txt1 = $(p_arr[index]).text().trim();
            if(found_img1.length != 0 && found_txt1 == ''){//if image exists inside paragraph, with no sibling text
                return;
            }
                
                var p_el = value;
                var current_tag_name = $(p_el).prop('tagName');
                if(current_tag_name == 'IMG' || current_tag_name == 'IFRAME' || current_tag_name == 'VIDEO' || current_tag_name == 'FIGURE'){
                    return;
                }
              
              
                  p_tag_traverse_cnt++;
                  var next_of_p = p_arr[index+1];
                  var next_tag = $(next_of_p).prop('tagName');
                  
                  
                  if(p_tag_traverse_cnt == 3){
                      //If next element is UL, then add subscription box after UL
                      
                      //if next element is image or video, add the box after 3rd paragraph
                      
                      if(next_tag == 'IMG' || next_tag == 'IFRAME' || next_tag == 'VIDEO' || next_tag == 'FIGURE'){
                          //Check if image is not right aligned
                          var img_width = $(next_of_p).width();
                          
                          if(img_width > cont_width){//If image is not right aligned
                              next_tag_is_image_container = true;
                                return;
                          }
                          
                          
                      }
                      //Check if image or video exist as a child element
                      var found_in_child = $( next_of_p ).find( "img, iframe, video, figure" );
                      //console.log(found_in_child[0].width);
                      //console.log(found_in_child);
                      if(found_in_child.length != 0){
                             var img_width = found_in_child[0].width;
                             console.log(img_width+" "+cont_width);
                          if(img_width > cont_width){//If image is not right aligned
                              next_tag_is_image_container = true;
                                return;
                          }
                          
                      }
                      
                      if(next_tag == 'UL' && current_tag_name != 'UL'){
                          last_p_tag = next_of_p;
                          return false;    
                      }
                      else{
                          last_p_tag = p_el;
                          return false;    
                      }
                      
                  }    
                  if(p_tag_traverse_cnt > 3){
                       //If next element is UL, then add subscription box after UL
                      if(next_tag == 'UL' && current_tag_name != 'UL'){
                          last_p_tag = next_of_p;
                          return false;     
                      }
                      else{
                          last_p_tag = p_el;
                          return false;   
                      }
                  }
              
        });
        
        
        if(last_p_tag != ''){
            $( last_p_tag ).after('<div style="clear:both;"></div>',$('.subscribe-form-inner'));
        }
        // $( ".entry-content p:last-child" ).before($('.subscribe-form-inner'));
        
    });
    $('a').each(function() {
        if(this.id == 'share_btn'){
            return;
        }
        var a = new RegExp('/' + window.location.host + '/');
        if(!a.test(this.href)) {
            $(this).click(function(event) {
                event.preventDefault();
                event.stopPropagation();
                window.open(this.href, '_blank');
            });
        }
     });
     $('.comment-form-cookies-consent input[type=checkbox]').prop('checked','checked');
     //$('.form-submit input[type=submit]').after( '<img class="ajax-loader" style="display:none;" src="https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/backgrounds/ajax-loader.gif" alt="Sending ...">' );
     //Hide manage subscription link
     
     if($('.subscribe-to-comments input[type=checkbox]').length == 0){
         $('.subscribe-to-comments').hide();
     }
     
          $('.form-submit input[type=submit]').attr('disabled',true);
          function enableCommentBtn(){
         $('.form-submit input[type=submit]').attr('disabled',false);
     }
     function disableCommentBtn(){
         $('.form-submit input[type=submit]').attr('disabled',true);
     }
    </script>
<div id="search-result-continer" style="display:none;min-height: 343px;">
    <!--<div id="search-result-heading" class="container-fluid container-breadcrumb"  data-aos="fade-in" style="display:none;">
       <div class="container-lg">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="https://blog.paloaltonetworks.com">Palo Alto Networks</a></li>
              <li class="breadcrumb-item search-term"></li>
          </ol>
        </nav>
       </div>
    </div>-->
    <div class="container-fluid container-feed-cards">
        <div class="container-lg">
            <div class="row row-feed">
                <div class="col col-feed">
                    
                    <div id="ajax_loader" class="text-center pb-40 pt-40">
                  <span>Loading...</span>
			</div>
      <div id="notfound2" class="text-center pt-40 pb-40" style="display: none;">Sorry, no results were found.</div>
      
                    <div class="row row-feed articles_container CoveoResultList" data-layout="list" data-wait-animation="fade" data-fields-to-include="@articlecategory, @articleauthor, @articlepublishedtime, @articlecategory, @articleauthorlink, @articledescription, @articlepostimage, @articlepublishedtimestring, @articleauthorimagelink, @articlepostid, @articlepostlength, @articlecategorylink, @uri" data-result-container-selector='#test_id' id="test_id">
                        <script id="customTemplate" type="text/underscore" class="result-template">
            <% JSON.stringify(raw) %>
              <article data-article-id="<% if(typeof raw.articlepostid !== "undefined") { print(raw.articlepostid); } %>" class="feed-card h-100 pan-coveo-search-list">
                <%if (typeof raw.articlepostimage =='undefined') { 
                    raw.articlepostimage = 'https://blog.paloaltonetworks.com/wp-content/uploads/2016/11/blog-generic-banner-1.jpg';
                 } %>
                        
                <%if (typeof raw.articlepostimage !='undefined') { %> 
                <div onclick="location.href='<%= raw.uri %>'" class="feed-card-thumbnail" style="background-image: url(<%= raw.articlepostimage %>);">
                <% if(typeof raw.articlepostid !== "undefined") { %>
                <!--<div class="total_number_view left-bottom"><span class="people-reacted<% if(typeof raw.articlepostid !== "undefined") { print(raw.articlepostid); } %>">#</span> people reacted</div>-->
                <% } %>
                  
                </div>
                <% } %>

                <div class="feed-card-content">
                <p class="label">
                <%  _.each(raw.articlecategory,function(item,key,list) { %> <a <% if(typeof raw.articlepostid == "undefined"){print(' target="_blank"');} %>  href="<% if(typeof raw.articleauthorimagelink !== "undefined"){ print(raw.articlecategorylink[key]); } else{ print("#");}  %>" class="author url fn" rel="author"><%= item %></a><%if (key+1 < raw.articlecategory.length) { %>,<%  } %><%  }); %>
                            </p>
                  <h3><a <% if(typeof raw.articlepostid == "undefined"){print(' target="_blank"');} %> class="CoveoResultLink"><% var title_article = title.substr(0,75); print(title_article); var title_length = title.length; if(title_length > 75){print("...")} %></a></h3>
                  </div>
                  
                  <div class="feed-card-metadata">
			<div class="metadata-thumbnail">
			<div class="metadata-thumbnail-author">
	  		<img src="<% if(typeof raw.articleauthorimagelink !== "undefined"){ var image_link = raw.articleauthorimagelink[0]; if(image_link.indexOf("unit42.paloaltonetworks.com") != -1 ){ print("https://blog.paloaltonetworks.com/wp-content/themes/PaloAltoNetworksBlog/dist/images/unit42-logo1.jpg");} else{ print(image_link);} }else{ print("https://blog.paloaltonetworks.com/wp-content/uploads/2016/10/Social_BlogIcon_10.13.16.png"); } %>" width="75" height="75" alt="Avatar" class="avatar avatar-75 wp-user-avatar wp-user-avatar-75 photo avatar-default">			</div>
		</div>
		
		<div class="metadata-author">
                    <span class="author-name">
				By <%  _.each(raw.articleauthor,function(item,key,list) { %> <a <% if(typeof raw.articlepostid == "undefined"){print(' target="_blank"');} %> title="Posts by <%= item %>" href="<%= raw.articleauthorlink[key] %>" class="author url fn" rel="author"><%= item %></a><%if (key+1 < raw.articleauthor.length) { %><%if (key+1 == raw.articleauthor.length-1) { %> and <% } else { %>,<% } } %><%  }); %>                        <br>
                        <time datetime="<%= raw.articlepublishedtimestring %>"><%= raw.articlepublishedtimestring %></time>
                        <br>
                       <% if(typeof raw.articlepostlength !== "undefined"){ print(Math.ceil(raw.articlepostlength/200) + " min. read"); } %>
                    
                    </span>
		</div>
    <div class="metadata-likes ldc-ul_cont idc_ul_cont_not_liked" onclick="<%  print("alter_ul_post_values(this,'"+ raw.articlepostid +"','like')"); %>">
        
        <svg class=" " width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M4.74998 15.9999H2.49999C2.10217 15.9999 1.72064 15.8419 1.43934 15.5606C1.15803 15.2793 1 14.8977 1 14.4999V9.24995C1 8.85213 1.15803 8.4706 1.43934 8.18929C1.72064 7.90799 2.10217 7.74996 2.49999 7.74996H4.74998M9.99994 6.24997V3.24999C9.99994 2.65325 9.76289 2.08096 9.34094 1.65901C8.91898 1.23705 8.34669 1 7.74996 1L4.74998 7.74996V15.9999H13.2099C13.5717 16.004 13.9227 15.8772 14.1983 15.6429C14.474 15.4086 14.6557 15.0826 14.7099 14.7249L15.7449 7.97496C15.7775 7.75997 15.763 7.54047 15.7024 7.33165C15.6418 7.12283 15.5365 6.92968 15.3938 6.7656C15.2511 6.60151 15.0745 6.47041 14.8761 6.38138C14.6777 6.29234 14.4623 6.2475 14.2449 6.24997H9.99994Z" stroke="#727272" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                </svg>
                                <span class="<%  print("article-like-id"+raw.articlepostid);  %>"></span></span>
        
    </div>
	
</div>
              </article>
          </script>
          
                </div>     
                      <div class="col">
	
          <div class="loadmore text-center loadmore_main" style="display: none;">
      <button type="button" class="btn  load_more_btn" data-firstres="0">Load more</button>
    </div>
                    </div>
                      <div class="container" style="display: none;">
  
               

    <!-- Each DOM element with a class starting with "coveo-" (lowercase) is for CSS or alignment purpose only. -->
    <div class='coveo-search-section'>
      <div class="coveo-results-column">
        <!--selected breadcrumb-->
        <div class="CoveoBreadcrumb">
          <div class="coveo-breadcrumb-clear-all" title="Clear All Filters" tabindex="0">
            <div class="coveo-icon coveo-breadcrumb-icon-clear-all"></div>
            <div>Clear </div>
          </div>
        </div>
        <span class="CoveoSort coveo-sort-selection" data-sort-criteria="@articlepublishedtime descending" data-caption="Date"></span>
        <div class="coveo-results-header">
          <div class="coveo-summary-section">
            <span class="CoveoQuerySummary"></span>
          </div>
        </div>
      </div>
    </div>
                      </div>
      
          
            </div>
        </div>            
    </div>
</div>
</div>

<script type="text/javascript">
    document.write(str_subscription);
</script>
<section class="pan-mega-footer">
    <div class="container">
        <div class="row pan-mega-footer-links">
            <div class="col-xs-12 col-sm-4 col-md-3">
                <div class="footerTitle1 title baseComponent parbase">
                    <p>Popular Resources</p>
                </div>
                <div class="footerList1 list baseComponent parbase">
                    <ul class=" list-unstyled">
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Popular Resources:Blog" href="https://blog.paloaltonetworks.com/">Blog</a>
                        </li>
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Popular Resources:Careers" href="https://jobs.paloaltonetworks.com/">Careers</a>
                        </li>
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Popular Resources:Communities" href="https://www.paloaltonetworks.com/communities">Communities</a>
                        </li>
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Popular Resources:Content Library" href="https://www.paloaltonetworks.com/resources">Content Library</a>
                        </li>
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Popular Resources:Cyberpedia" href="https://www.paloaltonetworks.com/cyberpedia">Cyberpedia</a>
                        </li>
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Popular Resources:Event Center" href="https://events.paloaltonetworks.com">Event Center</a>
                        </li>
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Popular Resources:Investors" href="https://investors.paloaltonetworks.com/investor-relations/overview/default.aspx">Investors</a>
                        </li>
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Popular Resources:Tech Docs" href="https://docs.paloaltonetworks.com/">Tech Docs</a>
                        </li>
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Popular Resources:Unit 42" href="https://unit42.paloaltonetworks.com/">Unit 42</a>
                        </li>
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Popular Resources:Sitemap" href="https://www.paloaltonetworks.com/sitemap">Sitemap</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-xs-12 col-sm-4 col-md-3">
                <div class="footerTitle2 title baseComponent parbase">
                    <p>Legal Notices</p>
                </div>
                <div class="footerList2 list baseComponent parbase">
                    <ul class=" list-unstyled">
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Legal Notices:Privacy" href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy</a>
                        </li>
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Legal Notices:Trust Center" href="https://www.paloaltonetworks.com/legal-notices/trust-center">Trust Center</a>
                        </li>
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Legal Notices:Terms of Use" href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a>
                        </li>
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Legal Notices:Documents" href="https://www.paloaltonetworks.com/legal">Documents</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-xs-12 col-sm-4 col-md-3">
                <div class="footerTitle3 title baseComponent parbase">
                    <p>Account</p>
                </div>
                <div class="footerList3 list baseComponent parbase">
                    <ul class=" list-unstyled">
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Account:Manage Subscriptions" href="https://start.paloaltonetworks.com/preference-center">Manage Subscriptions</a>
                        </li>
                    </ul>
                </div>
                <div class="vulnerabilityHtml html baseComponent parbase">
                    <div style="margin-top: 30px">
                        <a href="https://www.paloaltonetworks.com/security-disclosure" style="color: #C63F24; font-family: Arial,sans-serif; font-size: 14px; font-style: normal; font-weight: normal; line-height: normal">Report a Vulnerability</a>
                    </div>
                </div>
            </div>
            <div class="col-xs-12 col-sm-12 col-md-3 footer-social-col">
                <div class="content">                
                    <ul class="list-inline">
                        <li class="list-inline-item">
                            <a href="https://www.facebook.com/PaloAltoNetworks/" target="_blank"><img alt="Facebook" class="lozad" data-loaded="true" data-src="https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/svg/Facebook-black.svg" src="https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/svg/Facebook-black.svg"></a>
                        </li>
                        <li class="list-inline-item">
                            <a href="https://www.linkedin.com/company/palo-alto-networks" target="_blank"><img alt="Linkedin" class="lozad" data-loaded="true" data-src="https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/svg/Linkedin-black.svg" src="https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/svg/Linkedin-black.svg"></a>
                        </li>
                        <li class="list-inline-item">
                            <a href="https://twitter.com/PaloAltoNtwks" target="_blank"><img alt="Twitter" class="lozad" data-loaded="true" data-src="https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/svg/Twitter-black.svg" src="https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/svg/Twitter-black.svg"></a>
                        </li>
                        <li class="list-inline-item">
                            <a href="https://www.youtube.com/user/paloaltonetworks" target="_blank"><img alt="Youtube" class="lozad" data-loaded="true" data-src="https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/svg/Youtube-black.svg" src="https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/svg/Youtube-black.svg"></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section>
<footer class="pan-footer">
    <div class="container">
        <span><p>&copy; 2020 Palo Alto Networks, Inc. All rights reserved.<br></p>
        </span>
    </div>
</footer>
<div class="CoveoSearchbox" data-enable-search-as-you-type="false" data-enable-omnibox="true" data-omnibox-timeout="1000" data-placeholder="Search the blog" data-enable-query-suggest-addon="false" data-trigger-query-on-clear="true" id="pan-coveo-input" style="display: none;"></div>



<script type="text/javascript">
    jQuery('body').attr('data-pipeline', "New Research Center Pipeline");
    var timerIsCoveoDefined = '';
    var resultTotalCount;
    //var root = document.getElementById('coveo-container');
    var root = document.body;
    var isloadCoveoLibraryCalled = false;
    var screenwidth = window.screen.width;
    var isIE11 = !!navigator.userAgent.match(/Trident.*rv\:11\./);
    var topSearch = true;
    //Coveo code
    function loadCoveoLibrary() {
        if (isloadCoveoLibraryCalled) {
            return;
        }
        isloadCoveoLibraryCalled = true;
        $.getScript("https://static.cloud.coveo.com/searchui/v2.3679/js/CoveoJsSearch.Lazy.min.js");
        timerIsCoveoDefined = setInterval(isCoveoDefined, 1000);
    }
    function isCoveoDefined() {
        if (typeof Coveo !== 'undefined') {
            console.log("Coveo object is now defined.")
            executeCoveoSearch();
            clearInterval(timerIsCoveoDefined);
            $('#postSearch1, #postSearch2').attr('title', '');
            $('#postSearch1, #postSearch2').prop("readonly", false);
            $('.dropdown-menu a').css('pointer-events','auto');
        }
    }
    function executeCoveoSearch() {

        var settings = {
            "async": false,
            "url": "https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/coveosearch.getaccesstoken.php",
            //"url": "https://www.paloaltonetworks.com/apps/pan/public/coveosearch.getaccesstoken.json",
            "method": "GET",
        }


        jQuery.ajax(settings).done(function (response) {

            Coveo.SearchEndpoint.endpoints['default'] = new Coveo.SearchEndpoint({
                restUri: 'https://platform.cloud.coveo.com/rest/search',
                queryStringArguments: {
                    organizationId: 'paloaltonetworksintranet'                    
                },
                accessToken: response.token
            });
            Coveo.$$(root).on("querySuccess", function (e, data) {
                //console.log(data.query.q);
                if(!$('#searching').val()){
                    topSearch = false;
                }
                
                if(topSearch){
                    $([document.documentElement, document.body]).animate({
                        scrollTop: 0 
                    }, 1000);
                }
                
                if(topSearch){
                    $('nav.navbar li a.active').removeClass('active');
                }
                resultTotalCount = data.results.totalCount;
                //document.title = "Palo Alto Networks Blog";
                /*
                if(resultTotalCount > 0){
                    $('#search-result-heading .search-term').text(capitalizeFirstLetter(data.query.q));
                    $('#search-result-heading').show();
                }
                else{
                    $('#search-result-heading').hide();
                    $('#search-result-heading .search-term').text('');
                }
                */

            });
            Coveo.$$(root).on("newResultsDisplayed", function (e, args) {
                $('#ajax_loader').hide();
                $('#notfound2').hide();
                $('.load_more_btn').html('Load more');
                $('.load_more_btn').prop('disabled', false);
                $('.CoveoResult').addClass('col-xs-12 col-sm-6 col-md-6 col-lg-4 col-xl-4 col-feed-card grid-item');
                var article_ids = new Array();
                jQuery.each(jQuery('.pan-coveo-search-list'), function (i) {
                    var article_id_tmp = $(this).data("article-id");
                    if (article_id_tmp != '' && !jQuery(this).hasClass('num-like-retrieved')) {
                        article_ids.push(article_id_tmp);
                    }
                    if (article_id_tmp != '') {
                        //If this article is liked, make the thumb icon to blue
                        var article_liked_list = [];
                        var like_found = $.inArray(article_id_tmp, article_liked_list);
                        if (like_found != -1) {
                            $(this).find('.ldc-ul_cont').find('svg').children('path').attr('stroke', '#FF2E00');
                            $(this).find('.ldc-ul_cont').removeClass('idc_ul_cont_not_liked');
                        }
                    }
                });
                if (article_ids.length > 0) {
                    var saveData = $.ajax({
                        type: 'POST',
                        url: wp_vars.ajax_url,
                        data: {action: 'fetch_total_article_likes', article_ids_arr: JSON.stringify(article_ids)},
                        dataType: "json",
                        success: function (resultData) {
                            //var article_likes = JSON.parse(resultData);
                            jQuery.each(article_ids, function (i, val) {
                                $('.article-like-id' + val).text(resultData[val][0]);
                                //$('.people-reacted'+val).text(resultData[val][1]);
                                $('.article-like-id' + val).closest(".pan-coveo-search-list").addClass('num-like-retrieved');
                            });
                        }
                    });
                }
                //console.log($('.CoveoResult').length +'|'+ resultTotalCount);
                //console.log(Coveo.state(root, 'first'));
                if ($('.CoveoResult').length >= resultTotalCount) {
                    $('.load_more_btn').hide();
                } else {
                    $('.load_more_btn').show();
                }
                if (resultTotalCount <= 0) {
                    $('#notfound2').show();
                } else {
                    $('#notfound2').hide();
                }
                
                if (jQuery('.magic-box-input input').val() || $('.CoveoResult').length >= 1) {
                    if(topSearch){
                        jQuery('#main-container').hide();
                        $('#inner_cards').show();
                        jQuery('.loadmore_main2').hide();
                        jQuery('#search-result-continer').show();
                        jQuery('.loadmore_main').show();
                        $('#main-container .container-feed-cards .container-lg').removeAttr('style');
                        $('#search-result-continer .container-feed-cards .container-lg').removeAttr('style');
                    }
                    else{
                        jQuery('#main-container').show();
                        $('#inner_cards').hide();
                        jQuery('.loadmore_main2').hide();
                        jQuery('#search-result-continer').show();
                        jQuery('.loadmore_main').show();
                        $('#main-container .container-feed-cards .container-lg').attr('style','padding-bottom: 0;');
                        $('#search-result-continer .container-feed-cards .container-lg').attr('style','padding-top: 0;');
                    }
                } else {
                    jQuery('#search-result-continer').hide();
                    jQuery('.loadmore_main').hide();
                    $('#inner_cards').show();
                    jQuery('#main-container').show();
                    jQuery('.loadmore_main2').show();
                }
            });
            //Coveo.state(root, 'numberOfResults',9);
            //Coveo.state(Coveo.$$(document).find(".magic-box-input input"), 'f:@articlecategory' , 'Secure the Cloud');
            Coveo.SearchInterface.options.autoTriggerQuery.defaultValue = false;
            Coveo.init(root);
        });
    }

    $('body').on('blur', '.magic-box-input input, #postSearch1', function (e) {
        var has_hash = false;
        if (window.location.hash.length) {
            has_hash = true;
        }
        var to_append = '';
        if (has_hash) {
            to_append = window.location.hash.replace('#', '');
            to_append = '#' + to_append;
        }
        window.history.replaceState(null, null, "?search_field=" + $(this).val() + to_append);
    });

    $('.load_more_btn').on('click', function () {
        //Coveo.SearchEndpoint.endpoints["default"].options.queryStringArguments.numberOfResults = 8;
        load_more_clicked = true;

        var this_btn = $(this);
        $(this).addClass('is-clicked');
        $(this).html('Loading...');
        $(this).prop('disabled', true);
        //jQuery('.articles_container').masonry('reloadItems').masonry();
        //Coveo.SearchEndpoint.endpoints["default"].options.queryStringArguments.numberOfResults = 8;
        //Coveo.state(root, 'firstResult',$('.CoveoResult').length - 1);
        Coveo.$('.CoveoResultList').coveo('displayMoreResults', 9);
        //Coveo.SearchEndpoint.endpoints["default"].options.queryStringArguments.numberOfResults = 9;
        setTimeout(function () {
            this_btn.removeClass('is-clicked');
        }, 1900);
    });
    var interval;
    var timer2;

    if (isIE11) {
        executeCoveoSearch();
    }




    var captcha_rendered = false;
    var subscribeSuccess = false;

    jQuery('body').on('change paste keyup', '.business_email_bot', function () {
        jQuery(this).closest('form').find('.google-recapth').removeClass('d-none');
    });

    $('body').on('mouseover', '.idc_ul_cont_not_liked', function (e) {
        $(this).find('svg').children('path').attr('stroke', '#FF2E00');
        //$(this).attr('src','https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/blue-like-icon.png');
    });
    $('body').on('mouseout', '.idc_ul_cont_not_liked', function (e) {
        $(this).find('svg').children('path').attr('stroke', '#727272');
        //$(this).attr('src','https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/grey-like-icon.png');
    });




    $(document).ready(function () {
        getSerializedTracking("Unit42_Subscribe");

    });
    $('body').click(function () {
        $('.CoveoDidYouMean').hide();
    });

    jQuery('body').on('change paste keyup', '.business_email', function () {
        //console.log($('#captcha_container2').children().length);
        if ($('#captcha_container').length == 1 && $('#captcha_container').children().length == 0) {
            console.log("cap1");
            var loadCaptcha = function () {
                captchaContainer = grecaptcha.render('captcha_container', {
                    'sitekey': '6LeyHGkUAAAAAEwfqwKWxNqdht3xjSNf-j3bK7l2',
                    'callback': function (response) {
                        $("form[name='Unit42_Subscribe'] button[type='submit']").prop('disabled', false);
                        subscribeSuccess = true;
                    },
                    'expired-callback' : function(){
                        $("form[name='Unit42_Subscribe'] button[type='submit']").prop('disabled', true);
                        subscribeSuccess = false;
                    }
                });
            }
            loadCaptcha();
        }
        /*
        if ($('#captcha_container2').length == 1 && $('#captcha_container2').children().length == 0) {
            console.log("cap2");
            var loadCaptcha2 = function () {
                captchaContainer = grecaptcha.render('captcha_container2', {
                    'sitekey': '6LeyHGkUAAAAAEwfqwKWxNqdht3xjSNf-j3bK7l2',
                    'callback': function (response) {
                        $("form[name='contact_sales_modal'] input[type='submit']").prop('disabled', false);
                        subscribeSuccess = true;
                    }
                });
            }

            loadCaptcha2();
        }
        */
        setTimeout(function () {
            jQuery('#row-recatcha').removeClass('d-none');
            //jQuery('.articles_container').masonry('layout');
        }, 50);
    });


    jQuery('body').on('submit', 'form.subscribe-form', function () {
        var success = true;
        var form = jQuery(this);
        var mail = form.find('input[name="Email"]');
        if (mail.val() === '' || !isEmail(mail.val())) {
            mail.closest("form").addClass('has-error');
            success = false;
        } else {
            mail.closest("form").removeClass('has-error');
        }

        if (success && subscribeSuccess) {
            $.ajax({
                type: 'POST',
                url: form.attr('action'),
                data: form.serialize(),
                success: function (msg) {
                    form.html('<p style="color: #0c6;">You have been successfully subscribed</p>');
                    //masonry.masonry('layout');
                }
            });
        }
        return false;
    });


    function isEmail(email) {
        var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(String(email).toLowerCase());
    }


    $(document).ready(function () {
        //$('body').attr('data-results-per-page', '9');
        $("#dropdownMenuButton").click(function(){
            if (typeof Coveo === 'undefined') {
                //$(".dropdown-menu a").attr('disabled',"disabled");
                $('.dropdown-menu a').css('pointer-events','none');
                loadCoveoLibrary();
            }
        });
        
        $(".dropdown-menu a").click(function(e){
            $(this).parents(".dropdown").find('.btn').html($(this).text());
            $(this).parents(".dropdown").find('.btn').val($(this).data('value'));
            topSearch = false;
            e.preventDefault(); 
        });
        
        /**
         $('img').each(function() {
         var path = $(this).attr('src');
         $(this).attr('src', path.replace("http://blog-localhost.paloaltonetworks.com/wp-content/upload", "https://blog.paloaltonetworks.com/wp-content/upload"));
         });
         $('figure').each(function() {
         var path = $(this).attr('style');
         if (typeof path !== 'undefined'){
         $(this).attr('style', path.replace("http://blog-localhost.paloaltonetworks.com/wp-content/upload", "https://blog.paloaltonetworks.com/wp-content/upload"));
         }
         });
         * 
         */
        
        $(".pan-page-alert-close").click(function(){
            $("#nav-mobile").css("top", "72px");
          });
          $("#feed-clear").click(function(){
              //$('#mostRecentTab').trigger('click');
            $('#postSearch2').val('');
            $('#sec-search-clear').hide();
            jQuery('#search-result-continer').hide();
            jQuery('.loadmore_main').hide();
            $('#inner_cards').show();
            jQuery('#main-container').show();
            jQuery('.loadmore_main2').show();
            $('#main-container .container-feed-cards .container-lg').removeAttr('style');
            
            
            $('.col-feed-filter #dropdownMenuButton').val("Most Recent");
            $('.col-feed-filter #dropdownMenuButton').html("Most Recent");
            $('#mostRecentTab').addClass('coveo-selected');
            $('#mostPopularTab').removeClass('coveo-selected');
         
            
          });
          

        $('#postSearch2').focus(function () {
            if (typeof Coveo === 'undefined') {
                //$('#postSearch1, #postSearch2').attr('title', 'Loading...please wait');
                $('#postSearch1, #postSearch2').prop("readonly", true);
                loadCoveoLibrary();
            }
        });
        $('body').on('keyup', '#postSearch1, #postSearch2', function (e) {
            //cur_search_txt = jQuery('.magic-box-input input').val(); 
            if(this.id == 'postSearch2'){
                topSearch = false;
            }
            else{
                topSearch = true;
            }
            var typed_text;
            if(topSearch){
                typed_text = $('#postSearch1').val();
            }
            else{
                typed_text = $('#postSearch2').val();
                if((typed_text.length > 0) ){
                    $('#sec-search-clear').show();
                    //$('#feed-search').prop('disabled', false);
                }
                else{
                    $('#sec-search-clear').hide();
                    //$('#feed-search').prop('disabled', true);
                }
            }
            
            
            $('.magic-box-input input').val(typed_text);
            if ((typed_text.length > 0) && e.keyCode === 13) {
                if(topSearch && !$('#searching').val()){
                    location.href='https://blog.paloaltonetworks.com?search_field='+typed_text;
                    return;
                }
                //enterKeyPressed = true;
                if (screenwidth < 992) {
                    if(topSearch){
                    mobileToggle();
                }
                }
                $('.CoveoSearchButton').click();
            }
        });
    });
</script>


    <script type="text/javascript">
	var isProcessing = false; 
    function alter_ul_post_values(obj,post_id,ul_type){
	
		if (isProcessing)    
		return;  
		isProcessing = true;   
		
		jQuery(obj).find("span").html("..");
                jQuery.ajax({
                    type: "POST",
                    url: "https://blog.paloaltonetworks.com/wp-content/plugins/like-dislike-counter-for-posts-pages-and-comments/ajax_counter.php",
                    data: "post_id="+post_id+"&up_type="+ul_type,
                    success: function(msg){
                            jQuery(obj).find("span").html(msg);
                            isProcessing = false; 
                            jQuery(obj).find('svg').children('path').attr('stroke','#FA582D');
                            jQuery(obj).removeClass('idc_ul_cont_not_liked idc_ul_cont_not_liked_inner');
                    }
 		});
	}
	</script>
    <script type='text/javascript'>
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/blog.paloaltonetworks.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"}};
/* ]]> */
</script>
<script type='text/javascript' src='https://blog.paloaltonetworks.com/wp-content/plugins/contact-form-7/includes/js/scripts.js'></script>
<script type='text/javascript' src='https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/scripts/popper.min.js'></script>
<script type='text/javascript' src='https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/scripts/bootstrap.min.js'></script>
<script type='text/javascript' src='https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/scripts/aos.js'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wp_vars = {"ajax_url":"https:\/\/blog.paloaltonetworks.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/scripts/masonry2.js?v2'></script>
<script type='text/javascript' src='https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/scripts/main.js'></script>
<script type='text/javascript' src='https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/scripts/jquery.cookie.js'></script>
<script type='text/javascript' src='https://blog.paloaltonetworks.com/wp-includes/js/wp-embed.min.js'></script>
  </body>
</html>

