
<!doctype html>
<html >
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-16x16.png">
	<link rel="manifest" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/site.webmanifest">
	<link rel="mask-icon" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/safari-pinned-tab.svg" color="#000000">
	<meta name="msapplication-TileColor" content="#000000">
	<meta name="theme-color" content="#000">
  <title>HenBox: Inside the Coop</title>
<link rel="alternate" hreflang="en" href="https://unit42.paloaltonetworks.com/unit42-henbox-inside-coop/" />

<!-- This site is optimized with the Yoast SEO plugin v12.6.2 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="description" content="Unit 42 goes inside the coop with new analysis and additional information on malicious HenBox applications"/>
<meta name="robots" content="max-snippet:-1, max-image-preview:large, max-video-preview:-1"/>
<link rel="canonical" href="https://unit42.paloaltonetworks.com/unit42-henbox-inside-coop/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="HenBox: Inside the Coop" />
<meta property="og:description" content="Unit 42 goes inside the coop with new analysis and additional information on malicious HenBox applications" />
<meta property="og:url" content="https://unit42.paloaltonetworks.com/unit42-henbox-inside-coop/" />
<meta property="og:site_name" content="Unit42" />
<meta property="article:tag" content="9002" />
<meta property="article:tag" content="Android" />
<meta property="article:tag" content="AutoFocus" />
<meta property="article:tag" content="HenBox" />
<meta property="article:tag" content="PlugX" />
<meta property="article:tag" content="Poison Ivy" />
<meta property="article:tag" content="Zupdax" />
<meta property="article:section" content="Unit 42" />
<meta property="article:published_time" content="2018-04-26T02:00:44+00:00" />
<meta property="article:modified_time" content="2019-01-28T14:15:20+00:00" />
<meta property="og:updated_time" content="2019-01-28T14:15:20+00:00" />
<meta property="og:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/unit42-blog-600x300.jpg" />
<meta property="og:image:secure_url" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/unit42-blog-600x300.jpg" />
<meta property="og:image:width" content="600" />
<meta property="og:image:height" content="300" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:description" content="Unit 42 goes inside the coop with new analysis and additional information on malicious HenBox applications" />
<meta name="twitter:title" content="HenBox: Inside the Coop" />
<meta name="twitter:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/unit42-blog-600x300.jpg" />
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//www.google.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Unit42 &raquo; HenBox: Inside the Coop Comments Feed" href="https://unit42.paloaltonetworks.com/unit42-henbox-inside-coop/feed/" />
<meta property="og:likes" content="4"/>
<meta property="og:readtime" content="19"/>
<meta property="og:views" content="27,348"/>
<meta property="og:date_created" content="April 26, 2018 at 5:00 AM"/>
<meta property="og:post_length" content="5388"/>
<meta property="og:category" content="Unit 42"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/unit42/"/>
<meta property="og:author" content="Alex Hinchliffe"/>
<meta property="og:author" content="Mike Harbison"/>
<meta property="og:author" content="Jen Miller-Osborn"/>
<meta property="og:author" content="Tom Lancaster"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/alex-hinchliffe/"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/mike-harbison/"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/jen-miller-osborn/"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/tom-lancaster/"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<meta property="og:popular" content="true"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"BlogPosting","headline":"HenBox: Inside the Coop","name":"HenBox: Inside the Coop","description":"Unit 42 goes inside the coop with new analysis and additional information on malicious HenBox applications","url":"https:\/\/unit42.paloaltonetworks.com\/unit42-henbox-inside-coop\/","mainEntityOfPage":"https:\/\/unit42.paloaltonetworks.com\/unit42-henbox-inside-coop\/","datePublished":"April 26, 2018","articleBody":"Summary\r\nOn March 13, 2018, we published a blog describing a new Android malware family we discovered and called \u201cHenBox\u201d based on metadata found in most of the malicious apps. HenBox apps masquerade as others such as VPN apps, and Android system apps; some apps carry legitimate versions of other apps which they drop and install as a decoy technique. While some of legitimate apps HenBox uses as decoys can be found on Google Play, HenBox apps themselves are found only on third-party (non-Google Play) app stores.\r\nHenBox apps appear to primarily target the Uyghurs \u2013 a Turkic ethnic group living mainly in the Xinjiang Uyghur Autonomous Region in North West China.\r\nHenBox has ties to infrastructure used in targeted attacks, with a focus on politics in South East Asia. These attackers have used additional malware families in previous activity dating to at least 2015 that include PlugX, Zupdax, 9002, and Poison Ivy.\r\nHexBox apps target devices made by Chinese consumer electronics manufacture, Xiaomi and those running MIUI, Xiaomi\u2019s operating system based on Google Android. Furthermore, the malicious apps register their intent to process certain events broadcast on compromised devices in order to execute malicious code. This is common practice for many Android apps, however, HenBox sets itself up to trigger based on alerts from Xiaomi smart-home IoT devices, and once activated, proceeds in stealing information from a myriad of sources, including many mainstream chat, communication and social media apps. The stolen information includes personal and device information.\r\nThe main purpose of this follow-up blog is to provide additional information, and detailed analysis, about HenBox apps.\r\n\r\nDelivery and Installation\r\nDuring our investigation, we discovered one HenBox app previously hosted on the third-party Android app store, \u201cuyghurapps[.]net\u201d. This HenBox variant masqueraded as the legitimate VPN application, \u201cDroidVPN\u201d, and carried the app as an asset, embedded within itself. Once HenBox installs on a compromised device, it begins the installation process for the legitimate DroidVPN.\r\nAt the time of writing, we are unaware of any HenBox apps hosted on other third-party app stores; given the high volume of HenBox apps analyzed in our Wildfire sandbox, we can only speculate as to how other apps are delivered to victims; much of the Android malware seen in the wild tends to be delivered via third-party app stores, forums and file-sharing platforms, and of course by via ubiquitous phishing emails.\r\n\r\nHenBox Decoys\r\nFurther analysis of the HenBox malware family is below, however, on the subject of masquerading apps, and installing embedded apps, it\u2019s worth explaining how this decoy technique works.\r\nThe HenBox variant being described here relates to that listed in Table 1, below, which masquerades as DroidVPN; other apps were used with decoys, and are described in more detail in the previous blog.\r\n\r\n\r\n\r\nAPK SHA256\r\nSize (bytes)\r\nFirst Seen\r\nApp Package name\r\n\u00a0\r\nApp name\r\n\r\n\r\n0589bed1e3b3d6234c30061be3be1cc6685d786ab3a892a8d4dae8e2d7ed92f7\r\n2,740,860\r\nMay 2016\r\ncom.android.henbox\r\nDroidVPN\r\n\r\n\r\n\r\nTable 1 HenBox variant using decoy techniques\r\nOnce HenBox is installed, and launched by the victim, the app starts the installation process of the legitimate, embedded app by executing the following code.\r\nIntent localIntent = new Intent(\"android.intent.action.VIEW\");\r\nlocalIntent.setDataAndType(Uri.fromFile(new File(str)), DaemonServer.a(new char[] { 56, 41, 41, 53, 48, 58, 56, 45, 48, 54, 55, 118, 47, 55, 61, 119, 56, 55, 61, 43, 54, 48, 61, 119, 41, 56, 58, 50, 56, 62, 60, 116, 56, 43, 58, 49, 48, 47, 60 }));\r\nstartActivity(localIntent);\r\n\r\nHaving created a new intent - android.intent.action.VIEW - at run-time, as opposed to declared statically in the app\u2019s AndroidManifest.xml, the remaining code configures parameters relating to the embedded decoy app. The first argument to setDataAndType() contains said decoy app\u2019s filename \u2013 res.apk \u2013 referenced as \u201cstr\u201d.\r\nMethod a() of the DaemonServer class contains an XOR routine to decode the byte string argument using, in this case, a single-byte key 0x59. The following code snippet shows the decoded output used as the second argument to setDataAndType();\r\napplication\/vnd.android.package-archive\r\nThe decoded string shown above represents the Multipurpose Internet Mail Extensions (MIME) type associated with APK (Android app package) files.\r\nCalling startActivity() with this intent configuration triggers Android to provide a handler \u2013 most likely the app package manager \u2013 that would prompt the victim to install the embedded application. Given, in this case, the victim most likely intended to install a VPN app, this secondary install for that app should come as no surprise, however, it\u2019s likely the HenBox installation process would have also occurred and may have been more suspicious. Potential victims are likely lured into installing the apps through the use of app names, iconography, or other similar traits to those apps being sought; some HenBox apps purport to be system or back-up apps that may appear plausible to the victim.\r\n\r\nInside the Coop -HenBox Analysis\r\nThe following description is based on the HenBox app listed in Table 3 below. The reason for choosing this app for more detailed analysis, was the significant ties to infrastructure seen also having hosted Windows malware, such as PlugX.\r\n\r\n\r\n\r\nSHA256\r\nPackage Name\r\nApp Name\r\nFirst seen\r\n\r\n\r\na6c7351b09a733a1b3ff8a0901c5bde\r\nfdc3b566bfcedcdf5a338c3a97c9f249b\r\ncom.android.henbox\r\n\u5907\u4efd (Backup)\r\nAug 29th 2017\r\n\r\n\r\n\r\nTable 2 HenBox variant used in description\r\nThe majority of HenBox apps, including this one, used the following developer signature information to sign the APK file.\r\nCN=henbox, OU=henbox, O=henbox, L=Guangzhou, ST=Guangdong, C=CN\r\nA smaller subset of HenBox apps used the \u201cAndroid Debug\u201d signature used typically when developers are testing their development. This shortcut is used to sign malicious apps, rather than the adversary creating their own signature, however there can be limitations as to where the app can be hosted and installed when using it. Recent HenBox apps have the common name (CN) changed to \u201ch123enbox\u201d or the entire signature as, simply, \u201cC=cn\u201d, where \u2018C\u2019 is the certificate attribute for Country.\r\nThe following figures illustrate the structure of a typical HenBox app, how they are delivered, and the app behavior once installed.\r\n\r\n\r\nFigure 1 HenBox app delivery and structure\r\nIn Figure 1 we included three methods for delivering HenBox commonly used by threat actors to deliver Android malware: websites, such as forums, phishing emails, and third-party app stores. It is likely HenBox is also delivered via the same methods. However, as previously mentioned, we do not have current visibility into delivery methods other than third-party app stores, for which we saw one instance.\r\nTo our knowledge, user interaction is required to install HenBox apps. Given the third-party app store we observed serving HenBox, and the decoy apps used, it\u2019s clear the adversary relies heavily on social engineering techniques to compromise their victims.\r\nMost HenBox apps seen to date contain a similar structure of files and components within the APK package. Optionally, as shown with the dotted line in Figure 2, and as described with the DroidVPN example earlier, HenBox apps may include an embedded APK file for use as a decoy. Another example of this is a HenBox sample that purports to be the popular online video platform iQiyi. That platform has over 500 million unique users, almost half of which are mobile viewers, providing yet another popular decoy app with which to social engineer potential victims.\r\nFigure 1 above describes the structure of the HenBox app listed in Table 2 above. The numbered components from Figure 1 are listed in more detail in Table 3 below and described afterwards. Some of the components are RC4 encrypted using the downloaded-string key \u201ca85fe5a8\u201d; other components are XOR-encoded using various key values. Native libraries, in the form of Executable and Linkable Format (ELF) files, are common to HenBox samples and the Java Native Interface (JNI) allows the Android app components to communicate with and execute functions in these libraries.\r\n\r\n\r\n\r\n#\r\nFilename\r\nObfuscation\r\nCompression\r\nType\r\nPurpose\r\n\r\n\r\n1\r\n.\/assets\/b.dat\r\nRC4(Zlib)\r\nELF\r\nInteracts with other components inside the a.zip archive.\r\n\r\n\r\n2\r\n.\/lib\/&lt;cpu&gt;\/liblocsdk.so\r\nN\/A\r\nELF\r\nBaidu library for device geo-location data.\r\n\r\n\r\n3\r\n.\/lib\/&lt;cpu&gt;\/libloc4d.so\r\nN\/A\r\nELF\r\nHandlies RC4 decryption, Zlib decompression and HTTP network communication.\r\n\r\n\r\n4\r\n.\/assets\/sux (and suy)\r\nXOR (0x51)\r\nELF\r\nContains embedded SU (Super User) and other root-related capabilities to run privileged commands; Harvests messages and other private data from popular messaging and social media apps.\r\n\r\n\r\n5\r\n.\/classes.dex\r\nN\/A\r\nDEX\r\nMain Dalvik file containing Java for HenBox\r\n\r\n\r\n6\r\n.\/assets\/setting.txt\r\nXOR (0x88)\r\nData\r\nConfig file containing C2 and other information\r\n\r\n\r\n7\r\n.\/assets\/daemon\r\nN\/A\r\nELF\r\nStarts services, monitors environment settings and system logs.\r\n\r\n\r\n8\r\n.\/assets\/a.zip\r\nRC4(ZIP)\r\nArchive\r\nZip archive containing two files\r\n\r\n\r\n9\r\n.\/assets\/a.zip\/libkernel.so\r\nN\/A\r\nELF\r\nLibrary handling various activities including loading a secondary Dalvik DEX file (lib.dat)\r\n\r\n\r\n10\r\n.\/assets\/a.zip\/lib.dat\r\nRC4(Zlib)\r\nDEX\r\nDalvik file for parsing config file, monitoring out-going calls, intercepting SMS messages and more.\r\n\r\n\r\n\r\nTable 3 Contents and components of this HenBox variant\r\nChickens in flight\r\nThere are two methods to execute HenBox\u2019s malicious code. The first method, as depicted by Figure 2 below, is automatic based on the operating system generating one of a handful of broadcasts that HenBox registered its intent to process during the app installation process. Examples include events like device reboots or when an app is newly installed. The list of all the intents registered statically via HenBox\u2019s AndroidManifest.xml file are described in the appendix below; HenBox also registers further intents at run-time.\r\n\r\n\r\nFigure 2 HenBox execution via Intents and External Triggers\r\nMost of the intents listed in the appendix, and in Figure 2, are commonly found in malicious Android apps, and are the equivalent of setting registry run keys on Windows to autostart applications under certain conditions. One intent stands out and is much less common to see - com.xiaomi.smarthome.receive_alarm.\r\nXiaomi, a privately owned Chinese electronics and software company, is the 5th largest smart phone manufacturer in the world, manufacturing IoT devices for the home. Devices range from smart lights to smart rice cookers, and much more in-between. Devices are controlled using Xiaomi\u2019s \u201cMiHome\u201d app, which has been downloaded between 1,000,000 and 5,000,000 times.\r\nGiven the nature of connected devices in smart homes, it\u2019s highly likely many of these devices, and indeed the controller app itself, communicate with one another sending status notifications, alerts and so on. Such notifications, received by the MiHome app can also be processed by other apps, provided they register their intent to do so, such as HenBox. Essentially, this allows for external IoT devices to act as a trigger to execute the malicious HenBox app\u2019s code.\r\nTriggered intents result in execution of code that\u2019s present in either the BootReceiver or TimeReceiver classes, both of which ultimately lead to a new instance of the DaemonServer service being created and started. This service is discussed in more detail later. In addition, BootReceiver changes the device ringer mode to a value of 2, which results in ringtones being audible, and setting vibrate mode on. This may have been done in an attempt to have nearby people interact with the (now noisy) device such that information stolen may be richer in content. For more information on these intents and their purpose, please see the appendix.\r\nThe alternative method for executing the HenBox code is for the user to launch the malicious app from the launcher view on their device, as shown in Figure 3.\r\n\r\n\r\nFigure 3 HenBox app present in Launcher View on Android\r\nUpon manual launch, HenBox code executes and performs the steps highlighted in Figure 4 below.\r\n\r\nFigure 4 HenBox execution via human interaction\r\nFirstly, checks are made to determine whether the device manufacturer is Xiaomi, or the firmware is MIUI (Xiaomi\u2019s fork of Android). The intention here seems to be one of targeting Xiaomi and exiting prematurely if the checks fail, however poorly written code results in execution in more environments than the adversary perhaps wanted. Further checks try to ascertain whether HenBox is running on an emulator, perhaps being cautious around potential researcher environments. Interestingly, the code for these additional checks are concealed inside a class called AlarmService, which is appears to be code from online tutorials for Android developers, perhaps to hide the adversary\u2019s code from plain sight. Assuming these checks pass, HenBox continues to execute by next loading the ELF library libloc4d.so; its functionality is discussed later in this blog.\r\nUsing Android\u2019s shared preferences feature to persist XML key-value pair data, HenBox checks whether this execution is its first. If it is, and if the app\u2019s path does not contain \u201c\/system\/app\u201d (i.e. HenBox is not running as a system app, which provides elevated privileges), one of two embedded \u201csu?\u201d ELF libraries are XOR-decoded. A JNI call is then issued to libloc4d.so passing three strings \u2013 the app\u2019s package name, the package name including the current class, which is \u201cMainActivity\u201d, and the path to the HenBox app. This JNI call leads to the execution of the \u201csu?\u201d (henceforth sux) binary, which is also discussed in more detail later.\r\nThe two files \u2013 \u201csuy\u201d and \u201csux\u201d \u2013 are essentially the same; \u201csux\u201d is used if the Android version on the victim\u2019s device is 4.1 (aka \u201cJelly Bean\u201d) or newer; \u201csuy\u201d will be used for older versions.\r\nFinally, an instance of the DaemonServer service starts and, if a decoy app is embedded inside HenBox, as per the DroidVPN example, the installation process for it also starts.\r\n\r\nDaemonServer Class\r\nFigure 5 below illustrates the typical behavior of the DaemonServer service, starting with hiding the HenBox app from the launcher view and the app drawer\/tray. This behavior is common amongst Android malware and, while the app remains installed with its services running, it is harder to discover by the victim. The non-obfuscated ELF file \u201cdaemon\u201d is loaded next; the program gathers environmental information about the device by accessing system and radio log files, and by querying running processes.\r\n\r\n\r\nFigure 5 HenBox's DaemonServer Service code execution flow\r\nA Baidu library is used to for gathering device geo-location information; another run-time intent is registered to intercept outgoing phone calls, allowing HenBox to check the number dialed for prefixes matching \u201c+86\u201d \u2013 the country code for the People\u2019s Republic of China. Interestingly, instead of using Baidu\u2019s coordinate system, HenBox specifies the GCJ-02 alternative provided by the Chinese State Bureau of Surveying and Mapping. According to public sources, this system adds apparently random offsets to both the latitude and longitude, with the alleged goal of improving national security.\r\nFurther assets are then deployed and decoded, if necessary, including a.zip and setting.txt. Code is present in this variant to also deploy assets named \u201cplugin\u201d and \u201cAppVoice\u201d, however, they are not present in this sample, a likely indication of evolving development and use of multiple components, depending the adversary\u2019s needs at a given time.\r\nHenBox\u2019s config file, setting.txt, is decoded using XOR with a single-byte key, 0x88; filenames and XOR keys differ occasionally between variants. Once de-obfuscated, the config file\u2019s contents resembles something like the following text:\r\na1=wd.w3.ezua[.]com\r\na2=80\r\na3=crash_report@21cn[.]com\r\na4=smtp.21cn[.]com\r\na5=crash_report\r\na6=lxy.cn@163[.]com\r\na7=\r\na8=0914D1D428914B09A5372866B39524B9\r\na9=\r\nb1=0\r\nb2=0\r\nb3=1\r\nb4=http:\/\/www3.mefound[.]com\/aa.txt\r\n\r\nInterestingly, open source research indicates the email address in the above HenBox config file belongs to a scholar of Cyber Security at the University of the Chinese Academy of Sciences in Beijing, China. They are listed as an author on the paper \u201cRecognition of Information Leakage of Computer via Conducted Emanations on the Power Line.\u201d Why the email appears in the configuration file of HenBox malware is not known at the time of writing.\r\nCurrently, it\u2019s not known to us exactly how all these parameters are used, however some of the domains (or IP addresses in other variants) are used as the C2 for the threat actors.\r\nFinally, a worker thread is then created that sets various components running in the background. One of the key components used is the ELF file named \u201cb.dat\u201d, which in turn interacts with \u201ca.zip\u201d. The archive file a.zip contains two further files: libkernel.so (another ELF file) and lib.dat, which is actually a Dalvik DEX file containing further Java code for the app\u2019s behavior, beyond the default classes.dex file. Some of the key data-harvesting behavior of HenBox stem for these files \u2013 b.dat and the contents of a.zip \u2013 all four of which are RC4-encrypted, forming the most heavily obfuscated components within HenBox.\r\nOnce unpacked and available for use, the new DEX file is executed from within the DaemonServer class of the main HenBox app. A DexClassLoader object is created and a loadClass method is called for a class \"com\/common\/ICommonFun\" contained within the once deeply-nested, and obfuscated secondary DEX file. From the newly-loaded class, a method is called to invoke further HenBox capabilities, including enumerating all running applications and killing those that have the permission to receive SMS messages, before registering its own run-time Intent to do so, and thus intercept the victim\u2019s messages.\r\nThe method continues next by loading the libkernel.so library file, also unpacked from the a.zip archive. This ELF file has numerous capabilities, many of which stem from using a built-in version of BusyBox \u2013 a package containing various stripped-down Unix tools useful for administering such systems. This executable interacts with the aforementioned sux executable and, amongst other things, temporarily disables the noise made by the device when photos are taken. This is achieved by moving the audio file \u201c\/system\/media\/audio\/ui\/camera_click.ogg\u201d elsewhere, and back again once the picture-taking is complete.\r\n\r\nDynamic C2s\r\nAt the time of writing, three HenBox variants, all seen in early April 2017, gathered their C2 addresses dynamically. The three are listed in Table 3, below.\r\n\r\n\r\n\r\nSHA-256\r\nPackage Name\r\nApp Name\r\nFirst Seen\r\n\r\n\r\n184e5cbebef4ee591351cfaa1130d5741\r\n9f70eb95c6387cb8ec837bd2beb14d6\r\ncom.android.henbox\r\n\u5907\u4efd (Backup)\r\nApril 2nd 2017\r\n\r\n\r\nefa3cd45e576ef8ab22d40fc9814456d0\r\n6a6eeeaeada829c16122a39cb101dbf\r\ncom.android.henbox\r\n\u5907\u4efd (Backup)\r\nApril 2nd 2017\r\n\r\n\r\n9d85be32b54398a14abe988d98386a3\r\n8ce2d35fff91caf1be367f7e4b510b054\r\ncom.android.henbox\r\n\u5907\u4efd (Backup)\r\nApril 1st 2017\r\n\r\n\r\n\r\nTable 4 HenBox variants using dynamic C2s\r\nAs previously mentioned, HenBox config files contain the C2 information for the malware. In the case of the three variants listed in Table 3, the C2 address was http:\/\/blog.sina.com[.]cn\/s\/blog_772696fb0102wemg.html. The content of the site, at the time of writing, is shown in Figure 6 below.\r\n\r\n\r\nFigure 6 Example website hosting the HenBox C2 information\r\nThe blog contains structured text strings beginning with \u201cConnectURL\u201d that, when parsed, provide the IP address and port number for HenBox to use as its C2.\r\n\r\nConclusion\r\nTypically masquerading as legitimate Android system apps, and sometimes embedding legitimate apps within them, the primary goal of the malicious HenBox apps appears to be to spy on those who install them. Using similar traits, such as copycat iconography and app or package names, victims are likely socially engineered into installing the malicious apps, especially when available on so-called third-party (i.e. non-Google Play) app stores which often have fewer security and vetting procedures for the apps they host. It\u2019s possible, as with other Android malware, that some apps may also be available on forums, file-sharing sites or even sent to victims as email attachments, and we were only able to determine the delivery mechanism for a handful of the apps we have been able to find.\r\nThe hosting locations seen for some HenBox variants, together with the nature of some embedded apps including: those targeted at extremist groups, those who use VPN or other privacy-enabling apps and those who speak the Uyghur language, highlights the victim profile the threat actors were seeking to attack. The targets and capabilities of HenBox, in addition to the ties to previous activity using four different Windows malware families with political-themed lures against several different South East Asian countries, indicates this activity likely represents an at least three year old espionage campaign.\r\n\r\nPalo Alto Networks customers are protected by:\r\nAutofocus customers can investigate this activity using the following tag. To date we believe HenBox is not a shared tool, however, the remainder of malware used by these attackers is shared amongst multiple groups:\r\n\r\n \tHenBox\r\n \tPoison Ivy\r\n \tZupdax\r\n \t9002\r\n \tPlugX\r\n\r\nAndroid Hygiene\r\nUpdate:\u00a0Keep installed apps updated. Much like patching Operating System and application files on PCs, Android and apps developed for the platform also receive security updates from Google and app developers to remove vulnerabilities and improve features, including security.\r\nReview:\u00a0App permissions to see what the app is potentially capable of. This can be quite technical but many permissions are named\u00a0intuitively describing if they intend to access contacts, messages or sensors, such as the device microphone or camera. If\u00a0you the permission seem over the top compared to the described functionality, then don\u2019t install. Also read the app and developer reviews to evaluate their trustworthiness.\r\nAvoid:\u00a03rd\u00a0party app stores that may host pirated versions of paid apps from the Google Play app store, often such apps include unwanted extra features that can access\u00a0your\u00a0sensitive\u00a0data or perform malicious behaviors. Also avoid rooting devices, if possible, as apps could misuse this power.\r\nAppendix\r\nThe following analysis is based on the HenBox Android APK file listed in Table 5 below.\r\n\r\n\r\n\r\nSHA256\r\nPackage Name\r\nApp Name\r\nFirst seen\r\n\r\n\r\na6c7351b09a733a1b3ff8a0901c5bde\r\nfdc3b566bfcedcdf5a338c3a97c9f249b\r\ncom.android.henbox\r\n\u5907\u4efd (Backup)\r\nAug 29th 2017\r\n\r\n\r\n\r\nTable 5 HenBox app detailed in the analysis\r\nThe permissions declared statically in the AndroidManifest.XML file are pretty aggressive, and in line with what you would expect from this type of espionage Android malware. Table 6 below lists and describes the Android permissions declared for this variant of HenBox.\r\n\r\n\r\n\r\nCategory\r\nPermission\r\nDescription\r\n\r\n\r\nSystem\r\nKILL_BACKGROUND_PROCESSES\r\nThe ability to kill processes associated to given packages may allow the app to stop security apps, or those that may be running, which it is attempting to imitate or install.\r\n\r\n\r\nSystem\r\nWAKE_LOCK\r\nAllows for the CPU to be kept awake, and screen on, for background tasks to continue.\r\n\r\n\r\nSystem\r\nWRITE_SETTINGS**\r\nAbility to modify system settings\r\n\r\n\r\nSystem\r\nRECEIVE_BOOT_COMPLETED\r\nCan receive the broadcast message when system finishes booting.\r\n\r\n\r\nSystem\r\nREAD_LOGS\r\nAllows for\u00a0reading the low-level system log files.\r\n\r\n\r\nSystem\r\nGET_TASKS\r\nRetrieve the list of running tasks from all apps.\r\n\r\n\r\nStorage\r\nMOUNT_UNMOUNT_FILESYSTEMS\r\n(un)mount file systems for removable storage access.\r\n\r\n\r\nStorage\r\nWRITE_EXTERNAL_STORAGE\r\nWrite to external storage.\r\n\r\n\r\nSensors\r\nCAMERA\r\nAccess the device camera(s)\r\n\r\n\r\nSensors\r\nRECORD_AUDIO\r\nRecord audio through device microphone\r\n\r\n\r\nNetwork\r\nINTERNET\r\nAbility to open network sockets\r\n\r\n\r\nNetwork\r\nACCESS_NETWORK_STATE\r\nAccess information about phone networks\r\n\r\n\r\nNetwork\r\nACCESS_WIFI_STATE\r\nAccess information about WiFi networks\r\n\r\n\r\nNetwork\r\nCHANGE_WIFI_STATE\r\nChange Wi-Fi connectivity state\r\n\r\n\r\nNetwork\r\nCHANGE_NETWORK_STATE**\r\nChange network connectivity state\r\n\r\n\r\nMessages\r\nREAD_SMS\r\nRead SMS messages\r\n\r\n\r\nMessages\r\nRECEIVE_SMS\r\nReceive SMS messages\r\n\r\n\r\nMessages\r\nSEND_SMS\r\nSend SMS messages\r\n\r\n\r\nMessages\r\nWRITE_SMS**\r\nWrite SMS messages\r\n\r\n\r\nLocation\r\nACCESS_COARSE_LOCATION\r\nAccess approximate location\r\n\r\n\r\nLocation\r\nACCESS_FINE_LOCATION\r\nAccess precise location\r\n\r\n\r\nContacts\r\nREAD_CONTACTS\r\nRead user\u2019s contacts data\r\n\r\n\r\nContacts\r\nWRITE_CONTACTS\r\n\u00a0Write to the user\u2019s contacts data\r\n\r\n\r\nCalls\r\nREAD_PHONE_STATE\r\nRead-only access to device phone number, current cellular network information and the status of any ongoing calls.\r\n\r\n\r\nCalls\r\nREAD_CALL_LOG\r\nRead the call log of previous outgoing, incoming and missed calls.\r\n\r\n\r\nCalls\r\nREAD_PHONE_STATE (duplicate)\r\n(see above)\r\n\r\n\r\nCalls\r\nPROCESS_OUTGOING_CALLS\r\nAbility to see the number being dialed during an outgoing call with the option to redirect the call to a different number or abort the call altogether\r\n\r\n\r\nCalls\r\nCALL_PHONE\r\nInitiate a phone call without going through the Dialer user interface for the user to confirm the call\r\n\r\n\r\nCalls\r\nWRITE_CALL_LOG\r\nWrite to the user's call log data\r\n\r\n\r\nCalendar\r\nREAD_CALENDAR\r\nRead the user's calendar data\r\n\r\n\r\nBrowser\r\nbrowser.permission.\r\nREAD_HISTORY_BOOKMARKS**\r\nAccess browsing history from web browser(s)\r\n\r\n\r\n\r\nTable 6 Typical permissions requested by HenBox\r\n**Some permissions are deprecated in recent Android versions, or now require more stringent permission requests including user-interaction for secondary permission acceptance; in some cases, 3rd party apps may no longer be allowed to use some of the listed permissions. The ability to write SMS messages, for example, was overhauled in version 4.4 (aka KitKat) some 4 years ago.\r\nSome variants have slightly differing permissions; noteworthy that some recent variants of HenBox have included Bluetooth related permissions, as detailed in Table 7 below.\r\n\r\n\r\n\r\nCategory\r\nPermission\r\nDescription\r\n\r\n\r\nNetwork\r\nBLUETOOTH\r\nAllows applications to connect to paired bluetooth devices\r\n\r\n\r\nNetwork\r\nBLUETOOTH_ADMIN\r\nAllows applications to discover and pair bluetooth devices.\r\n\r\n\r\n\r\nTable 7 Additional permissions in more recent HenBox variants\r\nOnce the user installs the app, two services are registered, as shown in Figure 7 below \u2013 showing an extract from this app\u2019s AndroidManifest.xml file.\r\n\r\nFigure 7 AndroidManifest.xml service declarations\r\nBoth services have been discussed already but to recap, DaemonServer is responsible for hiding the malicious app, enabling location tracking and gathering phone numbers called from the device, with specific interest of Chinese numbers; further components are also unpacked and launched when this class is instantiated and run.\r\nAlarmService contains an approximate copy of Google\u2019s Android API demo code for creating alarm and timer apps. Extra classes and methods have been added providing functionality to HenBox, including anti-debug and anti-analysis code capable of detecting if the app is running within emulator, and possibly research analysis, environments.\r\nManifest-declared priority values of 1000 are set for both services, as shown in Figure 7, albeit erroneously. Setting high, or in this case maximum, values in the priority attribute is a trick typically used when declaring intents and receivers for system broadcasts to ensure certain apps (often malicious) are executed ahead of intended apps that would handle such events. There is no such priority concept for services; the operating system alone controls service CPU time, according to how busy the device is and how much resource remains.\r\nThe attribute \u201cexported\u201d, shown in Figure 7, relates to whether or not components of other applications can invoke the service, or interact with it \u2014 \"true\" if they can; \"false\" if not. This immediately makes DaemonServer a little more interesting.\r\nAndroid receivers com.android.henbox.BootReceiver and com.android.henbox.TimeReceiver are also declared in the AndroidManifest.xml to receive broadcast messages under certain conditions. BootReceiver, as per the services listed in Figure 7 above, has its priority attribute (correctly) set to 1000, allowing certain intent-filters to trigger and run the malicious receiver above the receivers and matching intents from other apps.\r\nThe intent filters listed in the AndroidManifest.xml are briefly described in the Table 8 below, together with the receivers they refer to.\r\n\r\n\r\n\r\nReceiver\r\nIntent Name\r\nDescription\r\n\r\n\r\nBootReceiver\r\nandroid.intent.action.BOOT_COMPLETED\r\nSystem notification that the device has finished booting.\r\n\r\n\r\nandroid.intent.action.restart\r\nA legacy intent used to indicate a system restart.\r\n\r\n\r\nandroid.intent.action.SIM_STATE_CHANGED\r\nSystem notification that the SIM card has changed or been removed.\r\n\r\n\r\nandroid.intent.action.PACKAGE_INSTALL\r\nSystem notification that the download and eventual installation of an app package is happening (this is deprecated)\r\n\r\n\r\nandroid.intent.action.PACKAGE_ADDED\r\nSystem notification that a new app package has been installed on the device, including the name of said package.\r\n\r\n\r\ncom.xiaomi.smarthome.receive_alarm\r\nReceived notifications from Xiaomi\u2019s smart home IoT devices.\r\n\r\n\r\nTimeReceiver\r\nandroid.intent.action.ACTION_TIME_CHANGED\r\nSystem notification that the time was set.\r\n\r\n\r\nandroid.intent.action.CONNECTIVITY_CHANGE\r\nSystem notification that a change in network connectivity has occurred, either lost or established. Since Android version 7 (Nougat) this information is gathered using other means, perhaps inferring the devices used by potential victim run older versions of Android.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nTable 8 HenBox intents declared statically in AndroidManifest.xml\r\nMost of the intents listed are commonly seen in malicious, information-stealing Android apps that wish to hook certain common events, such as system reboots, network changes, new apps installed and so forth, acting as a trigger to their code.\r\nAs mentioned earlier, HenBox registers a much less common and more interesting intent filter \u2013 com.xiaomi.smarthome.receive_alarm. This relates to Xiaomi\u2019s smart home IoT devices, and their MiHome controller app for smartphones. Broadcasts or notifications from such Xiaomi\u2019s devices, which would usually be processed by the MiHome app, could now also be processed by HenBox, acting as a trigger to launch its malicious behavior.\r\nWhichever Intent triggers HenBox will execute code declared in BootReceiver or TimeReceiver; both receivers\u2019 code resembles the snippet below, which starts a new instance of the service DaemonServer and increment an integer by 1.\r\nDaemonServer.d += 1;\r\nparamContext.startService(new Intent(paramContext, DaemonServer.class));\r\n\r\nBootReceiver also executes the following line of code, resulting in the device\u2019s ringer mode being set to audible and vibrate mode on.\r\n((AudioManager)paramContext.getSystemService(\"audio\")).setRingerMode(2);\r\nThe purpose for this additional behavior in BootReceiver is unknown but given the requested permissions, the capability to gather information from device sensors, such as the microphone and cameras, it\u2019s feasible the intention of changing the ringer settings is to encourage interaction with the device by anyone nearby, perhaps leading to richer content of the data being exfiltrated.\r\nAside from using Intents and Receivers to launch HenBox, as mentioned above, there is an alternative \u2013 launching the app manually from the launcher view on Android, as shown in Figure 8 below. Doing so results in code in the MainActivity class being executed, which is equivalent to a Windows Portable Executable (PE) file\u2019s entry point.\r\n\r\n\r\nFigure 8 Android app launcher view and the HenBox app\r\nSpecifically, the onCreate() method in the MainActivity class is executed. This code performs some initial checks of the device manufacturer and Operating System before continuing. The actors seemed to be interested only in Xiaomi devices, or Xiaomi\u2019s fork of Android called MIUI (\u201cMe You I\u201d) running on any device. The code performing these checks is buggy and results in execution in more environments then perhaps anticipated.\r\nContinuing with the device checks, HenBox performs various well-documented anti-emulator checks, such as querying the device phone number, device IDs, IMSI, various QEMU-related environment settings, hardware configurations and other notable strings to compare against known constants that would infer an emulator device, which are commonly used for app analysis. Finally, they check for tainted Operating Systems, such as the presence of TaintDroid code used for tracking app behavior.\r\nAndroid\u2019s shared preferences feature is used to persist information beyond the lifetime of the app execution, and to retrieve said information, should it exist. HenBox uses this feature to symbolize if the malware has already run. The strings used to denote this are XOR-encoded with single-byte key, 0x59; a helper method in the DaemonServer class is used for decoding. The strings are listed in Table 9 below.\r\n\r\n\r\n\r\n#\r\nEncoded\r\nDecoded\r\n\r\n\r\n1\r\n41 43 60 63 60 43 60 55 58 60\r\nPreference\r\n\r\n\r\n2\r\n31 48 43 42 45 11 44 55\r\nFirstRun\r\n\r\n\r\n3\r\n0 28 10\r\nYES\r\n\r\n\r\n4\r\n118 42 32 42 45 60 52 118 56 41 41\r\n\/system\/app\r\n\r\n\r\n\r\nTable 9 Example HenBox XOR encoded strings\r\nHenBox attempts to hide itself from the app launcher view by running the following code, passing the parameters COMPONENT_ENABLED_STATE_DISABLED (2) and DONT_KILL_APP (1) to the setComponentEnabledSetting() method.\r\ngetPackageManager().setComponentEnabledSetting(new ComponentName(this, MainActivity.class.getName()), 2, 1);\r\nDaemonServer Service\r\nTo recap, the DaemonServer Service is launched either through the two receivers\u2019 intent filters being triggered by certain events occurring on the device, or through launching the app manually. Either way, the registered service\u2019s entry-point method, onCreate(), is executed.\r\nLocation tracking for the device is enabled using the com.baidu.location.service_v2.9 libraries carried within the HenBox APK file. However, instead of using Baidu\u2019s coordinate system, HenBox specifies the GCJ-02 alternative provided by the Chinese State Bureau of Surveying and Mapping. According to public sources, this system adds apparently random offsets to both the latitude and longitude, with the alleged goal of improving national security.\r\nDaemonServer continues by setting up a PhoneStateListener object instance, customized to handle cases of phone numbers starting with \u201c+86\u201d (country dialing code for China), and listens for changes to the device call state. A run-time, high-priority intent filter is setup for android.intent.action.NEW_OUTGOING_CALL, so as to inform HenBox when a phone call is made. The associated receiver \u2013 BroadcastReceiver \u2013 retrieves the phone number being dialed using the getStringExtra(\"android.intent.extra.PHONE_NUMBER\") method call.\r\n\r\nIOCs\r\nFor a full list of SHA256 hashes, their first encountered timestamp, and details of Android package and app names relating to over 200 apps, please refer to the following file on GitHub.","publisher":{"@type":"Organization","@id":"#panworg"},"image":{"@type":"ImageObject","url":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/uploads\/2018\/04\/unit42-blog-600x300-150x150.jpg","width":150,"height":150},"author":[{"@type":"Person","name":"Alex Hinchliffe"},{"@type":"Person","name":"Mike Harbison"},{"@type":"Person","name":"Jen Miller-Osborn"},{"@type":"Person","name":"Tom Lancaster"}]}</script><link rel='stylesheet' id='crayon-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-classic-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dist/block-library/style.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dashicons.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='post-views-counter-frontend-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/post-views-counter/css/frontend.css?ver=1.3.1' type='text/css' media='all' />
<link rel='stylesheet' id='bodhi-svgs-attachment-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/svg-support/css/svgs-attachment.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-horizontal-list-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-list-horizontal/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-post-translations-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-post-translations/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/css/wpp.css?ver=5.0.1' type='text/css' media='all' />
<link rel='stylesheet' id='unit42/css-css'  href='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/styles/main.css' type='text/css' media='all' />
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpp_params = {"sampling_active":"0","sampling_rate":"100","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-json\/wordpress-popular-posts\/v1\/popular-posts","ID":"73511","token":"7e15a0f8b3","debug":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/js/wpp-5.0.0.min.js?ver=5.0.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpml_xdomain_data = {"css_selector":"wpml-ls-item","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","current_lang":"en"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/res/js/xdomain-data.js?ver=4.3.5'></script>
<link rel='https://api.w.org/' href='https://unit42.paloaltonetworks.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://unit42.paloaltonetworks.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://unit42.paloaltonetworks.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.4.1" />
<link rel='shortlink' href='https://unit42.paloaltonetworks.com/?p=73511' />
<link rel="alternate" type="application/json+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-henbox-inside-coop%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-henbox-inside-coop%2F&#038;format=xml" />
<meta name="generator" content="WPML ver:4.3.5 stt:1,28;" />
<meta name="google-site-verification" content="zHZtYOWm9hm4SZgsH7wqiYcOwmsAsxDUDU4UD1QxB40" /><style>#wpdevart_lb_overlay{background-color:#000000;} #wpdevart_lb_overlay.wpdevart_opacity{opacity:0.8 !important;} #wpdevart_lb_main_desc{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;} #wpdevart_lb_information_content{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;}
		#wpdevart_lb_information_content{
			width:100%;	
		}
		#wpdevart_info_counter_of_imgs{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_caption{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_title{
			    display: inline-block;
				padding-left:5px;
				padding-right:5px;
				font-size:15px;
				color:#000000;
		}
		@-webkit-keyframes rotate {
			to   {-webkit-transform: rotate(360deg);}
			from  {-webkit-transform: rotate(0deg);}
		}
		@keyframes rotate {
			to   {transform: rotate(360deg);}
			from  {transform: rotate(0deg);}
		}
		#wpdevart_lb_loading_img,#wpdevart_lb_loading_img_first{
			-webkit-animation: rotate 2s linear  infinite;
    		animation: rotate 2s linear infinite;
		}
	  </style>        <script>var $ = jQuery;</script>
  
  
<script type="text/javascript">
;(function(win, doc, style, timeout) {
var STYLE_ID = 'at-body-style';
function getParent() {
return doc.getElementsByTagName('head')[0];
}
function addStyle(parent, id, def) {
if (!parent) {
return;
}
var style = doc.createElement('style');
style.id = id;
style.innerHTML = def;
parent.appendChild(style);
}
function removeStyle(parent, id) {
if (!parent) {
return;
}
var style = doc.getElementById(id);
if (!style) {
return;
}
parent.removeChild(style);
}
addStyle(getParent(), STYLE_ID, style);
setTimeout(function() {
removeStyle(getParent(), STYLE_ID);
}, timeout);
}(window, document, "body {visibility:hidden !important}", 3000));
</script>

<script src="//assets.adobedtm.com/9273d4aedcd2/0d76ae0322d7/launch-425c423d843b.min.js" async></script>
<script type="text/javascript" src="https://www.paloaltonetworks.com/content/dam/pan/en_US/includes/attribution.js"></script>
  </head>
  <body class="post-template-default single single-post postid-73511 single-format-standard">
    <!--[if IE]>
      <div class="alert alert-warning">
        You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.      </div>
    <![endif]-->
    <header class="haeder py-15 position-relative z-index-2">
  <div class="container px-sm-30 px-35">
    <div class="row">
      <div class="first-logo col-sm-auto col-6 mb-sm-0 mb-40 text-sm-center order-1">
                  <a href="https://www.paloaltonetworks.com/">
<!--<img src="/wp-content/uploads/2019/07/paloaltonetwork.svg" class="attachment-full size-full" alt="" height="43" width="124" />-->
<svg width="140" height="26" viewBox="0 0 140 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M59.4802 4.69592C57.6721 4.69592 55.7937 5.18876 53.469 6.43377L54.7605 9.62741C56.7794 8.50019 58.447 8.00735 59.6682 8.00735C61.0538 8.00735 61.6644 8.52395 61.6644 9.20483V9.25133C61.6644 9.72143 61.2883 9.97974 60.3729 10.0738L58.7766 10.238C54.7843 10.6606 53.1404 12.3985 53.1404 14.7934V14.9577C53.1404 17.2359 55.0188 19.0203 57.6721 19.0203C59.4192 19.0203 60.937 18.2826 61.8597 16.9807L62.1572 18.7857H65.7734V10.5904C65.7734 6.71584 63.5428 4.69592 59.4802 4.69592ZM59.1279 15.8969C57.7899 15.8969 57.1555 15.3803 57.1555 14.5816V14.5351C57.1555 13.8305 57.5543 13.3139 59.0101 13.1031L59.6445 13.0091C60.5713 12.8799 61.1406 12.7095 61.6644 12.3923V13.4317C61.6644 15.0052 60.6777 15.8969 59.1279 15.8969Z" fill="white"/>
<path d="M25.4785 4.78994L20.8528 0.164276L16.2271 4.78994L18.5281 7.09192L6.92828 18.6917L11.5539 23.3174L16.1796 18.6917L13.8787 16.3908L25.4785 4.78994Z" fill="white"/>
<path d="M11.6001 0.164048L0 11.7642L4.62603 16.3902L16.2262 4.79008L11.6001 0.164048Z" fill="white"/>
<path d="M27.7794 7.09215L16.1793 18.6923L20.8053 23.3183L32.4054 11.7182L27.7794 7.09215Z" fill="white"/>
<path d="M72.231 0H68.1219V18.7857H72.231V0Z" fill="white"/>
<path d="M46.2366 4.69592C44.3685 4.69592 42.8683 5.52249 42.0428 6.81709L41.7287 4.93046H38.1125V23.4806H42.2215V17.051C43.0037 18.2567 44.4832 19.0193 46.2366 19.0193C49.5242 19.0193 52.2013 16.1077 52.2013 12.0916V11.6215C52.2013 7.60853 49.5242 4.69592 46.2366 4.69592ZM47.9744 11.9759C47.9744 14.0888 46.871 15.6159 45.0391 15.6159C43.2072 15.6159 42.1038 14.0898 42.1038 11.9759V11.7414C42.1038 9.62741 43.2072 8.10137 45.0391 8.10137C46.871 8.10137 47.9744 9.62741 47.9744 11.7414V11.9759Z" fill="white"/>
<path d="M127.672 4.69592C123.469 4.69592 120.51 7.6075 120.51 11.6236V12.0937C120.51 16.1087 123.469 19.0213 127.672 19.0213C131.875 19.0213 134.834 16.1097 134.834 12.0937V11.6236C134.834 7.60853 131.875 4.69592 127.672 4.69592ZM130.607 11.9759C130.607 14.0888 129.504 15.6159 127.672 15.6159C125.84 15.6159 124.736 14.0898 124.736 11.9759V11.7414C124.736 9.62741 125.84 8.10137 127.672 8.10137C129.504 8.10137 130.607 9.62741 130.607 11.7414V11.9759Z" fill="white"/>
<path d="M138.708 5.54211V5.47185C138.708 5.07304 138.404 4.79097 137.863 4.79097H136.924V6.9514H137.37V6.22299H137.866L138.239 6.9514H138.732L138.274 6.09694C138.552 6.01119 138.708 5.80248 138.708 5.54211ZM137.369 5.18979H137.862C138.144 5.18979 138.261 5.28381 138.261 5.49562V5.51938C138.261 5.70742 138.143 5.82418 137.862 5.82418H137.369V5.18979Z" fill="white"/>
<path d="M137.769 3.63998C136.502 3.63998 135.539 4.60293 135.539 5.87067C135.539 7.13842 136.502 8.10137 137.769 8.10137C139.037 8.10137 140 7.13842 140 5.87067C140 4.60293 139.037 3.63998 137.769 3.63998ZM137.769 7.79554C136.666 7.79554 135.867 6.99687 135.867 5.86964C135.867 4.74241 136.666 3.94375 137.769 3.94375C138.873 3.94375 139.671 4.74241 139.671 5.86964C139.671 6.99687 138.873 7.79554 137.769 7.79554Z" fill="white"/>
<path d="M108.416 0H104.307V18.7857H108.416V0Z" fill="white"/>
<path d="M116.518 15.6159C115.321 15.6159 114.874 15.029 114.874 13.7613V8.10137H119.712V4.93149H114.874V1.76058L110.765 2.37121V14.159C110.765 17.3765 112.409 19.0203 115.697 19.0203C117.153 19.0203 118.867 18.5739 120.276 17.7753L119.102 14.8637C118.279 15.31 117.129 15.6159 116.518 15.6159Z" fill="white"/>
<path d="M95.6662 4.69592C93.8581 4.69592 91.9797 5.18876 89.655 6.43377L90.9465 9.62741C92.9654 8.50019 94.633 8.00735 95.8542 8.00735C97.2397 8.00735 97.8504 8.52395 97.8504 9.20483V9.25133C97.8504 9.72143 97.4743 9.97974 96.5589 10.0738L94.9626 10.238C90.9702 10.6606 89.3264 12.3985 89.3264 14.7934V14.9577C89.3264 17.2359 91.2048 19.0203 93.8581 19.0203C95.6042 19.0203 97.123 18.2826 98.0456 16.9807L98.3432 18.7857H101.959V10.5904C101.959 6.71584 99.7287 4.69592 95.6662 4.69592ZM95.3138 15.8969C93.9748 15.8969 93.3415 15.3803 93.3415 14.5816V14.5351C93.3415 13.8305 93.7403 13.3139 95.1961 13.1031L95.8304 13.0091C96.7572 12.8799 97.3265 12.7095 97.8493 12.3923V13.4317C97.8493 15.0052 96.8637 15.8969 95.3138 15.8969Z" fill="white"/>
<path d="M81.225 4.69592C77.022 4.69592 74.0629 7.6075 74.0629 11.6236V12.0937C74.0629 16.1087 77.022 19.0213 81.225 19.0213C85.4281 19.0213 88.3872 16.1097 88.3872 12.0937V11.6236C88.3862 7.60853 85.4281 4.69592 81.225 4.69592ZM84.1593 11.9759C84.1593 14.0888 83.0559 15.6159 81.224 15.6159C79.3921 15.6159 78.2887 14.0898 78.2887 11.9759V11.7414C78.2887 9.62741 79.3921 8.10137 81.224 8.10137C83.0559 8.10137 84.1593 9.62741 84.1593 11.7414V11.9759Z" fill="white"/>
<path d="M98.0446 22.1168H99.0975L100.551 24.0334H100.566V22.1168H101.532V25.4964H100.513L99.0251 23.5313H99.0107V25.4964H98.0446V22.1168Z" fill="white"/>
<path d="M102.816 22.1168H105.771L105.81 22.9372H103.825V23.4011H105.385V24.1491H103.825V24.676H105.868L105.829 25.4964H102.816V22.1168Z" fill="white"/>
<path d="M107.925 22.9857H106.742L106.78 22.1168H110.088L110.127 22.9857H108.944V25.4964H107.925V22.9857Z" fill="white"/>
<path d="M110.943 22.1168H112.024L112.575 24.4632H112.628L113.342 22.1168H114.333L115.033 24.4632H115.086L115.627 22.1168H116.66L115.771 25.4964H114.444L113.826 23.4589H113.797L113.169 25.4964H111.836L110.943 22.1168Z" fill="white"/>
<path d="M117.404 23.8071C117.404 22.7057 118.152 22.0155 119.335 22.0155C120.518 22.0155 121.267 22.7057 121.267 23.8071C121.267 24.9085 120.519 25.5987 119.335 25.5987C118.152 25.5987 117.404 24.9075 117.404 23.8071ZM120.257 23.8071C120.257 23.2234 119.92 22.8752 119.335 22.8752C118.75 22.8752 118.412 23.2234 118.412 23.8071C118.412 24.3919 118.75 24.7391 119.33 24.7391C119.914 24.7391 120.257 24.3909 120.257 23.8071Z" fill="white"/>
<path d="M122.363 22.1168H124.334C125.231 22.1168 125.672 22.5414 125.672 23.3287C125.672 23.8691 125.449 24.2369 125.014 24.4105L125.816 25.4974H124.667L124.044 24.6089H123.378V25.4974H122.363V22.1168ZM124.202 23.8164C124.54 23.8164 124.661 23.6284 124.661 23.3721C124.661 23.1159 124.54 22.933 124.202 22.933H123.377V23.8164H124.202Z" fill="white"/>
<path d="M126.989 22.1168H128.002V23.3628H128.418L129.408 22.1168H130.547L130.552 22.1209L129.259 23.7389L130.625 25.4923L130.62 25.4964H129.437L128.414 24.1977H128.002V25.4964H126.989V22.1168Z" fill="white"/>
<path d="M131.402 25.2743V24.3475H131.407C131.972 24.6327 132.523 24.7721 133 24.7721C133.363 24.7721 133.546 24.6853 133.546 24.5159C133.546 24.3465 133.425 24.3031 132.7 24.1873C131.909 24.0623 131.382 23.8247 131.382 23.1438C131.382 22.5115 131.938 22.0238 133.024 22.0238C133.459 22.0238 133.912 22.1158 134.333 22.2945V23.212L134.328 23.2172C133.927 22.9857 133.386 22.84 132.951 22.84C132.565 22.84 132.411 22.932 132.411 23.0859C132.411 23.2843 132.648 23.3029 133.242 23.4052C134.033 23.5406 134.56 23.7627 134.56 24.4777C134.56 25.0325 134.145 25.5884 132.952 25.5884C132.364 25.5884 131.894 25.4675 131.402 25.2743Z" fill="white"/>
</svg>

</a>

      </div>

      <div class="col-sm-auto col-6 text-sm-center order-sm-2 order-4 second-logo-unit">
        <a href="https://unit42.paloaltonetworks.com/"><img src="/wp-content/uploads/2019/07/unit42.svg" class="attachment-full size-full" alt="" height="35" width="105" /></a>
      </div>

      <div class="col-auto d-sm-none ml-auto mb-40 order-2">
        <button class="btn__search" data-toggle="collapse" data-target="#search"><i class="ui ui-1"></i></button>
      </div>

      <div id="search" class="collapse d-sm-block col-sm-auto col-12 ml-auto order-3">
        <div class="pt-sm-0 pt-20 pb-sm-0 pb-40 mt-sm-0 mt-n30">
                      <input type="search" placeholder="Search Unit 42" id="innerSearch" class="header__search" value="" required>
                  </div>
      </div>

      <div class="col-auto d-sm-none d-flex ml-auto align-items-center order-5">
        <button class="btn__menu rounded" data-toggle="collapse" data-target="#navigation">Menu</button>
      </div>
    </div>
  </div>
</header>

<nav id="navigation" class="site-nav collapse d-sm-block pb-20 mt-sm-10">
  <div class="container px-sm-30">
    <ul id="menu-primary-navigation" class="main-menu d-sm-flex font-weight-medium"><li id="menu-item-97290" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-97290"><a href="https://unit42.paloaltonetworks.com/tools/">Tools</a></li>
<li id="menu-item-41" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-41"><a href="https://unit42.paloaltonetworks.com/atoms/">ATOMs</a></li>
<li id="menu-item-98931" class="menu-item menu-item-type-post_type_archive menu-item-object-events menu-item-98931"><a href="https://unit42.paloaltonetworks.com/events/">Speaking Events</a></li>
<li id="menu-item-81229" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-81229"><a href="https://unit42.paloaltonetworks.com/about-unit-42/">About Us</a></li>
</ul>  </div>
</nav>

  <article class="article overflow-hidden">
    
<header class="article__header py-sm-25 pt-40 pb-25 bg-gray-700">
  <div class="container">
    
    <h1 class="article__header__title mb-sm-30 mb-40">HenBox: Inside the Coop</h1>

    <ul class="article__entry-meta d-flex flex-wrap align-items-center text-black">
      <li class="mr-10 mb-10 px-20 rounded-pill d-flex bg-gray-200"><div class="post-views post-73511 entry-meta">
			
			
			<span class="post-views-count">27,348</span>
			</div> <span class="ml-5">people reacted</span></li>
      <li class="d-sm-none col-12 p-0"></li>
      <li class="mr-10 mb-10 px-20 rounded-pill bg-gray-200"><span class="ldc-ul_cont idc_ul_cont_not_liked_inner" onclick="alter_ul_post_values(this,'73511','like')"><i class="ui ui-2"></i><span class="ml-5">4</span></span></li>
      <li class="mb-10 px-20 rounded-pill bg-gray-200"><span class="span-reading-time rt-reading-time"><span class="rt-label rt-prefix"></span> <span class="rt-time"> 19</span> <span class="rt-label rt-postfix"></span></span> min. read</li>
    </ul>

    <div class="article__share position-relative">
      <div class="dropdown dropdown-right">
        <button type="button" class="px-25 text-black bg-white text-uppercase rounded-pill" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Share <i class="ui ui-6 ml-10 align-text-top"></i>
        </button>
        <div class="dropdown-menu rounded-pill" role="toolbar">
          <div class="share-dropdown px-20 py-10 text-black font-size-sm">
            <div class="row align-items-center flex-nowrap">
              <div class="col">
                <div class="d-flex align-items-center">
                  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-henbox-inside-coop%2F" target="_blank"><i class="ui ui-7"></i></a>
                  <a href="https://twitter.com/home?status=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-henbox-inside-coop%2F+-+HenBox%3A+Inside+the+Coop" target="_blank"><i class="ui ui-8"></i></a>
                  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-henbox-inside-coop%2F&title=HenBox%3A+Inside+the+Coop&summary=&source=" target="_blank"><i class="ui ui-9"></i></a>
                  <a href="//www.reddit.com/submit?url=https://unit42.paloaltonetworks.com/unit42-henbox-inside-coop/" target="_blank"><i class="ui ui-10"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>    <div class="article__summary py-25 text-gray-500 font-size-sm">
  <div class="container">
    <div class="row align-items-center no-gutters">
      <div class="col-sm-auto col-12 mb-sm-0 mb-35">
        <i class="ui ui-11 text-gray-700 mr-sm-20"></i>
      </div>
  
      <div class="col-sm col-12">
        <p>
          By <a href="https://unit42.paloaltonetworks.com/author/alex-hinchliffe/" title="Posts by Alex Hinchliffe" class="author url fn" rel="author">Alex Hinchliffe</a>, <a href="https://unit42.paloaltonetworks.com/author/mike-harbison/" title="Posts by Mike Harbison" class="author url fn" rel="author">Mike Harbison</a>, <a href="https://unit42.paloaltonetworks.com/author/jen-miller-osborn/" title="Posts by Jen Miller-Osborn" class="author url fn" rel="author">Jen Miller-Osborn</a> and <a href="https://unit42.paloaltonetworks.com/author/tom-lancaster/" title="Posts by Tom Lancaster" class="author url fn" rel="author">Tom Lancaster</a>        </p>
        <p><time datetime="2018-04-26T02:00:44+00:00">April 26, 2018 at 5:00 AM</time></p>
        <p>Category: <a href="https://unit42.paloaltonetworks.com/category/unit42/" rel="category tag">Unit 42</a></p>
        <p>Tags: <a href="https://unit42.paloaltonetworks.com/tag/9002/" rel="tag">9002</a>, <a href="https://unit42.paloaltonetworks.com/tag/android/" rel="tag">Android</a>, <a href="https://unit42.paloaltonetworks.com/tag/autofocus/" rel="tag">AutoFocus</a>, <a href="https://unit42.paloaltonetworks.com/tag/henbox/" rel="tag">HenBox</a>, <a href="https://unit42.paloaltonetworks.com/tag/plugx/" rel="tag">PlugX</a>, <a href="https://unit42.paloaltonetworks.com/tag/poison-ivy/" rel="tag">Poison Ivy</a>, <a href="https://unit42.paloaltonetworks.com/tag/zupdax/" rel="tag">Zupdax</a></p>
      </div>
    </div>
  </div>
</div>    <div class="py-30 bg-white">
      <div class="container">
        <div class="article__content pb-30">
                      <figure class="mb-30 text-center">
              <img width="600" height="300" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/unit42-blog-600x300.jpg" class="attachment-single size-single wp-post-image" alt="" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/unit42-blog-600x300.jpg 600w, https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/unit42-blog-600x300-300x150.jpg 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/unit42-blog-600x300-370x185.jpg 370w" sizes="(max-width: 600px) 100vw, 600px" />            </figure>
                    <p><span style="font-size: 18pt;">Summary</span><br />
On March 13, 2018, <a href="https://researchcenter.paloaltonetworks.com/2018/03/unit42-henbox-chickens-come-home-roost/">we published a blog</a> describing a new Android malware family we discovered and called “HenBox” based on metadata found in most of the malicious apps. HenBox apps masquerade as others such as VPN apps, and Android system apps; some apps carry legitimate versions of other apps which they drop and install as a decoy technique. While some of legitimate apps HenBox uses as decoys can be found on Google Play, HenBox apps themselves are found only on third-party (non-Google Play) app stores.<br />
HenBox apps appear to primarily target the <a href="https://en.wikipedia.org/wiki/Uyghurs">Uyghurs</a> – a <a href="https://en.wikipedia.org/wiki/Turkic_peoples">Turkic</a> ethnic group living mainly in the <a href="https://en.wikipedia.org/wiki/Xinjiang">Xinjiang</a> Uyghur Autonomous Region in North West China.<br />
HenBox has ties to infrastructure used in targeted attacks, with a focus on politics in South East Asia. These attackers have used additional malware families in previous activity dating to at least 2015 that include PlugX, Zupdax, 9002, and Poison Ivy.<br />
HexBox apps target devices made by Chinese consumer electronics manufacture, <a href="https://en.wikipedia.org/wiki/Xiaomi">Xiaomi</a> and those running <a href="https://en.wikipedia.org/wiki/MIUI">MIUI</a>, Xiaomi’s operating system based on Google Android. Furthermore, the malicious apps register their intent to process certain events broadcast on compromised devices in order to execute malicious code. This is common practice for many Android apps, however, HenBox sets itself up to trigger based on alerts from Xiaomi smart-home IoT devices, and once activated, proceeds in stealing information from a myriad of sources, including many mainstream chat, communication and social media apps. The stolen information includes personal and device information.<br />
The main purpose of this follow-up blog is to provide additional information, and detailed analysis, about HenBox apps.</p>
<p><span style="font-size: 18pt;">Delivery and Installation</span><br />
During our investigation, we discovered one HenBox app previously hosted on the third-party Android app store, “uyghurapps[.]net”. This HenBox variant masqueraded as the legitimate VPN application, “DroidVPN”, and carried the app as an asset, embedded within itself. Once HenBox installs on a compromised device, it begins the installation process for the legitimate DroidVPN.<br />
At the time of writing, we are unaware of any HenBox apps hosted on other third-party app stores; given the high volume of HenBox apps analyzed in our Wildfire sandbox, we can only speculate as to how other apps are delivered to victims; much of the Android malware seen in the wild tends to be delivered via third-party app stores, forums and file-sharing platforms, and of course by via ubiquitous phishing emails.</p>
<p><span style="font-size: 18pt;">HenBox Decoys</span><br />
Further analysis of the HenBox malware family is below, however, on the subject of masquerading apps, and installing embedded apps, it’s worth explaining how this decoy technique works.<br />
The HenBox variant being described here relates to that listed in Table 1, below, which masquerades as DroidVPN; other apps were used with decoys, and are described in more detail in the <a href="https://researchcenter.paloaltonetworks.com/2018/03/unit42-henbox-chickens-come-home-roost/">previous blog</a>.</p>
<table align="center">
<tbody>
<tr>
<td><strong>APK SHA256</strong></td>
<td><strong>Size (bytes)</strong></td>
<td><strong>First Seen</strong></td>
<td><strong>App Package name</strong><br />
<strong> </strong></td>
<td><strong>App name</strong></td>
</tr>
<tr>
<td>0589bed1e3b3d6234c30061be3be1cc6685d786ab3a892a8d4dae8e2d7ed92f7</td>
<td>2,740,860</td>
<td>May 2016</td>
<td>com.android.henbox</td>
<td>DroidVPN</td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><em>Table 1 HenBox variant using decoy techniques</em></p>
<p>Once HenBox is installed, and launched by the victim, the app starts the installation process of the legitimate, embedded app by executing the following code.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694cea741d3260232982" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
Intent localIntent = new Intent("android.intent.action.VIEW");
localIntent.setDataAndType(Uri.fromFile(new File(str)), DaemonServer.a(new char[] { 56, 41, 41, 53, 48, 58, 56, 45, 48, 54, 55, 118, 47, 55, 61, 119, 56, 55, 61, 43, 54, 48, 61, 119, 41, 56, 58, 50, 56, 62, 60, 116, 56, 43, 58, 49, 48, 47, 60 }));
startActivity(localIntent);</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694cea741d3260232982-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694cea741d3260232982-2">2</div><div class="crayon-num" data-line="crayon-5f694cea741d3260232982-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694cea741d3260232982-1"><span class="crayon-e">Intent </span><span class="crayon-v">localIntent</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Intent</span><span class="crayon-sy">(</span><span class="crayon-s">"android.intent.action.VIEW"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694cea741d3260232982-2"><span class="crayon-v">localIntent</span><span class="crayon-sy">.</span><span class="crayon-e">setDataAndType</span><span class="crayon-sy">(</span><span class="crayon-v">Uri</span><span class="crayon-sy">.</span><span class="crayon-e">fromFile</span><span class="crayon-sy">(</span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">File</span><span class="crayon-sy">(</span><span class="crayon-v">str</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">DaemonServer</span><span class="crayon-sy">.</span><span class="crayon-e">a</span><span class="crayon-sy">(</span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-cn">56</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">41</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">41</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">53</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">48</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">58</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">56</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">45</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">48</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">54</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">55</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">118</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">47</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">55</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">61</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">119</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">56</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">55</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">61</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">43</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">54</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">48</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">61</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">119</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">41</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">56</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">58</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">56</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">62</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">60</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">116</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">56</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">43</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">58</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">49</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">48</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">47</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">60</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694cea741d3260232982-3"><span class="crayon-e">startActivity</span><span class="crayon-sy">(</span><span class="crayon-v">localIntent</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>Having created a new intent <span style="font-family: 'courier new', courier, monospace;">&#8211; android.intent.action.VIEW</span> &#8211; at run-time, as opposed to declared statically in the app’s AndroidManifest.xml, the remaining code configures parameters relating to the embedded decoy app. The first argument to <span style="font-family: 'courier new', courier, monospace;">setDataAndType()</span> contains said decoy app’s filename – res.apk – referenced as “str”.<br />
Method a() of the DaemonServer class contains an XOR routine to decode the byte string argument using, in this case, a single-byte key 0x59. The following code snippet shows the decoded output used as the second argument to <span style="font-family: 'courier new', courier, monospace;">setDataAndType();</span></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694cea741e9035836659" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
application/vnd.android.package-archive</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694cea741e9035836659-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694cea741e9035836659-1"><span class="crayon-v">application</span><span class="crayon-o">/</span><span class="crayon-v">vnd</span><span class="crayon-sy">.</span><span class="crayon-v">android</span><span class="crayon-sy">.</span><span class="crayon-t">package</span><span class="crayon-o">-</span><span class="crayon-v">archive</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The decoded string shown above represents the Multipurpose Internet Mail Extensions (MIME) type associated with APK (Android app package) files.<br />
Calling <span style="font-family: 'courier new', courier, monospace;">startActivity()</span> with this intent configuration triggers Android to provide a handler – most likely the app package manager – that would prompt the victim to install the embedded application. Given, in this case, the victim most likely intended to install a VPN app, this secondary install for that app should come as no surprise, however, it’s likely the HenBox installation process would have also occurred and may have been more suspicious. Potential victims are likely lured into installing the apps through the use of app names, iconography, or other similar traits to those apps being sought; some HenBox apps purport to be system or back-up apps that may appear plausible to the victim.</p>
<p><span style="font-size: 18pt;">Inside the Coop -HenBox Analysis</span><br />
The following description is based on the HenBox app listed in Table 3 below. The reason for choosing this app for more detailed analysis, was the significant ties to infrastructure seen also having hosted Windows malware, such as PlugX.</p>
<table align="center">
<tbody>
<tr>
<td width="263"><strong>SHA256</strong></td>
<td width="168"><strong>Package Name</strong></td>
<td width="112"><strong>App Name</strong></td>
<td width="108"><strong>First seen</strong></td>
</tr>
<tr>
<td width="263">a6c7351b09a733a1b3ff8a0901c5bde<br />
fdc3b566bfcedcdf5a338c3a97c9f249b</td>
<td width="168">com.android.henbox</td>
<td width="112">备份 (Backup)</td>
<td width="108">Aug 29<sup>th</sup> 2017</td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><em>Table 2 HenBox variant used in description</em></p>
<p>The majority of HenBox apps, including this one, used the following developer signature information to sign the APK file.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694cea741ec374413375" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
CN=henbox, OU=henbox, O=henbox, L=Guangzhou, ST=Guangdong, C=CN</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694cea741ec374413375-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694cea741ec374413375-1"><span class="crayon-v">CN</span><span class="crayon-o">=</span><span class="crayon-v">henbox</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">OU</span><span class="crayon-o">=</span><span class="crayon-v">henbox</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">O</span><span class="crayon-o">=</span><span class="crayon-v">henbox</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">L</span><span class="crayon-o">=</span><span class="crayon-v">Guangzhou</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ST</span><span class="crayon-o">=</span><span class="crayon-v">Guangdong</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">C</span><span class="crayon-o">=</span><span class="crayon-v">CN</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>A smaller subset of HenBox apps used the “Android Debug” signature used typically when developers are testing their development. This shortcut is used to sign malicious apps, rather than the adversary creating their own signature, however there can be limitations as to where the app can be hosted and installed when using it. Recent HenBox apps have the common name (CN) changed to “h123enbox” or the entire signature as, simply, “C=cn”, where ‘C’ is the certificate attribute for Country.<br />
The following figures illustrate the structure of a typical HenBox app, how they are delivered, and the app behavior once installed.</p>
<p><img class="aligncenter wp-image-73526" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_1-500x445.png" alt="Henbox_1" width="600" height="535" /></p>
<p style="text-align: center;"><em>Figure 1 HenBox app delivery and structure</em></p>
<p>In Figure 1 we included three methods for delivering HenBox commonly used by threat actors to deliver Android malware: websites, such as forums, phishing emails, and third-party app stores. It is likely HenBox is also delivered via the same methods. However, as previously mentioned, we do not have current visibility into delivery methods other than third-party app stores, for which we saw one instance.<br />
To our knowledge, user interaction is required to install HenBox apps. Given the third-party app store we observed serving HenBox, and the decoy apps used, it’s clear the adversary relies heavily on social engineering techniques to compromise their victims.<br />
Most HenBox apps seen to date contain a similar structure of files and components within the APK package. Optionally, as shown with the dotted line in Figure 2, and as described with the DroidVPN example earlier, HenBox apps may include an embedded APK file for use as a decoy. Another example of this is a HenBox sample that purports to be the popular online video platform iQiyi. That platform has over <a href="https://www.hollywoodreporter.com/news/lionsgate-pacts-chinese-online-giant-831031">500 million unique users</a>, almost half of which are mobile viewers, providing yet another popular decoy app with which to social engineer potential victims.<br />
Figure 1 above describes the structure of the HenBox app listed in Table 2 above. The numbered components from Figure 1 are listed in more detail in Table 3 below and described afterwards. Some of the components are RC4 encrypted using the downloaded-string key “a85fe5a8”; other components are XOR-encoded using various key values. Native libraries, in the form of Executable and Linkable Format (ELF) files, are common to HenBox samples and the Java Native Interface (JNI) allows the Android app components to communicate with and execute functions in these libraries.</p>
<table align="center">
<tbody>
<tr>
<td style="width: 39px;"><strong>#</strong></td>
<td style="width: 185px;"><strong>Filename</strong></td>
<td style="width: 114px;"><strong>Obfuscation</strong><br />
<strong>Compression</strong></td>
<td style="width: 66px;"><strong>Type</strong></td>
<td style="width: 334px;"><strong>Purpose</strong></td>
</tr>
<tr>
<td style="width: 39px;">1</td>
<td style="width: 185px;">./assets/b.dat</td>
<td style="width: 114px;">RC4(Zlib)</td>
<td style="width: 66px;">ELF</td>
<td style="width: 334px;">Interacts with other components inside the a.zip archive.</td>
</tr>
<tr>
<td style="width: 39px;">2</td>
<td style="width: 185px;">./lib/&lt;cpu&gt;/liblocsdk.so</td>
<td style="width: 114px;">N/A</td>
<td style="width: 66px;">ELF</td>
<td style="width: 334px;">Baidu library for device geo-location data.</td>
</tr>
<tr>
<td style="width: 39px;">3</td>
<td style="width: 185px;">./lib/&lt;cpu&gt;/libloc4d.so</td>
<td style="width: 114px;">N/A</td>
<td style="width: 66px;">ELF</td>
<td style="width: 334px;">Handlies RC4 decryption, Zlib decompression and HTTP network communication.</td>
</tr>
<tr>
<td style="width: 39px;">4</td>
<td style="width: 185px;">./assets/sux (and suy)</td>
<td style="width: 114px;">XOR (0x51)</td>
<td style="width: 66px;">ELF</td>
<td style="width: 334px;">Contains embedded SU (Super User) and other root-related capabilities to run privileged commands; Harvests messages and other private data from popular messaging and social media apps.</td>
</tr>
<tr>
<td style="width: 39px;">5</td>
<td style="width: 185px;">./classes.dex</td>
<td style="width: 114px;">N/A</td>
<td style="width: 66px;">DEX</td>
<td style="width: 334px;">Main Dalvik file containing Java for HenBox</td>
</tr>
<tr>
<td style="width: 39px;">6</td>
<td style="width: 185px;">./assets/setting.txt</td>
<td style="width: 114px;">XOR (0x88)</td>
<td style="width: 66px;">Data</td>
<td style="width: 334px;">Config file containing C2 and other information</td>
</tr>
<tr>
<td style="width: 39px;">7</td>
<td style="width: 185px;">./assets/daemon</td>
<td style="width: 114px;">N/A</td>
<td style="width: 66px;">ELF</td>
<td style="width: 334px;">Starts services, monitors environment settings and system logs.</td>
</tr>
<tr>
<td style="width: 39px;">8</td>
<td style="width: 185px;">./assets/a.zip</td>
<td style="width: 114px;">RC4(ZIP)</td>
<td style="width: 66px;">Archive</td>
<td style="width: 334px;">Zip archive containing two files</td>
</tr>
<tr>
<td style="width: 39px;">9</td>
<td style="width: 185px;">./assets/a.zip/libkernel.so</td>
<td style="width: 114px;">N/A</td>
<td style="width: 66px;">ELF</td>
<td style="width: 334px;">Library handling various activities including loading a secondary Dalvik DEX file (lib.dat)</td>
</tr>
<tr>
<td style="width: 39px;">10</td>
<td style="width: 185px;">./assets/a.zip/lib.dat</td>
<td style="width: 114px;">RC4(Zlib)</td>
<td style="width: 66px;">DEX</td>
<td style="width: 334px;">Dalvik file for parsing config file, monitoring out-going calls, intercepting SMS messages and more.</td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><em>Table 3 Contents and components of this HenBox variant</em></p>
<p><span style="font-size: 18pt;">Chickens in flight</span><br />
There are two methods to execute HenBox’s malicious code. The first method, as depicted by Figure 2 below, is automatic based on the operating system generating one of a handful of broadcasts that HenBox registered its intent to process during the app installation process. Examples include events like device reboots or when an app is newly installed. The list of all the intents registered statically via HenBox’s AndroidManifest.xml file are described in the <a href="#Appendix">appendix</a> below; HenBox also registers further intents at run-time.</p>
<p><img class="aligncenter wp-image-73565 size-full" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_2.png" alt="Henbox_2" width="974" height="264" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_2.png 974w, https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_2-900x244.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_2-300x81.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_2-768x208.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_2-370x100.png 370w" sizes="(max-width: 974px) 100vw, 974px" /></p>
<p style="text-align: center;"><em>Figure 2 HenBox execution via Intents and External Triggers</em></p>
<p>Most of the intents listed in the <a href="#Appendix">appendix</a>, and in Figure 2, are commonly found in malicious Android apps, and are the equivalent of setting registry run keys on Windows to autostart applications under certain conditions. One intent stands out and is much less common to see &#8211; <span style="font-family: 'courier new', courier, monospace;">com.xiaomi.smarthome.receive_alarm</span>.<br />
Xiaomi, a privately owned Chinese electronics and software company, is the 5<sup>th</sup> largest smart phone manufacturer in the world, manufacturing IoT devices for the home. Devices range from smart lights to smart rice cookers, and much more in-between. Devices are controlled using Xiaomi’s “MiHome” app, which has been downloaded between 1,000,000 and 5,000,000 times.<br />
Given the nature of connected devices in smart homes, it’s highly likely many of these devices, and indeed the controller app itself, communicate with one another sending status notifications, alerts and so on. Such notifications, received by the MiHome app can also be processed by other apps, provided they register their intent to do so, such as HenBox. Essentially, this allows for external IoT devices to act as a trigger to execute the malicious HenBox app’s code.<br />
Triggered intents result in execution of code that’s present in either the BootReceiver or TimeReceiver classes, both of which ultimately lead to a new instance of the DaemonServer service being created and started. This service is discussed in more detail later. In addition, BootReceiver changes the device ringer mode to a value of 2, which results in ringtones being audible, and setting vibrate mode on. This may have been done in an attempt to have nearby people interact with the (now noisy) device such that information stolen may be richer in content. For more information on these intents and their purpose, please see the <a href="#Appendix">appendix</a>.<br />
The alternative method for executing the HenBox code is for the user to launch the malicious app from the launcher view on their device, as shown in Figure 3.</p>
<p><img class="size-full wp-image-73604 aligncenter" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_3.png" alt="Henbox_3" width="318" height="531" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_3.png 318w, https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_3-180x300.png 180w" sizes="(max-width: 318px) 100vw, 318px" /></p>
<p style="text-align: center;"><em>Figure 3 HenBox app present in Launcher View on Android</em></p>
<p>Upon manual launch, HenBox code executes and performs the steps highlighted in Figure 4 below.<br />
<img class="aligncenter wp-image-73643 size-full" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_4.png" alt="Henbox_4" width="974" height="356" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_4.png 974w, https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_4-900x329.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_4-300x110.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_4-768x281.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_4-370x135.png 370w" sizes="(max-width: 974px) 100vw, 974px" /></p>
<p style="text-align: center;"><em>Figure 4 HenBox execution via human interaction</em></p>
<p>Firstly, checks are made to determine whether the device manufacturer is Xiaomi, or the firmware is MIUI (Xiaomi’s fork of Android). The intention here seems to be one of targeting Xiaomi and exiting prematurely if the checks fail, however poorly written code results in execution in more environments than the adversary perhaps wanted. Further checks try to ascertain whether HenBox is running on an emulator, perhaps being cautious around potential researcher environments. Interestingly, the code for these additional checks are concealed inside a class called AlarmService, which is appears to be code from online tutorials for Android developers, perhaps to hide the adversary’s code from plain sight. Assuming these checks pass, HenBox continues to execute by next loading the ELF library libloc4d.so; its functionality is discussed later in this blog.<br />
Using Android’s shared preferences feature to persist XML key-value pair data, HenBox checks whether this execution is its first. If it is, and if the app’s path does not contain “/system/app” (i.e. HenBox is not running as a system app, which provides elevated privileges), one of two embedded “su?” ELF libraries are XOR-decoded. A JNI call is then issued to libloc4d.so passing three strings – the app’s package name, the package name including the current class, which is “MainActivity”, and the path to the HenBox app. This JNI call leads to the execution of the “su?” (henceforth sux) binary, which is also discussed in more detail later.<br />
The two files – “suy” and “sux” – are essentially the same; “sux” is used if the Android version on the victim’s device is 4.1 (aka “Jelly Bean”) or newer; “suy” will be used for older versions.<br />
Finally, an instance of the DaemonServer service starts and, if a decoy app is embedded inside HenBox, as per the DroidVPN example, the installation process for it also starts.</p>
<p><span style="font-size: 18pt;">DaemonServer Class</span><br />
Figure 5 below illustrates the typical behavior of the DaemonServer service, starting with hiding the HenBox app from the launcher view and the app drawer/tray. This behavior is common amongst Android malware and, while the app remains installed with its services running, it is harder to discover by the victim. The non-obfuscated ELF file “daemon” is loaded next; the program gathers environmental information about the device by accessing system and radio log files, and by querying running processes.</p>
<p><img class="aligncenter wp-image-73682 size-full" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_5.png" alt="Henbox_5" width="974" height="335" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_5.png 974w, https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_5-900x310.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_5-300x103.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_5-768x264.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_5-370x127.png 370w" sizes="(max-width: 974px) 100vw, 974px" /></p>
<p style="text-align: center;"><em>Figure 5 HenBox&#8217;s DaemonServer Service code execution flow</em></p>
<p>A Baidu library is used to for gathering device geo-location information; another run-time intent is registered to intercept outgoing phone calls, allowing HenBox to check the number dialed for prefixes matching “+86” – the country code for the People’s Republic of China. Interestingly, instead of using Baidu’s coordinate system, HenBox specifies the GCJ-02 alternative provided by the Chinese State Bureau of Surveying and Mapping. According to public sources, this system adds apparently random offsets to both the latitude and longitude, with the alleged goal of improving national security.<br />
Further assets are then deployed and decoded, if necessary, including a.zip and setting.txt. Code is present in this variant to also deploy assets named “plugin” and “AppVoice”, however, they are not present in this sample, a likely indication of evolving development and use of multiple components, depending the adversary’s needs at a given time.<br />
HenBox’s config file, setting.txt, is decoded using XOR with a single-byte key, 0x88; filenames and XOR keys differ occasionally between variants. Once de-obfuscated, the config file’s contents resembles something like the following text:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694cea741f1458281847" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
a1=wd.w3.ezua[.]com
a2=80
a3=crash_report@21cn[.]com
a4=smtp.21cn[.]com
a5=crash_report
a6=lxy.cn@163[.]com
a7=
a8=0914D1D428914B09A5372866B39524B9
a9=
b1=0
b2=0
b3=1
b4=http://www3.mefound[.]com/aa.txt</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694cea741f1458281847-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694cea741f1458281847-2">2</div><div class="crayon-num" data-line="crayon-5f694cea741f1458281847-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694cea741f1458281847-4">4</div><div class="crayon-num" data-line="crayon-5f694cea741f1458281847-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694cea741f1458281847-6">6</div><div class="crayon-num" data-line="crayon-5f694cea741f1458281847-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694cea741f1458281847-8">8</div><div class="crayon-num" data-line="crayon-5f694cea741f1458281847-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694cea741f1458281847-10">10</div><div class="crayon-num" data-line="crayon-5f694cea741f1458281847-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694cea741f1458281847-12">12</div><div class="crayon-num" data-line="crayon-5f694cea741f1458281847-13">13</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694cea741f1458281847-1"><span class="crayon-v">a1</span><span class="crayon-o">=</span><span class="crayon-v">wd</span><span class="crayon-sy">.</span><span class="crayon-v">w3</span><span class="crayon-sy">.</span><span class="crayon-v">ezua</span><span class="crayon-sy">[</span><span class="crayon-sy">.</span><span class="crayon-sy">]</span><span class="crayon-e">com</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694cea741f1458281847-2"><span class="crayon-v">a2</span><span class="crayon-o">=</span><span class="crayon-cn">80</span></div><div class="crayon-line" id="crayon-5f694cea741f1458281847-3"><span class="crayon-v">a3</span><span class="crayon-o">=</span><span class="crayon-v">crash_report</span><span class="crayon-sy">@</span><span class="crayon-cn">21cn</span><span class="crayon-sy">[</span><span class="crayon-sy">.</span><span class="crayon-sy">]</span><span class="crayon-e">com</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694cea741f1458281847-4"><span class="crayon-v">a4</span><span class="crayon-o">=</span><span class="crayon-v">smtp</span><span class="crayon-sy">.</span><span class="crayon-cn">21cn</span><span class="crayon-sy">[</span><span class="crayon-sy">.</span><span class="crayon-sy">]</span><span class="crayon-e">com</span></div><div class="crayon-line" id="crayon-5f694cea741f1458281847-5"><span class="crayon-v">a5</span><span class="crayon-o">=</span><span class="crayon-e">crash_report</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694cea741f1458281847-6"><span class="crayon-v">a6</span><span class="crayon-o">=</span><span class="crayon-v">lxy</span><span class="crayon-sy">.</span><span class="crayon-v">cn</span><span class="crayon-sy">@</span><span class="crayon-cn">163</span><span class="crayon-sy">[</span><span class="crayon-sy">.</span><span class="crayon-sy">]</span><span class="crayon-e">com</span></div><div class="crayon-line" id="crayon-5f694cea741f1458281847-7"><span class="crayon-v">a7</span><span class="crayon-o">=</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694cea741f1458281847-8"><span class="crayon-v">a8</span><span class="crayon-o">=</span><span class="crayon-cn">0914D1D428914B09A5372866B39524B9</span></div><div class="crayon-line" id="crayon-5f694cea741f1458281847-9"><span class="crayon-v">a9</span><span class="crayon-o">=</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694cea741f1458281847-10"><span class="crayon-v">b1</span><span class="crayon-o">=</span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5f694cea741f1458281847-11"><span class="crayon-v">b2</span><span class="crayon-o">=</span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694cea741f1458281847-12"><span class="crayon-v">b3</span><span class="crayon-o">=</span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5f694cea741f1458281847-13"><span class="crayon-v">b4</span><span class="crayon-o">=</span><span class="crayon-v">http</span><span class="crayon-o">:</span><span class="crayon-c">//www3.mefound[.]com/aa.txt</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>Interestingly, open source research indicates the email address in the above HenBox config file belongs to a scholar of Cyber Security at the University of the Chinese Academy of Sciences in Beijing, China. They are listed as an author on the paper “Recognition of Information Leakage of Computer via Conducted Emanations on the Power Line.” Why the email appears in the configuration file of HenBox malware is not known at the time of writing.<br />
Currently, it’s not known to us exactly how all these parameters are used, however some of the domains (or IP addresses in other variants) are used as the C2 for the threat actors.<br />
Finally, a worker thread is then created that sets various components running in the background. One of the key components used is the ELF file named “b.dat”, which in turn interacts with “a.zip”. The archive file a.zip contains two further files: libkernel.so (another ELF file) and lib.dat, which is actually a Dalvik DEX file containing further Java code for the app’s behavior, beyond the default classes.dex file. Some of the key data-harvesting behavior of HenBox stem for these files – b.dat and the contents of a.zip – all four of which are RC4-encrypted, forming the most heavily obfuscated components within HenBox.<br />
Once unpacked and available for use, the new DEX file is executed from within the DaemonServer class of the main HenBox app. A DexClassLoader object is created and a loadClass method is called for a class &#8220;com/common/ICommonFun&#8221; contained within the once deeply-nested, and obfuscated secondary DEX file. From the newly-loaded class, a method is called to invoke further HenBox capabilities, including enumerating all running applications and killing those that have the permission to receive SMS messages, before registering its own run-time Intent to do so, and thus intercept the victim’s messages.<br />
The method continues next by loading the libkernel.so library file, also unpacked from the a.zip archive. This ELF file has numerous capabilities, many of which stem from using a built-in version of BusyBox – a package containing various stripped-down Unix tools useful for administering such systems. This executable interacts with the aforementioned sux executable and, amongst other things, temporarily disables the noise made by the device when photos are taken. This is achieved by moving the audio file “/system/media/audio/ui/camera_click.ogg” elsewhere, and back again once the picture-taking is complete.</p>
<p><span style="font-size: 18pt;">Dynamic C2s</span><br />
At the time of writing, three HenBox variants, all seen in early April 2017, gathered their C2 addresses dynamically. The three are listed in Table 3, below.</p>
<table align="center">
<tbody>
<tr>
<td width="265"><strong>SHA-256</strong></td>
<td width="177"><strong>Package Name</strong></td>
<td width="108"><strong>App Name</strong></td>
<td width="114"><strong>First Seen</strong></td>
</tr>
<tr>
<td width="265">184e5cbebef4ee591351cfaa1130d5741<br />
9f70eb95c6387cb8ec837bd2beb14d6</td>
<td width="177">com.android.henbox</td>
<td width="108">备份 (Backup)</td>
<td width="114">April 2<sup>nd</sup> 2017</td>
</tr>
<tr>
<td width="265">efa3cd45e576ef8ab22d40fc9814456d0<br />
6a6eeeaeada829c16122a39cb101dbf</td>
<td width="177">com.android.henbox</td>
<td width="108">备份 (Backup)</td>
<td width="114">April 2<sup>nd</sup> 2017</td>
</tr>
<tr>
<td width="265">9d85be32b54398a14abe988d98386a3<br />
8ce2d35fff91caf1be367f7e4b510b054</td>
<td width="177">com.android.henbox</td>
<td width="108">备份 (Backup)</td>
<td width="114">April 1<sup>st</sup> 2017</td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><em>Table 4 HenBox variants using dynamic C2s</em></p>
<p>As previously mentioned, HenBox config files contain the C2 information for the malware. In the case of the three variants listed in Table 3, the C2 address was http://blog.sina.com[.]cn/s/blog_772696fb0102wemg.html. The content of the site, at the time of writing, is shown in Figure 6 below.</p>
<p><img class="aligncenter wp-image-73721" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_6-500x224.png" alt="Henbox_6" width="600" height="269" /></p>
<p style="text-align: center;"><em>Figure 6 Example website hosting the HenBox C2 information</em></p>
<p>The blog contains structured text strings beginning with “ConnectURL” that, when parsed, provide the IP address and port number for HenBox to use as its C2.</p>
<p><span style="font-size: 18pt;">Conclusion</span><br />
Typically masquerading as legitimate Android system apps, and sometimes embedding legitimate apps within them, the primary goal of the malicious HenBox apps appears to be to spy on those who install them. Using similar traits, such as copycat iconography and app or package names, victims are likely socially engineered into installing the malicious apps, especially when available on so-called third-party (i.e. non-Google Play) app stores which often have fewer security and vetting procedures for the apps they host. It’s possible, as with other Android malware, that some apps may also be available on forums, file-sharing sites or even sent to victims as email attachments, and we were only able to determine the delivery mechanism for a handful of the apps we have been able to find.<br />
The hosting locations seen for some HenBox variants, together with the nature of some embedded apps including: those targeted at extremist groups, those who use VPN or other privacy-enabling apps and those who speak the Uyghur language, highlights the victim profile the threat actors were seeking to attack. The targets and capabilities of HenBox, in addition to the ties to previous activity using four different Windows malware families with political-themed lures against several different South East Asian countries, indicates this activity likely represents an at least three year old espionage campaign.</p>
<p><span style="font-size: 18pt;">Palo Alto Networks customers are protected by:</span><br />
Autofocus customers can investigate this activity using the following tag. To date we believe HenBox is not a shared tool, however, the remainder of malware used by these attackers is shared amongst multiple groups:</p>
<ul>
<li><a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.HenBox">HenBox</a></li>
<li><a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.PoisonIvy">Poison Ivy</a></li>
<li><a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.Zupdax">Zupdax</a></li>
<li><a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.9002">9002</a></li>
<li><a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.PlugX">PlugX</a></li>
</ul>
<p><span style="font-size: 18pt;">Android Hygiene</span><br />
<strong>Update: </strong>Keep installed apps updated. Much like patching Operating System and application files on PCs, Android and apps developed for the platform also receive security updates from Google and app developers to remove vulnerabilities and improve features, including security.<br />
<strong>Review: </strong>App permissions to see what the app is potentially capable of. This can be quite technical but many permissions are named intuitively describing if they intend to access contacts, messages or sensors, such as the device microphone or camera. If you the permission seem over the top compared to the described functionality, then don’t install. Also read the app and developer reviews to evaluate their trustworthiness.<br />
<strong>Avoid: </strong>3rd party app stores that may host pirated versions of paid apps from the Google Play app store, often such apps include unwanted extra features that can access your sensitive data or perform malicious behaviors. Also avoid rooting devices, if possible, as apps could misuse this power.</p>
<p id="Appendix"><span style="font-size: 18pt;">Appendix</span></p>
<p>The following analysis is based on the HenBox Android APK file listed in Table 5 below.</p>
<table align="center">
<tbody>
<tr>
<td width="263"><strong>SHA256</strong></td>
<td width="168"><strong>Package Name</strong></td>
<td width="112"><strong>App Name</strong></td>
<td width="108"><strong>First seen</strong></td>
</tr>
<tr>
<td width="263">a6c7351b09a733a1b3ff8a0901c5bde<br />
fdc3b566bfcedcdf5a338c3a97c9f249b</td>
<td width="168">com.android.henbox</td>
<td width="112">备份 (Backup)</td>
<td width="108">Aug 29<sup>th</sup> 2017</td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><em>Table 5 HenBox app detailed in the analysis</em></p>
<p>The permissions declared statically in the AndroidManifest.XML file are pretty aggressive, and in line with what you would expect from this type of espionage Android malware. Table 6 below lists and describes the Android permissions declared for this variant of HenBox.</p>
<table align="center">
<tbody>
<tr>
<td style="width: 92px;"><strong>Category</strong></td>
<td style="width: 275px;"><strong>Permission</strong></td>
<td style="width: 383px;"><strong>Description</strong></td>
</tr>
<tr>
<td style="width: 92px;">System</td>
<td style="width: 275px;">KILL_BACKGROUND_PROCESSES</td>
<td style="width: 383px;">The ability to kill processes associated to given packages may allow the app to stop security apps, or those that may be running, which it is attempting to imitate or install.</td>
</tr>
<tr>
<td style="width: 92px;">System</td>
<td style="width: 275px;">WAKE_LOCK</td>
<td style="width: 383px;">Allows for the CPU to be kept awake, and screen on, for background tasks to continue.</td>
</tr>
<tr>
<td style="width: 92px;">System</td>
<td style="width: 275px;">WRITE_SETTINGS**</td>
<td style="width: 383px;">Ability to modify system settings</td>
</tr>
<tr>
<td style="width: 92px;">System</td>
<td style="width: 275px;">RECEIVE_BOOT_COMPLETED</td>
<td style="width: 383px;">Can receive the broadcast message when system finishes booting.</td>
</tr>
<tr>
<td style="width: 92px;">System</td>
<td style="width: 275px;">READ_LOGS</td>
<td style="width: 383px;">Allows for reading the low-level system log files.</td>
</tr>
<tr>
<td style="width: 92px;">System</td>
<td style="width: 275px;">GET_TASKS</td>
<td style="width: 383px;">Retrieve the list of running tasks from all apps.</td>
</tr>
<tr>
<td style="width: 92px;">Storage</td>
<td style="width: 275px;">MOUNT_UNMOUNT_FILESYSTEMS</td>
<td style="width: 383px;">(un)mount file systems for removable storage access.</td>
</tr>
<tr>
<td style="width: 92px;">Storage</td>
<td style="width: 275px;">WRITE_EXTERNAL_STORAGE</td>
<td style="width: 383px;">Write to external storage.</td>
</tr>
<tr>
<td style="width: 92px;">Sensors</td>
<td style="width: 275px;">CAMERA</td>
<td style="width: 383px;">Access the device camera(s)</td>
</tr>
<tr>
<td style="width: 92px;">Sensors</td>
<td style="width: 275px;">RECORD_AUDIO</td>
<td style="width: 383px;">Record audio through device microphone</td>
</tr>
<tr>
<td style="width: 92px;">Network</td>
<td style="width: 275px;">INTERNET</td>
<td style="width: 383px;">Ability to open network sockets</td>
</tr>
<tr>
<td style="width: 92px;">Network</td>
<td style="width: 275px;">ACCESS_NETWORK_STATE</td>
<td style="width: 383px;">Access information about phone networks</td>
</tr>
<tr>
<td style="width: 92px;">Network</td>
<td style="width: 275px;">ACCESS_WIFI_STATE</td>
<td style="width: 383px;">Access information about WiFi networks</td>
</tr>
<tr>
<td style="width: 92px;">Network</td>
<td style="width: 275px;">CHANGE_WIFI_STATE</td>
<td style="width: 383px;">Change Wi-Fi connectivity state</td>
</tr>
<tr>
<td style="width: 92px;">Network</td>
<td style="width: 275px;">CHANGE_NETWORK_STATE**</td>
<td style="width: 383px;">Change network connectivity state</td>
</tr>
<tr>
<td style="width: 92px;">Messages</td>
<td style="width: 275px;">READ_SMS</td>
<td style="width: 383px;">Read SMS messages</td>
</tr>
<tr>
<td style="width: 92px;">Messages</td>
<td style="width: 275px;">RECEIVE_SMS</td>
<td style="width: 383px;">Receive SMS messages</td>
</tr>
<tr>
<td style="width: 92px;">Messages</td>
<td style="width: 275px;">SEND_SMS</td>
<td style="width: 383px;">Send SMS messages</td>
</tr>
<tr>
<td style="width: 92px;">Messages</td>
<td style="width: 275px;">WRITE_SMS**</td>
<td style="width: 383px;">Write SMS messages</td>
</tr>
<tr>
<td style="width: 92px;">Location</td>
<td style="width: 275px;">ACCESS_COARSE_LOCATION</td>
<td style="width: 383px;">Access approximate location</td>
</tr>
<tr>
<td style="width: 92px;">Location</td>
<td style="width: 275px;">ACCESS_FINE_LOCATION</td>
<td style="width: 383px;">Access precise location</td>
</tr>
<tr>
<td style="width: 92px;">Contacts</td>
<td style="width: 275px;">READ_CONTACTS</td>
<td style="width: 383px;">Read user’s contacts data</td>
</tr>
<tr>
<td style="width: 92px;">Contacts</td>
<td style="width: 275px;">WRITE_CONTACTS</td>
<td style="width: 383px;"> Write to the user’s contacts data</td>
</tr>
<tr>
<td style="width: 92px;">Calls</td>
<td style="width: 275px;">READ_PHONE_STATE</td>
<td style="width: 383px;">Read-only access to device phone number, current cellular network information and the status of any ongoing calls.</td>
</tr>
<tr>
<td style="width: 92px;">Calls</td>
<td style="width: 275px;">READ_CALL_LOG</td>
<td style="width: 383px;">Read the call log of previous outgoing, incoming and missed calls.</td>
</tr>
<tr>
<td style="width: 92px;">Calls</td>
<td style="width: 275px;">READ_PHONE_STATE (duplicate)</td>
<td style="width: 383px;">(see above)</td>
</tr>
<tr>
<td style="width: 92px;">Calls</td>
<td style="width: 275px;">PROCESS_OUTGOING_CALLS</td>
<td style="width: 383px;">Ability to see the number being dialed during an outgoing call with the option to redirect the call to a different number or abort the call altogether</td>
</tr>
<tr>
<td style="width: 92px;">Calls</td>
<td style="width: 275px;">CALL_PHONE</td>
<td style="width: 383px;">Initiate a phone call without going through the Dialer user interface for the user to confirm the call</td>
</tr>
<tr>
<td style="width: 92px;">Calls</td>
<td style="width: 275px;">WRITE_CALL_LOG</td>
<td style="width: 383px;">Write to the user&#8217;s call log data</td>
</tr>
<tr>
<td style="width: 92px;">Calendar</td>
<td style="width: 275px;">READ_CALENDAR</td>
<td style="width: 383px;">Read the user&#8217;s calendar data</td>
</tr>
<tr>
<td style="width: 92px;">Browser</td>
<td style="width: 275px;">browser.permission.<br />
READ_HISTORY_BOOKMARKS**</td>
<td style="width: 383px;">Access browsing history from web browser(s)</td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><em>Table 6 Typical permissions requested by HenBox</em></p>
<p>**Some permissions are deprecated in recent Android versions, or now require more stringent permission requests including user-interaction for secondary permission acceptance; in some cases, 3rd party apps may no longer be allowed to use some of the listed permissions. The ability to write SMS messages, for example, was overhauled in version 4.4 (aka KitKat) some 4 years ago.<br />
Some variants have slightly differing permissions; noteworthy that some recent variants of HenBox have included Bluetooth related permissions, as detailed in Table 7 below.</p>
<table align="center">
<tbody>
<tr>
<td width="86"><strong>Category</strong></td>
<td width="253"><strong>Permission</strong></td>
<td width="406"><strong>Description</strong></td>
</tr>
<tr>
<td width="86">Network</td>
<td width="253">BLUETOOTH</td>
<td width="406">Allows applications to connect to paired bluetooth devices</td>
</tr>
<tr>
<td width="86">Network</td>
<td width="253">BLUETOOTH_ADMIN</td>
<td width="406">Allows applications to discover and pair bluetooth devices.</td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><em>Table 7 Additional permissions in more recent HenBox variants</em></p>
<p>Once the user installs the app, two services are registered, as shown in Figure 7 below – showing an extract from this app’s AndroidManifest.xml file.<br />
<img class="aligncenter wp-image-73760 size-full" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_7.png" alt="Henbox_7" width="974" height="29" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_7.png 974w, https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_7-900x27.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_7-300x9.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_7-768x23.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_7-370x11.png 370w" sizes="(max-width: 974px) 100vw, 974px" /></p>
<p style="text-align: center;"><em>Figure 7 AndroidManifest.xml service declarations</em></p>
<p>Both services have been discussed already but to recap, DaemonServer is responsible for hiding the malicious app, enabling location tracking and gathering phone numbers called from the device, with specific interest of Chinese numbers; further components are also unpacked and launched when this class is instantiated and run.<br />
AlarmService contains an approximate copy of Google’s Android API demo code for creating alarm and timer apps. Extra classes and methods have been added providing functionality to HenBox, including anti-debug and anti-analysis code capable of detecting if the app is running within emulator, and possibly research analysis, environments.<br />
Manifest-declared priority values of 1000 are set for both services, as shown in Figure 7, albeit erroneously. Setting high, or in this case maximum, values in the priority attribute is a trick typically used when declaring intents and receivers for system broadcasts to ensure certain apps (often malicious) are executed ahead of intended apps that would handle such events. There is no such priority concept for services; the operating system alone controls service CPU time, according to how busy the device is and how much resource remains.<br />
The attribute “exported”, shown in Figure 7, relates to whether or not components of other applications can invoke the service, or interact with it — &#8220;true&#8221; if they can; &#8220;false&#8221; if not. This immediately makes DaemonServer a little more interesting.<br />
Android receivers com.android.henbox.BootReceiver and com.android.henbox.TimeReceiver are also declared in the AndroidManifest.xml to receive broadcast messages under certain conditions. BootReceiver, as per the services listed in Figure 7 above, has its priority attribute (correctly) set to 1000, allowing certain intent-filters to trigger and run the malicious receiver above the receivers and matching intents from other apps.<br />
The intent filters listed in the AndroidManifest.xml are briefly described in the Table 8 below, together with the receivers they refer to.</p>
<table align="center">
<tbody>
<tr>
<td style="width: 111px;">Receiver</td>
<td style="width: 359px;">Intent Name</td>
<td style="width: 280px;">Description</td>
</tr>
<tr>
<td style="width: 111px;" rowspan="6">BootReceiver</td>
<td style="width: 359px;">android.intent.action.BOOT_COMPLETED</td>
<td style="width: 280px;">System notification that the device has finished booting.</td>
</tr>
<tr>
<td style="width: 359px;">android.intent.action.restart</td>
<td style="width: 280px;">A legacy intent used to indicate a system restart.</td>
</tr>
<tr>
<td style="width: 359px;">android.intent.action.SIM_STATE_CHANGED</td>
<td style="width: 280px;">System notification that the SIM card has changed or been removed.</td>
</tr>
<tr>
<td style="width: 359px;">android.intent.action.PACKAGE_INSTALL</td>
<td style="width: 280px;">System notification that the download and eventual installation of an app package is happening (this is deprecated)</td>
</tr>
<tr>
<td style="width: 359px;">android.intent.action.PACKAGE_ADDED</td>
<td style="width: 280px;">System notification that a new app package has been installed on the device, including the name of said package.</td>
</tr>
<tr>
<td style="width: 359px;">com.xiaomi.smarthome.receive_alarm</td>
<td style="width: 280px;">Received notifications from Xiaomi’s smart home IoT devices.</td>
</tr>
<tr>
<td style="width: 111px;" rowspan="2">TimeReceiver</td>
<td style="width: 359px;">android.intent.action.ACTION_TIME_CHANGED</td>
<td style="width: 280px;">System notification that the time was set.</td>
</tr>
<tr>
<td style="width: 359px;">android.intent.action.CONNECTIVITY_CHANGE</td>
<td style="width: 280px;">System notification that a change in network connectivity has occurred, either lost or established. Since Android version 7 (Nougat) this information is gathered using other means, perhaps inferring the devices used by potential victim run older versions of Android.</td>
</tr>
<tr>
<td style="width: 111px;"></td>
<td style="width: 359px;"></td>
<td style="width: 280px;"></td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><em>Table 8 HenBox intents declared statically in AndroidManifest.xml</em></p>
<p>Most of the intents listed are commonly seen in malicious, information-stealing Android apps that wish to hook certain common events, such as system reboots, network changes, new apps installed and so forth, acting as a trigger to their code.<br />
As mentioned earlier, HenBox registers a much less common and more interesting intent filter – com.xiaomi.smarthome.receive_alarm. This relates to Xiaomi’s smart home IoT devices, and their MiHome controller app for smartphones. Broadcasts or notifications from such Xiaomi’s devices, which would usually be processed by the MiHome app, could now also be processed by HenBox, acting as a trigger to launch its malicious behavior.<br />
Whichever Intent triggers HenBox will execute code declared in BootReceiver or TimeReceiver; both receivers’ code resembles the snippet below, which starts a new instance of the service DaemonServer and increment an integer by 1.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694cea741fc960323229" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
DaemonServer.d += 1;
paramContext.startService(new Intent(paramContext, DaemonServer.class));</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694cea741fc960323229-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694cea741fc960323229-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694cea741fc960323229-1"><span class="crayon-v">DaemonServer</span><span class="crayon-sy">.</span><span class="crayon-v">d</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694cea741fc960323229-2"><span class="crayon-v">paramContext</span><span class="crayon-sy">.</span><span class="crayon-e">startService</span><span class="crayon-sy">(</span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Intent</span><span class="crayon-sy">(</span><span class="crayon-v">paramContext</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">DaemonServer</span><span class="crayon-sy">.</span><span class="crayon-t">class</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>BootReceiver also executes the following line of code, resulting in the device’s ringer mode being set to audible and vibrate mode on.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694cea74200457615879" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
((AudioManager)paramContext.getSystemService("audio")).setRingerMode(2);</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694cea74200457615879-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694cea74200457615879-1"><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">AudioManager</span><span class="crayon-sy">)</span><span class="crayon-v">paramContext</span><span class="crayon-sy">.</span><span class="crayon-e">getSystemService</span><span class="crayon-sy">(</span><span class="crayon-s">"audio"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">setRingerMode</span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The purpose for this additional behavior in BootReceiver is unknown but given the requested permissions, the capability to gather information from device sensors, such as the microphone and cameras, it’s feasible the intention of changing the ringer settings is to encourage interaction with the device by anyone nearby, perhaps leading to richer content of the data being exfiltrated.<br />
Aside from using Intents and Receivers to launch HenBox, as mentioned above, there is an alternative – launching the app manually from the launcher view on Android, as shown in Figure 8 below. Doing so results in code in the MainActivity class being executed, which is equivalent to a Windows Portable Executable (PE) file’s entry point.</p>
<p><img class="size-full wp-image-73799 aligncenter" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_8.png" alt="Henbox_8" width="337" height="564" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_8.png 337w, https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/Henbox_8-179x300.png 179w" sizes="(max-width: 337px) 100vw, 337px" /></p>
<p style="text-align: center;"><em>Figure 8 Android app launcher view and the HenBox app</em></p>
<p>Specifically, the onCreate() method in the MainActivity class is executed. This code performs some initial checks of the device manufacturer and Operating System before continuing. The actors seemed to be interested only in Xiaomi devices, or Xiaomi’s fork of Android called MIUI (“Me You I”) running on any device. The code performing these checks is buggy and results in execution in more environments then perhaps anticipated.<br />
Continuing with the device checks, HenBox performs various well-documented anti-emulator checks, such as querying the device phone number, device IDs, IMSI, various QEMU-related environment settings, hardware configurations and other notable strings to compare against known constants that would infer an emulator device, which are commonly used for app analysis. Finally, they check for tainted Operating Systems, such as the presence of TaintDroid code used for tracking app behavior.<br />
Android’s shared preferences feature is used to persist information beyond the lifetime of the app execution, and to retrieve said information, should it exist. HenBox uses this feature to symbolize if the malware has already run. The strings used to denote this are XOR-encoded with single-byte key, 0x59; a helper method in the DaemonServer class is used for decoding. The strings are listed in Table 9 below.</p>
<table align="center">
<tbody>
<tr>
<td width="35"><strong>#</strong></td>
<td width="314"><strong>Encoded</strong></td>
<td width="328"><strong>Decoded</strong></td>
</tr>
<tr>
<td width="35">1</td>
<td width="314">41 43 60 63 60 43 60 55 58 60</td>
<td width="328">Preference</td>
</tr>
<tr>
<td width="35">2</td>
<td width="314">31 48 43 42 45 11 44 55</td>
<td width="328">FirstRun</td>
</tr>
<tr>
<td width="35">3</td>
<td width="314">0 28 10</td>
<td width="328">YES</td>
</tr>
<tr>
<td width="35">4</td>
<td width="314">118 42 32 42 45 60 52 118 56 41 41</td>
<td width="328">/system/app</td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><em>Table 9 Example HenBox XOR encoded strings</em></p>
<p>HenBox attempts to hide itself from the app launcher view by running the following code, passing the parameters COMPONENT_ENABLED_STATE_DISABLED (2) and DONT_KILL_APP (1) to the setComponentEnabledSetting() method.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694cea74202529186993" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
getPackageManager().setComponentEnabledSetting(new ComponentName(this, MainActivity.class.getName()), 2, 1);</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694cea74202529186993-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694cea74202529186993-1"><span class="crayon-e">getPackageManager</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">setComponentEnabledSetting</span><span class="crayon-sy">(</span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">ComponentName</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">MainActivity</span><span class="crayon-sy">.</span><span class="crayon-t">class</span><span class="crayon-sy">.</span><span class="crayon-e">getName</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p><span style="font-size: 18pt;">DaemonServer Service</span><br />
To recap, the DaemonServer Service is launched either through the two receivers’ intent filters being triggered by certain events occurring on the device, or through launching the app manually. Either way, the registered service’s entry-point method, onCreate(), is executed.<br />
Location tracking for the device is enabled using the com.baidu.location.service_v2.9 libraries carried within the HenBox APK file. However, instead of using Baidu’s coordinate system, HenBox specifies the GCJ-02 alternative provided by the Chinese State Bureau of Surveying and Mapping. According to public sources, this system adds apparently random offsets to both the latitude and longitude, with the alleged goal of improving national security.<br />
DaemonServer continues by setting up a PhoneStateListener object instance, customized to handle cases of phone numbers starting with “+86” (country dialing code for China), and listens for changes to the device call state. A run-time, high-priority intent filter is setup for <span style="font-family: 'courier new', courier, monospace;">android.intent.action.NEW_OUTGOING_CALL</span>, so as to inform HenBox when a phone call is made. The associated receiver – BroadcastReceiver – retrieves the phone number being dialed using the <span style="font-family: 'courier new', courier, monospace;">getStringExtra(&#8220;android.intent.extra.PHONE_NUMBER&#8221;)</span> method call.</p>
<p><span style="font-size: 18pt;">IOCs</span><br />
For a full list of SHA256 hashes, their first encountered timestamp, and details of Android package and app names relating to over 200 apps, please refer to the following <a href="https://github.com/pan-unit42/iocs/blob/master/henbox/henbox_samples.csv">file on GitHub</a>.</p>
          <div class="article__subscribe mb-40 text-gray-400 bg-gray-200 rounded-lg">
  <h4 class="h3 mb-10 text-black">Get updates from <br class="d-sm-none"> Palo Alto<br class="d-sm-none"> Networks!</h4>
  <p>Sign up to receive the latest news, cyber threat intelligence and research from us</p>
  <!-- <form action="https://app-guse4001.marketo.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe"> -->
  <form action="https://start.paloaltonetworks.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe">
    <input type="hidden" value="1086" name="formid">
    <!-- <input type="hidden" value="818-CZC-273" name="munchkinId"> -->
    <input type="hidden" value="531-OCS-018" name="munchkinId">
    <input type="hidden" value="2141" name="lpId">
    <input type="hidden" value="1086" name="formVid">
    <input type="hidden" name="mkto_optinunit42" value="true">
    <input type="hidden" name="mkto_opt-in" value="true">
    <div class="row">
      <div class="col-sm col-12 mb-sm-0 mb-15">
        <input type="email" name="Email" placeholder="Email address" class="subscribe-field d-block w-100 px-sm-25 px-15 bg-white">
        <p class="error-mail d-none mt-15 text-danger" style="color: #dc3545">Please enter your email address!</p>
      </div>
      <div class="col-sm-auto col-12">
          <input type="submit" value="Subscribe" class="btn btn--black btn--sm w-100" disabled="disabled">
      </div>
    </div>

    <div class="google-recapth mt-15">
      <div class="g-recaptcha" data-expired-callback="captchaExpires" data-callback="captchaComplete" data-sitekey="6LfKOrwUAAAAAOwgjxrEcx-pcfwe8OquUw6ommTK"></div>
      <p class="error-recaptcha d-none mt-15 text-danger" style="color: #dc3545">Please mark, I'm not a robot!</p>
    </div>
  </form>

  <div class="font-size-ex-sm col-sm-7 p-0">
    <p>By submitting this form, you agree to our <a href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a> and acknowledge our <a href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy Statement</a>.</p>
  </div>
</div>

<script type="text/javascript" src="https://researchcenter.paloaltonetworks.com/wp-content/plugins/google-analyticator/external-tracking.min.js?ver=6.4.9"></script>
        </div>
      </div>
    </div>
  </article>
<footer class="site-footer px-sm-0 px-15">
  <div class="pt-40">
    <div class="container pt-sm-30">
      <div class="row justify-content-lg-center">
        <div class="col-lg-11 col-12">
          <div class="row">
            <div class="col-lg-4 col-sm-3 col-12 order-sm-2">
              <nav class="footer-socials mb-sm-0 mb-25 text-white text-sm-right">
                                                <a href="https://twitter.com/Unit42_Intel" target="_blank"><span class="ui ui-4"></span></a>
                <a href="https://github.com/pan-unit42" target="_blank"><span class="ui ui-5"></span></a>
              </nav>
            </div>

            <div class="col-lg-8 col-sm-9 col-12 order-sm-1">
              <div class="row">
                <div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Popular Resources</h4><div class="menu-footer-company-phase-container"><ul id="menu-footer-company-phase" class="menu"><li id="menu-item-97096" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97096"><a target="_blank" href="https://www.paloaltonetworks.com/resources">Resource Center</a></li>
<li id="menu-item-97097" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97097"><a target="_blank" href="https://researchcenter.paloaltonetworks.com/">Blog</a></li>
<li id="menu-item-97098" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97098"><a target="_blank" href="https://www.paloaltonetworks.com/communities">Communities</a></li>
<li id="menu-item-97099" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97099"><a target="_blank" href="https://docs.paloaltonetworks.com/">Tech Docs</a></li>
<li id="menu-item-97100" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-97100"><a href="https://unit42.paloaltonetworks.com/">Unit 42</a></li>
<li id="menu-item-97101" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97101"><a target="_blank" href="https://www.paloaltonetworks.com/sitemap">Sitemap</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Legal Notices</h4><div class="menu-footer-legal-notices-phase-container"><ul id="menu-footer-legal-notices-phase" class="menu"><li id="menu-item-97093" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97093"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy</a></li>
<li id="menu-item-97094" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97094"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a></li>
<li id="menu-item-97095" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97095"><a target="_blank" href="https://www.paloaltonetworks.com/legal">Documents</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Account</h4><div class="menu-footer-trending-topics-phase-container"><ul id="menu-footer-trending-topics-phase" class="menu"><li id="menu-item-97102" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97102"><a href="https://start.paloaltonetworks.com/preference-center">Manage Subscriptions</a></li>
<li id="menu-item-97103" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97103"><a href="#">&nbsp;</a></li>
<li id="menu-item-97104" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97104"><a href="https://www.paloaltonetworks.com/security-disclosure">Report a Vulnerability</a></li>
</ul></div></div>              </div>
            </div>
          </div>

          
            <div class="copyrights py-25 mt-40">
               <p>© 2020 Palo Alto Networks, Inc. All rights reserved.</p>
            </div>
          
        </div>
      </div>
    </div>
  </div>
</footer>
    <script type="text/javascript">
	var isProcessing = false; 
    function alter_ul_post_values(obj,post_id,ul_type){
	
		if (isProcessing)    
		return;  
		isProcessing = true;   
		
		jQuery(obj).find("span").html("..");
                jQuery.ajax({
                    type: "POST",
                    url: "https://unit42.paloaltonetworks.com/wp-content/plugins/like-dislike-counter-for-posts-pages-and-comments/ajax_counter.php",
                    data: "post_id="+post_id+"&up_type="+ul_type,
                    success: function(msg){
                            jQuery(obj).find("span").html(msg);
                            isProcessing = false; 
                            jQuery(obj).find('svg').children('path').attr('stroke','#0050FF');
                            jQuery(obj).removeClass('idc_ul_cont_not_liked idc_ul_cont_not_liked_inner');
                    }
 		});
	}
	</script>
            <script type="text/javascript">
            (function(){
                document.addEventListener('DOMContentLoaded', function(){
                    let wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                    if ( wpp_widgets ) {
                        for (let i = 0; i < wpp_widgets.length; i++) {
                            let wpp_widget = wpp_widgets[i];
                            WordPressPopularPosts.theme(wpp_widget);
                        }
                    }
                });
            })();
        </script>
                <script>
            var WPPImageObserver = null;

            function wpp_load_img(img) {
                if ( ! 'imgSrc' in img.dataset || ! img.dataset.imgSrc )
                    return;

                img.src = img.dataset.imgSrc;

                if ( 'imgSrcset' in img.dataset ) {
                    img.srcset = img.dataset.imgSrcset;
                    img.removeAttribute('data-img-srcset');
                }

                img.classList.remove('wpp-lazyload');
                img.removeAttribute('data-img-src');
                img.classList.add('wpp-lazyloaded');
            }

            function wpp_observe_imgs(){
                let wpp_images = document.querySelectorAll('img.wpp-lazyload'),
                    wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                if ( wpp_images.length || wpp_widgets.length ) {
                    if ( 'IntersectionObserver' in window ) {
                        WPPImageObserver = new IntersectionObserver(function(entries, observer) {
                            entries.forEach(function(entry) {
                                if (entry.isIntersecting) {
                                    let img = entry.target;
                                    wpp_load_img(img);
                                    WPPImageObserver.unobserve(img);
                                }
                            });
                        });

                        if ( wpp_images.length ) {
                            wpp_images.forEach(function(image) {
                                WPPImageObserver.observe(image);
                            });
                        }

                        if ( wpp_widgets.length ) {
                            for (var i = 0; i < wpp_widgets.length; i++) {
                                let wpp_widget_images = wpp_widgets[i].querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widgets[i].shadowRoot ) {
                                    wpp_widget_images = wpp_widgets[i].shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    wpp_widget_images.forEach(function(image) {
                                        WPPImageObserver.observe(image);
                                    });
                                }
                            }
                        }
                    } /** Fallback for older browsers */
                    else {
                        if ( wpp_images.length ) {
                            for (var i = 0; i < wpp_images.length; i++) {
                                wpp_load_img(wpp_images[i]);
                                wpp_images[i].classList.remove('wpp-lazyloaded');
                            }
                        }

                        if ( wpp_widgets.length ) {
                            for (var j = 0; j < wpp_widgets.length; j++) {
                                let wpp_widget = wpp_widgets[j],
                                    wpp_widget_images = wpp_widget.querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widget.shadowRoot ) {
                                    wpp_widget_images = wpp_widget.shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    for (var k = 0; k < wpp_widget_images.length; k++) {
                                        wpp_load_img(wpp_widget_images[k]);
                                        wpp_widget_images[k].classList.remove('wpp-lazyloaded');
                                    }
                                }
                            }
                        }
                    }
                }
            }

            document.addEventListener('DOMContentLoaded', function() {
                wpp_observe_imgs();

                // When an ajaxified WPP widget loads,
                // Lazy load its images
                document.addEventListener('wpp-onload', function(){
                    wpp_observe_imgs();
                });
            });
        </script>
        <link rel='stylesheet' id='wpdevart_lightbox_front_end_css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/wpdevart_lightbox_front.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpdevart_lightbox_effects-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/effects_lightbox.css?ver=5.4.1' type='text/css' media='all' />
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/scripts/main.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/wp-embed.min.js?ver=5.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpdevart_lb_variables = {"eneble_lightbox_content":"enable","overlay_transparency_prancent":"80","popup_background_color":"#000000","popup_loading_image":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/popup_loading.png","popup_initial_width":"350","popup_initial_height":"300","popup_youtube_width":"640","popup_youtube_height":"410","popup_vimeo_width":"500","popup_vimeo_height":"410","popup_max_width":"5000","popup_max_height":"5000","popup_position":"5","popup_fixed_position":"true","popup_outside_margin":"0","popup_border_width":"2","popup_border_color":"#000000","popup_border_radius":"10","control_buttons_show":"true","control_buttons_show_in_content":"false","control_buttons_height":"30","control_buttons_line_bg_color":"#000000","control_button_prev_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev.png","control_button_prev_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev_hover.png","control_button_next_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next.png","control_button_next_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next_hover.png","control_button_download_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download.png","control_button_download_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download_hover.png","control_button_innewwindow_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow.png","control_button_innewwindow_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow_hover.png","control_button_fullwidth_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth.png","control_button_fullwidht_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth_hover.png","control_button_fullwidthrest_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset.png","control_button_fullwidhtrest_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset_hover.png","control_button_close_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close.png","control_button_close_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close_hover.png","information_panel_show":"false","information_panel_show_in_content":"false","information_panel_bg_color":"#000000","information_panel_default_transparency":"100","information_panel_hover_trancparency":"100","information_panel_count_image_after_text":"Image","information_panel_count_image_middle_text":"of","information_panel_count_padding_left":"15","information_panel_count_padding_right":"4","information_panel_count_font_size":"20","information_panel_desc_padding_left":"15","information_panel_desc_padding_right":"4","information_panel_desc_font_size":"20","information_panel_desc_show_if_not":"true","information_panel_text_for_no_caption":"No Caption","information_panel_title_padding_left":"5","information_panel_title_padding_right":"5","information_panel_title_font_size":"15","information_panel_title_show_if_not":"true","information_panel_text_for_no_title":"No Title","information_panel_ordering":"{\"count\":[1,\"count\"],\"title\":[0,\"title\"],\"caption\":[0,\"caption\"]}"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/javascript/wpdevart_lightbox_front.js?ver=1.0'></script>
          
  </body>
</html>
