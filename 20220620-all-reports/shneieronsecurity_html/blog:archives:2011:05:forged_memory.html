<!DOCTYPE html>
<html lang="en-US">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<title>Forged Memory - Schneier on Security</title>
	<meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel='dns-prefetch' href='//c0.wp.com' />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Feed" href="https://www.schneier.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Comments Feed" href="https://www.schneier.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Forged Memory Comments Feed" href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/feed/" />
<link rel='stylesheet' id='wp-block-library-css'  href='https://c0.wp.com/c/5.7/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all' />
<style id='wp-block-library-inline-css' type='text/css'>
.has-text-align-justify{text-align:justify;}
</style>
<style id='woocommerce-inline-inline-css' type='text/css'>
.woocommerce form .form-row .required { visibility: visible; }
</style>
<link rel='stylesheet' id='schneier-css'  href='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/style.css?ver=1.0.0' type='text/css' media='all' />
<link rel='stylesheet' id='schneier-main-css'  href='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/dist/css/style.css?ver=1.0.2' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css'  href='https://c0.wp.com/p/jetpack/9.5.2/css/jetpack.css' type='text/css' media='all' />
<script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js?ver=3.5.1' id='jquery-js'></script>
<link rel="https://api.w.org/" href="https://www.schneier.com/wp-json/" /><link rel="alternate" type="application/json" href="https://www.schneier.com/wp-json/wp/v2/posts/3860" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://www.schneier.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://www.schneier.com/wp-includes/wlwmanifest.xml" /> 

<link rel="canonical" href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html" />
<link rel='shortlink' href='https://www.schneier.com/?p=3860' />
<link rel="alternate" type="application/json+oembed" href="https://www.schneier.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2011%2F05%2Fforged_memory.html" />
<link rel="alternate" type="text/xml+oembed" href="https://www.schneier.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2011%2F05%2Fforged_memory.html&#038;format=xml" />
	<noscript><style>.woocommerce-product-gallery{ opacity: 1 !important; }</style></noscript>
	<link rel="icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-32x32.png" sizes="32x32" />
<link rel="icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-180x180.png" />
<meta name="msapplication-TileImage" content="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-270x270.png" />
		<style type="text/css" id="wp-custom-css">
			#schneier_promotion-2 img {
    max-width: 180px;
}		</style>
		</head>

<body class="post-template-default single single-post postid-3860 single-format-standard theme-schneier woocommerce-no-js">

	<div id="wrapper">
		<div id="main">

			<header>
				<div id="header">
					<h1>
						<a href="https://www.schneier.com/" rel="home">
							Schneier on Security						</a>
					</h1>
				</div>
			</header>

			<nav>
				<div class="nav" id="header-nav">
					<div class="menu-main-menu-container"><ul id="menu-main-menu" class="menu"><li id="menu-item-50175" class="menu1 menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-50175 current-menu-item"><a href="https://www.schneier.com">Blog</a></li>
<li id="menu-item-50916" class="menu2 menu-item menu-item-type-post_type menu-item-object-page menu-item-50916"><a href="https://www.schneier.com/crypto-gram/">Newsletter</a></li>
<li id="menu-item-50166" class="menu3 menu-item menu-item-type-post_type menu-item-object-page menu-item-50166"><a href="https://www.schneier.com/books/">Books</a></li>
<li id="menu-item-50169" class="menu4 menu-item menu-item-type-custom menu-item-object-custom menu-item-50169"><a href="https://www.schneier.com/essays/">Essays</a></li>
<li id="menu-item-50170" class="menu5 menu-item menu-item-type-custom menu-item-object-custom menu-item-50170"><a href="https://www.schneier.com/news/">News</a></li>
<li id="menu-item-50171" class="menu6 menu-item menu-item-type-custom menu-item-object-custom menu-item-50171"><a href="https://www.schneier.com/talks/">Talks</a></li>
<li id="menu-item-50167" class="menu7 menu-item menu-item-type-post_type menu-item-object-page menu-item-50167"><a href="https://www.schneier.com/academic/">Academic</a></li>
<li id="menu-item-50174" class="menu8 menu-item menu-item-type-post_type menu-item-object-page menu-item-50174"><a href="https://www.schneier.com/blog/about/">About Me</a></li>
</ul></div>				</div>
			</nav>

			
<aside>
	<div class="sidebar" id="sidebar-one">
		<section><div class="sidesection widget widget_schneier_search" id="schneier_search-3"><h3>Search</h3>
<p class="small">
	<em>Powered by <a href="https://duckduckgo.com/">DuckDuckGo</a></em></p>

<form method="get" action="https://duckduckgo.com/">

	<input type="hidden" name="kh" value="1" /><!-- use https -->

	<input id="search" name="q" size="15" maxlength="255" />

	<input type="submit" value="Go" /><br>

	<input type="radio" name="sites" id="searchblog" value="www.schneier.com/blog" />
	<label for="searchblog">Blog</label>

	<input type="radio" name="sites" id="searchessays" value="www.schneier.com/essays" />
	<label for="searchessays">Essays</label>

	<input type="radio" name="sites" id="searchall" value="www.schneier.com" checked="" />
	<label for="searchall">Whole site</label>

</form>
</div></section><section><div class="sidesection widget widget_schneier_social" id="schneier_social-2"><h3>Subscribe</h3>
<div id="subscription-buttons">

	<a href="https://www.schneier.com/feed/atom"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/rss-32px.png" alt="Atom Feed" /></a><a href="https://www.facebook.com/bruce.schneier"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/facebook-32px.png" alt="Facebook" /></a><a href="https://twitter.com/schneierblog/"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/twitter-32px.png" alt="Twitter" /></a><a href="https://www.amazon.com/Schneier-on-Security/dp/B0053HDDWW/"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/kindle-32px.png" alt="Kindle" /></a><a href="https://www.schneier.com/crypto-gram"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/email-32px.png" alt="E-Mail Newsletter (Crypto-Gram)" /></a>
</div>
</div></section>	</div>
</aside>

			<div id="content">

				
		<p id="breadcrumbs">

			<a href="https://www.schneier.com">Home</a><a href="https://www.schneier.com/blog/archives/">Blog</a>		</p>

		
<article id="post-3860" class="post-3860 post type-post status-publish format-standard hentry category-uncategorized tag-antivirus tag-concealment tag-malware tag-operating-systems tag-rootkits">

	<div class="article">

		<h2 class="entry">Forged Memory</h2>
		<p>A <a href="http://www.techrepublic.com/blog/security/forged-memory-fools-antimalware-a-new-development-in-rootkits/5443">scary development</a> in rootkits:</p>
<blockquote><p>Rootkits typically modify certain areas in the memory of the running operating system (OS) to hijack execution control from the OS. Doing so forces the OS to present inaccurate results to detection software (anti-virus, anti-rootkit).</p>
<p>For example rootkits may hide files, registries, processes, etc., from detection software. So rootkits typically modify memory. And anti-rootkit tools inspect memory areas to identify such suspicious modifications and alarm users.</p>
<p>This particular rootkit also modifies a memory location (installs a hook) to prevent proper disk access by detection software. Let us say that location is X. It is noteworthy that this location X is well known for being modified by other rootkit families, and is not unique to this particular rootkit.</p>
<p>Now since the content at location X is known to be altered by rootkits in general, most anti-rootkit tools will inspect the content at memory location X to see if it has been modified.</p>
<p>[&#8230;]</p>
<p>In the case of this particular rootkit, the original (what&#8217;s expected) content at location X is moved by the rootkit to a different location, Y. When an anti-rootkit tool tries to read the contents at location X, it is served contents from location Y. So, the anti-rootkit tool thinking everything is as it should be, does not warn the user of suspicious activity.</p></blockquote>

		
			<p class="entry-tags">
				<span class="tags-links">Tags: <a href="https://www.schneier.com/tag/antivirus/" rel="tag">antivirus</a>, <a href="https://www.schneier.com/tag/concealment/" rel="tag">concealment</a>, <a href="https://www.schneier.com/tag/malware/" rel="tag">malware</a>, <a href="https://www.schneier.com/tag/operating-systems/" rel="tag">operating systems</a>, <a href="https://www.schneier.com/tag/rootkits/" rel="tag">rootkits</a></span>			</p>

		
		
		<p class="posted">
			<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html" rel="bookmark">Posted on May 6, 2011 at 12:32 PM</a>			•
			<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html#comments">46 Comments</a>		</p>

		<aside><div class="schneier-share share" data-uri="https://www.schneier.com/blog/archives/2011/05/forged_memory.html" data-title="Forged Memory" data-order="facebook twitter tumblr" data-social-share-privacy="true" /></aside>
	</div>

</article>


	<h3 id="comments">Comments</h3>

	
		<article class="comment even thread-even depth-1" id="comment-159258">

			<div class="comment by-craig ">

				<p class="commentcredit">

					<span class="commenter">Craig</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159258">
						May 6, 2011 12:40 PM					</a>

				</p>

				<p>MS-DOS viruses were doing this sort of thing 20 years ago. It&#8217;s not really a new development.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-159259">

			<div class="comment by-ole ">

				<p class="commentcredit">

					<span class="commenter">ole</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159259">
						May 6, 2011 12:40 PM					</a>

				</p>

				<p>Way back when a member of the stoned family used this technique.  Monkey hooked an interupt so you could not get to the C:, but if you used fdisk to view the partition table then you bumped it off the hook and could proceed to remove it!  Have the criminal element figured out what we know yet?</p>
<p>ole.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-159260">

			<div class="comment by-todd-knarr ">

				<p class="commentcredit">

					<span class="commenter">Todd Knarr</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159260">
						May 6, 2011 12:52 PM					</a>

				</p>

				<p>Not new. This sounds like standard stealth-virus behavior. Hook into the interrupt vectors, for instance, and set page protection up so if something executed the hook it used what the virus had planted there but a normal read (non-execution) of the memory triggered a fault that let the virus substitute the original data so someone scanning the interrupt vector memory wouldn&#8217;t see the virus&#8217;s hook in place. That in turn was derived from disk-related stealthing: hook the disk IO routines and check where the read of an infected file/area is coming from. If it&#8217;s part of load or execution, leave it have the modified data. If it&#8217;s not, if it&#8217;s something just trying to read it as data, then substitute the original data so disk scans don&#8217;t see the virus.</p>
<p>Stuff like this is why the fundamental rule: you can&#8217;t scan for an infection using the potentially infected system, because if it&#8217;s infected it can lie to your scanning software.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-159261">

			<div class="comment by-imhlv2 ">

				<p class="commentcredit">

					<span class="commenter">iMHLv2</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159261">
						May 6, 2011 1:00 PM					</a>

				</p>

				<p>Detect the memory forging attempt with Volatility memory analysis framework: <a href="http://mnin.blogspot.com/2011/04/detectingmemory-forging-attempt-by.html" rel="nofollow ugc">http://mnin.blogspot.com/2011/04/detectingmemory-forging-attempt-by.html</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-159262">

			<div class="comment by-kevc ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.silicon-vision.com' rel='external nofollow ugc' class='url'>KevC</a></span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159262">
						May 6, 2011 1:10 PM					</a>

				</p>

				<p>It is true that this technique may not be new to a lot of experienced people.  However, the significance here (as pointed out by Bruce) is that older techniques have been harder to implement in modern operating systems.</p>
<p>Now that methods of getting code up into those areas of the OS, the older techniques can come back to mainstream usage&#8230; and that&#8217;s a scary thought.</p>
<p>Cat and mouse.  The next generation operating systems will prevent this type of low-level rooting once again, and following that we will see someone else figure out how to get past it &#8211; bringing this code-migration technique back into the limelight again and again.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-159263">

			<div class="comment by-michael-t-babcock ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://mikebabcock.ca' rel='external nofollow ugc' class='url'>Michael T. Babcock</a></span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159263">
						May 6, 2011 1:17 PM					</a>

				</p>

				<p>Certain operating systems are wiser and use randomised memory locations to avoid many such attacks.  This is an old technique and an OS that doesn&#8217;t plan around it is just lazy.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-159264">

			<div class="comment by-sigquit ">

				<p class="commentcredit">

					<span class="commenter">sigquit</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159264">
						May 6, 2011 1:38 PM					</a>

				</p>

				<p>Well, isn&#8217;t this the modern-day equivalent of the good old INT 21h hooking?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-159265">

			<div class="comment by-tony ">

				<p class="commentcredit">

					<span class="commenter">Tony</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159265">
						May 6, 2011 1:44 PM					</a>

				</p>

				<p>Shouldn&#8217;t a good root kit detector run from a separate OS environment (booted from a CD or USB stick)?  If the BIOS has been compromised, this is no good &#8211; but should avoid most of the usual ways that rootkits hide themselves from detection.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-159266">

			<div class="comment by-ken-williams ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.linkedin.com/in/kenahoo' rel='external nofollow ugc' class='url'>Ken Williams</a></span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159266">
						May 6, 2011 1:49 PM					</a>

				</p>

				<p>Is this a typo: &#8220;&#8230;to prevent proper /disk/ access by detection software&#8221;?  Or is it mucking with both disk &amp; RAM reads?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-159267">

			<div class="comment by-staudenmaier ">

				<p class="commentcredit">

					<span class="commenter">staudenmaier</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159267">
						May 6, 2011 2:01 PM					</a>

				</p>

				<p>Most rootkits I&#8217;ve seen hide in something like a hard disk driver file (*.SYS) which can be replaced with a clean copy.  I depend, however, on antivirus software to spot the rkit in memory, so this is indeed a nasty development.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-159268">

			<div class="comment by-staudenmaier ">

				<p class="commentcredit">

					<span class="commenter">staudenmaier</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159268">
						May 6, 2011 2:07 PM					</a>

				</p>

				<p>But booting OUTSIDE the regular OS will definitely help clean these things out.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-159269">

			<div class="comment by-brendan-kidwell ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.glump.net' rel='external nofollow ugc' class='url'>Brendan Kidwell</a></span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159269">
						May 6, 2011 2:14 PM					</a>

				</p>

				<p>I&#8217;m not an operating system or virtualization expert, but my understanding is that if you&#8217;re running a hypervisor under the actual OS that thinks it&#8217;s in charge, redirecting reads for a particular block of memory depending on who is trying to read them isn&#8217;t all that surprising.</p>
<p>You MIGHT be able to counteract this if you measure the difference in timings for accessing memory location X versus other locations unlikely to have been tampered with.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-159270">

			<div class="comment by-delphi_ote ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://rcunnin2@uiuc.edu' rel='external nofollow ugc' class='url'>delphi_ote</a></span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159270">
						May 6, 2011 2:37 PM					</a>

				</p>

				<p>Apparently, these guys never heard of Phrack.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-159271">

			<div class="comment by-roy ">

				<p class="commentcredit">

					<span class="commenter">Roy</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159271">
						May 6, 2011 2:42 PM					</a>

				</p>

				<p>I use a shell script to check that reported free space is really there. It repeatedly calls &#8230;</p>
<p>dd if=/dev/zero of=/tmp/$s bs=1g count=1</p>
<p>&#8230; writiing the iteration number to the SO each pass until all available free space is overwritten, then deletes those files. If it failed to reach the right number, then I know the memory accounting has been gaffed.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-159272">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159272">
						May 6, 2011 3:28 PM					</a>

				</p>

				<p>This is not new as many people have pointed out and as one person has pointed out it&#8217;s &#8220;a cat and mouse game&#8221; that unfortunatly has no end in a single CPU architecture.</p>
<p>The simple solution is to have a seperate state machine acting as a hypervisor, every so often it halts the main CPU and scans a block of OS &#8220;read only&#8221; memory if it does not find the correct hash value it then sets an exception (what is done with this is another matter).</p>
<p>The state machine does not have to scan the whole OS memory in one go because the CPU has no idea of which is the next block that is going to be scanned or when (it&#8217;s halted and thus is effectivly only aware that time has passed).</p>
<p>For those few who forever argue that there can be &#8220;perfect AVirus / AMalware / ARootKit&#8221; software running on a single CPU, they are wrong it can not be done (you can get very close however but 99.99..% is not 100% and never will be). This fact was known and accepted by the mathmatical community before the first electronic computers were built. The problem is that no system of logic that is realisticaly of any use can be used to describe / check it&#8217;s self.</p>
<p>However that aside the simple fact is there are a number of sufficiently good OS&#8217;s out there (and no I&#8217;m not talking *nix) that can better use the hardware security features currently built into comodity CPU&#8217;s such that this sort of attack is currently unlikely to succeed (if this will remain the case in the future is another issue).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-159274">

			<div class="comment by-will ">

				<p class="commentcredit">

					<span class="commenter">Will</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159274">
						May 6, 2011 4:04 PM					</a>

				</p>

				<p>keen as we all are to shout &#8220;prior art&#8221; and feel superior &#8211; the articles picking this up that I&#8217;ve read say such techniques have been talked about before &#8211; it is a first for a real live wild rootkit, right?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-159275">

			<div class="comment by-asd ">

				<p class="commentcredit">

					<span class="commenter">asd</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159275">
						May 6, 2011 4:21 PM					</a>

				</p>

				<p>If root-kits have to stay in none paged memory, couldn&#8217;t you compare the size of a device driver to its non paged memory, if the same it probable is a root-kits?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-159276">

			<div class="comment by-someone ">

				<p class="commentcredit">

					<span class="commenter">Someone</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159276">
						May 6, 2011 4:22 PM					</a>

				</p>

				<p>ShadowWalker did that, presentation was Blackhat &#8217;05 and the code for the TRON rootkit is publicly available. Hardly something new.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-159277">

			<div class="comment by-dom-de-vitto ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://devitto.com' rel='external nofollow ugc' class='url'>Dom De Vitto</a></span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159277">
						May 6, 2011 5:35 PM					</a>

				</p>

				<p>I think &#8220;Trusteer Rapport&#8221; (among other things) checks the call gates and hooks are in line with &#8216;normal&#8217; Windows systems, and replaces unknown hooks.</p>
<p>All pretty standard &#8216;find something that doesn&#8217;t look right&#8217; detection, that&#8217;s an uncommon, but obviously useful approach.</p>
<p>Maybe someone should tell the AV companies to stop with the snake-oil and enterprise GUIs and actually bring their products into the 21st century 🙁</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-159278">

			<div class="comment by-richard-steven-hack ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.computerproblemssolvedcheap.com' rel='external nofollow ugc' class='url'>Richard Steven Hack</a></span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159278">
						May 6, 2011 6:01 PM					</a>

				</p>

				<p>There are two problems here:</p>
<p>1) First, if the rootkit is running in memory and you try to detect it using a tool on the running system, the rootkit will beat you.</p>
<p>2) If you boot from an external OS such as Ultimate Boot CD For Windows (UBCD4Win), the rootkit is not running in memory so unless you have a file signature, you won&#8217;t detect it.</p>
<p>The only program I know of that attempts to cover these situations is Malwarebytes Antimalware, which is specifically recommended to be run on the compromised running system in order to detect these sorts of malware. It is not recommended to run it from a boot CD as its effectiveness is greatly reduced.</p>
<p>The problem with that, of course, is that the malware can be designed to detect and disable Malwarebytes.</p>
<p>A-a-a-n-n-d-d-d we&#8217;re back to square one. 🙂</p>
<p>Probably the only way to deal with this sort of thing is to run ALL the rootkit detectors both from the compromised system and from a boot CD. That at least forces the malware designer to defeat ALL the detection systems specifically.</p>
<p>It would be even better if an AV detector could be designed that boots the compromised system into a VM and checks the running virtual system from an external position on an external bootable host.</p>
<p>Designing something like that which could be used by normal end users is probably impossible. Even getting one usable by knowledgeable techs probably would be difficult. This is because the external checking tools would have to be very low level and would require considerable system programming knowledge to interpret the results &#8211; unless they were totally automated to remove any possible rootkit or repair the system to spec, thus removing the rootkit.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-159279">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159279">
						May 6, 2011 11:25 PM					</a>

				</p>

				<p>@ Richard Steven Hack</p>
<p>&#8220;Probably the only way to deal with this sort of thing is to run ALL the rootkit detectors both from the compromised system and from a boot CD.&#8221;</p>
<p>That&#8217;s how microsoft&#8217;s strider ghostbuster rootkit detector works. I don&#8217;t think it covers this attack vector currently.</p>
<p>&#8220;It would be even better if an AV detector could be designed that boots the compromised system into a VM and checks the running virtual system from an external position on an external bootable host.&#8221;</p>
<p>I don&#8217;t think it would be as hard as you make it sound. One academic paper a year or two ago published an evil maid type attack that hooks into a hibernated system as it boots back up, which is much scarier than this attack. But that same technique might be reapplied to detect this kind of infection.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-159280">

			<div class="comment by-eam ">

				<p class="commentcredit">

					<span class="commenter">Eam</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159280">
						May 6, 2011 11:35 PM					</a>

				</p>

				<p>This is just further evidence that once something is published in Phrack, it only takes criminal organizations a mere 8 years to implement it.</p>
<p><a href="http://www.phrack.org/issues.html?issue=61&#038;id=7" rel="nofollow ugc">http://www.phrack.org/issues.html?issue=61&#038;id=7</a></p>
<p>Imagine the threats we&#8217;d be facing if these virus writers actually did a bit of googling before firing up the IDE.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-159281">

			<div class="comment by-rob ">

				<p class="commentcredit">

					<span class="commenter">Rob</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159281">
						May 7, 2011 8:44 AM					</a>

				</p>

				<p>@Eam:</p>
<p>Unless that&#8217;s a bad link, that&#8217;s a completely different technique. Or rather, that&#8217;s not what&#8217;s doing the forging. There&#8217;s no mention of the debug registers there.</p>
<p>@Dom De Vitto:<br />
That&#8217;s the point of this rootkit. It breaks things like that.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-159282">

			<div class="comment by-markus ">

				<p class="commentcredit">

					<span class="commenter">markus</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159282">
						May 7, 2011 11:12 AM					</a>

				</p>

				<p>Boring and shadowalker, is a Bad copy of Joanna rutkowska&#8217;s dma northbridge rootkit</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-159283">

			<div class="comment by-kevin ">

				<p class="commentcredit">

					<span class="commenter">Kevin</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159283">
						May 7, 2011 4:21 PM					</a>

				</p>

				<p>Like a few have said, definitely not new (seems to be a variation on <a href="http://www.phrack.org/issues.html?issue=65&#038;id=8#article" rel="nofollow ugc">http://www.phrack.org/issues.html?issue=65&#038;id=8#article</a>) but it&#8217;s interesting to see that despite this, the anti-virus vendors don&#8217;t seem to be prepared for it. It makes me wonder if it&#8217;s already been in the wild for a while and it&#8217;s only now that they&#8217;ve actually noticed it.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-159284">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159284">
						May 8, 2011 12:11 AM					</a>

				</p>

				<p>@ Eam,</p>
<p>&#8220;Imagine the threats we&#8217;d be facing if these virus writers actually did a bit of googling before firing up the IDE.&#8221;</p>
<p>Err you apear tob forgetting the principle of &#8216;the low hanging fruit&#8217;.</p>
<p>That is, why as an attack developer, would you use an attack any more sophisticated than &#8216;gets the job done&#8217;?</p>
<p>The only reason for doing so is &#8216;longevity&#8217;, and this will always be tempered by &#8216;expected detection time&#8217;.</p>
<p>If your attack is designed to steal credit card numbers and you (or others) use them fairly immediatly then you would expect people to be looking for your attack code no more than three months after you start using the credit card info.</p>
<p>As credit card info ages fairly quickly (ie they expire two years after issue) you want to use them whilst they are still &#8216;fresh&#8217;.</p>
<p>[To see how fast they age make a simple assumption you steal 1million unique CC records from a companies sales reconciliation system. With a 2year expiry time you would expect 1/(365*2) or 0.137% to become invalid for every day after their last use. So you would expect 0.137% of the cards used yesterday to be not working, 50% of those used one year ago and all used two years or more ago. If the million unique records are spread evenly across one year thats 2740 records for each day. So you would expect 3.75 of the cards used yesterday to be now invalid, 7.5 from the day before and 1370 of the cards used a year ago today. You can therefore see you would expect 1/4 or 250000 records to be invalid on the day you steal them and to lose another 1370/day thereafter, thus only 1/4 would be valid after a year.]</p>
<p>So depending on how the card info is exploited it might take two months for complaint to be made to the CC companies. And investigators another two or three months to collect sufficient data to correlate the information and then find the code etc responsable. At which point the code no mater how good will get blocked.</p>
<p>So effectivly with only a 4-5 month life span you would use the first attack that worked.</p>
<p>However with something like an APT stealth attack you are looking at the life span of the OS as the upper limit, so four to six years. So a carefully selected vector with a carefully crafted agent would be expected.</p>
<p>As a consequence you would expect to see many many times the number of quick and dirty attacks for short lived CC data that you would for a stealth APT. Which appears to correlate with what we do see (Stuxnet being the only example of APT code that most people are aware of).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-159285">

			<div class="comment by-doug-coulter ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.coultersmithing.com/forums' rel='external nofollow ugc' class='url'>Doug Coulter</a></span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159285">
						May 8, 2011 10:51 AM					</a>

				</p>

				<p>Clive, you&#8217;ve hit it on the head again.  But CC&#8217;s aren&#8217;t the only possible targets for malware, just as you say &#8220;the low hanging fruit&#8221;.</p>
<p>Consider some other possibilities.  &#8220;High net worth individuals&#8221; might be one.  Many, being human, are up to this and that, and knowing just what might allow you to siphon some money off them &#8211; blackmail, or just following a big stock trader and front running his trades.</p>
<p>Another is a big company, big enough that invoicing and purchasing isn&#8217;t fully tracked by a single individual.  Getting into their system to have it send you money against fake PO&#8217;s might have a rather long lifetime if you&#8217;re not too greedy and just create a flow of money.</p>
<p>So, for a criminal, there&#8217;s a use for a long lived rootkit that can simply send info back to the controller for uses other than swiping a CC with a short life.  Done right, the victim never even realizes there&#8217;s a rootkit there &#8211; you just use the gathered information in other ways.</p>
<p>Think &#8220;insider trading&#8221; if you breach a law firm that does mergers&#8230;just for one.  All you need from the target is info, and you never attack them to make them aware of the problem.</p>
<p>You might not need to change many bits in the target system at all &#8212; maybe none, or just adding your fake money dump to their &#8220;approved vendors&#8221; list.</p>
<p>Luckily, most criminals don&#8217;t realize that you can make good money with the same skills wearing the other color hat &#8211; and with a lot less risk.  I suspect that for very high value targets though, this has been and is being done &#8212; and by the very nature of it, doesn&#8217;t get reported.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-159286">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159286">
						May 8, 2011 4:15 PM					</a>

				</p>

				<p>@ Clive Robinson</p>
<p>&#8220;Stuxnet being the only example of APT code that most people are aware of&#8221;</p>
<p>Actually, I think most people have heard of the Windows and UNIX family of operating systems. They are currently the most sophisticated APT&#8217;s available. They facilitate monitoring, stealth, massive data exfiltration, MITM, subversion and deception for social engineering attacks. You know you have the best rootkit when the next best rootkits (e.g. Zeus and Stuxnet) leverage your functionality to get the job done. 😉</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-159287">

			<div class="comment by-robertt ">

				<p class="commentcredit">

					<span class="commenter">RobertT</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159287">
						May 8, 2011 9:38 PM					</a>

				</p>

				<p>@Doug Coulter<br />
&#8220;Think &#8220;insider trading&#8221; if you breach a law firm that does mergers&#8230;just for one. All you need from the target is info, and you never attack them to make them aware of the problem.&#8221;</p>
<p>I&#8217;ve mentioned M&amp;A&#8217;s as a huge security problem a few times, over the last year, but most people don&#8217;t seem to understands the value of this data or even just the metadata associated with the &#8220;virtual data room&#8221; access.</p>
<p>Each of these &#8220;virtual data room&#8221; systems requires the users to download and install a secure communications tool that enables the whole &#8220;virtual data room comms&#8221; process. Ideally I want to rootkit their &#8220;secure system&#8221; software, that way I&#8217;m in on every deal, from day one AND I get to view the progress of the DD.</p>
<p>Alternatively I intentionally rootkit the laptops of the lawyers of  any aggressive acquirer.  Any M&amp;A DD must involve the head of the legal team, so I&#8217;m in the door real early. The thing is I don&#8217;t really need to know the exact details or snoop at the encrypted packets because I know that most M&amp;A&#8217;s occur at valuations of 30% above the average trading level for the past 6 months. A three month investment for a 30% low risk return!  I&#8217;m in! Also the earlier you are in the less suspicious it looks to any SEC investigator. Naturally it also helps if you don&#8217;t reside in the US (see the recent HK insider trading cases dropped)</p>
<p>So I think tightly targeted &#8220;rootkits&#8221; are a huge problem that the M&amp;A industry is completely ignoring. I seriously doubt that the criminal hackers are obliging by also ignoring this &#8220;low hanging fruit&#8221;</p>
<p>Sometimes the metadata is completely insecure, simple examples that I&#8217;ve seen include:<br />
Access account name is the actual name of the target company:<br />
 The error message for a failure to log into the data room is different if a data room exists, under that company name, than if there is no data room.  Conclusion: data room exists!</p>
<p>Data room Access accounts are usually established in the names of the potential acquires.:<br />
  A fail to log in under that userID (acquires company name) is a different error message when the userID exists than when it does not exist.</p>
<p>The virtual data room &#8220;secure system&#8221; software is honestly that pathetic!</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-159288">

			<div class="comment by-smartguy ">

				<p class="commentcredit">

					<span class="commenter">smartGuy</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159288">
						May 8, 2011 11:13 PM					</a>

				</p>

				<p>Actually this is a new development.  It is not just a simple case of hooking interrupt vectors if this works under Windows.  Windows clears all ISRs before switching into protected mode.  In order to perform this move, modifications to the kernel image must have been performed from real mode whilst avoiding checksum checks.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-159289">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159289">
						May 9, 2011 6:56 AM					</a>

				</p>

				<p>@ Nick P,</p>
<p>&#8220;Actually, I think most people have heard of the Windows and UNIX family of operating systems&#8221;</p>
<p>8)</p>
<p>However you raise a point we tend not to hear much spoken about,</p>
<p>&#8220;They facilitate monitoring, stealth massive data exfiltration&#8230;&#8221;</p>
<p>In some respects the monitoring and data exfiltration is what the attack is all about these days.</p>
<p>That is times have changed, those getting into your systems these days are mainly doing it for profit not vanity or bragging rights. The script kiddy attacks and web site defacements are by no means dead but are at best a side show these days.</p>
<p>However what are the majority of organisations defending against?</p>
<p>Mainly &#8216;known attack vectors&#8217; getting through the firewall.</p>
<p>But in most cases not the outbound data from those attacks that got through the firewall one way or the other (ie pushed by the attacker or pulled in by a user clicking on something).</p>
<p>To me this has always seemed a bit daft, it&#8217;s a bit like an old medieval town where the gate keepers are busy making sure that all inbound goods have the correct revenue applied, but ignore the outbound waggons one of which has the contents of the less than well guarded treasury on board.</p>
<p>One example was the modified version of the Zeus attack on .mil and .gov that hovered up .doc and .pdf files. It was only discovered because a network admin saw huge spikes in outbound traffic.</p>
<p>The problem is that many network etc admins are like the gate keepers they are to busy checking inbound traffic for contraband and ignoring outbound traffic with the crown jewels.</p>
<p>You need to do both just as diligently, because there will always be unknown attacks that get through the fire wall, AV and malware detectors, file system trip wires etc.</p>
<p>As we know from recent press some security related firms appear to be trying (lastpass.com) to do this and some appear not (RSA, Sony, etc).</p>
<p>One of the things that does kind of make me wonder what people are thinking when you hear the China APT mob go on about the removal of data in gigabyte and terrabyte quantities from individual sites or organisations. Surely these organisations can&#8217;t be so large that, that level of network traffic does not show up in the logs?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-159290">

			<div class="comment by-paeniteo ">

				<p class="commentcredit">

					<span class="commenter">Paeniteo</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159290">
						May 9, 2011 6:59 AM					</a>

				</p>

				<p>@Richard Steven Hack:<br />
&#8220;It would be even better if an AV detector could be designed that boots the compromised system into a VM and checks the running virtual system from an external position on an external bootable host.&#8221;</p>
<p>I remember reading a paper which argued that it would be ultimately impossible to hide the fact you are running inside a VM from a process within the VM (all mitigations introduce new detectable &#8220;oddities&#8221; which would need to be mitigated again and so on). Hence, the rootkit could detect the scanner, resulting in (to put it with your own words):</p>
<p>&#8220;A-a-a-n-n-d-d-d we&#8217;re back to square one. :-)&#8221;</p>
<p>😉</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-159292">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159292">
						May 9, 2011 9:20 AM					</a>

				</p>

				<p>@ Paeniteo,</p>
<p>&#8220;Hence, the rootkit could detect the scanner,&#8221;</p>
<p>In theory yes, in practice &#8220;could&#8221; works both ways and is thus probabilistic in nature.</p>
<p>It is also criticaly dependent on the resourses available to it. The root kit requires memory and CPU resources to detect the scanner and camouflage it&#8217;s self. If it does not have sufficient of either then it cannot achive either the detection the camouflage or both&#8230;</p>
<p>Further the scanner can use the same techniques to detect the root kit as the root kit uses to detect the scanner. However the scanner actualy can have the advantage especialy if it runs outside of the generalcomputing environment the root kit is occupying.</p>
<p>Consider it this way, the root kit is trying to occupy the highest privaledged position within the general computing environment it can as either above or part of the OS (or with some OS&#8217;s the drivers). Ask what happens if it can not occupy that position?</p>
<p>What if that high ground position is occupied by a hypervisor running in it&#8217;s own environment outside of the general computing environment?</p>
<p>And what if the OS the root kit is trying to supplant is in a resource limited environment?</p>
<p>Then there is the issue of the OS &#8220;signature&#8221;, the OS in it&#8217;s normal state performs certain actions in certain ways and uses a known set of resources such as memory and CPU cycles.</p>
<p>That signiture can be monitored and aberant behaviour detected.</p>
<p>Admittedly our current commodity OS&#8217;s are written in a monolithic manner which makes the signature overly complex to monitor currently. However some micro kernels can be re-written in ways that make the monitoring of the signiture much much easier.</p>
<p>The step people have to make is getting away from the CPU monitoring it&#8217;s self, and think about a hypervisor running on it&#8217;s own hardware environment.</p>
<p>We can actually do this today with a number of DMA interfaces one of which (firewire) has already been highlighted for &#8220;black hat&#8221; activities. It could just as easily be used for &#8220;white hat&#8221; activities like a security hypervisor.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-159293">

			<div class="comment by-kashmarek ">

				<p class="commentcredit">

					<span class="commenter">kashmarek</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159293">
						May 9, 2011 10:19 AM					</a>

				</p>

				<p>Recently, I saw an advertisement for a new PC, that allowed internet access without booting into the OS on the disk drive.  I believe one of the BIOS makers tried to sell this as an option a couple of years back.  Thus, it would seem that the BIOS (or firmware) is already at the point where it can run the computer without your OS and effectively be elevated to a full time always live undetectable rootkit when your OS is running.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-159294">

			<div class="comment by-paeniteo ">

				<p class="commentcredit">

					<span class="commenter">Paeniteo</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159294">
						May 9, 2011 10:29 AM					</a>

				</p>

				<p>@Clive: &#8216;&#8221;could&#8221; works both ways&#8217;</p>
<p>Yes, and that&#8217;s the kind of permanent, reciprocal hide-and-seek games Richard and I were referring to.<br />
I just meant to point out that having the rootkit inside a VM and the scanner outside of it does not solve the problem.<br />
I don&#8217;t even think that throwing in dedicated hardware solves that problem (although it would certainly make it harder to detect the scanner and/or hiding from it, just as the VM would do). Or, to put it the other way round, introducing dedicated hardware makes the issue boring, as we might then as well think along the lines of trusted micro-kernels sealed by TPMs.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-159295">

			<div class="comment by-siv ">

				<p class="commentcredit">

					<span class="commenter">Siv</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159295">
						May 9, 2011 12:14 PM					</a>

				</p>

				<p>These hackers have no fear.<br />
They weigh risk vs reward and doing these crimes are profitable and with little if any risk to them.<br />
If they faced consequences, REAL consequences they would find another line of work, or the government employers might change their job titles.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-159296">

			<div class="comment by-dirk-praet ">

				<p class="commentcredit">

					<span class="commenter">Dirk Praet</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159296">
						May 9, 2011 1:03 PM					</a>

				</p>

				<p>@ Clive</p>
<p>&#8220;Admittedly our current commodity OS&#8217;s are written in a monolithic manner which makes the signature overly complex to monitor&#8221;</p>
<p>Exactly. Which is why I like OS level virtualisation capabilities such as Solaris zones that can provide separate security domains for different applications. Much easier to monitor.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-159297">

			<div class="comment by-davi-ottenheimer ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.flyingpenguin.com/' rel='external nofollow ugc' class='url'>Davi Ottenheimer</a></span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159297">
						May 9, 2011 1:43 PM					</a>

				</p>

				<p>I suspect it has a lot to do with the reaction of the investigator. Option 1) report a stunning new development to the press or Option 2) research whether this is new. The reporter also could have done a bit of fact checking with other investigators to confirm the newness.</p>
<p>For what it&#8217;s worth, this was my take on a similar finding during an investigation I worked on last March:</p>
<p><a href="http://www.flyingpenguin.com/?p=11118" rel="nofollow ugc">http://www.flyingpenguin.com/?p=11118</a></p>
<p>&#8220;Now it seems so commonplace as to be obvious to manipulate memory, and even incorporated into regular development, but back [in 2005] it was Phrackworthy.&#8221;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-159298">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159298">
						May 9, 2011 3:56 PM					</a>

				</p>

				<p>@ Dirk Praet</p>
<p>OS-level virtualization is only as trustworthy as the OS it runs on and sharing mechanisms. In this light, it poses less issues than full virtualization because things can be more deprivileged and better controlled. However, it&#8217;s still a large attack surface. That&#8217;s why I favor the compromise of using microkernel platforms and user-mode Linux VM&#8217;s. It let&#8217;s us isolate security-critical code in a robust way, minimize kernel code, have separate security domains in different VM&#8217;s, and reuse legacy drivers and software until more isolated versions are written. Karger taught me the value of producing a series of interim products of increasing assurance to keep a project going.</p>
<p>Perseus/Turaya is a nice example<br />
<a href="http://www.emscb.com/content/pages/49558.htm" rel="nofollow ugc">http://www.emscb.com/content/pages/49558.htm</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-159299">

			<div class="comment by-dirk-praet ">

				<p class="commentcredit">

					<span class="commenter">Dirk Praet</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159299">
						May 9, 2011 4:53 PM					</a>

				</p>

				<p>@Nick</p>
<p>Thanks for that link. That&#8217;s a really nice one indeed.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-159300">

			<div class="comment by-jason ">

				<p class="commentcredit">

					<span class="commenter">Jason</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159300">
						May 9, 2011 5:09 PM					</a>

				</p>

				<p>I think there may also be a subconscious element at play, too.</p>
<p>What we&#8217;ve learned in recent years about computer programming and programmer cognition is that in general terms, the longer the bug existed, the harder it is to fix.</p>
<p>When a programmer writes a new bug, the code is fresh in their head, and they can recall the code and speculate about a fix quite easily.  Comparatively speaking of course.</p>
<p>Similarly, the detection and counteracting recommendations are still fresh in the minds of the discoverer, the &#8216;experts&#8217; and the affected parties.</p>
<p>You can speculate from this that if you deploy an exploit right after the paper gets published, it would actually get fixed sooner than if you waited 3 months, for everyone to start to forget about it.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-159301">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159301">
						May 10, 2011 1:46 AM					</a>

				</p>

				<p>@ Dirk Praet</p>
<p>Certainly!</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-159302">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159302">
						May 10, 2011 5:03 AM					</a>

				</p>

				<p>@ Kashmarek,</p>
<p>&#8220;Thus, it would seem that the BIOS (or firmware) is already at the point where it can run the computer without your OS and effectively be elevated to a full time always live undetectable rootkit when your OS is running.&#8221;</p>
<p>The BIOS ability to run without aa disk loaded OS has been around since before the earliest IBM PC&#8217;s. For instance the Apple ][ had a basic interpreter built in with (if you knew how to do it) the ability to have a number of programs in ram at the same time. There have even been embedded versions of *nix in highend microcontrolers (and for embbeded systems you don&#8217;t need the MMU, you don&#8217;t on other systems as it&#8217;s mainly a conveniance for the loader/linker).</p>
<p>However the BIOS ability to act as a security hypervisor won&#8217;t in the ordinary scheam of things work, because it shares the same memory and CPU. Thus the CPU either needs to have the required extended hardware built in or it needs to be added. Arguably the Intel platform (if it was bug free which it&#8217;s not) could provide this.</p>
<p>However there is a subtle issue even when the hypervisor memory and CPU is (apparently) isolated from the main CPU and memory. If the hypervisor is not written in the right way then the main memory it sees can end up being interpreted as code. Thus the hypervisor needs to be implemented as an all known state state machine where the data from the main memory can only cause an exception and nothing else. This way the state machine hypervisor fails safe.</p>
<p>@ Siv,</p>
<p>&#8220;These hackers have no fear. They weigh risk vs reward and doing these crime are profitable and with little if any risk to them.</p>
<p>These two sentences are at variance with each other. If they had &#8220;no fear&#8221; they would not &#8220;weigh risk vs reward&#8221; they would simply go for the reward.</p>
<p>You further say,</p>
<p>&#8220;If they faced consequences, REAL consequences they would find another line of work, or the government employers might change their job titles.&#8221;</p>
<p>In the main the prosecution of cross jurisdictional border crime is  treated in a similar way to a &#8220;suspect who has taken flight&#8221;. That is via extradition treaty, however many countries either do not have extradition treaties or as in the case of Russia and China legal exceptions for those acting under state authority or not actualy present at the scene of the crime. Other nations (Israel being one) will not extradite people of certain faiths to other countries seen not to be of that faith.</p>
<p>For real consiquences to happen then people need to be tried and convicted either in the country they committed the crime or in some other third party impartial nation. Currently we don&#8217;t have the legal mechanism in place except for War Crimes, Crimes Against Humanity and Piracy on the High Seas.</p>
<p>As has been seen with European law (equivalance of court sentance and enforcment across the EU and the European Arrest Warrant) any such process is open to compleate abuse. Further the asymetrical agreement between the US and UK that supposadly was for use against terrorists has and is being abused.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-159303">

			<div class="comment by-clive-roinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Roinson</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159303">
						May 10, 2011 5:37 AM					</a>

				</p>

				<p>@ Nick P,</p>
<p>From some of what you have said in the past you have played with DMA over Firewire as a way of getting around various OS / CPU locks.</p>
<p>Have you ever thought about doing a memory checking hypervisor over Firewire?</p>
<p>For instance if the microkernel was made sufficiently light weight with the code writen to be as static as possible (ie relative not absolute branches and jumps, calls via base and table offset) with minimal jump tables for other activities then checking the memory image via DMA can be fast and in many cases non intrusive to the activites of the target CPU.</p>
<p>Further if the microkernel was writen in such a way that any detected anomalys could be corrected by the DMA process it would make exploits difficult.</p>
<p>Further why not actually load the microkernel into the target CPU from the Firewire DMA, this way malware could not get at it (assuming the code was writen correctly) as it would not be stored on localy accessable semimutable media.</p>
<p>Just something for you to think on as say the next step on from your current microkernel solution.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-159304">

			<div class="comment by-acer ">

				<p class="commentcredit">

					<span class="commenter">acer</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159304">
						May 29, 2011 4:50 AM					</a>

				</p>

				<p>If a cpu can workout a+b in proably thousands of ways, how could the program itself not beable to work out it has changed.<br />
Was think if a usermode program trying work something out and a rootkit changed it, couldn&#8217;t the program find it.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-159305">

			<div class="comment by-acer ">

				<p class="commentcredit">

					<span class="commenter">acer</span> •

					<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/#comment-159305">
						May 29, 2011 5:10 AM					</a>

				</p>

				<p>i&#8217;m trying to create a anti-virus that will detect and remove root-kits etc, if any one as ideas can you send me a email(ask mod)<br />
Thanks</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

	<p class="subscribe-comments">
		<a href="https://www.schneier.com/blog/archives/2011/05/forged_memory.html/feed/">
			<img alt="Atom Feed" src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/rss.png">
			Subscribe to comments on this entry		</a>
	</p>

		<div id="respond" class="comment-respond">
		<h2 class="comments-open-header">Leave a comment <small><a rel="nofollow" id="cancel-comment-reply-link" href="/blog/archives/2011/05/forged_memory.html#respond" style="display:none;">Cancel reply</a></small></h2><form action="https://www.schneier.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><a href="https://www.schneier.com/wp-login.php?redirect_to=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2011%2F05%2Fforged_memory.html" title="Login">Login</a><p class="comment-form-author"><label for="author">Name</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" /></p>
<p class="comment-form-email"><label for="email">Email</label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" /></p>
<p class="comment-form-url"><label for="url">URL:</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p>
<p class="comment-form-cookies-consent"><input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox" value="yes" /> <label for="wp-comment-cookies-consent">Remember personal info?</label></p>

<p class="comment-form-author">

	<label for="comm_capt_challenge">
		Fill in the blank: the name of this blog is Schneier on ___________ (required):	</label>

	<input id="comm_capt_challenge" name="comm_capt_challenge" size="30" type="text" />
</p>

<div class="comment-form-comment">

	<label for="comment">Comments:</label>

	<textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea>

	<div id="preview-box" class="preview-box hide"></div>
	<img class="comment-loading hide" src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/loader.gif" />

</div>

<p id="allowed">

	<strong>Allowed HTML</strong>
	&lt;a href=&quot;URL&quot;&gt; &bull; &lt;em&gt; &lt;cite&gt; &lt;i&gt; &bull; &lt;strong&gt; &lt;b&gt; &bull; &lt;sub&gt; &lt;sup&gt; &bull; &lt;ul&gt; &lt;ol&gt; &lt;li&gt; &bull; &lt;blockquote&gt; &lt;pre&gt;
	<strong>Markdown Extra</strong> syntax via <a href="https://michelf.ca/projects/php-markdown/extra/">https://michelf.ca/projects/php-markdown/extra/</a>
</p>

<input type="hidden" id="wp_comment_nonce" name="wp_comment_nonce" value="4b1534b792" /><input type="hidden" name="_wp_http_referer" value="/blog/archives/2011/05/forged_memory.html" />
<input type="button" id="comment-preview" class="comment-preview comment-actions" value="Preview" />
<input type="button" id="comment-write" class="comment-write comment-actions hide" value="Edit" />

<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Submit" /> <input type='hidden' name='comment_post_ID' value='3860' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p></form>	</div><!-- #respond -->
	
	<div class="stepthrough">
		<a href="https://www.schneier.com/blog/archives/2011/05/stolen_camera_f.html" rel="prev">← Stolen Camera Finder</a>		<a href="https://www.schneier.com/blog/archives/2011/05/friday_squid_bl_282.html" rel="next">Friday Squid Blogging: Squids in Space →</a>	</div>

	
<p id="powered">Sidebar photo of Bruce Schneier by Joe MacInnis.</p>
		</div>

		
<aside>
	<div class="sidebar" id="sidebar-two">
		<section><div class="sidesection widget widget_schneier_about" id="schneier_about-2"><h3>About Bruce Schneier</h3><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/Bruce-Schneier.jpg" /><p><p class="small">I am a <a href="https://public-interest-tech.com/">public-interest technologist</a>, working at the intersection of security, technology, and people. I've been writing about security issues on my <a href="/">blog</a> since 2004, and in my monthly <a href="/crypto-gram/">newsletter</a> since 1998. I'm a fellow and lecturer at Harvard's <a href="https://www.hks.harvard.edu/faculty/bruce-schneier">Kennedy School</a>, a board member of <a href="https://www.eff.org/">EFF</a>, and the Chief of Security Architecture at <a href="https://inrupt.com/">Inrupt, Inc.</a> This personal website expresses the opinions of none of those organizations.</p>
</p></div></section><section><div class="sidesection widget widget_schneier_related_posts" id="schneier_related_posts-2"><h3>Related Entries</h3>
<ul>

	<li><a href="https://www.schneier.com/blog/archives/2021/03/illegal-content-and-the-blockchain.html">Illegal Content and the Blockchain</a></li><li><a href="https://www.schneier.com/blog/archives/2021/03/national-security-risks-of-late-stage-capitalism.html">National Security Risks of Late-Stage Capitalism</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/weis-2021-call-for-papers.html">WEIS 2021 Call for Papers</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/ransomware-profitability.html">Ransomware Profitability</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/presidential-cybersecurity-and-pelotons.html">Presidential Cybersecurity and Pelotons</a></li><li><a href="https://www.schneier.com/blog/archives/2021/01/police-have-disrupted-the-emotet-botnet.html">Police Have Disrupted the Emotet Botnet</a></li>
</ul>
</div></section><section><div class="sidesection widget widget_schneier_featured_essays" id="schneier_featured_essays-2"><h3>Featured Essays</h3>
	<ul>
		<li><a href="https://www.schneier.com/essays/archives/2016/04/the_value_of_encrypt.html">The Value of Encryption</a></li><li><a href="https://www.schneier.com/essays/archives/2016/03/data_is_a_toxic_asse.html">Data Is a Toxic Asset, So Why Not Throw It Out?</a></li><li><a href="https://www.schneier.com/essays/archives/2014/01/how_the_nsa_threaten.html">How the NSA Threatens National Security</a></li><li><a href="https://www.schneier.com/essays/archives/2009/01/terrorists_may_use_g.html">Terrorists May Use Google Earth, But Fear Is No Reason to Ban It</a></li><li><a href="https://www.schneier.com/essays/archives/2007/01/in_praise_of_securit.html">In Praise of Security Theater</a></li><li><a href="https://www.schneier.com/essays/archives/2006/08/refuse_to_be_terrori.html">Refuse to be Terrorized</a></li><li><a href="https://www.schneier.com/essays/archives/2006/05/the_eternal_value_of.html">The Eternal Value of Privacy</a></li><li><a href="https://www.schneier.com/essays/archives/2005/09/terrorists_dont_do_m.html">Terrorists Don&#039;t Do Movie Plots</a></li>	</ul>

	<p><a href="https://www.schneier.com/essays/">More Essays</a></p></div></section><section><div class="sidesection widget widget_schneier_archives" id="schneier_archives-2"><h3>Blog Archives</h3>
<ul>

	<li><a href="https://www.schneier.com/blog/calendar.html/">Archive by Month</a></li><li><a href="https://www.schneier.com/blog/newcomments.html/">100 Latest Comments</a></li></ul>

<h4>Blog Tags</h4><ul class="top-tags"><li><a href="https://www.schneier.com/tag/3d-printers/">3d printers</a></li><li><a href="https://www.schneier.com/tag/9-11/">9/11</a></li><li><a href="https://www.schneier.com/tag/aaron-swartz/">Aaron Swartz</a></li><li><a href="https://www.schneier.com/tag/academic/">academic</a></li><li><a href="https://www.schneier.com/tag/academic-papers/">academic papers</a></li><li><a href="https://www.schneier.com/tag/accountability/">accountability</a></li><li><a href="https://www.schneier.com/tag/aclu/">ACLU</a></li><li><a href="https://www.schneier.com/tag/activism/">activism</a></li><li><a href="https://www.schneier.com/tag/adobe/">Adobe</a></li><li><a href="https://www.schneier.com/tag/advanced-persistent-threats/">advanced persistent threats</a></li><li><a href="https://www.schneier.com/tag/adware/">adware</a></li><li><a href="https://www.schneier.com/tag/aes/">AES</a></li><li><a href="https://www.schneier.com/tag/afghanistan/">Afghanistan</a></li><li><a href="https://www.schneier.com/tag/air-marshals/">air marshals</a></li><li><a href="https://www.schneier.com/tag/air-travel/">air travel</a></li><li><a href="https://www.schneier.com/tag/airgaps/">airgaps</a></li><li><a href="https://www.schneier.com/tag/al-qaeda/">al Qaeda</a></li><li><a href="https://www.schneier.com/tag/alarms/">alarms</a></li><li><a href="https://www.schneier.com/tag/algorithms/">algorithms</a></li><li><a href="https://www.schneier.com/tag/alibis/">alibis</a></li><li><a href="https://www.schneier.com/tag/amazon/">Amazon</a></li><li><a href="https://www.schneier.com/tag/android/">Android</a></li><li><a href="https://www.schneier.com/tag/anonymity/">anonymity</a></li><li><a href="https://www.schneier.com/tag/anonymous/">Anonymous</a></li><li><a href="https://www.schneier.com/tag/antivirus/">antivirus</a></li><li><a href="https://www.schneier.com/tag/apache/">Apache</a></li><li><a href="https://www.schneier.com/tag/apple/">Apple</a></li><li><a href="https://www.schneier.com/tag/applied-cryptography/">Applied Cryptography</a></li><li><a href="https://www.schneier.com/tag/artificial-intelligence/">artificial intelligence</a></li><li><a href="https://www.schneier.com/tag/assassinations/">assassinations</a></li></ul><p><a href="https://www.schneier.com/blog/tags.html/">More Tags</a></p></div></section><section><div class="sidesection widget widget_schneier_latest_book" id="schneier_latest_book-3"><h3>Latest Book</h3><a href="https://www.schneier.com/books/click-here/"><img class="sidepic" alt="Click Here to Kill Everybody" src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2018/07/book-ch2-200w.png" /></a><p><a href="https://www.schneier.com/books/">More Books</a></p></div></section><section><div class="sidesection widget widget_schneier_promotion" id="schneier_promotion-2">
<a href="https://www.eff.org/issues/bloggers/legal/join">
	<img src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/join-eff@2x.png" id="effbutton" alt="Support Bloggers' Rights!" title="Support Bloggers' Rights!" /></a>

<a href="https://npo.networkforgood.org/Donate/Donate.aspx?npoSubscriptionId=8252">
	<img src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/support-epic@2x.png" alt="Defend Privacy--Support Epic" title="Defend Privacy--Support Epic" /></a>
</div></section>	</div>
</aside>

		<footer>
			<nav>
				<div class="nav" id="footer-nav">
					<div class="menu-main-menu-container"><ul id="menu-main-menu-1" class="menu"><li class="menu1 menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-50175 current-menu-item"><a href="https://www.schneier.com">Blog</a></li>
<li class="menu2 menu-item menu-item-type-post_type menu-item-object-page menu-item-50916"><a href="https://www.schneier.com/crypto-gram/">Newsletter</a></li>
<li class="menu3 menu-item menu-item-type-post_type menu-item-object-page menu-item-50166"><a href="https://www.schneier.com/books/">Books</a></li>
<li class="menu4 menu-item menu-item-type-custom menu-item-object-custom menu-item-50169"><a href="https://www.schneier.com/essays/">Essays</a></li>
<li class="menu5 menu-item menu-item-type-custom menu-item-object-custom menu-item-50170"><a href="https://www.schneier.com/news/">News</a></li>
<li class="menu6 menu-item menu-item-type-custom menu-item-object-custom menu-item-50171"><a href="https://www.schneier.com/talks/">Talks</a></li>
<li class="menu7 menu-item menu-item-type-post_type menu-item-object-page menu-item-50167"><a href="https://www.schneier.com/academic/">Academic</a></li>
<li class="menu8 menu-item menu-item-type-post_type menu-item-object-page menu-item-50174"><a href="https://www.schneier.com/blog/about/">About Me</a></li>
</ul></div>				</div>
			</nav>
		</footer>

		</div><!--#main-->
	</div><!--#wrapper-->

		<script type="text/javascript">
		(function () {
			var c = document.body.className;
			c = c.replace(/woocommerce-no-js/, 'woocommerce-js');
			document.body.className = c;
		})();
	</script>
	<script type='text/javascript' src='https://c0.wp.com/p/woocommerce/5.1.0/assets/js/jquery-cookie/jquery.cookie.min.js' id='jquery-cookie-js'></script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/vendor/socialshareprivacy/js/socialshareprivacy.js?ver=1.0.1' id='social-share-privacy-js'></script>
<script type='text/javascript' id='social-share-privacy-icons-js-extra'>
/* <![CDATA[ */
var schneierSocial = {"path":"https:\/\/www.schneier.com\/wp-content\/themes\/schneier\/assets\/vendor\/socialshareprivacy\/"};
/* ]]> */
</script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/vendor/socialshareprivacy/js/icons.js?ver=1.0.0' id='social-share-privacy-icons-js'></script>
<script type='text/javascript' id='schneier-comment-js-extra'>
/* <![CDATA[ */
var schneierComment = {"translateErrorSecurityAnswerWrong":"Your response to the challenge question ('The name of this blog is Schneier on ____') was not correct. Please try again.","ajax_url":"https:\/\/www.schneier.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/js/comment.js?ver=1.0.1' id='schneier-comment-js'></script>
<script type='text/javascript' src='https://c0.wp.com/c/5.7/wp-includes/js/wp-embed.min.js' id='wp-embed-js'></script>

</body>

</html>
