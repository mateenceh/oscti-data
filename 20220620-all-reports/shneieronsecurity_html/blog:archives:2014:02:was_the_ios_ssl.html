<!DOCTYPE html>
<html lang="en-US">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<title>Was the iOS SSL Flaw Deliberate? - Schneier on Security</title>
	<meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel='dns-prefetch' href='//c0.wp.com' />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Feed" href="https://www.schneier.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Comments Feed" href="https://www.schneier.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Was the iOS SSL Flaw Deliberate? Comments Feed" href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/feed/" />
<link rel='stylesheet' id='wp-block-library-css'  href='https://c0.wp.com/c/5.7/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all' />
<style id='wp-block-library-inline-css' type='text/css'>
.has-text-align-justify{text-align:justify;}
</style>
<style id='woocommerce-inline-inline-css' type='text/css'>
.woocommerce form .form-row .required { visibility: visible; }
</style>
<link rel='stylesheet' id='schneier-css'  href='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/style.css?ver=1.0.0' type='text/css' media='all' />
<link rel='stylesheet' id='schneier-main-css'  href='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/dist/css/style.css?ver=1.0.2' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css'  href='https://c0.wp.com/p/jetpack/9.5.2/css/jetpack.css' type='text/css' media='all' />
<script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js?ver=3.5.1' id='jquery-js'></script>
<link rel="https://api.w.org/" href="https://www.schneier.com/wp-json/" /><link rel="alternate" type="application/json" href="https://www.schneier.com/wp-json/wp/v2/posts/5260" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://www.schneier.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://www.schneier.com/wp-includes/wlwmanifest.xml" /> 

<link rel="canonical" href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html" />
<link rel='shortlink' href='https://www.schneier.com/?p=5260' />
<link rel="alternate" type="application/json+oembed" href="https://www.schneier.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2014%2F02%2Fwas_the_ios_ssl.html" />
<link rel="alternate" type="text/xml+oembed" href="https://www.schneier.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2014%2F02%2Fwas_the_ios_ssl.html&#038;format=xml" />
	<noscript><style>.woocommerce-product-gallery{ opacity: 1 !important; }</style></noscript>
	<link rel="icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-32x32.png" sizes="32x32" />
<link rel="icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-180x180.png" />
<meta name="msapplication-TileImage" content="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-270x270.png" />
		<style type="text/css" id="wp-custom-css">
			#schneier_promotion-2 img {
    max-width: 180px;
}		</style>
		</head>

<body class="post-template-default single single-post postid-5260 single-format-standard theme-schneier woocommerce-no-js">

	<div id="wrapper">
		<div id="main">

			<header>
				<div id="header">
					<h1>
						<a href="https://www.schneier.com/" rel="home">
							Schneier on Security						</a>
					</h1>
				</div>
			</header>

			<nav>
				<div class="nav" id="header-nav">
					<div class="menu-main-menu-container"><ul id="menu-main-menu" class="menu"><li id="menu-item-50175" class="menu1 menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-50175 current-menu-item"><a href="https://www.schneier.com">Blog</a></li>
<li id="menu-item-50916" class="menu2 menu-item menu-item-type-post_type menu-item-object-page menu-item-50916"><a href="https://www.schneier.com/crypto-gram/">Newsletter</a></li>
<li id="menu-item-50166" class="menu3 menu-item menu-item-type-post_type menu-item-object-page menu-item-50166"><a href="https://www.schneier.com/books/">Books</a></li>
<li id="menu-item-50169" class="menu4 menu-item menu-item-type-custom menu-item-object-custom menu-item-50169"><a href="https://www.schneier.com/essays/">Essays</a></li>
<li id="menu-item-50170" class="menu5 menu-item menu-item-type-custom menu-item-object-custom menu-item-50170"><a href="https://www.schneier.com/news/">News</a></li>
<li id="menu-item-50171" class="menu6 menu-item menu-item-type-custom menu-item-object-custom menu-item-50171"><a href="https://www.schneier.com/talks/">Talks</a></li>
<li id="menu-item-50167" class="menu7 menu-item menu-item-type-post_type menu-item-object-page menu-item-50167"><a href="https://www.schneier.com/academic/">Academic</a></li>
<li id="menu-item-50174" class="menu8 menu-item menu-item-type-post_type menu-item-object-page menu-item-50174"><a href="https://www.schneier.com/blog/about/">About Me</a></li>
</ul></div>				</div>
			</nav>

			
<aside>
	<div class="sidebar" id="sidebar-one">
		<section><div class="sidesection widget widget_schneier_search" id="schneier_search-3"><h3>Search</h3>
<p class="small">
	<em>Powered by <a href="https://duckduckgo.com/">DuckDuckGo</a></em></p>

<form method="get" action="https://duckduckgo.com/">

	<input type="hidden" name="kh" value="1" /><!-- use https -->

	<input id="search" name="q" size="15" maxlength="255" />

	<input type="submit" value="Go" /><br>

	<input type="radio" name="sites" id="searchblog" value="www.schneier.com/blog" />
	<label for="searchblog">Blog</label>

	<input type="radio" name="sites" id="searchessays" value="www.schneier.com/essays" />
	<label for="searchessays">Essays</label>

	<input type="radio" name="sites" id="searchall" value="www.schneier.com" checked="" />
	<label for="searchall">Whole site</label>

</form>
</div></section><section><div class="sidesection widget widget_schneier_social" id="schneier_social-2"><h3>Subscribe</h3>
<div id="subscription-buttons">

	<a href="https://www.schneier.com/feed/atom"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/rss-32px.png" alt="Atom Feed" /></a><a href="https://www.facebook.com/bruce.schneier"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/facebook-32px.png" alt="Facebook" /></a><a href="https://twitter.com/schneierblog/"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/twitter-32px.png" alt="Twitter" /></a><a href="https://www.amazon.com/Schneier-on-Security/dp/B0053HDDWW/"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/kindle-32px.png" alt="Kindle" /></a><a href="https://www.schneier.com/crypto-gram"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/email-32px.png" alt="E-Mail Newsletter (Crypto-Gram)" /></a>
</div>
</div></section>	</div>
</aside>

			<div id="content">

				
		<p id="breadcrumbs">

			<a href="https://www.schneier.com">Home</a><a href="https://www.schneier.com/blog/archives/">Blog</a>		</p>

		
<article id="post-5260" class="post-5260 post type-post status-publish format-standard hentry category-uncategorized tag-apple tag-backdoors tag-deniability tag-ios tag-patching tag-sabotage">

	<div class="article">

		<h2 class="entry">Was the iOS SSL Flaw Deliberate?</h2>
		<p>Last October, I <a href="https://www.schneier.com/essay-459.html">speculated</a> on the best ways to go about designing and implementing a software backdoor.  I suggested three characteristics of a good backdoor: low chance of discovery, high deniability if discovered, and minimal conspiracy to implement.</p>
<p>The <a href="http://arstechnica.com/apple/2014/02/apple-releases-ios-7-0-6-and-6-1-6-to-patch-an-ssl-problem/">critical iOS vulnerability<a> that Apple patched last week is an excellent example.  <a href="http://arstechnica.com/security/2014/02/extremely-critical-crypto-flaw-in-ios-may-also-affect-fully-patched-macs/">Look at the code</a>.  What caused the vulnerability is a single line of code: a second &#8220;goto fail;&#8221; statement.  Since that statement isn&#8217;t a conditional, it causes the whole procedure to terminate.</p>
<p>The flaw is subtle, and hard to spot while scanning the code.  It&#8217;s easy to imagine how this could have happened by error.  And it would have been trivially easy for one person to add the vulnerability.</p>
<p>Was this done on purpose?  I have no idea.  But if I wanted to do something like this on purpose, this is exactly how I would do it.</p>
<p>EDITED TO ADD (2/27):  If the Apple auditing system is any good, they would be able to trace this errant goto line not just to the source-code check-in details, but to the specific login that made the change.  And they would quickly know whether this was just an error, or a deliberate change by a bad actor.  Does anyone know what&#8217;s going on inside Apple?</p>
<p>EDITED TO ADD (2/27):  Steve Bellovin has a <a href="https://www.cs.columbia.edu/~smb/blog/2014-02/2014-02-23.html">pair</a> <a href="https://www.cs.columbia.edu/~smb/blog/2014-02/2014-02-24.html">of</a> posts where he concludes that if this bug is enemy action, it&#8217;s fairly clumsy and unlikely to be the work of professionals.</p>

		
			<p class="entry-tags">
				<span class="tags-links">Tags: <a href="https://www.schneier.com/tag/apple/" rel="tag">Apple</a>, <a href="https://www.schneier.com/tag/backdoors/" rel="tag">backdoors</a>, <a href="https://www.schneier.com/tag/deniability/" rel="tag">deniability</a>, <a href="https://www.schneier.com/tag/ios/" rel="tag">iOS</a>, <a href="https://www.schneier.com/tag/patching/" rel="tag">patching</a>, <a href="https://www.schneier.com/tag/sabotage/" rel="tag">sabotage</a></span>			</p>

		
		
		<p class="posted">
			<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html" rel="bookmark">Posted on February 27, 2014 at 6:03 AM</a>			•
			<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html#comments">168 Comments</a>		</p>

		<aside><div class="schneier-share share" data-uri="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html" data-title="Was the iOS SSL Flaw Deliberate?" data-order="facebook twitter tumblr" data-social-share-privacy="true" /></aside>
	</div>

</article>


	<h3 id="comments">Comments</h3>

	
		<article class="comment even thread-even depth-1" id="comment-217140">

			<div class="comment by-michael-p ">

				<p class="commentcredit">

					<span class="commenter">Michael P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217140">
						February 27, 2014 6:15 AM					</a>

				</p>

				<p>I disagree that this is particularly easy to overlook when reading the code.  That it survived tells me that either Apple as an organization did this intentionally or that they have neither good code review practices nor remotely useful static analysis tools, even for security-critical code.  Even a halfway decent compiler, using the flags that are appropriate for this kind of code, should flag the unreachable code with a warning (promoted into an error by one of those flags I mentioned).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217141">

			<div class="comment by-chris-w ">

				<p class="commentcredit">

					<span class="commenter">Chris W</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217141">
						February 27, 2014 6:29 AM					</a>

				</p>

				<blockquote><p>The flaw is subtle, and hard to spot while scanning the code.</p></blockquote>
<p>Actually, it isn&#8217;t hard, plenty of compilers give warnings (or errors) if it can statically determine that specific code is never executed.<br />
This is a prime example of that and should have been easy to spot.<br />
I don&#8217;t know a thing about ios development, so I don&#8217;t know about used compilers. I do know plenty of developers ignore warnings. But thats no excuse for security-critical code.</p>
<p>Additionally, these things should have test suites, unit tests, the whole nine yards.</p>
<p>Just checked the comments on the link, apparently I&#8217;m not the only one with these conclusions.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217142">

			<div class="comment by-bruce-stephens ">

				<p class="commentcredit">

					<span class="commenter">Bruce Stephens</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217142">
						February 27, 2014 6:42 AM					</a>

				</p>

				<p>Looking at the dozen or so lines of code presented, the bug is obvious. Has anyone seen this in the context of the whole change (which I presume would be changes to several files, and quite likely more changes to this one file)?</p>
<p>In such a context (presuming it is larger than what people are showing) I could easily imagine such a bug getting through code review. I imagine it&#8217;s commonplace at Apple and elsewhere. What&#8217;s different in this case is just that it happens to have a catastrophic impact.</p>
<p>Likely similar bugs (causing odd minor corruption of iCloud-saved Pages documents and the like) just get dismissed as ordinary bugs. Even if we had access to the source nobody (outside Apple) would care enough to look for the cause.</p>
<p>What&#8217;s harder to explain is how this would get past automated (or other) testing. That&#8217;s got to feel embarrassing to the team responsible, though test suites are pretty much guaranteed to be incomplete; maybe this functionality just wasn&#8217;t part of the testing. (Unless the flaw was deliberate, obviously.)</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217143">

			<div class="comment by-bob-s ">

				<p class="commentcredit">

					<span class="commenter">Bob S.</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217143">
						February 27, 2014 6:46 AM					</a>

				</p>

				<p>I would think  the code fail would show up in testing and or packet inspection. No?</p>
<p>Is it really that easy?</p>
<p>And as usual complete silence  by apple or the govt as to how this happened.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217144">

			<div class="comment by-felix ">

				<p class="commentcredit">

					<span class="commenter">felix</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217144">
						February 27, 2014 6:49 AM					</a>

				</p>

				<p>@Chris W: the Clang compiler does have a warning for dead code, but it is not included in -Wall and -Wextra. GCC did have such a warning, but it was removed a couple of years ago. So the chance of noticing this due to a compiler warning is pretty small.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217145">

			<div class="comment by-john ">

				<p class="commentcredit">

					<span class="commenter">john</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217145">
						February 27, 2014 6:56 AM					</a>

				</p>

				<p>If they wanted to make it difficult to discover, wouldn&#8217;t it have made more sense to put some <em>different</em> line of code in place of the first &#8220;goto fail;&#8221;?  Indented code that looks like part of a conditional block but isn&#8217;t, is easy to miss.  Two consecutive goto&#8217;s?  Not so much.</p>
<p>OTOH, this version <em>is</em> marginally more deniable.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217146">

			<div class="comment by-ruben-schade ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://rubenerd.com/' rel='external nofollow ugc' class='url'>Ruben Schade</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217146">
						February 27, 2014 6:57 AM					</a>

				</p>

				<p>The use of this block shortcut in C-derived languages really needs to be discouraged. It does make code cleaner if all you have is one line, but it just invites trouble like this. I only just starting my professional coding career in the last few years, but already I&#8217;ve encountered similar issues where an extra line was inadvertently added outside a block. We were just lucky that appropriate procedures (compiler defaults, testing) caught them.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217147">

			<div class="comment by-dre ">

				<p class="commentcredit">

					<span class="commenter">Dre</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217147">
						February 27, 2014 7:32 AM					</a>

				</p>

				<p>Apparently neither GCC nor Clang (the compiler from xcode) throw a warning about unreachable code, even with the &#8220;warn all&#8221; flag enabled. That&#8217;s right, &#8220;warn on unreachable code&#8221; is <a href="https://www.imperialviolet.org/2014/02/22/applebug.html" rel="nofollow ugc">specifically excluded</a> from the &#8220;warn all&#8221; setting. Clang does have a separate flag for it, though.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217148">

			<div class="comment by-name ">

				<p class="commentcredit">

					<span class="commenter">Name</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217148">
						February 27, 2014 7:34 AM					</a>

				</p>

				<p>This bug would have been impossible in Python. I know that a lot of C fans hate Python&#8217;s significant whitespace feature, but it completely eliminates this family of errors.</p>
<p>I&#8217;m just saying.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217149">

			<div class="comment by-kyle ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://kyle.marek-spartz.org' rel='external nofollow ugc' class='url'>Kyle</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217149">
						February 27, 2014 7:36 AM					</a>

				</p>

				<p>My guess was that it was a merge conflict that went unresolved.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217150">

			<div class="comment by-martin-schroder ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.oneiros.de/' rel='external nofollow ugc' class='url'>Martin Schröder</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217150">
						February 27, 2014 7:37 AM					</a>

				</p>

				<p>@Dre: And in gcc the &#8220;warn on unreachable code&#8221; is <strong>disabled</strong> since <a href="http://gcc.gnu.org/ml/gcc-help/2011-05/msg00360.html" rel="nofollow ugc">at least 2011</a>.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217151">

			<div class="comment by-jim-h ">

				<p class="commentcredit">

					<span class="commenter">Jim H</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217151">
						February 27, 2014 7:39 AM					</a>

				</p>

				<p>Are Apple using xcode internally? Does xcode highlight unreachable code?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217152">

			<div class="comment by-stephen-thomas ">

				<p class="commentcredit">

					<span class="commenter">Stephen Thomas</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217152">
						February 27, 2014 7:41 AM					</a>

				</p>

				<p>Merge conflict or copy-and-paste gone awry. If someone had wanted to camouflage the error, they could have done a much better job.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217153">

			<div class="comment by-alex-young ">

				<p class="commentcredit">

					<span class="commenter">Alex Young</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217153">
						February 27, 2014 7:43 AM					</a>

				</p>

				<p>Here&#8217;s the full source file: <a href="http://opensource.apple.com/source/Security/Security-55471/libsecurity_ssl/lib/sslKeyExchange.c?txt" rel="nofollow ugc">http://opensource.apple.com/source/Security/Security-55471/libsecurity_ssl/lib/sslKeyExchange.c?txt</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217154">

			<div class="comment by-poul-henning-kamp ">

				<p class="commentcredit">

					<span class="commenter">Poul-Henning Kamp</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217154">
						February 27, 2014 7:44 AM					</a>

				</p>

				<p>I&#8217;m with Bruce on this one:</p>
<p>This smells so much that it&#8217;s hard to belive it is an accident.</p>
<p>However, I don&#8217;t think NSA would be behind this, they have other leverages with Apple (ie: PRISM &#8220;direct access to servers&#8221; and the CA/PKI system as such.)</p>
<p>I think it is far more likely that this was done on behalf of somebody Apple would never &#8220;assist with their inquries&#8221;.</p>
<p>But I&#8217;m not going to speculate who that might be, since there are far too many candidates.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217155">

			<div class="comment by-bobby ">

				<p class="commentcredit">

					<span class="commenter">Bobby</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217155">
						February 27, 2014 7:47 AM					</a>

				</p>

				<p>There are so many questions here &#8211; many asked above (apparent lack of testing, who did what and when in this code module, not enabling Clang unreachable code warnings and so on). I find it unacceptable for Apple not to respond professionally on this issue. They should do a full investigation and present their findings. We cannot let them get away with keeping quiet on this issue.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217156">

			<div class="comment by-woo ">

				<p class="commentcredit">

					<span class="commenter">Woo</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217156">
						February 27, 2014 7:49 AM					</a>

				</p>

				<p>Looking at the diff makes me wonder how that line ended up there.<br />
I don&#8217;t see any reason to add it, considering the changes in the lines above it. It doesn&#8217;t match up, syntactically.<br />
It&#8217;s also too obvious to assume it was added deliberately &#8211; the NSA or whoever could have done a much better job at plausible deniability (e.g. add a new if-clause above, together with the goto fail, commit that, and then remove the if-clause in a second commit and &#8220;forget&#8221; about removing the goto fail.)</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217157">

			<div class="comment by-alan-kaminsky ">

				<p class="commentcredit">

					<span class="commenter">Alan Kaminsky</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217157">
						February 27, 2014 7:49 AM					</a>

				</p>

				<p>How well I remember Edsger Dijkstra&#8217;s 1968 letter to <i>Communications of the ACM</i> titled &#8220;Go To Statement Considered Harmful.&#8221; Back then Dijkstra was pointing out how using the goto statement leads to unstructured, difficult-to-maintain code. Now we see how using the goto statement leads to insecure code.</p>
<p>Have we learned nothing about programming in the last 50 years?</p>
<p>Why would anyone in this day and age use goto statements?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217158">

			<div class="comment by-brock-allen ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://brockallen.com' rel='external nofollow ugc' class='url'>Brock Allen</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217158">
						February 27, 2014 7:54 AM					</a>

				</p>

				<p>A discussion and link to the diff/checkin for the flaw:</p>
<p><a href="https://news.ycombinator.com/item?id=7281378" rel="nofollow ugc">https://news.ycombinator.com/item?id=7281378</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217159">

			<div class="comment by-john ">

				<p class="commentcredit">

					<span class="commenter">John</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217159">
						February 27, 2014 7:55 AM					</a>

				</p>

				<p>Name: It would not have been impossible in Python at all, it would just look slightly different. That is, during a code edit a tab is mistakenly removed, since whitespace is semantically significant, that changes the functionality and the line does not belong to the if clause anymore, just like in this case.</p>
<pre>
if 1 == 2:
   print "Hello "
print "world"
</pre>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217160">

			<div class="comment by-felix ">

				<p class="commentcredit">

					<span class="commenter">felix</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217160">
						February 27, 2014 8:01 AM					</a>

				</p>

				<p>@Alan Kaminsky: if they would have used &#8220;return 0&#8221; or &#8220;throw SSLError()&#8221; instead of &#8220;goto fail&#8221;, they would still have the same bug.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217161">

			<div class="comment by-folbec ">

				<p class="commentcredit">

					<span class="commenter">folbec</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217161">
						February 27, 2014 8:01 AM					</a>

				</p>

				<p>To me this looks like a botched patch merge job by some automated tool.</p>
<p>I get this kind of things occasionnally, even with modern tools like git or Mercurial. However, it should have been caught in code review and / or automated testing.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217162">

			<div class="comment by-gweihir ">

				<p class="commentcredit">

					<span class="commenter">Gweihir</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217162">
						February 27, 2014 8:05 AM					</a>

				</p>

				<p>To any halfway competent C programmer, this flaw will be glaringly obvious. Sure, if the code was written once, badly tested and never read by anyone, the flaw has some (low) level of plausibility. But even a single code walk-through or even cursory but complete read-through would immediately have found it.</p>
<p>My money is on &#8220;deliberate, low saboteur competence&#8221;.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217163">

			<div class="comment by-andrew ">

				<p class="commentcredit">

					<span class="commenter">Andrew</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217163">
						February 27, 2014 8:05 AM					</a>

				</p>

				<p>The source control system should of course have full accountability for who made the change, including back-tracing to the bug report that spawned it and the code reviewers who approved it. It&#8217;s hard to believe something like that could get through code review but some pretty obvious things do get missed. One would think that security code would get far more formal inspection (it does at my company).</p>
<p>And, let&#8217;s not forget the <a href="https://freedom-to-tinker.com/blog/felten/the-linux-backdoor-attempt-of-2003/" rel="nofollow ugc">Great Linux Backdoor Attempt of 2003.</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217164">

			<div class="comment by-jamesr ">

				<p class="commentcredit">

					<span class="commenter">JamesR</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217164">
						February 27, 2014 8:06 AM					</a>

				</p>

				<p>Not that tricky to detect unused code&#8230; I&#8217;m sure some of you saw this:</p>
<p><a href="https://twitter.com/appcode/status/437896886649757696/photo/1" rel="nofollow ugc">https://twitter.com/appcode/status/437896886649757696/photo/1</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217165">

			<div class="comment by-david-conrad ">

				<p class="commentcredit">

					<span class="commenter">David Conrad</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217165">
						February 27, 2014 8:11 AM					</a>

				</p>

				<p>A merge conflict that was resolved badly makes a lot of sense to me. If it were international I think either the first goto would be an unrelated line of code, or the if would have a semicolon after it and there would be just one goto. I agree that Apple needs to explain why an unreachable code warning wasn&#8217;t turned on and paid heed to, and how this escaped testing. But, pace Dijkstra, goto is not the problem here. You would have the exact same problem if a flag was set and later tested, if the assignment of the flag was duplicated in the same way.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217166">

			<div class="comment by-scott-jordan ">

				<p class="commentcredit">

					<span class="commenter">Scott Jordan</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217166">
						February 27, 2014 8:13 AM					</a>

				</p>

				<p>The testing is what has my eye.</p>
<p>How could such a fundamental function in a  modern OS get short-circuited in this way and not be detected?  &#8230;It&#8217;s not a rhetorical question; if I were Tim Cook it would be the thing I would want investigated with hot pokers and tongs, right now dammit.</p>
<p>It&#8217;s as if a file-write function failed to write data to disk: a fundamental failure.  If it was missed in testing then either the testing was lame to a literally unbelievable degree &#8230;or something else is going on.</p>
<p><b>Keep in mind that Apple itself may have been a victim of this.</b>  It&#8217;s a company whose devotion to secrecy is well known, and a company that eats its own dog-food.  This vulnerability potentially exposed all manner of internal conversations, data, passwords and transactions as employees work around the globe and converse with partners and suppliers around the globe.</p>
<p>Cui bono?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217167">

			<div class="comment by-alan ">

				<p class="commentcredit">

					<span class="commenter">Alan</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217167">
						February 27, 2014 8:14 AM					</a>

				</p>

				<p>You might be able to trace the change to a username, but you would have no idea who actually used that username to make the change.  The user&#8217;s account could have easily been hacked or stolen and used to make the change.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217168">

			<div class="comment by-wayne ">

				<p class="commentcredit">

					<span class="commenter">Wayne</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217168">
						February 27, 2014 8:17 AM					</a>

				</p>

				<p>With some existing revision control systems this is very possibly<br />
a merge conflict that auto-merged as so the result of the merge<br />
was never examined by a human.  Since the resulting code compiled<br />
and passed regressions no one noticed. And if this was legacy code no one bothered removing all compiler warnings so new warnings wouldn&#8217;t be noticed.</p>
<p>Disclaimer: I am a developer of BitKeeper who has obsessed over software merging for years.  Forgive me if I say our merge is still significantly better than current open-source code.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217169">

			<div class="comment by-dre ">

				<p class="commentcredit">

					<span class="commenter">Dre</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217169">
						February 27, 2014 8:26 AM					</a>

				</p>

				<p>Incidentally, I end up doing this all the time in Notepad++. Ctrl-D means &#8220;duplicate current line&#8221; and Ctrl-S means &#8220;Save&#8221;. Sometimes when I go to hit Save via keyboard shortcut, my finger clips the D on the way&#8230;</p>
<p>Of course, I&#8217;m not Apple, I&#8217;m just a dude. So that&#8217;s no excuse.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217170">

			<div class="comment by-paul ">

				<p class="commentcredit">

					<span class="commenter">paul</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217170">
						February 27, 2014 8:28 AM					</a>

				</p>

				<p>How incomplete a test suite would you need to miss this case? There aren&#8217;t a whole lot of cases at the top level for secure connections.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217171">

			<div class="comment by-tamas-tarjanyi ">

				<p class="commentcredit">

					<span class="commenter">Tamas Tarjanyi</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217171">
						February 27, 2014 8:31 AM					</a>

				</p>

				<p>I doubt we can ever get the answer but VCS (Version Control System/Software) can easily answer when it was introduced and by whom. Via commit? Via merge? By human or by automated process?<br />
The big problem is lack of trust. Whatever they say nobody belives anymore. That is really said and the real problem I think.<br />
So many lies around.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217172">

			<div class="comment by-benni ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://Herr' rel='external nofollow ugc' class='url'>Benni</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217172">
						February 27, 2014 8:33 AM					</a>

				</p>

				<p>Actually, exactly this kind of bug helps nsa when they are running operation &#8220;FLYING PIG&#8221; where they impersonate google and yahoo using ssl encryption: <a href="https://www.schneier.com/blog/archives/2013/09/new_nsa_leak_sh.html" rel="nofollow ugc">https://www.schneier.com/blog/archives/2013/09/new_nsa_leak_sh.html</a></p>
<p>I wonder wether Microsoft behaves equally in similar situations.</p>
<p>In these slites <a href="https://firstlook.org/theintercept/2014/02/24/jtrig-manipulation/" rel="nofollow ugc">https://firstlook.org/theintercept/2014/02/24/jtrig-manipulation/</a> it is revealed how gchq may put pressure on company employees.</p>
<p>It is possible that nsa just approached the responsible dev at apple by a honey trap and then blackmailed him.</p>
<p>For example, leading developers of microsofts crypto api were stunned when they learnt from outsiders that windows cryptoapi contained not only a second but a third nsa key:</p>
<p><a href="http://www.heise.de/tp/artikel/5/5263/1.html" rel="nofollow ugc">http://www.heise.de/tp/artikel/5/5263/1.html</a></p>
<p>these things could be introduced by just one developer that was pressed that way.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217173">

			<div class="comment by-uh-mike ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://xkcd.com/722/' rel='external nofollow ugc' class='url'>Uh, Mike</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217173">
						February 27, 2014 8:40 AM					</a>

				</p>

				<p>If the person who made the mistake were liable for damages, the whole progression here would have been quite a lot different.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217174">

			<div class="comment by-benni ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://Herr' rel='external nofollow ugc' class='url'>Benni</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217174">
						February 27, 2014 8:52 AM					</a>

				</p>

				<p>One should also note that, as far as I know there are export regulations which basically mean that apple and microsoft must hand out the code of their operating system to get reviewed by nsa (at least this was the answer of microsoft when asked about the nsa key, that they were forced to give the sourcecode to nsa for review). Under these circumstances, it is very easy for nsa to blackmail some devs that they introduce one small line of code.</p>
<p>It is also easy to bug servers at google this way (at least Bruce Schneier says that they have, appart from prism, where they ask the companies directly, and muscular, where they sit, with help by the fiber provider,  on the rented fibers between the google servers,  a third programm, where nsa introduced bugs into individual google servers, in order for collecting adress bugs and wlan passwords)</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217175">

			<div class="comment by-diydsp ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://diydsp.com' rel='external nofollow ugc' class='url'>diydsp</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217175">
						February 27, 2014 9:01 AM					</a>

				</p>

				<p>I&#8217;m with those who blame a merge issue&#8230;</p>
<p>&#8230;but I also blame lax practices including: 1. not using curly braces, 2. using goto instead of a flag (actually they had a flag and didn&#8217;t use it properly&#8230;.)  3. not using/ignoring proper compiler warnings.  All three of these use more hard drive space b/c larger code, but dammit, they lead to reliable code.  Security is one place where you want reliable code, suggests me.</p>
<p>While we&#8217;re at it: What about mixing uint8_t notation and UInt16?  What about no comments at all?  What about mixing the type OSStatus with zero?  How about the unnecessary/misleading comparison to zero?  if OSStatus is an enumerated type (appears to be) how about labeling it with _e?  How about putting the constant in the comparison on the left side (yes I know it&#8217;s not ==, but how about preparing for the future in case new return codes are added?) ?</p>
<p>And that&#8217;s just good syntax practices.  I just realized the function is only using /one/ of the /five/ parameters passed to it.  wtfbbq!</p>
<p>Yes, I&#8217;ve been coding for &gt;0x14 years and I realize none of my suggestions is critical, but they&#8217;re all part of writing reliable, high-quality code.  And this security breach is evidence that minimal-quality crap code will come back and bite you in the arse.  C&#8217;mon guys, you&#8217;re /Apple/.  You get paid well.  Write good code.  If this is typical code quality, I wouldn&#8217;t be surprised to found a fountain of errors.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217176">

			<div class="comment by-kevin-lyda ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.votefromabroad.org/' rel='external nofollow ugc' class='url'>Kevin Lyda</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217176">
						February 27, 2014 9:08 AM					</a>

				</p>

				<p>To me it demonstrates the flaw of throw it over the wall open sourcing. Apple releases all of this code from time to time, but without all the commits that got it there.</p>
<p>That&#8217;s unfortunate.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217177">

			<div class="comment by-craig ">

				<p class="commentcredit">

					<span class="commenter">Craig</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217177">
						February 27, 2014 9:24 AM					</a>

				</p>

				<p>I think a merge error (possibly not even flagged by the revision control system as a conflict) may be to blame for this. I don&#8217;t know what Apple&#8217;s practices are like with regard to having developers working on different features in different branches, or merging fixes from older release branches to newer ones, but if you&#8217;re merging thousands of files all at once, you tend to trust the software to do it right and call out conflicts where necessary. Otherwise the merge process would take forever.</p>
<p>If this was instead the result of an individual carelessly editing the file, then that person ought to be taught proper practices for submitting changes. After I have edited one or more files, I always review my changes line-by-line using a visual diff tool before submitting anything. Something like this would have been caught that way. A required code review by another engineer would also have caught it, assuming the reviewer actually took the time to examine the changes in detail and understand them.</p>
<p>While I consider the use of the &#8220;goto&#8221; keyword to be a hallmark of incompetence in C and similar languages, I don&#8217;t think that it, or the lack of curly braces, really has anything to do with this. There are lots of ways that similar errors could have been introduced by an accidentally duplicated or omitted line. If someone says that this example proves anything about goto or C&#8217;s optional curly braces, they&#8217;re just taking advantage of the situation to argue for their own personal preference. It&#8217;s sort of like saying, &#8220;See, fast food really is bad for you&#8221; after hearing about some deranged gunman shooting up a McDonald&#8217;s. No one with a decent grasp of logic will be convinced by that sort of argument.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217178">

			<div class="comment by-jimfive ">

				<p class="commentcredit">

					<span class="commenter">Jimfive</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217178">
						February 27, 2014 9:26 AM					</a>

				</p>

				<p>I&#8217;m sure all of the programmers among us have seen diffs where it looks like a line was removed and then the same line was added.</p>
<p>I wonder how hard it would be to fool the automated merge into thinking that a duplicate line added by different commits was different and happily add it twice.</p>
<p>I agree that coding standards that required either braces or a single line would have made this easy to pick out in code review. e.g.<br />
if (0==x) goto fail;</p>
<p>or</p>
<p>if(0==x) {<br />
    goto fail;<br />
}</p>
<h2>On a vaguely related note, I think == for comparison was the biggest mistake made in the C language.  All of the other comparisons are single character (!, &lt;, &gt;) add = and mix and match at will.  I would have preferred pascal&#8217;s := for assignment.</h2>
<p>JimFive</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217179">

			<div class="comment by-diego ">

				<p class="commentcredit">

					<span class="commenter">Diego</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217179">
						February 27, 2014 9:27 AM					</a>

				</p>

				<p>Stallman was right. Al the time.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217180">

			<div class="comment by-peter ">

				<p class="commentcredit">

					<span class="commenter">Peter</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217180">
						February 27, 2014 9:36 AM					</a>

				</p>

				<p>@felix: surely if they used &#8220;throw SSLError()&#8221; instead of &#8220;goto fail&#8221; then the bug would reject all SSL authentication attempts, and would have been found a lot earlier?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217182">

			<div class="comment by-dandraka ">

				<p class="commentcredit">

					<span class="commenter">dandraka</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217182">
						February 27, 2014 9:46 AM					</a>

				</p>

				<p>@all the people that point to a possible merge error:</p>
<p>Seriously ?????</p>
<p>Of course this can happen in software, be it a merge error, an accidental copy-paste or what have you. Any junior developer knows that.</p>
<p><strong>THAT&#8217;S WHY THERE ARE MANY LAYERS OF DEFENCE AGAINST THAT.</strong></p>
<p>Let me name a few, others can certainly complete the list:<br />
1. Peer programming<br />
2. Code review<br />
3. Compiler warnings<br />
4. Check-in rules<br />
5. Unit tests (i.e. tests that check specific code functionality)<br />
6. Integration tests (i.e. tests that treat the system as a black box)<br />
7. Verification and validation (which is basically testing done by soneone who is not the developer)</p>
<p>I <strong>cannot, do not</strong> believe that a halfway competent company writing software, let alone Apple, failed to spot this in one layer or the other. I <strong>do not</strong> believe that there is no unit or integration test that checks the system behaviour when presented with a valid and an invalid certificate.</p>
<p>So, again: seriously ?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217183">

			<div class="comment by-benni ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://Herr' rel='external nofollow ugc' class='url'>Benni</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217183">
						February 27, 2014 9:50 AM					</a>

				</p>

				<p>By the way: gchq strikes again:<br />
<a href="http://www.theguardian.com/world/2014/feb/27/gchq-nsa-webcam-images-internet-yahoo" rel="nofollow ugc">http://www.theguardian.com/world/2014/feb/27/gchq-nsa-webcam-images-internet-yahoo</a></p>
<p>the program &#8220;optic nerve&#8221; from gchq covertly saved images of 1.8 of webcams of private users in six months. Sexually explicit webcam material proved to be a particular problem for GCHQ, as one document delicately put it: &#8220;Unfortunately … it would appear that a surprising number of people use webcam conversations to show intimate parts of their body to the other person. it appears sometimes to be used for broadcasting pornography.&#8221;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217184">

			<div class="comment by-name-withheld-for-obvious-reasons ">

				<p class="commentcredit">

					<span class="commenter">name.withheld.for.obvious.reasons</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217184">
						February 27, 2014 9:53 AM					</a>

				</p>

				<p>Couple of things&#8230;</p>
<p>1.) Change and revision control is not a panacea, unit test should have caught this. Relying on compilers, lexical analysis, or code reviewers to do 100% code coverage is a mistake.</p>
<p>2.) Configuration management should have thrown a flag, did the code size for the SSL library entry via a checksum or actual library object code size be used to suggest that a specific review during the test phase&#8211;forcing a unit test that would be thorough.</p>
<p>3.) A mature, possibly ISO 15408 compliant, suggests that these processes are still immature. Or at least the people in charge of these processes are&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217185">

			<div class="comment by-benni ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://Herr' rel='external nofollow ugc' class='url'>Benni</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217185">
						February 27, 2014 9:53 AM					</a>

				</p>

				<p>instead of 1.8 webcams it should read  1.8 millions of webcams</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217186">

			<div class="comment by-peter ">

				<p class="commentcredit">

					<span class="commenter">Peter</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217186">
						February 27, 2014 9:55 AM					</a>

				</p>

				<p>I second Jimfive&#8217;s comment.  It&#8217;s very easy to get duplicate lines of code when doing a merge.  If the merge was from a release branch back to main, it&#8217;s even easier to see how it might be missed.  After that, all you need is lax compiler settings and you&#8217;ll never notice the problem.</p>
<p>I also wouldn&#8217;t be surprised if Apple isn&#8217;t using static code analysis for their C/C++ code.  Static code analyzers for C and C++ tend to generate <em>huge</em> numbers of false positives.  This makes it easy to miss problems, even if they&#8217;re flagged.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217187">

			<div class="comment by-uh-mike ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://xkcd.com/722/' rel='external nofollow ugc' class='url'>Uh, Mike</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217187">
						February 27, 2014 10:11 AM					</a>

				</p>

				<p>My iPhone offers to free me from passwords.</p>
<p>&#8220;Trust me.&#8221;</p>
<p>All devices, that have multiple security levels, are untrustworthy.  Just treat them that way.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217188">

			<div class="comment by-thierry ">

				<p class="commentcredit">

					<span class="commenter">Thierry</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217188">
						February 27, 2014 10:25 AM					</a>

				</p>

				<p>It is a shame that Apple engineering does not have good &#8211; or even basic &#8211; coding rules.</p>
<p>Such basic coding rules usually impose:</p>
<p>1) Always use {} even for one-line blocks. Would have prevent the bug.</p>
<p>2) Use the most paranoid warning mode of the compiler and turn warnings into errors. Compilation would have failed with a &#8220;dead code&#8221; warning/error.</p>
<p>Writing security code this way is pathetic.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217189">

			<div class="comment by-johnparry ">

				<p class="commentcredit">

					<span class="commenter">JohnParry</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217189">
						February 27, 2014 10:31 AM					</a>

				</p>

				<p>Take off your tin hats. Not deliberate. This would be an odd way for Apple to cooperate with the feds. Furthermore, it would jeopardize Apple, the company, if the cooperation ever came to light; i.e. Apple would go under. It would devastate the tech industry worldwide. The world economy would shutter. This list goes on and on.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217190">

			<div class="comment by-chelloveck ">

				<p class="commentcredit">

					<span class="commenter">Chelloveck</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217190">
						February 27, 2014 10:35 AM					</a>

				</p>

				<p>Having seen similar things in the past I can easily go with &#8220;mistake&#8221; rather than &#8220;malice&#8221; here. It&#8217;s perfectly obvious once you know it&#8217;s there, but we&#8217;ve all seen the repeated-word trick &#8212; show someone a sentence like &#8220;A bird in the the bush.&#8221; and see how long it takes them to notice the repeated &#8220;the&#8221;. Sometimes we just see what we expect to see, even when the problem is blindingly obvious once it&#8217;s been pointed out. Yeah, code review helps, static analysis helps, comprehensive testing helps&#8230;  But sometimes the reviewers miss things, the analyzers have checks disabled, the regression test isn&#8217;t as complete as it should be&#8230;  It happens. I&#8217;ve seen it happen. It famously happened circa 1990 when a missing &#8220;break&#8221; statement in AT&amp;T&#8217;s 5ESS code knocked out long distance service for the entire east coast. This instance could be malice, but I think a mistake is far more likely.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217191">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217191">
						February 27, 2014 10:37 AM					</a>

				</p>

				<p>@ diydsp</p>
<p>+1</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217192">

			<div class="comment by-benni ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://Herr' rel='external nofollow ugc' class='url'>Benni</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217192">
						February 27, 2014 10:40 AM					</a>

				</p>

				<p>@JohnParry:<br />
I think it is clear that there is no &#8220;contract&#8221; between apple or google and the nsa.<br />
What is not so clear is whether they do not have approached some developer and pressed him to do that.<br />
Or, if nsa can hack into the computers belgacom engineers to get into the gsm mobile network, it is even concievable that nsa could have hacked the computers of the responsible engineers at apple and planted this bug then there in the osx sourcecode. (The malware capabilities of nsa explicitely contains adding material, according to the slides).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217193">

			<div class="comment by-name ">

				<p class="commentcredit">

					<span class="commenter">Name</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217193">
						February 27, 2014 10:40 AM					</a>

				</p>

				<p>@Peter<br />
If they used &#8220;throw SSLError()&#8221;, they would have received a compiler error, of course. This is C, not C++ or ObjC.</p>
<p>The &#8220;goto error_handler;&#8221; idiom is fairly common in C, when you want to clean up before returning but you don&#8217;t want your if statements to be indented twelve or fifteen layers to the right. Take a look at, e.g., the Linux kernel source; it&#8217;s loaded with this.</p>
<p>@dandraka<br />
The commit bypasses code review because it&#8217;s an automated merge (or the reviewers don&#8217;t catch this because it&#8217;s part of a 5000-line merge review and things fall through the cracks), the compiler doesn&#8217;t warn because clang doesn&#8217;t warn on this issue even when you have -Wall turned on, and the unit test only tests the happy path. Easy. I could see a shop with half-decent process (emphasis on &#8220;half&#8221;) falling into this bug.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217194">

			<div class="comment by-callmelateforsupper ">

				<p class="commentcredit">

					<span class="commenter">CallMeLateForSupper</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217194">
						February 27, 2014 10:41 AM					</a>

				</p>

				<p>As a gray-beard who, in a former life, was a Product Test engineer for a major (cough) business machines producer, I am in company with @ Scott Jordan and the several other posters who fault the test regimen that failed to catch this coding error.  Compiler checks are fine, as far as they go, but they are only one arrow in the development/test quivers.</p>
<p>This piece of code does not serve its intended purpose.  Devising a functional test for it is trivial: feed it &#8220;bad&#8221; input and assure that it sounds klaxons; feed it &#8220;good&#8221; input and assure that it says &#8220;All clear&#8221;.  As released, this code says &#8220;all clear&#8221; regardless of input, so it was either poorly tested, at best, or was not tested at all.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217195">

			<div class="comment by-lou ">

				<p class="commentcredit">

					<span class="commenter">Lou</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217195">
						February 27, 2014 10:53 AM					</a>

				</p>

				<p>I agree with everyone else that this most likely smells like a merge error caused by an automated merge gone wrong. I&#8217;ve seen this sort of thing myself in my career all too often.</p>
<p>The big issue is with Apple&#8217;s QA department for not catching this in whatever testing they do.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217196">

			<div class="comment by-ozzie ">

				<p class="commentcredit">

					<span class="commenter">Ozzie</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217196">
						February 27, 2014 10:56 AM					</a>

				</p>

				<p>For me, an important question has not been asked:</p>
<p>Why did this module need to change between IOS 5 and IOS 6/7?</p>
<p>If it didn&#8217;t, then the odds are the hange was a deliberate malicious act.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217197">

			<div class="comment by-tobias-d-robison ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://ravensgift.com' rel='external nofollow ugc' class='url'>tobias d. robison</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217197">
						February 27, 2014 11:04 AM					</a>

				</p>

				<p>The error is NOT hard to spot, and the use of &#8220;goto&#8221; here, a source of many programming errors, was unnecessary. See my blog item on this code:<br />
<a href="http://precision-blogging.blogspot.com/2014/02/the-ios-ssl-flaw-hard-to-spot-bad.html" rel="nofollow ugc">http://precision-blogging.blogspot.com/2014/02/the-ios-ssl-flaw-hard-to-spot-bad.html</a><br />
&#8211; tobias d. robison</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217198">

			<div class="comment by-alan-bostick ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.spicejar.org/asiplease/' rel='external nofollow ugc' class='url'>Alan Bostick</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217198">
						February 27, 2014 11:07 AM					</a>

				</p>

				<p>As an aside: Bruce, it appears that notices for your blog posts aren&#8217;t showing up on Twitter. The latest blog notification on the @schneierblog feed is dated Feb. 21. (I was looking for the tweet for this post in order to retweet it, and couldn&#8217;t find it.)</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217199">

			<div class="comment by-warning-track ">

				<p class="commentcredit">

					<span class="commenter">Warning Track</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217199">
						February 27, 2014 11:09 AM					</a>

				</p>

				<p>I&#8217;m no programmer, as I&#8217;m sure I will make obvious.</p>
<p>I&#8217;m a schmuck consumer user.</p>
<p>I am supposed to believe that, in released software, whether an invalid security certificate will be nevertheless be accepted is not tested?</p>
<p>I don&#8217;t believe it.</p>
<p>The stench is overwhelming.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217200">

			<div class="comment by-calyth ">

				<p class="commentcredit">

					<span class="commenter">Calyth</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217200">
						February 27, 2014 11:10 AM					</a>

				</p>

				<p>The high deniability is a nice touch here. This can happen easily as a mistake when someone&#8217;s doing a 3-way merge manually. It&#8217;s doubly devious if this was intentional.</p>
<p>I wouldn&#8217;t go outright to say this is a backdoor. There&#8217;s no proof (and we&#8217;ll probably never going to find the proof).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217201">

			<div class="comment by-john-campbell ">

				<p class="commentcredit">

					<span class="commenter">John Campbell</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217201">
						February 27, 2014 11:13 AM					</a>

				</p>

				<p>The problem I see with the &#8220;function test&#8221; and &#8220;product test&#8221; regimen is that&#8230; is there a test case that looks for &#8220;right&#8221; problem?</p>
<p>Testing for the kinds of problems that sneak through this bug are obvious in hindsight&#8230;  and, unfortunately, some organizations have QA organizations that are exceptionally optimistic.</p>
<p>Also, never forget that there are folks who are under political pressure to accept a deliverable by a certain time and will ignore the testing protocols in order to get it deployed&#8230; and, frankly, I have run into systems where the minor design flaws hid the major design flaws.</p>
<p>No system is immune from failure because, somewhere, there is meat in the loop.</p>
<p>Testing is no more immune from failure than any other part of an organization.</p>
<p>Finally, IMHO, a &#8220;merge error&#8221; would make this a plausibly deniable exploit, wouldn&#8217;t it?  It&#8217;s just a coincidence that it&#8217;s a USEFUL exploit, right?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217202">

			<div class="comment by-lou ">

				<p class="commentcredit">

					<span class="commenter">Lou</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217202">
						February 27, 2014 11:14 AM					</a>

				</p>

				<p>@Ozzie you can see a diff of the code here to show what changed for the entire file: <a href="https://gist.github.com/alexyakoubian/9151610/revisions" rel="nofollow ugc">https://gist.github.com/alexyakoubian/9151610/revisions</a></p>
<p>I only skimmed the diff so far, and I&#8217;m no crypto expert, but it looks like they added support for PSK client keys to the module and, in the process, apparently cleaned up and simplified some of the other code so that some of the function calls weren&#8217;t always slinging around an SSL context pointer when it wasn&#8217;t really necessary.</p>
<p>It really does look like some sort of merge screw up to me.</p>
<p>The difficulty with looking at this diff is that Apple doesn&#8217;t publish their incremental changes, only massive code-dumps, so it&#8217;s hard to know what exactly was the state right before the bad line was inserted to see if anything else was inserted at that particular time.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217203">

			<div class="comment by-george-rogers ">

				<p class="commentcredit">

					<span class="commenter">George Rogers</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217203">
						February 27, 2014 11:17 AM					</a>

				</p>

				<p>This bug means that APPLE DOES NOT TEST SECURITY CODE.  The first test is to give it a valid certificate and the second one is to give it an invalid certificate.  If Apple had tested the code even once with an invalid cert they would have found this bug before shipping it.  The fact that it shipped is proof that they DO NOT TEST AT ALL.  This shouldn&#8217;t be surprising, we&#8217;re talking about a company that shipped an auto-update system for years with zero authentication until a third party researcher called them out on it.</p>
<p>Don&#8217;t attribute to malice what can be explained by simple incompetence.  Apple is proven to be incompetent with security.  They just don&#8217;t give a damn.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217204">

			<div class="comment by-jshell ">

				<p class="commentcredit">

					<span class="commenter">jshell</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217204">
						February 27, 2014 11:17 AM					</a>

				</p>

				<p>If it was intentional, then why bother fixing it?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217205">

			<div class="comment by-lou ">

				<p class="commentcredit">

					<span class="commenter">Lou</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217205">
						February 27, 2014 11:19 AM					</a>

				</p>

				<p>@jshell Or even why bother putting it in an open source portion of your code where the entire world will catch it?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217206">

			<div class="comment by-ray ">

				<p class="commentcredit">

					<span class="commenter">Ray</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217206">
						February 27, 2014 11:21 AM					</a>

				</p>

				<p>I don&#8217;t think a bug that anybody could have discovered by just redirecting and echoing traffic counts as low chance of discovery.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217208">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217208">
						February 27, 2014 11:26 AM					</a>

				</p>

				<p>This comment jumped out at me:</p>
<p>&#8220;Why did this module need to change between IOS 5 and IOS 6/7? If it didn&#8217;t, then the odds are the change was a deliberate malicious act.&#8221;</p>
<p>I&#8217;d like to know the answer to that.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217209">

			<div class="comment by-peter-marreck ">

				<p class="commentcredit">

					<span class="commenter">Peter Marreck</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217209">
						February 27, 2014 11:29 AM					</a>

				</p>

				<p>It looks like an errant merge conflict resolution, to me.</p>
<p>I second the need to unit-test EVERY code path, especially in ANY security-related code.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217210">

			<div class="comment by-dragonfrog ">

				<p class="commentcredit">

					<span class="commenter">dragonfrog</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217210">
						February 27, 2014 11:30 AM					</a>

				</p>

				<p>@JohnParry</p>
<p>RSA is a division of EMC.  It was revealed on December 20 that RSA took $10 million from the NSA to weaken the security of BSAFE.</p>
<p>Here&#8217;s what EMC&#8217;s stock price did around that time<br />
<a href="http://www.google.com/finance?q=NYSE%3AEMC&#038;ei=FnUPU_H4EYXLqQHopAE" rel="nofollow ugc">http://www.google.com/finance?q=NYSE%3AEMC&#038;ei=FnUPU_H4EYXLqQHopAE</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217211">

			<div class="comment by-impossibly-stupid ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.impossiblystupid.com/' rel='external nofollow ugc' class='url'>Impossibly Stupid</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217211">
						February 27, 2014 11:35 AM					</a>

				</p>

				<p>People need to stop pretending that simply using braces are a cure-all here.  It&#8217;s really about code standards, since there is no difference between:</p>
<p>if (foo)<br />
goto fail;</p>
<p>and</p>
<p>if (foo)<br />
{goto fail;}</p>
<p>The second one can just as easily lead to the same duplication &#8220;bug&#8221;.  What is really needed to address the problem is a higher level policy.  Even then, subtle sabotage is not going to be completely stopped, just made harder to explain aways as a simple mistake.</p>
<p>What I <em>really</em> would like to see is the change history of the file.  The given code is <em>so</em> shoddy that you have to wonder how it got that way.  Was this a long time in coming, or did some moron just jump in and start breaking up one-liners and adding goto statements?  Apple needs to start firing people, and maybe a lot of them.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217212">

			<div class="comment by-anura ">

				<p class="commentcredit">

					<span class="commenter">Anura</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217212">
						February 27, 2014 11:38 AM					</a>

				</p>

				<p>&#8220;Never attribute to malice that which is adequately explained by stupidity.&#8221;</p>
<p>Someone writing that code and paying attention wouldn&#8217;t make that error, but going through and making lots of code changes, e.g. deleting and moving code, and not paying close attention you could easily make that problem.</p>
<p>To me, this is about coding standards, compiler warnings, unit testing, and proper code review. If you always required braces for your control statements, you would avoid those errors. It can be missed in code review, of course, but if it&#8217;s not in-place, it should be.  Unit testing and compiler warnings about unreachable code would have stopped it if somehow it made it past code review, and coding style guidelines were enforced</p>
<p>The goto&#8217;s in that code can actually be removed easilly (resulting in actually less code), and that should really be named to cleanup instead of fail (since it&#8217;s always called).</p>
<pre>
if ((err = ReadyHash(hashRef, &amp;hashCtx)) == 0)
if ((err = hashRef-&gt;update(&amp;hashCtx, &amp;clientRandom)) == 0)
if ((err = hashRef-&gt;update(&amp;hashCtx, &amp;serverRandom)) == 0)
if ((err = hashRef-&gt;update(&amp;hashCtx, &amp;exchangeParams)) == 0)
if ((err = hashRef-&gt;final(&amp;hashCtx, &amp;hashOut)) == 0) {
    //success

}

//cleanup
</pre>
<p>Of course, I have superior powers of hindsight.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217213">

			<div class="comment by-daniel ">

				<p class="commentcredit">

					<span class="commenter">Daniel</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217213">
						February 27, 2014 11:41 AM					</a>

				</p>

				<p>It seems to me the real lesson here, the one that makes everyone vulnerable, is the fact that complex system fail in complex ways. The result it that it might never be possible to know whether something was a genuine bug or whether it was a deliberate hack. My computer exhibits behavior all the time that I cannot explain. Even if one can trace the error back to a specific person in Apple it may be difficult to to determine whether the person is a &#8220;bad actor&#8221; or whether he/she was simply incompetent.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217214">

			<div class="comment by-john-gilmore ">

				<p class="commentcredit">

					<span class="commenter">John Gilmore</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217214">
						February 27, 2014 11:43 AM					</a>

				</p>

				<p>Umm, do the test suites for all the other implementations of SSL and TLS catch this error?!</p>
<p>Umm2, does the browser you are reading this web site with catch this error?  Try following this link:  <a href="https://www.imperialviolet.org:1266/" rel="nofollow ugc">https://www.imperialviolet.org:1266/</a>.  My Firefox says &#8220;Secure Connection Failed: A PKCS #11 module returned CKR_DEVICE_ERROR&#8221;.  My Crackberry says &#8220;The selected server returned an error when attempting to fulfill your request.&#8221;  Both of them correctly failed to establish the SSL connection and failed to hand you a web page purporting to be from that server.  This is good!  Because that server simulates what happens after NSA, Joe Blow, or the Starbucks WiFi man-in-the-middles you with an encryption key that doesn&#8217;t match the signature sent.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217215">

			<div class="comment by-winter ">

				<p class="commentcredit">

					<span class="commenter">Winter</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217215">
						February 27, 2014 11:45 AM					</a>

				</p>

				<p>This does look &#8220;similar&#8221; to the OpenSSL bug in Debian<br />
<a href="http://www.debian.org/security/2008/dsa-1571" rel="nofollow ugc">http://www.debian.org/security/2008/dsa-1571</a></p>
<p>I think no one was suspecting foul play then.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217216">

			<div class="comment by-czerno ">

				<p class="commentcredit">

					<span class="commenter">Czerno</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217216">
						February 27, 2014 11:46 AM					</a>

				</p>

				<p>The dangers of the GOTO statement have been well understood since E.W. Dijkstra pointed them back in his famous 1968 address. The less widely known solution is the elegant COME FROM construct :</p>
<p>https www dot fortran dot com/come_from.html</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217217">

			<div class="comment by-yesme ">

				<p class="commentcredit">

					<span class="commenter">yesme</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217217">
						February 27, 2014 11:51 AM					</a>

				</p>

				<p>A lot has been said here already. I don&#8217;t know wheter the bug is deliberate or not, but if not, well it still is very crappy code. For a piece of Transport Layer Security code, that&#8217;s bad.</p>
<p>It reminds me of the FOSDEM video &#8220;a href=&#8221;http://video.fosdem.org/2014/Janson/Sunday/NSA_operation_ORCHESTRA_Annual_Status_Report.webm&#8221;&gt;NSA operation ORCHESTRA: Annual Status Report&#8220;. A good and quite funny presentation about the alleged activities of the NSA, seen from the POV of the FOSS community. And as Bruce Schneier said before, this is exactly how they would do it.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217218">

			<div class="comment by-impossibly-stupid ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.impossiblystupid.com/' rel='external nofollow ugc' class='url'>Impossibly Stupid</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217218">
						February 27, 2014 11:55 AM					</a>

				</p>

				<p>To followup on my own post, I tracked back through the links to the original source code (with revisions) at <a href="http://opensource.apple.com" rel="nofollow ugc">http://opensource.apple.com</a>.  That&#8217;s some of the worst coding practices I&#8217;ve ever seen.  They do indeed need to fire a lot of people.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217219">

			<div class="comment by-programmer ">

				<p class="commentcredit">

					<span class="commenter">Programmer</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217219">
						February 27, 2014 12:00 PM					</a>

				</p>

				<p>The code is difficult to read, so finding this specific error by an audit process into an ocean of millions of lines of code is against the odd, whatever some people here pretend and would like to think.</p>
<p>However, what would have been trivial, and should have been trivial, is a test system, which quite simply guarantee that the code does what it is supposed to do, no matter how it is coded.<br />
Such tests are suppose to exist and be performed at 3 levels (unit tests, function tests, system tests). Nothing that blatant is supposed to get through.</p>
<p>That this particular error could get through the entire automated non-regression test toolchain ask questions about Apple organization.<br />
Either they are unable to test correctly their software, which I find difficult to believe, and would largely destroy confidence in Apple software, or the bug was planted intentionally ; in which case, not only the code was modified, but also the (unpublished) test suite&#8230;</p>
<p>Apple is in the difficult position to select its poison : plead for incompetency, or for conspiracy.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217220">

			<div class="comment by-yesme ">

				<p class="commentcredit">

					<span class="commenter">yesme</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217220">
						February 27, 2014 12:00 PM					</a>

				</p>

				<p>Sorry, typo here. The correct link is:  &#8220;<a href="http://video.fosdem.org/2014/Janson/Sunday/NSA_operation_ORCHESTRA_Annual_Status_Report.webm" rel="nofollow ugc">NSA operation ORCHESTRA: Annual Status Report&#8221;</a>. And it&#8217;s still a very nice presentation.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217221">

			<div class="comment by-dan ">

				<p class="commentcredit">

					<span class="commenter">Dan</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217221">
						February 27, 2014 12:12 PM					</a>

				</p>

				<p>We all know it was intentional. We can&#8217;t trust any of these companies or the internet as it stands any longer. It&#8217;s time to collectively scrap this build before it&#8217;s too late and becomes autonomous. Hear me?  Do you agree?  If not, why?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217222">

			<div class="comment by-david-leppik ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.leppik.net/david/blog/' rel='external nofollow ugc' class='url'>David Leppik</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217222">
						February 27, 2014 12:15 PM					</a>

				</p>

				<p>@Anura:  there&#8217;s a similar but more language-independent pattern you see in all the time in Scala.  It&#8217;s the dispatcher pattern, with what I refer to as table-of-contents formatting.</p>
<pre>
function foo() {
   if (condition1)  return  action1();
   if (condition2)  return  action2();
   return defaultAction();
}
</pre>
<p>Rules:</p>
<ul>
<li>A function using table-of-contents styling is dominated by that style, so nobody gets confused.
</li>
<li>The function contains no side-effects:  it&#8217;s either a dispatcher or returns a value.  </li>
<li> It&#8217;s a table, so format it with rows and columns.
</li>
<li>  If a condition doesn&#8217;t easily fit on the line, it gets a private function.
</li>
</ul>
<p>Advantages:</p>
<ol>
<li>  Easy to comprehend.
</li>
<li>  Decisions (policy) are separate from actions (behavior), making debugging easier.
</li>
<li>  Even more compact than two-line, no-curly-braces.
</li>
</ol>
<p>Disadvantages:</p>
<ol>
<li>  Looks scary if you&#8217;re not used to it.
</li>
<li>  Is scary, if a developer doesn&#8217;t follow the rules and the dispatcher has side effects.
</li>
<li>  Lots of short single-use functions, which some developers hate.
</li>
<li>  Discourages functions with lots of parameters.  Wait, that&#8217;s an advantage.
</li>
</ol>
<p>Of course, as others as pointed out, the real problem here was that Apple didn&#8217;t test its code.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217223">

			<div class="comment by-mytwocents ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://mytwogaycents.com/' rel='external nofollow ugc' class='url'>MyTwoCents</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217223">
						February 27, 2014 12:19 PM					</a>

				</p>

				<p>It&#8217;s got to be deliberate. Isn&#8217;t it quite convenient that the &#8220;mistake&#8221; appeared exactly where it did, causing complete subversion of the certificate verification process? Here&#8217;s my own analysis of it: <a href="http://mytwogaycents.com/2014/02/25/ios-ssltls-mitm-vulnerability/" rel="nofollow ugc">http://mytwogaycents.com/2014/02/25/ios-ssltls-mitm-vulnerability/</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217224">

			<div class="comment by-alex ">

				<p class="commentcredit">

					<span class="commenter">Alex</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217224">
						February 27, 2014 12:23 PM					</a>

				</p>

				<p>As many others have already posted, the lack of testing is the suspicious thing.  You&#8217;d expect them to build a test when they coded the logic in the first place.  If they had, the bug would never have survived.</p>
<p>So one interesting thing would be to hear from Apple folks about the way the company uses tests.  Does the lack of a test in this case seem unusual?  Or does the code base have lots of examples of missing tests for important functionality?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217225">

			<div class="comment by-john ">

				<p class="commentcredit">

					<span class="commenter">John</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217225">
						February 27, 2014 12:24 PM					</a>

				</p>

				<p>@Impossibly Stupid: Your idealized version doesn&#8217;t work because other code is present surrounding these tests. There is really nothing out of the ordinary here.</p>
<p><a href="http://koblents.com/Ches/Links/Month-Mar-2013/20-Using-Goto-in-Linux-Kernel-Code/" rel="nofollow ugc">http://koblents.com/Ches/Links/Month-Mar-2013/20-Using-Goto-in-Linux-Kernel-Code/</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217226">

			<div class="comment by-dan ">

				<p class="commentcredit">

					<span class="commenter">Dan</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217226">
						February 27, 2014 12:27 PM					</a>

				</p>

				<p>Does all the conjecture really matter?  I know it&#8217;s interesting to speculate and expound on the issue, but why aren&#8217;t we talking about circumventing this cyber trap by building a new infrastructure?  How about that?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217227">

			<div class="comment by-gareth-owen ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.ghowen.me' rel='external nofollow ugc' class='url'>Gareth Owen</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217227">
						February 27, 2014 12:35 PM					</a>

				</p>

				<p>Presumably it would have been better to just change the if condition because I assume the hash functions always succeed unless something is seriously wrong.  That&#8217;d be a lot less hard to spot than an extra goto.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217228">

			<div class="comment by-anura ">

				<p class="commentcredit">

					<span class="commenter">Anura</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217228">
						February 27, 2014 12:46 PM					</a>

				</p>

				<p>@David Leppik</p>
<p>There are not multiple actions here, just one that occurs if all conditions are true.  If there is an issue with the certificate, the intention is that &#8220;success&#8221; code doesn&#8217;t run and it runs the &#8220;fail&#8221; code. if there is no problem with the certificate, the intention is that the success code runs, followed by the &#8220;fail&#8221; code. The &#8220;fail&#8221; code is really just cleanup code.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217229">

			<div class="comment by-john ">

				<p class="commentcredit">

					<span class="commenter">John</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217229">
						February 27, 2014 12:57 PM					</a>

				</p>

				<p>@Anura: But these tests occur in two places with code in between so you would need to duplicate the clean up section and wrap it up in an else clause. And that is only for this particular example. I quite like the use of macros for a &#8220;test and goto&#8221; in one.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217230">

			<div class="comment by-ifiwanted ">

				<p class="commentcredit">

					<span class="commenter">IfIWanted</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217230">
						February 27, 2014 1:01 PM					</a>

				</p>

				<p>This looks like incompetently sloppy coding combined with incompetently sloppy testing, rather than deliberate. A competent evildoer could do something far more obscure.  (I have been programming since the 1970s, if it matters, but I do think I would have been able to construct something far less obvious should I have been so minded).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217231">

			<div class="comment by-brian-m ">

				<p class="commentcredit">

					<span class="commenter">Brian M.</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217231">
						February 27, 2014 1:05 PM					</a>

				</p>

				<p>Czerno is right, GOTO has been well-known as a problem for quite some time.  I&#8217;ve seen &#8220;do {} while(0)&#8221; with break statements used as an alternative to the SSL sample.</p>
<p>What it looks like is that someone did a copy-and-paste of the code, then simply screwed up.  And if a code review is done fast and sloppily, as many are, then something like this gets missed.</p>
<p>Many times, the programmer is simply the guy who bullshits himself into the position, not the guy with the best expertise or concern for quality.  Couple that with stupid managers, and stuff like this is normal.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217232">

			<div class="comment by-facts-are-hard ">

				<p class="commentcredit">

					<span class="commenter">Facts are hard</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217232">
						February 27, 2014 1:08 PM					</a>

				</p>

				<p>Just to clarify since a lot of people are missing the point here.  This is NOT a case of &#8220;just throw an invalid security certificate&#8221; at it.  It&#8217;s not about a self-signed certs, or certs signed by untrusted keys, or anything like that.</p>
<p>It&#8217;s about the SSL handshake itself.  The cert is valid.  The signatures on the cert are correct.  The cert is the correct cert.  The problem here is after presenting the cert, the client and server engage in an SSL handshake, and in this handshake the server should present the client with data signed by the server certificate, and then the client should validate that signature against the public certificate they already received earlier.</p>
<p>That is the part that&#8217;s missing.  The client receives the cert, the SSL handshake begins, and the client does not validate whether or not the signed data in the SSL handshake was signed by the same cert previously received. So anybody that can sit on the network and see your client establishing an SSL handshake and can send forged responses back to you before the remote server can respond, can nearly effortlessless MITM your communication.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217233">

			<div class="comment by-brian-m ">

				<p class="commentcredit">

					<span class="commenter">Brian M.</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217233">
						February 27, 2014 1:10 PM					</a>

				</p>

				<p><i> If the Apple auditing system is any good, they would be able to trace this errant goto line not just to the source-code check-in details, but to the specific login that made the change.</i></p>
<p>This is called &#8220;source code control.&#8221;  This stuff has been standard for decades.  It is standard for a change to contain the time and date, along with the name of the person who made the change.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217234">

			<div class="comment by-anura ">

				<p class="commentcredit">

					<span class="commenter">Anura</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217234">
						February 27, 2014 1:16 PM					</a>

				</p>

				<p>@John</p>
<p>You&#8217;re right, I was looking at the wrong function. They actually have that code copy-pasted 6 times in the file. They should really make that a function. If they did, the code I modified could be used, it would just have a single return statement at the end (return err) and the last condition would become just a statement.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217235">

			<div class="comment by-spaceman-spiff ">

				<p class="commentcredit">

					<span class="commenter">Spaceman Spiff</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217235">
						February 27, 2014 1:16 PM					</a>

				</p>

				<p>Our group (performance, quality, analytics) at a tier-1 mobile device manufacturer, were all banging our heads when we looked at this code. This is NOT a mistake, unless Apple is totally incompetent! Personally, I don&#8217;t think they are, and that this is deliberate&#8230; 🙁</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217236">

			<div class="comment by-impossibly-stupid ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.impossiblystupid.com/' rel='external nofollow ugc' class='url'>Impossibly Stupid</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217236">
						February 27, 2014 1:18 PM					</a>

				</p>

				<p>@John</p>
<p>I&#8217;m not sure what you&#8217;re talking about.  I never present any &#8220;idealized&#8221; anything, nor do I make any particular point about goto that makes your link relevant.  My point <em>does</em> remain that the code (not just the line with this particular error, but in many other functions and probably many other files) does not appear to be written to be maintained by or shared with others.</p>
<p>Apple deserves all the hassle it&#8217;s finally getting for this style of coding.  If they don&#8217;t do some major firings and clean up this garbage code, I think this incident is only going to mark the tip of the iceberg.  If Linux does things wrong, too, they&#8217;ll have their own issues to deal with.  It absolutely does not excuse either party to point fingers at each other; neither is following <em>reasonable</em> practices (let alone best practices), and failure to address that problem will just lead to other problems down the road.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217237">

			<div class="comment by-anura ">

				<p class="commentcredit">

					<span class="commenter">Anura</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217237">
						February 27, 2014 1:18 PM					</a>

				</p>

				<p>To clarify my above post, you would still have gotos in your code, but it would be cleaner and less likely to result in an issue, and if you make a change you have to make it in one place and not 6.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217238">

			<div class="comment by-anderer-gregor ">

				<p class="commentcredit">

					<span class="commenter">Anderer Gregor</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217238">
						February 27, 2014 1:29 PM					</a>

				</p>

				<p>What strikes me is that people complain either about &#8220;goto&#8221; or about the missing braces, but everyone seems to agree that it was a good idea to (a) set &#8220;err&#8221; to a new value in each of the expressions (i.e. have a condition with troublesome side effects), and (b) not to assert that err is != 0 when we have reached the &#8220;fail&#8221; label. The error would have been caught way, way earlier if the &#8220;fail&#8221; section had refused to return a &#8220;0&#8221; value (which was causing all the problems, because this caused the whole function to return &#8220;all is good&#8221; when only half of the tests ran through). And using a &#8220;return value&#8221; from an assignment is not possible in many modern languages (e.g. python), and it seems like for a reason &#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217239">

			<div class="comment by-0day ">

				<p class="commentcredit">

					<span class="commenter">0day</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217239">
						February 27, 2014 1:29 PM					</a>

				</p>

				<p><b>To all who say &#8220;it looks like an actual mistake&#8221;:</b></p>
<p>That is exactly why this would be the right way to embed an intentional bug.</p>
<p>After a job like this, NSA would be glad if no one believed it to be intentional.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217240">

			<div class="comment by-anura ">

				<p class="commentcredit">

					<span class="commenter">Anura</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217240">
						February 27, 2014 1:36 PM					</a>

				</p>

				<p>@Impossibly Stupid</p>
<p>I find that horrible code and a lack of standards are very common among a lot of open source projects, sadly. The larger they are, the worse they tend to be in that regard. Code review tends to not include things like making sure the code actually follows an organization-consistent styling.</p>
<p>This is by no means limited to open source, of course, it&#8217;s just that I have access to more open source code than closed source code. I think a lot of large companies probably skip code review all together.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217241">

			<div class="comment by-tim ">

				<p class="commentcredit">

					<span class="commenter">tim</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217241">
						February 27, 2014 1:54 PM					</a>

				</p>

				<p>Based on many of the comments I can only assume that most here have never worked for a large engineering organization.  Engineers make mistakes.  Tools fail to find errors.  QA teams miss obvious unit tests.  Code review misses a bug because they were arguing for an hour over the tab setting should be 3 or 4 spaces.  That&#8217;s the nature of managing a large engineering organization.</p>
<p>This is a stupid error.  But its neither a sign of gross incompetence or a conspiracy.   I suspect that many within Apple are taking a hard look at their processes.  As it should be.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217242">

			<div class="comment by-johan-bentzen ">

				<p class="commentcredit">

					<span class="commenter">Johan Bentzen</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217242">
						February 27, 2014 1:55 PM					</a>

				</p>

				<p>First of all the real culprit here to me is the lack of a full-coverage unit test suite for security code.  It would not only guard against this specific problem, it would make it very difficult to sneak in an &#8216;accidental&#8217; merge error of this kind, because you would have to modify the test as well.</p>
<p>But secondly, I am presently making my living doing code review, and when I look at the diff presented at the first comment in this thread, it is blatantly obvious something is wrong.  There are three major changes going on in this change-set (a context has been made obsolete, a return code has been made more specific and a method has been renamed).  If you do a lot of review you learn to filter out such &#8216;expected&#8217; changes as you go through the code, and then the offending line becomes not one of a lot of changes, but one of a handful.</p>
<p>My conclusion is that Apple neither does unit testing nor code review professionally.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217243">

			<div class="comment by-mike-amling ">

				<p class="commentcredit">

					<span class="commenter">Mike Amling</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217243">
						February 27, 2014 2:08 PM					</a>

				</p>

				<p>Not that it makes a lot of difference, but &#8230;</p>
<p>The code is not checking for &#8220;an invalid certificate&#8221;. Since the code is hashing things called &#8220;serverRandom&#8221; and &#8220;signedParams&#8221;, it&#8217;s not checking the certificate per se, but instead ephemeral data generated by TLS after the certificate is checked.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217244">

			<div class="comment by-martinr ">

				<p class="commentcredit">

					<span class="commenter">martinr</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217244">
						February 27, 2014 2:17 PM					</a>

				</p>

				<p>As it has just been mentioned, this double &#8220;goto fail;&#8221; is in the code that verifies the digital signature on the ServerKeyExchange contents, i.e. on the ephemeral Diffie Helman Parameters and Server Key (DHE or ECDHE).  With this bug, a man-in-the-middle attacker can substitute the (EC)DHE key with his own and successfully impersonate the server in the handshake.</p>
<p>The many gotos in the code and the single cleanup handler is perfectly OK, but <em>not</em> initializing the return value of a security critical function with error, and ABUSING the function return value to store technical interim results of subfunctions is extremely dumb.</p>
<p>Such a function MUST NOT assign &#8220;success&#8221; to the function return value before the very final verification step has determined a positive verification result.</p>
<p>This code is poor because it does not fail safe.  Programming fault tolerant and showing fail safe behaviour is very important for security-critical functions.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217245">

			<div class="comment by-mike-amling ">

				<p class="commentcredit">

					<span class="commenter">Mike Amling</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217245">
						February 27, 2014 2:30 PM					</a>

				</p>

				<p>As long as we&#8217;re bashing the language&#8230;</p>
<p>In C, SSLHashSHA1.update(&amp;hashCtx, &#8230;) returns a value apparently because it may, e.g., find something it doesn&#8217;t like about &amp;hashCtx. In a better programming language, a hash update would return void. If update found something it didn&#8217;t like, it could throw an exception. There wouldn&#8217;t be any need for the ifs.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217246">

			<div class="comment by-goto-reconsidered ">

				<p class="commentcredit">

					<span class="commenter">GOTO reconsidered</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217246">
						February 27, 2014 2:42 PM					</a>

				</p>

				<p>@Czerno &#8220;The dangers of the GOTO statement have been well understood since E.W. Dijkstra&#8230;&#8221;</p>
<p>There is nothing inherently wrong with GOTO statements.</p>
<p>Some people like Dijkstra simply find it impolite to point, being offended by directness itself.</p>
<p>This tends to be a disease of the dialectical mentality, where indirect, mediated experience is the norm.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217247">

			<div class="comment by-cass ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://nsa.gov' rel='external nofollow ugc' class='url'>Cass</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217247">
						February 27, 2014 2:54 PM					</a>

				</p>

				<p>Do you really expect us to take credit for this?  We dont take credit, EVER.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217248">

			<div class="comment by-andrew-ludgate ">

				<p class="commentcredit">

					<span class="commenter">Andrew Ludgate</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217248">
						February 27, 2014 3:11 PM					</a>

				</p>

				<p>Sniffing around, I found the following code that appears to be an older CPP version of what they had and modified at <a href="http://www.opensource.apple.com/source/Security/Security-54.1.3/SecureTransport/sslKeyExchange.cpp?txt" rel="nofollow ugc">http://www.opensource.apple.com/source/Security/Security-54.1.3/SecureTransport/sslKeyExchange.cpp?txt</a></p>
<pre>    if ((err = ReadyHash(SSLHashSHA1, hashCtx, ctx)) != 0)
        goto fail;
    if ((err = SSLHashSHA1.update(hashCtx, clientRandom)) != 0)
        goto fail;
    if ((err = SSLHashSHA1.update(hashCtx, serverRandom)) != 0)
        goto fail;
    if ((err = SSLHashSHA1.update(hashCtx, tempPubKey)) != 0)
        goto fail;
    if ((err = SSLHashSHA1.final(hashCtx, hashOut)) != 0)
        goto fail;</pre>
<p>tempPubKey was changed to &amp;signedParams, but there appear to be no extra tests in the older code.  That makes it less likely that the error was just due to moving code around and forgetting a line.  It also shows that the line wasn&#8217;t always like that &#8212; I&#8217;d like to know when the error was introduced.  Is it in OS X 10.6, for example?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217249">

			<div class="comment by-impossibly-stupid ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.impossiblystupid.com/' rel='external nofollow ugc' class='url'>Impossibly Stupid</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217249">
						February 27, 2014 3:34 PM					</a>

				</p>

				<p>@Anura</p>
<p>I&#8217;ve also found that a lot of open source projects are organizationally . . . wanting.  Whether it&#8217;s lack of a common code style or higher level issues (e.g., failure isolate and refactor some things into an independent library), the same &#8220;brogrammer&#8221; chest-beating idiots often set the tone for the project, treating commits as the only thing that matters.  That&#8217;s one of the main reasons I avoid contributing to most open source efforts.</p>
<p>But this is <em>Apple</em> we&#8217;re talking about here.  They&#8217;re supposed to be all about clean and elegant things.  They have a ton of cash they could be using to hire developer that make <em>their</em> open source software the envy of every volunteer effort out there.  Instead, we get this sort of crap, which may not be any worse than the things thrown together by hobbyists, but that&#8217;s so far away from expectations that it is baffling that Apple has given jobs to these people.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217250">

			<div class="comment by-jones ">

				<p class="commentcredit">

					<span class="commenter">jones</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217250">
						February 27, 2014 3:44 PM					</a>

				</p>

				<p>The quality of Apple&#8217;s software engineering has been declining for some time.  They get lots of media attention for their glossy interfaces, but they don&#8217;t even follow the human interface guidelines that made them a success anymore.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217251">

			<div class="comment by-czerno ">

				<p class="commentcredit">

					<span class="commenter">Czerno</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217251">
						February 27, 2014 3:45 PM					</a>

				</p>

				<p>@GOTO reconsidered :</p>
<p>&#8220;There is nothing inherently wrong with GOTO statements.&#8221; The real point is structured vs. &#8216;spaghetti&#8217; code, and while it&#8217;s certainly possible to produce well structured programs using GOTOs,<br />
excessive and/or lazy use of the latter tend to favour bad, unmaintainable, unprovable code.</p>
<p>However my earlier post was not meant to be taken so seriously, as you&#8217;d certainly realised had you followed the provided link (the &#8220;come from&#8221; statement. Twas an April fool&#8217;s day article in CACM ca. 1974 which I can remember made me LOL, back then)</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217252">

			<div class="comment by-sean-riley ">

				<p class="commentcredit">

					<span class="commenter">Sean Riley</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217252">
						February 27, 2014 3:45 PM					</a>

				</p>

				<p>I&#8217;m not a security expert, but isn&#8217;t the argument here essentially, &#8220;Boy, this sure looks like a mistake, ergo, it might be a conspiracy!&#8221;?</p>
<p>I get the logic that if you were going to deliberately introduce a backdoor you&#8217;d want to do so in such a way that it looks like a mistake. But mistakes do happen, and leaping to the assumption that it&#8217;s deliberate <em>precisely because</em> it looks so perfectly like a mistake seems odd to me.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217253">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217253">
						February 27, 2014 3:47 PM					</a>

				</p>

				<p>@ tim</p>
<p>The only habits of a large organization that matter here are Apple&#8217;s. We already know how they approach security.</p>
<p><a href="http://www.zdnet.com/blog/security/kaspersky-apple-10-years-behind-microsoft-in-terms-of-security/11706" rel="nofollow ugc">http://www.zdnet.com/blog/security/kaspersky-apple-10-years-behind-microsoft-in-terms-of-security/11706</a></p>
<p><a href="http://www.macworld.com/article/1140793/macsecurity.html" rel="nofollow ugc">http://www.macworld.com/article/1140793/macsecurity.html</a></p>
<p>Looking for critical flaws, I have at least one a year going back quite a while. These included easy ways to bypass passwords. Apple added new security features like the Capsicum-derived sandboxing system. However, Apple&#8217;s problem is that their development process doesn&#8217;t care about security at all from design to implementation to maintenance. That&#8217;s what the results of their process suggests, anyway.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217254">

			<div class="comment by-impossibly-stupid ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.impossiblystupid.com/' rel='external nofollow ugc' class='url'>Impossibly Stupid</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217254">
						February 27, 2014 3:50 PM					</a>

				</p>

				<p>@Anderer Gregor</p>
<p>Well, the code is <em>so</em> bad that you can&#8217;t blame everyone for not picking apart every last bit of stupidity in it.  The use of assignment values is hardly the worst thing a language might allow, but it generally <em>is</em> considered bad practice to do assignments in conditionals at all, because anyone new who comes along and starts looking at the code has to stop and question whether or not a = should actually have been a ==.  There are all sorts of constructs in all sorts of languages that allow you to do dumb things.  The professional programmer strives to not hang themselves (or others) like that.  Apparently Apple doesn&#8217;t hire that kind of developer.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217255">

			<div class="comment by-impossibly-stupid ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.impossiblystupid.com/' rel='external nofollow ugc' class='url'>Impossibly Stupid</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217255">
						February 27, 2014 3:55 PM					</a>

				</p>

				<p>@Sean Riley</p>
<p>The processes leading to this &#8220;mistake&#8221; is such a Rube Goldberg set up of things that it makes it hard <em>not</em> to ascribe some agency to this level of incompetence.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217257">

			<div class="comment by-czerno ">

				<p class="commentcredit">

					<span class="commenter">Czerno</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217257">
						February 27, 2014 3:57 PM					</a>

				</p>

				<p>Re. Dijskstra : as you probably know, he didn&#8217;t /just/ show us how &#8220;harmful&#8221; GOTOs could be. He was a fierce proponent of procedural programming &#8211; after all, he had been one of the designers of Algol, which by the way /has/ GOTO &#8211; and later languages which lend themselves naturally to abstract proofs of programs. His book &#8216;A discipline of programming&#8217; was very illuminating (to me, and I bet, many). It is somwhat sad that those ideas had so little influence over the world of commercial programming, and over the adoption of better programming languages ( C and derivatives are terrible in this respect! )</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217258">

			<div class="comment by-anura ">

				<p class="commentcredit">

					<span class="commenter">Anura</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217258">
						February 27, 2014 4:46 PM					</a>

				</p>

				<p>@Impossibly Stupid</p>
<p>I don&#8217;t think it&#8217;s so much about hiring good programmers, as it is taking the time to recognize there is a problem and clean things up, which ends up being a managment decision. Where I work now, we have a lot of messy code, inconsitent naming and casing, inconsistent indenting (e.g. sometimes things are indented, sometimes they are not, sometimes 4 spaces, sometimes I&#8217;ll have three lines, one indented 4 spaces, one 5, one 7 and one 9 spaces), mixing tabs and spaces for indents. The only thing that&#8217;s consistent here is inconcistency. Next to nothing is broken out into functions, copy-paste is everywhere, it&#8217;s just one gigantic mess.</p>
<p>The thing is, when I work, I mimic the existing standards in place. If the code is already a mess, I&#8217;m not going to go back and fix everything; I have tasks I need to complete. I would gladly go back and fix everything, refactor the whole damned thing, component by component. There&#8217;s kind of a &#8220;if it works, don&#8217;t fix it&#8221; attitude, however, so it&#8217;s never going to happen.</p>
<p>I think we should have a standing order in the open source world. If the code is over 10 years old, freeze all non-critical changes, and refactor.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217259">

			<div class="comment by-anon ">

				<p class="commentcredit">

					<span class="commenter">anon</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217259">
						February 27, 2014 5:46 PM					</a>

				</p>

				<p>The second go to fail provides plausible deniability of compiler errors not linting properly. However, the economic problem is huge.</p>
<p>Disclosing and patching is a code canary and another non-disclosure disclosure.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217260">

			<div class="comment by-buck ">

				<p class="commentcredit">

					<span class="commenter">Buck</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217260">
						February 27, 2014 6:17 PM					</a>

				</p>

				<p>Plenty of Apple-directed flames to go around&#8230;<br />
I wonder what the fact that this went unnoticed for so long says about the current state of our entire industry&#8230; :-\</p>
<p>Deliberate? Probably&#8230;<br />
By whom? No saying&#8230;</p>
<p>And how many others may have noticed, but took a more tight-lipped approach..?</p>
<p>Did anyone happen to catch the timestamp of that commit?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217261">

			<div class="comment by-impossibly-stupid ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.impossiblystupid.com/' rel='external nofollow ugc' class='url'>Impossibly Stupid</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217261">
						February 27, 2014 7:01 PM					</a>

				</p>

				<p>@Anura</p>
<p>I just don&#8217;t think you can separate the two: bad management and bad programmers are a hand-in-hand dysfunctional pair, each enabling the other.  There should be enough firings to go around, from the lowly grunt coder who typed in the code, to the senior developers who approved it, to the managers who cultivate that environment, to the officers who do the same.  This is exactly the thing that people can and <em>should</em> point to for years to come as why you need to rock the boat like a proper (computer) scientist.</p>
<p>Nobody is perfect, but there <em>has</em> to be some accountability.  And you&#8217;re responsible for your own professionalism, too.  Every place that I&#8217;ve gone into that had bad code readily admitted it, and I always tell them that if they don&#8217;t make a priority of cleaning things up, they better not plan on me sticking around for long.  The good ones change, the bad ones make excuses.  Apple is keeping quiet on the bigger picture for now, but for now they&#8217;re the bad guys here, from Tim Cook on down, until they make some <em>serious</em> QA changes.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217262">

			<div class="comment by-joe-buck ">

				<p class="commentcredit">

					<span class="commenter">Joe Buck</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217262">
						February 27, 2014 7:11 PM					</a>

				</p>

				<p>I like the merge bug theory.  Some source control systems, Perforce in particular but potentially any system that uses line-based differences, can be confused when doing merges by repeated lines, and match up lines to be inserted or deleted to the wrong place when work on a development branch is merged to another branch.  The many instances of the &#8220;goto fail;&#8221; line provide ample opportunities for this.  One method to make this kind of failure less likely for C or C++ code is to require as part of coding standards that curly braces always be used with if-statements, even if there is one statement in the body.  Had this been done, an extra &#8220;goto fail&#8221; would be unreachable code, probably would produce a warning, and would in any case be harmless.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217263">

			<div class="comment by-james-card ">

				<p class="commentcredit">

					<span class="commenter">James Card</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217263">
						February 27, 2014 7:49 PM					</a>

				</p>

				<p>I somehow doubt that this was deliberate.  It looks more like a copy and paste error.  If I were to do this deliberately I would have done the following:</p>
<p>if ((err = SSLHashSHA1.update(&amp;hashCtx, &amp;serverRandom)) != 0)<br />
        goto fail;<br />
    if ((err = SSLHashSHA1.update(&amp;hashCtx, &amp;signedParams)) != 0);<br />
        goto fail;<br />
    if ((err = SSLHashSHA1.final(&amp;hashCtx, &amp;hashOut)) != 0)<br />
        goto fail;</p>
<p>assuming the same conditions (no unit tests) this is harder to detect through visual inspection than the original defect.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217264">

			<div class="comment by-supersaurus ">

				<p class="commentcredit">

					<span class="commenter">supersaurus</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217264">
						February 27, 2014 8:06 PM					</a>

				</p>

				<p>flagging unreachable code and making warnings into errors in a reasonable and general manner is harder than one might think.  consider:</p>
<pre>
if(sizeof(int) == 4)
{
    do_something();
}
</pre>
<p>a compiler might have code like that and so might code that uses asm or intrinsics.    of course you can use the preprocessor to get around the code shown, but complex code (as opposed to the simple example above) littered with preprocessor conditionals or #pragma blocks has its own issues (hard to read, hard to review, hard to debug, etc&#8230;).</p>
<p>note:  I am not defending whoever didn&#8217;t see that double goto in the code in question (assuming it was reviewed), I am commenting on the difficulty of having the compiler do the checking (one can easily find much more subtle cases than the above, and the compiler is not psychic).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217265">

			<div class="comment by-65535 ">

				<p class="commentcredit">

					<span class="commenter">65535</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217265">
						February 27, 2014 11:16 PM					</a>

				</p>

				<p>I am at the bottom of the thread. I will make my comments short.</p>
<p>1] The code is copyright protected but open to the public “copyright (c) 1999-2001,2005-2012 Apple Inc. All Rights Reserved.”</p>
<p>2] If Apple actually paid to get it through the copyright process, which is not certain, one would assume the code was thoroughly tested.</p>
<p>3] The mistake looks innocent – but at an extremely critical juncture.</p>
<p>It could be a merge error (possibly a cut-n-paste error) but it is one Big mistake. As others have noted, the NSA would cover their tracts with such a mistake and  the NSA have indicated that they could p0wn any apple iPhone.</p>
<p>The 1,970 line file:</p>
<p><a href="http://opensource.apple.com/source/Security/Security-55471/libsecurity_ssl/lib/sslKeyExchange.c" rel="nofollow ugc">http://opensource.apple.com/source/Security/Security-55471/libsecurity_ssl/lib/sslKeyExchange.c</a></p>
<p><a href="http://www.zdnet.com/apple-and-the-ssltls-bug-open-questions-7000026628/" rel="nofollow ugc">http://www.zdnet.com/apple-and-the-ssltls-bug-open-questions-7000026628/</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217266">

			<div class="comment by-robin ">

				<p class="commentcredit">

					<span class="commenter">Robin</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217266">
						February 27, 2014 11:25 PM					</a>

				</p>

				<p>I&#8217;ve got nothing of value to add to this already long discussion except:</p>
<p>This would never have happened if Steve was there!</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217267">

			<div class="comment by-name-withheld-for-reasons ">

				<p class="commentcredit">

					<span class="commenter">name.withheld.for.reasons</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217267">
						February 28, 2014 12:20 AM					</a>

				</p>

				<p>This event brings the point I made in another post full circle. Vendors and suppliers cannot possible meet their ISO compliance (15408/27000) requirements, or a half dozen industry standards, based on what we know and don&#8217;t know (I bet you thought I was going to get all Donald Rumsfeld up in here). Even more damaging, companies that rely on their vendors for these products&#8211;like aerospace, energy, and transportation will have to reexamine their procurement process and procedures. Do they have mitigation and risk avoidance plans that address this type of product line failure. I bet not!</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217268">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217268">
						February 28, 2014 1:58 AM					</a>

				</p>

				<p>@ Anura,</p>
<ul><i>I don&#8217;t think it&#8217;s so much about hiring good programmers, as it is taking the time to recognize there is a problem and clean things up, which ends up being a managment decision.</i></ul>
<p>The problem started with managment as I&#8217;ve commented on this blogand others in the past.</p>
<p>The problem stems from managment not having a clue about software development, and software developers not having a clue about managment in what is effectivly an adverserial environment&#8230;</p>
<p>As has been noted this bit of code has been &#8220;Copy-n-Paste&#8221; from another part of the code, and CnP of the same section has happened a half dozen times&#8230; And thus should have been put into a single function [1].</p>
<p>Now ask yourself if it has anything to do with managment deciding to use &#8220;lines of code commited&#8221; or similar metric to work out in their minds who is or is not a good code cutter who gets a bonus at the end of the quater/year&#8230; Thus other programers quickly realising that &#8220;it&#8217;s quantaty not quality&#8221; managment reward. Thus they start CnPing and a junior manager sees that &#8220;productivity has increased&#8221; which means they get a bonus as well&#8230; so each quater/year it&#8217;s &#8220;rinse wash and repeate&#8221; otherwise nobody gets a bonus instead they get a P45/Pinkslip or similar downsizing.</p>
<p>It&#8217;s similar reasoning that produces &#8220;feature rich&#8221; code, marketing types tell inefective managment &#8220;we must have&#8230;&#8221; managment issue an order and the code cutters know few if any people will ever use the feature, and that neither marketing or managment can tell if it works, so they use it as an oportunity to &#8220;up the bonus&#8221; not &#8220;up the quality&#8221;, especialy as they know the number of &#8220;fault reports&#8221; will be to low to attract attention.</p>
<p>The problem of managment deceiding who is or is not a productive worker is an age old problem, however it became an issue as a side effect of industrialisation. Managment would latch on to the latest &#8220;managment guru&#8221; thinking and implement the process. The results would initialy be good, but then the &#8220;workers&#8221; would work out how to &#8220;game the system&#8221;. The classic example of this was &#8220;Time and Motion&#8221; back in the 1960s and 70s manufacturing, the managment would send in the T&amp;M consultents with their clip boards and stop watches, the workers would then switch into &#8220;look busy mode&#8221; where they would make a simple straight forward task look complex and time consuming. The result was a short term benifit for the workers, however in the long term it made automation by computers look more cost effective than it was and in the 80s and 90s many jobs were either automated out of existance or outsourced to where labour was much cheaper.</p>
<p>With software the work is more cerebral than physical and measuring the effectivness of an employee is much harder, but it&#8217;s the way managment think and behave so they have to have some metric to measure &#8220;productivity&#8221; and the workers still know how to game the metrics that most managers can conceptualise.</p>
<p>So yes this &#8220;feature&#8221; in the code can be shown to have originated in the failings of managment and it&#8217;s managments inabilities / incompetence to recognise their own failings and make meaningfull changes that has alowed it to happen. But&#8230; you have to ask if managers want to change, afterall simple metrics the workers can game also means a simple way for the manager to show they are &#8220;effective&#8221; and thus the &#8220;gaming&#8221; goes on up the ladder where the executives play the same &#8220;game&#8221; with the shareholders.</p>
<p>With such a system in place it&#8217;s easy for others to &#8220;game the system&#8221; and not only is it virtualy impossible to stop them doing it, its also near impossible to prove it is taking place thus giving near perfect deniability.</p>
<p>[1] There are reasons why the &#8220;overhead&#8221; of functions might be better avoided but they are few and often pointless in a very short time frame. There is an old story of K&amp;R C and libraries, apparently &#8220;R&#8221; went around telling programers there was no overhead and that they must use functions in libraries, as one of the programers later said &#8220;He lied to us, but by the time we found out it was to late&#8221;&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217269">

			<div class="comment by-dandraka ">

				<p class="commentcredit">

					<span class="commenter">dandraka</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217269">
						February 28, 2014 6:05 AM					</a>

				</p>

				<p>@Name :<br />
Again, that&#8217;s why there are many layer&#8217;s of defence.<br />
THERE IS DEFINATELY IS AN INTEGRATION TEST FOR THIS.<br />
To believe anything else is simply shortsighted.</p>
<p>@0day :<br />
+1111111</p>
<p>@James Card: how can you assume no unit tests, let alone integration (also called system) tests ? For God&#8217;s sake, this is Apple we&#8217;re talking about, not some 20 year olds working in their mom&#8217;s basement.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217270">

			<div class="comment by-adam ">

				<p class="commentcredit">

					<span class="commenter">Adam</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217270">
						February 28, 2014 6:09 AM					</a>

				</p>

				<p>This sort of thing can happen when merging branches. I don&#8217;t know if it&#8217;s deliberate or not, but it&#8217;s potentially innocent. Anyway, this error is why a lot of coding guidelines say you <em>must</em> use curly braces for if / else. I&#8217;m sure it wouldn&#8217;t stop other kinds of exploit but it would negate this particular one.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217271">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217271">
						February 28, 2014 6:20 AM					</a>

				</p>

				<p>With regards the &#8220;curly brackets/braces&#8221; argument others have gone into this a little further,</p>
<p><a href="https://blog.codecentric.de/en/2014/02/curly-braces/" rel="nofollow ugc">https://blog.codecentric.de/en/2014/02/curly-braces/</a></p>
<p>However the last paragraph also reflects some of the comments hear about Apples QA and reputation for quality products&#8230;</p>
<p>Perhaps it&#8217;s me &#8211;I stoped liking Apple in the 1980&#8217;s after the Apple ][e&#8211; bu,t as far as I&#8217;m concerned they are a &#8220;cult&#8221; with fanbois genuflecting before the wooden altars laden with white plastic iconograpy in their hallowed stores. Whilst corporate is perhaps the worlds worst offender at both tax avoidence and pattent / copyright litigation.</p>
<p>Apple are thus exhibiting the worst tendancies in the electronic device arenna to maximise profit, is it thus realy that surprising that they have cut back on QA on what was formaly &#8220;hidden from view&#8221; software development?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217272">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217272">
						February 28, 2014 6:34 AM					</a>

				</p>

				<p>@ Adam,</p>
<ul><i>I don&#8217;t know if it&#8217;s deliberate or not, but it&#8217;s potentially innocent.</i></ul>
<p>That raised a wry smile and the though of &#8220;how the times change&#8221;.</p>
<p>Less than a year ago such a statment would have caused many to think you &#8220;a tinfoil hat wearer&#8221;, now post Ed Snowden revelations it just makes you look normaly cautious&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217273">

			<div class="comment by-dandraka ">

				<p class="commentcredit">

					<span class="commenter">dandraka</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217273">
						February 28, 2014 6:44 AM					</a>

				</p>

				<p>@Warning Track:</p>
<p><em>&#8220;I am supposed to believe that, in released software, whether an invalid security certificate will be nevertheless be accepted is not tested?&#8221;</em></p>
<p>It&#8217;s a bit more clever than that; see, if this was the problem, it would have been found 10 days later by the first developer who would test his/hers iOS application with a homemade certificate.</p>
<p>As others have explained, this is designed to facilitate man-in-the-middle attacks &#8211;which of course the NSA is in a perfect position to execute. Ofcourse Apple has to have (and in my opinion <strong>does have</strong> but it&#8217;s also subtly &#8220;turned off&#8221; somehow) adequate testing for that.</p>
<p><em>&#8220;I don&#8217;t believe it. The stench is overwhelming.&#8221;</em></p>
<p>100% agree.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217274">

			<div class="comment by-daniel-serodio ">

				<p class="commentcredit">

					<span class="commenter">Daniel Serodio</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217274">
						February 28, 2014 7:54 AM					</a>

				</p>

				<p>What about the <a href="http://daringfireball.net/2014/02/apple_prism" rel="nofollow ugc">timing</a> of this bug&#8217;s introduction and Apple&#8217;s inclusion on the PRISM program? Does this mean simply that the NSA found out about this bug before Apple?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217275">

			<div class="comment by-me ">

				<p class="commentcredit">

					<span class="commenter">Me</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217275">
						February 28, 2014 8:54 AM					</a>

				</p>

				<p>Everyone here seems to think the issue is not testing the code, am I the only one thinking WTF are they doing with gotos!?!?!</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217276">

			<div class="comment by-benni ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://Herr' rel='external nofollow ugc' class='url'>Benni</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217276">
						February 28, 2014 9:06 AM					</a>

				</p>

				<p>Here ghcq describes how it uses sex traps to blackmail company employees:<br />
<a href="http://www.eff.org/document/07022014-nbc-gchq-honey-trap-cyber-attack" rel="nofollow ugc">http://www.eff.org/document/07022014-nbc-gchq-honey-trap-cyber-attack</a></p>
<p>and here they get many sexually explicite material from 1.8 mio webcam chatters:</p>
<p><a href="http://www.theguardian.com/world/2014/feb/27/gchq-nsa-webcam-images-internet-yahoo" rel="nofollow ugc">http://www.theguardian.com/world/2014/feb/27/gchq-nsa-webcam-images-internet-yahoo</a></p>
<p>They run face recognition on these webcam images.</p>
<p>So it is easy for them to blackmail an employee with that.</p>
<p>The fact that gchq says in its slides that they blackmail employees with sex traps, this is a whole new level of industrial espionage.</p>
<p>Now the companies must fear that their most loyal employees are blackmailed by some secret service to introduce backdoors into products.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217277">

			<div class="comment by-dandraka ">

				<p class="commentcredit">

					<span class="commenter">dandraka</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217277">
						February 28, 2014 9:13 AM					</a>

				</p>

				<p>@Me: no, you&#8217;re not, but look at the bigger picture. This is not a freelance developer doing work for a client paying him $1000. It&#8217;s a big multinational company writing software used by millions of people.</p>
<p><strong>The idea is that there have to be many layers of defence against these problems.</strong></p>
<p>If Apple, or my employee (I work for a company that manufactures medical devices) or any company really, depends on a each and every developer doing their work correctly all of the time then they will go out of business very, very quickly.</p>
<p><strong>And Apple knows this.</strong> The fact is that iOS is a good piece of software; sure, many people can say this has failed or the other has failed but overall, it is used by many, many people every day and it performs extremely well.</p>
<p>That&#8217;s why I do not believe the &#8220;ooops, honest mistake&#8221; story.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217278">

			<div class="comment by-felix ">

				<p class="commentcredit">

					<span class="commenter">Felix</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217278">
						February 28, 2014 9:34 AM					</a>

				</p>

				<p>I&#8217;m so glad that Bruce has finally realized that Conspiracy Theories are useful and worthwhile.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217279">

			<div class="comment by-marc-espie ">

				<p class="commentcredit">

					<span class="commenter">Marc Espie</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217279">
						February 28, 2014 9:54 AM					</a>

				</p>

				<p>In fact, if you want to hide bugs, duplicating a goto is one of the smartest things you can do.</p>
<p>Remember the old Dijkstra article &#8220;goto considered harmful&#8221; ? That was <em>not</em> because gotos are harder to read for the programmer, it&#8217;s because gotos <em>are more difficult to analyse programmatically</em>.  Dijkstra (with Hoare) more or less founded the whole area of denotational semantics, and automated code analysis.  Gotos are harder to analyse because you have several points where the code can come from (especially in spaghetti code), so it&#8217;s much harder to write invariants, and to try to prove fixed points.</p>
<p>I&#8217;ve juste been bitten by&#8230; a goto bug in kernel code&#8230; that bug amounted to using a variable that was not actually initialized in the code path that was taken after the goto.</p>
<p>Guess what ? gcc didn&#8217;t help! it&#8217;s usually rather good at finding these kind of bugs. But it turns out that, since gotos are hard to analyze, it doesn&#8217;t even try in such a case !</p>
<p>So yeah, peer harder around gotos&#8230; they&#8217;re a very good hiding place.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217280">

			<div class="comment by-mikea ">

				<p class="commentcredit">

					<span class="commenter">MikeA</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217280">
						February 28, 2014 11:39 AM					</a>

				</p>

				<p>Yeah, &#8220;GOTO considered harmful&#8221;. That&#8217;s why the cool kids are all using COMEFROM, only it&#8217;s been renamed &#8220;Exception&#8221;. Coding is hard. Testing is harder, and <em>way</em> too many people, especially in &#8220;hardware&#8221; (i.e. VHDL) verification test only &#8220;does it do the expected thing for &#8216;normal&#8217; inputs&#8221;, rather than &#8220;does it catch abnormal inputs&#8221;.</p>
<p>&#8220;Nobody ever got fired for shipping on time&#8221;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217282">

			<div class="comment by-patrick ">

				<p class="commentcredit">

					<span class="commenter">Patrick</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217282">
						February 28, 2014 12:00 PM					</a>

				</p>

				<p>I refactored the code here:</p>
<p><a href="http://fexl.com/goto-considered-harmful" rel="nofollow ugc">http://fexl.com/goto-considered-harmful</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217283">

			<div class="comment by-anura ">

				<p class="commentcredit">

					<span class="commenter">Anura</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217283">
						February 28, 2014 12:25 PM					</a>

				</p>

				<p>@Patrick</p>
<p>You&#8217;re too concerned with the use of goto. I don&#8217;t think your code is any better. For one, if the hash function fails, you keep calling it; since you don&#8217;t know what the hash library does internally, you should not assume it&#8217;s still safe to call after a failure. On top of that, you return the most recent status code, so while one function call might return an erorr code, the final might return success, which means the verification is skipped and the function returns 0.</p>
<p>You also don&#8217;t deal with the biggest problem: the copy-paste code. With absolutely no gotos or extra variables to track success or failure, you can break the SSL code into a function that returns that status code.</p>
<p>Any refactoring needs to focus not on removing goto, but removing the copy-paste code and cleaning up the logic.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217284">

			<div class="comment by-anura ">

				<p class="commentcredit">

					<span class="commenter">Anura</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217284">
						February 28, 2014 12:31 PM					</a>

				</p>

				<p>Note that I&#8217;m assuming ||= is valid; I have never ever actually seen it used in code.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217285">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217285">
						February 28, 2014 12:44 PM					</a>

				</p>

				<p>@ Patrick</p>
<p>That refactored code simply doesn&#8217;t have enough goto&#8217;s to pass inspection at Apple.</p>
<p>@ All</p>
<p>Nadim Kobeissi did a blog post on this issue. Comments on his blog are interesting with one arguing that we&#8217;re seeing a code/design pattern common in Apple development. If true, their SDL has some real issues.</p>
<p><a href="http://log.nadim.cc/?p=126" rel="nofollow ugc">http://log.nadim.cc/?p=126</a></p>
<p>@ Marc Espie</p>
<p>You hit nail on the head with regard to the &#8220;Goto&#8217;s considered harmful&#8221; piece. He wasn&#8217;t necessarily against goto&#8217;s. He just preferred that control flow uses structured methods that could be analyzed. This is also the same guy that advocated correct-by-construction approach to development where specs/proofs and code were developed side-by-side. I can imagine dropping goto&#8217;s into a theorem prover would be even more disastrous.</p>
<p>Dijkstra&#8217;s dream is making a return. SPARK Toolset, Design by Contract (eiffel/ada2012), Perfect Developer, SCADE, etc are all Correct by Construction approaches that include proving invariants into development process. They&#8217;ve each been used on quite a few commercial products with good results. A pleasant side effect is that designing for verification forces one to get rid of risky programming practices such as throwing gotos all over the place.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217286">

			<div class="comment by-roxanne ">

				<p class="commentcredit">

					<span class="commenter">Roxanne</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217286">
						February 28, 2014 1:29 PM					</a>

				</p>

				<p>What do you think of the Google Maps man-in-the-middle attack?<br />
<a href="http://gizmodo.com/its-ridiculously-easy-to-troll-google-maps-with-fake-l-1531646581/1532886453/+ericlimer" rel="nofollow ugc">http://gizmodo.com/its-ridiculously-easy-to-troll-google-maps-with-fake-l-1531646581/1532886453/+ericlimer</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217287">

			<div class="comment by-whit-n ">

				<p class="commentcredit">

					<span class="commenter">Whit N</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217287">
						February 28, 2014 2:42 PM					</a>

				</p>

				<p>This is an interesting thread with a fairly limited number of theories.  No theory or reason for this error removes the core problem.</p>
<p>The one undeniable issue is that Apple has for a long time been grossly incompetent in managing code related to customer security for over a billion (has to be close) users. As an avid Apple consumer this scares me and at the same time pisses me off at the prices charged when essentially basic level QA is not being done on the code that protects much of what I hold valuable.</p>
<p>I am a little surprised to see that a class action lawsuit has not come out of this.  It always amazes me how Apple can escape unharmed/unfazed by these types of issues.</p>
<p>One can only hope that lessons are learned and changes are made going forward. -W</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217288">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217288">
						February 28, 2014 4:10 PM					</a>

				</p>

				<p>@ Me,</p>
<p>There is nothing wrong with the use of gotos at the end of the day as you get closer to the metal the more of them you need (in RTL and microcode every non sequential instruction contains a goto, and arguably even an increment of the PCreg can be seen as equivalent of a goto at the hardware level).</p>
<p>Thus the problem is better rephrased as not being about the gotos but those using them.</p>
<p>And thus you realise the problem of gotos is a subset of a larger problem which is that of complexity and the 99.999% of the population that cannot handle it to an acceptable degree for the designs the majority demand for the functioning of their everyday lives.</p>
<p>Thus the solution since the 1950&#8217;s &#8211;where all programers were engineers or PhD level mathmaticians&#8211; is to manage complexity by shackeling it in various ways we now genericaly call abstraction. The price of this is of course inefficiency, but untill recently Moore&#8217;s Law has shielded us from this&#8230;</p>
<p>But living with the consiquences of trying to keep Moore&#8217;s observation has been a further constraint due to the laws of physics specificaly the constraint of &#8220;propergation speed&#8221; after all light in a vacuum only travels only 1ft in a nano second which means with a 1GHz clock the return trip distance of a mirror is six inches. Throw in a few gate delays and you are down into millimetric distances or you have to skip clock cycles.</p>
<p>So the trick has been to design hardware to work with sequential addresses to fake shorter distances with multiple cache layers.</p>
<p>Thus the &#8220;real bad&#8221; of gotos is that of CPU stalls&#8230;</p>
<p>This actually became an issue long befor on chip chaches which is one reason we ended up with Complex Instructio Set CPUs. The joke of it was and still is that not only is CISC silicon real estate expensive it&#8217;s also very power hungry, so much so it&#8217;s limited not by device geometry but &#8220;heat death&#8221;. Luckily cache memory is close to being &#8220;dark silicon&#8221; thus it&#8217;s limited by dev ice geometry instead so our current CPU&#8217;s are realy &#8220;Wolf RISCs in Sheeps CISC clothing&#8221;&#8230;</p>
<p>And to further help prevent the stall issues our compilers are being optomised to get rid of the stalls by adding complexity to the code the programer does not see (CISC machine code, which inturn becomes internal streamlined RISC instructions). The downside is to get the streamlining advantages automaticaly it puts constraints on what can be fed to the compiler.</p>
<p>Needless to say this makes gotos further bad&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217289">

			<div class="comment by-benni ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://Herr' rel='external nofollow ugc' class='url'>Benni</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217289">
						February 28, 2014 4:10 PM					</a>

				</p>

				<p>What this basically means is that<br />
a) one should search through the entire apple source code<br />
b) open source browsers such as firefox or chrome can not really relie on the closed source operating system but should code most, especially security functions, by themselves in an open source way. All closed source code must be regarded as suspicious.</p>
<p>c) Microsoft should do the same as apple and allow an inspection of its source. Apple did not get ruined by publishing the sources. So microsoft should do the same. Then we could perhaps look for similar errors, or we would know what nsa_key is for.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217290">

			<div class="comment by-davidtc ">

				<p class="commentcredit">

					<span class="commenter">DavidTC</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217290">
						March 1, 2014 2:35 PM					</a>

				</p>

				<p>This would be a strange way to hide an secret backdoor. As David Conrad said, the easiest thing to do would be to sneak in a semicolon at the end of the if, which is a lot harder to see on a casual glance.</p>
<p>Or do what the person who attacked the Linux kernel did, and put an &#8216;=&#8217; instead of &#8216;==&#8217; in a test. It wouldn&#8217;t work in this specific line, but it would be easy enough to find somewhere it does.</p>
<p>Incidentally, does anyone find it slightly confusing that going to <em>fail</em> results in success? The problem is, I guess, that err is set to 0 at that point. So the function returns 0, and hey, everything just worked, right?</p>
<p>This is where some sort of &#8216;can&#8217;t happen&#8217; code would be useful&#8230;if we&#8217;re in the <em>error handling</em> section, and about to return an error code, we might want to check that we actually <em>have</em> an error code to return and aren&#8217;t accidentally returning &#8216;success&#8217;.</p>
<p>Instead of &#8216;return err;&#8217;, use &#8216;return (err ? err : 255);&#8217;, where 255 or whatever is a code meaning &#8216;I have no idea what&#8217;s going on.&#8217;.</p>
<p>A smart compiler would know that such a situation cannot happen anyway, and remove it. OTOH, apparently we&#8217;ve decided to dumb down compilers, and I&#8217;m shocked to learn that compilers don&#8217;t warn about unreachable code anymore. Seriously, there&#8217;s a lot of somewhat silly compiler warnings, but that&#8217;s not one of them.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217291">

			<div class="comment by-davidtc ">

				<p class="commentcredit">

					<span class="commenter">DavidTC</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217291">
						March 1, 2014 2:52 PM					</a>

				</p>

				<p>Actually, you could in fact do the traditional trick of switching a == for an =, except backwards.</p>
<p>if ((err ==SSLHashSHA1.update(&amp;hashCtx, &amp;signedParams)) != 0)</p>
<p>Would be an incredibly subtle error and cause a false positive, if I&#8217;ve gotten everything right. (err is already 0, and SSLHashSHA1.update returns 0, so that paren would match, making it true, which does not equal 0.)</p>
<p>So I&#8217;m going with not deliberate, because there was such an obvious place to better hide the mistake, and it would look just as accidental. (OTOH, maybe that&#8217;s just what they <em>want</em> us to think.)</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217292">

			<div class="comment by-buck ">

				<p class="commentcredit">

					<span class="commenter">Buck</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217292">
						March 1, 2014 3:05 PM					</a>

				</p>

				<p>@DavidTC</p>
<p>I agree, that is totally the worst part about the readability of this code!</p>
<p>How can &#8216;goto fail&#8217; possibly mean &#8216;verification success&#8217;..? Barf!</p>
<p>The language used in one&#8217;s could should describe the intended  path to be followed by the language of code.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217293">

			<div class="comment by-brucel ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.brucesmlee.com' rel='external nofollow ugc' class='url'>BruceL</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217293">
						March 1, 2014 9:32 PM					</a>

				</p>

				<p>Anyone ever accidentally checked in a print statement used for debugging? Could the developer have neutered cert validation in order to test other changes and forgotten to remove the neuter? Is that incompetence or plausible deniability?</p>
<p>re: PRISM and Apple, most likely, NSA noticed this flaw and simply kept quiet (um, celebrated).</p>
<p>What is astonishing is that this went undetected for so long.</p>
<p>&#8211;Bruce</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217294">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217294">
						March 1, 2014 11:49 PM					</a>

				</p>

				<p>@ Benni,</p>
<ul><i>open source browsers such as firefox or chrome can not really relie on the closed source operating system but should code most especially security functions, by themselves in an open source way</i></ul>
<p>Back in 1995 I gave a talk to part time MSc Students in a London University about issues to do with browser security. Due to the nature of the course many students were from &#8220;the city&#8221; and were at the more senior levels of ICT but still on the technical side.</p>
<p>I indicated back then what I thought was obvious,</p>
<p>1, Webbrowsers were not just going to be the new desktop but also the new &#8220;multi service terminal&#8221; for work.</p>
<p>2, That multi-service also ment multi-tasking and multi-state.</p>
<p>3, That due to the fact that browsers were statless by design state would have to be sent backwards and forwards across the network as &#8220;tickets&#8221; with no real security and thus represented a severe security risk.</p>
<p>4, That due to the fact browsers ran in a single memory space for all &#8220;open windows&#8221; information that should be kept secure in one window would be visable in another window as the browser had no security features to prevent it.</p>
<p>I raised a number of other issues as well before I got to the &#8216;meat of the problem&#8217; which was,</p>
<p>The change of use to &#8220;multi-service terminal&#8221; was a significant security risk and that the techniques used to develop proper multi-user multi-tasking needed to be &#8220;lifted up into the application level&#8221;.</p>
<p>The talk did not go down well the feeling I got from them was that I was &#8216;a scare mongering unix man&#8217; who was &#8216;trying to kill the goose that was going to lay the golden eggs&#8217; or that &#8216;I was wrong to think the industry was going the webbrowser way&#8217;&#8230;</p>
<p>For many years I repeated my warning but I was looked on as &#8216;slightly cranky&#8217; untill Google anounced &#8220;Chrome&#8221; and how they were in effect taking OS security up into the browser.</p>
<p>The simple fact is that browsers even now are still written as &#8220;applications with a bit of multi-tasking security bolted on&#8221; which still causes all sorts of problems today. They realy should be written as Multi-tasking Multi-user OS&#8217;s with a network based display system put on top&#8230; Which is kind of where your comment was going.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217295">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217295">
						March 2, 2014 12:47 AM					</a>

				</p>

				<p>@ DavidTC,</p>
<ul><i>A smart compiler would know that such a situation cannot happen anyway and remove it. OTOH, apparently we&#8217;ve decided to dumb down compilers and I&#8217;m shocked to learn that compilers don&#8217;t warn about unreachable code anymore.</i></ul>
<p>The problem is not what compilers could or could not do or even what they have done in the past&#8230;</p>
<p>The problem is &#8220;speed&#8221; not just of the resulting executable code but also of the compiler.</p>
<p>The simple fact is many &#8220;shop tools&#8221; are purchased because they &#8220;look cool&#8221; or have &#8220;new/neat technology&#8221; and are justified to &#8220;managment&#8221; as &#8220;a boost to productivity&#8221;.</p>
<p>Those designing the tools know they have to address both speed issues. The result is that when combined with &#8220;poor programing practice&#8221; in &#8216;code shops&#8217; many usefull but &#8220;resource intensive&#8221; functions get moved into obscure switches or moved out into other tools (which some think is an opportunity to &#8220;double your money).</p>
<p>There is also a second less well seen problem sneaking up which is &#8220;Chuck Moore&#8217;s little law is not a law&#8221;. The reality of hardware design these days is how to cheat both the speed of light constraint and heat death constraint. The faster you switch signals the more power you need to use which creates a lot of heat as a byproduct, but the shorter the distance a signal can travel which makes the density higher which makes the heat problem worse.</p>
<p>The problem is many of the &#8220;cheats&#8221; in hardware are also power hungry, which means we have gone about as far as we can to up CPU speed, and &#8220;cheats&#8221; are at the point where they only give benifit when the code is ordered and presented to the CPU in an optimal way. And the optomisation falls to the compiler to sort out due to &#8220;programer limitations&#8221;.</p>
<p>But the issue has gone beyond single CPU capabilities and we are now into the relm of muti-cores and &#8220;poor mans parellel programing&#8221;, whilst the majority of programers are stuck in the sequential thinking programing model. Compilers are expected to &#8220;fill the gap&#8221; but even they have gone about as far as they can due to OS and &#8220;task sharing&#8221; issues.</p>
<p>But to compound the issues, as new code cutters learn how to use the &#8220;shop tools&#8221; &#8220;on their own dime&#8221; at home/college/Uni they tend not to learn the switches that &#8220;get in the way&#8221; of their small coding projects and has oft been said &#8220;if you don&#8217;t use it, you lose it!&#8221;</p>
<p>The programing world has long since passed the &#8220;one size fits all&#8221; paradigm and trying to second guess programers to fit their incorrect world view onto hardware optomised for a different world view has turned compilers into tourtured beasts chained by the limitations and expectations of their abusers&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217296">

			<div class="comment by-grkvlt ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://abstractvisitorpattern.blogger.co.uk/' rel='external nofollow ugc' class='url'>grkvlt</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217296">
						March 2, 2014 2:10 AM					</a>

				</p>

				<p>@65535</p>
<blockquote><p>
  If Apple actually paid to get it through the copyright process, which is not certain, one would assume the code was thoroughly tested.
</p></blockquote>
<p>Except that copyright happens simply by adding the &#8216;Copyright DATE by ENTITY&#8217; text to a piece of work, so Apple didn&#8217;t need to pay for anything. Also, there is no requirement that copyrighted code be tested. One can copyright untested, tested with failing tests, plain wrong, obfuscated, misleading and even non-compiling code, if desired&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217297">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217297">
						March 2, 2014 2:23 AM					</a>

				</p>

				<p>@ DaveTC,</p>
<p>On thinking about it I should have included a link to give anothe perspective on the problem,</p>
<p><a href="http://highscalability.com/blog/2013/5/13/the-secret-to-10-million-concurrent-connections-the-kernel-i.html" rel="nofollow ugc">http://highscalability.com/blog/2013/5/13/the-secret-to-10-million-concurrent-connections-the-kernel-i.html</a></p>
<p>Whilst the author does not specifically call out the programmer-hardware issue on the compiler you can easily see how it is part of the problem. And whilst I appreciate not everybody is worried about trying to acheive 10 million concurent connections at the CPU level it&#8217;s only marganily different to other issues to do with databases and algorithms.</p>
<p>Likewise I should have given you a link on the &#8220;dark silicon&#8221; and the impact it has on the future direction of computers,</p>
<p><a href="http://www.cc.gatech.edu/~hadi/doc/paper/2012-toppicks-dark_silicon.pdf" rel="nofollow ugc">http://www.cc.gatech.edu/~hadi/doc/paper/2012-toppicks-dark_silicon.pdf</a></p>
<p>Likewise a link on the &#8220;cheats&#8221; used to try to get around the speed of light distance issues,</p>
<p><a href="http://www.lighterra.com/papers/modernmicroprocessors/" rel="nofollow ugc">http://www.lighterra.com/papers/modernmicroprocessors/</a></p>
<p>Finaly some links on compilers and optomisation issues, firstly a general overview,</p>
<p><a href="http://en.m.wikipedia.org/wiki/Optimizing_compiler" rel="nofollow ugc">http://en.m.wikipedia.org/wiki/Optimizing_compiler</a></p>
<p>Secondly a look at the methods of deciding which architecture ans optomisations best suit a problem domain,</p>
<p><a href="http://homepages.inf.ed.ac.uk/cdubach/papers/dubach12tecs.pdf" rel="nofollow ugc">http://homepages.inf.ed.ac.uk/cdubach/papers/dubach12tecs.pdf</a></p>
<p>Thirdly (and lengthy) a look at architecture and compiler issues in a complex and resource demanding problem domain (multimedia on a client end computer),</p>
<p><a href="http://euler.slu.edu/~fritts/papers/fritts_thesis00.pdf" rel="nofollow ugc">http://euler.slu.edu/~fritts/papers/fritts_thesis00.pdf</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217298">

			<div class="comment by-davidtc ">

				<p class="commentcredit">

					<span class="commenter">DavidTC</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217298">
						March 2, 2014 7:25 PM					</a>

				</p>

				<p>Clive&#8230;I have no idea what you&#8217;re talking about. I was not talking about &#8216;cheats&#8217; in hardware, or, well, anything at all about what you&#8217;re talking about.</p>
<p>Code optimization via compiler is a fairly well-understood field at this point, and there&#8217;s absolutely no reason not to optimize out unreachable code&#8230;in fact, <em>all</em> modern compilers do this. There is no reason to include a code section that cannot be reached. What they have apparently stopped doing, for no discernible reasons, is not throwing a warning when they do this. They still <em>detect</em> the code segment, and remove it, they just don&#8217;t warn anymore.</p>
<p>Now, there are all sorts of compiler warnings for <em>legitimate</em> shortcuts in coding, and, yes, not having those by default can make sense. Many times you know damn well you just did an implicit cast or whatever and don&#8217;t need to be warned about it.</p>
<p>However, there is literally no reason you would ever want unreachable code sitting in your source&#8230;<em>all</em> that can do is confuse programmers. It does not accomplish anything at all, by definition. If someone is <em>intending</em> to leave unreachable code in a program, they need to comment it anyway so people know it&#8217;s not currently used&#8230;and the correct way to do that is to comment out the code itself, and, hey, look, it&#8217;s no longer &#8216;unreachable&#8217;. It&#8217;s like magic!</p>
<p>Leaving deliberately-unreachable but unmarked code in laying around is <em>such</em> horrifically bad coding practices that, frankly, anyone who does that on purpose and then complains about <em>compiler warnings</em> when that happens should be heaved bodily out of the programming community and not allowed back in. That is <em>not</em> how you make code not execute, at least not in code you&#8217;re going to show to anyone else. (We&#8217;ve all added a &#8216;0 &amp;&amp;&#8217; at the start of an if statement to test something, but we don&#8217;t give that code <em>out</em>&#8230;and a compiler warning is very useful to remind us we still haven&#8217;t undone that. We want reminded of that!)</p>
<p>And doing it accidentally is such an annoying error that programmers <em>immediately</em> want to know about it. Accidentally unreachable code isn&#8217;t some trivial syntax mistake that the compiler is making allowances for, such a thing indicated a pretty serious programming screwup that is going to be hard to detect, and yet still compiles&#8230;exactly the thing that compiler warnings <em>exist for</em>. (And, of course, that&#8217;s exactly what happened here.)</p>
<p>Seriously, I&#8217;d love to see the justification for compilers not including that by default.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217299">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217299">
						March 2, 2014 9:41 PM					</a>

				</p>

				<p>@ DavidTC,</p>
<ul><i>Seriously, I&#8217;d love to see the justification for compilers not including that by default</i></ul>
<p>Actualy history shows it has not a question of &#8220;not including&#8221; but actualy &#8220;removing&#8221;. The question you have to ask is why?</p>
<p>As I indicated the finding of code that is not entered consumes considerable resources to be reliable one of which is time. This makes the compiler look slow which the marketing department of the compiler development house would not be keen on.</p>
<p>There is also the age old argument about what goes in &#8220;lint&#8221; and what goes in &#8220;cc&#8221;. Some would argue that finding unused code is a &#8220;lint function&#8221; not a &#8220;cc function&#8221; because of the performance hit amongst other reasons. Personaly I care not I will work with it either way, but if pushed I could find reasons to say &#8220;lint function&#8221;, after all it&#8217;s the programers responsability to know what they are doing&#8230;</p>
<p>Which brings us onto,</p>
<ul><i>Code optimization via compiler is a fairly well-understood field at this point&#8230;</i></ul>
<p>Sorry no it&#8217;s not&#8230;</p>
<p>What is well understood is optimization of serial code to produce a single thread of execution on an assumed CPU architecture.</p>
<p>Compilers don&#8217;t take into account a whole load of things which are know to kill scalability. It is generaly implicitly assumed that the programer knows how to structure their code to deal with this. Whilst the run of the mill programers generaly implicitly assume it&#8217;s either not a problem or something &#8220;down stream&#8221; that profiling tools will resolve&#8230;</p>
<p>Which is why extending the optimisation out of just the CPU is a growing research area.</p>
<p>Which brings us to,</p>
<ul><i>I was not talking about&#8217;cheats&#8217; in hardware, or, well, anything at all about what you&#8217;re talking about.</i></ul>
<p>Perhaps I did not make it clear most compiler optimization currently is about making the serial code written by a programmer not trip over all the hardware cheats by trying to prevent instruction que stalls and cache misses etc. This is not an easy task and can take up a lot of resources.</p>
<p>Thus the compiler designer guided by the marketing department has choices to make.</p>
<p>The choices will usually reflect the desires of marketting not for specmanship bells and whistles and things seen as not mainstream will get first depreciated (get it&#8217;s own obscure flag) and then removed (and possibly promoted to another product).</p>
<p>With regards,</p>
<ul><i>&#8230;and there&#8217;s absolutely no reason not to optimize out unreachable code&#8230;in fact, *all* modern compilers do this.</i></ul>
<p>Some do, others I know having walked the assembler output don&#8217;t, some need you to uses a compiler flag,</p>
<p>It depends on what the compiler designer chose to do.</p>
<p>As for,</p>
<ul><i>However, there is literally no reason you would ever want unreachable code sitting in your source&#8230;*all* that can do is confuse programmers.</i></ul>
<p>Not true many &#8220;old school&#8221; programers do it all the time DURING development. A simple example is empty functions in an include file to keep the compiler quiet, the habit started back in K&amp;R C days, due to resource issues. It was done to make development faster in a way that we would now accept makes unit testing easier. You would put the code unit in one file and a simple &#8220;main&#8221; in a second file, you simply copy the include file and fill in the functions with appropriate stimulie and returns to test the code unit.</p>
<p>And when the code unit has passed the tests, the file the unit is in can be copied into the source tree or included in the usual way. This sort of development is still common amongst hardware engineers developing embbeded systems and initial test driver code.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217300">

			<div class="comment by-autolykos ">

				<p class="commentcredit">

					<span class="commenter">Autolykos</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217300">
						March 3, 2014 3:32 AM					</a>

				</p>

				<p>@martinr:</p>
<blockquote><p>The many gotos in the code and the single cleanup handler is perfectly OK, but _not_ initializing the return value of a security critical function with error, and ABUSING the function return value to store technical interim results of subfunctions is extremely dumb.</p></blockquote>
<p>I agree. Most of the problems with this code are just bad habits and sloppy programming, but having security critical stuff not failing in a safe way is so actively stupid it borders on malicious.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217301">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217301">
						March 3, 2014 5:27 AM					</a>

				</p>

				<p>@ Autolykos,</p>
<ul><i>Most of the problems with this code are just bad habits and sloppy programming, but having security critical stuff not failing in a safe way is so actively stupid it borders on malicious</i></ul>
<p>Hmm I disagree with you not in sentiment or perception but scope.</p>
<p>To see why replace &#8220;security critical&#8221; with &#8220;safety critical&#8221;,I suspect you would agree that both are equally true?</p>
<p>That is the &#8220;malicious&#8221; behavior arives because of incompetance you identify as &#8220;bad habits and sloppy proograming&#8221;.</p>
<p>This raises the question of when such incompetence is not &#8220;malicious&#8221;?</p>
<p>I would argue and I suspect our legal brethren would concure that within your meaning of &#8220;malicious&#8221; such incompetant behaviour is always &#8220;malicious&#8221; and thus actionable under many different parts of health and safety  and fit for merchantability legislation. Thus the only deffence against the charge of mallicious would be &#8220;unknowing&#8221; incompetance due to either mental incompetance or cognative disassociation of the Dunning-Kruger effect in the programmer. However whilst that might excuse the individual it does not defend against the lack of &#8220;Corporate Responsability&#8221; because &#8220;employee appraisal&#8221;, &#8220;test techniques&#8221;, &#8220;Code reviews&#8221; and &#8220;automated code checking/verification&#8221; are common Quality Assurance techniques way way down the ladder of &#8220;Best Practice&#8221; as exhibited by others in the software industry.</p>
<p>Which raises questions about Apple&#8217;s competance and corporate governance&#8230;</p>
<p>As I&#8217;ve argued in the past &#8220;security&#8221; is a &#8220;Quality Process&#8221; and should like QA be inplace before Day0 of any project as is the case with Safety. Sadly many corporate view points appear not to agree with mine or I suspect yours.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217302">

			<div class="comment by-cbgoodbuddy ">

				<p class="commentcredit">

					<span class="commenter">CBGoodBuddy</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217302">
						March 3, 2014 12:18 PM					</a>

				</p>

				<p>Folks that are saying it looks like a certain kind of &#8220;innocent&#8221; error, like a copy/paste error or a merge error, so it&#8217;s probably not deliberate.</p>
<p>That might actually be the case, but bear in mind that a three letter agency is only going to do something like this unless there is plausible deniability.  The fact that the bug looks innocent is exactly consistent with the way an implanted security bug would have to look, in order to avoid arousing direct suspicion. So I don&#8217;t think what the bug &#8220;looks like&#8221; has any bearing on whether it&#8217;s deliberate or not.</p>
<p>If we hadn&#8217;t known about the NSA programs from Snowden&#8217;s leaks, we would have just attributed this to sloppy programming or testing, or whatever.  Never attribute to malice what you can attribute to incompetence, etc.  But we do know about NSA&#8217;s programs though, and it does raise our suspicions to a higher level.</p>
<p>I suspect that a lot of NSA&#8217;s surveillance capability is based on unpatched vulnerabilities.  Which surveillance technique gets activated depends on the target and which technology (and associated vulnerabilities) the target uses.  So the NSA would be happy to have this vulnerability in place for a large number of potential victims, er&#8230; targets, even if some people later patch and remove that particular vulnerability. The larger the menu of attack vectors, the better.  So the fact that this bug is easily patchable also doesn&#8217;t argue against it being deliberate either, in my mind.</p>
<p>Here&#8217;s why I think this bug is less likely to be a spy agency implant.  The code itself might appear innocent enough, but the person who checked the code in is trackable.  Whoever made this check-in is going to be under intense scrutiny now.  Any private associations the person has could come out into the open.  If it were a spy agency implant, that might shine a light too bright into the agency&#8217;s inner workings.  So to get some code like this implanted, an agency needs to find a shill distant enough from spy agency to look innocent even under some intense scrutiny, but gullible enough to be willing to risk his job for said spy agency.  I&#8217;m not sure how many of these people exist, but generally you&#8217;re going to want to look for people under financial or emotional distress.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217303">

			<div class="comment by-davidtc ">

				<p class="commentcredit">

					<span class="commenter">DavidTC</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217303">
						March 4, 2014 12:07 PM					</a>

				</p>

				<p>Clive, I, again, suspect you&#8217;re just rambling, as very little of what you&#8217;re saying actually makes any sense at all.</p>
<p><i>Perhaps I did not make it clear most compiler optimization currently is about making the serial code written by a programmer not trip over all the hardware cheats by trying to prevent instruction que stalls and cache misses etc. This is not an easy task and can take up a lot of resources.</i></p>
<p>You don&#8217;t make <em>anything</em> clear. Luckily, I already knew that, and it is completely unrelated to any of this.</p>
<p>What <em>is</em> an easy task and <em>does not</em> take up a lot of resources is <em>finding unreachable code</em>, and if you think there is <em>any</em> optimizing compiler that does not optimize out unreachable and otherwise dead code by default, you are crazy. That is <em>literally</em> the very first thing that is optimized. (Because there&#8217;s no point in optimizing that code any further, so it should be thrown away as soon as possible.)</p>
<p>Incidentally, trying to avoid instruction queue stalls would involve figuring what instructions would execute next, which pretty much <em>automatically</em> results in determining what instructions wouldn&#8217;t execute <em>at all</em>.</p>
<p>The idea they&#8217;re running complicated branch predictions over code but then don&#8217;t bother to do anything when they have a probability of 0% of some code executing is nonsense. (Of course, that sort of thing happens well after dead code is removed.)</p>
<p><i>Compilers don&#8217;t take into account a whole load of things which are know to kill scalability. It is generaly implicitly assumed that the programer knows how to structure their code to deal with this. </i></p>
<p>Uh, no, it&#8217;s not. That is actually the <em>opposite</em> of what is assumed by optimizing compilers. Most of the work of optimizing compilers is, in fact, &#8216;restructuring&#8217; things while compiling. Functions are moved inline, things are moved outside of loops, instructions are reordered, etc, etc&#8230;</p>
<p>I am completely baffled as to what you even think optimization <em>is</em>. You seem to think it&#8217;s all complicated low-level CPU stuff, when in actuality that&#8217;s the tiny 10% speed up that happens <em>after</em> the same, non-CPU-specific generic optimizations have been applied to code, which is like 90% of the speed up.</p>
<p>Almost all optimizations that compilers do are completely unrelated to what CPU they are on, or related only to the extent of &#8216;this CPU has X registers&#8217;. Actually worrying about pipelines and CPU cache is the newest innovation in optimization, and it&#8217;s something that happens after the <em>normal</em> optimizations have run. (In fact, it happens after the machine code has already been generated.)</p>
<p><i>Not true many &#8220;old school&#8221; programers do it all the time DURING development. A simple example is empty functions in an include file to keep the compiler quiet, the habit started back in K&amp;R C days, due to resource issues. It was done to make development faster in a way that we would now accept makes unit testing easier. You would put the code unit in one file and a simple &#8220;main&#8221; in a second file, you simply copy the include file and fill in the functions with appropriate stimulie and returns to test the code unit.</i></p>
<p>Empty stub functions are not &#8216;unreachable code&#8217;. They are, in a metaphoric sense, the <em>opposite</em> of unreachable code&#8230;they are a <em>lack</em> of code at places where code is called, not actual code somewhere it is never called.</p>
<p>And your explanation of the origin of empty stub functions is, BTW, complete nonsense. Stub functions don&#8217;t make the compiler &#8216;quiet&#8217;, they make it work <em>at all</em>. Compilers, I don&#8217;t care how old they are, don&#8217;t compile if you call functions that don&#8217;t exist.</p>
<p>Alternately, it&#8217;s possible by &#8216;copying the include file&#8217; you&#8217;re under the delusion that you could have the same function defined twice in the source, somehow.</p>
<p>On the third hand, it&#8217;s possible that by &#8217;empty functions&#8217;, you&#8217;re talking about <em>function definitions</em> in an include, which means you understand nothing about coding at all. (Function definitions <em>are not compilable code</em>, they are merely instructions to the compiler as to the correct layout of function calls. And they certainly are not &#8216;unreachable code&#8217;, and would have nothing to do with compiler warnings for unreachable code.) Also you appear to think programmers have <em>stopped</em> using them for some reason.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217304">

			<div class="comment by-michael-moser ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://mosermichael.github.io/cstuff/' rel='external nofollow ugc' class='url'>Michael Moser</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217304">
						March 4, 2014 12:19 PM					</a>

				</p>

				<p>i think this is a bug that they should have found via automated testing; so it is hard to tell if deliberate or not.</p>
<p>So most probably they just did not test at all, since they are doing a derivation of openssl and were assuming the openssl is good enough.</p>
<p>There are well known test suites for SSL/TLS; for black box testing of the protocol implementation</p>
<p>for example the Netscape SSL test suite</p>
<p><a href="https://www.mozilla.org/projects/security/pki/pkcs11/netscape/ssltest.html" rel="nofollow ugc">https://www.mozilla.org/projects/security/pki/pkcs11/netscape/ssltest.html</a></p>
<p>ssl_scan/ssl_test</p>
<p><a href="https://www.owasp.org/index.php/Testing_for_SSL-TLS_(OWASP-CM-001)" rel="nofollow ugc">https://www.owasp.org/index.php/Testing_for_SSL-TLS_(OWASP-CM-001)</a></p>
<p>Also openssl itself does some regression testing on its own.</p>
<p>probably others that i am not aware of;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217305">

			<div class="comment by-sooth_sayer ">

				<p class="commentcredit">

					<span class="commenter">sooth_sayer</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217305">
						March 4, 2014 9:31 PM					</a>

				</p>

				<p>Bruce .. you seem to be seeing you own ghost .. and once you start carping on nsa . you are likely to get this way.</p>
<p>Apple, like many others could be stupid (i never liked them much .. though I still have 3 ipods and 2 iphones) .. but you sir, are a gone case of your own making.</p>
<p>There are too many here who egg you on .. and they are worst enemies of thine!</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217306">

			<div class="comment by-mark-in-ca ">

				<p class="commentcredit">

					<span class="commenter">Mark in CA</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217306">
						March 5, 2014 3:04 AM					</a>

				</p>

				<p>More fuel for the conspiracy fire?  Just a coincidence?</p>
<p>&lt;</p>
<p>blockquote&gt;<br />
Critical crypto bug leaves Linux, hundreds of apps open to eavesdropping&#8221;</p>
<p>Hundreds of open source packages, including the Red Hat, Ubuntu, and Debian distributions of Linux, are susceptible to attacks that circumvent the most widely used technology to prevent eavesdropping on the Internet, thanks to an extremely critical vulnerability in a widely used cryptographic code library.<br />
&lt;\blockquote&gt;</p>
<p><a href="http://arstechnica.com/security/2014/03/critical-crypto-bug-leaves-linux-hundreds-of-apps-open-to-eavesdropping/" rel="nofollow ugc">http://arstechnica.com/security/2014/03/critical-crypto-bug-leaves-linux-hundreds-of-apps-open-to-eavesdropping/</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217307">

			<div class="comment by-t ">

				<p class="commentcredit">

					<span class="commenter">T</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217307">
						March 5, 2014 6:15 AM					</a>

				</p>

				<p>It looks accidental, but:</p>
<blockquote><p>
if ((err = SSLHashSHA1.update(&amp;hashCtx, &amp;signedParams)) != 0);<br />
        goto fail;
</p></blockquote>
<p>would have been far harder to catch by eye.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217308">

			<div class="comment by-benni ">

				<p class="commentcredit">

					<span class="commenter">Benni</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217308">
						March 5, 2014 4:58 PM					</a>

				</p>

				<p>@Mark in CA</p>
<p>I think ive seen some diffs in a discussion that show the person who introduced that bug was and is still a gnutls leading developer. Perhaps this was accidential.</p>
<p>But the sad truth is that this may not matter. It could be that nsa knows these vulnerabilities and uses them in their FLYING PIG program where they impersonate google in ssl connections, anyway.</p>
<p>It may be that the FLYING PIG program was created after the nsa learnt from some of their hackers that many browsers have flaws in their checks of ssl certificates. It can well be that they do not even have to insert anything because the software that we use is hoplessly flawed anyway.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217309">

			<div class="comment by-frank ">

				<p class="commentcredit">

					<span class="commenter">Frank</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217309">
						March 5, 2014 5:04 PM					</a>

				</p>

				<p>Management problem.<br />
a) That bug is inexcusable. The code is crap. Not the programmer&#8217;s fault though.<br />
b) Because something as monumentally important as SSL security should be the subject of quality controls so tight that changes to source like that would be accompanied by religious ceremonies<br />
c) Deliberate? Quite probably. Only after the management around that area was relaxed and &#8216;destabilised&#8217;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-217310">

			<div class="comment by-ob ">

				<p class="commentcredit">

					<span class="commenter">OB</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217310">
						March 10, 2014 10:00 AM					</a>

				</p>

				<p>doubled goto: easy to see, if it&#8217;s not a programming newbie. (But Apple is &#8220;hip&#8221; and maybe they have some script kiddies as &#8220;experienced professionals&#8221;? Maybe they are good in self-PR, so they got the job?)</p>
<p>Unreachable code test?</p>
<p>SHOULD work, but wait&#8230;<br />
&#8220;The -Wunreachable-code has been removed, because it was unstable&#8221;<br />
( <a href="http://gcc.gnu.org/ml/gcc-help/2011-05/msg00360.html" rel="nofollow ugc">http://gcc.gnu.org/ml/gcc-help/2011-05/msg00360.html</a> )</p>
<p>But isn&#8217;t Apple using clang for everything, and not gcc anymore?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-217311">

			<div class="comment by-ob ">

				<p class="commentcredit">

					<span class="commenter">OB</span> •

					<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/#comment-217311">
						March 10, 2014 10:51 AM					</a>

				</p>

				<p>The code is ugly.<br />
Many (most) programmers think, that code layout has no influence on quality. (Same for comments).</p>
<p>They are wrong.<br />
Code readability does matter.<br />
Write code for the human, not for the compiler.</p>
<p>I know, that&#8217;s &#8220;uncool&#8221;, but &#8220;being cool&#8221; and generate crap is really &#8220;uncool&#8221; (IMHO).</p>
<p>I have seen this kind of ugly code in many places&#8230; open source, closed source, non-commercial and commercial.</p>
<p>People don&#8217;t learn&#8230;.<br />
Or maybe they have just the wrong teachers.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

	<p class="subscribe-comments">
		<a href="https://www.schneier.com/blog/archives/2014/02/was_the_ios_ssl.html/feed/">
			<img alt="Atom Feed" src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/rss.png">
			Subscribe to comments on this entry		</a>
	</p>

		<div id="respond" class="comment-respond">
		<h2 class="comments-open-header">Leave a comment <small><a rel="nofollow" id="cancel-comment-reply-link" href="/blog/archives/2014/02/was_the_ios_ssl.html#respond" style="display:none;">Cancel reply</a></small></h2><form action="https://www.schneier.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><a href="https://www.schneier.com/wp-login.php?redirect_to=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2014%2F02%2Fwas_the_ios_ssl.html" title="Login">Login</a><p class="comment-form-author"><label for="author">Name</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" /></p>
<p class="comment-form-email"><label for="email">Email</label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" /></p>
<p class="comment-form-url"><label for="url">URL:</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p>
<p class="comment-form-cookies-consent"><input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox" value="yes" /> <label for="wp-comment-cookies-consent">Remember personal info?</label></p>

<p class="comment-form-author">

	<label for="comm_capt_challenge">
		Fill in the blank: the name of this blog is Schneier on ___________ (required):	</label>

	<input id="comm_capt_challenge" name="comm_capt_challenge" size="30" type="text" />
</p>

<div class="comment-form-comment">

	<label for="comment">Comments:</label>

	<textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea>

	<div id="preview-box" class="preview-box hide"></div>
	<img class="comment-loading hide" src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/loader.gif" />

</div>

<p id="allowed">

	<strong>Allowed HTML</strong>
	&lt;a href=&quot;URL&quot;&gt; &bull; &lt;em&gt; &lt;cite&gt; &lt;i&gt; &bull; &lt;strong&gt; &lt;b&gt; &bull; &lt;sub&gt; &lt;sup&gt; &bull; &lt;ul&gt; &lt;ol&gt; &lt;li&gt; &bull; &lt;blockquote&gt; &lt;pre&gt;
	<strong>Markdown Extra</strong> syntax via <a href="https://michelf.ca/projects/php-markdown/extra/">https://michelf.ca/projects/php-markdown/extra/</a>
</p>

<input type="hidden" id="wp_comment_nonce" name="wp_comment_nonce" value="4b1534b792" /><input type="hidden" name="_wp_http_referer" value="/blog/archives/2014/02/was_the_ios_ssl.html" />
<input type="button" id="comment-preview" class="comment-preview comment-actions" value="Preview" />
<input type="button" id="comment-write" class="comment-write comment-actions hide" value="Edit" />

<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Submit" /> <input type='hidden' name='comment_post_ID' value='5260' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p></form>	</div><!-- #respond -->
	
	<div class="stepthrough">
		<a href="https://www.schneier.com/blog/archives/2014/02/entourage_nsa_e.html" rel="prev">← ENTOURAGE: NSA Exploit of the Day</a>		<a href="https://www.schneier.com/blog/archives/2014/02/genesis_nsa_exp.html" rel="next">GENESIS: NSA Exploit of the Day →</a>	</div>

	
<p id="powered">Sidebar photo of Bruce Schneier by Joe MacInnis.</p>
		</div>

		
<aside>
	<div class="sidebar" id="sidebar-two">
		<section><div class="sidesection widget widget_schneier_about" id="schneier_about-2"><h3>About Bruce Schneier</h3><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/Bruce-Schneier.jpg" /><p><p class="small">I am a <a href="https://public-interest-tech.com/">public-interest technologist</a>, working at the intersection of security, technology, and people. I've been writing about security issues on my <a href="/">blog</a> since 2004, and in my monthly <a href="/crypto-gram/">newsletter</a> since 1998. I'm a fellow and lecturer at Harvard's <a href="https://www.hks.harvard.edu/faculty/bruce-schneier">Kennedy School</a>, a board member of <a href="https://www.eff.org/">EFF</a>, and the Chief of Security Architecture at <a href="https://inrupt.com/">Inrupt, Inc.</a> This personal website expresses the opinions of none of those organizations.</p>
</p></div></section><section><div class="sidesection widget widget_schneier_related_posts" id="schneier_related_posts-2"><h3>Related Entries</h3>
<ul>

	<li><a href="https://www.schneier.com/blog/archives/2021/03/illegal-content-and-the-blockchain.html">Illegal Content and the Blockchain</a></li><li><a href="https://www.schneier.com/blog/archives/2021/03/national-security-risks-of-late-stage-capitalism.html">National Security Risks of Late-Stage Capitalism</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/weis-2021-call-for-papers.html">WEIS 2021 Call for Papers</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/ransomware-profitability.html">Ransomware Profitability</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/presidential-cybersecurity-and-pelotons.html">Presidential Cybersecurity and Pelotons</a></li><li><a href="https://www.schneier.com/blog/archives/2021/01/police-have-disrupted-the-emotet-botnet.html">Police Have Disrupted the Emotet Botnet</a></li>
</ul>
</div></section><section><div class="sidesection widget widget_schneier_featured_essays" id="schneier_featured_essays-2"><h3>Featured Essays</h3>
	<ul>
		<li><a href="https://www.schneier.com/essays/archives/2016/04/the_value_of_encrypt.html">The Value of Encryption</a></li><li><a href="https://www.schneier.com/essays/archives/2016/03/data_is_a_toxic_asse.html">Data Is a Toxic Asset, So Why Not Throw It Out?</a></li><li><a href="https://www.schneier.com/essays/archives/2014/01/how_the_nsa_threaten.html">How the NSA Threatens National Security</a></li><li><a href="https://www.schneier.com/essays/archives/2009/01/terrorists_may_use_g.html">Terrorists May Use Google Earth, But Fear Is No Reason to Ban It</a></li><li><a href="https://www.schneier.com/essays/archives/2007/01/in_praise_of_securit.html">In Praise of Security Theater</a></li><li><a href="https://www.schneier.com/essays/archives/2006/08/refuse_to_be_terrori.html">Refuse to be Terrorized</a></li><li><a href="https://www.schneier.com/essays/archives/2006/05/the_eternal_value_of.html">The Eternal Value of Privacy</a></li><li><a href="https://www.schneier.com/essays/archives/2005/09/terrorists_dont_do_m.html">Terrorists Don&#039;t Do Movie Plots</a></li>	</ul>

	<p><a href="https://www.schneier.com/essays/">More Essays</a></p></div></section><section><div class="sidesection widget widget_schneier_archives" id="schneier_archives-2"><h3>Blog Archives</h3>
<ul>

	<li><a href="https://www.schneier.com/blog/calendar.html/">Archive by Month</a></li><li><a href="https://www.schneier.com/blog/newcomments.html/">100 Latest Comments</a></li></ul>

<h4>Blog Tags</h4><ul class="top-tags"><li><a href="https://www.schneier.com/tag/3d-printers/">3d printers</a></li><li><a href="https://www.schneier.com/tag/9-11/">9/11</a></li><li><a href="https://www.schneier.com/tag/aaron-swartz/">Aaron Swartz</a></li><li><a href="https://www.schneier.com/tag/academic/">academic</a></li><li><a href="https://www.schneier.com/tag/academic-papers/">academic papers</a></li><li><a href="https://www.schneier.com/tag/accountability/">accountability</a></li><li><a href="https://www.schneier.com/tag/aclu/">ACLU</a></li><li><a href="https://www.schneier.com/tag/activism/">activism</a></li><li><a href="https://www.schneier.com/tag/adobe/">Adobe</a></li><li><a href="https://www.schneier.com/tag/advanced-persistent-threats/">advanced persistent threats</a></li><li><a href="https://www.schneier.com/tag/adware/">adware</a></li><li><a href="https://www.schneier.com/tag/aes/">AES</a></li><li><a href="https://www.schneier.com/tag/afghanistan/">Afghanistan</a></li><li><a href="https://www.schneier.com/tag/air-marshals/">air marshals</a></li><li><a href="https://www.schneier.com/tag/air-travel/">air travel</a></li><li><a href="https://www.schneier.com/tag/airgaps/">airgaps</a></li><li><a href="https://www.schneier.com/tag/al-qaeda/">al Qaeda</a></li><li><a href="https://www.schneier.com/tag/alarms/">alarms</a></li><li><a href="https://www.schneier.com/tag/algorithms/">algorithms</a></li><li><a href="https://www.schneier.com/tag/alibis/">alibis</a></li><li><a href="https://www.schneier.com/tag/amazon/">Amazon</a></li><li><a href="https://www.schneier.com/tag/android/">Android</a></li><li><a href="https://www.schneier.com/tag/anonymity/">anonymity</a></li><li><a href="https://www.schneier.com/tag/anonymous/">Anonymous</a></li><li><a href="https://www.schneier.com/tag/antivirus/">antivirus</a></li><li><a href="https://www.schneier.com/tag/apache/">Apache</a></li><li><a href="https://www.schneier.com/tag/apple/">Apple</a></li><li><a href="https://www.schneier.com/tag/applied-cryptography/">Applied Cryptography</a></li><li><a href="https://www.schneier.com/tag/artificial-intelligence/">artificial intelligence</a></li><li><a href="https://www.schneier.com/tag/assassinations/">assassinations</a></li></ul><p><a href="https://www.schneier.com/blog/tags.html/">More Tags</a></p></div></section><section><div class="sidesection widget widget_schneier_latest_book" id="schneier_latest_book-3"><h3>Latest Book</h3><a href="https://www.schneier.com/books/click-here/"><img class="sidepic" alt="Click Here to Kill Everybody" src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2018/07/book-ch2-200w.png" /></a><p><a href="https://www.schneier.com/books/">More Books</a></p></div></section><section><div class="sidesection widget widget_schneier_promotion" id="schneier_promotion-2">
<a href="https://www.eff.org/issues/bloggers/legal/join">
	<img src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/join-eff@2x.png" id="effbutton" alt="Support Bloggers' Rights!" title="Support Bloggers' Rights!" /></a>

<a href="https://npo.networkforgood.org/Donate/Donate.aspx?npoSubscriptionId=8252">
	<img src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/support-epic@2x.png" alt="Defend Privacy--Support Epic" title="Defend Privacy--Support Epic" /></a>
</div></section>	</div>
</aside>

		<footer>
			<nav>
				<div class="nav" id="footer-nav">
					<div class="menu-main-menu-container"><ul id="menu-main-menu-1" class="menu"><li class="menu1 menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-50175 current-menu-item"><a href="https://www.schneier.com">Blog</a></li>
<li class="menu2 menu-item menu-item-type-post_type menu-item-object-page menu-item-50916"><a href="https://www.schneier.com/crypto-gram/">Newsletter</a></li>
<li class="menu3 menu-item menu-item-type-post_type menu-item-object-page menu-item-50166"><a href="https://www.schneier.com/books/">Books</a></li>
<li class="menu4 menu-item menu-item-type-custom menu-item-object-custom menu-item-50169"><a href="https://www.schneier.com/essays/">Essays</a></li>
<li class="menu5 menu-item menu-item-type-custom menu-item-object-custom menu-item-50170"><a href="https://www.schneier.com/news/">News</a></li>
<li class="menu6 menu-item menu-item-type-custom menu-item-object-custom menu-item-50171"><a href="https://www.schneier.com/talks/">Talks</a></li>
<li class="menu7 menu-item menu-item-type-post_type menu-item-object-page menu-item-50167"><a href="https://www.schneier.com/academic/">Academic</a></li>
<li class="menu8 menu-item menu-item-type-post_type menu-item-object-page menu-item-50174"><a href="https://www.schneier.com/blog/about/">About Me</a></li>
</ul></div>				</div>
			</nav>
		</footer>

		</div><!--#main-->
	</div><!--#wrapper-->

		<script type="text/javascript">
		(function () {
			var c = document.body.className;
			c = c.replace(/woocommerce-no-js/, 'woocommerce-js');
			document.body.className = c;
		})();
	</script>
	<script type='text/javascript' src='https://c0.wp.com/p/woocommerce/5.1.0/assets/js/jquery-cookie/jquery.cookie.min.js' id='jquery-cookie-js'></script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/vendor/socialshareprivacy/js/socialshareprivacy.js?ver=1.0.1' id='social-share-privacy-js'></script>
<script type='text/javascript' id='social-share-privacy-icons-js-extra'>
/* <![CDATA[ */
var schneierSocial = {"path":"https:\/\/www.schneier.com\/wp-content\/themes\/schneier\/assets\/vendor\/socialshareprivacy\/"};
/* ]]> */
</script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/vendor/socialshareprivacy/js/icons.js?ver=1.0.0' id='social-share-privacy-icons-js'></script>
<script type='text/javascript' id='schneier-comment-js-extra'>
/* <![CDATA[ */
var schneierComment = {"translateErrorSecurityAnswerWrong":"Your response to the challenge question ('The name of this blog is Schneier on ____') was not correct. Please try again.","ajax_url":"https:\/\/www.schneier.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/js/comment.js?ver=1.0.1' id='schneier-comment-js'></script>
<script type='text/javascript' src='https://c0.wp.com/c/5.7/wp-includes/js/wp-embed.min.js' id='wp-embed-js'></script>

</body>

</html>
