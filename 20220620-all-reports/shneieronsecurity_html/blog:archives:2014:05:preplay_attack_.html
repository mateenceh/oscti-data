<!DOCTYPE html>
<html lang="en-US">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<title>Preplay Attack on Chip and PIN - Schneier on Security</title>
	<meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel='dns-prefetch' href='//c0.wp.com' />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Feed" href="https://www.schneier.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Comments Feed" href="https://www.schneier.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Preplay Attack on Chip and PIN Comments Feed" href="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html/feed/" />
<link rel='stylesheet' id='wp-block-library-css'  href='https://c0.wp.com/c/5.7/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all' />
<style id='wp-block-library-inline-css' type='text/css'>
.has-text-align-justify{text-align:justify;}
</style>
<style id='woocommerce-inline-inline-css' type='text/css'>
.woocommerce form .form-row .required { visibility: visible; }
</style>
<link rel='stylesheet' id='schneier-css'  href='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/style.css?ver=1.0.0' type='text/css' media='all' />
<link rel='stylesheet' id='schneier-main-css'  href='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/dist/css/style.css?ver=1.0.2' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css'  href='https://c0.wp.com/p/jetpack/9.5.2/css/jetpack.css' type='text/css' media='all' />
<script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js?ver=3.5.1' id='jquery-js'></script>
<link rel="https://api.w.org/" href="https://www.schneier.com/wp-json/" /><link rel="alternate" type="application/json" href="https://www.schneier.com/wp-json/wp/v2/posts/5351" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://www.schneier.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://www.schneier.com/wp-includes/wlwmanifest.xml" /> 

<link rel="canonical" href="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html" />
<link rel='shortlink' href='https://www.schneier.com/?p=5351' />
<link rel="alternate" type="application/json+oembed" href="https://www.schneier.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2014%2F05%2Fpreplay_attack_.html" />
<link rel="alternate" type="text/xml+oembed" href="https://www.schneier.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2014%2F05%2Fpreplay_attack_.html&#038;format=xml" />
	<noscript><style>.woocommerce-product-gallery{ opacity: 1 !important; }</style></noscript>
	<link rel="icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-32x32.png" sizes="32x32" />
<link rel="icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-180x180.png" />
<meta name="msapplication-TileImage" content="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-270x270.png" />
		<style type="text/css" id="wp-custom-css">
			#schneier_promotion-2 img {
    max-width: 180px;
}		</style>
		</head>

<body class="post-template-default single single-post postid-5351 single-format-standard theme-schneier woocommerce-no-js">

	<div id="wrapper">
		<div id="main">

			<header>
				<div id="header">
					<h1>
						<a href="https://www.schneier.com/" rel="home">
							Schneier on Security						</a>
					</h1>
				</div>
			</header>

			<nav>
				<div class="nav" id="header-nav">
					<div class="menu-main-menu-container"><ul id="menu-main-menu" class="menu"><li id="menu-item-50175" class="menu1 menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-50175 current-menu-item"><a href="https://www.schneier.com">Blog</a></li>
<li id="menu-item-50916" class="menu2 menu-item menu-item-type-post_type menu-item-object-page menu-item-50916"><a href="https://www.schneier.com/crypto-gram/">Newsletter</a></li>
<li id="menu-item-50166" class="menu3 menu-item menu-item-type-post_type menu-item-object-page menu-item-50166"><a href="https://www.schneier.com/books/">Books</a></li>
<li id="menu-item-50169" class="menu4 menu-item menu-item-type-custom menu-item-object-custom menu-item-50169"><a href="https://www.schneier.com/essays/">Essays</a></li>
<li id="menu-item-50170" class="menu5 menu-item menu-item-type-custom menu-item-object-custom menu-item-50170"><a href="https://www.schneier.com/news/">News</a></li>
<li id="menu-item-50171" class="menu6 menu-item menu-item-type-custom menu-item-object-custom menu-item-50171"><a href="https://www.schneier.com/talks/">Talks</a></li>
<li id="menu-item-50167" class="menu7 menu-item menu-item-type-post_type menu-item-object-page menu-item-50167"><a href="https://www.schneier.com/academic/">Academic</a></li>
<li id="menu-item-50174" class="menu8 menu-item menu-item-type-post_type menu-item-object-page menu-item-50174"><a href="https://www.schneier.com/blog/about/">About Me</a></li>
</ul></div>				</div>
			</nav>

			
<aside>
	<div class="sidebar" id="sidebar-one">
		<section><div class="sidesection widget widget_schneier_search" id="schneier_search-3"><h3>Search</h3>
<p class="small">
	<em>Powered by <a href="https://duckduckgo.com/">DuckDuckGo</a></em></p>

<form method="get" action="https://duckduckgo.com/">

	<input type="hidden" name="kh" value="1" /><!-- use https -->

	<input id="search" name="q" size="15" maxlength="255" />

	<input type="submit" value="Go" /><br>

	<input type="radio" name="sites" id="searchblog" value="www.schneier.com/blog" />
	<label for="searchblog">Blog</label>

	<input type="radio" name="sites" id="searchessays" value="www.schneier.com/essays" />
	<label for="searchessays">Essays</label>

	<input type="radio" name="sites" id="searchall" value="www.schneier.com" checked="" />
	<label for="searchall">Whole site</label>

</form>
</div></section><section><div class="sidesection widget widget_schneier_social" id="schneier_social-2"><h3>Subscribe</h3>
<div id="subscription-buttons">

	<a href="https://www.schneier.com/feed/atom"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/rss-32px.png" alt="Atom Feed" /></a><a href="https://www.facebook.com/bruce.schneier"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/facebook-32px.png" alt="Facebook" /></a><a href="https://twitter.com/schneierblog/"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/twitter-32px.png" alt="Twitter" /></a><a href="https://www.amazon.com/Schneier-on-Security/dp/B0053HDDWW/"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/kindle-32px.png" alt="Kindle" /></a><a href="https://www.schneier.com/crypto-gram"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/email-32px.png" alt="E-Mail Newsletter (Crypto-Gram)" /></a>
</div>
</div></section>	</div>
</aside>

			<div id="content">

				
		<p id="breadcrumbs">

			<a href="https://www.schneier.com">Home</a><a href="https://www.schneier.com/blog/archives/">Blog</a>		</p>

		
<article id="post-5351" class="post-5351 post type-post status-publish format-standard hentry category-uncategorized tag-academic-papers tag-atms tag-authentication tag-banking tag-chip-and-pin tag-cloning">

	<div class="article">

		<h2 class="entry">Preplay Attack on Chip and PIN</h2>
		<p>Interesting <a href="http://www.cl.cam.ac.uk/~sjm217/papers/oakland14chipandskim.pdf">research paper</a> on a bank card chip-and-PIN vulnerability.  From the <a href="http://www.lightbluetouchpaper.org/2014/05/19/the-pre-play-vulnerability-in-chip-and-pin/">blog post</a>:</p>
<blockquote><p>Our new paper shows that it is possible to create clone chip cards which normal bank procedures will not be able to distinguish from the real card.</p>
<p>When a Chip and PIN transaction is performed, the terminal requests that the card produces an authentication code for the transaction. Part of this transaction is a number that is supposed to be random, so as to stop an authentication code being generated in advance. However, there are two ways in which the protection can be bypassed: the first requires that the Chip and PIN terminal has a poorly designed random generation (which we have observed in the wild); the second requires that the Chip and PIN terminal or its communications back to the bank can be tampered with (which again, we have observed in the wild).</p></blockquote>

		
			<p class="entry-tags">
				<span class="tags-links">Tags: <a href="https://www.schneier.com/tag/academic-papers/" rel="tag">academic papers</a>, <a href="https://www.schneier.com/tag/atms/" rel="tag">ATMs</a>, <a href="https://www.schneier.com/tag/authentication/" rel="tag">authentication</a>, <a href="https://www.schneier.com/tag/banking/" rel="tag">banking</a>, <a href="https://www.schneier.com/tag/chip-and-pin/" rel="tag">chip and pin</a>, <a href="https://www.schneier.com/tag/cloning/" rel="tag">cloning</a></span>			</p>

		
		
		<p class="posted">
			<a href="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html" rel="bookmark">Posted on May 20, 2014 at 2:01 PM</a>			•
			<a href="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html#comments">19 Comments</a>		</p>

		<aside><div class="schneier-share share" data-uri="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html" data-title="Preplay Attack on Chip and PIN" data-order="facebook twitter tumblr" data-social-share-privacy="true" /></aside>
	</div>

</article>


	<h3 id="comments">Comments</h3>

	
		<article class="comment even thread-even depth-1" id="comment-222689">

			<div class="comment by-andrewj ">

				<p class="commentcredit">

					<span class="commenter">AndrewJ</span> •

					<a href="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html/#comment-222689">
						May 20, 2014 7:41 PM					</a>

				</p>

				<p>It&#8217;s interesting that here in Australia the Visa website states that &#8220;The chip prevents the card from being counterfeited..&#8221; [1]. However most of the bank websites don&#8217;t go quite so far: &#8220;A security chip credit card is more secure than one with just a magnetic stripe on the back of the card, because it is <b>more difficult </b>for someone to fraudulently copy your card.&#8221; [2] and also similar comments at [3].</p>
<p>I&#8217;m guessing the legal liability for Visa is much less than for the banks. And I haven&#8217;t heard of too many issues (yet) in Australia related to cloning EMV cards, so the banks must be settling these out of court to prevent the kind of analysis and loss of confidence as has happened in the UK and Europe.</p>
<p>[1] <a>http://www.visa.com.au/personal/security/chipcards.shtml</a><br />
[2] <a>http://www.anz.com/personal/credit-cards/security/chip-cards/</a><br />
[3] <a>https://www.commbank.com.au/support/faqs/576.html</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-222690">

			<div class="comment by-anura ">

				<p class="commentcredit">

					<span class="commenter">Anura</span> •

					<a href="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html/#comment-222690">
						May 20, 2014 9:24 PM					</a>

				</p>

				<p>The protocol used should really not require any source of quality random numbers if smart cards are involved. I would personally do the following:</p>
<p>1) Merchant pushes invoice to card</p>
<p>2) Card combines bank&#8217;s ECDH public key, and card&#8217;s ECDH private key and hashes to generate a shared secret (this shared secret could just be stored, but the advantage of ECDH is that even if the bank is breached, no one can forge your card)</p>
<p>3) Card appends a bank identifier so the card can be processed, a 48-bit card identifier and a 48-bit unique transaction ID to the end of the message, with the transaction ID incrementing after each transaction</p>
<p>4) Card encrypts pin using AES/GCM, passing the merchant identifier, key identifier, and transaction ID as the additional auth data, with the card identifier being the fixed field and transaction ID used as the invocation field to construct the IV as per NIST SP 800-38D section 8.2.1, and then appends the 128-bit MAC generated by AES/GCM</p>
<p>Upon receipt, the bank verifies that authentication code is valid, and that the transaction ID is greater than the last transaction id received.</p>
<p>No quality random numbers required, although there is a limit of about 281 trillion cards per bank at any given moment, and 281 trillion transactions per card. I don&#8217;t think this will be a problem. What needs to be guaranteed is that the transaction id can&#8217;t accidentally be reset.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-222691">

			<div class="comment by-daniel ">

				<p class="commentcredit">

					<span class="commenter">Daniel</span> •

					<a href="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html/#comment-222691">
						May 20, 2014 9:25 PM					</a>

				</p>

				<p>I wonder if one day society will feel nostalgic for the petty criminal. One consequence of the increasing complexity of security measures is that they require increasingly complex measures to defeat. By complexity here I do not mean crypto complexity but process complexity. In the &#8220;good old days&#8221; safe-cracking or lock picking was a straightforward task compared to today&#8217;s sophisticated cyber criminal, a sophistication that demands group coordination (gangs). I can&#8217;t help but think of the parable of the bees and the elephant. Trying to shoot a swarm of bees (petty crooks) is annoying but the elephants (gangs) are far more dangerous if one misses. Is it really a social improvement if the net result of a security arms race is to force criminals to organize? Maybe one day we will wish we had left well enough alone.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-222692">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html/#comment-222692">
						May 20, 2014 9:44 PM					</a>

				</p>

				<p>@ Anura</p>
<p><a href="http://www.sciencedirect.com/science/article/pii/S1319157812000171" rel="nofollow ugc">http://www.sciencedirect.com/science/article/pii/S1319157812000171</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-222695">

			<div class="comment by-thoth ">

				<p class="commentcredit">

					<span class="commenter">Thoth</span> •

					<a href="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html/#comment-222695">
						May 20, 2014 11:09 PM					</a>

				</p>

				<p>@Anura</p>
<p>I am sorry to disappoint anyone who thinks banks would adopt AES-GCM anytime soon. I look around my environment I am working in and i don&#8217;t see any of these banks going to switch out of DES/3DES, let alone AES of any sorts anytime soon. They are perpetually stuck on DES like forever !</p>
<p>Everytime I get a client who says they want a certain service, they are very likely to insist they want legacy DES support and are unwilling to move to AES especially in the pin-and-chip department unless vendors (especially HSM vendors) stop supporting DES/3DES or they would simply continue DES/3DES.</p>
<p>FIPS/NIST standard compliance are just to get rid of those irritating auditors nagging at the side of their ears and they come to us for services just to get over that irritating nagging thinking it&#8217;s a magic bullet.</p>
<p>Sadly, very little has moved in the banking industry despite all these upheaval.</p>
<p>For the choice of ECDH, that would mean your key pairs are static and storing of any shared secrets can be a magnet of sorts to attacks. How are you going to generate and handle the ECDH key pairs you are going to store into the cards ? Usually a bank would issue you a card with Visa/Mastercard options which means they use Visa/Mastercard protocols.</p>
<p>If the bank needs to generate a new card, it generates a new ECDH keypair for the card presumably and the bank would store the card&#8217;s public key and maybe embed the bank&#8217;s ECDH public key as some kind of static keychain for verification ?</p>
<p>If the hash value of H(Card_ECDH_Priv_Key | Bank_ECDH_Pub_Key) &#8211;&gt; Shared_Secret and if I figure out the Bank&#8217;s ECDH Public Key and realise that the bank uses a bad generator, I could predict the Card&#8217;s key pairs or the fact that keys stored in cards and banks do not have proper key rotation policies due to the trouble of doing so, you would always expect the same keypairs to be used on both sides.</p>
<p>Imagine if you want to regenerate new keypairs for cards as a policy, you would have to involve lots of customers. Assuming the same keypairs to be used for the entire lifecycle of the keys existence, your only security would be that the AES/GCM does it&#8217;s job at protecting a message.</p>
<p>Let&#8217;s assume that certain headers of the message are always constant or certain paramter fields are always the same and values like how much money deducted and timestamp of transaction from the terminal are the movable parts, that leaves quite a good amount of static data that can allow one to mount a pre-computed attack from a table of sorts.</p>
<p>Although AES/GCM would theoretically make it harder to pre-compute due to the fact that you need to have a good amount of plaintext on hand and it is rather intensive, but once you have a good amount of static data, you may have some patterns there if you can get yourself a huge amount of test data.</p>
<p>The overall problem with these terminals not doing a good job with random is because they lack the knowledge and expertise at making secure randoms and that is the direct problem they need to solve.</p>
<p>Ephemeral keys are still important as they are that unknown factor that makes pattern detection much harder.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-222696">

			<div class="comment by-bwahahaha ">

				<p class="commentcredit">

					<span class="commenter">bwahahaha</span> •

					<a href="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html/#comment-222696">
						May 20, 2014 11:23 PM					</a>

				</p>

				<p>OFF topic:</p>
<p><a href="http://www.theguardian.com/commentisfree/2014/may/20/nsa-reform-bill-corporate-store-analysis" rel="nofollow ugc">http://www.theguardian.com/commentisfree/2014/may/20/nsa-reform-bill-corporate-store-analysis</a></p>
<p>At this stage it seems hard to believe that the NSA would let go of the power it has accrued so far. So GCHQ will gather intel for the NSA on domestic targets and store it on UK servers and &#8230; GCHQ and the NSA will gather intel for FVEY on targets in the UK where <em>anyone</em> is fair game.</p>
<p>Heads they win, tails we lose.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-222697">

			<div class="comment by-thoth ">

				<p class="commentcredit">

					<span class="commenter">Thoth</span> •

					<a href="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html/#comment-222697">
						May 21, 2014 12:12 AM					</a>

				</p>

				<p>I suppose the day when we don&#8217;t get to be surveyed is either technology degrades or there is no more doubts with each other.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-222702">

			<div class="comment by-robindch ">

				<p class="commentcredit">

					<span class="commenter">RobinDCH</span> •

					<a href="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html/#comment-222702">
						May 21, 2014 4:29 AM					</a>

				</p>

				<p>Without studying the attack in great detail, it seems it&#8217;s applicable only to SDA cards which have been deprecated in Europe (but still used elsewhere) and where the CDOL-1 (which defines the tag list used for the ARQC) does not contain the ATC as an source data diversification element.  One also needs to compromise the terminal software (which isn&#8217;t always easy) and fraud detection systems are likely to become suspicious if there are any significant number of customer complaints regarding low numbers of terminals (since cash is settled into a merchant account, the fraudster still needs to get it out of there and isn&#8217;t likely to be able to compromise a large number of terminals, their software and the linked bank accounts).</p>
<p>It&#8217;s an interesting attack but one which, so far as I&#8217;ve understood it without much investigation, is unlikely to have a significant impact in the wild.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-222703">

			<div class="comment by-eric ">

				<p class="commentcredit">

					<span class="commenter">Eric</span> •

					<a href="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html/#comment-222703">
						May 21, 2014 4:35 AM					</a>

				</p>

				<p>Isn&#8217;t the issue for consumers the T&amp;Cs on their accounts/cards?  When most banks issued Chip and PIN cards, they also issued new T&amp;Cs which switched much of the liability for fraud where the card was used with a PIN to the consumer.  Even if you can show that Chip and PIN isn&#8217;t completely secure, you won&#8217;t necessarily be able to challenge a transaction.</p>
<p>For instance, here&#8217;s an extract from what the T&amp;Cs for my debit card say:<br />
&#8220;If there is a dispute about your Account or Card, you accept that the records kept by us or on our behalf are sufficient evidence of your Card’s use. If a transaction is made using your Card with the PIN &#8230; you agree that we can conclude that the transaction was made by you.&#8221;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-222704">

			<div class="comment by-andy ">

				<p class="commentcredit">

					<span class="commenter">andy</span> •

					<a href="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html/#comment-222704">
						May 21, 2014 8:07 AM					</a>

				</p>

				<p>I think they are recycling their own research &#8211; this was news in 2012 but didn&#8217;t get many headlines.<br />
<a href="http://www.net-security.org/secworld.php?id=13581" rel="nofollow ugc">http://www.net-security.org/secworld.php?id=13581</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-222705">

			<div class="comment by-moo ">

				<p class="commentcredit">

					<span class="commenter">moo</span> •

					<a href="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html/#comment-222705">
						May 21, 2014 11:37 AM					</a>

				</p>

				<p>@andy:</p>
<p>The topic of Chip-and-PIN insecurity comes up at least once a year on this blog.  Here are some of the previous posts.</p>
<p><a href="https://www.schneier.com/blog/archives/2006/05/shell_suspends.html" rel="nofollow ugc">https://www.schneier.com/blog/archives/2006/05/shell_suspends.html</a></p>
<p><a href="https://www.schneier.com/blog/archives/2008/03/chip_and_pin_vu.html" rel="nofollow ugc">https://www.schneier.com/blog/archives/2008/03/chip_and_pin_vu.html</a></p>
<p><a href="https://www.schneier.com/blog/archives/2009/03/more_european_c.html" rel="nofollow ugc">https://www.schneier.com/blog/archives/2009/03/more_european_c.html</a></p>
<p>I think this was the previous research from these guys :<br />
<a href="https://www.schneier.com/blog/archives/2010/02/man-in-the-midd_1.html" rel="nofollow ugc">https://www.schneier.com/blog/archives/2010/02/man-in-the-midd_1.html</a></p>
<p><a href="https://www.schneier.com/blog/archives/2012/09/new_attack_agai_2.html" rel="nofollow ugc">https://www.schneier.com/blog/archives/2012/09/new_attack_agai_2.html</a></p>
<p>My opinion on Chip-and-PIN is unchanged for several years: I think the main reason the banks implemented it at all was so they could shift most of the liability for fraud onto their customers.  The customers, being fools, allowed this to happen instead of lynching the bankers.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-222706">

			<div class="comment by-anura ">

				<p class="commentcredit">

					<span class="commenter">Anura</span> •

					<a href="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html/#comment-222706">
						May 21, 2014 12:34 PM					</a>

				</p>

				<p>@Nick P</p>
<p>Looks like that protocol requires per-transaction random data, which is what I was trying to avoid.</p>
<p>@Thoth</p>
<p>I&#8217;m not going to try to get into the political landscapes of the banks, I&#8217;m just saying what I would do, and AES/GCM+ECC seems like a good choice due to efficiency in hardware and small size. On the issue of generating random numbers, whoever is making the cards is the one responsible for generating the keypair. If you were going to do it, you could have a certification system in place in which the card maker has to use an approved HSM to generate the random numbers and write it to the card. This is better than today in which the terminal is required to generate good random numbers, and a malicious party can modify the terminal itself. It&#8217;s also more cost effective than trying to get secure RNGs at every terminal.</p>
<p>The HSM manufacturer should have to certify it, and you can require that it has a minimum number of approved independent sources of entropy for the RNG, with each being theoretically sufficient (e.g. radio receiver, thermal sensor, video camera, microphone, and geiger counter+radioactive source), and that the entropy is fed to an approved DRBG so that if 128 bits of unpredictable data is ever generated, then you still cannot predict the output for the life of the device without recovering the state. If they don&#8217;t use certified devices, then they aren&#8217;t licensed to print cards for the given credit card company (i.e. VISA, Mastercard/Maestro, etc.). There&#8217;s no magic solution to all crypto problems, but you do what you can.</p>
<p>I would only store the public key for the card in the bank. The banks public key does not need to be kept secret. If the bank&#8217;s private key is stolen, and their card database is leaked, then yes, cards need to be reissued. That&#8217;s still better than today, as if their credit card database is leaked then cards STILL need to be reissued. Their private key would ideally be stored on another HSM where all the cryptographic functions are performed to make it more difficult to recover (and yes, HSMs are not a magical solution to all problems).</p>
<p>Ephemeral keys are ideal, but the problem with that is that you need a live connection to the bank, which may not always possible.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-222707">

			<div class="comment by-andrewj ">

				<p class="commentcredit">

					<span class="commenter">AndrewJ</span> •

					<a href="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html/#comment-222707">
						May 21, 2014 4:40 PM					</a>

				</p>

				<p>@Andy &#8211; They&#8217;re not recycling their own research, they discovered the first part of this back in 2012 which disclosed at a high level that there were problems, then disclosed the details to the industry, then this paper has the full details around the problems. Just a standard disclosure process really..</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-222708">

			<div class="comment by-thoth ">

				<p class="commentcredit">

					<span class="commenter">Thoth</span> •

					<a href="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html/#comment-222708">
						May 21, 2014 8:53 PM					</a>

				</p>

				<p>Since the merchant terminal is asking for a service from a banking server, I think the best place to generate random numbers are from the banks&#8217; side passed over to merchant terminals to be computed and passed back as authentication of unique sessions.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-222709">

			<div class="comment by-mr-pragma ">

				<p class="commentcredit">

					<span class="commenter">Mr. Pragma</span> •

					<a href="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html/#comment-222709">
						May 21, 2014 9:05 PM					</a>

				</p>

				<p>Careful there. We shouldn&#8217;t walk again and again in the same trap.</p>
<p>The problem with banks and cards is <em>not</em> about increasing maximum security but about very considerably increasing <em>minimum</em> security.</p>
<p>Hint: PINs for many banking services are still 4 digits (!!!)</p>
<p>Another problem is that bank try to find the cost sweet spot. If, for instance, using security suite A (which is lousy) has an annual cost of 10 Mio and creates, say, 50 Mio customers damage which, however is picked up (or not) by insurance (included in the banks total &#8220;security packet&#8221; and in the 10 Mio cost) &#8211; and &#8211; sec. suite B, largely based on considerable real security enhancements incurring one time costs of 100 Mio and annual costs of 10 Mio (more for real security and less for insurance but in the end 10 Mio, too) and minimizes customer damage to 5 K$ (picked up again (or not) by insurance), then the bank will stay with lousy packet A, simply because its total cost is lower.</p>
<p>Or in other words: security is very different thing from a banks perspective than from a customers perspective &#8212; and the banks make the rules.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-222710">

			<div class="comment by-thoth ">

				<p class="commentcredit">

					<span class="commenter">Thoth</span> •

					<a href="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html/#comment-222710">
						May 21, 2014 10:33 PM					</a>

				</p>

				<p>Security in banks have to wrangle with cost and legacy systems so it&#8217;s not surprising legacy techniques and security suites are in use. I think suite B should be what most banks should already have migrated onto by now but I guess it&#8217;s not the case. Cheaper alternatives are one factor and the monolithic systems used are hard to migrate.</p>
<p>PIN for cards are surprisingly short &#8211; 4 digit (ascii is 32 bits) of key material available if they want to use the PIN in some form of key material generation. Nonce are another huge headache on both the client and server side.</p>
<p>Although I did mention that the bank servers should generate the nonce, I am rather doubtful about their security usability (considering they don&#8217;t invest in some good ways to generate nonce using proper tools) but nevertheless it&#8217;s  better than generating nonce on client devices like merchant terminals which cook up their own weak algorithms.</p>
<p>Good PRNGs like Yarrow/Fortuna should be adopted in an cryptographic PRNG implementation and if they can collect data from temperature and all that to feed into their RNG seed pool it do also make it even better.</p>
<p>Card security or any security fail due to multiple factors. Short PINs, bad RNGs &#8230;etc ..</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-222711">

			<div class="comment by-anura ">

				<p class="commentcredit">

					<span class="commenter">Anura</span> •

					<a href="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html/#comment-222711">
						May 21, 2014 10:49 PM					</a>

				</p>

				<p>I&#8217;m not sure you can rely on random numbers generated by the bank. A lot of places, especially online stores, batch process credit cards. Plus, if your system relies on never reusing a random number, such as DSA, then a fake terminal can still do a replay attack to recover the private key, so you still need to be very careful about that in the protocol. The advantage of my system is that it doesn&#8217;t rely on external input for security.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-222712">

			<div class="comment by-thoth ">

				<p class="commentcredit">

					<span class="commenter">Thoth</span> •

					<a href="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html/#comment-222712">
						May 22, 2014 1:19 AM					</a>

				</p>

				<p>I do agree that randoms are the hard part and if there is a way out by not using random, it would be much better. The main problem is preventing replay attacks or some sort of attacks based on caching certain information. The best case is to use a non-random secretly identifiable session code that only the client and server knows.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-222713">

			<div class="comment by-coyne-tibbets ">

				<p class="commentcredit">

					<span class="commenter">Coyne Tibbets</span> •

					<a href="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html/#comment-222713">
						May 24, 2014 7:33 PM					</a>

				</p>

				<p>Ostensibly, chip and pin is about improved security.  Yet time after time, every one of these systems has been been proven to be more smoke and mirrors than real protection.</p>
<p>It is clear that the banks do not care if these systems are secure.</p>
<p>As a result, I&#8217;ve concluded that the primary purpose of chip-and-pin is not to increase protection against fraud, but to protect the bank from responsibility for any fraud that does occur. (&#8220;It must have been you that used the card sir, because the only way this charge could have happened is if the card was present. We are not responsible, you are.&#8221;)</p>
<p>I&#8217;m reminded of my childhood sheep-shearing experiences. The sheep are penned in a 3-sided wooden pen; the fourth side, from which the shearer pulls sheep, is constructed of loosely hanging burlap bags.  This works because sheep are incapable of telling the difference between a solid wall and a burlap bag.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

	<p class="subscribe-comments">
		<a href="https://www.schneier.com/blog/archives/2014/05/preplay_attack_.html/feed/">
			<img alt="Atom Feed" src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/rss.png">
			Subscribe to comments on this entry		</a>
	</p>

		<div id="respond" class="comment-respond">
		<h2 class="comments-open-header">Leave a comment <small><a rel="nofollow" id="cancel-comment-reply-link" href="/blog/archives/2014/05/preplay_attack_.html#respond" style="display:none;">Cancel reply</a></small></h2><form action="https://www.schneier.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><a href="https://www.schneier.com/wp-login.php?redirect_to=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2014%2F05%2Fpreplay_attack_.html" title="Login">Login</a><p class="comment-form-author"><label for="author">Name</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" /></p>
<p class="comment-form-email"><label for="email">Email</label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" /></p>
<p class="comment-form-url"><label for="url">URL:</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p>
<p class="comment-form-cookies-consent"><input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox" value="yes" /> <label for="wp-comment-cookies-consent">Remember personal info?</label></p>

<p class="comment-form-author">

	<label for="comm_capt_challenge">
		Fill in the blank: the name of this blog is Schneier on ___________ (required):	</label>

	<input id="comm_capt_challenge" name="comm_capt_challenge" size="30" type="text" />
</p>

<div class="comment-form-comment">

	<label for="comment">Comments:</label>

	<textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea>

	<div id="preview-box" class="preview-box hide"></div>
	<img class="comment-loading hide" src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/loader.gif" />

</div>

<p id="allowed">

	<strong>Allowed HTML</strong>
	&lt;a href=&quot;URL&quot;&gt; &bull; &lt;em&gt; &lt;cite&gt; &lt;i&gt; &bull; &lt;strong&gt; &lt;b&gt; &bull; &lt;sub&gt; &lt;sup&gt; &bull; &lt;ul&gt; &lt;ol&gt; &lt;li&gt; &bull; &lt;blockquote&gt; &lt;pre&gt;
	<strong>Markdown Extra</strong> syntax via <a href="https://michelf.ca/projects/php-markdown/extra/">https://michelf.ca/projects/php-markdown/extra/</a>
</p>

<input type="hidden" id="wp_comment_nonce" name="wp_comment_nonce" value="4b1534b792" /><input type="hidden" name="_wp_http_referer" value="/blog/archives/2014/05/preplay_attack_.html" />
<input type="button" id="comment-preview" class="comment-preview comment-actions" value="Preview" />
<input type="button" id="comment-write" class="comment-write comment-actions hide" value="Edit" />

<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Submit" /> <input type='hidden' name='comment_post_ID' value='5351' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p></form>	</div><!-- #respond -->
	
	<div class="stepthrough">
		<a href="https://www.schneier.com/blog/archives/2014/05/advances_in_sol.html" rel="prev">← Advances in Solving the Discrete Log Problem</a>		<a href="https://www.schneier.com/blog/archives/2014/05/government_poli.html" rel="next">Government Policy on Cell Phone Interception Technology →</a>	</div>

	
<p id="powered">Sidebar photo of Bruce Schneier by Joe MacInnis.</p>
		</div>

		
<aside>
	<div class="sidebar" id="sidebar-two">
		<section><div class="sidesection widget widget_schneier_about" id="schneier_about-2"><h3>About Bruce Schneier</h3><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/Bruce-Schneier.jpg" /><p><p class="small">I am a <a href="https://public-interest-tech.com/">public-interest technologist</a>, working at the intersection of security, technology, and people. I've been writing about security issues on my <a href="/">blog</a> since 2004, and in my monthly <a href="/crypto-gram/">newsletter</a> since 1998. I'm a fellow and lecturer at Harvard's <a href="https://www.hks.harvard.edu/faculty/bruce-schneier">Kennedy School</a>, a board member of <a href="https://www.eff.org/">EFF</a>, and the Chief of Security Architecture at <a href="https://inrupt.com/">Inrupt, Inc.</a> This personal website expresses the opinions of none of those organizations.</p>
</p></div></section><section><div class="sidesection widget widget_schneier_related_posts" id="schneier_related_posts-2"><h3>Related Entries</h3>
<ul>

	<li><a href="https://www.schneier.com/blog/archives/2021/03/illegal-content-and-the-blockchain.html">Illegal Content and the Blockchain</a></li><li><a href="https://www.schneier.com/blog/archives/2021/03/national-security-risks-of-late-stage-capitalism.html">National Security Risks of Late-Stage Capitalism</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/weis-2021-call-for-papers.html">WEIS 2021 Call for Papers</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/ransomware-profitability.html">Ransomware Profitability</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/presidential-cybersecurity-and-pelotons.html">Presidential Cybersecurity and Pelotons</a></li><li><a href="https://www.schneier.com/blog/archives/2021/01/police-have-disrupted-the-emotet-botnet.html">Police Have Disrupted the Emotet Botnet</a></li>
</ul>
</div></section><section><div class="sidesection widget widget_schneier_featured_essays" id="schneier_featured_essays-2"><h3>Featured Essays</h3>
	<ul>
		<li><a href="https://www.schneier.com/essays/archives/2016/04/the_value_of_encrypt.html">The Value of Encryption</a></li><li><a href="https://www.schneier.com/essays/archives/2016/03/data_is_a_toxic_asse.html">Data Is a Toxic Asset, So Why Not Throw It Out?</a></li><li><a href="https://www.schneier.com/essays/archives/2014/01/how_the_nsa_threaten.html">How the NSA Threatens National Security</a></li><li><a href="https://www.schneier.com/essays/archives/2009/01/terrorists_may_use_g.html">Terrorists May Use Google Earth, But Fear Is No Reason to Ban It</a></li><li><a href="https://www.schneier.com/essays/archives/2007/01/in_praise_of_securit.html">In Praise of Security Theater</a></li><li><a href="https://www.schneier.com/essays/archives/2006/08/refuse_to_be_terrori.html">Refuse to be Terrorized</a></li><li><a href="https://www.schneier.com/essays/archives/2006/05/the_eternal_value_of.html">The Eternal Value of Privacy</a></li><li><a href="https://www.schneier.com/essays/archives/2005/09/terrorists_dont_do_m.html">Terrorists Don&#039;t Do Movie Plots</a></li>	</ul>

	<p><a href="https://www.schneier.com/essays/">More Essays</a></p></div></section><section><div class="sidesection widget widget_schneier_archives" id="schneier_archives-2"><h3>Blog Archives</h3>
<ul>

	<li><a href="https://www.schneier.com/blog/calendar.html/">Archive by Month</a></li><li><a href="https://www.schneier.com/blog/newcomments.html/">100 Latest Comments</a></li></ul>

<h4>Blog Tags</h4><ul class="top-tags"><li><a href="https://www.schneier.com/tag/3d-printers/">3d printers</a></li><li><a href="https://www.schneier.com/tag/9-11/">9/11</a></li><li><a href="https://www.schneier.com/tag/aaron-swartz/">Aaron Swartz</a></li><li><a href="https://www.schneier.com/tag/academic/">academic</a></li><li><a href="https://www.schneier.com/tag/academic-papers/">academic papers</a></li><li><a href="https://www.schneier.com/tag/accountability/">accountability</a></li><li><a href="https://www.schneier.com/tag/aclu/">ACLU</a></li><li><a href="https://www.schneier.com/tag/activism/">activism</a></li><li><a href="https://www.schneier.com/tag/adobe/">Adobe</a></li><li><a href="https://www.schneier.com/tag/advanced-persistent-threats/">advanced persistent threats</a></li><li><a href="https://www.schneier.com/tag/adware/">adware</a></li><li><a href="https://www.schneier.com/tag/aes/">AES</a></li><li><a href="https://www.schneier.com/tag/afghanistan/">Afghanistan</a></li><li><a href="https://www.schneier.com/tag/air-marshals/">air marshals</a></li><li><a href="https://www.schneier.com/tag/air-travel/">air travel</a></li><li><a href="https://www.schneier.com/tag/airgaps/">airgaps</a></li><li><a href="https://www.schneier.com/tag/al-qaeda/">al Qaeda</a></li><li><a href="https://www.schneier.com/tag/alarms/">alarms</a></li><li><a href="https://www.schneier.com/tag/algorithms/">algorithms</a></li><li><a href="https://www.schneier.com/tag/alibis/">alibis</a></li><li><a href="https://www.schneier.com/tag/amazon/">Amazon</a></li><li><a href="https://www.schneier.com/tag/android/">Android</a></li><li><a href="https://www.schneier.com/tag/anonymity/">anonymity</a></li><li><a href="https://www.schneier.com/tag/anonymous/">Anonymous</a></li><li><a href="https://www.schneier.com/tag/antivirus/">antivirus</a></li><li><a href="https://www.schneier.com/tag/apache/">Apache</a></li><li><a href="https://www.schneier.com/tag/apple/">Apple</a></li><li><a href="https://www.schneier.com/tag/applied-cryptography/">Applied Cryptography</a></li><li><a href="https://www.schneier.com/tag/artificial-intelligence/">artificial intelligence</a></li><li><a href="https://www.schneier.com/tag/assassinations/">assassinations</a></li></ul><p><a href="https://www.schneier.com/blog/tags.html/">More Tags</a></p></div></section><section><div class="sidesection widget widget_schneier_latest_book" id="schneier_latest_book-3"><h3>Latest Book</h3><a href="https://www.schneier.com/books/click-here/"><img class="sidepic" alt="Click Here to Kill Everybody" src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2018/07/book-ch2-200w.png" /></a><p><a href="https://www.schneier.com/books/">More Books</a></p></div></section><section><div class="sidesection widget widget_schneier_promotion" id="schneier_promotion-2">
<a href="https://www.eff.org/issues/bloggers/legal/join">
	<img src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/join-eff@2x.png" id="effbutton" alt="Support Bloggers' Rights!" title="Support Bloggers' Rights!" /></a>

<a href="https://npo.networkforgood.org/Donate/Donate.aspx?npoSubscriptionId=8252">
	<img src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/support-epic@2x.png" alt="Defend Privacy--Support Epic" title="Defend Privacy--Support Epic" /></a>
</div></section>	</div>
</aside>

		<footer>
			<nav>
				<div class="nav" id="footer-nav">
					<div class="menu-main-menu-container"><ul id="menu-main-menu-1" class="menu"><li class="menu1 menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-50175 current-menu-item"><a href="https://www.schneier.com">Blog</a></li>
<li class="menu2 menu-item menu-item-type-post_type menu-item-object-page menu-item-50916"><a href="https://www.schneier.com/crypto-gram/">Newsletter</a></li>
<li class="menu3 menu-item menu-item-type-post_type menu-item-object-page menu-item-50166"><a href="https://www.schneier.com/books/">Books</a></li>
<li class="menu4 menu-item menu-item-type-custom menu-item-object-custom menu-item-50169"><a href="https://www.schneier.com/essays/">Essays</a></li>
<li class="menu5 menu-item menu-item-type-custom menu-item-object-custom menu-item-50170"><a href="https://www.schneier.com/news/">News</a></li>
<li class="menu6 menu-item menu-item-type-custom menu-item-object-custom menu-item-50171"><a href="https://www.schneier.com/talks/">Talks</a></li>
<li class="menu7 menu-item menu-item-type-post_type menu-item-object-page menu-item-50167"><a href="https://www.schneier.com/academic/">Academic</a></li>
<li class="menu8 menu-item menu-item-type-post_type menu-item-object-page menu-item-50174"><a href="https://www.schneier.com/blog/about/">About Me</a></li>
</ul></div>				</div>
			</nav>
		</footer>

		</div><!--#main-->
	</div><!--#wrapper-->

		<script type="text/javascript">
		(function () {
			var c = document.body.className;
			c = c.replace(/woocommerce-no-js/, 'woocommerce-js');
			document.body.className = c;
		})();
	</script>
	<script type='text/javascript' src='https://c0.wp.com/p/woocommerce/5.1.0/assets/js/jquery-cookie/jquery.cookie.min.js' id='jquery-cookie-js'></script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/vendor/socialshareprivacy/js/socialshareprivacy.js?ver=1.0.1' id='social-share-privacy-js'></script>
<script type='text/javascript' id='social-share-privacy-icons-js-extra'>
/* <![CDATA[ */
var schneierSocial = {"path":"https:\/\/www.schneier.com\/wp-content\/themes\/schneier\/assets\/vendor\/socialshareprivacy\/"};
/* ]]> */
</script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/vendor/socialshareprivacy/js/icons.js?ver=1.0.0' id='social-share-privacy-icons-js'></script>
<script type='text/javascript' id='schneier-comment-js-extra'>
/* <![CDATA[ */
var schneierComment = {"translateErrorSecurityAnswerWrong":"Your response to the challenge question ('The name of this blog is Schneier on ____') was not correct. Please try again.","ajax_url":"https:\/\/www.schneier.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/js/comment.js?ver=1.0.1' id='schneier-comment-js'></script>
<script type='text/javascript' src='https://c0.wp.com/c/5.7/wp-includes/js/wp-embed.min.js' id='wp-embed-js'></script>

</body>

</html>
