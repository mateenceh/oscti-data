<!DOCTYPE html>
<html lang="en-US">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<title>The Fundamental Insecurity of USB - Schneier on Security</title>
	<meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel='dns-prefetch' href='//c0.wp.com' />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Feed" href="https://www.schneier.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Comments Feed" href="https://www.schneier.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; The Fundamental Insecurity of USB Comments Feed" href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/feed/" />
<link rel='stylesheet' id='wp-block-library-css'  href='https://c0.wp.com/c/5.7/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all' />
<style id='wp-block-library-inline-css' type='text/css'>
.has-text-align-justify{text-align:justify;}
</style>
<style id='woocommerce-inline-inline-css' type='text/css'>
.woocommerce form .form-row .required { visibility: visible; }
</style>
<link rel='stylesheet' id='schneier-css'  href='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/style.css?ver=1.0.0' type='text/css' media='all' />
<link rel='stylesheet' id='schneier-main-css'  href='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/dist/css/style.css?ver=1.0.2' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css'  href='https://c0.wp.com/p/jetpack/9.5.2/css/jetpack.css' type='text/css' media='all' />
<script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js?ver=3.5.1' id='jquery-js'></script>
<link rel="https://api.w.org/" href="https://www.schneier.com/wp-json/" /><link rel="alternate" type="application/json" href="https://www.schneier.com/wp-json/wp/v2/posts/5906" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://www.schneier.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://www.schneier.com/wp-includes/wlwmanifest.xml" /> 

<link rel="canonical" href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html" />
<link rel='shortlink' href='https://www.schneier.com/?p=5906' />
<link rel="alternate" type="application/json+oembed" href="https://www.schneier.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2014%2F07%2Fthe_fundamental.html" />
<link rel="alternate" type="text/xml+oembed" href="https://www.schneier.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2014%2F07%2Fthe_fundamental.html&#038;format=xml" />
	<noscript><style>.woocommerce-product-gallery{ opacity: 1 !important; }</style></noscript>
	<link rel="icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-32x32.png" sizes="32x32" />
<link rel="icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-180x180.png" />
<meta name="msapplication-TileImage" content="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-270x270.png" />
		<style type="text/css" id="wp-custom-css">
			#schneier_promotion-2 img {
    max-width: 180px;
}		</style>
		</head>

<body class="post-template-default single single-post postid-5906 single-format-standard theme-schneier woocommerce-no-js">

	<div id="wrapper">
		<div id="main">

			<header>
				<div id="header">
					<h1>
						<a href="https://www.schneier.com/" rel="home">
							Schneier on Security						</a>
					</h1>
				</div>
			</header>

			<nav>
				<div class="nav" id="header-nav">
					<div class="menu-main-menu-container"><ul id="menu-main-menu" class="menu"><li id="menu-item-50175" class="menu1 menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-50175 current-menu-item"><a href="https://www.schneier.com">Blog</a></li>
<li id="menu-item-50916" class="menu2 menu-item menu-item-type-post_type menu-item-object-page menu-item-50916"><a href="https://www.schneier.com/crypto-gram/">Newsletter</a></li>
<li id="menu-item-50166" class="menu3 menu-item menu-item-type-post_type menu-item-object-page menu-item-50166"><a href="https://www.schneier.com/books/">Books</a></li>
<li id="menu-item-50169" class="menu4 menu-item menu-item-type-custom menu-item-object-custom menu-item-50169"><a href="https://www.schneier.com/essays/">Essays</a></li>
<li id="menu-item-50170" class="menu5 menu-item menu-item-type-custom menu-item-object-custom menu-item-50170"><a href="https://www.schneier.com/news/">News</a></li>
<li id="menu-item-50171" class="menu6 menu-item menu-item-type-custom menu-item-object-custom menu-item-50171"><a href="https://www.schneier.com/talks/">Talks</a></li>
<li id="menu-item-50167" class="menu7 menu-item menu-item-type-post_type menu-item-object-page menu-item-50167"><a href="https://www.schneier.com/academic/">Academic</a></li>
<li id="menu-item-50174" class="menu8 menu-item menu-item-type-post_type menu-item-object-page menu-item-50174"><a href="https://www.schneier.com/blog/about/">About Me</a></li>
</ul></div>				</div>
			</nav>

			
<aside>
	<div class="sidebar" id="sidebar-one">
		<section><div class="sidesection widget widget_schneier_search" id="schneier_search-3"><h3>Search</h3>
<p class="small">
	<em>Powered by <a href="https://duckduckgo.com/">DuckDuckGo</a></em></p>

<form method="get" action="https://duckduckgo.com/">

	<input type="hidden" name="kh" value="1" /><!-- use https -->

	<input id="search" name="q" size="15" maxlength="255" />

	<input type="submit" value="Go" /><br>

	<input type="radio" name="sites" id="searchblog" value="www.schneier.com/blog" />
	<label for="searchblog">Blog</label>

	<input type="radio" name="sites" id="searchessays" value="www.schneier.com/essays" />
	<label for="searchessays">Essays</label>

	<input type="radio" name="sites" id="searchall" value="www.schneier.com" checked="" />
	<label for="searchall">Whole site</label>

</form>
</div></section><section><div class="sidesection widget widget_schneier_social" id="schneier_social-2"><h3>Subscribe</h3>
<div id="subscription-buttons">

	<a href="https://www.schneier.com/feed/atom"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/rss-32px.png" alt="Atom Feed" /></a><a href="https://www.facebook.com/bruce.schneier"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/facebook-32px.png" alt="Facebook" /></a><a href="https://twitter.com/schneierblog/"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/twitter-32px.png" alt="Twitter" /></a><a href="https://www.amazon.com/Schneier-on-Security/dp/B0053HDDWW/"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/kindle-32px.png" alt="Kindle" /></a><a href="https://www.schneier.com/crypto-gram"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/email-32px.png" alt="E-Mail Newsletter (Crypto-Gram)" /></a>
</div>
</div></section>	</div>
</aside>

			<div id="content">

				
		<p id="breadcrumbs">

			<a href="https://www.schneier.com">Home</a><a href="https://www.schneier.com/blog/archives/">Blog</a>		</p>

		
<article id="post-5906" class="post-5906 post type-post status-publish format-standard hentry category-uncategorized tag-computer-security tag-hacking tag-malware tag-nsa tag-usb">

	<div class="article">

		<h2 class="entry">The Fundamental Insecurity of USB</h2>
		<p><a href="http://www.wired.com/2014/07/usb-security/">This</a> is pretty impressive:</p>
<blockquote><p>Most of us learned long ago not to run executable files from sketchy USB sticks. But old-fashioned USB hygiene can&#8217;t stop this newer flavor of infection: Even if users are aware of the potential for attacks, ensuring that their USB&#8217;s firmware hasn&#8217;t been tampered with is nearly impossible. The devices don&#8217;t have a restriction known as &#8220;code-signing,&#8221; a countermeasure that would make sure any new code added to the device has the unforgeable cryptographic signature of its manufacturer. There&#8217;s not even any trusted USB firmware to compare the code against.</p>
<p>The element of Nohl and Lell&#8217;s research that elevates it above the average theoretical threat is the notion that the infection can travel both from computer to USB and vice versa. Any time a USB stick is plugged into a computer, its firmware could be reprogrammed by malware on that PC, with no easy way for the USB device&#8217;s owner to detect it. And likewise, any USB device could silently infect a user&#8217;s computer.</p></blockquote>
<p>These are exactly the sorts of attacks the NSA favors.</p>
<p>EDITED TO ADD (8/14):  Good <a href="http://theinvisiblethings.blogspot.com/2011/06/usb-security-challenges.html">writeup</a>.  <a href="https://srlabs.de/blog/wp-content/uploads/2014/07/SRLabs-BadUSB-BlackHat-v1.pdf">Slides</a> from BlackHat talk.</p>

		
			<p class="entry-tags">
				<span class="tags-links">Tags: <a href="https://www.schneier.com/tag/computer-security/" rel="tag">computer security</a>, <a href="https://www.schneier.com/tag/hacking/" rel="tag">hacking</a>, <a href="https://www.schneier.com/tag/malware/" rel="tag">malware</a>, <a href="https://www.schneier.com/tag/nsa/" rel="tag">NSA</a>, <a href="https://www.schneier.com/tag/usb/" rel="tag">USB</a></span>			</p>

		
		
		<p class="posted">
			<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html" rel="bookmark">Posted on July 31, 2014 at 2:31 PM</a>			•
			<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html#comments">123 Comments</a>		</p>

		<aside><div class="schneier-share share" data-uri="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html" data-title="The Fundamental Insecurity of USB" data-order="facebook twitter tumblr" data-social-share-privacy="true" /></aside>
	</div>

</article>


	<h3 id="comments">Comments</h3>

	
		<article class="comment even thread-even depth-1" id="comment-228015">

			<div class="comment by-spaceman-spiff ">

				<p class="commentcredit">

					<span class="commenter">Spaceman Spiff</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228015">
						July 31, 2014 3:03 PM					</a>

				</p>

				<p>AFAIK, this is how the Stuxnet virus was propagated to the Iranian nuclear enrichment facilities. So, not new, but now better understood.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228016">

			<div class="comment by-anon ">

				<p class="commentcredit">

					<span class="commenter">anon</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228016">
						July 31, 2014 3:14 PM					</a>

				</p>

				<p>Time to go live in a cave</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228017">

			<div class="comment by-name-required ">

				<p class="commentcredit">

					<span class="commenter">Name (required)</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228017">
						July 31, 2014 3:16 PM					</a>

				</p>

				<p>So now I have to start using CD&#8217;s for my sneakernet xfers, which is all xfers between my online machine and my work machine.</p>
<p>I swore off email 100%. I turned off cookies altogether. Occasionally I turn them on for a few minutes to DL something, before manually deleting them. I&#8217;ve gone back to using NoScript. Soon I&#8217;m going to reformat my online machine b/c the registry got corrupted by a bad Tor de-install &#8211; then I&#8217;ll go back to mostly Tor, no more regular Firefox. I always use HTTPS everywhere and Private Browsing mode. I don&#8217;t comment on any site that wants me to create a profile, or use cookies or scripts (thanks Bruce for not doing that). AdBlock: of course.</p>
<p>I&#8217;m just a home user. And I&#8217;ve discovered that I&#8217;m not losing out on very much with the above measures. The biggest thing I&#8217;m losing out on is being trackable and that&#8217;s a good thing. Because in all seriousness, screw the NSA. Calling them pigs is an insult to real pigs all over the world. Sorry for getting political.</p>
<p>About a year ago I moved and voluntarily went without the internet for over a month, <i>during which I was ALSO house-bound.</i> It was no big deal, despite that I call myself an internet addict (looking at it most of the day, everyday). Next step is to stop using the internet altogether. It gets more and more tempting everyday. Big change? Change, schmange. Done it, liked it.</p>
<p>Seriously I predict barely noticing a difference. Mostly I will feel more sorry than ever for people who are tied to the internet by their jobs, or by their youth (and naïvetée). Though most of them are probably happier than I am.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228018">

			<div class="comment by-andre-mello ">

				<p class="commentcredit">

					<span class="commenter">André Mello</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228018">
						July 31, 2014 3:33 PM					</a>

				</p>

				<p>Like I commented on the Wired article, I can&#8217;t see how what they describe is possible. I only have a basic understanding of the USB protocol, but, even if they can completely rewrite the firmware, how can the device take over the system and do whatever it likes with it, in a non-detectable, unfixable way?</p>
<p>What seems to be the case, exchanging ideas with other people, is that the device pretends to be of HID class and uses keyboard and/or mouse input to exert control, inject code, etc. But no matter how fast it happens, it can still be detected and counteracted by an antivirus, or by the OS, and even if it&#8217;s not, it&#8217;s possible to create some form of hardware CAPTCHA to make sure a human is controlling the input. So that would still not be impossible to fix, even if not in an ideal way.</p>
<p>As far as I know, the device has no active control of its host, the OS is entirely responsible of taking care of everything. So code execution would only be possible via an implementation flaw in the kernel driver, which is how it&#8217;s been done so far. The Wired article implies the researchers achieved a way to do that using just the USB specification, but if that&#8217;s really it, it blows my mind.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228019">

			<div class="comment by-egeltje ">

				<p class="commentcredit">

					<span class="commenter">egeltje</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228019">
						July 31, 2014 3:39 PM					</a>

				</p>

				<p>@Name (required): have a look at Qubes OS (hxxp://qubes-os.org). They try to make a secure computer by running a micro kernel and have all contexts (eg. banking, work, untrusted) fully isolated in their own OS stack with clear visual feedback. Networking is done through a separate unprivileged stack, as are the UBS connections.<br />
Not production-ready yet, but they&#8217;re getting there.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228020">

			<div class="comment by-ian-mason ">

				<p class="commentcredit">

					<span class="commenter">Ian Mason</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228020">
						July 31, 2014 3:51 PM					</a>

				</p>

				<p>It&#8217;s not just USB. SD cards have similar vulnerabilites, see Bunny Huang&#8217;s blog here: <a href="http://www.bunniestudios.com/blog/?page_id=3592" rel="nofollow ugc">http://www.bunniestudios.com/blog/?page_id=3592</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228021">

			<div class="comment by-steve37 ">

				<p class="commentcredit">

					<span class="commenter">steve37</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228021">
						July 31, 2014 3:54 PM					</a>

				</p>

				<p>It will be on BlackHat next week<br />
<a href="https://www.blackhat.com/us-14/briefings.html#badusb-on-accessories-that-turn-evil" rel="nofollow ugc">https://www.blackhat.com/us-14/briefings.html#badusb-on-accessories-that-turn-evil</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228022">

			<div class="comment by-porsupah ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.lapinity.com' rel='external nofollow ugc' class='url'>Porsupah</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228022">
						July 31, 2014 4:10 PM					</a>

				</p>

				<p>I&#8217;ll admit to being intrigued. I&#8217;ll check back through my composite device firmware (HID/microphone/speaker), and see if I can identify potential avenues, particularly within the spec, rather than the implementation.</p>
<p>If it&#8217;s along the lines as noted by Ian Mason above, exploiting insecure (but not per se part of any USB standard) vendor firmware updating mechanisms, I&#8217;ll be rather disappointed, even though that&#8217;s certainly an attack vector.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228023">

			<div class="comment by-jamie-bliss ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.astro73.com' rel='external nofollow ugc' class='url'>Jamie Bliss</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228023">
						July 31, 2014 4:11 PM					</a>

				</p>

				<p>I think this is not as big of deal as they&#8217;re making it out to be. It sounds like there&#8217;s a security problem in USB devices, not hosts.</p>
<p>I would speculate that the new security hole is that most USB controllers are reprogrammable from USB, allowing you to add secret functions to it. (Which is, frankly, dubious.)</p>
<p>The problem is, assuming there&#8217;s no driver vulnerabilities, is that you still have to go through USB channels to actually perform the attack. Meaning that a hybrid mass storage and HID device could insert key strokes to open and execute files it stores.</p>
<p>It&#8217;s not like a PC&#8217;s USB controller is all that in-depth. It&#8217;s not a magic &#8220;all IO goes through here!&#8221; chip. The OS still does all the heavy lifting. A USB device could pretend to be a network connection, but it&#8217;d still have to deliver packets to make anything work.</p>
<p>My guess is that it amounts to &#8220;USB devices can be programmed to have additional, malicious functions.&#8221; I don&#8217;t think this is like the firewire &#8220;any device can have access to all your memory&#8221; bug, or the heartbleed bug. This doesn&#8217;t sound like a primary threat, but another vector for payloads.</p>
<p>Oh, and this attack is totally detectable. You just have to look at what interfaces the device advertises and see if they match expectations.</p>
<p>For a primer on how USB operates, I would recommend <a href="http://www.beyondlogic.org/usbnutshell/usb1.shtml" rel="nofollow ugc">Beyond Logic&#8217;s USB in a NutShell</a>.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228024">

			<div class="comment by-roland ">

				<p class="commentcredit">

					<span class="commenter">Roland</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228024">
						July 31, 2014 4:15 PM					</a>

				</p>

				<p>OK, so there&#8217;s a microcontroller on a thumb drive. Why would it have EPROM (writeable) firmware? Seems to me that sort of fixed-function device is what us old-timers would control with a ROM, containing code that is fixed as part of the original chip design. What&#8217;s the point of providing the ability to reprogram a chip that sells for a few pennies?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228025">

			<div class="comment by-luckyluke ">

				<p class="commentcredit">

					<span class="commenter">luckyluke</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228025">
						July 31, 2014 4:17 PM					</a>

				</p>

				<p>That&#8217;s not the only firmware related device that could be manipulated.</p>
<p>With enough knowledge in assembler and programming and all a lot of reverse engineering, plus a few &#8216;dead-modded&#8217; sample firmwares, it&#8217;s feasible with other devices as well. Not so doable for the every day joe though,&#8230;</p>
<p>Scary is the part where nothing from a user perspective helps here.<br />
The layer of &#8216;doom&#8217; is so deep below filesystem level, reformatting is just so damned useless.</p>
<p>Just bad.<br />
No matter who tries this kind of attack for whatever reasons.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228026">

			<div class="comment by-john-galt-iii ">

				<p class="commentcredit">

					<span class="commenter">John Galt III</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228026">
						July 31, 2014 4:22 PM					</a>

				</p>

				<p>An FPGA interposer board could be based on the BE Micro product and used to filter the data/instructions in both directions to insure that no misdeeds were being perpetrated by spookware.  It would make a nice open-source hardware/open-source firmware/open-source software project that could extend to encrypting data from common USB devices like webcams, providing an extra layer of security for Skype.  There is going to be a lot of money made and lost on surveillance measures, counter-measures and counter-counter-measures.  This would make a nice Kickstarter effort.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228027">

			<div class="comment by-cdmiller ">

				<p class="commentcredit">

					<span class="commenter">cdmiller</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228027">
						July 31, 2014 4:31 PM					</a>

				</p>

				<p>&#8220;Back in the day&#8221; we used to hide data as bad blocks on early hard drives, pretty innocuous compared to this type of stuff.</p>
<p><a href="http://spritesmods.com/?art=hddhack&amp;page=1" rel="nofollow ugc">hard drive firmware takeover</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228028">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228028">
						July 31, 2014 4:33 PM					</a>

				</p>

				<p>It&#8217;s an unsurprising vulnerability. Any device which has DMA or sends data to trusted processes is part of the TCB. One must either show it&#8217;s trustworthy or mediate it. My general rule is to consider every device untrustworthy. This is supported by the large amount of undocumented functionality, increasing use of programmable chips guiding the DMA, and recent discovery of a backdoor in a security-critical FPGA. The chips must be assumed to have functionality useful to the attacker.</p>
<p>So, what to do? Well, you essentially have to mediate. This might be an IOMMU integrated in SOC or inlined in PCI bus. There&#8217;s memory crypto schemes. There&#8217;s also my old strategy of offloading each I/O device onto a separate chip which has a safe interface to the main chip. That preserves COTS hardware compatibility, while allowing you to choose what chips to put trust in for mediation.</p>
<p>There&#8217;s also the economic model to consider. In a previous thread here on USB issues, I pointed out that users are largely to blame as the incentives they give manufacturers work against quality or security. Most that use high assurance methods won&#8217;t sell crap. Medium assurance barely sells. So, most stuff is low assurance. The profit motive of the private corporations might also increase the likelihood of them putting in backdoors for profit, as we saw with RSA (and ad-driven services in general).</p>
<p>An economic solution is to have several standards: low, medium, and high. This is essentially what CIA did in its ratings system. High should be considered secure. Low and medium should be considered insecure, yet medium puts substantial effort to reduce risk or make recovery easier. Reference implementations of useful functions (eg link encryptor) sponsored by public and/or private funding will give potential developers a head start on their products and an idea of the costs of each level of assurance. The reference implementation will itself be usable, with hardware sold just over cost. Private parties will differentiate with features they integrate into such models. An independent body (with plenty accountability) will certify each design against its goals and assurance level similar to Common Criteria&#8217;s Protection Profiles, but with a more practical than paperwork focus. Each company or individual can then look at a list of products, choose what assurance they want, and then get what they pay for. Lastly, the whole system&#8217;s rating is the rating of the lowest security component in the system in accordance with &#8220;weakest link&#8221; principle, although advanced users can look at ratings of each component.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228029">

			<div class="comment by-dafydd ">

				<p class="commentcredit">

					<span class="commenter">dafydd</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228029">
						July 31, 2014 4:41 PM					</a>

				</p>

				<p>I&#8217;m with Roland. Why in the world are USB devices using writable PROMs?! Make that thing read-only!</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228030">

			<div class="comment by-supergeil ">

				<p class="commentcredit">

					<span class="commenter">supergeil</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228030">
						July 31, 2014 4:52 PM					</a>

				</p>

				<p>So as a first step they should implement warnings in operating systems when a USB device impersonates a keyboard or a network card. Generally cut down on plug&#8217;n&#8217;play. Also an interesting question is how to prevent actual keyboards from typing commands themselves.<br />
Booting from USB is a different matter though&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228031">

			<div class="comment by-alex ">

				<p class="commentcredit">

					<span class="commenter">Alex</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228031">
						July 31, 2014 4:54 PM					</a>

				</p>

				<p>Using a PS/2 keyboard &amp; mice while disabling USB in BIOS &#8211; is known safety trick.<br />
Also suggest using CF-type memory card with SATA adapter instead of USB stick.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228032">

			<div class="comment by-sl149q ">

				<p class="commentcredit">

					<span class="commenter">sl149q</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228032">
						July 31, 2014 5:14 PM					</a>

				</p>

				<p>This appears to be a problem with devices leveraging class matching in Windows to get a malicious function connected (e.g. HID device).</p>
<p>This can be locked down using (for example) group policy to restrict hardware devices that are allowed to be used.</p>
<p>It might still be possible to hack an existing device that has an existing valid HID interface so that the OS will allow it to connect and be used. E.g. making that USB Keyboard do something unexpected.</p>
<p>But since (most?) USB Keys don&#8217;t have existing HID interfaces adding one would be noted and not allowed.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228033">

			<div class="comment by-evan ">

				<p class="commentcredit">

					<span class="commenter">Evan</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228033">
						July 31, 2014 5:41 PM					</a>

				</p>

				<p>I think the idea is that you have a virus in the USB firmware that propagates itself to executables that are copied over, and then which, once inside a host system memory, implants whatever malware payload &#8211; including, of course, code to overwrite the firmware of new USB devices that come along.</p>
<p>It&#8217;s a nasty problem because there&#8217;s not really a good way to set up a trust system for USB devices short of whitelisting a few manufacturers, and apart from the problems that causes I&#8217;m not sure it can ever completely exclude tampering on a sufficiently smart device.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228034">

			<div class="comment by-need-help ">

				<p class="commentcredit">

					<span class="commenter">NEED HELP</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228034">
						July 31, 2014 6:04 PM					</a>

				</p>

				<p>WOULD A SD CARD HAVE THE SAME VULNERABILITY</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228035">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228035">
						July 31, 2014 6:09 PM					</a>

				</p>

				<p>@ Roland, dafydd</p>
<p>Writeable firmware has an obvious advantage: problems might be fixed with an update rather than recall. It&#8217;s the same reason Intel likes microcoding complex functions and a number of hardware uses FPGA. Flexibility for reuse, lower design costs potentially, and less risk of recall.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228036">

			<div class="comment by-old-fart-who-remembers-clipper-and-skipjack ">

				<p class="commentcredit">

					<span class="commenter">Old fart who remembers clipper and skipjack</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228036">
						July 31, 2014 6:10 PM					</a>

				</p>

				<p>It may sound trite, but the root problem here is the U, in USB &#8211; &#8220;Universal&#8221;.</p>
<p>We&#8217;ve delegated damn near every concievable peripheral function of modern computers (HID, mass storage, network devices, media devices, game controllers, sound cards, video input and output, etc etc etc) to this overloaded, in the computer science sense, interface specification that has few intrinsic security protocols.</p>
<p>Then, we act all surprised when it is discovered that a malicious party can fabricate, or in this case, modify poorly designed, off-the-shelf USB devices that can potentially gain elevated privileges on the target machine by spoofing one or more different classes of device.</p>
<p>The USB specification was drawn up around twenty years ago, when most engineers and IT specialists still regarded such things as Thompson&#8217;s &#8220;Reflections on trusting trust&#8221; as ivory tower foppery.</p>
<p>If a memory stick, costing pennies and containing a simple Turing machine, is allowed to present itself as a keyboard and be recognised as such by the host OS, then the interface specification and protocols need a major reworking, ASAP.</p>
<p>In the absence of the above, a useful band-aid might be BIOS or OS level access control limits on the class of USB devices allowed on a given interface, e.g.: only HID devices on USB 0 and nowhere else, and mass storage devices will only be recognised on USB 3 and 4.</p>
<p>A further protection might be the ability to lock USB x to, e.g., the keyboard with serial number &#8216;12345678&#8217;.</p>
<p>We managed for years with purple and green PS2 sockets for keyboards and mice &#8211; perhaps the time has come for a rainbow of colour-coded, access-limited USB sockets, too.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228037">

			<div class="comment by-jakobb ">

				<p class="commentcredit">

					<span class="commenter">Jakobb</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228037">
						July 31, 2014 6:23 PM					</a>

				</p>

				<p>Any idea if hardware encrypted USB  devices like Aegis Secure keys are any safer?<br />
<a href="http://www.apricorn.com/aegis-secure-key.html" rel="nofollow ugc">http://www.apricorn.com/aegis-secure-key.html</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228038">

			<div class="comment by-old-fart-who-remembers-clipper-and-skipjack ">

				<p class="commentcredit">

					<span class="commenter">Old fart who remembers clipper and skipjack</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228038">
						July 31, 2014 6:26 PM					</a>

				</p>

				<p>@nickp &#8220;Writeable firmware has an obvious advantage: problems might be fixed with an update rather than recall.&#8221;</p>
<p>I agree with you in principle on the general case but, as far as mass-market USB memory sticks (the most likely vector for such an attack) are concerned, the likelihood of a manufacturer-initiated firmware update is strongly correlated to Old Nick&#8217;s use of ice-skates as commuter transport. 8)</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228039">

			<div class="comment by-buck ">

				<p class="commentcredit">

					<span class="commenter">Buck</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228039">
						July 31, 2014 6:40 PM					</a>

				</p>

				<p>@Old fart</p>
<p>Agreed! Unexpected firmware updates for cheap flash drives are far more likely to result in warranty-related losses than bugs in code that have been well tested for a decade or more&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228040">

			<div class="comment by-old-fart-who-remembers-clipper-and-skipjack ">

				<p class="commentcredit">

					<span class="commenter">Old fart who remembers clipper and skipjack</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228040">
						July 31, 2014 6:56 PM					</a>

				</p>

				<p>@buck: I don&#8217;t think f/w updates for inexpensive USB devices are likely &#8211; so the ability of such devices to potentially receive updates is unnecessary and dangerous.</p>
<p>The continued existence of such update mechanisms in, e.g. mass-market flash drives, is therefore mainly of significant utility only to those who would subvert the intended operation of the USB interface for undesirable ends.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228041">

			<div class="comment by-tz ">

				<p class="commentcredit">

					<span class="commenter">tz</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228041">
						July 31, 2014 7:08 PM					</a>

				</p>

				<p>If you wish to play with the concept easily&#8230;</p>
<p><a href="http://hakshop.myshopify.com/collections/usb-rubber-ducky" rel="nofollow ugc">http://hakshop.myshopify.com/collections/usb-rubber-ducky</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228042">

			<div class="comment by-lessthanobvious ">

				<p class="commentcredit">

					<span class="commenter">LessThanObvious</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228042">
						July 31, 2014 7:38 PM					</a>

				</p>

				<p>This is good research and I have no doubt this will be a threat in the wild in years to come. It&#8217;s just another reason it&#8217;s critical that we have security throughout the supply chain. It would be pretty easy for these kinds of devices to come from the factory already compromised. Same reason that as much as a I like Motorola Droid devices I&#8217;ll never buy another one now that Lenovo has control. I also strongly urge anyone with a Lenovo Thinkpad laptop to uninstall as much of the pre-installed vendor software as possible, not to pick on Lenovo too much specifically as it&#8217;s possible any manufacturer could have compromised products knowingly or otherwise. After a virus infection used &#8220;Lenovo Access Connections&#8221; to encrypt exfiltrated data from my laptop, I can&#8217;t trust it. That is not to say that all superfluous software shouldn&#8217;t be nixed as standard practice.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228043">

			<div class="comment by-scott-sfitcs-ferguson ">

				<p class="commentcredit">

					<span class="commenter"><a href='https://scottferguson.com.au' rel='external nofollow ugc' class='url'>Scott &quot;SFITCS&quot; Ferguson</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228043">
						July 31, 2014 7:39 PM					</a>

				</p>

				<p><cite>@sl149q</cite></p>
<p><cite></p>
<blockquote><p>
This appears to be a problem with devices leveraging class matching in Windows to get a malicious function connected (e.g. HID device).
</p></blockquote>
<p></cite></p>
<p>Sort of how it works. But it almost certainly doesn&#8217;t <i>just</i> affect Windows. It&#8217;s unlikely it wouldn&#8217;t affect <b>all</b> operating systems that support the USB protocol. If the device can spoof a manufacturer and product id (which <b>is</b> possible) then Linux&#8217;s udev (like Windows HAL) with treat the device accordingly. The Windows USB device handling process is functionally the same.</p>
<p><cite></p>
<blockquote><p>
This can be locked down using (for example) group policy to restrict hardware devices that are allowed to be used.
</p></blockquote>
<p></cite></p>
<p><b>I think you&#8217;ll find that belief is incorrect.</b><br />
If Windows (or Linux/UNIX, and likely Apple) &#8220;identify&#8221; the device as a keyboard, camera, external video card, whatever on the basis of how it identifies itself using the USB standard (manufacturer and device id) &#8211; even if you create complicated device property rules that use additional characteristics of the device &#8211; those characteristics can be spoofed to (e.g. power usage, or any of the other values give by the device &#8211; in the example output below).</p>
<pre><i>
'/devices/pci0000:00/0000:00:02.2/usb1/1-4/1-4:1.0/host8/target8:0:0/8:0:0:0/block/sdb/sdb1':
    KERNEL=="sdb1"
    SUBSYSTEM=="block"
    DRIVER==""
    ATTR{partition}=="1"
    ATTR{start}=="16"
    ATTR{size}=="6410672"
    ATTR{ro}=="0"
    ATTR{alignment_offset}=="0"
    ATTR{discard_alignment}=="0"
    ATTR{stat}=="     222     3087     4450      732        1        0
      1        0        0      544      732"
    ATTR{inflight}=="       0        0"

  looking at parent device
'/devices/pci0000:00/0000:00:02.2/usb1/1-4/1-4:1.0/host8/target8:0:0/8:0:0:0/block/sdb':
    KERNELS=="sdb"
    SUBSYSTEMS=="block"
    DRIVERS==""
    ATTRS{range}=="16"
    ATTRS{ext_range}=="256"
    ATTRS{removable}=="1"
    ATTRS{ro}=="0"
    ATTRS{size}=="6410688"
    ATTRS{alignment_offset}=="0"
    ATTRS{discard_alignment}=="0"
    ATTRS{capability}=="51"
    ATTRS{stat}=="     228     3087     4498      740        1        0
       1        0        0      552      740"
    ATTRS{inflight}=="       0        0"
    ATTRS{events}=="media_change"
    ATTRS{events_async}==""
    ATTRS{events_poll_msecs}=="-1"

  looking at parent device
'/devices/pci0000:00/0000:00:02.2/usb1/1-4/1-4:1.0/host8/target8:0:0/8:0:0:0':
    KERNELS=="8:0:0:0"
    SUBSYSTEMS=="scsi"
    DRIVERS=="sd"
    ATTRS{device_blocked}=="0"
    ATTRS{type}=="0"
    ATTRS{scsi_level}=="3"
    ATTRS{vendor}=="Kindle  "
    ATTRS{model}=="Internal Storage"
    ATTRS{rev}=="0100"
    ATTRS{state}=="running"
    ATTRS{timeout}=="30"
    ATTRS{iocounterbits}=="32"
    ATTRS{iorequest_cnt}=="0x12b9"
    ATTRS{iodone_cnt}=="0x12b9"
    ATTRS{ioerr_cnt}=="0x1"
    ATTRS{evt_media_change}=="0"
    ATTRS{queue_depth}=="1"
    ATTRS{queue_type}=="none"
    ATTRS{max_sectors}=="240"

  looking at parent device
'/devices/pci0000:00/0000:00:02.2/usb1/1-4/1-4:1.0/host8/target8:0:0':
    KERNELS=="target8:0:0"
    SUBSYSTEMS=="scsi"
    DRIVERS==""

  looking at parent device
'/devices/pci0000:00/0000:00:02.2/usb1/1-4/1-4:1.0/host8':
    KERNELS=="host8"
    SUBSYSTEMS=="scsi"
    DRIVERS==""

  looking at parent device
'/devices/pci0000:00/0000:00:02.2/usb1/1-4/1-4:1.0':
    KERNELS=="1-4:1.0"
    SUBSYSTEMS=="usb"
    DRIVERS=="usb-storage"
    ATTRS{bInterfaceNumber}=="00"
    ATTRS{bAlternateSetting}==" 0"
    ATTRS{bNumEndpoints}=="02"
    ATTRS{bInterfaceClass}=="08"
    ATTRS{bInterfaceSubClass}=="06"
    ATTRS{bInterfaceProtocol}=="50"
    ATTRS{supports_autosuspend}=="1"
    ATTRS{interface}=="Mass Storage"

  looking at parent device '/devices/pci0000:00/0000:00:02.2/usb1/1-4':
    KERNELS=="1-4"
    SUBSYSTEMS=="usb"
    DRIVERS=="usb"
    ATTRS{configuration}=="Self-powered"
    ATTRS{bNumInterfaces}==" 1"
    ATTRS{bConfigurationValue}=="1"
    ATTRS{bmAttributes}=="c0"
    ATTRS{bMaxPower}=="100mA"
    ATTRS{urbnum}=="9867"
    ATTRS{idVendor}=="1949"
    ATTRS{idProduct}=="0004"
    ATTRS{bcdDevice}=="0100"
    ATTRS{bDeviceClass}=="00"
    ATTRS{bDeviceSubClass}=="00"
    ATTRS{bDeviceProtocol}=="00"
    ATTRS{bNumConfigurations}=="1"
    ATTRS{bMaxPacketSize0}=="64"
    ATTRS{speed}=="480"
    ATTRS{busnum}=="1"
    ATTRS{devnum}=="9"
    ATTRS{devpath}=="4"
    ATTRS{version}==" 2.00"
    ATTRS{maxchild}=="0"
    ATTRS{quirks}=="0x0"
    ATTRS{avoid_reset_quirk}=="0"
    ATTRS{authorized}=="1"
    ATTRS{manufacturer}=="Amazon"
    ATTRS{product}=="Amazon Kindle"
    ATTRS{serial}=="B00AD0B11322188J"

  looking at parent device '/devices/pci0000:00/0000:00:02.2/usb1':
    KERNELS=="usb1"
    SUBSYSTEMS=="usb"
    DRIVERS=="usb"
    ATTRS{configuration}==""
    ATTRS{bNumInterfaces}==" 1"
    ATTRS{bConfigurationValue}=="1"
    ATTRS{bmAttributes}=="e0"
    ATTRS{bMaxPower}=="  0mA"
    ATTRS{urbnum}=="164"
    ATTRS{idVendor}=="1d6b"
    ATTRS{idProduct}=="0002"
    ATTRS{bcdDevice}=="0302"
    ATTRS{bDeviceClass}=="09"
    ATTRS{bDeviceSubClass}=="00"
    ATTRS{bDeviceProtocol}=="00"
    ATTRS{bNumConfigurations}=="1"
    ATTRS{bMaxPacketSize0}=="64"
    ATTRS{speed}=="480"
    ATTRS{busnum}=="1"
    ATTRS{devnum}=="1"
    ATTRS{devpath}=="0"
    ATTRS{version}==" 2.00"
    ATTRS{maxchild}=="6"
    ATTRS{quirks}=="0x0"
    ATTRS{avoid_reset_quirk}=="0"
    ATTRS{authorized}=="1"
    ATTRS{manufacturer}=="Linux 3.2.0-4-686-pae ehci_hcd"
    ATTRS{product}=="EHCI Host Controller"
    ATTRS{serial}=="0000:00:02.2"
    ATTRS{authorized_default}=="1"

  looking at parent device '/devices/pci0000:00/0000:00:02.2':
    KERNELS=="0000:00:02.2"
    SUBSYSTEMS=="pci"
    DRIVERS=="ehci_hcd"
    ATTRS{vendor}=="0x10de"
    ATTRS{device}=="0x0068"
    ATTRS{subsystem_vendor}=="0x1458"
    ATTRS{subsystem_device}=="0x5004"
    ATTRS{class}=="0x0c0320"
    ATTRS{irq}=="20"
    ATTRS{local_cpus}=="ffffffff"
    ATTRS{local_cpulist}=="0-31"
    ATTRS{dma_mask_bits}=="32"
    ATTRS{consistent_dma_mask_bits}=="32"
    ATTRS{enable}=="1"
    ATTRS{broken_parity_status}=="0"
    ATTRS{msi_bus}==""
    ATTRS{companion}==""
    ATTRS{uframe_periodic_max}=="100"

  looking at parent device '/devices/pci0000:00':
    KERNELS=="pci0000:00"
    SUBSYSTEMS==""
    DRIVERS==""
</i></pre>
<p>e.g. a device that identifies as a Flash drive (bulk storage device). Is seen as a bulk storage device- all I can do is change the rules on how that&#8217;s handled by the system.</p>
<pre><i>
Dec 15 22:08:05 vbserver mtp-probe: checking bus 1, device 9: "/sys/devices/pci0000:00/0000:00:02.2/usb1/1-4"
Dec 15 22:08:05 vbserver mtp-probe: bus: 1, device: 9 was not an MTP device
Dec 15 22:08:06 vbserver kernel: [37231.122454] scsi 8:0:0:0: Direct-Access     Kindle   Internal Storage 0100 PQ: 0 ANSI: 2
Dec 15 22:08:06 vbserver kernel: [37231.127116] sd 8:0:0:0: Attached scsi generic sg2 type 0
Dec 15 22:08:06 vbserver kernel: [37231.131048] sd 8:0:0:0: [sdb] 6410688 512-byte logical blocks: (3.28 GB/3.05 GiB)
Dec 15 22:08:07 vbserver kernel: [37231.234688] sd 8:0:0:0: [sdb] Write Protect is off
Dec 15 22:08:07 vbserver kernel: [37231.344693] sd 8:0:0:0: [sdb] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA
Dec 15 22:08:07 vbserver kernel: [37231.565991]  sdb: sdb1
Dec 15 22:08:07 vbserver kernel: [37231.844747] sd 8:0:0:0: [sdb] Attached SCSI removable disk
Dec 15 22:08:08 vbserver kernel: [37232.678814] FAT-fs (sdb1): utf8 is not a recommended IO charset for FAT filesystems, filesystem will be case sensitive!
</i><i></i></pre>
<p>I can change the rules that automount the file system. Which is fine and good when the device identifies as a drive.<br />
But if the device mimics my keyboard&#8230;. I can&#8217;t create a rule that can tell the difference between my real keyboard and the spoofed one. With access to the USB stack exploits that can leverage escalated privileges through firmware or driver layers of the OS <b>are</b> a demonstrably realistic possibility.</p>
<p>If I had to come to a conclusion at this time I&#8217;d strongly suspect that the only workable, mitigating solution is a reliable cryptographic device identification trust system (perhaps a variation of the old IBM MCA/RS Bus card identifier system?) . And a continued healthy level of distrust when it comes to  devices you attach to your computer.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228044">

			<div class="comment by-chris-abbott ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://abbottit.com' rel='external nofollow ugc' class='url'>Chris Abbott</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228044">
						July 31, 2014 7:46 PM					</a>

				</p>

				<p>Is there any way around this? I work on infected machines daily and (I know, this is really stupid, but in all the years I&#8217;ve worked I&#8217;ve never  had a problem) I use a USB drive to install software on my customers machines, then I occasionally do a SHA-512 hash comparison on the executables on the drive. I often scan it too with AV. If the drive&#8217;s firmware can be pwned, should I start installing my usual software on machines with a CD/DVD? That would be such a pain in the ass!</p>
<p>@anon @Name (required):</p>
<p>Sometimes I worry that all of the security vulnerabilities in everything these days is going to force us back into the dark ages&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228045">

			<div class="comment by-nick ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://nickdenham.com/blog' rel='external nofollow ugc' class='url'>Nick</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228045">
						July 31, 2014 7:52 PM					</a>

				</p>

				<blockquote><p>In the absence of the above, a useful band-aid might be BIOS or OS level access control limits on the class of USB devices allowed on a given interface, e.g.: only HID devices on USB 0 and nowhere else, and mass storage devices will only be recognised on USB 3 and 4.</p>
<p>A further protection might be the ability to lock USB x to, e.g., the keyboard with serial number &#8216;12345678&#8217;.</p>
<p>We managed for years with purple and green PS2 sockets for keyboards and mice &#8211; perhaps the time has come for a rainbow of colour-coded, access-limited USB sockets, too.</p></blockquote>
<p>Agree with this sentiment, my first reaction to hearing about this yesterday was</p>
<p>1) USB firmware should be cryptographically signed.<br />
2) Operating systems should prompt users to enable specific USB functions. When I pop in my badusb thumbdrive the OS should pop-up asking me to allow the USB Storage Device, <b>and</b> USB Keyboard. I think most users would be able to navigate, and be on notice, that their storage <b>shouldn&#8217;t</b> be a keyboard.</p>
<p>The problem with both of these obvious solutions is<br />
1) Change to the USB spec is probably politically impossible or so far down the track as to be useless<br />
2) Change to operating system behaviour is difficult to do correctly and is only slightly quicker to execute.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228046">

			<div class="comment by-hitechhitouch ">

				<p class="commentcredit">

					<span class="commenter">HiTechHiTouch</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228046">
						July 31, 2014 7:52 PM					</a>

				</p>

				<p>Do you remember the flack about printers (and rogue micro-code?)</p>
<p>There a lots of USB connect devices, not just sticks and memory cards, for this vector/exposure&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228047">

			<div class="comment by-koanhead ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://freegeekseattle.org' rel='external nofollow ugc' class='url'>koanhead</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228047">
						July 31, 2014 7:58 PM					</a>

				</p>

				<p>Sounds like FUD and sensationalism to me. I don&#8217;t believe, for example, that USB devices are as homogeneous as they claim: <em>all</em> USB devices have writable firmware, really? And no trusted firmware exists for <i>any</i> of them? &#8216;Cause I&#8217;m pretty sure that the Debian repositories contain some fairly trustworthy open-source code for some USB devices, usb-dux in firmware-linux-free for example.</p>
<p>Until it&#8217;s released, I say it&#8217;s puffery. Yes, USB devices are not secure. It&#8217;s always been the case and will continue to be so. To say that an ownable device &#8220;must be regarded as owned&#8221;, though, is foolishness. Firmware images can be verified, and USB host adapters can be turned off.</p>
<p>It does underline the idea that only Free or at least open-source software is trustworthy from a security perspective. I would think that readers of this blog would already have received that memo. Non-free and proprietary firmwares are a problem <i>in general</i>, and not solely in USB land or relating to this specific class of vulnerability.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228048">

			<div class="comment by-chris-abbott ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://abbottit.com' rel='external nofollow ugc' class='url'>Chris Abbott</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228048">
						July 31, 2014 8:28 PM					</a>

				</p>

				<p>@Nick:</p>
<p>Let&#8217;s say we have a USB 4 that does that. It seems like that could present backward compatibility problems. Would it? Most people would probably use the old cheap flash drives anyway I would guess. People are lazy when it comes to security.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228049">

			<div class="comment by-chris-abbott ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://abbottit.com' rel='external nofollow ugc' class='url'>Chris Abbott</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228049">
						July 31, 2014 8:29 PM					</a>

				</p>

				<p>Oh and on my first post:</p>
<p>I often rewrite the partition table too on my flash drives. But now that seems useless&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228050">

			<div class="comment by-koanhead ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://freegeekseattle.org' rel='external nofollow ugc' class='url'>koanhead</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228050">
						July 31, 2014 8:37 PM					</a>

				</p>

				<p>OK, the Register&#8217;s coverage points out that it&#8217;s <a href="http://www.theregister.co.uk/2014/07/31/black_hat_hackers_drive_truck_through_hole_in_usb_security/" rel="nofollow ugc">&#8220;not all USB devices&#8221;</a>.<br />
It&#8217;s not clear to me from their article that the research itself makes this caveat, and I don&#8217;t see any reference to it at the <a href="https://srlabs.de/badusb/" rel="nofollow ugc">SRLabs link</a>  so I think that caveat is the Register&#8217;s (and my) own interpretation.<br />
The Register further points out the security-vs-cost tradeoff of securing against BadUSB by making microcontrollers accept only firmwares signed by one of a hard-coded list of keys. I don&#8217;t think this will work any better than the Trusted Computing Initiative has, that is, a small increment in security for a massive increase in cost and inconvenience to users. I don&#8217;t think any solution that doesn&#8217;t involve open-source firmware is going to work well. It&#8217;s better to sign a hash of another, known-good image than to sign the image you&#8217;re sending.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228051">

			<div class="comment by-gweihir ">

				<p class="commentcredit">

					<span class="commenter">Gweihir</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228051">
						July 31, 2014 8:44 PM					</a>

				</p>

				<p>I expect this is a non-issue on most devices, because the flash storage with the firmware will have the protection bits set. (I have never seen any USB thumb-drive where you could upgrade the firmware.) At that point, a software-only attack gets infeasible or extremely hard.</p>
<p>Also notice that if this works, it has a high probability of getting noticed, because this attack has a high probability of bricking the USB chip. It needs to get everything right in order not to and there are numerous different controllers with numerous different firmware revisions out there.</p>
<p>And finally, there is not much space in there that could hold attack code. In particular, there is not enough space to be able to work work with a lot of different sticks. In practice, this will likely be two-hop, i.e. PC-&gt;USB-stick-&gt;PC and lose its propagation capability to USB in the first hop.</p>
<p>Incidentally, the claim this could work on USB keyboards is complete hyperbole for normal keyboards. For example, I have a Cherry keyboard that has a non-erasable ROM and 256 Bytes of EEPROM in addition to store the keyboard map. Sure, the on-time programmable ROM is likely flash, but the device does not have the high-voltage generator and bus-lines required to erase the cells. It physically cannot do it. It is also a whopping 4kB of ROM. Nobody will be able to fit Malware in there and even trying will break the keyboard, which would be rather noticeable. And once again, this requires a specific attack for each different Keyboard hardware and firmware revision. As most USB keyboards and Mice are HID, there is a large component selection space.</p>
<p>So my guess would be &#8220;neat research, likely irrelevant in practice due to numerous issues, except for targeted attacks where the hardware to be attacked is precisely known in advance&#8221;.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228052">

			<div class="comment by-buck ">

				<p class="commentcredit">

					<span class="commenter">Buck</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228052">
						July 31, 2014 9:58 PM					</a>

				</p>

				<p>@Nick D</p>
<p>While I agree with much of what you have to say here, there is at least one gaping exception&#8230;</p>
<blockquote><p>I think most users would be able to navigate, and be on notice, that their storage <b>shouldn&#8217;t</b> be a keyboard.</p></blockquote>
<p>From my own personal experiences, I would expect <i>most users</i> to simply not understand, not care, or click through (and accept all defaults).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228053">

			<div class="comment by-thoth ">

				<p class="commentcredit">

					<span class="commenter">Thoth</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228053">
						July 31, 2014 10:01 PM					</a>

				</p>

				<p>One huge take away&#8230;</p>
<p>As with all programs, functions, devices and utilities designed by humans, it&#8217;s prone to errors and irresponsible implementation/design/testing in an opaque environment.</p>
<p>It&#8217;s not just the USB that&#8217;s dangerous. Anything is dangerous if security is not part of the design/implementation.testing especially in an opaque environment.</p>
<p>Disabling write is not the solution to all problems. The solution to all problems is being responsible and transparent.</p>
<p>The mindset of most program creation (about 90% +/-) is simply, &#8220;well I just wanna push out this product and get the Wows and $$$ and I dont really care&#8221;. That&#8217;s the attitude that killed us all.</p>
<p>That&#8217;s the very key that allows malwares and bugs creep in&#8230; because people don&#8217;t care&#8230; because people don&#8217;t want to be accountable&#8230; because people want to make systems opaque.</p>
<p>Essentially, it&#8217;s the human issue right at the core and it&#8217;s very hard to fix unless the entire culture of humanity on the approach of building systems can be changed to be a more responsible and transparent one.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228054">

			<div class="comment by-buck ">

				<p class="commentcredit">

					<span class="commenter">Buck</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228054">
						July 31, 2014 10:10 PM					</a>

				</p>

				<p>@Chris Abbott</p>
<p>Luckily, for near-future script-kiddie assaults, you could change your habits now! 😉<br />
Unfortunately, if you&#8217;re dealing with well-resourced bleeding-edge attackers, your efforts are nil&#8230; :-\</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228055">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228055">
						July 31, 2014 10:51 PM					</a>

				</p>

				<p>@ Buck,</p>
<p>We know users can not tell the difference when their USB device changes it&#8217;s function.</p>
<p>The reason we know it is Broadband GSM etc mobile network devices from the likes of ZTE.</p>
<p>The devices contain firmware for two and often three different USB classes, a &#8220;read only&#8221; memory device such as a CD-ROM, an &#8220;AT command set modem&#8221; and &#8220;flash memory&#8221; thumb stick device.</p>
<p>Basicaly when you plug it in and it powers up it defaults to being the CDROM which uploads a small executable program that then runs and checks for Service Provider software on the PC, if it finds the software it simply tells the device to switch to being the modem. If it cannot find the software on the PC it then installs it prior to telling the device to switch to being a modem. The reason it appears as a CDROM is their is a fairly standard trick for a CDROM to appear as a native device for Apple mac etc, *nix systems and MS Windows systems. Thus the broadband modem device has enough &#8220;hidden&#8221; storage to contain three different file systems with different OS software on each.</p>
<p>The process of installing the service provider software is fairly standard, but I&#8217;ve yet to see an automatic uninstaller, which means your PC hard drive will get littered with such software, as each different broadband modem you plug in stuffs on another few meg of service provider software.</p>
<p>It&#8217;s the way things are supposed to work from the USB consortium, device manufacturer, service provider point of view. And although they are unaware of the mechanics behind it, how the majority of end users want it to work as well.</p>
<p>You can blaim much of this on the MS led/inspired &#8220;Plug-n-Play&#8221; ethos where the user would not have to worry about installing drivers etc theid just plug it in&#8230;</p>
<p>Way way back then security proffessionals warned it was the equivalent of getting drunk and then practicing &#8220;unsafe sex&#8221;, but as normal with humans the bad consiquences have to happen to the average individual before they will take heed, by which time it may be to late and they have the equivalent of mind destroying tertiary siph or worse&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228056">

			<div class="comment by-organon ">

				<p class="commentcredit">

					<span class="commenter">Organon</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228056">
						July 31, 2014 11:03 PM					</a>

				</p>

				<p>@Thoth: &#8220;Essentially, it&#8217;s the human issue right at the core and it&#8217;s very hard to fix unless the entire culture of humanity on the approach of building systems can be changed to be a more responsible and transparent one.&#8221;</p>
<p>The &#8216;responsible&#8217; part applies to the ethical layer, but the problem is deeper than ethics.</p>
<p>There&#8217;s an epistemological problem relating to reduction, which is the logical process of tracing a concept back to the concretes that it stands for.</p>
<p>For most folks abstraction is done by other people, and the foundation of ideas are not to be questioned. Products built under that regime are naturally not going to be transparent, and people wouldn&#8217;t know what to do with them if they were. Under Christian Fascism, there&#8217;s a cultural bias that favors believing over knowing.</p>
<p>With Google lowering the cost of knowing, it is becoming feasible on a ever larger scale to make transparent systems, which is to say systems that are reducible.</p>
<p>Now the NSA has provided the motivation for building reducible systems.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228057">

			<div class="comment by-mark-h ">

				<p class="commentcredit">

					<span class="commenter">Mark H</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228057">
						July 31, 2014 11:04 PM					</a>

				</p>

				<p>I wonder how hard it would be to patch sudo to only allow passwords from a specific bus/port/keyboard combo.  I.E. to only authenticate with my laptops built in keyboard.  Or to disallow HID functions from specific usb ports.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228058">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228058">
						July 31, 2014 11:15 PM					</a>

				</p>

				<p>@ old fart &amp; Buck</p>
<p>An update on a USB flash drive is unlikely. However, I suspect that it&#8217;s not actually the cause. I mentioned another driver in my post: reuse. Let&#8217;s say you develop all kinds of peripheral devices. You need a USB controller in most of them. The main difference in them will be the software on the controller and/or its performance. So, you now have two choices: design a bunch of separate USB chips (or ROM&#8217;s) with separate production; design one programmable USB chip with a production step selecting what firmware to put on it. One makes a hell of a lot of sense to a company focused on the bottom line. Now, repeat this process for many chip designs with maximizing reuse being a key goal and you get the modern IC marketplace.</p>
<p>Note: They might also be using a SoC they use in other embedded products which just happens to be field-upgradeable. They might keep their embedded RTOS, timing analysis, etc the same across product lines.</p>
<p>Another good example is hard disks. There&#8217;s many models available with different amounts of storage. Consumers assume that higher end models have more of some physical thing that results in a higher price. Actually, they figured out that it&#8217;s cheaper to design just one hard disk, then do something in the firmware that changes how much space is available. This saves them plenty of money. They also might need to support firewire, USB, eSATA, and so on. The next step that might benefit would be putting them all on the controller or buying an existing chip on the market that supports them. Then, just like configuring size, you tell the firmware what to enable. And now your new product just needs a different connector soldered onto it.</p>
<p>@ Chris Abbott</p>
<p>I have no idea. Any change could cause BC problems. Like I said above, I think it was functionality that was reused either due to being a COTS chip they bought or them using that functionality in another device.</p>
<p>@ Old Fart</p>
<p>Re Universal</p>
<p>It&#8217;s a good observation as it would seem to be the root problem. It&#8217;s not, though. There are existing methods to handle general I/O with quite a bit of security. I even posted a few new one&#8217;s on this blog. The thing is that the I/O mechanism must be designed for secure operation, which mainstream I/O typically isn&#8217;t. Combining insecure I/O architectures, insecure devices, <em>and</em> universal attribute predictably leads to insecurity.</p>
<p>@ Gweihir</p>
<p>I&#8217;m mostly in agreement that there&#8217;s only so much one can do on microcontollers. Yet, early computer virii were written in the hundreds of instructions range and an injection over DMA for a specific OS might not take up much space. Removing the password, changing existing code to admin/kernel/hypervisor mode, or leaking a key in memory would take even fewer instructions than a rootkit. So, size matters but I&#8217;ve seen too much black hat innovation to build assurance on such an attribute.</p>
<p>@ egeltje</p>
<p>The Qubes founder&#8217;s blog has a nice writeup on USB security issues:</p>
<p><a href="http://theinvisiblethings.blogspot.com/2011/06/usb-security-challenges.html" rel="nofollow ugc">http://theinvisiblethings.blogspot.com/2011/06/usb-security-challenges.html</a></p>
<p>I doubt Qubes has gotten to the point of truly isolating damage USB can do. They do use an IOMMU to restrict the device&#8217;s DMA and allow you to assign a device to a VM. Those two alone are quite beneficial. Yet, anything you send to or receive from the device still poses a risk as with any isolation method. And as we&#8217;re talking storage devices that&#8217;s a significant risk.</p>
<p>@ Thoth</p>
<p>Like a general purpose device, a secure microcontroller requires mechanisms to ensure loading of authorized code, protection of internal memory, control flow integrity, and prevent data becoming code. That it might loose power at any moment presents additional issues shared by smart cards. That the software is controlled by the manufacturer, special purpose, and rarely changes means it&#8217;s actually easier to secure this kind of device. That the device must be as cheap as possible to ensure profitability pushes against security. So, the solution must use little power, be very cheap, be adaptable to other stuff they do (reuse), meet all performance requirements, and be secure.</p>
<p>The best solution I see is starting with something like Sandia Secure Processor design, then adding trusted boot/upgrade and optionally an I/O coprocessor. The result would be cheap, performing, easy to modify, and unlikely to be hit with code injection. A transactional, versioning approach to persistent storage might also help with failing safe on power failure. Stateless design is the alternative (and default) for that kind of thing.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228059">

			<div class="comment by-buck ">

				<p class="commentcredit">

					<span class="commenter">Buck</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228059">
						July 31, 2014 11:21 PM					</a>

				</p>

				<p>@Clive</p>
<p>Automatic installer&#8230; 😛 Don&#8217;t think I&#8217;ve run one if those (overtly) since windows 3.1! Though yes, user education and the techie/non-tech gap remains a major problem&#8230; (plus it seems that the OS publishers always go about mucking with SOP for disabling insecure default settings)-:</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228060">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228060">
						July 31, 2014 11:28 PM					</a>

				</p>

				<p>The general take away from this is,</p>
<p><i></p>
<ul>Security is much harder than it should be, because joe average wants an easy life.</ul>
<p></i></p>
<p>It&#8217;s the old Security-v-Usability argument that has been around since the 1960&#8217;s, and if people think back they will see all new attack classes were preceded by new user action changes. For instance Boot Sector malware followed the advent of &#8220;sneaker nets&#8221; of the Late 70s and 80s, which in turn gave as the AV industry. Likewise other malware infection vectors, via modems, LANs, Plug-n-Pray, removable media, removable devices&#8230; with more rcently the problems with BYOD smart phones. The cycle repeats over and over, with users not learning from history easily in living memory.</p>
<p>Whilst users practice &#8220;Party hard, die young&#8221; mentality to their computing, we also have to remember the industry bears quite a bit of responsability. It&#8217;s the ultimate in consumerism, product life cycles are measured in months not years, way faster than less expensive &#8220;white goods&#8221;, which is why for many years the sector has been the leading light of FMCE (fast moving consumer electronics).</p>
<p>But with FMCE there are issues, the profit margin is slim and competition is high. It is set up as a &#8220;push system&#8221; where &#8220;returns&#8221; have to be eliminated as the cost of a single return can exceed the profit of upto several hundred units, and far far exceed even the retail cost of individual items. The joke of it is it&#8217;s now got so bad that for some retailers the items are sold at cost and the profit is made on post and packing&#8230;</p>
<p>When viewed this way it can be seen why things are the way they currently are. This leaves with the question of &#8220;Who is going to pay for security?&#8221; and the resounding answer in well over 99.999% of user level ICT purchases is &#8220;Not Me, No way, No how!!!&#8221;.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228061">

			<div class="comment by-buck ">

				<p class="commentcredit">

					<span class="commenter">Buck</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228061">
						July 31, 2014 11:29 PM					</a>

				</p>

				<p>@Nick P</p>
<p>I&#8217;d be willing to wager that any company hella focused on the bottom line would definitely be able to track specific SOC providers to highly rated RMA customer locales&#8230; 😉</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228062">

			<div class="comment by-figureitout ">

				<p class="commentcredit">

					<span class="commenter">Figureitout</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228062">
						August 1, 2014 12:52 AM					</a>

				</p>

				<p>Hmm, running off a USB-stick now&#8230;such handy little f*ckers.  Already knew it was infected as it was a 16GB drive but plug into and moving on to another drive I lose 2GB and there suddenly pops up 2 devices&#8230;Everywhere for me it&#8217;s been a separate device installed in the USB, w/ its own filesystem&#8230;it&#8217;s infected all my computers and all my accounts, so to remove it I need a complete purge which I&#8217;m not ready to do yet&#8230;verified this w/ my infected USB sticks many times, you should let me stick one in your computer if you want to see just how secure it is&#8230;.</p>
<p>Not to mention my windows laptop I&#8217;ve been leaving out to pick up more infections&#8230;they came of course (not from the internet).  Now I&#8217;m suddenly running &#8220;illegal windows software&#8221; after leaving it dormant all summer.  &#8220;Let the framing begin&#8221;.  Oh, my Temp directory got filled w/ garbage as usual, more encrypted garbage on a newly formated disk (total joke), now I&#8217;ve got more smiley faces showing up on encrypted partitions.  A part of me wants to &#8220;accidently break&#8221; this PC but another part says wait a minute it&#8217;s still capable of processing&#8230;can&#8217;t use it for my school work as it&#8217;s got some hardware module in it and I don&#8217;t feel like ripping this laptop apart.</p>
<p>Just got an <a href="http://en.wikipedia.org/wiki/VXA" rel="nofollow ugc">Ecrix VXA-1 External tape drive</a>&#8230;uses <a href="http://en.wikipedia.org/wiki/SCSI" rel="nofollow ugc">SCSI-SE protocol</a>  Will investigate more later&#8230;</p>
<p>I think this really is a problem overall w/ just memory&#8230;who&#8217;s to say a little USB-chip isn&#8217;t in your hard disk w/ the power, clock, ground, signal line all just taking power from the computer power supply?  That takes some analysis to find.</p>
<p>Also, <a href="http://www.reddit.com/r/netsec/comments/2c9otm/badusb/" rel="nofollow ugc">/r/netsec</a> on &#8220;BadUSB&#8221;.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228063">

			<div class="comment by-65535 ">

				<p class="commentcredit">

					<span class="commenter">65535</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228063">
						August 1, 2014 4:38 AM					</a>

				</p>

				<p>@ Ian Mason</p>
<p>I think this subject has come up in other posts. I did review the video at your link.</p>
<p>I do see the clear problem with having re-programmable micro-controller on a flash drive connected to your computer. It could have a large attack vector.</p>
<p><a href="http://www.youtube.com/watch?v=r3GDPwIuRKI" rel="nofollow ugc">http://www.youtube.com/watch?v=r3GDPwIuRKI</a><br />
30C3: Exploration and Exploitation of an SD Memory Card</p>
<p>Here are the key points from the YT video on Exploration and Exploitation of an SD Memory Card:</p>
<p>19:10 Go to Baidu [Chinese version of Google] and down load SD controller Programming tool [screen shot of down programming tool site in Chinese]</p>
<p>34:21 Explanation of matching controller to actual flash chip “big fan of running any code on any hardware you own including your SD Card… no method of verifying what is running on these controllers”</p>
<p>34:59 Attack Scenarios</p>
<p>-Eavesdropping<br />
* Report smaller than actual capacity [report the SD card at 4 GB when it is 8 GB, hide copied data].<br />
* Data is sequestered to hidden sectors that are un-erasable.</p>
<p>ToC/ToU<br />
* Present one version of the file for verification; another for execution<br />
* Bootloader manipulation, ect.<br />
* Selective-modify<br />
* Scan for assets of interest, e.g. Security key, binaries, and replace with insecure versions.</p>
<p>37:21 Samsung MMC<br />
* Samsung pushed firmware patch to eMMC cards in Android [Note?]<br />
* Contain ARM7 code [hyperlink]<br />
* Uses “class 8” instructions reserved for manufacturer</p>
<p>39:59 Wrap-up slide<br />
* SD cards contain fully programmable micro-controllers<br />
*Controller program modifiable via special host commands, Potential MITM attacks – extremely cheap microcontroller for fun projects, [Explanation of why the manufactures don’t hard code the micro-controllers; too many mix and match flash chips]</p>
<p>42:32 Demonstration of SD card attach to computer to reprogram SD micro-controller.</p>
<p>47:59 Question about USB sticks and SD cards [not much difference].<br />
*Question about various attacks [various micro-controllers in laptop and so on] Sandisk controllers may have micro-controller protection from the factory but the user cannot protect it.<br />
*Flash with WiFi controllers are attack targets.</p>
<p>@ Nick P</p>
<p>I think you nailed it. Any device with DMA capabilities is a risk. The reprogrammable microprocessors on these flash devices are for economic reasons [mix and match different flash chips cheaply as possible while managing the wear factor].</p>
<p>@ tz</p>
<p>I would think the rubber ducky USB would be really handy if you could make pirated exterior cases of major manufactures [preferably the exact case of your target], place the rubber ducky inside the fake case with a persistent virus  and trick the user into putting it into his machine.</p>
<p>@ Clive</p>
<p>You seem to be knowledge about this USB device function switching trick. I gather it has been done before 😉</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228065">

			<div class="comment by-daniel ">

				<p class="commentcredit">

					<span class="commenter">Daniel</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228065">
						August 1, 2014 5:47 AM					</a>

				</p>

				<p>Why code is allowed to be written / changed on a storage device ?</p>
<p>Can someone explain the data flow? The driver reads / execute firmware written to USB in order to detect its type, writing mode etc? Why that if there are still drivers on the computer who can identify USB type?</p>
<p>Something is very bad made here (read backdoor).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228066">

			<div class="comment by-atn ">

				<p class="commentcredit">

					<span class="commenter">ATN</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228066">
						August 1, 2014 5:58 AM					</a>

				</p>

				<blockquote><p>
  Any device with DMA capabilities is a risk.
</p></blockquote>
<p>Not if the host computer program the DMA (source address + length for reads, target address + length for writes), yes if the external device decides itself of those addresses or can modify them.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228067">

			<div class="comment by-tim-bradshaw ">

				<p class="commentcredit">

					<span class="commenter">Tim Bradshaw</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228067">
						August 1, 2014 8:12 AM					</a>

				</p>

				<p>Although the risk from USB is, perhaps, higher because people tend to plug USB drives into their computers without thinking, it seems to me that there are a lot of peripherals attached to a modern system with a lot of field-upgradeable firmware in them.  How much do you trust your disk drives?  Your keyboard(-controller), your mouse?  Anything?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228068">

			<div class="comment by-jeremy-l ">

				<p class="commentcredit">

					<span class="commenter">Jeremy L</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228068">
						August 1, 2014 8:16 AM					</a>

				</p>

				<p>Signing the firmware doesn&#8217;t make it secure.</p>
<p>It just ensures the code was written by someone with access to the keys of a manufacturer somewhere on the planet.  It also restricts open-source firmware, assuming that a signed key requires some payment and identity validation.</p>
<p>The fundamental issue is the hardware and the protocol.  We have well-established infrastructure for ethernet/tcp connections.  USB is just another bus.  But most people know very little of how USB works.</p>
<p>One solution: ethernet/PoE peripherals. Unlike USB, we have tools to make that secure and monitor it.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228069">

			<div class="comment by-andrew-yeomans ">

				<p class="commentcredit">

					<span class="commenter">Andrew Yeomans</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228069">
						August 1, 2014 8:44 AM					</a>

				</p>

				<p>Webkeys have been around for some time. These can look like a USB flash drive, but emulate a keyboard. They are cheap enough to be given away as a marketing promotion.</p>
<p>See <a href="http://my-key.co/webkeys/usb-web-keys" rel="nofollow ugc">http://my-key.co/webkeys/usb-web-keys</a> or <a href="http://www.digital-key.co.uk/" rel="nofollow ugc">http://www.digital-key.co.uk/</a> for some examples.</p>
<p>One I looked at pretended to be an Apple keyboard, presumably so OS/X would not complain when plugged in. &#8220;lsusb&#8221; gave &#8220;ID 05ac:020b Apple, Inc. Pro Keyboard [Mitsumi, A1048/US layout]&#8221;.</p>
<p>It was amusing to see his expression, when plugging into the computer of the person configuring USB lock-down software to block all access, when a web-page popped up.</p>
<p>Security risk? Comparable to letting a stranger type on your keyboard. And maybe we should not trust any un-checked inputs from any device. Just as the industry had to turn off USB auto-run by default, maybe we need the user to type a challenge PIN before accepting a newly connected keyboard by USB, Bluetooth, etc.</p>
<p>However there is still the possibility of bugs in the USB drivers &#8211; I&#8217;ve heard stories of car electronics crashing when some types of phones are plugged into the entertainment system.</p>
<p>USB fuzzing has been around for several years, maybe this latest research will bring renewed work to detecting and fixing USB driver bugs.</p>
<p>Incidentally, is anyone aware of recent research on re-flashing USB controllers with open software? Most of the work reported seems to end up pointing to <a href="http://flashboot.ru/" rel="nofollow ugc">http://flashboot.ru/</a> which often relies on use of arbitrary Windows executables to do the re-programming. Hardly verifiably safe and secure!</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228070">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228070">
						August 1, 2014 9:31 AM					</a>

				</p>

				<p>@ Tim Bradshaw,</p>
<p><i></p>
<ul>How much do you trust your disk drives? Your keyboard(- controller), your mouse? Anything?</ul>
<p></i></p>
<p>Simple answer, not at all.</p>
<p>A friend demonstrated an interesting prototype hack to me a while back. A well known manufacturer of printers has in some of the mid range and low end models both USB and WiFi hardware fitted. It is fairly easy to turn the printer into what is a Wifi dongle and covertly transmit copies of the printed documents out to a suitably access point. Some of the models also have scanners and other interesting bits such as memory card readers as well&#8230;</p>
<p>What my friend is trying to do is get the WiFi interface on the printer to also act as a &#8220;repeater&#8221; where it bridges two or more WiFi networks together. Thus form a covert wireless mesh network which could shift data across many links before reaching the final exfiltration destination or link out onto the Internet.</p>
<p>He pointed out a couple of sailient facts we should all consider,</p>
<p>1, Infinate Monkeys would stand a better chance of writing secure code for peripheral devices (especialy for those on ARM u-procs).</p>
<p>2, There&#8217;s no AV or other security products for end users to put on their peripherals to stop even the simplest of attacks.</p>
<p>Thus it&#8217;s like steping back to the days of Win95 but without the &#8220;Dr Solomon&#8217;s&#8221; to keep the idiots out. He also demonstrated some time ago a way for a webserver to find out not just the model but a whole bunch of other details about printers connected to the computer&#8230;</p>
<p>@ ATN,</p>
<p>The problem with DMA is it works below the CPU level in the computing stack, a little above bus level. This means that you need a hardware solution to stopping a peripheral DMA going rouge on you because software cannot see it (only it&#8217;s results). As others have noted above the OS manufactures don&#8217;t even try to lock down hardware even where it can be which makes the problem worse.</p>
<p>The solution is to put some kind of MMU between the peripheral DMA controler and the system memory &#8211;and other devices&#8211; such that fine grained lock down can be achived by the OS (providing the OS supplier support/allows it).</p>
<p>@ 65535,</p>
<p>Yes it&#8217;s been done before.</p>
<p>If you hunt back in this blog you will find that I have mentioned I was trying to develop a very secure USB memory drive that also had a RTC, GPS and GSM interfaces in it, such that it could be remotely erased, or self erase when it went outside a geographic area or time, or the user pressed &#8220;the big red button&#8221; due to stress or even just shouted etc near it (it used the trick for various things including becoming a secure GSM modem).</p>
<p>The problem is it&#8217;s not reliable in the ordinary sense, and thus you have to do key managment in real time from a remote control point. Whilst this can be done relatively easily, it had other issues&#8230;</p>
<p>One of which was it turned out there were no GSM chips/modules that could even remotely be secure&#8230; That is they all had large amounts of RAM/ROM flaky Java implementations and were designed or manufactured in very untrustworthy places such as China, France, Israel and the US. And as has been observed by others on this blog recently one of the Israel / US manufacturers has now come under the Chinese sphere of influence&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228071">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228071">
						August 1, 2014 1:11 PM					</a>

				</p>

				<p>@ Jeremy L</p>
<p>&#8220;Signing the firmware doesn&#8217;t make it secure.&#8221;</p>
<p>As I said, it&#8217;s one of a few components necessary in a secure device. The property is that only authorized code can run. Firmware signing is one of many technologies that might be used for this. It has the advantage of allowing firmware to change. If hardware never treats code as data and has firmware signing, it&#8217;s not going to run malicious code via a mere software attack. An extra property or two adds protection against attacks by CPU or other hardware.</p>
<p>Changing the protocol itself doesn&#8217;t seem to be an option at this point, although the protocol handler can be modified for increased security.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228072">

			<div class="comment by-unsecure ">

				<p class="commentcredit">

					<span class="commenter">unsecure</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228072">
						August 2, 2014 5:03 AM					</a>

				</p>

				<p>USB drive to go the way of the floppy disk</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228073">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228073">
						August 2, 2014 5:36 AM					</a>

				</p>

				<p>@unsecure,</p>
<blockquote><p>USB drive to go the way of the floppy disk</p></blockquote>
<p>Only to be replaced by something, of course, more &#8220;secure&#8221; like the smog &#8212; AKA the cloud.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228074">

			<div class="comment by-mike-the-goat-horn-equipped ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://mikethegoat.wordpress.com' rel='external nofollow ugc' class='url'>Mike the goat (horn equipped)</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228074">
						August 2, 2014 7:46 AM					</a>

				</p>

				<p>Wael: I think it is fair to consider that the designers of USB didn&#8217;t really consider security to be a priority. Although when you look at some of the alternatives that were in vogue at the time &#8211; like FireWire which gave you DMA access to the host &#8211; it wasn&#8217;t nearly as bad as it could have been.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228075">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228075">
						August 2, 2014 10:09 AM					</a>

				</p>

				<p>@Mike the goat (horn equipped),<br />
True! USB had no security considerations at design time. Security came in as an after math, if it did at all. To some extent, the same can be said about blue tooth. PS2, serial ports and parallel ports don&#8217;t have much of a security either, to be fair. DMA (master mode) can be a hole, as @Nick P repeatedly stated, although I have a feeling his words are falling on designer&#8217;s deaf ears.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228076">

			<div class="comment by-m-v ">

				<p class="commentcredit">

					<span class="commenter">M.V.</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228076">
						August 2, 2014 10:46 AM					</a>

				</p>

				<p>USB Devices don&#8217;t have control over the DMA inside the USB Hostcontroller. So the DMA hole doesn&#8217;t apply.</p>
<p>Also USB up to Version 2.0 is based on polling, that means the device can&#8217;t send unexpected data, just malformed one to exploit driver and SW bugs.</p>
<p>For external devices the DMA hole currently only applies to Firewire, ExpressCard, Thunderbolt and some exotic stuff based on cabled PCI express.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228077">

			<div class="comment by-zig-fiedorowicz ">

				<p class="commentcredit">

					<span class="commenter">Zig Fiedorowicz</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228077">
						August 2, 2014 12:33 PM					</a>

				</p>

				<p>I have some questions about this badusb vulnerability.</p>
<p>My understanding is that<br />
(a) usb firmware is executable code which runs on the microcontroller<br />
within the usb device, NOT code which runs on the host computer.<br />
(b) the usb standard specifies a communication protocol between usb<br />
devices, NOT the architecture of the microcontrollers within these<br />
devices.</p>
<p>If my understanding is correct, then I don&#8217;t see how you could write<br />
badusb firmware which would work across a wide range of devices.  The<br />
firmware would not be binary code compatible between devices, no more<br />
than Intel machine code could run on an ARM processor.</p>
<p>If I am wrong, I would be glad to be enlightened.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228078">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228078">
						August 2, 2014 3:49 PM					</a>

				</p>

				<p>@ M.V.</p>
<p>So, you&#8217;re basically saying <a href="http://stewin.org/papers/dimvap15-stewin.pdf" rel="nofollow ugc">this</a> paper on DMA malware via USB is making false claims? 😛</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228079">

			<div class="comment by-herman ">

				<p class="commentcredit">

					<span class="commenter">Herman</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228079">
						August 2, 2014 4:16 PM					</a>

				</p>

				<p>This is just another trojan/virus delivery method.  The effect on a system will be limited if there is proper separation between users and administrators and if RBAC or MAC is enforcing.</p>
<p>So, Enterprise Linux and Mac users do not have much to fear from this and Windows Enterprise users with a properly configured security profile and RBAC will probably be OK too.</p>
<p>It is therefore mainly the el&#8217;cheapo Windows versions without Rights Management and RBAC that is endangered and the big issue is that most people have no idea what the differences between el&#8217;cheapo Windows and Enterprise Windows are.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228080">

			<div class="comment by-m-v ">

				<p class="commentcredit">

					<span class="commenter">M.V.</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228080">
						August 2, 2014 4:45 PM					</a>

				</p>

				<p>@ Nick P</p>
<p>They don&#8217;t claim that they used an USB device to launch the attack. Their DAGGER firmware requires what they call first party DMA, ie. PCIe card. They talk about USB only in the context of finding the URB (USB Request Block) to locate keystrokes.</p>
<p>USB uses third party DMA with the USB host controller as the 3rd party.</p>
<p>Using an ExpressCard is a realistc example for their attack. Just insert into the notebook and power it up. No need to actually boot the machine, just inject the malware and hide it away in the Intel ME.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228081">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228081">
						August 2, 2014 4:57 PM					</a>

				</p>

				<p>@ M.V.</p>
<p>Oops my bad. There&#8217;s still the problem that one must trust the implementation of the USB functionality. Experience with write protect shows that what they say it does and what it actually does can be very different.</p>
<p>So back to my mantra of dont trust the device in the design unless it proves it&#8217;s trustworthy.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228082">

			<div class="comment by-eric ">

				<p class="commentcredit">

					<span class="commenter">Eric</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228082">
						August 2, 2014 4:58 PM					</a>

				</p>

				<p>I remember reading about a G20 summit last year in Russia &#8211; how phone chargers were handed out to people right and left, but that the chargers themselves were USB and contained exactly this sort of malware that could in turn infect your phone.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228083">

			<div class="comment by-thoth ">

				<p class="commentcredit">

					<span class="commenter">Thoth</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228083">
						August 2, 2014 7:59 PM					</a>

				</p>

				<p>What would be the most efficient and safe way to transfer files if USB methods are now considered bad and unsafe ?</p>
<ul>
<li>Secure network transfers ?</li>
<li>Rewritable optical disk ?</li>
<li>Back to floppy era ?</li>
<li>Manually copy hexcodes or base64 by hand&#8230;.</li>
</ul>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228084">

			<div class="comment by-scott-sfitcs-ferguson ">

				<p class="commentcredit">

					<span class="commenter"><a href='https://scottferguson.com.au' rel='external nofollow ugc' class='url'>Scott &quot;SFITCS&quot; Ferguson</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228084">
						August 2, 2014 10:06 PM					</a>

				</p>

				<p>@Herman</p>
<blockquote><p>
<cite><br />
The effect on a system will be limited if there is proper separation between users and administrators and if RBAC or MAC is enforcing.</cite>
</p></blockquote>
<p>No. DAC and MAC are layers above the USB subsystem. If the USB device ID database matches the device characterstics of your keyboard, the system will treat the device as a keyboard. If the device leverages insecurities in the USB subsystem RBAC will have no effect. Neither will SE Linux.</p>
<blockquote><p><cite><br />
So, Enterprise Linux and Mac users do not have much to fear from this and Windows Enterprise users with a properly configured security profile and RBAC will probably be OK too.</cite>
</p></blockquote>
<p>So, no &#8211; that is incorrect.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228085">

			<div class="comment by-scott-sfitcs-ferguson ">

				<p class="commentcredit">

					<span class="commenter"><a href='https://scottferguson.com.au' rel='external nofollow ugc' class='url'>Scott &quot;SFITCS&quot; Ferguson</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228085">
						August 2, 2014 10:28 PM					</a>

				</p>

				<p>@Zig Fiedorowicz</p>
<p>&lt;</p>
<p>blockquote&gt;<br />
<cite><br />
If my understanding is correct, then I don&#8217;t see how you could write<br />
badusb firmware which would work across a wide range of devices. The<br />
firmware would not be binary code compatible between devices, no more<br />
than Intel machine code could run on an ARM processor.</cite></p>
<p>&lt;</p>
<p>blockquote&gt;</p>
<p>Correct &#8211; the &#8220;firmware&#8221; would not work across a wide range of devices. That&#8217;s a correct assumption even though it&#8217;s based on false logic.</p>
<p>Different dog to Herman&#8217;s misunderstanding (he &#8220;assumed&#8221; that the malware would be running as a user process and therefore subject to role-based permission restrictions, but same leg action (the possible reality is not bound by the false logic of the assumption).</p>
<p>USB attacks are not restricted to &#8220;one piece of malicious firmware&#8221; &#8211; there&#8217;s no reason they can&#8217;t use a library of firmware attacks.<br />
There&#8217;s no reason to assume attacks simply consist of replacing firmware with malicious code &#8211; it could overwrite sections of existing firmware replacing or adding functionality (even with space limitations code can be reorganised to add more functions), it could leverage undocumented functions/flaws in firmware and/or the USB subsystem, or (random culprit) the Windoof EHCI library, or a combination of those methods.<br />
I wouldn&#8217;t rule out buffer overflow exploits as part of the attack library either <i><sub>(<em>cough</em>Error -200361 and cousins<em>cough</em>)</sub></i>.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228086">

			<div class="comment by-scott-sfitcs-ferguson ">

				<p class="commentcredit">

					<span class="commenter"><a href='https://scottferguson.com.au' rel='external nofollow ugc' class='url'>Scott &quot;SFITCS&quot; Ferguson</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228086">
						August 2, 2014 10:38 PM					</a>

				</p>

				<p>@André Mello</p>
<p>&lt;</p>
<p>blockquote&gt;<cite><br />
I can&#8217;t see how what they describe is possible. I only have a basic understanding of the USB protocol, but, even if they can completely rewrite the firmware, how can the device take over the system and do whatever it likes with it, in a non-detectable, unfixable way?</cite><br />
<cite><br />
What seems to be the case, exchanging ideas with other people, is that the device pretends to be of HID class and uses keyboard and/or mouse input to exert control, inject code, etc. But no matter how fast it happens, it can still be detected and counteracted by an antivirus, or by the OS, and even if it&#8217;s not, it&#8217;s possible to create some form of hardware CAPTCHA to make sure a human is controlling the input. So that would still not be impossible to fix, even if not in an ideal way.<br />
</cite></p>
<p>&lt;</p>
<p>blockquote&gt;</p>
<p>Your keyboard is detected long before your antivirus is started.<br />
What rules do you propose that will prevent your OS from allowing a keyboard, while simultaneously (magically?) disallowing the fake keyboard?</p>
<blockquote><p><cite><br />
As far as I know, the device has no active control of its host,<br />
</cite></p></blockquote>
<p>Unless it leverages that control using flaws in firmware, drivers, or other parts of the OS&#8230;.<br />
The absence of knowledge is not proof of absence.</p>
<blockquote><p><cite><br />
So code execution would only be possible via an implementation flaw in the kernel driver, which is how it&#8217;s been done so far. The Wired article implies the researchers achieved a way to do that using just the USB specification, but if that&#8217;s really it, it blows my mind.</cite></p></blockquote>
<p>It&#8217;d &#8220;blow my mind&#8221; if the drivers, sub-system, and firmware did <b>not</b> have many major exploitable flaws. Some of them deliberate.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228087">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228087">
						August 2, 2014 10:43 PM					</a>

				</p>

				<p>@ Thoth</p>
<p>There isn&#8217;t a provably secure way to transfer files via software on an architecturally insecure machine. However, there are methods that reduce risk. The classic option is using a <a href="https://en.wikipedia.org/wiki/Guard_(information_security)" rel="nofollow ugc">guard</a>. They&#8217;re used, for example, on moving data between physically isolated networks of different classification levels. The guard just needs I/O to computers, maybe do crypto, run checks on the data, scrub potential covert storage channels, and is special-purpose enough to be built to high assurance standards. There&#8217;s been mail, network, and even web application guards with first two done to high assurance by some products. One can remove the DMA risk by using a high-speed PIO device that has no DMA. I once hacked a solution with IDE cables in PIO mode. Or one can leverage a microcontroller, FPGA, etc to build a custom I/O chip on the guard and each endpoint. You can ensure it has DMA, but what&#8217;s controlling it is secure. Or has an IOMMU.</p>
<p>The simplest guard is an embedded board with PIO, connections to the computers, and running a microkernel OS with carefully written drivers. OpenBSD on a more powerful embedded board or even old school server with certain Open Firmware changes can do as well. Worst case scenario, a regular computer with open BIOS and Linux with assurance enhancing extensions (eg SVA-OS, SMACK). Remove any piece of code from the system you don&#8217;t need. If it has to be there to compile, just change the code to return successfully instead of doing something. 😉 Just make sure that the application level of it uses no dynamic memory allocation, gets size/hash before hand, consistently checks timing to know if device is stalling on transfer, and does bounds checks on arrays/buffers.</p>
<p>Now, if we&#8217;re talking just normal computers, you have to decide what you&#8217;re use case is. Are we talking computers that were connected in some way to the Internet? If they were, then assume they might get hit with malware at some point. We&#8217;re mostly back to &#8220;no way to say they&#8217;re secure.&#8221; However, there&#8217;s still some risk reduction here. One is to apply an integrity check to what you&#8217;re sending, then send it via a reliable UDP-based protocol (eg UDT) while blocking TCP in the kernel. IP and UDP implementations rarely have flaws compared to TCP and similarly complex protocols. Plus, the UDP-based protocols tend to execute at application layer, meaning they&#8217;re in user-mode and you can write the code in a safe way yourself.</p>
<p>Last idea is one I came up with and posted here relatively recently [I think]. The method is to create a computer that&#8217;s essentially an external device you plug into a normal PC that can access its memory. There&#8217;s various PCI and USB embedded boards that might be used for this. The system runs simple, hardened, security focused software that basically moves files. It might have IOMMU-backed DMA or PIO. Like with the guard, it can be told to receive a file while doing it carefully with custom, highly-assured code. It will deliver that file on another machine similarly. This is more like a user&#8217;s normal experience with moving files than a typical guard. It might also be fairly cheap for the hardware and perform decent. The slower PIO&#8217;s I did a while back were faster than 10Mbps Ethernet by almost double. So, it&#8217;s not Gigabit but you&#8217;ll live.</p>
<p>Note: And if it&#8217;s an air gapped machine, assuming you&#8217;ve done that correctly, you can move files <em>from</em> it using write once CD&#8217;s or DVD&#8217;s. Moving files <em>to</em> it you&#8217;re trusting quite a bit of code you might not even know exists. Hence me bringing up things such as guards and secure pluggable transfer devices. If they sound complex, you&#8217;d be overwhelmed seeing what people do to securely receive input that might affect anything from microcode to application. Guards are child&#8217;s play in comparison to <em>that</em> job. 😉</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228088">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228088">
						August 2, 2014 10:50 PM					</a>

				</p>

				<p>@ Scott</p>
<p>Nice comments. The layer below a given piece of software that can affect its operation is <em>always</em> a link in that software&#8217;s security chain. Which we INFOSEC pro&#8217;s call TCB. Also&#8230;</p>
<p>&#8220;I regret that I am currently too busy to take on more clients, watch this page (and the News page) for updates. In the meantime I am offering domain registration services &#8211; and will continue to provide existing clients with the same high levels of service (of course!)&#8221;</p>
<p>&#8230;I see you&#8217;re other work is going quite well. I think that&#8217;s the best apology I&#8217;ve ever seen on a web site. 😉</p>
<p>Note: There was once site whose &#8220;hamster-powered servers&#8221; went down occasionally with pictures of exhausted and adorable hamsters hamsters. I think that was the first I really laughed at which wasn&#8217;t a hacker forum or something like that.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228089">

			<div class="comment by-buck ">

				<p class="commentcredit">

					<span class="commenter">Buck</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228089">
						August 2, 2014 10:52 PM					</a>

				</p>

				<p>@Thoth</p>
<p>If it&#8217;s a simple answer you&#8217;re after&#8230;<br />
Use a custom combination of your own and others&#8217; techniques! Abandon all hopes of &#8216;one-size-fits-all&#8217; security solutions (magic boxes and services). Reassume your own authority! If one is to cede their own control (in any aspect of life), it seems to be very hard to reattain&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228090">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228090">
						August 2, 2014 11:13 PM					</a>

				</p>

				<p>@ Buck</p>
<p>He could always hand-enter the stuff by using a hex-editor on both machines. That he coded himself in assembler. On an assembler live CD version of KolibriOS. You get machine level control and safe data movement!</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228091">

			<div class="comment by-buck ">

				<p class="commentcredit">

					<span class="commenter">Buck</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228091">
						August 2, 2014 11:32 PM					</a>

				</p>

				<p>@Nick P</p>
<p>Seems appropriate enough 😉<br />
Or perhaps we should ponder more on the types of files that Thoth wishes to transfer&#8230; If we&#8217;re talkin&#8217; keymat here, I could certainly come up with plenty more guarded possibilities than the options we&#8217;ve been provided&#8230; Perhaps an air-gapped printer/scanner combo with some home-brewed recognition software could provide for a more fruitful solution..? Even a Morse-coded message sent in the clear has more of my trust than any &#8216;trusted&#8217; method of &#8216;secure&#8217; mass communication.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228092">

			<div class="comment by-scott-sfitcs-ferguson ">

				<p class="commentcredit">

					<span class="commenter"><a href='https://scottferguson.com.au' rel='external nofollow ugc' class='url'>Scott &quot;SFITCS&quot; Ferguson</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228092">
						August 3, 2014 12:05 AM					</a>

				</p>

				<p>@Nick P</p>
<blockquote><p><cite></p>
<p>@ Scott</p>
<p>Nice comments. The layer below a given piece of software that can affect its operation is *always* a link in that software&#8217;s security chain. Which we INFOSEC pro&#8217;s call TCB. Also&#8230;<br />
</cite></p>
<blockquote><p>
&#8220;I regret that I am currently too busy to take on more clients, watch this page (and the News page) for updates. In the meantime I am offering domain registration services &#8211; and will continue to provide existing clients with the same high levels of service (of course!)&#8221;
</p></blockquote>
<p><cite><br />
&#8230;I see you&#8217;re other work is going quite well. I think that&#8217;s the best apology I&#8217;ve ever seen on a web site. 😉<br />
</cite><br />
<cite><br />
Note: There was once site whose &#8220;hamster-powered servers&#8221; went down occasionally with pictures of exhausted and adorable hamsters hamsters. I think that was the first I really laughed at which wasn&#8217;t a hacker forum or something like that.</cite></p></blockquote>
<p>Thanks. 🙂</p>
<p>Then you may find this informative:-<br />
<a href="https://scottferguson.com.au/cloud/cloud.htm" rel="nofollow ugc">https://scottferguson.com.au/cloud/cloud.htm</a></p>
<p>Or the (Delphic) Oracle function. Ask a question phrased as a web page and receive an answer. e.g. When is Bruce wrong? is:-<br />
<a href="http://scottferguson.com.au/when_is_bruce_wrong.html" rel="nofollow ugc">http://scottferguson.com.au/when_is_bruce_wrong.html</a></p>
<p>;p</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228093">

			<div class="comment by-scott-sfitcs-ferguson ">

				<p class="commentcredit">

					<span class="commenter"><a href='https://scottferguson.com.au' rel='external nofollow ugc' class='url'>Scott &quot;SFITCS&quot; Ferguson</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228093">
						August 3, 2014 12:29 AM					</a>

				</p>

				<p>@Nick P</p>
<blockquote><p><cite><br />
@ Thoth</cite><br />
<cite><br />
There isn&#8217;t a provably secure way to transfer files via software on an architecturally insecure machine.<br />
</cite></p></blockquote>
<p>(IMO)</p>
<p>Secure yes. Secret no.<br />
Any secure encryption mechanism is the basis of moving data securely between machines by <b>any</b> method. The integrity of the transfer mechanism should not reduce the security of proper encryption. Relying on the mechanism is to trust the messenger <b>instead</b> of trusting the message (outsourcing responsibility with it&#8217;s attendant failings).</p>
<p>Trying to select a transfer mechanism that <i>can</i> be trusted to preserve the privacy of the data being transferred is probably impossible using current protocols and hardware found on PCs. But securely encrypted data <i>can</i> be securely transferred even with untrusted tranfer methods/on untrusted hardware.</p>
<p>Either trust is &#8216;proven&#8217; or it&#8217;s &#8216;assumed&#8217; (conflating &#8216;faith&#8217; and &#8216;fact&#8217;). We can &#8216;place&#8217; faith in something&#8230;. but if that faith is misplaced it <b>can</b> bite at some point. So it&#8217;s safer to place your faith (unless you have proven the security &#8211; it&#8217;s just faith) in secure encryption than secure transfer mechanisms.</p>
<p>Verification of encryption is less difficult than verification of hardware/drivers/firmware etc.</p>
<p>That&#8217;s not to say we shouldn&#8217;t explore more secure transfer mechanisms, only that even with secure transfer methods it would be a security mistake to rely on them alone to protect the data.<br />
If the data is a vehicle and the transfer mechanism is the yard &#8211; Lock the vehicle <b>and</b> the yard. But start by securing the vehicle and don&#8217;t rely on the yard alone to secure the vehicle.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228094">

			<div class="comment by-q ">

				<p class="commentcredit">

					<span class="commenter">Q</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228094">
						August 3, 2014 1:52 AM					</a>

				</p>

				<p>Datadiodes will prevent USB attacks, see eg. <a href="https://wuala.com/FreemoveQuantumExchange/Aspects/Tools/Certification%20Report%20NSCIB-CC-09-11025-CR2.pdf" rel="nofollow ugc">https://wuala.com/FreemoveQuantumExchange/Aspects/Tools/Certification%20Report%20NSCIB-CC-09-11025-CR2.pdf</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228095">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228095">
						August 3, 2014 4:37 AM					</a>

				</p>

				<p>@ Q,</p>
<p>The problem with datadiodes like any other guard mechanism is that they to may have &#8220;bugs&#8221; by design or lack of design.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228096">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228096">
						August 3, 2014 6:48 AM					</a>

				</p>

				<p>@ Thoth,</p>
<blockquote><p>What would be the most efficient and safe way to transfer files if USB methods are now considered bad and unsafe ?</p></blockquote>
<p>Firstly what do you mean by &#8220;efficient&#8221; and &#8220;safe&#8221;?</p>
<p>As I&#8217;ve pointed out one or two times on this blog there are issues with efficiency when it comes to security. Whilst it is possible to have a secure system for many things in general the more efficient you try to make it the more likey it is to leak information via the opening of inadvertent side channels.</p>
<p>These side channels can be time based or power based or several other domains, the more efficient a device is in any given domain then the more transparent it is to side channels in that domain.</p>
<p>Further what is often overlooked in designs is that even transmit channels from a secure device can be used as input channels to it, by the down stream receiver simply manipulating the error handeling mechanism. Thus all reliable communications channels are bi-directional, a transmit channel also receives and a receive channel also transmits. Not just at the device interface but due to the device transparency through it to other devices two or more steps away in either direction.</p>
<p>All guard mechanisms are susceptible to these issues, it&#8217;s how you manage them which reduces the problem, but generally the managment of them limits the likes of bandwidth or increases delay, both of which most users find unacceptable&#8230; It&#8217;s this user issue that the likes of skilled adversaries rely on to exploit guards and similar systems.</p>
<p>I have seen a system which was &#8220;locked down&#8221; where it was supposadly not possible to send information up stream only down stream. However I found it was possible to manipulate the down stream channel such that the error handeling mechanism in the down stream device could be activated. This in turn got reflected back into the device and activated it&#8217;s error correction mechanism which in turn affected the upstream device error correction mechanism. Thus it was by using this reflection possible to send information back up stream&#8230;</p>
<p>This demonstrates another issue that even most EmSec designers do not think about, which is an active device is also a transducer and can take information leaked in one channel domain that is pushed into it and push the information out in a different channel domain. Thus activating the error correction mechanism would effect not just the time domain but the power domain as well. This is similar to the issue in the RF analogue domain where limiting amplitude information translates it into phase information, thus the information still gets past the limiter&#8230;</p>
<p>It can be shown that you cannot shut down these covert channels or stop the transparency or translation of information from one domain to another, all you can actually do is limit the amount of information they leak (bandwidth) and how long it takes to get out (delay).</p>
<p>Obviously knowing this reflects on your view / interpretation of &#8220;safe&#8221;.</p>
<p>But you also have to ask not just what you mean by safe but at what level in Human-Commputer-Communications (HCC) stack.</p>
<p>For instance you meet somebody in person and as covertly as possible exchange credentials to establish a trust mechanism. Once that person is out of your sight you have no knowledge of what they do with the credentials. Thus reliable trust cannot be established, you always have to suspect the other person has either accidently or deliberatly disclosed the credentials. Thus you cannot consider the trust mechanism as safe by a lot of human values.</p>
<p>We have seen this failure with &#8220;code signing&#8221; if the holder of the private key loses control of it or inadvertently signs bad code with it or any one of a number of other security failures then you end up with bad code on your system.</p>
<p>Similar considerations apply at all levels of the HCC stack, thus &#8220;safety&#8221; is at best a relative measure at all those levels.</p>
<p>As I&#8217;ve mentioned before I&#8217;ve a number of old systems including 486s, and I have a number of different microcontroler development platforms all of which have serial communications on them. I can and do configure these to create guards and store and forward pumps with various checking and oversight mechanisms in them. I further restrict any information to be transfered to &#8220;plain human readable text&#8221; and subject this to certain sanitation processes (such as white space and non alpha char sanitation). Is this safe, well not entirely but it&#8217;s safer than many other methods when trying to keep issues off of an otherwise air gapped and fairly physicaly secure system (it is as I&#8217;ve mentioned befor in a safe, in a RF cage, in a secure room in guarded premises).</p>
<p>Whilst this is overkill for most purposes there are some things such as KeyMat generation and managment where it is a sensible precaution. However for some people this is almost irresponsibly unsafe for they requirments and they will have all sorts of other mechanisms both physical and otherwise on top of this.</p>
<p>Obviously such mechanisms get geometricaly more expensive and difficult to use, so knowledge of this further effects your view / interpretation of &#8220;safe&#8221; or what is &#8220;acceptably safe&#8221;.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228097">

			<div class="comment by-czerno ">

				<p class="commentcredit">

					<span class="commenter">Czerno</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228097">
						August 3, 2014 9:11 AM					</a>

				</p>

				<p>@Clive re: back channels, information leaks&#8230;</p>
<p>Wow ! A 700+ words Clive post, the usual style and type of content but <em>without</em> the usual spelling/grammar mistakes ! Talk of a back channel : I&#8217;d infer you switched from hand held devices to a <em>real</em> computer+keyboard !</p>
<p>That, or switched drugs   ;=)</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228098">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228098">
						August 3, 2014 10:44 AM					</a>

				</p>

				<p>@ Czerno, Moderator, Bruce,</p>
<p>Err neither,</p>
<p>I&#8217;ve had some probs with posting causing time outs at the server end.</p>
<p>Well I played around with the browser and phone including turning off the mechanical keyboard and gone to on screen kby, which for some reason has to have the spell checker on (all of which slows things down 🙁</p>
<p>Well none of it had any effects on the time out issue&#8230;</p>
<p>Further investigarion with an O&#8217;scope and wideband receiver showed there was issues arising from timing in the network. I lodged a complaint along with the relevent timing information and told them to chuck it to third line support not the phone ape hangers and sort it out&#8230;</p>
<p>Well the problem has gone away without changes at my end and I assume the surver as well. So it appears the service providers have sorted their act &#8211;or new snoopware&#8211; out. But so far&#8230;. no response from either the technical or turd line support at EE (which was T-mobile a moon or so ago).</p>
<p>So the question is do I turn the mechanical KBY back on again and speed things up by turning the spell checker off 😉</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228099">

			<div class="comment by-zig-fiedorowicz ">

				<p class="commentcredit">

					<span class="commenter">Zig Fiedorowicz</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228099">
						August 3, 2014 3:35 PM					</a>

				</p>

				<p>@ Scott</p>
<p>So the malicious firmware code would need to use some other vulnerability in the host<br />
to inject &#8220;alien&#8221; machine code to execute somewhere on the host system. If it is the usual<br />
kind of vulnerability in the OS or some other software running on the host CPU, then this is<br />
nothing really new and would be mainly of interest to 3-letter agencies trying to<br />
penetrate an air-gapped high value target.</p>
<p>The only way this would be something radically different is if the Berlin researchers<br />
found a vulnerability in the software in the microcontroller running<br />
Intel&#8217;s Manageability Engine in the host computer, which has direct memory access<br />
to the host&#8217;s RAM. In that case the usb firmware might be able to inject malicious<br />
code into the Intel microcontroller and such an exploit would be invisible to the<br />
OS or any other software running on the host CPU. In that case the only remedy<br />
might be to replace the motherboard with one whose ME microcontroller has been fixed.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228100">

			<div class="comment by-peter-barnhart ">

				<p class="commentcredit">

					<span class="commenter">Peter Barnhart</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228100">
						August 3, 2014 7:13 PM					</a>

				</p>

				<p>I came across the following blog by accident, it contains details on how<br />
to commandeer the USB firmware &#8211; dated October 9, 2012<br />
<a href="http://travisgoodspeed.blogspot.com/" rel="nofollow ugc">travisgoodspeed.blogspot.com/</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228101">

			<div class="comment by-scott-sfitcs-ferguson ">

				<p class="commentcredit">

					<span class="commenter"><a href='https://scottferguson.com.au' rel='external nofollow ugc' class='url'>Scott &quot;SFITCS&quot; Ferguson</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228101">
						August 3, 2014 11:37 PM					</a>

				</p>

				<p>@Zig Fiedorowicz • August 3, 2014 3:35 PM</p>
<blockquote><p><cite><br />
So the malicious firmware code would need to use some other vulnerability in the host<br />
to inject &#8220;alien&#8221; machine code to execute somewhere on the host system.<br />
</cite></p></blockquote>
<p>In many cases, no.</p>
<blockquote><p><cite><br />
If it is the usual kind of vulnerability in the OS or some other software running on the host CPU, then this is nothing really new and would be mainly of interest to 3-letter agencies trying to penetrate an air-gapped high value target.<br />
</cite></p></blockquote>
<p>Lacking your experience I <i>would</i> call it something new. Perhaps you could post some references to this &#8220;not new attack&#8221;.  🙂</p>
<p>I&#8217;m struggling to understand why &#8220;it&#8221; would <b>only</b> be of interest to &#8220;3-letter agencies&#8221; (and why ASIO/ASIS wouldn&#8217;t be interested).</p>
<p>Why do you believe this method would only target &#8220;air-gapped&#8221; machines of high value?</p>
<p>If you don&#8217;t understand the attack how can you declare it &#8220;nothing new&#8221; &#8211; or set parameters on it&#8217;s usefulness. Downplaying the unknown is illogical.</p>
<blockquote><p><cite><br />
The only way this would be something radically different is if the Berlin researchers<br />
found a vulnerability in the software in the microcontroller running<br />
Intel&#8217;s Manageability Engine in the host computer, which has direct memory access<br />
to the host&#8217;s RAM. In that case the usb firmware might be able to inject malicious<br />
code into the Intel microcontroller and such an exploit would be invisible to the<br />
OS or any other software running on the host CPU. In that case the only remedy<br />
might be to replace the motherboard with one whose ME microcontroller has been fixed.<br />
</cite></p></blockquote>
<p>The Berlin researchers have not made a full analysis of the attack, so it&#8217;s a little premature to state what the attack cannot use &#8211; don&#8217;t you think?<br />
At no point do they emphatically declare &#8220;there is no way this sort of attack could utilize iAMT DAGGER-style exploits&#8221;.</p>
<p>FYI there are other DMA based exploits. <sub><em>cough</em>Northbridge<em>cough</em></sub></p>
<p>Nor is it the only &#8220;invisible exploit&#8221;. Exploits of the Southbridge firmware by USB devices are theoretically feasible and <b>would be a logical inclusion in the arsenal</b> of a USB spoofing &#8220;smart&#8221; USB device.</p>
<p>To me it only strengthens the reasons to take NSA recommendations to use Intel with a large glass of IPECAC (and continue to take a skeptical view when reading nationalistically fervorous Gish Gallop defenses of the NSA (no matter how syncronistically ironic the pseudonym of the poster).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228102">

			<div class="comment by-thoth ">

				<p class="commentcredit">

					<span class="commenter">Thoth</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228102">
						August 4, 2014 3:17 AM					</a>

				</p>

				<p>What I meant was transferring data between host computers knowing that no surprises would be injected into the data I attempt to transfer, modify data or give some nasty bite.</p>
<p>Imagine you want to transfer your emails from your internet PC to your air gap via downloading the email text data, compress them and transfer them to another PC by whatever means and ensuring the means you use doesn&#8217;t betray you in anyway possible.</p>
<p>Transferring keymats is also another possibility.</p>
<p>Switching on both PCs and manually copying hexcodes is one way (probably much safer but more error prone ?).</p>
<p>Of course the fanciful guard devices and other fanciful techniques or even rewriting and rebuilding your own hardware and software stack and creating your custom hardware is another possibility but how practical is it ?</p>
<p>The question in regards I want to bring up is the list of possible options everyone have left on hand to go about their daily businesses and occasionally transfer sensitive materials or private materials safely. Now we know USBs can host a variety of problems, what options do we have left ?</p>
<p>From the responses I believe our only option left is just hand copy the hexcodes so that no surprises would spring up (some kind of malware &#8230; etc &#8230;) unless a malware modifies the hexcodes subtly ?</p>
<p>I guess, for the average user who are security conscious and tries to protect their own privacy and doesn&#8217;t like malwares and surprises to spring on them &#8230; it&#8217;s over for security for the general public ?</p>
<p>Is security and safety only exclusive for those who understand the underlying mechanics and not available for the security minded average joe ?</p>
<p>I am guessing even for those of us here whom have strong technical knowledge and know how, it&#8217;s impossible to keep themselves safe and secure too considering the uphill battle one faces trying to secure their own boundaries.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228103">

			<div class="comment by-scott-sfitcs-ferguson ">

				<p class="commentcredit">

					<span class="commenter"><a href='https://scottferguson.com.au' rel='external nofollow ugc' class='url'>Scott &quot;SFITCS&quot; Ferguson</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228103">
						August 4, 2014 4:53 AM					</a>

				</p>

				<p>@Thoth</p>
<blockquote><p><cite><br />
What I meant was transferring data between host computers knowing that no surprises would be injected into the data I attempt to transfer, modify data or give some nasty bite.<br />
</cite></p></blockquote>
<blockquote><p><cite><br />
Imagine you want to transfer your emails from your internet PC to your air gap via downloading the email text data, compress them and transfer them to another PC by whatever means and ensuring the means you use doesn&#8217;t betray you in anyway possible.<br />
</cite></p></blockquote>
<p>Verify the integrity of the data being transferred and obscure the data. Encrypt it.</p>
<p>If you can&#8217;t unencrypt the transferred data is <b>was</b> altered during the transfer process.<br />
If you can unencrypt the transferred data it was not altered and even if the hardware or the process was compromised you know the unencrypted data remains secret. Of course if the air-gapped machine is compromised so is the unencrypted data.</p>
<blockquote><p><cite><br />
Transferring keymats is also another possibility.<br />
</cite></p></blockquote>
<p>You have two boxes.<br />
One is medium security box connected to the internet. It&#8217;s susceptible to malware and other forms of spying.<br />
The other is a high security box kept disconnected from the internet (air-gapped).</p>
<p>Transferring classified data (keyrings etc) from a box that is known to be less secure, to a box that is more secure has obvious risks. If you <i>must</i> move classified data from untrusted to trusted then you must encrypt it (and reassess the security rating of the air-gapped box). SOP101.</p>
<blockquote><p><cite><br />
Switching on both PCs and manually copying hexcodes is one way (probably much safer but more error prone ?).<br />
</cite></p></blockquote>
<p>It&#8217;s one way of transferring data &#8211; not practical (though it sounds good, to the ignorant). It&#8217;s not safer (than what?). Probably or no probably.</p>
<blockquote><p><cite><br />
Of course the fanciful guard devices and other fanciful techniques or even rewriting and rebuilding your own hardware and software stack and creating your custom hardware is another possibility but how practical is it ?<br />
</cite></p></blockquote>
<p>As practical as buying special clothes and booking a haircut for the Rapture?</p>
<p>Your question has flawed logic &#8211; as it presupposes hardware is the answer to the question (sophistic).</p>
<p>The correct question is why don&#8217;t you encrypt classified data?</p>
<p>It&#8217;s a simple question that everyone who loses control of their security fails to adequately answer.</p>
<blockquote><p><cite><br />
The question in regards I want to bring up is the list of possible options everyone have left on hand to go about their daily businesses and occasionally transfer sensitive materials or private materials safely. Now we know USBs can host a variety of problems, what options do we have left?<br />
</cite></p></blockquote>
<p>The same options you&#8217;ve always had &#8211; those you&#8217;ve ignored to your peril.</p>
<ol>
<li>
Plan your security processes.</li>
<li>
Implement your plan.</li>
<li>
Practise proper Operating Procedures.</li>
<li>
Encrypt your classified data.</li>
</ol>
<p>I&#8217;m constantly astounded by the amount of energy people will invest in complicated schemes to try and mitigate the risks they moronically take on by refusing to <b>encrypt</b> their data. Sadly, laziness and stupidity don&#8217;t adequately explain the phenomena.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228104">

			<div class="comment by-thoth ">

				<p class="commentcredit">

					<span class="commenter">Thoth</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228104">
						August 4, 2014 8:27 AM					</a>

				</p>

				<p>@Scott Ferguson</p>
<p>You said:<br />
&#8220;I&#8217;m constantly astounded by the amount of energy people will invest in complicated schemes to try and mitigate the risks they moronically take on by refusing to encrypt their data. Sadly, laziness and stupidity don&#8217;t adequately explain the phenomena.&#8221;</p>
<p>That&#8217;s the common idea many of us down here have but not for the people out there who dont have any awareness, interest nor patience with security. If you ask them (non-security people) to key in a password, it is as good as a thorn in the side for them&#8230; let alone doing anything more secure.</p>
<p>I do not think hardware nor software alone is the problem. In fact, I think the problem is riddled everywhere. Softwares have their problems (insecure codes and all that backdoor stuff), hardwares aren&#8217;t always that secure (mostly insecure), human processes can be rather complicated especially if you begin to scale processes into organisations and departments where each portion of an organisation may have their own policies or even on a national level. On the individual level, the effort to install and setup your secure environment is far more tedious (not just a little more tedious).</p>
<p>I guess amongst all these revelations of security vulnerability, have we not asked ourselves what we can change and adapt comfortably enough and the level of security we are willing to trade off. A totally secure solution is possible but not going to be easily deployed widely and adapted by many.</p>
<p>I think you somehow miss the point because your SOP101 if you ask a journalist to do it (e.g. Glenn Greenwald), he might simply scratch his head yet again. Let alone hardware and software customizations (out of question) for Glenn Greenwald.</p>
<p>What I am asking are possible easy to use turnkey solutions for people (especially non-techies) to quickly deploy and not wade through the mess of technicalities reserved for technical people like us.</p>
<p>Here&#8217;s my first shot at it:<br />
1.)   Use writable optical disk. Hash data content and use visual checks for correct data hash. Of course, zip before encrypting data content if needed.</p>
<p>More contributions and comments are welcomed.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228105">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228105">
						August 4, 2014 8:28 AM					</a>

				</p>

				<p>@ Thoth, Scott,</p>
<p>As I said the problem is multi-level in the HCC stack, and any solution needs to address all the relevant levels.</p>
<p>Just saying,</p>
<p><i></p>
<ul>Verify the integrity of the data being transferred</ul>
<p></i></p>
<p>Is easy in practice it&#8217;s actually very hard to impossible to do.</p>
<p>There are three basic forms of message that you need to deal with,</p>
<p>1, Unverified.<br />
2, Verified by a semi trusted or untrusted source.<br />
3, Verified by a supposedly trusted source.</p>
<p>From the above it can easily be seen that you have to verify or reject any message prior to copying it for being moved onto the secure system.</p>
<p>You not only have to check the message as a whole but the individual components within thus the process can be fraught with difficulties.</p>
<p>Take case 2 above this covers the likes of patches from software vendors, like it or not they are a necessity of modern computing. Some vendors assume you have never installed their patches so that each patch they supply is a monolithic archive of all previous patches. The reality is it is beyond just about every one to break these 20MByte archives up and verify each individual component.</p>
<p>Even when a modest message arives from a supposedly trusted source, you still have to verify what you get, not to do so is asking for trouble. Afterall the credentials could have been stolen or the person subject to duress. Dealing with this is difficult if not impossible unless certain precautions are in place prior to the trust relationship being established. Some of these precautions are purely human in nature, as one gangster was heard to remark, he would only trust people who had a lot lot more to lose than he did.</p>
<p>As for the communication link, either you only send plain text with white space and non alphas sanitized or you should either encrypt or encode the incoming message such that if it&#8217;s been bobby traped in some way for the low level comms hardware it won&#8217;t work.</p>
<p>I could go on at length about what you should consider doing at the various levels, but this would be not a blog post but the basis for around five chapters in a book.</p>
<p>But as I said before the required resourses of this sort of security suffers from exponential increase for even a moderate increase of security so your first steps are to analyse your situation not just technically but in terms of loss if the technical solutions fail.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228106">

			<div class="comment by-q ">

				<p class="commentcredit">

					<span class="commenter">Q</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228106">
						August 4, 2014 9:46 AM					</a>

				</p>

				<p>@Clive Robinson • August 3, 2014 4:37 AM</p>
<p>Quote: <code>The problem with datadiodes like any other guard mechanism is that they to may have "bugs" by design or lack of design.</code></p>
<p>This is not a (scientific) argument. Any system always may or may not have ¨bugs¨.</p>
<p>In the future a more fundamental theory then Quantum Theory may be discovered.</p>
<p>This does not imply that Quantum-Theory does not hold, even after a more fundamental theory then quantum-theory is discovered.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228107">

			<div class="comment by-scott-sfitcs-ferguson ">

				<p class="commentcredit">

					<span class="commenter"><a href='https://scottferguson.com.au' rel='external nofollow ugc' class='url'>Scott &quot;SFITCS&quot; Ferguson</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228107">
						August 4, 2014 10:13 AM					</a>

				</p>

				<p>@Thoth</p>
<blockquote><p><cite><br />
@Scott Ferguson<br />
</cite><br />
<cite><br />
You said:</cite></p>
<blockquote><p>
&#8220;I&#8217;m constantly astounded by the amount of energy people will invest in complicated schemes to try and mitigate the risks they moronically take on by refusing to encrypt their data. Sadly, laziness and stupidity don&#8217;t adequately explain the phenomena.&#8221;
</p></blockquote>
<p><cite><br />
That&#8217;s the common idea many of us down here have but not for the people out there who don&#8217;t have any awareness, interest nor patience with security. If you ask them (non-security people) to key in a password, it is as good as a thorn in the side for them&#8230; let alone doing anything more secure.<br />
</cite></p></blockquote>
<p>Security is not magic. Without proper Operating procedures there is no security.<br />
Laziness will always be a major market segment for those that profit from the gullible.</p>
<blockquote><p><cite><br />
I think you somehow miss the point because your SOP101 if you ask a journalist to do it (e.g. Glenn Greenwald), he might simply scratch his head yet again. Let alone hardware and software customizations (out of question) for Glenn Greenwald.</cite></p></blockquote>
<p>Speaking of missing the point&#8230;.<br />
Failure to practise proper OPSec is the problem. That Glenn, in your example, can&#8217;t be bothered learning or practising it, just confirms my point. No need to make excuses for him.</p>
<p>Wirewalking is dangerous. Practiced properly it&#8217;s not particularly dangerous. Just because someone can&#8217;t be bothered doing the training and exercising appropriate discipline doesn&#8217;t make it less dangerous.<br />
If you want to walk a wire across the Grand Canyon &#8211; research it, plan it, and if that plan proves too risky &#8211; <b>do not do it</b>.<br />
Just because &#8220;everyone&#8221; is wire walking the Grand Canyon doesn&#8217;t mean we have to try and develop technology to make it safe &#8211; or lobby the government to remove all sharp corners and potential impacts from the world (that would just lower the standards).</p>
<p>Unfortunately everyone wants to surf the web &#8211; in their underwear &#8211; and they want to extend the privacy they expect in their bedroom to anywhere they connect with their browser. Did I mention they want to do it now (actually now was twenty mouse clicks/taps ago)? Poor impulse control is another factor in bad security. Change control is not.</p>
<blockquote><p><cite><br />
What I am asking are possible easy to use turnkey solutions for people (especially non-techies) to quickly deploy and not wade through the mess of technicalities reserved for technical people like us.<br />
</cite></p></blockquote>
<p>No. And not likely to be any in the near future (though many companies are betting they can sell something as &#8220;that&#8221; real soon).</p>
<p>Security is a chain. The weakest link in many cases is the meatbag at either end of it.<br />
Of course the &#8220;iwanna&#8221; factor will ignore that, and search endlessly for magical solutions (that validate their hard-earned ignorance).</p>
<p>It&#8217;s too hard. I don&#8217;t want to learn. I don&#8217;t have the time (to learn what I don&#8217;t know and therefore <b>cannot</b> know how long it will take to learn). etc. etc.<br />
These are not reasons. They are excuses. The problem is psychological &#8211; not physical or technical. Sort of a &#8220;dear interweb do my homework&#8221;/&#8221;I demand you make Open Source my way&#8221; thing, where impulse and selfishness trumps logic, discipline, and effort.</p>
<blockquote><p><cite><br />
Here&#8217;s my first shot at it:<br />
1.) Use writable optical disk. Hash data content and use visual checks for correct data hash. Of course, zip before encrypting data content if needed.<br />
</cite></p></blockquote>
<p>If you&#8217;re encrypting the data, later hashing and visually checking is redundant. But don&#8217;t forget to check the CD itself (md5sum or gpg signature).</p>
<p>RAR/Zip is only necessary to get around Joliet limitations and allow gpg encryption of multiple files. Compression <b>is</b> part of the encryption process (e.g. with gpg/pgp).</p>
<ol>
<li>
Tar your data (or zip/rar the directory it&#8217;s in)</li>
<li>
Encrypt the archive <i>gpg &#8211;clearsign classified.tar.bz2</i></li>
<li>
Make a note of the last few characters of the fingerprint <i>tail -n 2 &lt; classified.tar.bz2.asc | head -n 1</i></li>
<li>
Transfer the encrypted data to a CD <b>image</b></li>
<li>
Write the last few characters of the archive fingerprint on the CD</li>
<li>
Image the burnt CD <i>dd if=/dev/sr0 of=~/cd.iso</i></li>
<li>
You can md5sum or create a detached gpg signature for the iso image if you wish. Write the last 4 characters of either onto the CD.</li>
<li>
Burn the CD</li>
<li>
Move the CD to the air-gapped box</li>
<li>
Image the burnt CD and check it&#8217;s md5sum or the fingerprint of a detached signature against the original iso image.</li>
<li>
Copy the encrypted data off the CD.</li>
<li>
Check the gpg fingerprint of the encrypted data.</li>
<li>
If all the checks done on the air-gapped box match the original checks &#8211; unencrypt and enjoy.</li>
</ol>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228108">

			<div class="comment by-scott-sfitcs-ferguson ">

				<p class="commentcredit">

					<span class="commenter"><a href='https://scottferguson.com.au' rel='external nofollow ugc' class='url'>Scott &quot;SFITCS&quot; Ferguson</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228108">
						August 4, 2014 10:43 AM					</a>

				</p>

				<p>@Clive Robinson</p>
<blockquote><p><cite><br />
@ Thoth, Scott,</cite></p></blockquote>
<blockquote><p><cite><br />
As I said the problem is multi-level in the HCC stack, and any solution needs to address all the relevant levels.</cite></p></blockquote>
<p>Yes &#8211; a solution to attacks that use the stack (and/or attacks that use built-in exploits in the Southbridge (knock knock?)).  So that attacks can&#8217;t intercept <b>unencrypted</b> data on disks or from mice and keyboards&#8230;.</p>
<blockquote><p><cite>Just saying,</cite></p>
<blockquote><p>
    Verify the integrity of the data being transferred
</p></blockquote>
<p><cite><br />
Is easy in practice it&#8217;s actually very hard to impossible to do.<br />
</cite></p></blockquote>
<p>I didn&#8217;t <i>just</i> say &#8220;it&#8221;.<br />
I said:-</p>
<blockquote><p><cite><br />
Verify the integrity of the data being transferred and obscure the data. Encrypt it.<br />
</cite></p></blockquote>
<p>and I said it in a specific context. Transferring data from one machine to another.</p>
<blockquote><p><cite><br />
Is easy in practice it&#8217;s actually very hard to impossible to do.</cite></p></blockquote>
<p><strong>How is gpg encrypting data for transfer to another machine &#8211; then decrypting the same data after transferring &#8211; &#8220;very hard to impossible to do&#8221;??</strong><br />
<strong><br />
Or are you saying that decrypting gpg is <b>not</b> verification that the data hasn&#8217;t been altered during the transfer??</strong></p>
<p>The only hard or impossible part is trusting the box you encrypt and decrypt on. Presume it is compromised (like a house that&#8217;s been burgled) &#8211; that doesn&#8217;t mean the encryption process has exploited (so even though my house <i>can</i> be burgled I&#8217;ll continue to use a gun safe). Nor is it grounds for not using encryption.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228109">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228109">
						August 4, 2014 10:45 AM					</a>

				</p>

				<p>@ Q,</p>
<p>It might not be a scientific argument, but it is currently a &#8220;fact of life&#8221; few with any knowledge of hardware and software industries would argue against. And there is a reasonable body of evidence produced by research that bears it out.</p>
<p>Personaly I think &#8220;correct by design&#8221; is like a search for the Holy Grail, mainly because we have imperfect knowledge. If you could change that then yes you might stand a chance of bug free, but I suspect a &#8220;meatbag in the loop&#8221; will still keep making mistakes&#8230;</p>
<p>As for the theories of natural philosophy, we know Newton was wrong, but his laws will still get you around the solar system with little problems. Many many years ago I was told &#8220;Physics is a series of lies each more accurate than it&#8217;s predecessor&#8230;&#8221;. And if you care to look at cosmic infation theory, you can see atleast on notable cosmologist questioning if the speed of light has always been a limiting constant.</p>
<p>As a Frenchman of note once commented &#8220;the more things change the more they stay the same&#8221;.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228110">

			<div class="comment by-scott-sfitcs-ferguson ">

				<p class="commentcredit">

					<span class="commenter"><a href='https://scottferguson.com.au' rel='external nofollow ugc' class='url'>Scott &quot;SFITCS&quot; Ferguson</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228110">
						August 4, 2014 11:08 AM					</a>

				</p>

				<p>@Thoth</p>
<blockquote><p><cite><br />
    @Scott Ferguson</cite></p></blockquote>
<blockquote><p><cite>You said:</cite></p></blockquote>
<blockquote><p><cite>&#8220;I&#8217;m constantly astounded by the amount of energy people will invest in complicated schemes to try and mitigate the risks they moronically take on by refusing to encrypt their data. Sadly, laziness and stupidity don&#8217;t adequately explain the phenomena.&#8221;</cite></p></blockquote>
<p>[snipped]</p>
<p><strong>Correction</strong>, this <i>should</i> have said:-</p>
<ol>
<li>
Tar your data (or zip/rar the directory it&#8217;s in)</li>
<li>
Encrypt the archive</li>
<li>
Delete the unencrypted data.</li>
<li>
Make a note of the last few characters of the fingerprint</li>
<li>
Burn the encrypted data to a CD</li>
<li>
Write the last few characters of the archive fingerprint on the CD</li>
<li>
Image the burnt CD</li>
<li>
You can md5sum or create a detached gpg signature for the iso image (if you wish). Write the last 4 characters of either onto the CD.</li>
<li>
Move the CD to the air-gapped box</li>
<li>
Image the burnt CD and check it&#8217;s md5sum or the fingerprint of a detached signature against the original iso image.</li>
<li>
Copy the encrypted data off the CD.</li>
<li>
Check the gpg fingerprint of the encrypted data.</li>
<li>
If all the checks done on the air-gapped box match the original checks &#8211; unencrypt with a high degree of trust that the data has not changed and remains as private as when you first encrypted it.</li>
</ol>
<p>(Movable Type doesn&#8217;t allow code quoting&#8230; sorry).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228111">

			<div class="comment by-scott-sfitcs-ferguson ">

				<p class="commentcredit">

					<span class="commenter"><a href='https://scottferguson.com.au' rel='external nofollow ugc' class='url'>Scott &quot;SFITCS&quot; Ferguson</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228111">
						August 4, 2014 11:14 AM					</a>

				</p>

				<p>@Thoth</p>
<blockquote><p><cite><br />
    @Scott Ferguson</cite></p>
<p><cite>  You said:</cite></p>
<p>        &#8220;I&#8217;m constantly astounded by the amount of energy people will invest in complicated schemes to try and mitigate the risks they moronically take on by refusing to encrypt their data. Sadly, laziness and stupidity don&#8217;t adequately explain the phenomena.&#8221;</p></blockquote>
<p>[snipped]</p>
<p><strong>Another correction!</strong>:-</p>
<ol>
<li>
    Tar your data (or zip/rar the directory it&#8217;s in)</li>
<li>
    <b>Encrypt</b> the archive <strong>do not use &#8211;clearsign, (I&#8217;ve been drinking).</strong></li>
</ol>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228112">

			<div class="comment by-tom ">

				<p class="commentcredit">

					<span class="commenter">Tom</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228112">
						August 4, 2014 3:55 PM					</a>

				</p>

				<p>Closed as &#8216;invalid&#8217; by Ubuntu over two years ago&#8230;<br />
<a href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/798858" rel="nofollow ugc">https://bugs.launchpad.net/ubuntu/+source/linux/+bug/798858</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228113">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228113">
						August 4, 2014 5:20 PM					</a>

				</p>

				<p>@ Thoth</p>
<p>&#8220;What I meant was transferring data between host computers knowing that no surprises would be injected into the data I attempt to transfer, modify data or give some nasty bite.</p>
<p>Imagine you want to transfer your emails from your internet PC to your air gap via downloading the email text data, compress them and transfer them to another PC by whatever means and ensuring the means you use doesn&#8217;t betray you in anyway possible.&#8221;</p>
<p>Thanks for clarifying. Scott&#8217;s many posts&#8217; main recommendation is to compress and GPG the data. It&#8217;s a good idea, but far from adequate. We must always remember that attackers will exploit any link in the chain. You are trying to send data from a possibly malicious machine to a trusted machine. If it&#8217;s <em>truly</em> one way, then your requirement is one of the easier problems to solve. Here&#8217;s your problems:</p>
<ol>
<li>The data itself might be leaked or modified.</li>
<li>The medium used to move the data might be attacked, such as protocol or firmware.</li>
<li>The data might contain a malicious payload that executes on your trusted machine. And this might be inserted in a way where you don&#8217;t realise it, nullifying the advantage of crypto. This has been done by black hats with PDF&#8217;s, Word files, music, movies, and so on. Easier with binary.</li>
<li>If the airgapped machine is taken over, it&#8217;s communications methods might be re-activated to stealthily leak data. That was in NSA TAO catalog.</li>
</ol>
<p>So, this is the problem in a nutshell. As it always has been, obscuring and tamperproofing the data itself is the easy part. And it&#8217;s rarely what they attack. Hackers will instead hit protocols, OS, viewer apps, firmware, and so on. So, the solution must be a total solution which also involves security features for your air gap machine.</p>
<p>CD/DVD Solution</p>
<p>I&#8217;m going to build on this first. The hosting computer shouldn&#8217;t have any wireless communications at all. Anything non-essential should be disabled in the BIOS, the BIOS locked, and ideally a flash protection feature (eg jumper based) built-in. Auto-run should be disabled if the system has it. The media itself should be write-once and finalized. The main drawbacks are that it costs a disc each time, it doesn&#8217;t allow useful two-way communication (eg update service), it&#8217;s very slow (CD/DVD writes), and it&#8217;s quite manual. The crypto is unnecessary with this design except to keep you from having to destroy the discs. Of course, it provides the advantage where you can have a dedicated password for these transfers that&#8217;s saved on each machine.</p>
<p>Note: The untrusted computer sending the files is assumed compromised. The crypto still blocks random third parties with the disc from getting the data. Dumpster diving is main threat vector here.</p>
<p>Network Solution (Low Assurance)</p>
<p>I mention this solution because you wanted a turnkey solution. There are commercial solutions specifically design to do this. They&#8217;re called &#8220;cross-domain solutions.&#8221; They usually run on guards. They can be quite easy to use and sometimes support (modified) protocols such as FTP or Windows Update. The commercial one&#8217;s are quite pricey.</p>
<p>The basic, cheap solution is to build your own. Fortunately, there are already <a href="http://www.techradar.com/news/software/applications/7-of-the-best-linux-firewalls-697177" rel="nofollow ugc">plenty</a> firewall distro&#8217;s specifically designed to do this. Take a firewall distro, put it on a cheap board, configure it for one-way networking over UDP, and then you just need an app that will send the packets. A more carefully written policy might allow TCP acknowledgements, but still be one way. The NRL Network Pump works this way albeit with an extra technique to prevent the ACK&#8217;s from being used as a timing channel. So, this is a basic solution that&#8217;s mostly point and click. I&#8217;m also sure even the policies and commands to execute to do what I describe (for UDP) are already online somewhere.</p>
<p>Firewall is easiest option due to use of existing software and potential automations with scripts. The next easiest (and more secure) option is a data diode. Again, there are commercial options of varying price and features. The good news is there are DIY <a href="http://www.synergistscada.com/building-your-own-data-diode-with-open-source-solutions/" rel="nofollow ugc">data diodes</a> for ethernet and fiber online. They essentially modify the cable to only send data one direction, then ensure the apps use them that way. The code receiving the data, the firmware of the medium, the apps executing it, and the layers below are still vulnerable, though.</p>
<p>Many also use serial cables to avoid DMA risk. Certain modifications must be made but the drivers are so simple to modify. I used an IDE because it had working drivers in about every OS, is cheap, can operate in non-DMA mode, and is over 100 times faster than serial. My recent work is basically a dedicated chip (or PCI board) containing and running only what I determine to be trustworthy.</p>
<p>Network or Diode Solution (Medium Assurance)</p>
<p>So, how do we eliminate (or reduce) those risks while avoiding all kinds of complexity in design, installation, etc. The absolute simplest strategy is to put OpenBSD on a simple embedded board. Connect both computers to it with serial ports. Configure OpenBSD&#8217;s firewall correctly. On trusted system, use OpenBSD, Linux with SELinux/SMACK, FreeBSD with Capsicum, or Solaris with Trusted Extensions. The point is you want an OS on the trusted machine that&#8217;s open, has resonable protections, has been source audited for years, fixes problems, has <em>simple</em> app isolation method, and has online guides for about everything.</p>
<p>The effective TCB of the transfer is OpenBSD&#8217;s networking code, serial driver, and parts of kernel they use. This is highest quality and most secure code in all of UNIX so that&#8217;s a good confidence rating. Serial port gives you no DMA and simplicity of driver, reducing risk. With more effort, you can <em>carefully</em> write apps that move the files through the serial port directly, bypassing network stack. The applications on trusted PC that use the data should be restricted with MAC policies, dedicated user accounts or sandboxes at the least. That reduces risks of attacks via the data itself.</p>
<p>Note: The Cambrige CHERI capability processor is designed for security and legacy compatibility. They&#8217;ve already put FreeBSD on the prototype. There are FreeBSD firewall distro&#8217;s. I plan to combine them with open Ethernet (and DMA) I.P. later on for a turn key solution that just needs a cheap FPGA board with networking. Clive just supplied links to boards so that knocks out one obstacle. 🙂</p>
<p>Network or Diode Solution (High Assurance)</p>
<p>Obviously tradeoffs here are too much for most users so I&#8217;ll leave this off. If they have money, there are numerous vendors (ex Fox, Nexor, Tenix) offering data diodes with supporting software. These were rigorously analyzed and pentested in order to achieve their EAL7 certifications. So, that covers the transfer part at least and is turnkey.</p>
<p>Conclusion</p>
<p>There are your options. One must consider the risks. Hopefully, a BSD/Linux with app isolation, a serial cable, and some Googling will do for you. Otherwise, there&#8217;s the firewall distro&#8217;s, diodes, sandboxes, and so on. You can choose the security and convenience tradeoff you want with the information I&#8217;ve given you. Just remember that each link in the chain must be secured. Primarily, the app/kernel on trusted machine receiving data, the data transmission medium, and extra requirement of ensuring no other mediums on trusted machine can be enabled.</p>
<p>Readers following along wanting to know where all the risks are can get a thorough treatment <a href="https://www.schneier.com/blog/archives/2013/01/essay_on_fbi-ma.html#c1102869" rel="nofollow ugc">here</a>. That&#8217;s the framework I&#8217;ve used for years in high assurance security work, which you can freely distribute so long as you give credit. It also discusses secure code vs secure systems as it was original topic in that thread.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228114">

			<div class="comment by-figureitout ">

				<p class="commentcredit">

					<span class="commenter">Figureitout</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228114">
						August 4, 2014 10:02 PM					</a>

				</p>

				<p>Thoth RE: post on 8/4/14 @ 3:17AM<br />
&#8211;I like this post b/c it strikes some core problems, head on.  Security, like winning, comes to those who want it the most and will obsessively work for it.</p>
<p>First things first, any data you want to keep more secure than even encrypted data on a machine (subject to transmissions via the the electrons buzzing around the keyboard, and the likely LCD/VGA/HDMI combo display you got going on), you keep it on paper.  Write on a mobile glass sheet that you wipe after each page, also scribble manically on a few sheets and tuck the data inbetween those incase there&#8217;s a way to chemically read the ink/graphite remotely (I bet there is&#8230;).  Never write the full message in one location, multiple ones.  You can communicate a meeting if you want to exchange via insecure methods (so they can find you), but due to mobile creation of the data it should be hard to get that w/o attacking you physically, in which case you need a quick destruction method or back-up plan&#8230;</p>
<p>I know this all sounds comical, and it is&#8230;I can count on my 2 hands the number of &#8220;bro&#8217;s&#8221; that&#8217;d follow this kind of OPSEC to exchange data.  They don&#8217;t get awkward w/ it, nor sad, it&#8217;s a reality and they&#8217;re willing to fight it.  Such is the reality today.  Now w/ the IoT, and tinier chips that use such low power, you&#8217;ll have harder times detecting them, insane signals, and they&#8217;ll be everywhere.  So a &#8220;secure&#8221; area to write becomes rarer, and only the older people who established certain protocols and codes w/ other people can exchange data, the younger people are f*cked and they&#8217;ll be too naive until they find out the hard way.</p>
<p>Otherwise, you can download that infected ISO from that infected website, w/ that malware that spoofs the check-sum, from your infected router, w/ infected programs to burn the CD/DVD, for your infected computer, infected keyboard, infected USB-radio mouse, infected USB flash drive.</p>
<p>That is, unless all self-respecting engineers/coders/cryptographers take back control of their domains from marketing and banks, and make our hardware/protocols, and most especially the software, respectable and trustworthy.  As in, openness all the way, knowledge spreading, and mistakes need to be scrutinized such that you&#8217;re a potential enemy if you make such a dumb mistake.</p>
<p>Nick P<br />
&#8211;One of your better posts in a long, long time.  Very practical, and w/in your expertise/comfort zone.</p>
<p>I&#8217;m operating from an infected environment, but I still can confirm from multiple places that webpages aren&#8217;t entirely corrupted, as my AP is toasted.  All I can do is train and prepare for when I make my best effort for all-around secure.</p>
<p>I&#8217;m in the process of setting up a better protection scheme, which involves OpenBSD and pfSense; but it&#8217;s in an unsafe area&#8230;</p>
<p>Again though, I&#8217;ll criticize one part, in the interest of making you better and forcing you to be better, which is an extremely common problem in the security community:</p>
<p><i>&#8220;Configure OpenBSD&#8217;s firewall correctly.&#8221;</i></p>
<p>This does almost nothing to help anyone besides someone&#8217;s ego, and more likely than not they don&#8217;t even have the correct configuration&#8230;It&#8217;s just like a sound-bite, like a media one.  It&#8217;s just to protect certain niche areas, which I guess is your way of surviving&#8230;on people&#8217;s ignorance.</p>
<p>/r/netsec had a small decent link on this phenomenom which I can&#8217;t find now&#8230;, no technical info, just saying that it&#8217;s pretty worthless to not GUIDE people though security setups.</p>
<p>It&#8217;s why my blog is dedicated solely to bare-bones walk-thru&#8217;s of some things.  Like Thoth&#8217;s, which was great.  When I get a really good tutorial posted I&#8217;ll link it, w/ all the data backed up &#8220;in multiple places&#8221;, in case I need to move the blog as it gets hacked on a security forum and displays porno for the employers looking at my resume&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228115">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228115">
						August 4, 2014 10:21 PM					</a>

				</p>

				<p>@ Figureitout</p>
<p>&#8220;One of your better posts in a long, long time. Very practical, and w/in your expertise/comfort zone.&#8221;</p>
<p>Why thank you.</p>
<p>re OpenBSD firewall</p>
<p>It has proven value in stopping attacks at the network level. It&#8217;s used by numerous governments and even in guard solutions pentested/approved by German government for their use. Their professional firewall hackers couldn&#8217;t bypass those without a 0-day. So, now you&#8217;ve limited the attackers wanting total control to those smart enough to develop a firmware attack or find a 0-day in the world&#8217;s most security-audited code. I also made a provision for making the firmware part tiny and app deprivileged. So, it&#8217;s quite a noose around the attackers neck.</p>
<p>Personally, I think top TLA&#8217;s probably can find a 0-day due to huge budget for that. Still stops tons of attackers, including lesser TLA&#8217;s, in practice. And recall he wanted a solution you can throw together, not the extra work (eg OPSEC/obfuscation) needed to slow/stop major TLA&#8217;s. So, a well-configured OpenBSD on embedded hardware with serial ports is one of the better options for quick and dirty mediation.</p>
<p>If I had a guess about the future, I&#8217;d say the next easy design for all these issues will leverage OpenFlow. You can easily build almost anything networking with all kinds of policies in that. Still too young to recommend for security purposes, though.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228116">

			<div class="comment by-figureitout ">

				<p class="commentcredit">

					<span class="commenter">Figureitout</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228116">
						August 4, 2014 10:35 PM					</a>

				</p>

				<p>Nick P<br />
&#8211;You didn&#8217;t address the configuration issue, so I&#8217;m assuming I&#8217;m correct that you just say that to charge people consulting fees and not really have <em>the correct</em> configuration.</p>
<p>Just clarifying.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228117">

			<div class="comment by-thoth ">

				<p class="commentcredit">

					<span class="commenter">Thoth</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228117">
						August 4, 2014 11:14 PM					</a>

				</p>

				<p>@Figureitout</p>
<p>Thanks for your appreciation :).</p>
<p>@Nick P, Clive, Scott</p>
<p>Thanks for your contributions on ideas and posts.</p>
<p>If you have noticed, I have not posted simple tutorial guides regarding the use of security software in the attempt of letting the dust settle down in regards to Truecrypt and to also reassess some simple yet effective combinations of measure the general public can quickly learn to use and setup simple barriers and later on ramp up their security higher once they have their bases settled.</p>
<p>The reason I have gone through great length to bring up this discussion is that we have seen so much supposed security breaking all over the place (Heartbleed, Apple Goto, USB attacks) and lots of uncertainties (NSA attack vectors and policies, Truecrypt going poof all of a sudden &#8230;etc&#8230;) and the divide between those who security and can secure themselves and those who dont know security and attempt to introduce themselves to security usually face a huge gap and shows us the reality of conflict  in the practical and theoretical space.</p>
<p>We cannot assume the users would know how to find some board and solder or script their programs while they are being watched (without a secure base to start off with).</p>
<p>Scott and me have provided a quick and dirty CD/DVD secure file transfer mechanism with Nick P enhancing it (via the use of one time use CD/DVD).</p>
<p>Nick P have provided a custom made &#8220;guard&#8221; using serial ports with an embedded OpenBSD mini computer to transfer data.</p>
<p>More ideas would be welcomed. If anyone have instructions and tutorials on the setup procedures, posting links on the instructions here would be a good idea. Listing the required technical expertise would be useful too.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228118">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228118">
						August 4, 2014 11:29 PM					</a>

				</p>

				<p>@ Figureitout</p>
<p>I might be misremembering but I thought I implied a person could Google them easy enough. Each piece can be found and there&#8217;s whole books on the subject with step-by-step instructions, example policies, and so on. Those are also available for free on the torrentz networks for people with less cash and morals. If I built one, I&#8217;d just use Google and the books for most of the steps so a consulting fee would just be covering labor rather than knowledge.</p>
<p>@ Thoth</p>
<p>&#8220;We cannot assume the users would know how to find some board and solder or script their programs while they are being watched (without a secure base to start off with).&#8221;</p>
<p>It&#8217;s more like you buy a board online from Soekris, get an old PC on Craigslist, or whatever. Then, you download the free CD. Then, you follow steps you find in Google for the different parts I mentioned. No soldering required. Just time and effort for each extra bit of assurance. The best way to deal with the scripts and such is to crowdsource some experts to build all that for free or for profit. Then, long as the hardware exists (or similar hardware does) the users can buy/download that and simply run it.</p>
<p>&#8220;More ideas would be welcomed. If anyone have instructions and tutorials on the setup procedures, posting links on the instructions here would be a good idea. Listing the required technical expertise would be useful too.&#8221;</p>
<p>I&#8217;ll at least add it to my list of stuff to get done if I have funding or time. Might even release the non-TLA version free as in beer and OSS.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228119">

			<div class="comment by-figureitout ">

				<p class="commentcredit">

					<span class="commenter">Figureitout</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228119">
						August 4, 2014 11:54 PM					</a>

				</p>

				<p>Nick P<br />
&#8211;Yes, they can google them, then get identified as a potential terrorist trying to secure themselves and have malware injected in their internet computer; which is the only computer they use and use very insecurely until they learn better, which is too late as the malware has infected all their accounts and memory devices and other computers.</p>
<p>So, in other words, there&#8217;s little reason to pay you for consulting services&#8230;?</p>
<p>Torrentz are illegal and it&#8217;s unwise to do so unless you are essentially pushing the risk onto someone else, from a ridiculous stupid lawsuit; or just straight malware from a torrent.</p>
<p>Not good enough from the security community.  The &#8220;solutions&#8221; all still suck, are untrustworthy, and require people to learn it all themselves.  What if the medical community required that?  We&#8217;d all be dead w/ pin worms crawling out our asses&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228120">

			<div class="comment by-q ">

				<p class="commentcredit">

					<span class="commenter">Q</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228120">
						August 5, 2014 2:11 AM					</a>

				</p>

				<p>@Clive Robinson • August 4, 2014 10:45 AM</p>
<p>In the reference on <a href="https://wuala.com/FreemoveQuantumExchange/Aspects/Tools/" rel="nofollow ugc">https://wuala.com/FreemoveQuantumExchange/Aspects/Tools/</a> a proof is given of the correct implementation of the Datadiode FFHDD2+. It is evaluated on assurance level EAL7+.</p>
<p>Given the simple optical separation and the easy verification possibility of it, it is widely believed to be provably correct.</p>
<p>If you have proof of the contrary then you have to produce this proof. Otherwise your remarks are not taken seriously.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228121">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228121">
						August 5, 2014 8:04 AM					</a>

				</p>

				<p>@ Q,</p>
<p>You are obviously new around here, otherwise you would know that saying what you have said is going to make quite a few around here laugh at your belief in the infallibility of the EAL7 process.</p>
<p>Further the page you give times out with at best a partial load, and the home page indicates that it belongs to a Cloud Provider that uses SSL for security&#8230; that is more of a sick joke than a funny one, as others around here will confirm.</p>
<p>Further a cursory glance &#8211;I realy do not have the time to waste on timing out pages&#8211; does not show the page you have given.</p>
<p>Thus many around here will probably suspect you of being related to the organisation in some way and from your comments about the equivalent of a &#8220;S&amp;M droid&#8221;.</p>
<p>Further if you hunt back on this web site you will find I have a low opinion of much that is Quantum Crypto, and have suggested quite a few attacks on such systems that others including under grad students have subsiquently verified. This is despite the designers were talking about provable security due to &#8220;guarantees of quantum physics&#8221;&#8230;</p>
<p>Quite a few of this blogs readers are well aware of many other security flaws I have identified that many &#8220;poo pooed&#8221; only to see them become major security flaws a few years down the line such as code signing flaws and air gap crossing techniques that Stuxnet much later came along to prove. So I&#8217;m not exactly worried about people saying my credability is under threat by suggesting I won&#8217;t be taken seriously.</p>
<p>I would suggest that rather than talking about the EAL processes you go and study them and then &#8220;start thinking hinky&#8221; if you are any good at it then your eyes will open up and you will if you wish to earn a good living from it.</p>
<p>The choice as they say is yours to take.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228122">

			<div class="comment by-q ">

				<p class="commentcredit">

					<span class="commenter">Q</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228122">
						August 5, 2014 8:52 AM					</a>

				</p>

				<p>@Clive Robinson • August 5, 2014 8:04 AM</p>
<p>Quote: ´Further if you hunt back on this web site you will find I have a low opinion of much that is Quantum Crypto, and have suggested quite a few attacks on such systems that others including under grad students have subsiquently verified. This is despite the designers were talking about provable security due to &#8220;guarantees of quantum physics&#8221;&#8230;´</p>
<p>It would be interesting if you could provide a security flaw in the information-theoretic provable true quantum randomness encryption which is used by the example group wuala.com/pgpstore</p>
<p>Quote: ´You are obviously new around here, otherwise you would know that saying what you have said is going to make quite a few around here laugh at your belief in the infallibility of the EAL7 process.´</p>
<p>I note that you have not produced any proof of security flaws in the Datadiode FFHDD2+.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228123">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228123">
						August 5, 2014 8:55 AM					</a>

				</p>

				<p>@ Q</p>
<p>The link you gave is a bunch of unrelated stuff thrown together. The few that are EAL7 are for the Fox Data Diode. A data diode lets data flow in one direction. The Fox Data Diode does this for optical Ethernet. It doesn&#8217;t support two-way computation or USB devices, so it&#8217;s not relevant in a discussion of USB. There&#8217;s no USB security product evaluated to EAL7 that I&#8217;m aware of.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228124">

			<div class="comment by-q ">

				<p class="commentcredit">

					<span class="commenter">Q</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228124">
						August 5, 2014 9:15 AM					</a>

				</p>

				<p>@Nick P • August 5, 2014 8:55 AM</p>
<p>USB devices and Datadiodes are both used in the context of one-way communication for the same functionality, see eg the explanation on <a href="https://wuala.com/FreemoveQuantumExchange/Aspects/Tools/sharing_secrets.pdf" rel="nofollow ugc">https://wuala.com/FreemoveQuantumExchange/Aspects/Tools/sharing_secrets.pdf</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228125">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228125">
						August 5, 2014 12:05 PM					</a>

				</p>

				<p>@ Q</p>
<p>You&#8217;re own linked paper proves my point: it pushes a data diode over Ethernet as <em>an alternative</em> to USB sticks for <em>just one way sharing</em>. Most use cases need two way commmunication. USB is a two-way protocol that&#8217;s not EAL7 evaluated either.</p>
<p>So, my point stands that a security proof for unidirectional Ethernet has nothing to do with securing USB device operation. Nor can one even compare them as it&#8217;s apples vs oranges.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228126">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228126">
						August 5, 2014 3:54 PM					</a>

				</p>

				<p>@ Q,</p>
<blockquote><p>I note that you have not produced any proof of security flaws in the Datadiode FFHDD2+.</p></blockquote>
<p>You obviously have reading issues, I told you quite clearly that for whatever reason the page you posted was timing out.</p>
<p>That is no Information that an opinion could be attempted was available.</p>
<p>I did google the model number and found it was a product of Fox-IT, but the foxit.com site was closing connections when I tried it UK lunch time. The only info I could get was not design related, the only thing of note was that apparently some one had put it through the NATO TOR process, which complicates things.</p>
<p>I think even you should realise that you need appropriate level details to make an assessment.</p>
<p>What I can say based on what Nick P has said of it that by breaking the way ethernet is supposed to work, you can make a data diode just by cutting wires in a cat5 lead. However you have to ditch error correction which has knock on effects, and also make modifications to driver code, which can be fraught with issues. On the face of it most would not consider it overly difficult to do, and get away with it for undemanding instrumentation, but without error correction you can lose data which would cause problems for other uses. Such &#8220;chop-a-channel&#8221; datadiodes are generaly considered unreliable and not suitable for many applications where reliability and timeliness are important.</p>
<p>So if this unit is for enterprise or above usage one of the first places I would look at is how the diode performs error correction or mitigates it&#8217;s use.</p>
<p>As I mentioned the other day I have seen units where upstream channels &#8211;supposadly&#8211; did not exist, however I found a way of bouncing errors off of down stream units that activated the error correction mechanism in the unit which in the process opened a low bandwidth up stream channel.</p>
<p>The reality is either you have error correction or you don&#8217;t, if you don&#8217;t then most engineers look at mitigation by rate limiting etc. They then forget that malware can take the limiting off or cause other issues and the consiquence alows for low bandwidth back channels, due to human activity.</p>
<p>You have to consider &#8220;The whole system&#8221; not it&#8217;s individual parts when investigating covert channels in a given security system. Failing to do this correctly will alow such channels to be opened in various interesting ways.</p>
<p>I will however have another hunt for the appropriate level of documentation over the weekend, but I already have the feeling it may not be available to the level required. In which case you will have to provide it without encumbrance, and if you want me to do more than a cursory read through it I can make my contract rates and TOCs available to you.</p>
<p>As I&#8217;ve already said to you &#8220;The choice as they say is yours to take&#8221;, mine is not to do charity for those that don&#8217;t need it.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228127">

			<div class="comment by-q ">

				<p class="commentcredit">

					<span class="commenter">Q</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228127">
						August 6, 2014 9:07 AM					</a>

				</p>

				<p>@Clive Robinson • August 5, 2014 3:54 PM</p>
<p>In order to get around your ¨timing out¨ problems, on the NATO Information Insurance link <a href="https://www.ia.nato.int/niapc/Product/Fort-Fox-data-diode-FFHDD2-_250" rel="nofollow ugc">https://www.ia.nato.int/niapc/Product/Fort-Fox-data-diode-FFHDD2-_250</a> you can find also background information.</p>
<p>Anyway, certified security proofs of the Datadiode concept have been delivered. If you think the datadiodes are not secure we are interested in your proof of ¨non-security¨.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228128">

			<div class="comment by-secret-police ">

				<p class="commentcredit">

					<span class="commenter">Secret Police</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228128">
						August 6, 2014 9:59 AM					</a>

				</p>

				<p>There&#8217;s fundamental insecurities of the Linux kernel when dealing with USB automounts as well. If you don&#8217;t patch your own kernel with grsec patches it&#8217;s trivial to escalate to root.</p>
<p>USB is just, all around bad. Bad for anti-forensics, bad for the kernel and full of exploitable firmware.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228129">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228129">
						August 6, 2014 11:22 AM					</a>

				</p>

				<p>@ Q</p>
<p><b>Common Criteria 101: What does Owl&#8217;s evaluation actually say?</b></p>
<p>They haven&#8217;t delivered a proof that the device is secure: they delivered a security target and an assurance argument that product meets it. The security target lists specific features and considerations. Anything outside that, like whether the chips they use have insecure extra functionality, might be used against it. Likewise, the EAL7 requirement requires an abstract (high-level) design, a formal security policy, a mathematical proof the abstract design holds the security policy, a simplified implementation, and an <em>informal correspondence argument</em> that implementation matches abstract design.</p>
<p>The implementation itself isn&#8217;t mathematically verified for security. Not the hardware, the firmware, the software, the covert channel analysis effect on implementation, the testing/proving tools themselves, the compilers/assemblers/linkers, the integration, and so on. Vulnerabilities were found in other products in each of these things. NSA, GHCQ, Russia, and China attack all of these things. The good news is that pro&#8217;s typically review and pentest an EAL5+ product so it gets good code reviews. Yet, pro&#8217;s also review and pentest things like SSL yet it&#8217;s had plenty of design and implementation flaws.</p>
<p>Due to issues like this, the industry puts the burden of proof on the company claiming security. The company must, in each aspect/component, provide arguments that certain invariants always hold despite malicious input, failure modes, etc. It&#8217;s not easy. EAL7 combined with the right security target does a ton of good. Matter of fact, data diodes are so simple (and almost uselessly so) that I&#8217;m reasonably sure Fox diode is probably secure for that one property: for <em>software</em> attacks and <em>strictly one way</em> configurations the device can ensure traffic is one-way. And that&#8217;s all it can do: the traffic can still try to do things on the other end, like enable built-in wireless functionality of receiving devices.</p>
<p>So long as you use it one way, it&#8217;s implementation has no problems, it has no backdoors (see BULLRUN), the enemies never have physical access, the administrator makes no mistakes, and so on. All these are assumptions their security relies on, many listed in their own Security Target. Change one, the evaluation result no longer applies per both common sense and Common Criteria. So, let&#8217;s look at Fox&#8217;s CC documents.</p>
<p><a href="http://www.commoncriteriaportal.org/search/?cx=016233930414485990345%3Af_zj6spfpx4&#038;cof=FORID%3A11&#038;ie=UTF-8&#038;q=Owl+dual+diode&#038;sa=Search" rel="nofollow ugc">http://www.commoncriteriaportal.org/search/?cx=016233930414485990345%3Af_zj6spfpx4&#038;cof=FORID%3A11&#038;ie=UTF-8&#038;q=Owl+dual+diode&#038;sa=Search</a></p>
<p>Owl&#8217;s certification history indicated they wisely started with EAL2 for data diode because it&#8217;s cheap, proves almost nothing (i.e. quick), and allows revenue to flow. This let them sell it to pay for more development and a better evaluation, EAL4+. Most of Owl&#8217;s products, including &#8220;Dual-Diode&#8221; line that references USB, is evaluated to EAL4+. Just like Windows 2000 and Linux&#8230; Security engineer &amp; OS developer Jonathan Shapiro <a href="https://web.archive.org/web/20060208030608/http://eros.cs.jhu.edu/~shap/NT-EAL4.html" rel="nofollow ugc">summed up nicely</a> what an EAL4+ evaluation means for security. One earlier, more primitive, data diode did get certified to EAL7 in its original configuration and design. The hardware, drivers, etc have been un-evaluated in all of them (per their evaluation reports) with the designers claiming they can&#8217;t impact security. (evil grin)</p>
<p>So, they started with a very simple product. They kept evaluating it repeatedly to design new products. The basic diode got evaluated to EAL7 at one point. They kept changing and upgrading it in different ways, getting each evaluated at &#8220;strength of function &#8211; medium&#8221; assurance. And they ignore key aspects of their own product (which NSA attacks per TAO) in all evaluations. So, Common Criteria says the overall security of a product is whats in its security target combined with its evaluation assurance level. All but one of the security targets are certified to low-medium assurance with some extra evaluation components. All security targets, including the rigorous EAL7, leave out stuff attackers can hit to simplify their evaluation.</p>
<p>Conclusion: Based on Common Criteria documents, Fox has rigorously designed at least one product to do its job excellently and the rest are merely tested while reusing the abstract design/policy. Of course, people don&#8217;t hack abstractions: they hack hardware, firmware, and software. So, the current Fox products that claim to protect USB (somehow&#8230;) can&#8217;t be considered secure unless <em>those exact products</em> undergo an EAL7+ evaluation against a security target representing what hackers are <em>actually going to attack</em>. And the hardware/firmware/drivers needs to be in that as the system&#8217;s TCB might depend on it regardless of what promises they made to evaluators.</p>
<p>Note: As I write this, it&#8217;s important that you should know I&#8217;ve actually worked on EAL6+ designs, broken an EAL7-equiv due to &#8220;out of scope,&#8221; and done years of pen testing. There&#8217;s almost no products, despite certifications, that have proven secure over time. A few came close due to hardware up verification and tough usability tradeoffs. The common link is that every component needs to be documented/verified, their interactions must be verified, failure modes must be verified, security method must be verified, and everything that&#8217;s TCB must be shown secure in all states. It&#8217;s so hard to do this that only a few commercial products have tried and the EAL4+ evaluations show even Owl doesn&#8217;t do it anymore.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228130">

			<div class="comment by-q ">

				<p class="commentcredit">

					<span class="commenter">Q</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228130">
						August 7, 2014 1:33 AM					</a>

				</p>

				<p>@Nick P • August 6, 2014 11:22 AM</p>
<p>Thanks.</p>
<p>As you know the real advantage of a Datadiode over an Air-gap is the real-time connection.</p>
<p>FYI: On <a href="http://vimeo.com/48002430" rel="nofollow ugc">http://vimeo.com/48002430</a> you can find a simple video explanation.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228131">

			<div class="comment by-schneieronsecurityfan ">

				<p class="commentcredit">

					<span class="commenter">SchneieronSecurityFan</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228131">
						August 8, 2014 2:47 AM					</a>

				</p>

				<p>Below is a link to the slides for the Black Hat briefing:</p>
<p><a href="https://srlabs.de/blog/wp-content/uploads/2014/07/SRLabs-BadUSB-BlackHat-v1.pdf" rel="nofollow ugc">https://srlabs.de/blog/wp-content/uploads/2014/07/SRLabs-BadUSB-BlackHat-v1.pdf</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228132">

			<div class="comment by-anykeylogger ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.anykeylogger.net' rel='external nofollow ugc' class='url'>anykeylogger</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228132">
						August 11, 2014 10:55 PM					</a>

				</p>

				<p>At the end of the day, any malware that happens to be on a USB device has to be able to make it into the target computer. The article talks a lot about PCs which, historically, have been quite easy to compromise.</p>
<p>Just suppose I stuck one of these nasty devices in my Mac. OK, it&#8217;s fiendish, it&#8217;s an empty gadget. And then its bad firmware kicks into life and tries to persuade my Mac that files are available. That file still has to make it onto my Mac and has to be an executable to do any harm.</p>
<p>I believe OS X&#8217;s inbuilt defences against malicious files &#8211; wherever they come from &#8211; would not be circumvented by a gadget like this.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228133">

			<div class="comment by-figureitout ">

				<p class="commentcredit">

					<span class="commenter">Figureitout</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228133">
						August 11, 2014 11:08 PM					</a>

				</p>

				<p><i>I believe OS X&#8217;s inbuilt defences against malicious files &#8211; wherever they come from &#8211; would not be circumvented by a gadget like this. </i><br />
anykeylogger<br />
&#8211;Well, I have a USB-stick that I could test on your machine if you want to test that&#8230;Only reason I&#8217;m keeping it is to eventually get a machine I feel comfortable plugging it into and finding out what all is in it&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228134">

			<div class="comment by-flxkid ">

				<p class="commentcredit">

					<span class="commenter">flxkid</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228134">
						August 12, 2014 11:37 AM					</a>

				</p>

				<p>I&#8217;ve seen this legitimately used. Western Digital ships a USB stick with their Black2 Dual Drive that when plugged in, acts as a HID and actually fires off the key presses to open the &#8220;Run Program&#8221; dialog in windows, and then enters a URL to open the support page where you can download the software for the hard drive!</p>
<p>It was stunning and a bit scary at the same time to see this in action.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228135">

			<div class="comment by-sauna ">

				<p class="commentcredit">

					<span class="commenter">sauna</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228135">
						August 18, 2014 5:10 AM					</a>

				</p>

				<p>A few have mentioned the SD cards also being vulnerable, but nobody addressed that the SD cards have a mechanical switch to make it &#8220;read only&#8221;, is it still possible access and reprogram the fw?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228136">

			<div class="comment by-railgun_sniper ">

				<p class="commentcredit">

					<span class="commenter">Railgun_Sniper</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228136">
						October 15, 2014 9:05 AM					</a>

				</p>

				<p>@Sauna</p>
<p>Flat out said I&#8217;m a long time reader, and maybe 3rd time poster.  There are plenty of knowledgeable folks here, and I&#8217;d often just restate an already established opinion, or re-field a question that someone else already fielded.  Redundancy is only good for storage media and mission critical components (we could all benefit from a second pancreas or a second brain or heart&#8230; if properly implemented.  Ettins need not apply.)</p>
<p>A word to the wise on &#8220;read / write only switch&#8221; technology on cards.  These are rarely (far as I know NEVER) actually mechanical switches other than the fact that they require mechanical forces (read &#8220;applied mechanical force&#8221; aka finger or screw driver presses against the switch in order to actually toggle it from one position to the other.)  I have more than once opened such a device in write mode before the OS I was using had proper support for that &#8220;read write bit.&#8221;</p>
<p>So if your hardware host does not &#8220;respect&#8221; the read only switch&#8230; the device is writable at all times.  Also, please note that read only for the data storage area and read only for the entire device are unlikely to be the same thing.  There may be vendors who do more than just &#8220;set a bit&#8221; but I doubt it will be at the $1.00 per gig range.</p>
<p>As a side note: for that switch to &#8220;mechanically&#8221; disable reads and writes, it would have to MOVE part of the PCB out of alignment when write mode is disabled.  This would require TWO busses, one for reading, one for writing.  That&#8217;s a lot of extra logic to pack onto what normally costs 50 cents to produce and ship, 1 or 2 bucks to comply with all the government fees, taxes and regulations and sells for 5 bucks or more.</p>
<p>Case in point, I&#8217;ve taken a few apart in the past and all the components are fixed on the PCB, the switch is nothing more than a cheap dip/toggle switch affixed to the PCB.  At best it might be designed to disable the flow of electricity across a channel which, when polled, checks whether the bus should consider the device read/write mode only.  This is a typical &#8220;is the read only bit set?&#8221; type protection which the bus or the software, or both, have to respect.  To make it so the CARD itself disables this, in hardware, ON THE CARD, there would have to be extra logic on the PCB to disable writes to the storage area of the unit whenever voltage through the &#8220;lock&#8221; line is disabled (or enabled, depending on design.)  Short of the $4.00+ per gig cards, I doubt anyone can do it and still turn a profit.  And that&#8217;s assuming the chinese company making them isn&#8217;t making more profit from your tax dollars being spent to circumvent your security (read, any TLA) so the people paid by tax dollars (read, any TLA) can get access to your naughty pics to make fake facebook pages&#8230; which apparently has prior art, as of recently.  (See the Iphone racy pics story at bottom section of the Cryptogram current issue.  October 2014 to be exact.)</p>
<p>Some time ago, I still remember an evaluation sample of a BENQ camera storing videos to a Samsung stick I set to RO with that hardware switch set to lock.  Ironically, the same thing happened with a PNY stick.  16 to 32 gb sticks, for those who are curious.  Camera itself was a fantastic piece of equipment, I still sell its later date compatriots (which coincidentally sport the exact same behavior, which I consider a failsafe for stupid lusers.  Unless you&#8217;re a casual spy transporting secrets on your camera flash because you&#8217;re too broke to buy those USB cufflinks for sale these days, the actual legit users probably want to write to their camera storage no matter what, they probably value the pictures they can take more than the &#8220;oops, lost that one perfect picture moment because I forgot to turn off the lock switch&#8221; issue.)  Again, we&#8217;re in the business of catering to the lowest common denominator, and PEBKAC is the most common threat to security there is.  An idiot or ignorant individual at the keyboard, with proper access, can destroy some of the best laid security systems there are, if the security systems do not account and deal with said stupidity.  Those lock switches are at best&#8230; a comforting illusion.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-228137">

			<div class="comment by-equation-group ">

				<p class="commentcredit">

					<span class="commenter">Equation group</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228137">
						February 17, 2015 1:47 PM					</a>

				</p>

				<p>I know you&#8217;ve heard this many times, but you were right all along and the NSA did use the firmware exploit</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-228138">

			<div class="comment by-henny ">

				<p class="commentcredit">

					<span class="commenter">Henny</span> •

					<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/#comment-228138">
						October 7, 2016 7:21 AM					</a>

				</p>

				<p>It seems that Sauna and Railgun_Sniper have good points. Preventing software contaminating the firmware is the main issue. A switch or physical sensor like hall effect, ultrasonic, optical, pin overvolts condition, any of these could be engineered so that the customer can both block software access and obtain it to upgrade or check the firmware. This function has to be hard wired into the design.<br />
Without this malware can spread from one usb device to another and possibly access the internet if this is connected to the usb bus.<br />
Ability to read back the firmware would also be useful, again hard wired, not in firmware. One could then check a newly bought device. Open sourcing the design and software loses virtually nothing for the manufacturer as they have patents and both Russia and China are quite capable of reading any firmware using electron microscopes and micro-manipulation of opened chips.<br />
I found a whole batch of chips contaminated in a shop recently, all reporting 32GB capacity while actually being 8GB. Clearly there are already people able to program these devices in the supply chain. Next they will probably move to more lucrative collaborations with scammers.</p>
<p>It seems that the firmware goes to reporting a read only mode if there is certain tampering with code or device errors. I had stuxnet on a laptop and it damaged several old and new micro sd cards. They give read only error in windows and linux shows cache page error when trying to mount them.</p>
<p>There is a vulnerability to specially engineered devices that isn&#8217;t so easy to fix, yes it is possible to block ordinary supply chain tampering, but purpose engineered chips could in theory be slipped into targeted orders. This is worrying, random sampling might work, but there is a lot at stake. If genetics laboratories, nuclear plants, factories, banks etc were targeted with data editing at the storage chip level. We have already had viral genes introduced into gm crops inadvertently.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

	<p class="subscribe-comments">
		<a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html/feed/">
			<img alt="Atom Feed" src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/rss.png">
			Subscribe to comments on this entry		</a>
	</p>

		<div id="respond" class="comment-respond">
		<h2 class="comments-open-header">Leave a comment <small><a rel="nofollow" id="cancel-comment-reply-link" href="/blog/archives/2014/07/the_fundamental.html#respond" style="display:none;">Cancel reply</a></small></h2><form action="https://www.schneier.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><a href="https://www.schneier.com/wp-login.php?redirect_to=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2014%2F07%2Fthe_fundamental.html" title="Login">Login</a><p class="comment-form-author"><label for="author">Name</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" /></p>
<p class="comment-form-email"><label for="email">Email</label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" /></p>
<p class="comment-form-url"><label for="url">URL:</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p>
<p class="comment-form-cookies-consent"><input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox" value="yes" /> <label for="wp-comment-cookies-consent">Remember personal info?</label></p>

<p class="comment-form-author">

	<label for="comm_capt_challenge">
		Fill in the blank: the name of this blog is Schneier on ___________ (required):	</label>

	<input id="comm_capt_challenge" name="comm_capt_challenge" size="30" type="text" />
</p>

<div class="comment-form-comment">

	<label for="comment">Comments:</label>

	<textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea>

	<div id="preview-box" class="preview-box hide"></div>
	<img class="comment-loading hide" src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/loader.gif" />

</div>

<p id="allowed">

	<strong>Allowed HTML</strong>
	&lt;a href=&quot;URL&quot;&gt; &bull; &lt;em&gt; &lt;cite&gt; &lt;i&gt; &bull; &lt;strong&gt; &lt;b&gt; &bull; &lt;sub&gt; &lt;sup&gt; &bull; &lt;ul&gt; &lt;ol&gt; &lt;li&gt; &bull; &lt;blockquote&gt; &lt;pre&gt;
	<strong>Markdown Extra</strong> syntax via <a href="https://michelf.ca/projects/php-markdown/extra/">https://michelf.ca/projects/php-markdown/extra/</a>
</p>

<input type="hidden" id="wp_comment_nonce" name="wp_comment_nonce" value="4b1534b792" /><input type="hidden" name="_wp_http_referer" value="/blog/archives/2014/07/the_fundamental.html" />
<input type="button" id="comment-preview" class="comment-preview comment-actions" value="Preview" />
<input type="button" id="comment-write" class="comment-write comment-actions hide" value="Edit" />

<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Submit" /> <input type='hidden' name='comment_post_ID' value='5906' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p></form>	</div><!-- #respond -->
	
	<div class="stepthrough">
		<a href="https://www.schneier.com/blog/archives/2014/07/debit_card_over.html" rel="prev">← Debit Card Override Hack</a>		<a href="https://www.schneier.com/blog/archives/2014/08/the_nsas_patent.html" rel="next">The NSA&#039;s Patents →</a>	</div>

	
<p id="powered">Sidebar photo of Bruce Schneier by Joe MacInnis.</p>
		</div>

		
<aside>
	<div class="sidebar" id="sidebar-two">
		<section><div class="sidesection widget widget_schneier_about" id="schneier_about-2"><h3>About Bruce Schneier</h3><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/Bruce-Schneier.jpg" /><p><p class="small">I am a <a href="https://public-interest-tech.com/">public-interest technologist</a>, working at the intersection of security, technology, and people. I've been writing about security issues on my <a href="/">blog</a> since 2004, and in my monthly <a href="/crypto-gram/">newsletter</a> since 1998. I'm a fellow and lecturer at Harvard's <a href="https://www.hks.harvard.edu/faculty/bruce-schneier">Kennedy School</a>, a board member of <a href="https://www.eff.org/">EFF</a>, and the Chief of Security Architecture at <a href="https://inrupt.com/">Inrupt, Inc.</a> This personal website expresses the opinions of none of those organizations.</p>
</p></div></section><section><div class="sidesection widget widget_schneier_related_posts" id="schneier_related_posts-2"><h3>Related Entries</h3>
<ul>

	<li><a href="https://www.schneier.com/blog/archives/2021/03/illegal-content-and-the-blockchain.html">Illegal Content and the Blockchain</a></li><li><a href="https://www.schneier.com/blog/archives/2021/03/national-security-risks-of-late-stage-capitalism.html">National Security Risks of Late-Stage Capitalism</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/weis-2021-call-for-papers.html">WEIS 2021 Call for Papers</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/ransomware-profitability.html">Ransomware Profitability</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/presidential-cybersecurity-and-pelotons.html">Presidential Cybersecurity and Pelotons</a></li><li><a href="https://www.schneier.com/blog/archives/2021/01/police-have-disrupted-the-emotet-botnet.html">Police Have Disrupted the Emotet Botnet</a></li>
</ul>
</div></section><section><div class="sidesection widget widget_schneier_featured_essays" id="schneier_featured_essays-2"><h3>Featured Essays</h3>
	<ul>
		<li><a href="https://www.schneier.com/essays/archives/2016/04/the_value_of_encrypt.html">The Value of Encryption</a></li><li><a href="https://www.schneier.com/essays/archives/2016/03/data_is_a_toxic_asse.html">Data Is a Toxic Asset, So Why Not Throw It Out?</a></li><li><a href="https://www.schneier.com/essays/archives/2014/01/how_the_nsa_threaten.html">How the NSA Threatens National Security</a></li><li><a href="https://www.schneier.com/essays/archives/2009/01/terrorists_may_use_g.html">Terrorists May Use Google Earth, But Fear Is No Reason to Ban It</a></li><li><a href="https://www.schneier.com/essays/archives/2007/01/in_praise_of_securit.html">In Praise of Security Theater</a></li><li><a href="https://www.schneier.com/essays/archives/2006/08/refuse_to_be_terrori.html">Refuse to be Terrorized</a></li><li><a href="https://www.schneier.com/essays/archives/2006/05/the_eternal_value_of.html">The Eternal Value of Privacy</a></li><li><a href="https://www.schneier.com/essays/archives/2005/09/terrorists_dont_do_m.html">Terrorists Don&#039;t Do Movie Plots</a></li>	</ul>

	<p><a href="https://www.schneier.com/essays/">More Essays</a></p></div></section><section><div class="sidesection widget widget_schneier_archives" id="schneier_archives-2"><h3>Blog Archives</h3>
<ul>

	<li><a href="https://www.schneier.com/blog/calendar.html/">Archive by Month</a></li><li><a href="https://www.schneier.com/blog/newcomments.html/">100 Latest Comments</a></li></ul>

<h4>Blog Tags</h4><ul class="top-tags"><li><a href="https://www.schneier.com/tag/3d-printers/">3d printers</a></li><li><a href="https://www.schneier.com/tag/9-11/">9/11</a></li><li><a href="https://www.schneier.com/tag/aaron-swartz/">Aaron Swartz</a></li><li><a href="https://www.schneier.com/tag/academic/">academic</a></li><li><a href="https://www.schneier.com/tag/academic-papers/">academic papers</a></li><li><a href="https://www.schneier.com/tag/accountability/">accountability</a></li><li><a href="https://www.schneier.com/tag/aclu/">ACLU</a></li><li><a href="https://www.schneier.com/tag/activism/">activism</a></li><li><a href="https://www.schneier.com/tag/adobe/">Adobe</a></li><li><a href="https://www.schneier.com/tag/advanced-persistent-threats/">advanced persistent threats</a></li><li><a href="https://www.schneier.com/tag/adware/">adware</a></li><li><a href="https://www.schneier.com/tag/aes/">AES</a></li><li><a href="https://www.schneier.com/tag/afghanistan/">Afghanistan</a></li><li><a href="https://www.schneier.com/tag/air-marshals/">air marshals</a></li><li><a href="https://www.schneier.com/tag/air-travel/">air travel</a></li><li><a href="https://www.schneier.com/tag/airgaps/">airgaps</a></li><li><a href="https://www.schneier.com/tag/al-qaeda/">al Qaeda</a></li><li><a href="https://www.schneier.com/tag/alarms/">alarms</a></li><li><a href="https://www.schneier.com/tag/algorithms/">algorithms</a></li><li><a href="https://www.schneier.com/tag/alibis/">alibis</a></li><li><a href="https://www.schneier.com/tag/amazon/">Amazon</a></li><li><a href="https://www.schneier.com/tag/android/">Android</a></li><li><a href="https://www.schneier.com/tag/anonymity/">anonymity</a></li><li><a href="https://www.schneier.com/tag/anonymous/">Anonymous</a></li><li><a href="https://www.schneier.com/tag/antivirus/">antivirus</a></li><li><a href="https://www.schneier.com/tag/apache/">Apache</a></li><li><a href="https://www.schneier.com/tag/apple/">Apple</a></li><li><a href="https://www.schneier.com/tag/applied-cryptography/">Applied Cryptography</a></li><li><a href="https://www.schneier.com/tag/artificial-intelligence/">artificial intelligence</a></li><li><a href="https://www.schneier.com/tag/assassinations/">assassinations</a></li></ul><p><a href="https://www.schneier.com/blog/tags.html/">More Tags</a></p></div></section><section><div class="sidesection widget widget_schneier_latest_book" id="schneier_latest_book-3"><h3>Latest Book</h3><a href="https://www.schneier.com/books/click-here/"><img class="sidepic" alt="Click Here to Kill Everybody" src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2018/07/book-ch2-200w.png" /></a><p><a href="https://www.schneier.com/books/">More Books</a></p></div></section><section><div class="sidesection widget widget_schneier_promotion" id="schneier_promotion-2">
<a href="https://www.eff.org/issues/bloggers/legal/join">
	<img src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/join-eff@2x.png" id="effbutton" alt="Support Bloggers' Rights!" title="Support Bloggers' Rights!" /></a>

<a href="https://npo.networkforgood.org/Donate/Donate.aspx?npoSubscriptionId=8252">
	<img src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/support-epic@2x.png" alt="Defend Privacy--Support Epic" title="Defend Privacy--Support Epic" /></a>
</div></section>	</div>
</aside>

		<footer>
			<nav>
				<div class="nav" id="footer-nav">
					<div class="menu-main-menu-container"><ul id="menu-main-menu-1" class="menu"><li class="menu1 menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-50175 current-menu-item"><a href="https://www.schneier.com">Blog</a></li>
<li class="menu2 menu-item menu-item-type-post_type menu-item-object-page menu-item-50916"><a href="https://www.schneier.com/crypto-gram/">Newsletter</a></li>
<li class="menu3 menu-item menu-item-type-post_type menu-item-object-page menu-item-50166"><a href="https://www.schneier.com/books/">Books</a></li>
<li class="menu4 menu-item menu-item-type-custom menu-item-object-custom menu-item-50169"><a href="https://www.schneier.com/essays/">Essays</a></li>
<li class="menu5 menu-item menu-item-type-custom menu-item-object-custom menu-item-50170"><a href="https://www.schneier.com/news/">News</a></li>
<li class="menu6 menu-item menu-item-type-custom menu-item-object-custom menu-item-50171"><a href="https://www.schneier.com/talks/">Talks</a></li>
<li class="menu7 menu-item menu-item-type-post_type menu-item-object-page menu-item-50167"><a href="https://www.schneier.com/academic/">Academic</a></li>
<li class="menu8 menu-item menu-item-type-post_type menu-item-object-page menu-item-50174"><a href="https://www.schneier.com/blog/about/">About Me</a></li>
</ul></div>				</div>
			</nav>
		</footer>

		</div><!--#main-->
	</div><!--#wrapper-->

		<script type="text/javascript">
		(function () {
			var c = document.body.className;
			c = c.replace(/woocommerce-no-js/, 'woocommerce-js');
			document.body.className = c;
		})();
	</script>
	<script type='text/javascript' src='https://c0.wp.com/p/woocommerce/5.1.0/assets/js/jquery-cookie/jquery.cookie.min.js' id='jquery-cookie-js'></script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/vendor/socialshareprivacy/js/socialshareprivacy.js?ver=1.0.1' id='social-share-privacy-js'></script>
<script type='text/javascript' id='social-share-privacy-icons-js-extra'>
/* <![CDATA[ */
var schneierSocial = {"path":"https:\/\/www.schneier.com\/wp-content\/themes\/schneier\/assets\/vendor\/socialshareprivacy\/"};
/* ]]> */
</script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/vendor/socialshareprivacy/js/icons.js?ver=1.0.0' id='social-share-privacy-icons-js'></script>
<script type='text/javascript' id='schneier-comment-js-extra'>
/* <![CDATA[ */
var schneierComment = {"translateErrorSecurityAnswerWrong":"Your response to the challenge question ('The name of this blog is Schneier on ____') was not correct. Please try again.","ajax_url":"https:\/\/www.schneier.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/js/comment.js?ver=1.0.1' id='schneier-comment-js'></script>
<script type='text/javascript' src='https://c0.wp.com/c/5.7/wp-includes/js/wp-embed.min.js' id='wp-embed-js'></script>

</body>

</html>
