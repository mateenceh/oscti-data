<!DOCTYPE html>
<html lang="en-US">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<title>BadUSB Code Has Been Published - Schneier on Security</title>
	<meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel='dns-prefetch' href='//c0.wp.com' />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Feed" href="https://www.schneier.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Comments Feed" href="https://www.schneier.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; BadUSB Code Has Been Published Comments Feed" href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/feed/" />
<link rel='stylesheet' id='wp-block-library-css'  href='https://c0.wp.com/c/5.7/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all' />
<style id='wp-block-library-inline-css' type='text/css'>
.has-text-align-justify{text-align:justify;}
</style>
<style id='woocommerce-inline-inline-css' type='text/css'>
.woocommerce form .form-row .required { visibility: visible; }
</style>
<link rel='stylesheet' id='schneier-css'  href='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/style.css?ver=1.0.0' type='text/css' media='all' />
<link rel='stylesheet' id='schneier-main-css'  href='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/dist/css/style.css?ver=1.0.2' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css'  href='https://c0.wp.com/p/jetpack/9.5.2/css/jetpack.css' type='text/css' media='all' />
<script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js?ver=3.5.1' id='jquery-js'></script>
<link rel="https://api.w.org/" href="https://www.schneier.com/wp-json/" /><link rel="alternate" type="application/json" href="https://www.schneier.com/wp-json/wp/v2/posts/6356" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://www.schneier.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://www.schneier.com/wp-includes/wlwmanifest.xml" /> 

<link rel="canonical" href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html" />
<link rel='shortlink' href='https://www.schneier.com/?p=6356' />
<link rel="alternate" type="application/json+oembed" href="https://www.schneier.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2014%2F10%2Fbadusb_code_has.html" />
<link rel="alternate" type="text/xml+oembed" href="https://www.schneier.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2014%2F10%2Fbadusb_code_has.html&#038;format=xml" />
	<noscript><style>.woocommerce-product-gallery{ opacity: 1 !important; }</style></noscript>
	<link rel="icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-32x32.png" sizes="32x32" />
<link rel="icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-180x180.png" />
<meta name="msapplication-TileImage" content="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-270x270.png" />
		<style type="text/css" id="wp-custom-css">
			#schneier_promotion-2 img {
    max-width: 180px;
}		</style>
		</head>

<body class="post-template-default single single-post postid-6356 single-format-standard theme-schneier woocommerce-no-js">

	<div id="wrapper">
		<div id="main">

			<header>
				<div id="header">
					<h1>
						<a href="https://www.schneier.com/" rel="home">
							Schneier on Security						</a>
					</h1>
				</div>
			</header>

			<nav>
				<div class="nav" id="header-nav">
					<div class="menu-main-menu-container"><ul id="menu-main-menu" class="menu"><li id="menu-item-50175" class="menu1 menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-50175 current-menu-item"><a href="https://www.schneier.com">Blog</a></li>
<li id="menu-item-50916" class="menu2 menu-item menu-item-type-post_type menu-item-object-page menu-item-50916"><a href="https://www.schneier.com/crypto-gram/">Newsletter</a></li>
<li id="menu-item-50166" class="menu3 menu-item menu-item-type-post_type menu-item-object-page menu-item-50166"><a href="https://www.schneier.com/books/">Books</a></li>
<li id="menu-item-50169" class="menu4 menu-item menu-item-type-custom menu-item-object-custom menu-item-50169"><a href="https://www.schneier.com/essays/">Essays</a></li>
<li id="menu-item-50170" class="menu5 menu-item menu-item-type-custom menu-item-object-custom menu-item-50170"><a href="https://www.schneier.com/news/">News</a></li>
<li id="menu-item-50171" class="menu6 menu-item menu-item-type-custom menu-item-object-custom menu-item-50171"><a href="https://www.schneier.com/talks/">Talks</a></li>
<li id="menu-item-50167" class="menu7 menu-item menu-item-type-post_type menu-item-object-page menu-item-50167"><a href="https://www.schneier.com/academic/">Academic</a></li>
<li id="menu-item-50174" class="menu8 menu-item menu-item-type-post_type menu-item-object-page menu-item-50174"><a href="https://www.schneier.com/blog/about/">About Me</a></li>
</ul></div>				</div>
			</nav>

			
<aside>
	<div class="sidebar" id="sidebar-one">
		<section><div class="sidesection widget widget_schneier_search" id="schneier_search-3"><h3>Search</h3>
<p class="small">
	<em>Powered by <a href="https://duckduckgo.com/">DuckDuckGo</a></em></p>

<form method="get" action="https://duckduckgo.com/">

	<input type="hidden" name="kh" value="1" /><!-- use https -->

	<input id="search" name="q" size="15" maxlength="255" />

	<input type="submit" value="Go" /><br>

	<input type="radio" name="sites" id="searchblog" value="www.schneier.com/blog" />
	<label for="searchblog">Blog</label>

	<input type="radio" name="sites" id="searchessays" value="www.schneier.com/essays" />
	<label for="searchessays">Essays</label>

	<input type="radio" name="sites" id="searchall" value="www.schneier.com" checked="" />
	<label for="searchall">Whole site</label>

</form>
</div></section><section><div class="sidesection widget widget_schneier_social" id="schneier_social-2"><h3>Subscribe</h3>
<div id="subscription-buttons">

	<a href="https://www.schneier.com/feed/atom"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/rss-32px.png" alt="Atom Feed" /></a><a href="https://www.facebook.com/bruce.schneier"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/facebook-32px.png" alt="Facebook" /></a><a href="https://twitter.com/schneierblog/"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/twitter-32px.png" alt="Twitter" /></a><a href="https://www.amazon.com/Schneier-on-Security/dp/B0053HDDWW/"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/kindle-32px.png" alt="Kindle" /></a><a href="https://www.schneier.com/crypto-gram"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/email-32px.png" alt="E-Mail Newsletter (Crypto-Gram)" /></a>
</div>
</div></section>	</div>
</aside>

			<div id="content">

				
		<p id="breadcrumbs">

			<a href="https://www.schneier.com">Home</a><a href="https://www.schneier.com/blog/archives/">Blog</a>		</p>

		
<article id="post-6356" class="post-6356 post type-post status-publish format-standard hentry category-uncategorized tag-disclosure tag-malware tag-patching tag-usb tag-vulnerabilities">

	<div class="article">

		<h2 class="entry">BadUSB Code Has Been Published</h2>
		<p>In July, I <a href="https://www.schneier.com/blog/archives/2014/07/the_fundamental.html">wrote about</a> an unpatchable USB vulnerability called BadUSB. Code for the vulnerability <a href="http://www.wired.com/2014/10/code-published-for-unfixable-usb-attack/">has</a> <a href="http://arstechnica.com/security/2013/10/meet-badbios-the-mysterious-mac-and-pc-malware-that-jumps-airgaps/">been</a> <a href="https://github.com/adamcaudill/Psychson">published</a>.</p>

		
			<p class="entry-tags">
				<span class="tags-links">Tags: <a href="https://www.schneier.com/tag/disclosure/" rel="tag">disclosure</a>, <a href="https://www.schneier.com/tag/malware/" rel="tag">malware</a>, <a href="https://www.schneier.com/tag/patching/" rel="tag">patching</a>, <a href="https://www.schneier.com/tag/usb/" rel="tag">USB</a>, <a href="https://www.schneier.com/tag/vulnerabilities/" rel="tag">vulnerabilities</a></span>			</p>

		
		
		<p class="posted">
			<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html" rel="bookmark">Posted on October 8, 2014 at 3:38 PM</a>			•
			<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html#comments">59 Comments</a>		</p>

		<aside><div class="schneier-share share" data-uri="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html" data-title="BadUSB Code Has Been Published" data-order="facebook twitter tumblr" data-social-share-privacy="true" /></aside>
	</div>

</article>


	<h3 id="comments">Comments</h3>

	
		<article class="comment even thread-even depth-1" id="comment-232460">

			<div class="comment by-anura ">

				<p class="commentcredit">

					<span class="commenter">Anura</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232460">
						October 8, 2014 4:08 PM					</a>

				</p>

				<p>Attacks like these demonstrate a need to fundamentally rethink the hardware architecture of systems. All communication between components, whether hardware or software, needs to be strictly governed.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232461">

			<div class="comment by-foobar ">

				<p class="commentcredit">

					<span class="commenter">foobar</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232461">
						October 8, 2014 4:53 PM					</a>

				</p>

				<p>No, we don&#8217;t need to rethink architecture. We do need to rethink the process of hardware design behind closed doors, with all kinds of bad actors exerting their power. You know who I mean.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232462">

			<div class="comment by-db ">

				<p class="commentcredit">

					<span class="commenter">DB</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232462">
						October 8, 2014 5:02 PM					</a>

				</p>

				<p>@foobar no we need to rethink both.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232463">

			<div class="comment by-who-am-i ">

				<p class="commentcredit">

					<span class="commenter">Who am I?</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232463">
						October 8, 2014 5:08 PM					</a>

				</p>

				<p>We need to rethink the way this information is released into the wild too&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232464">

			<div class="comment by-anura ">

				<p class="commentcredit">

					<span class="commenter">Anura</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232464">
						October 8, 2014 5:09 PM					</a>

				</p>

				<p>@foobar</p>
<p>This isn&#8217;t just about the fact that this device can be attacked with malware, this is about the fact that USB devices have access to more than they should. If you plug a USB thumb drive into a port on the same controller as your keyboard or wifi card, it can snoop all of that information or spoof the device (e.g. it can steal your password, and then run commands with root access on your machine by spoofing your keyboard).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232465">

			<div class="comment by-anura ">

				<p class="commentcredit">

					<span class="commenter">Anura</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232465">
						October 8, 2014 5:14 PM					</a>

				</p>

				<p>addendum:</p>
<p>On top of that, although this particular exploit attacks existing hardware, there is nothing you can do from the hardware side to prevent a TLA or other resourceful party from straight up manufacturing their own implant to physically attach to USB drives and act as a man in the middle (doesn&#8217;t TAO already do that in the first place?).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232466">

			<div class="comment by-who-am-i ">

				<p class="commentcredit">

					<span class="commenter">Who am I?</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232466">
						October 8, 2014 5:24 PM					</a>

				</p>

				<p>Can someone provide some light about how vulnerabilities like this one affect users of non-Microsoft operating systems?  Specifically, can this vulnerability be ported to secure operating systems like OpenBSD without requiring a privileged account?</p>
<p>Will this code target a single operating system and/or architecture (e.g. OpenBSD/amd64) or will an infected drive execute its code on an OS-agnostic way?</p>
<p>At last, now that we know the exact details is there a chance to write a software tool that will check and clean infected drives?</p>
<p>Thanks in advance!</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232467">

			<div class="comment by-grauhut ">

				<p class="commentcredit">

					<span class="commenter">Grauhut</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232467">
						October 8, 2014 5:38 PM					</a>

				</p>

				<p>@Who am I? &#8220;We need to rethink the way this information is released into the wild too&#8230;&#8221;</p>
<p>You are so right. We need harder and faster full disclosure. Otherwise they dont learn it!</p>
<p>And every updatable coprozessor needs a write protect dip switch. Every means your bios, smartphones baseband processor, your scsi controllers bios extensions, your ssd firmware, your offloading nic, your usb flash stick, dvbt-stick&#8230; Each and every copro needs a working write protect switch. And you must be willig to use it gracefully, it saves your day someday, sooner or later. Until this day has come, we are potentially pwned, penetrated, f***ed, you name it. Makes no difference if we know it or not. A blackhole exists by itself and works by its gravity, if you try to look at it or not, behind its event horizon you will be eaten and Schroedingers cat will not save you, because you have her box in your hands and she will be eaten with you, dead or alive, if you look at her or not.</p>
<p>Ladies, prepare your glue guns! 🙂</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232468">

			<div class="comment by-anura ">

				<p class="commentcredit">

					<span class="commenter">Anura</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232468">
						October 8, 2014 5:39 PM					</a>

				</p>

				<p>@Who am I?</p>
<p>Detection, I don&#8217;t know, but I described a scenario above. The device can listen for your keyboard input, sniff out your password (which if you are in sudoers they don&#8217;t specifically need your root password), and then from there it can spoof your keyboard to run arbitrary commands on your system to, for example, install executable code with root priveleges.</p>
<p>To protect yourself, I would make sure the port you plug your thumb drive into is on a separate controller from your keyboard/mouse. Even then, that&#8217;s far from a guarantee of security.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232469">

			<div class="comment by-grauhut ">

				<p class="commentcredit">

					<span class="commenter">Grauhut</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232469">
						October 8, 2014 5:54 PM					</a>

				</p>

				<p>Take a headless raspi without usb hid and com driver modules as an automated copy box, if paranoid with clamav.</p>
<p>Just needs a small auto mounting service to check avalability of flash sticks on in and out port, when both ready mount, copy and scan. When finished, flash green led until drives removed.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232470">

			<div class="comment by-anura ">

				<p class="commentcredit">

					<span class="commenter">Anura</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232470">
						October 8, 2014 6:04 PM					</a>

				</p>

				<p>@Grauhut</p>
<p>For USB, that doesn&#8217;t solve much as the malware can be installed before you even get it, in fact I would bet that would be the main root of attack &#8211; someone giving you a thumb drive with an exploit (alternatively, modify something like a logitech USB receiver and switch it out when they aren&#8217;t looking).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232471">

			<div class="comment by-miles ">

				<p class="commentcredit">

					<span class="commenter">Miles</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232471">
						October 8, 2014 6:53 PM					</a>

				</p>

				<p>@Who am I</p>
<p>This attack hits the firmware on USB devices &#8212; the security of the operating system is somewhat irrelevant.  Soon, we may not even be able to trust a keyboard that was attached to an infected computer.</p>
<p>If your secure operating system has a root console window running when you attach an affected USB stick, it could behave like a keyboard and try to run some commands designed to create havoc.</p>
<p>However, I suspect the frequency of BadUSB exploits targeting secure operating systems will be about the same as the frequency of viruses.  90% of the world&#8217;s computers run insecure operating systems, so people looking to steal money and secrets will focus their efforts there.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232472">

			<div class="comment by-stan ">

				<p class="commentcredit">

					<span class="commenter">Stan</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232472">
						October 8, 2014 8:25 PM					</a>

				</p>

				<p>Why does a USB stick have a rewriteable firmware? And even more so, why is it rewriteable at any time? That&#8217;s the exact same problem we had with printers not too long ago &#8212; printers getting malicious firmware installed.</p>
<p>Operating systems need to deploy a clippy shield: &#8220;it looks like you plugged in an XYZ. Would you like to use it?&#8221;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232473">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232473">
						October 8, 2014 9:37 PM					</a>

				</p>

				<p>@ Stan</p>
<p>It&#8217;s probably what RobertT taught us years ago. The industry is constantly looking for ways to reuse existing parts or I.P.&#8217;s. The firmware component in the USB stick is probably the same as in other products, maybe a third party vendor. Updateable firmware also allows issues to be fixed via updates instead of expensive hardware redesigns or recalls. So, it makes sense economically. And the result is naturally detrimental to security. As always.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232474">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232474">
						October 8, 2014 10:31 PM					</a>

				</p>

				<p>@ Stan,</p>
<blockquote><p>Why does a USB stick have a rewriteable firmware? And even more so, why is it rewriteable at any time?</p></blockquote>
<p>As Nick P pointed out the reason is based in the economics of the product. More specifically it&#8217;s to do with cost savings on the production line.</p>
<p>The profit in low value high volume (LVHV) fast moving consumer electronics (FMCE) is made on minimum production costs and lost on rework or returns.</p>
<p>Thus even the use of a jumper adds a significant cost of not just the part but the increase in size PCB and Case, and the cost of a user operating it for the five or ten seconds per operation on a bare board (uncased PCB) could easily double the time per item. However a re-work might be on a finished &#8220;cased&#8221; item, the cost in time to open the case without damaging it alone can swallow up any profit.</p>
<p>Put simply the &#8220;security&#8221; of a jumper would add a couple of dollars to the consumer price of the item which for some thumb drives would effectivly double their price&#8230;</p>
<p>So what does the general consumer want, cheap goods or invisable security? We already know the answer to this and security loses every time.</p>
<p>But you also have to consider if the link even if added would do anything&#8230; simple answer is not because it&#8217;s the chip manufacturer that makes the choice and the cost of having an external line on the chip then bonded out is a significant cost.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232476">

			<div class="comment by-grauhut ">

				<p class="commentcredit">

					<span class="commenter">Grauhut</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232476">
						October 9, 2014 2:15 AM					</a>

				</p>

				<p>@Clive Robinson &#8220;Put simply the &#8220;security&#8221; of a jumper would add a couple of dollars&#8221;</p>
<p>Nope, the price of a jumper or dip switch in an automated production environment in china is in the low one digit cent area. There is no device that would bebome unaffordable this way.</p>
<p>alibaba_com/showroom/smd-dip-switch.html</p>
<p>FCC approval has a bigger share on end user prices. 🙂</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232477">

			<div class="comment by-grauhut ">

				<p class="commentcredit">

					<span class="commenter">Grauhut</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232477">
						October 9, 2014 2:18 AM					</a>

				</p>

				<p>@ Anura &#8220;For USB, that doesn&#8217;t solve much as the malware can be installed before you even get it&#8221;</p>
<p>There is no magic malware, just magic mushromms.</p>
<p>A HID malware without HID driver is a dead piece of binary junk.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232478">

			<div class="comment by-dev-null ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://impurist.com/contact.php?m=39386' rel='external nofollow ugc' class='url'>Dev Null</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232478">
						October 9, 2014 3:03 AM					</a>

				</p>

				<p>Maybe, we are all infected. We should make USB devices by ourselves.</p>
<p>DYI time!</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232479">

			<div class="comment by-tm ">

				<p class="commentcredit">

					<span class="commenter">T!M</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232479">
						October 9, 2014 3:08 AM					</a>

				</p>

				<p>I think all data coming through an interface must pass a kind of white-listing process. If the device says it&#8217;s HID, then only actions for HID have to be possible.</p>
<p>Maybe I need a dedicated system just for using USB-Devices and my keyboard will be ps2 again and my mouse serial &#8230; f**k my systems only have usb for this and a ps2-&gt;usb converter wouldn&#8217;t help.<br />
Ok, then I use my computer will all the USB-devices and use remote desktop with rdp/citrix or vnc or teamviewer or whatever &#8230; so my system could get infected (but without the ability to access the internet, because of only allowed to initiate my remote desktop) and I won&#8217;t have a problem with that.</p>
<p>Maybe I have to give this a few more rethink-cycles, because I am sure you have many ideas why this solution isn&#8217;t that helpful I think 🙂</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232481">

			<div class="comment by-andrew_k ">

				<p class="commentcredit">

					<span class="commenter">Andrew_K</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232481">
						October 9, 2014 3:19 AM					</a>

				</p>

				<p>Most fascinating of all is to me the selection of Ruiu as primary target.<br />
It makes me believe that this is not a state development. They would not risk what is happening now: Publication.</p>
<p>Many answers could be find, if Ruiu would be able to reconstruct how he got the initial bad USB device. Bought from stack in a shop? Given at a conference by a fellow hacker? Promotion? Found on the parking lot? Or did he trade USB sticks with someone who was targeted by bigger powers and is blowing a program now?</p>
<p>Anyhow, this is a good day. We learned a new vulnerability so we can target and fix it. Read-only BIOS would be a nice step. Read-only firmware on critical devices, too.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232482">

			<div class="comment by-andrew_k ">

				<p class="commentcredit">

					<span class="commenter">Andrew_K</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232482">
						October 9, 2014 3:38 AM					</a>

				</p>

				<p>@ T!M</p>
<p>I like the idea of device whitelisting. Unfortunately, it won&#8217;t stop code running without the OSs knowledge. In fact, the BIOS is probably infected before the OS even realizes the new device. USB protocol would need a pre-usage-auth which is forwarded to the user for approval.</p>
<p>Your approach of using RDP/&#8230; is what I&#8217;m doing for some years by now. It works quite fine for me, but it&#8217;s more a convenience thing: I can use nearly any machine with Internet access to access my Desktop. Regarding security: Unfortunately, you still type locally. A Keylogger will still see target, username, and password. Thus, I intensively log connections and review them with what I&#8217;ve done and from where connections came.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232484">

			<div class="comment by-tm ">

				<p class="commentcredit">

					<span class="commenter">T!M</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232484">
						October 9, 2014 4:11 AM					</a>

				</p>

				<p>@ Andrew_K</p>
<p>I thought of device whitelisting on a layer outside the OS to be independant of what the OS does or doesn&#8217;t. The pre-usage-auth could be a simple number to say the checking-instance (BIOS or something else) what kind of device it wants to be &#8230; 1=HID Keyboard, 2=HID Mouse, 3=Mass storage, &#8230; , 12=HID Keyboard+Mouse, &#8230;</p>
<p><i>Regarding security: Unfortunately, you still type locally. A Keylogger will still see target, username, and password.</i></p>
<p>Yes, but if nothing but the e.g. ICA-Protocol goes through the firewall to your remote desktop system, the keylogger can&#8217;t give your credentials to someone else and because you work in the remote system the only way to get information of what you are doing remote would be based on screen-capturing &#8230; and even then this information would be useless to know, because it would stay on your thin-client.<br />
A few years ago I played with the good (very) old software I had and installed DOS 5.0 with Win 3.11 (you know the Windows for Workgroup thing;) on a notebook I didn&#8217;t used and with netscape and java-support I could establish a vnc-connection to a WinXP system. That was just for fun, but it worked and actual malware would have problems to run on DOS 5 and Win3.11.<br />
Ok, USB-Support would be a problem in this constellation, but what, if you run the system with e.g. linux and the DOS/WIN3.11-System within a virtual machine. To raise the convenience you could use a tool unter your host-system to create a network-share for usb-devices plugged in and in the guest-system (Win3.11) it gets connected automatically over tcp/ip.</p>
<p>This would be a way to bring new life to the old floppy or CD collection 😉</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232485">

			<div class="comment by-atn ">

				<p class="commentcredit">

					<span class="commenter">ATN</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232485">
						October 9, 2014 4:28 AM					</a>

				</p>

				<p>Am I the only one who read the link under &#8220;been&#8221;? Mostly this sentence:</p>
<blockquote><p>
  Then, when Ruiu removed the internal speaker and microphone connected to<br />
  the airgapped machine, the packets suddenly stopped.
</p></blockquote>
<p>Bruce, did you cut of the microphone of your air-gaped PC &#8211; or do you think it is already too late for that?<br />
That is the first time I heard about networking over high frequency sound, I bet the dogs won&#8217;t like it&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232486">

			<div class="comment by-thoth ">

				<p class="commentcredit">

					<span class="commenter">Thoth</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232486">
						October 9, 2014 7:47 AM					</a>

				</p>

				<p>wouldn&#8217;t be surprised that microphones could be used as covert exfiltration channels. That is another item to be discarded if you want to air-gap a computer unless you have a good reason to have it on.</p>
<p>Another way is to solder in a switch so that without you pushing the switch, it wouldn&#8217;t work.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232487">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232487">
						October 9, 2014 8:38 AM					</a>

				</p>

				<p>@ Grauhut,</p>
<p>You must have at best skim red my comment.</p>
<p>If you go back and read it again you will see,</p>
<blockquote><p>Thus even the use of a jumper adds a significant cost of not just the part but the increase in&#8230;</p></blockquote>
<p>And I go on to list just a few of the effects the addition has that increase the cost of the item which the consumer sees not just the BOM.</p>
<p>As for FCC or CE or other type testing and aproval they add a fixed cost amortized across the entire production run, not an additional cost to each individual item that a jumper or DIP would add.</p>
<p>I&#8217;ve not done FCC testing recently but the last CE testing I did came in at well under 3000USD. I know this is actually high &#8211;as I&#8217;ve done it for a lot less&#8211; but it was a small run and I was in a hurry, Far East costs of testing in house in a more or less automated process is a fraction of this, and done across a production run of a million or so parts is down in the fraction of a cent per item.</p>
<p>FMCE is a funny old game, because what a designer of low quantity production would see as a significant cost is often irrelevant, whilst what they see as a non issue such as a single component placement or orientation can have a very significant production cost. For instance the cost of a &#8220;PCB solder bridge&#8221; that needs to be made during assembly is expensive as it is a violation of the &#8220;No hot work rule&#8221;, thus has to be done on a compleatly different assembly line with differently trained workers and safety systems and quite a few other problems involving amongst others inspection and test as well as increasing rework costs and returns rates&#8230;.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232488">

			<div class="comment by-dan-hough ">

				<p class="commentcredit">

					<span class="commenter">Dan Hough</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232488">
						October 9, 2014 8:52 AM					</a>

				</p>

				<p>OK, doesn&#8217;t this really apply to anything connected to USB that has updatable firmware? Printers, DVD drives, keyboards, hubs? In the end, it seems that unless we fuse the firmware, we will have vulnerabilities. (Code signing too would seem to be risky, if you have an android phone and spend time on XDA, even signed bootloaders are cracked on a regular basis.)</p>
<p>The second thing I see is more malicious. I work for a defense company. And I plug peripherals into my PC that were made in countries that are, for want of a better term, not entirely friendly. How do I know the firmware, even if it was fused, was not contaminated from the get-go? Likewise, the NSA might drop some code in someones peripheral. So we also need behavioral scanners/detectors and we need a much stronger permission structure on USB ports on our PCs. For instance, if a list of capabilities per port were being requested, and my USB stick was asking for the ability to send keystrokes&#8230;I&#8217;d be concerned. Those ports need to be firewalled just like ethernet.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232489">

			<div class="comment by-mrc ">

				<p class="commentcredit">

					<span class="commenter">MrC</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232489">
						October 9, 2014 8:59 AM					</a>

				</p>

				<p>@ T!M:</p>
<p>Merely restricting it-says-it&#8217;s-a-HID devices to HID operations isn&#8217;t going to help. A HID keyboard can open a command prompt and reposition it off the visible screen. It can then run any executable the current user has permissions for and/or run an executable provided by the attacker by typing out binary code converted to base64 and converting it back to binary with powershell (or equivalent). Going the other direction, the num-lock, caps-lock, and scroll-lock LEDs provide a low-bandwidth data channel from the PC to the keyboard.</p>
<p>All of the above applies to a device that presents solely as a keyboard. As I understand it, there&#8217;s some trick to making the same physical device present itself as both a keyboard and a storage device. In which case, the keyboard can just issue commands to move files back and forth to or from the storage device.</p>
<p>This situation with USB is really and truly a mess. I don&#8217;t see how it&#8217;s fixable. For those not hardcore enough to abandon USB outright, the following mental exercise may help as a stopgap: Treat USB devices like hypodermic needles &#8212; remove them from the manufacturer&#8217;s packaging, and then stick them into only one PC ever before trashing them; and never accept one from someone else that&#8217;s not in the manufacturer&#8217;s packaging.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232490">

			<div class="comment by-tm ">

				<p class="commentcredit">

					<span class="commenter">T!M</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232490">
						October 9, 2014 9:38 AM					</a>

				</p>

				<p>@ MrC</p>
<p><i> A HID keyboard can open a command prompt and reposition it off the visible screen.</i></p>
<p>Would you say, that this is something a keyboard should be allowed to do?<br />
If your answer is &#8220;no&#8221;, then this would be a good example for an action blocked by the device-whitelist. If there would be a security check outside the OS-Layer that provides some information to the OS that can give the User the Information &#8220;A USB-keyboard has been attached to Port 01&#8221;, then the user could see if the USB-Christmas-Tree from China uses the USB-Connection only for power or to show itself (to the OS) as something different.</p>
<p><i>All of the above applies to a device that presents solely as a keyboard. As I understand it, there&#8217;s some trick to making the same physical device present itself as both a keyboard and a storage device. </i></p>
<p>I have a programmable USB-Device and can turn it into keyboard (to make input by itself as you described) or mass-storage or both. There is no trick needed and thanks to plug&#8217;n&#8217;pray the device wouldn&#8217;t even need a driver, because the systeme provides it. The bad thing with HID-devices compared to mass storage &#8230; it isn&#8217;t in the usb-devicelist (&#8220;remove hardware&#8221;-icon) at the system-tray.</p>
<p>The problem with mass-storage-devices is, that they have the purpose to receive and provide data. But they shouldn&#8217;t have the right to decided this by themself, I mean without a request from the system/user.</p>
<p>It&#8217;s an interesting discussion I think and the used mechanisms are to complex to become secure in the long run.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232491">

			<div class="comment by-man-with-clue ">

				<p class="commentcredit">

					<span class="commenter">Man with Clue</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232491">
						October 9, 2014 9:56 AM					</a>

				</p>

				<p>&#8220;Bad USB&#8221; isn&#8217;t an attack on the USB device, it&#8217;s an attack on the host computer.  The Git source shows you how to do it yourself.  The <a href="https://hakshop.myshopify.com/products/usb-rubber-ducky-deluxe" rel="nofollow ugc">USB Rubber Ducky</a> physically looks like a USB drive and acts like a keyboard.  Or a drive.  Or both.  Heck, the thing has a 32-bit 60MHz processor!  How many of you remember when something like that was the latest and greatest, fit only for the mightiest of hardware?  (Once upon a time, I yearned for a KIM or AIM 6502 board.)</p>
<p>Here&#8217;s the thing: Moore&#8217;s law is out to get you.  Want a 32-bit processor?  You can get one in an 8-pin DIP chip (<a href="http://www.nxp.com/products/microcontrollers/cortex_m0_m0/lpc800/LPC810M021FN8.html" rel="nofollow ugc">LPC810</a>).  Want to go with a form factor a little larger than a USB stick?  How about the <a href="http://www.adapteva.com/" rel="nofollow ugc">Adapteva Parallella board</a>, featuring a dual-core CPU, and a 16-core coprocessor?  Anything that sports a programmable USB interface will allow the device to look like anything it chooses.</p>
<p>The first thing that the computer does when a USB device (or even a floppy) is inserted is ask, &#8220;how do I work with you?&#8221;  It&#8217;s up to the device to answer honestly.  But what if the device is dishonest?  That&#8217;s the heart of security.  In this case, the USB device can say that it&#8217;s a keyboard, and then <i>just act like one</i>, sending in whatever commands according to a script.  It could be sniffing the bus, waiting for the right moment to do its deeds.  It could delay &#8220;inserting a CD&#8221; and then giving keyboard approval to playing that CD.</p>
<p>At some point we&#8217;ll have USB firewalls.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232492">

			<div class="comment by-paul ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://invisibleturtles.org' rel='external nofollow ugc' class='url'>paul</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232492">
						October 9, 2014 10:02 AM					</a>

				</p>

				<p>If you want programmability on the assembly line but not after, why not a fusible link? In the volume that usb widgets have, the per-unit NRE would be in the noise. (Yes, there are attacks that would work against this, but it would reduce the surface significantly, and make it much harder for infections to spread.)</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232493">

			<div class="comment by-tm ">

				<p class="commentcredit">

					<span class="commenter">T!M</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232493">
						October 9, 2014 10:45 AM					</a>

				</p>

				<p>@ Man with Clue</p>
<p><i>At some point we&#8217;ll have USB firewalls.</i></p>
<p>And now the golden question &#8230; What shall the USB firewalls do that USB devices are no security problem anymore?</p>
<p>I don&#8217;t want more firewalls, security-guards, scanners, detectors &#8230; just to let the complexity of my infrastructure grow, pay much more money to hardware-sellers and consultants only to see how all this stuff becomes hacked through bash-tunnels, trojans, &#8230;, because of insecure implemented security features or well implemented backdoors from whatever.</p>
<p>I want less complexity to raise stability, maintainability, clear borders, obvious ways for access, &#8230;, to get the chance of more security and new trust in the technology we use to drive this techno-world.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232494">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232494">
						October 9, 2014 10:53 AM					</a>

				</p>

				<p>Part of the problem is that at a fundemental level the interface of a USB device just like many others (I2C early Ethernet like 10BT) are a &#8220;shared bus&#8221; architecture, without mandated hardware device selection.</p>
<p>Thus one device can see all the others and if it choses to imitate them. There is nothing the host end controller can do to differentiate the devices as long as they share the same bus.</p>
<p>To stop this then the host USB needs to see each device on a seperate hardware channel not a common channel. Thus USB like similar busses is &#8220;insecure by design&#8221; and there is no way around it.</p>
<p>It is this issue that was part of the reason that later ethernet designs are &#8220;switched&#8221; not on a common channel hub, this enables an appropriately featured managed switch to prevent devices on different physical ports impersonating each other or even see each others traffic.</p>
<p>For security you realy need one hardware channel for each device and for the OS to be able to clearly use the channels to prevent such issues (so no common stacks etc as well).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232495">

			<div class="comment by-mikea ">

				<p class="commentcredit">

					<span class="commenter">MikeA</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232495">
						October 9, 2014 11:00 AM					</a>

				</p>

				<p>The more things change&#8230; The IBM 1620 (late 50&#8217;s early 60s) had a disk controller that honored &#8220;write protect&#8221; per sector, controlled by bits in the sector header. One could only set/clear those with a &#8220;write track&#8221; command, as if formatting the disk. The write-track command, meanwhile, could only be done if a physical key-switch was set to allow it, enforced by the controller hardware. And the OS would nag you to turn it off after manipulating protections, and refuse to do much of anything else until you did. Of course, nowadays that switch would be a dialog box and everybody would just click &#8220;OK&#8221;.</p>
<p>On fusible protect-links, back in the 1990s, my employer had an issue with counterfeit parts. Since the firmware was in an EPROM microcontroller with a read-enable bit, we wondered how it had been copied. Turns out the adversary had figured out how to mask the EPROM area so as to erase only that bit. Possibly with some collateral damage but that just made it take several tries. A similar attack took the simpler method of buying genuine parts from the &#8220;fourth shift&#8221; at the contract manufacturer.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232496">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232496">
						October 9, 2014 11:08 AM					</a>

				</p>

				<p>@ Grauhut</p>
<p>re price of a jumper</p>
<p>Clive&#8217;s argument still stands even at a few cents cost. Multiply that by every product sold. This is the total cost of the feature. Now, ask the following question from perspective of management, &#8220;Can we sell the same amount to the market without that feature?&#8221; If the answer is yes, then that dollar amount shifts from cost to profit. And we know where the priorities stand on profit.</p>
<p>@ T!M</p>
<p>&#8220;dedicated system for using USB devices&#8221;</p>
<p>My old physical security solutions did this. Another person mentioned a Raspberry PI. I used to do it for offloading peripherals, storage and networking onto dedicated, simple systems. That put their code outside the TCB of the main system. The physical interface to host could then be under my control, simpler, and safer. Various mediation could occur.</p>
<p>@ man with clue</p>
<p>&#8220;At some point we&#8217;ll have USB firewalls.&#8221;</p>
<p>They&#8217;ve been available for some time, both software and hardware. Not sure how effective they are as I just did offloading &amp; avoided USB devices.</p>
<p>@ all</p>
<p>The best solution to all these problems is what I&#8217;ve been advocating since I found it: dedicated I/O processors with a baseline I/O protocol and mediation built in. That is how mainframes have worked for decades. The main processor instructs logical chunks of work to be performed, does other work, and eventually is notified when done. A dedicated processor handles all the interrupts, runs I/O programs that do low-level work, splits the work across dedicated channels, and can enforce policies on each channel. The I/O chip itself has DMA, of course. Throw in I/O MMU, device profiling, and protocol engine mods. Now, you have a more secure solution that also has massive utilization and throughput.</p>
<p>Cost varies. It might be an extra core or chip. Embedded chips can do a lot with little power or cost. One for every device would still be inexpensive.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232497">

			<div class="comment by-john-hardin ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.impsec.org/~jhardin/' rel='external nofollow ugc' class='url'>John Hardin</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232497">
						October 9, 2014 11:19 AM					</a>

				</p>

				<p>Questions:</p>
<p>(1) Can the computer that a device is plugged into detect whether the device is compromised?</p>
<p>(2) Can the firmware on a compromised device be overwritten again with clean firmware such that the compromise is <em>reliably</em> removed? Or can the compromised firmware block that action?</p>
<p>If both are true, then it should be possible to write software (I&#8217;m thinking a bootable CD) that you can launch on some low-end potentially-sacrificial USB-enabled box (like one of those ten-year-old laptops collecting dust in the closet) that can be used to inspect and cure any USB device you get before you plug it into your real computer.</p>
<p>I suspect this would require cooperation from the manufacturers, in that they&#8217;d need to provide a way to identify the device, checksums for the current valid firmware, and the current valid firmware itself.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232498">

			<div class="comment by-name-withheld-for-obvious-reasons ">

				<p class="commentcredit">

					<span class="commenter">name.withheld.for.obvious.reasons</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232498">
						October 9, 2014 12:07 PM					</a>

				</p>

				<p>@ Nick P<br />
As you probably suspected, I&#8217;m going to have to chime in here. I find it funny that people won&#8217;t take the time necessary to verify source (AKA Heartbleed) or binary distributions (via hashes, etc). Where does it get better when individuals are not incentivized to ask&#8211;no demand&#8211;manufactures lose their EULA&#8217;s and become accountable for producing what amounts to garbage. If we&#8217;d transpose the problems in terms of our transportation systems where most people got somewhere but more than occasionally we&#8217;d have a airliner, train, or bus disappear from the airways, rails, or streets we might be able to formulate a clearer, more cogent response to this stupidity.  That in most cases under this analogy, people were compromised during their transit form point A-to-B&#8230;Z on a continuous basis&#8211;where would the conversation be?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232499">

			<div class="comment by-man-with-clue ">

				<p class="commentcredit">

					<span class="commenter">Man with Clue</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232499">
						October 9, 2014 12:22 PM					</a>

				</p>

				<p>@T!M, Nick P:<br />
The USB firewalls currently <i>don&#8217;t</i> protect against this kind of attack, where the device is an &#8220;evil keyboard.&#8221;</p>
<p>What is needed is for the host to evaluate the device&#8217;s BIOS, and then compare its checksum against the manufacturer&#8217;s published checksum.  Then you have a higher assurance that things are OK.  However, if the device has enough sophistication, <i>it will fully mimic a good device.</i></p>
<p>At home I have a couple of old Lexar 128Mb USB sticks, and they have write-protect switches on them.  However, I don&#8217;t know if these also protect the controller&#8217;s BIOS.</p>
<p>Here&#8217;s the point: the device acts as if the malicious user were sitting at the computer, typing and loading things.  Now, aside from a typing speed of 1,000,000 words per minute, how does the OS know that it isn&#8217;t <i>you</i> at the keyboard?  When I sit down to help other people with their computers, what would raise a flag that an expert instead of an idiot is at the keyboard, or if the idiot is following instructions from a book?</p>
<p>What&#8217;s especially pernicious about something like a hostile, intelligent USB device is that it can emulate multiple devices.  Keyboard, mouse, USB drive, networking device, <i>anything the attacker likes!</i>  The only defense is to disable the USB ports.</p>
<p>@John Hardin:<br />
Here&#8217;s the problem:  <i>all keyboards look alike</i>. Yeah, sure, they&#8217;re supposed to have individual identities, but when something like Bad USB or USB Rubber Ducky is plugged in, there&#8217;s no way for the host to know that the device is misidentifying itself.  Even something like commanding it to read the BIOS means that the device may be honest, <i>and it may not be honest</i>.  Some keyboards have programmable macros.  What&#8217;s the difference between BUSB/URD and a keyboard with hardware macros?  There is no out-of-channel verification of the device.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232500">

			<div class="comment by-john-hardin ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.impsec.org/~jhardin/' rel='external nofollow ugc' class='url'>John Hardin</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232500">
						October 9, 2014 12:35 PM					</a>

				</p>

				<p>@Clue:</p>
<p>Yeah, that&#8217;s one thing I was wondering: would the malware save off a full copy of the valid firmware somewhere and return that when asked to dump it (assuming getting a firmware dump from a USB device is even possible)?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232501">

			<div class="comment by-johan-wigzell ">

				<p class="commentcredit">

					<span class="commenter">Johan Wigzell</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232501">
						October 9, 2014 2:02 PM					</a>

				</p>

				<p>Looking at that GitHub page linked to by Bruce, the USB firmware is (at least in some cases, if not always) on a NAND flash chip. Is it possible to even set this type of chip as read-only?</p>
<p>Would an EEPROM be safer than a NAND flash chip?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232502">

			<div class="comment by-man-with-clue ">

				<p class="commentcredit">

					<span class="commenter">Man with Clue</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232502">
						October 9, 2014 3:09 PM					</a>

				</p>

				<p>@John Hardin:</p>
<p>It&#8217;s hard to say if possible malware would save off a copy of the device&#8217;s firmware or not, because it depends on the controller.  Some controllers only allow write updates to their internal firmware, some don&#8217;t.  The only way to actually disable writes to a NAND is lift and then tie off the R/W pin.  If the NAND is internal to the device, then there may be no way it can be made read-only.</p>
<p>@Everybody:<br />
<a href="https://learn.adafruit.com/hacking-the-kinect" rel="nofollow ugc">Adafruit has a nice article</a> on what was done to start reverse engineering the driver for the Microsoft Kinect.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232503">

			<div class="comment by-mr-c ">

				<p class="commentcredit">

					<span class="commenter">Mr. C</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232503">
						October 9, 2014 4:15 PM					</a>

				</p>

				<p>@ T!M</p>
<p><i>Would you say, that this is something a keyboard should be allowed to do?</i></p>
<p>Afraid so. Unless you&#8217;re willing to make a mouse mandatory (which only shifts the problem to another HID device), the keyboard needs to be able to run executables (including the command prompt) and move windows around the screen. The real problem lies in the windowing system allowing windows to be moved all the way off the visible screen.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232504">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232504">
						October 9, 2014 4:19 PM					</a>

				</p>

				<p>@ name.withheld</p>
<p>Liability and market expectations would help a lot. The market doesn&#8217;t demand it though. I&#8217;ve blamed users <a href="https://www.schneier.com/blog/archives/2011/06/yet_another_peo.html#c556377" rel="nofollow ugc">previously</a>, and coincidentally a USB story. The closest thing we have are the niche companies that warranty the quality of their systems or software. Then, there&#8217;s service level agreements in that sector. Of course, Common Criteria Protection Profiles show that vendors need some formal standard with features and assurance activities to go by. So, for USB, a full threat analysis would be needed along with proposals on features and activities to catch problems. It would be certified by 3rd party pen testers. If warrantied, the quality would be high to reduce their liability. We see this in the DO-178B market.</p>
<p>@ Man with Clue</p>
<p>&#8220;The USB firewalls currently don&#8217;t protect against this kind of attack, where the device is an &#8220;evil keyboard.&#8221;&#8221;</p>
<p>I was just saying USB firewalls exist. Like other firewalls, they stop some attacks and not others. A USB keyboard attack to bypass DLP was published online many years ago. So, the same vector working again is just evidence of the industry not learning from its mistakes.</p>
<p>&#8220;Now, aside from a typing speed of 1,000,000 words per minute, how does the OS know that it isn&#8217;t you at the keyboard?&#8221;</p>
<p>Require authentication. The USB device isn&#8217;t trusted until the password comes from it.</p>
<p>&#8220;The only defense is to disable the USB ports.&#8221;</p>
<p>Or use a USB chipset and stack that restricts what a USB port can do. Assign one a keyboard function, one a mouse function, etc. IOMMU&#8217;s and well-designed TCB&#8217;s restrict them from there. I also advocate things like USB be disabled by default at system boot, then enabled only if the system chooses. And then restricted.</p>
<p>@ Mr. C</p>
<p>The keyboard and mouse only need to send input to a subsystem that collects it. The system can be designed to enforce POLA on that subsystem. This is how it was done in the old &#8220;trusted&#8221; window systems and more recent Nitpicker. Each component does one thing, is accessed through careful interface, only can access what it&#8217;s supposed to access, and so on. Combine this with my recommendations above and attacks like this are prevented by design with minimal inconvenience to user.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232505">

			<div class="comment by-grauhut ">

				<p class="commentcredit">

					<span class="commenter">Grauhut</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232505">
						October 9, 2014 4:52 PM					</a>

				</p>

				<p>@Nick P &#8220;Clive&#8217;s argument still stands even at a few cents cost. Multiply that by every product sold. This is the total cost of the feature.&#8221;</p>
<p>Thats simple. Have a law that makes shure that on every hardware item containing firmware and its package has to be a sticker, green or red:</p>
<p>&#8220;Contains hardware protection against firmware manipulation&#8221; or a sticker</p>
<p>&#8220;Insecure: Does not contain hardware protection against firmware manipulation!&#8221;.</p>
<p>As easy as with cigaret boxes, the marketing department will then tell the production guys what kind of sticker it wants&#8230; 🙂</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232506">

			<div class="comment by-jeff ">

				<p class="commentcredit">

					<span class="commenter">Jeff</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232506">
						October 9, 2014 5:17 PM					</a>

				</p>

				<p>I wish these articles would specify what they mean my &#8220;PC.&#8221;  Is it any computer running Windows, or does it include Mac OS, and others?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232507">

			<div class="comment by-sancho_p ">

				<p class="commentcredit">

					<span class="commenter">Sancho_P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232507">
						October 9, 2014 5:46 PM					</a>

				</p>

				<p>@ Anura:</p>
<p><i>“If you plug a USB thumb drive into a port on the same controller as your keyboard or wifi card, it can snoop all of that information or spoof the device (e.g. it can steal your password, and then run commands with root access on your machine by spoofing your keyboard).”</i></p>
<p>Are you sure?<br />
I thought USB is always broadcast from host to ports, but unicast from single port to host, so the thumb drive could not directly listen to the keyboard data. However, data sent to a USB WLAN adapter can be seen by the thumb drive or keyboard &#8211; assuming they all share the same chip (e.g. a one to four USB hub / controller chip like the TUSB2046B) ?<br />
<a href="http://www.ti.com/lit/ds/symlink/tusb2046b.pdf" rel="nofollow ugc">http://www.ti.com/lit/ds/symlink/tusb2046b.pdf</a></p>
<p>Clive Robinson also hinted to the <i>”… &#8220;shared bus&#8221; architecture, without mandated hardware device selection”</i>, which is IMO correct for the host sending to a port, because there are only logical pipes to separate the ports. Imitating wouldn’t work (or isn’t the correct term), as answering as an existing device would result in garbage. You can have several “keyboards” at once, of course.</p>
<ul>
<li>
<ul>
<li>
<ul>
<li>Please apologize, I’m not deep in that hardware, correct me if I’m wrong! &#8211; &#8211; &#8211;</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><i>”switched”</i> &#8211; I’ve heard of some routers with special switches. So encryption is the only way out of that tar-pit.</p>
<p><i>“so no common stacks etc as well”</i> is excellent, but I’m afraid ….</p>
<p>.<br />
@ Paul (fusible):<br />
Because you’d have to touch the device anyway after production, even if it must not be updated. $$<br />
And it’s lost when a problem arises at the shop / customer, during warranty. $$$$<br />
One problem here is we’re talking about mass production and super sophisticated malware devices in one pot.</p>
<p>.<br />
@ Jeff:<br />
The topic is “USB”, so if your “PC” supports USB it is included.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232508">

			<div class="comment by-name-withheld-for-obvious-reasons ">

				<p class="commentcredit">

					<span class="commenter">name.withheld.for.obvious.reasons</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232508">
						October 9, 2014 5:49 PM					</a>

				</p>

				<p>@ Nick P</p>
<blockquote><p>If warrantied, the quality would be high to reduce their liability. We see this in the DO-178B market.</p></blockquote>
<p>Having spent some time in high assurance manufacturing and systems integration and I see two downsides to ISO15408 and DOB-178B, complacency and a lack of continuous SPC and robust QA/QC departments and personnel.  Some of the problem are in the architectural and design engineering process. I was agassed at an engineering and design meeting at the implementation on an aircraft platform that uses real-time Java (oxymoron of course). The primary vendor could not be questioned in the meeting as I&#8217;d piss the customer off (I do that a lot).</p>
<p>We need some independent but cross verified standards and quality process. Where a high spirited and robust third party counter-verifies process and standards say against a NIST body. ISO is enough when you consider just how the audit procedures and methods lead to less than a clear understanding of where an organization is it. In fact, my new business model provides for a robust and &#8220;through-the-organization&#8221; view at any time. Kind is a process control structure as part of the business model.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232509">

			<div class="comment by-larson ">

				<p class="commentcredit">

					<span class="commenter">Larson</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232509">
						October 9, 2014 5:56 PM					</a>

				</p>

				<p>At least the Kanguru USB drives seem to be protected against BadUSB&#8230;</p>
<p><b>Concerned about &#8220;BadUSB?&#8221; Don&#8217;t Be. Kanguru Has You Covered</b><br />
<a href="http://store.kanguru.com/blogs/gurublog/15235873-concerned-about-badusb-dont-be-kanguru-has-you-covered" rel="nofollow ugc">http://store.kanguru.com/blogs/gurublog/15235873-concerned-about-badusb-dont-be-kanguru-has-you-covered</a></p>
<blockquote><p>
By design, Kanguru&#8217;s firmware on Defender® secure hardware encrypted flash drives, hard drives, and solid state drives are inherently protected with what is called digitally signed secure firmware. This fundamental feature makes it nearly impossible for any firmware-based attack to be successful on Kanguru&#8217;s secure USB drives, making them the most trusted USB devices on the market.
</p></blockquote>
<blockquote><p>
Kanguru&#8217;s hardware encrypted drives are designed in compliance with NIST requirements of digitally signing the device firmware, and is verified through a rigorous process known as FIPS 140-2 certification.
</p></blockquote>
<blockquote><p>
Because the secure firmware is verified with a self-test on start-up, if any attempt were made to tamper with the firmware on a Kanguru secure drive, the USB device simply would not function. Kanguru&#8217;s FIPS 140-2 Certified Kanguru Defender 2000 and Defender Elite200 have even more advanced protections that make them perfect for government, financial and enterprise organizations.
</p></blockquote>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232510">

			<div class="comment by-sancho_p ">

				<p class="commentcredit">

					<span class="commenter">Sancho_P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232510">
						October 9, 2014 6:09 PM					</a>

				</p>

				<p>I do not share the sentiment of “USB is evil”.<br />
We want UNIVERSAL devices with UNIVERSAL extensions. For all gadgets.<br />
From keyboard and LAN adapter to host to host … and cheap (the latter should be mentioned in the first place !!!).<br />
For the “one fits all is cheap” most USB devices must be field programmable.<br />
A jumper or such is wasted money as the “evil” USB device / firmware will ignore it anyway.<br />
You never know what is inside the device you are going to connect, this is not a USB problem only.</p>
<p>So the only conclusion is: The master + host must be cautious.<br />
In case of an HID keyboard: I’m really glad when the BIOS accepts it as input device, otherwise I could not boot my simple machine using a pwd.<br />
However, booting from a thumb drive must be possible (ehm, not so easy nowadays) into any so called OS &#8211; but not without warning <b>from the BIOS</b>.</p>
<p>But those who boot from USB must not expect to flash their BIOS without any notice and request of confirmation from their existing BIOS.</p>
<p>Master (human) + host (device + so called OS) are responsible in case of a breach.</p>
<p>For the host I see the manufacturer accountable, in contrast to it’s “perfectly legal” fine print (yes, liability would be necessary &#8211; but this is too late now. Remember “Too big to fail”).</p>
<p>.<br />
Now the just attached USB device identifies as a keyboard and starts to send keystrokes into that so called “OS”.<br />
This is the same situation as the user would start any executable from the device.</p>
<p>It is not wrong for a device to behave like a keyboard with storage, it might be legit, keep in mind this is a UNIVERSAL interface as we urged it.<br />
However, USB has not DMA, as FireWire and TB have &#8211; a dangerous idea for any machine.</p>
<p>And please, do not ask my neighbor “May &#8216;Christmas Tree&#8217; also behave like a keyboard? Y/N ”<br />
Yes, he would confirm with pwd when asked for (he’s 82).</p>
<p>For the USB we’d have an OS to watch <b>and guard</b> &#8211; if we only had an OS.<br />
We need an OS, not only USB firewalls (I fully agree with the rest @ Man with Clue).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232511">

			<div class="comment by-anura ">

				<p class="commentcredit">

					<span class="commenter">Anura</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232511">
						October 9, 2014 6:28 PM					</a>

				</p>

				<p>@Sancho_P</p>
<p>You are probably right, I wasn&#8217;t thinking about the direction of the traffic.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232512">

			<div class="comment by-paul ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://invisibleturtles.org' rel='external nofollow ugc' class='url'>paul</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232512">
						October 9, 2014 6:42 PM					</a>

				</p>

				<p>There are two (at least) attack scenarios we have to think about here. In one, the bad device was &#8220;born bad&#8221; and intended for attack. In that case, the attacker is limited only by their own ingenuity and hardware resources: they can get a copy of the device they&#8217;re attempting to impersonate, make a copy of its firmware, analyze its security and so forth. And even if the device (say, a mouse or keyboard) doesn&#8217;t normally have megabytes of nonvolatile memory to store impersonating information in, they can add that to their evil counterfeit fairly easily.</p>
<p>The other scenario, where an infected or malicious PC converts a &#8220;good&#8221; USB controller to the dark side, will be limited by the resources available in the device it&#8217;s corrupting. For a keyboard or a mouse, that means the controller&#8217;s code and data memory (which may still be enough to carry out some very interesting attacks). For a thumb drive, that&#8217;s the controller&#8217;s memory and most of the memory of the flash chips, but no sensors or actuators (unless you can figure out how to read something interesting from the status LED).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232513">

			<div class="comment by-adjuvant ">

				<p class="commentcredit">

					<span class="commenter">Adjuvant</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232513">
						October 9, 2014 7:11 PM					</a>

				</p>

				<p>@Larson Good catch. Looks like they also feature a physical write-protect switch (which I haven&#8217;t really seen anywhere else since the Imation Clip disappeared). I see they also offer a less exorbitantly-priced alternative for those who could take or leave the hardware encryption: <cite>Kanguru FlashTrust™ USB 3.0 flash drive is the world’s first unencrypted, USB 3.0 flash drive with onboard, trusted secure firmware</cite>. Useful to know as <a href="http://www.fencepost.net/2010/03/usb-flash-drives-with-hardware-write-protection/" rel="nofollow ugc">this list</a> of drives with write-protection becomes increasingly stale. (Now I&#8217;ll just wait for the first report of someone circumventing it.)</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232514">

			<div class="comment by-adjuvant ">

				<p class="commentcredit">

					<span class="commenter">Adjuvant</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232514">
						October 9, 2014 8:09 PM					</a>

				</p>

				<p>Hmm. This is distressing (from comments on the link I just shared):<br />
<a href="http://www.fencepost.net/2010/03/usb-flash-drives-with-hardware-write-protection/comment-page-1/#comment-239426" rel="nofollow ugc">http://www.fencepost.net/2010/03/usb-flash-drives-with-hardware-write-protection/comment-page-1/#comment-239426</a></p>
<p>Citing <a href="https://kanguru.zendesk.com/entries/24752223-SS3-physical-write-protect-switch-not-working" rel="nofollow ugc">this complaint</a>:</p>
<blockquote><p><cite>[Q:] When I slide the the write-protect switch to the locked position while the SS3 is connected to the computer, I am still able to write/delete data on the drive.</cite></p>
<p>[A:] The SS3&#8217;s write-protection switch must be set in either the locked or unlocked position BEFORE connecting it to your computer. Once the device is connected to a computer, it will remain in whichever state it is set in regardless of whether you change the switch position.</p></blockquote>
<p>The commenter states:</p>
<blockquote><p>I’m no EE, electronics hobbyist, etc – I’d been operating under the (naive) assumption that write-protect switches enable/disable a conductor/line that a write signal is sent over. Seems I’m wrong. </p></blockquote>
<p>Sounds like an overly complex implementation, with potential unknown weaknesses. Maybe the only way to be sure is to disassemble and physically inspect &#8212; or <a href="http://www.edaboard.com/thread264787.html" rel="nofollow ugc">do it yourself</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232515">

			<div class="comment by-john-hardin ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.impsec.org/~jhardin/' rel='external nofollow ugc' class='url'>John Hardin</a></span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232515">
						October 10, 2014 1:28 PM					</a>

				</p>

				<blockquote><p><i>The SS3&#8217;s write-protection switch must be set in either the locked or unlocked position BEFORE connecting it to your computer. Once the device is connected to a computer, it will remain in whichever state it is set in regardless of whether you change the switch position.</i></p></blockquote>
<p>Ok, so their &#8220;hardware write protection&#8221; is actually only a <i>suggestion to the firmware</i>. The only &#8220;hardware&#8221; involved is the switch.</p>
<p>Boo!</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232516">

			<div class="comment by-ronk ">

				<p class="commentcredit">

					<span class="commenter">RonK</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232516">
						October 12, 2014 6:39 AM					</a>

				</p>

				<p>@ Dev Null</p>
<blockquote><p>
  DYI time!
</p></blockquote>
<p>Exactly what I thought, but with a totally different meaning: I&#8217;ve been waiting for something like this to pop up, so that I&#8217;d be able to use cheap USB fobs as embedded devices. Bunnie Huang&#8217;s idea of removing the encapsulation to get at the controllers wasn&#8217;t exactly what I was longing for. (And actually the original disclosure claimed that the vulnerability was developed in order to use these fobs as a hardware-accelerated A5/1 rainbow table.)</p>
<p>Of course, the vulnerability itself would probably limit the usefulness&#8230; I&#8217;ll have to do some research.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232519">

			<div class="comment by-nota ">

				<p class="commentcredit">

					<span class="commenter">nota</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232519">
						November 8, 2014 3:48 AM					</a>

				</p>

				<p>Moderately paranoid solution to having a computer know if it&#8217;s you at the keyboard: One time &#8220;password&#8221; captcha-like authentication. You go on your computer and plug in your keyboard, it asks you to type out &#8220;FfyanAp&#8221; or something. Once you do that, the device is authenticated until you leave. You can repeat that process each time. A normal password would not be a good idea because a malicious keyboard could just sniff it, but there&#8217;s no (realistic) way a malicious keyboard could know what&#8217;s on the screen, unless they are given access and can load malware to do screencaps.</p>
<p>For the more paranoid, grsecurity&#8217;s &#8220;deny new USB devices at toggle&#8221; sysctl option (kernel.grsecurity.deny_new_usb) is a better solution, albeit one that, once toggled to 1, deny all new USB devices at the kernel level until reboot. Since this disables <em>all</em> ehci/xhci drivers and has the kernel completely ignore any USB devices, rather than refuse them, it ensures that more advanced exploits which take advantage of compromising the actual driver directly and gaining instant ring 0 access would fail.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232520">

			<div class="comment by-adam-danischewski ">

				<p class="commentcredit">

					<span class="commenter">Adam Danischewski</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232520">
						February 2, 2015 2:42 PM					</a>

				</p>

				<p>@Sancho_P</p>
<blockquote>
<blockquote>
<blockquote><p>
      &#8220;A jumper or such is wasted money as the “evil” USB device / firmware will ignore it anyway.&#8221;
    </p></blockquote>
</blockquote>
</blockquote>
<p>That is not necessarily true, it can be designed such that no software based firmware updates are possible without the jumper settings being appropriate.</p>
<p>@Clive &#8220;Put simply the &#8220;security&#8221; of a jumper would add a couple of dollars to the consumer price of the item&#8221;</p>
<p>I agree with Grauhut, the cost is practically negligible in the low cent[s] not dollars range.</p>
<p>A jumper would probably solve most of these problems rather easily yet it would make firmware based remote espionage comparatively expensive. It is extremely convenient for state espionage agencies to be able to deploy and access firmware based surveillance.</p>
<p>If you think its paranoia to consider this angle, please read the available documentation with regards to how many huge well-known tech companies are funded by In-Q-Tel / CIA.</p>
<p><a href="http://www.businessinsider.com/25-cutting-edge-companies-funded-by-the-central-intelligence-agency-2012-8" rel="nofollow ugc">25 Cutting Edge Companies Funded by the CIA</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232521">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232521">
						February 2, 2015 5:05 PM					</a>

				</p>

				<p>@ Adam Danischewski,</p>
<blockquote><p>I agree with Grauhut, the cost is practically negligible in the low cent[s] not dollars range.</p></blockquote>
<p>And that statment tells me why neither you or Grauhut have worked in FMCE or other very cost sensitive manufacturing market.</p>
<p>Whilst the pins and jumper link would be cents as component parts, for a security application it can not just be connected to a CPU IO line as that would be for software only and could thus be ignored. It actually needs to work in the hardware side of the write circuitry to not be bypassed by software, and there are implications to this with modern data rates.</p>
<p>But even if that was not an issue, it requires space on the PCB which means quite a few things, such as the board will be larger or more difficult to layout and importantly requires extra work for the &#8220;pick and place&#8221; machine or assembler. It also means you have to consider where on the PCB it will be with regards external access through the case, this means that to be approved for CE it means having a cover that&#8217;s not removable as it could be indirectly connected to a voltage that brings it into the LVD requirments. This means considerably more expensive tooling etc. Then there is the increase in rework costs as jumpers increase the fail rate down the production line. Further there are replacment / returns costs as such jumpers do cause an increase in failure to the consumer in transit. Oh and don&#8217;t forget it will need written instructions printed somewhere in or on the packaging&#8230;</p>
<p>These add tens of cents to the BOM that multiply up due to various mark ups and taxes etc to ten or twenty times that on the retail price the consumer pays. Which is why I very specifically said &#8220;&#8230;would add a couple of dollars to the consumer price&#8230;&#8221;.</p>
<p>Now personaly I realy don&#8217;t care if you belive me or not, because you are not working as a designer in that market. Because you ould know that those sorts of details decide if the product is going to be profitable or not in a very very competative market. I&#8217;ve designed for that FMCE market and thus have had to go through the process several times, which is why I know.</p>
<p>And odd things happen, such that it&#8217;s less expensive over all to fit a slide switch that actually costs more as a component part than the link pins and jumper, because it reduces the cost of case tooling, placing and testing down the line as well as reducing the cost of rework and returns.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-232522">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232522">
						February 2, 2015 6:18 PM					</a>

				</p>

				<p>Re USB drives and jumpers</p>
<p>Clive&#8217;s right if the device is very tiny. Larger ones, from PC&#8217;s to industrial boards, might add things like jumpers if they see a real marketable benefit to justify less profit. Plus, a rule of thumb of mine says market almost always defaults on security theater if it&#8217;s cheaper than the real thing.</p>
<p>You combine these principles you get &#8220;secure&#8221; USB sticks with insecure crypto implementations, firmware, and do on. The write protect being firmware implemented let&#8217;s them keep costs down by reusing an existing, cheap SOC. &#8220;Authenticated firmware&#8221; stopping all attacks just&#8230; makes no sense. That they think lower level FIPS 140-2 proves anything supports that they&#8217;re probably bullshitters.</p>
<p>The easiest way to secure USB is to put the write-protect feature in either the USB physical IP or A physical switch in front of it. This would be in all the licensed IP cores with it off by default. Those making use of it could have a pin and physical switch connected to it. Switch also connects to microcontroller so it knows WP is active. Once USB is ASIC proven and gets in SOC&#8217;s, the security feature starts spreading to every device that uses it.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-232523">

			<div class="comment by-elvis ">

				<p class="commentcredit">

					<span class="commenter">Elvis</span> •

					<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/#comment-232523">
						June 26, 2015 7:17 AM					</a>

				</p>

				<p>Kanguru has FlashTrust; signed with 2048-bit RSA firmware or something or other; not sure how that&#8217;s supposed to work though. Try going to an airport and saying &#8220;Good evening, sir! I&#8217;m not a terrorist! You can trust me, because I said so!&#8221;</p>
<p>A much simpler way is to have a 2-pin header (they don&#8217;t even have to be large either; 2.54mm pitch shunts are very small) physically present. Depending on whether the two pins are shorted (eg. with a jumper shunt) the firmware update will be allowed or disallowed.</p>
<p>But nope, corporate IT mindset is &#8220;we need bells and whistles for our security!&#8221;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

	<p class="subscribe-comments">
		<a href="https://www.schneier.com/blog/archives/2014/10/badusb_code_has.html/feed/">
			<img alt="Atom Feed" src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/rss.png">
			Subscribe to comments on this entry		</a>
	</p>

		<div id="respond" class="comment-respond">
		<h2 class="comments-open-header">Leave a comment <small><a rel="nofollow" id="cancel-comment-reply-link" href="/blog/archives/2014/10/badusb_code_has.html#respond" style="display:none;">Cancel reply</a></small></h2><form action="https://www.schneier.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><a href="https://www.schneier.com/wp-login.php?redirect_to=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2014%2F10%2Fbadusb_code_has.html" title="Login">Login</a><p class="comment-form-author"><label for="author">Name</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" /></p>
<p class="comment-form-email"><label for="email">Email</label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" /></p>
<p class="comment-form-url"><label for="url">URL:</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p>
<p class="comment-form-cookies-consent"><input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox" value="yes" /> <label for="wp-comment-cookies-consent">Remember personal info?</label></p>

<p class="comment-form-author">

	<label for="comm_capt_challenge">
		Fill in the blank: the name of this blog is Schneier on ___________ (required):	</label>

	<input id="comm_capt_challenge" name="comm_capt_challenge" size="30" type="text" />
</p>

<div class="comment-form-comment">

	<label for="comment">Comments:</label>

	<textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea>

	<div id="preview-box" class="preview-box hide"></div>
	<img class="comment-loading hide" src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/loader.gif" />

</div>

<p id="allowed">

	<strong>Allowed HTML</strong>
	&lt;a href=&quot;URL&quot;&gt; &bull; &lt;em&gt; &lt;cite&gt; &lt;i&gt; &bull; &lt;strong&gt; &lt;b&gt; &bull; &lt;sub&gt; &lt;sup&gt; &bull; &lt;ul&gt; &lt;ol&gt; &lt;li&gt; &bull; &lt;blockquote&gt; &lt;pre&gt;
	<strong>Markdown Extra</strong> syntax via <a href="https://michelf.ca/projects/php-markdown/extra/">https://michelf.ca/projects/php-markdown/extra/</a>
</p>

<input type="hidden" id="wp_comment_nonce" name="wp_comment_nonce" value="4b1534b792" /><input type="hidden" name="_wp_http_referer" value="/blog/archives/2014/10/badusb_code_has.html" />
<input type="button" id="comment-preview" class="comment-preview comment-actions" value="Preview" />
<input type="button" id="comment-write" class="comment-write comment-actions hide" value="Edit" />

<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Submit" /> <input type='hidden' name='comment_post_ID' value='6356' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p></form>	</div><!-- #respond -->
	
	<div class="stepthrough">
		<a href="https://www.schneier.com/blog/archives/2014/10/data_and_goliat.html" rel="prev">← <i>Data and Goliath</I> Is Finished</a>		<a href="https://www.schneier.com/blog/archives/2014/10/usb_cufflinks.html" rel="next">USB Cufflinks →</a>	</div>

	
<p id="powered">Sidebar photo of Bruce Schneier by Joe MacInnis.</p>
		</div>

		
<aside>
	<div class="sidebar" id="sidebar-two">
		<section><div class="sidesection widget widget_schneier_about" id="schneier_about-2"><h3>About Bruce Schneier</h3><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/Bruce-Schneier.jpg" /><p><p class="small">I am a <a href="https://public-interest-tech.com/">public-interest technologist</a>, working at the intersection of security, technology, and people. I've been writing about security issues on my <a href="/">blog</a> since 2004, and in my monthly <a href="/crypto-gram/">newsletter</a> since 1998. I'm a fellow and lecturer at Harvard's <a href="https://www.hks.harvard.edu/faculty/bruce-schneier">Kennedy School</a>, a board member of <a href="https://www.eff.org/">EFF</a>, and the Chief of Security Architecture at <a href="https://inrupt.com/">Inrupt, Inc.</a> This personal website expresses the opinions of none of those organizations.</p>
</p></div></section><section><div class="sidesection widget widget_schneier_related_posts" id="schneier_related_posts-2"><h3>Related Entries</h3>
<ul>

	<li><a href="https://www.schneier.com/blog/archives/2021/03/illegal-content-and-the-blockchain.html">Illegal Content and the Blockchain</a></li><li><a href="https://www.schneier.com/blog/archives/2021/03/national-security-risks-of-late-stage-capitalism.html">National Security Risks of Late-Stage Capitalism</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/weis-2021-call-for-papers.html">WEIS 2021 Call for Papers</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/ransomware-profitability.html">Ransomware Profitability</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/presidential-cybersecurity-and-pelotons.html">Presidential Cybersecurity and Pelotons</a></li><li><a href="https://www.schneier.com/blog/archives/2021/01/police-have-disrupted-the-emotet-botnet.html">Police Have Disrupted the Emotet Botnet</a></li>
</ul>
</div></section><section><div class="sidesection widget widget_schneier_featured_essays" id="schneier_featured_essays-2"><h3>Featured Essays</h3>
	<ul>
		<li><a href="https://www.schneier.com/essays/archives/2016/04/the_value_of_encrypt.html">The Value of Encryption</a></li><li><a href="https://www.schneier.com/essays/archives/2016/03/data_is_a_toxic_asse.html">Data Is a Toxic Asset, So Why Not Throw It Out?</a></li><li><a href="https://www.schneier.com/essays/archives/2014/01/how_the_nsa_threaten.html">How the NSA Threatens National Security</a></li><li><a href="https://www.schneier.com/essays/archives/2009/01/terrorists_may_use_g.html">Terrorists May Use Google Earth, But Fear Is No Reason to Ban It</a></li><li><a href="https://www.schneier.com/essays/archives/2007/01/in_praise_of_securit.html">In Praise of Security Theater</a></li><li><a href="https://www.schneier.com/essays/archives/2006/08/refuse_to_be_terrori.html">Refuse to be Terrorized</a></li><li><a href="https://www.schneier.com/essays/archives/2006/05/the_eternal_value_of.html">The Eternal Value of Privacy</a></li><li><a href="https://www.schneier.com/essays/archives/2005/09/terrorists_dont_do_m.html">Terrorists Don&#039;t Do Movie Plots</a></li>	</ul>

	<p><a href="https://www.schneier.com/essays/">More Essays</a></p></div></section><section><div class="sidesection widget widget_schneier_archives" id="schneier_archives-2"><h3>Blog Archives</h3>
<ul>

	<li><a href="https://www.schneier.com/blog/calendar.html/">Archive by Month</a></li><li><a href="https://www.schneier.com/blog/newcomments.html/">100 Latest Comments</a></li></ul>

<h4>Blog Tags</h4><ul class="top-tags"><li><a href="https://www.schneier.com/tag/3d-printers/">3d printers</a></li><li><a href="https://www.schneier.com/tag/9-11/">9/11</a></li><li><a href="https://www.schneier.com/tag/aaron-swartz/">Aaron Swartz</a></li><li><a href="https://www.schneier.com/tag/academic/">academic</a></li><li><a href="https://www.schneier.com/tag/academic-papers/">academic papers</a></li><li><a href="https://www.schneier.com/tag/accountability/">accountability</a></li><li><a href="https://www.schneier.com/tag/aclu/">ACLU</a></li><li><a href="https://www.schneier.com/tag/activism/">activism</a></li><li><a href="https://www.schneier.com/tag/adobe/">Adobe</a></li><li><a href="https://www.schneier.com/tag/advanced-persistent-threats/">advanced persistent threats</a></li><li><a href="https://www.schneier.com/tag/adware/">adware</a></li><li><a href="https://www.schneier.com/tag/aes/">AES</a></li><li><a href="https://www.schneier.com/tag/afghanistan/">Afghanistan</a></li><li><a href="https://www.schneier.com/tag/air-marshals/">air marshals</a></li><li><a href="https://www.schneier.com/tag/air-travel/">air travel</a></li><li><a href="https://www.schneier.com/tag/airgaps/">airgaps</a></li><li><a href="https://www.schneier.com/tag/al-qaeda/">al Qaeda</a></li><li><a href="https://www.schneier.com/tag/alarms/">alarms</a></li><li><a href="https://www.schneier.com/tag/algorithms/">algorithms</a></li><li><a href="https://www.schneier.com/tag/alibis/">alibis</a></li><li><a href="https://www.schneier.com/tag/amazon/">Amazon</a></li><li><a href="https://www.schneier.com/tag/android/">Android</a></li><li><a href="https://www.schneier.com/tag/anonymity/">anonymity</a></li><li><a href="https://www.schneier.com/tag/anonymous/">Anonymous</a></li><li><a href="https://www.schneier.com/tag/antivirus/">antivirus</a></li><li><a href="https://www.schneier.com/tag/apache/">Apache</a></li><li><a href="https://www.schneier.com/tag/apple/">Apple</a></li><li><a href="https://www.schneier.com/tag/applied-cryptography/">Applied Cryptography</a></li><li><a href="https://www.schneier.com/tag/artificial-intelligence/">artificial intelligence</a></li><li><a href="https://www.schneier.com/tag/assassinations/">assassinations</a></li></ul><p><a href="https://www.schneier.com/blog/tags.html/">More Tags</a></p></div></section><section><div class="sidesection widget widget_schneier_latest_book" id="schneier_latest_book-3"><h3>Latest Book</h3><a href="https://www.schneier.com/books/click-here/"><img class="sidepic" alt="Click Here to Kill Everybody" src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2018/07/book-ch2-200w.png" /></a><p><a href="https://www.schneier.com/books/">More Books</a></p></div></section><section><div class="sidesection widget widget_schneier_promotion" id="schneier_promotion-2">
<a href="https://www.eff.org/issues/bloggers/legal/join">
	<img src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/join-eff@2x.png" id="effbutton" alt="Support Bloggers' Rights!" title="Support Bloggers' Rights!" /></a>

<a href="https://npo.networkforgood.org/Donate/Donate.aspx?npoSubscriptionId=8252">
	<img src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/support-epic@2x.png" alt="Defend Privacy--Support Epic" title="Defend Privacy--Support Epic" /></a>
</div></section>	</div>
</aside>

		<footer>
			<nav>
				<div class="nav" id="footer-nav">
					<div class="menu-main-menu-container"><ul id="menu-main-menu-1" class="menu"><li class="menu1 menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-50175 current-menu-item"><a href="https://www.schneier.com">Blog</a></li>
<li class="menu2 menu-item menu-item-type-post_type menu-item-object-page menu-item-50916"><a href="https://www.schneier.com/crypto-gram/">Newsletter</a></li>
<li class="menu3 menu-item menu-item-type-post_type menu-item-object-page menu-item-50166"><a href="https://www.schneier.com/books/">Books</a></li>
<li class="menu4 menu-item menu-item-type-custom menu-item-object-custom menu-item-50169"><a href="https://www.schneier.com/essays/">Essays</a></li>
<li class="menu5 menu-item menu-item-type-custom menu-item-object-custom menu-item-50170"><a href="https://www.schneier.com/news/">News</a></li>
<li class="menu6 menu-item menu-item-type-custom menu-item-object-custom menu-item-50171"><a href="https://www.schneier.com/talks/">Talks</a></li>
<li class="menu7 menu-item menu-item-type-post_type menu-item-object-page menu-item-50167"><a href="https://www.schneier.com/academic/">Academic</a></li>
<li class="menu8 menu-item menu-item-type-post_type menu-item-object-page menu-item-50174"><a href="https://www.schneier.com/blog/about/">About Me</a></li>
</ul></div>				</div>
			</nav>
		</footer>

		</div><!--#main-->
	</div><!--#wrapper-->

		<script type="text/javascript">
		(function () {
			var c = document.body.className;
			c = c.replace(/woocommerce-no-js/, 'woocommerce-js');
			document.body.className = c;
		})();
	</script>
	<script type='text/javascript' src='https://c0.wp.com/p/woocommerce/5.1.0/assets/js/jquery-cookie/jquery.cookie.min.js' id='jquery-cookie-js'></script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/vendor/socialshareprivacy/js/socialshareprivacy.js?ver=1.0.1' id='social-share-privacy-js'></script>
<script type='text/javascript' id='social-share-privacy-icons-js-extra'>
/* <![CDATA[ */
var schneierSocial = {"path":"https:\/\/www.schneier.com\/wp-content\/themes\/schneier\/assets\/vendor\/socialshareprivacy\/"};
/* ]]> */
</script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/vendor/socialshareprivacy/js/icons.js?ver=1.0.0' id='social-share-privacy-icons-js'></script>
<script type='text/javascript' id='schneier-comment-js-extra'>
/* <![CDATA[ */
var schneierComment = {"translateErrorSecurityAnswerWrong":"Your response to the challenge question ('The name of this blog is Schneier on ____') was not correct. Please try again.","ajax_url":"https:\/\/www.schneier.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/js/comment.js?ver=1.0.1' id='schneier-comment-js'></script>
<script type='text/javascript' src='https://c0.wp.com/c/5.7/wp-includes/js/wp-embed.min.js' id='wp-embed-js'></script>

</body>

</html>
