<!DOCTYPE html>
<html lang="en-US">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<title>Breaking Diffie-Hellman with Massive Precomputation (Again) - Schneier on Security</title>
	<meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel='dns-prefetch' href='//c0.wp.com' />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Feed" href="https://www.schneier.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Comments Feed" href="https://www.schneier.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Breaking Diffie-Hellman with Massive Precomputation (Again) Comments Feed" href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/feed/" />
<link rel='stylesheet' id='wp-block-library-css'  href='https://c0.wp.com/c/5.7/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all' />
<style id='wp-block-library-inline-css' type='text/css'>
.has-text-align-justify{text-align:justify;}
</style>
<style id='woocommerce-inline-inline-css' type='text/css'>
.woocommerce form .form-row .required { visibility: visible; }
</style>
<link rel='stylesheet' id='schneier-css'  href='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/style.css?ver=1.0.0' type='text/css' media='all' />
<link rel='stylesheet' id='schneier-main-css'  href='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/dist/css/style.css?ver=1.0.2' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css'  href='https://c0.wp.com/p/jetpack/9.5.2/css/jetpack.css' type='text/css' media='all' />
<script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js?ver=3.5.1' id='jquery-js'></script>
<link rel="https://api.w.org/" href="https://www.schneier.com/wp-json/" /><link rel="alternate" type="application/json" href="https://www.schneier.com/wp-json/wp/v2/posts/7321" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://www.schneier.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://www.schneier.com/wp-includes/wlwmanifest.xml" /> 

<link rel="canonical" href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html" />
<link rel='shortlink' href='https://www.schneier.com/?p=7321' />
<link rel="alternate" type="application/json+oembed" href="https://www.schneier.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2015%2F10%2Fbreaking_diffie.html" />
<link rel="alternate" type="text/xml+oembed" href="https://www.schneier.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2015%2F10%2Fbreaking_diffie.html&#038;format=xml" />
	<noscript><style>.woocommerce-product-gallery{ opacity: 1 !important; }</style></noscript>
	<link rel="icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-32x32.png" sizes="32x32" />
<link rel="icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-180x180.png" />
<meta name="msapplication-TileImage" content="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-270x270.png" />
		<style type="text/css" id="wp-custom-css">
			#schneier_promotion-2 img {
    max-width: 180px;
}		</style>
		</head>

<body class="post-template-default single single-post postid-7321 single-format-standard theme-schneier woocommerce-no-js">

	<div id="wrapper">
		<div id="main">

			<header>
				<div id="header">
					<h1>
						<a href="https://www.schneier.com/" rel="home">
							Schneier on Security						</a>
					</h1>
				</div>
			</header>

			<nav>
				<div class="nav" id="header-nav">
					<div class="menu-main-menu-container"><ul id="menu-main-menu" class="menu"><li id="menu-item-50175" class="menu1 menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-50175 current-menu-item"><a href="https://www.schneier.com">Blog</a></li>
<li id="menu-item-50916" class="menu2 menu-item menu-item-type-post_type menu-item-object-page menu-item-50916"><a href="https://www.schneier.com/crypto-gram/">Newsletter</a></li>
<li id="menu-item-50166" class="menu3 menu-item menu-item-type-post_type menu-item-object-page menu-item-50166"><a href="https://www.schneier.com/books/">Books</a></li>
<li id="menu-item-50169" class="menu4 menu-item menu-item-type-custom menu-item-object-custom menu-item-50169"><a href="https://www.schneier.com/essays/">Essays</a></li>
<li id="menu-item-50170" class="menu5 menu-item menu-item-type-custom menu-item-object-custom menu-item-50170"><a href="https://www.schneier.com/news/">News</a></li>
<li id="menu-item-50171" class="menu6 menu-item menu-item-type-custom menu-item-object-custom menu-item-50171"><a href="https://www.schneier.com/talks/">Talks</a></li>
<li id="menu-item-50167" class="menu7 menu-item menu-item-type-post_type menu-item-object-page menu-item-50167"><a href="https://www.schneier.com/academic/">Academic</a></li>
<li id="menu-item-50174" class="menu8 menu-item menu-item-type-post_type menu-item-object-page menu-item-50174"><a href="https://www.schneier.com/blog/about/">About Me</a></li>
</ul></div>				</div>
			</nav>

			
<aside>
	<div class="sidebar" id="sidebar-one">
		<section><div class="sidesection widget widget_schneier_search" id="schneier_search-3"><h3>Search</h3>
<p class="small">
	<em>Powered by <a href="https://duckduckgo.com/">DuckDuckGo</a></em></p>

<form method="get" action="https://duckduckgo.com/">

	<input type="hidden" name="kh" value="1" /><!-- use https -->

	<input id="search" name="q" size="15" maxlength="255" />

	<input type="submit" value="Go" /><br>

	<input type="radio" name="sites" id="searchblog" value="www.schneier.com/blog" />
	<label for="searchblog">Blog</label>

	<input type="radio" name="sites" id="searchessays" value="www.schneier.com/essays" />
	<label for="searchessays">Essays</label>

	<input type="radio" name="sites" id="searchall" value="www.schneier.com" checked="" />
	<label for="searchall">Whole site</label>

</form>
</div></section><section><div class="sidesection widget widget_schneier_social" id="schneier_social-2"><h3>Subscribe</h3>
<div id="subscription-buttons">

	<a href="https://www.schneier.com/feed/atom"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/rss-32px.png" alt="Atom Feed" /></a><a href="https://www.facebook.com/bruce.schneier"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/facebook-32px.png" alt="Facebook" /></a><a href="https://twitter.com/schneierblog/"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/twitter-32px.png" alt="Twitter" /></a><a href="https://www.amazon.com/Schneier-on-Security/dp/B0053HDDWW/"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/kindle-32px.png" alt="Kindle" /></a><a href="https://www.schneier.com/crypto-gram"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/email-32px.png" alt="E-Mail Newsletter (Crypto-Gram)" /></a>
</div>
</div></section>	</div>
</aside>

			<div id="content">

				
		<p id="breadcrumbs">

			<a href="https://www.schneier.com">Home</a><a href="https://www.schneier.com/blog/archives/">Blog</a>		</p>

		
<article id="post-7321" class="post-7321 post type-post status-publish format-standard hentry category-uncategorized tag-academic-papers tag-cryptanalysis tag-cryptography tag-encryption tag-https tag-keys tag-man-in-the-middle-attacks tag-nsa tag-protocols tag-tls tag-vpn">

	<div class="article">

		<h2 class="entry">Breaking Diffie-Hellman with Massive Precomputation (Again)</h2>
		<p>The Internet is abuzz with this <a href="https://freedom-to-tinker.com/blog/haldermanheninger/how-is-nsa-breaking-so-much-crypto/">blog post</a> and <a href="https://weakdh.org/imperfect-forward-secrecy-ccs15.pdf">paper</a>, speculating that the NSA is breaking the Diffie-Hellman key-exchange protocol in the wild through massive precomputation.</p>
<p>I wrote about this <a href="https://www.schneier.com/blog/archives/2015/05/the_logjam_and_.html">at length</a> in May when this paper was first made public. (The reason it&#8217;s news again is that the paper was just presented at the ACM Computer and Communications Security conference.)</p>
<p>What&#8217;s newly being talked about his how this works inside the NSA surveillance architecture. Nicholas Weaver <a href="https://www.lawfareblog.com/nsa-and-weak-dh">explains</a>:</p>
<blockquote><p>To decrypt IPsec, a large number of wiretaps monitor for IKE (Internet Key Exchange) handshakes, the protocol that sets up a new IPsec encrypted connection. The handshakes are forwarded to a decryption oracle, a black box system that performs the magic. While this happens, the wiretaps also record all traffic in the associated IPsec connections.</p>
<p>After a period of time, this oracle either returns the private keys or says &#8220;i give up&#8221;. If the oracle provides the keys, the wiretap decrypts all the stored traffic and continues to decrypt the connection going forward.</p>
<p>[&#8230;]</p>
<p>This would also better match the security implications: just the fact that the NSA can decrypt a particular flow is a critical secret. Forwarding a small number of potentially-crackable flows to a central point better matches what is needed to maintain such secrecy.</p>
<p>Thus by performing the decryption in bulk at the wiretaps, complete with hardware acceleration to keep up with the number of encrypted streams, this architecture directly implies that the NSA can break a massive amount of IPsec traffic, a degree of success which implies a cryptanalysis breakthrough.</p></blockquote>
<p>That last paragraph is Weaver explaining how this attack matches the NSA rhetoric about capabilities in some of their secret documents.</p>
<p>Now that this is out, I&#8217;m sure there are a lot of really upset people inside the NSA.</p>
<p>EDITED TO ADD (11/15): How to <a href="https://www.eff.org/deeplinks/2015/10/how-to-protect-yourself-from-nsa-attacks-1024-bit-DH">protect yourself</a>.</p>

		
			<p class="entry-tags">
				<span class="tags-links">Tags: <a href="https://www.schneier.com/tag/academic-papers/" rel="tag">academic papers</a>, <a href="https://www.schneier.com/tag/cryptanalysis/" rel="tag">cryptanalysis</a>, <a href="https://www.schneier.com/tag/cryptography/" rel="tag">cryptography</a>, <a href="https://www.schneier.com/tag/encryption/" rel="tag">encryption</a>, <a href="https://www.schneier.com/tag/https/" rel="tag">https</a>, <a href="https://www.schneier.com/tag/keys/" rel="tag">keys</a>, <a href="https://www.schneier.com/tag/man-in-the-middle-attacks/" rel="tag">man-in-the-middle attacks</a>, <a href="https://www.schneier.com/tag/nsa/" rel="tag">NSA</a>, <a href="https://www.schneier.com/tag/protocols/" rel="tag">protocols</a>, <a href="https://www.schneier.com/tag/tls/" rel="tag">TLS</a>, <a href="https://www.schneier.com/tag/vpn/" rel="tag">VPN</a></span>			</p>

		
		
		<p class="posted">
			<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html" rel="bookmark">Posted on October 16, 2015 at 6:19 AM</a>			•
			<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html#comments">80 Comments</a>		</p>

		<aside><div class="schneier-share share" data-uri="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html" data-title="Breaking Diffie-Hellman with Massive Precomputation (Again)" data-order="facebook twitter tumblr" data-social-share-privacy="true" /></aside>
	</div>

</article>


	<h3 id="comments">Comments</h3>

	
		<article class="comment even thread-even depth-1" id="comment-259716">

			<div class="comment by-goonie ">

				<p class="commentcredit">

					<span class="commenter">Goonie</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259716">
						October 16, 2015 7:00 AM					</a>

				</p>

				<p>Speculating a bit (well, a lot) but the NSA&#8217;s working assumption if they did choose to exploit this rather than warn is that nobody has their resources, so nobidyy else could pull off this attack.  Therefore, they aren&#8217;t putting American companies at risk.</p>
<p>When it comes to access to cash and bulk quantities of mpdern commodity computing hardware, that assumption seems increasingly dubious.  Furthermore, the Chinese government is by all reports highly motivated to attack corporate networks that this attack would be most effective against.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259717">

			<div class="comment by-stine ">

				<p class="commentcredit">

					<span class="commenter">stine</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259717">
						October 16, 2015 7:19 AM					</a>

				</p>

				<p>If this is true, then what&#8217;s the optimum lifetime and size for keys used in an IPSec tunnel? 1 hour and 4096bits?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259718">

			<div class="comment by-z-lozinski ">

				<p class="commentcredit">

					<span class="commenter">Z.Lozinski</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259718">
						October 16, 2015 7:25 AM					</a>

				</p>

				<p>Fort Meade, we <em>all</em> have a problem.  Let&#8217;s assume for the moment that nation states will operate within their own laws and instead think of evil non-state actors.  So consider what could be done by a organised group of hackers.</p>
<p>The two estimates of the attack cost (Table-2 of the paper) are: 120,000 core years for RSA-1024, and 35,000,000 core years for DH-1024.</p>
<p>Amazon has over 10 million cores (based on careful reading of James Hamilton&#8217;s presentation at re-Invent 2014).  So an attack on RSA-1024 would use under 1% of Amazon&#8217;s infrastructure.   According to the SANS Institute, bot-net sizes range from 120,000 to 30 million bots. Say 240,000 to 60 million cores. That brings both of the 1024 bit key attacks into range from someone who is prepared to do some advance planning.  Yes, I know the other parts of the attack also require work, but the expensive part, the pre-computation is now feasible.</p>
<p>On-line banking, treasury, corporate email (to allow front-running of M&amp;A) are now very attractive targets.</p>
<p>Actually, NSA and GCHQ need to need to start looking to see of there are signs anyone else is trying this in the wild.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259719">

			<div class="comment by-dirk-praet ">

				<p class="commentcredit">

					<span class="commenter">Dirk Praet</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259719">
						October 16, 2015 8:51 AM					</a>

				</p>

				<p>@ Grauhut, @ Nick P., @ Wael</p>
<p>(moving your previous <a href="https://www.schneier.com/blog/archives/2015/10/obama_administr.html#c6708402" target="_blank" rel="noopener noreferrer nofollow ugc">exchange</a> on the subject to this here thread because more on topic)</p>
<p><i>If you can do a rainbow table alike attack on a single prime number below 1024bit you can drive the same one against any prime number below 2048bit.</i></p>
<p>I guess we now know what they&#8217;re using their Cray XC30&#8217;s at Bluffdale for. Some of the comments in the Freedom to Tinker blog post @Bruce is referring to are talking about the math behind building such database/rainbow table to &#8220;break&#8221; a prime p.</p>
<p>@ Goonie</p>
<p><i>&#8230; if they did choose to exploit this rather than warn is that nobody has their resources, so nobody else could pull off this attack.</i></p>
<p>Which is however kinda consistent with a philosophy/approach @Skeptical has been advocating on several occasions on this blog.</p>
<p>So for now, the 64k$ question is: how to protect/mitigate against this?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259720">

			<div class="comment by-stacey-elseth ">

				<p class="commentcredit">

					<span class="commenter">Stacey Elseth</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259720">
						October 16, 2015 9:10 AM					</a>

				</p>

				<p>Now isn&#8217;t it nice that Obama isn&#8217;t seeking backdoors in commercial encryption&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259721">

			<div class="comment by-jayson ">

				<p class="commentcredit">

					<span class="commenter">jayson</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259721">
						October 16, 2015 9:34 AM					</a>

				</p>

				<p>If the NSA are using GPU cores or ASICs then the time needed would drop substantially.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259722">

			<div class="comment by-callmelateforsupper ">

				<p class="commentcredit">

					<span class="commenter">CallMeLateForSupper</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259722">
						October 16, 2015 9:38 AM					</a>

				</p>

				<p>At EFF:<br />
&#8220;How to Protect Yourself from NSA Attacks on 1024-bit DH&#8221;<br />
<a href="https://www.eff.org/deeplinks/2015/10/how-to-protect-yourself-from-nsa-attacks-1024-bit-DH" rel="nofollow ugc">https://www.eff.org/deeplinks/2015/10/how-to-protect-yourself-from-nsa-attacks-1024-bit-DH</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259723">

			<div class="comment by-john-galt-iv ">

				<p class="commentcredit">

					<span class="commenter">John Galt IV</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259723">
						October 16, 2015 11:37 AM					</a>

				</p>

				<p>this probably is redundant, but just to have a thorough compendium</p>
<p><a href="https://www.google.com/url?q=http://arstechnica.com/security/2015/10/how-the-nsa-can-break-trillions-of-encrypted-web-and-vpn-connections" rel="nofollow ugc">https://www.google.com/url?q=http://arstechnica.com/security/2015/10/how-the-nsa-can-break-trillions-of-encrypted-web-and-vpn-connections</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259724">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259724">
						October 16, 2015 12:17 PM					</a>

				</p>

				<p>@Dirk Praet,</p>
<blockquote><p>moving your previous exchange on the subject to this here thread because more on topic)</p></blockquote>
<p>You might as well move <a href="https://www.schneier.com/blog/archives/2015/10/european_court_.html#c6708263" rel="nofollow ugc">this</a> one too!</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259725">

			<div class="comment by-daniel ">

				<p class="commentcredit">

					<span class="commenter">Daniel</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259725">
						October 16, 2015 12:58 PM					</a>

				</p>

				<p>I&#8217;m puzzled about whether or not the NSA is really upset and whether this is really the big breakthrough people think it is. Why? Because the NSA allowed the paper to be published. There have been examples of researchers pulling papers because the NSA asked them too. So why not here? If the national security implications are as strong as people suggest, I can&#8217;t believe the NSA would sit quietly on the sidelines.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259726">

			<div class="comment by-mrc ">

				<p class="commentcredit">

					<span class="commenter">MrC</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259726">
						October 16, 2015 1:03 PM					</a>

				</p>

				<p>@ Z.Lozinski:</p>
<p>Agreed.</p>
<p>&lt;Yoda_Voice&gt;Security or vulnerability; there is no nobus.&lt;/Yoda_Voice&gt;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259727">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259727">
						October 16, 2015 1:03 PM					</a>

				</p>

				<p>@ Dirk Praet</p>
<p>&#8220;So for now, the 64k$ question is: how to protect/mitigate against this?&#8221;</p>
<p>That&#8217;s easy and in the paper: move to ECC or use 2,048-bit minimum. Bernstein has made it super easy with the NaCl implementations with curves giving tons of security and efficiency at same time. Little excuse other than social factors.</p>
<p>@ jayson</p>
<p>No, the paper gets their estimate assuming they are using ASIC&#8217;s. They mention that there&#8217;s usually around an 80x increase in performance. That&#8217;s on the high-end, though, with some problems barely pulling a 2x increase. They played it safe by giving them the benefit of the doubt. So, this result assumes they have a supercomputer with hundreds of thousands of ASIC&#8217;s. If I read it right.</p>
<p>@ All</p>
<p>The room for error here is in the ASIC assessment. We need to figure out how much they can parallelize this, either in cores or custom circuits, in a given ASIC. Then, how many of those can do in one chip at 14-28nm. Then how many they can squeeze in a rack. Then how much factoring can be done with Amazon or Microsoft datacenters full of those. That would be the most paranoid assessment.</p>
<p>You see, the unit prices of these things are really low vs initial development costs. That&#8217;s one of main drivers for hardware to shrink. The circuits might cost pro&#8217;s $10-30 million to develop with boards a tiny fraction of that. Then, the chips themselves are dirt-cheap with the boards being inexpensive. If algorithm doesn&#8217;t need much communication, then they can use standard I/O options to farm out the jobs which then just run until they complete. They could add more capacity year after year dirt cheap after spending a ton of money on chip design and real estate just once. They could get 50,000-100,000 chips with multiple accelerators on each every year.</p>
<p>So, I think the authors upper bound is lower than the real upper bound. Need to get specialists who have implemented algorithms like this in hardware to show how it will likely be implemented. Need at least one person whose done a 28nm design to estimate how much of the chip can be dedicated to that with the other functions considered. Then multiply that by whatever Amazon has to get a decent upper-bound.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259728">

			<div class="comment by-andrew ">

				<p class="commentcredit">

					<span class="commenter">Andrew</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259728">
						October 16, 2015 1:04 PM					</a>

				</p>

				<p>@John Galt IV &#8211; 10^12 attempts/s = 10^19/year = (*10^6 botnets, supercomputers, clusters) = 10^25<br />
A 15 characters password = (2^5)15 = 2^75 = 10^22<br />
So it can be fully tested within days, by brute force. And we are not even in quantum age.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259729">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259729">
						October 16, 2015 1:05 PM					</a>

				</p>

				<p>@ Bruce</p>
<p>The EFF has a nice <a href="https://www.eff.org/deeplinks/2015/10/how-to-protect-yourself-from-nsa-attacks-1024-bit-DH" rel="nofollow ugc">guide</a> for users to protect themselves that you might want to link to in your blog post.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259730">

			<div class="comment by-rgaff ">

				<p class="commentcredit">

					<span class="commenter">rgaff</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259730">
						October 16, 2015 1:35 PM					</a>

				</p>

				<p>It may cost the NSA a billion dollars to do this (gee, I wonder what that is in Utah, maybe not just &#8220;storage space&#8221; after all??) but it will cost the NEXT one who can do it far far less, and happen sooner than you think!</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259731">

			<div class="comment by-who ">

				<p class="commentcredit">

					<span class="commenter">Who?</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259731">
						October 16, 2015 1:35 PM					</a>

				</p>

				<p>These are old news.  As you said, you wrote about this in May when this research was made public.  Nothing has changed since then, right?</p>
<p>What would make this entry in your blog really useful would be discussing what can be done to avoid precomputation risks, now that we know that attacks against Diffie-Hellman are more than an academic dream.  Is the IKEv2 protocol (as defined in RFC 5996) vulnerable?  How is IPsec affected?  Is SSHv2 vulnerable?  For protocol version 2 forward security is provided through a DH key agreement, but this protocol version supports the <a href="mailto:curve25519-sha256@libssl.org">curve25519-sha256@libssl.org</a> key exchange algorithm too.  Current OpenSSH defaults seems sane to me.  What about web servers?  Should we move to a larger than 2048-bit Diffie-Hellman now?  How larger then?</p>
<p>CallMeLateForSupper has given a good reference.  Let me provide another one: <a href="https://bettercrypto.org/" rel="nofollow ugc">https://bettercrypto.org/</a> has a good encryption guide (the &#8220;Applied Crypto Hardening&#8221;), that knowledgeable members of this forum should be able to improve.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259732">

			<div class="comment by-me ">

				<p class="commentcredit">

					<span class="commenter">me</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259732">
						October 16, 2015 1:45 PM					</a>

				</p>

				<p>@ Nick P</p>
<p>ioerror has mentioned at least twice today he sees no evidence that LONGHAUL is using ASICs.</p>
<p><cite>&#8220;All the docs I&#8217;ve seen suggest LONGHAUL is general purpose.&#8221;</cite></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259733">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259733">
						October 16, 2015 1:47 PM					</a>

				</p>

				<p>@Z.Lozinski,</p>
<blockquote><p>Actually, NSA and GCHQ need to need to start looking to see of there are signs anyone else is trying this in the wild.</p></blockquote>
<p>I put the little money I have that <a href="http://www.extremetech.com/extreme/209704-chinas-tianhe-2-still-the-fastest-supercomputer-in-the-world-but-the-us-is-catching-up" rel="nofollow ugc">Tianhe-2</a> is used for that purpose. It also seems the US is <a href="http://thediplomat.com/2015/08/us-to-challenge-china-for-worlds-fastest-supercomputer/" rel="nofollow ugc">aware</a>[1] of who&#8217;s hiding this endeavor behind the <a href="https://en.m.wikipedia.org/wiki/Bamboo_Curtain" rel="nofollow ugc">Bamboo Curtain</a></p>
<p>[1] Yup, the US will challenge China by building a faster super computer. Guess where it will be manufactured, along with a zillion knockoffs? 🙂</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259734">

			<div class="comment by-earl-killian ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.killian.com/earl/bio.html' rel='external nofollow ugc' class='url'>Earl Killian</a></span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259734">
						October 16, 2015 2:07 PM					</a>

				</p>

				<p>First, it sounds like getting everyone to change the DH parameters every month or week would be able to make this attack economically infeasible. Good luck on getting the lazy internet to do that though.</p>
<p>What about encrypting the DH key exchange? For example, the client would encrypt a random number using the server&#8217;s public-key, and use AES to encrypt the DH key exchange protocol with that.</p>
<p>In general, I think it makes sense to think about using catenated crypto, so that if a weakness is found in one protocol, it still requires a break in the second to break the overall system. For example, XOR with ChaCha20 and then use AES128 ECB on the result. You have to break ChaCha20 and AES128 both. Encrypting DH key exchange with ChaCha20 is an example of catenated crypto.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259735">

			<div class="comment by-4thammendmenthopefullystillexists ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://spaceweathernews.com/' rel='external nofollow ugc' class='url'>4thAmmendmentHopefullyStillExists</a></span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259735">
						October 16, 2015 2:12 PM					</a>

				</p>

				<p>Maybe they found a use for that PlayStation 3 super computer the Air Force built:</p>
<p><a href="http://phys.org/news/2010-12-air-playstation-3s-supercomputer.html" rel="nofollow ugc">http://phys.org/news/2010-12-air-playstation-3s-supercomputer.html</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259736">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259736">
						October 16, 2015 2:23 PM					</a>

				</p>

				<p>@ me</p>
<p>That&#8217;s good news if true. I figure they&#8217;re more likely to use a Cray-architected version of this <a href="http://www.engineeringletters.com/issues_v16/issue_3/EL_16_3_23.pdf" rel="nofollow ugc">thing</a>. A farm of FPGA&#8217;s, high-end CPU&#8217;s, and tons of RAM are just what they need. Within budget and benefiting the right parties, too. Also general-purpose, esp supporting signal processing.</p>
<p>Regardless, my analysis applies because <em>someone</em> will build the ASIC&#8217;s even if NSA doesn&#8217;t. China is the likely candidate as they have a bunch of fabs and the cheap labor is making hardware development (esp RTL) concentrate in that area. They could do this attack in dozens of different ways without spending anything extra (past HW prototyping) because the existing work already paid for the tools and labor.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259737">

			<div class="comment by-anura ">

				<p class="commentcredit">

					<span class="commenter">Anura</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259737">
						October 16, 2015 3:23 PM					</a>

				</p>

				<p>@Earl Killian</p>
<p>Well, you are limited by the existing protocols; updating protocols and then getting people to use them takes a very long time. Getting software vendors to update their priority list for TLS ciphersuites and disable export-grade encryption is probably the most effective route. Ideally, the 2048-bit Diffie-Hellman prime wouldn&#8217;t be a static configuration, but would be generated in the background using a very low priority process spawned by the TLS server &#8211; I doubt you will get a major TLS suite to do this without it having to be manually configured.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259738">

			<div class="comment by-grauhut ">

				<p class="commentcredit">

					<span class="commenter">Grauhut</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259738">
						October 16, 2015 3:30 PM					</a>

				</p>

				<p>@Dirk: <a href="https://weakdh.org/sysadmin.html" rel="nofollow ugc">https://weakdh.org/sysadmin.html</a></p>
<p>@Nick: &#8220;A farm of FPGA&#8217;s, high-end CPU&#8217;s, and tons of RAM are just what they need.&#8221;</p>
<p>Right, i am with you, think its too early for ASICs. That could be the answer to the &#8220;Wtf did Intel invest $16.7 billion in Alteras FPGA tech?&#8221; question.</p>
<p>“We see a path to accelerating machine learning, to accelerate storage encryption, to accelerate network functions. We know because we are very deep into those workloads and we now see the opportunity to do it. Now, FPGAs have traditionally been kind of difficult, limited to the far-out expertise, because you are writing RTL. We are a company that writes RTL all the time, so we can solve that problem.”<br />
(Waxman)</p>
<p>Sounds a little like NSA needs cheaper APIs to FPGAs for lazy gov hackers. 🙂</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259739">

			<div class="comment by-unknown ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://joshjarvls.eu/' rel='external nofollow ugc' class='url'>Unknown</a></span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259739">
						October 16, 2015 5:46 PM					</a>

				</p>

				<p>What about OpenVPN?<br />
I think encryption system needs &#8220;randomize private key everyday&#8221; function.<br />
e.g., <a href="https://sw.estiva.org:419/memo/article_aaef2aabefadb49bbc20ccfa163fe0b5.html" rel="nofollow ugc">https://sw.estiva.org:419/memo/article_aaef2aabefadb49bbc20ccfa163fe0b5.html</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259740">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259740">
						October 16, 2015 6:25 PM					</a>

				</p>

				<p>@ Grauhut</p>
<p>&#8220;Right, i am with you, think its too early for ASICs.&#8221;</p>
<p>I agree: most likely multi-core CPU&#8217;s, GPU&#8217;s, and FPGA [likely with HLS].</p>
<p>&#8220;That could be the answer to the &#8220;Wtf did Intel invest $16.7 billion in Alteras FPGA tech?&#8221; question.&#8221;</p>
<p>It might help them haha. Nah, that move was smart. CPU and FPGA techniques, especially auto-partitioning, showed promise far back as the 90&#8217;s. The FPGA&#8217;s have serious been eating into Intel&#8217;s market share in HPC and soon (if not already) cloud. Cloud vendors are <em>finally</em> learning that heterogenous setups geared to types of applications are more efficient. They already use FPGA&#8217;s and &#8220;semi-custom&#8221; hardware internally with AMD forging that path. Intel was getting their ass kicked on every front when they said, &#8220;We&#8217;ll just buy the cheaper of the Big Two who has easiest-to-use tools. Then, integrate them right in our CPU&#8217;s.&#8221;</p>
<p>Well-played, Intel. Except maybe for the price: I&#8217;m not qualified to judge whether they&#8217;re worth that much.</p>
<p>&#8220;Sounds a little like NSA needs cheaper APIs to FPGAs for lazy gov hackers. :)&#8221;</p>
<p>Seems like it. The number with real skill in the leaks always seems relatively small for a group their size. It&#8217;s mostly duct-tape like software in general. What they really need are good hardware people (for FPGA&#8217;s) and HPC people working together on projects like this. Once they have a working solution, they can use ASIC conversion to make it faster and cheaper to bulk up on it.</p>
<p>Stuff like Altera&#8217;s HardCopy which a major NSA supplier now owns. 🙂</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259741">

			<div class="comment by-anura ">

				<p class="commentcredit">

					<span class="commenter">Anura</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259741">
						October 16, 2015 6:53 PM					</a>

				</p>

				<p>@Unknown</p>
<p>&#8220;What about OpenVPN?&#8221;</p>
<p>OpenVPN generates a new DH keypair every single time you connect. Unless you are using a common prime used by a lot of other servers, you should be more secure than a server that just uses RSA of the same key size (which should be at least 2048 bits!), since the precomputation for the Logjam attack takes about 40x as long (yes, over 5 WHOLE bits worth of extra security) as it does to break an RSA certificate (according to the paper). It&#8217;s also a lot easier to change out the primes, because you don&#8217;t have to sign them with a CA root certificate, and you can write a script to do so on reboot, daily, weekly, monthly, etc.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259742">

			<div class="comment by-booster ">

				<p class="commentcredit">

					<span class="commenter">Booster</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259742">
						October 17, 2015 3:59 AM					</a>

				</p>

				<p>I&#8217;m a bit of a noob to security, but in summary, are we saying that most IPSEC based VPNs are now not to be considered secure?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259743">

			<div class="comment by-andy-m ">

				<p class="commentcredit">

					<span class="commenter">Andy M</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259743">
						October 17, 2015 5:12 AM					</a>

				</p>

				<p>It was revealed 2 years ago that the NSA had some of their people on the IPSec design committe. Not surprising that the NSA don&#8217;t have much difficulty breaking it.</p>
<p><a href="http://www.mail-archive.com/cryptography@metzdowd.com/msg12325.html" rel="nofollow ugc">http://www.mail-archive.com/cryptography@metzdowd.com/msg12325.html</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259744">

			<div class="comment by-booster ">

				<p class="commentcredit">

					<span class="commenter">booster</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259744">
						October 17, 2015 7:55 AM					</a>

				</p>

				<p>Given the post Andy M put up, I don&#8217;t see how anyone can work on the basis that IPSEC is secure and hasn&#8217;t been for years.</p>
<p>How can anyone still be using it?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259745">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259745">
						October 17, 2015 8:06 AM					</a>

				</p>

				<p>@ Who?</p>
<blockquote><p>These are old news. As you said, you wrote about this in May when this research was made public. Nothing has changed since then, right?</p></blockquote>
<p>It&#8217;s even older than that.</p>
<p>Logjam consists of three parts.</p>
<p>1, The Fallback or equivalent of keeping backwards compatibility.</p>
<p>2, The knowledge required to realize the DH attack.</p>
<p>3, The hardware to make the attack worthwhile.</p>
<p>The Fallback issue I&#8217;ve been banging on about on this blog for a long long time.</p>
<p>The knowledge required to realize the DH attack has similarly been around for quite some time. I&#8217;ve also been warning people to think about the way the NSA do things, not on an individual targeted scale but an industrial scale. Most notably when some researchers over at the Cambridge Labs showed how due to weaknesses in the generation of primes in embedded hardware PK certs had common primes and how that could be trivially found. I gave an outline of exactly how the NSA could have gone about it.</p>
<p>Which included how a &#8220;lookup&#8221; system could be made and used, which would be very very similar to what would be needed here.</p>
<p>So the ideas required for all three parts were around just waiting for the dots to be joined quite a lot longer than May&#8230;</p>
<p>The big take away from this is people are still not listening and thinking on &#8220;Fallback&#8221; and &#8220;Industrialisation&#8221; when it comes to attacks. I can think of one or two other protocols that suffer from these issues as I&#8217;m sure can others, the problem however is not listing them but getting people to think on them themselves. As Bruce has noted in the past a necessary part of being a designer of crypto systems, is the ability to think up ways to attack not just others systems but your own designs as well. And we need to encourage the &#8220;Thinking Hinky&#8221; attitude in people not repress it, one way we know works is by engaging peoples curiosity, perhaps the most famous  mathematical one being an enigmatic note about the lack of space in a margin&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259746">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259746">
						October 17, 2015 8:18 AM					</a>

				</p>

				<p>@ Earl Killian,</p>
<blockquote><p>What about encrypting the DH key exchange? For example, the client would encrypt a random number using the server&#8217;s public-key, and use AES to encrypt the DH key exchange protocol with that.</p></blockquote>
<p>Why would you want to use DH if you already had the servers Public Key?</p>
<p>DH is a protocol for negotiating a  secret key between two parties that have had no previous contact or secure side channel available to securely exchange a key or secret. To encrypt DH you would have to have had contact or a secure channel to get the key to do the AES encryption, thus would not need DH.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259747">

			<div class="comment by-nighthawk ">

				<p class="commentcredit">

					<span class="commenter">nighthawk</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259747">
						October 17, 2015 9:00 AM					</a>

				</p>

				<p>Bah, the NSA is simply a huge criminal organisation, that deliberately weakens the standards in there own favour to cover up the huge fraud of Lucent &amp; Bell-Labs.</p>
<p>Genie &#8211; Blue Gene &#8211; Space Bunny &amp; Plan 9 from outer space &#8211; otherwise known as Unix V9</p>
<p>It was Robert Morris cryptographer for both bell-labs &amp; the NSA who inserted back-door&#8217;s into the TCP/IP stack in partnership with Microsoft &amp; AT&amp;T. It&#8217;s bell-labs and there secret protocol that spy on the entire world and subvert the entire computer standards instead of using ANSI-C to fix the already destroyed reputations of Microsoft, Apple, Linux &amp; BSD which they have of course deliberately and maliciously inserted back-door&#8217;s into. So the reputation of all five of these systems is in the dirt and all thanks to one agencies desire to own it all.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259748">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259748">
						October 17, 2015 9:02 AM					</a>

				</p>

				<p>@ Nick P,</p>
<blockquote><p>What they really need are good hardware people (for FPGA&#8217;s) and HPC people working together on projects like this. </p></blockquote>
<p>As you know, back in the past the NSA had such people, and encouraged them to go out on their own on the promise of contracts to buy the product&#8230;</p>
<p>Well due to the usual &#8220;bureaucratic crapola&#8221; the contracts did not happen instead we got COTS&#8230; Which gave us &#8220;supply chain poisoning&#8221; and all sorts of other nasties that outsourcing to foreign climbs brings.</p>
<p>One of which was first done by Sony, many many years ago the manufacture of CRTs was difficult and was done by just a handful of companies world wide, a couple in Europe and a couple in the US. Sony came along and offered CRTs to UK and US television factories at better rates than their domestic manufacturers of CRTs. The result was the domestic manufacturers went out of business. Sony the put the CRT price up and also supplied in competition cheaper finished TVs. The result you don&#8217;t have domestically manufactured TVs any more&#8230;</p>
<p>Likewise we don&#8217;t have much in the way of domestic manufacturing of silicon chips or computers either&#8230;</p>
<p>But now the NSA et al need it but don&#8217;t have it, are people going to repeat history, and fall for the old NSA &#8220;we&#8217;ve got contracts&#8221; line? Just to get cut down again by bureaucratic &#8220;free market&#8221; crapola or just say to the NSA &#8220;Hey guy&#8217;s money gets time, bull541t gets the back of the line&#8221;.</p>
<p>I suspect many know the senior governmental posts are staffed with neo-cons who espouse &#8220;freemarket&#8221; clap trap to the citizens, but really mean &#8220;untouchable cartel, on the tax payer dollar&#8221;.</p>
<p>The move by Intel, is but one of several, for instance Apple, getting it&#8217;s own US based fab etc. Thus I suspect some people &#8211;possibly in the know&#8211; are preparing for a sea state change in the US based electronics industry. And this might have something to do with the way China have been &#8220;squaring up for a fight&#8221; in the South China Seas amongst other things. That is some are preparing for it not be Cyber-war alone much longer&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259749">

			<div class="comment by-nighthawk ">

				<p class="commentcredit">

					<span class="commenter">nighthawk</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259749">
						October 17, 2015 9:22 AM					</a>

				</p>

				<p>Here&#8217;s an idea NSA &#8211; take your space bunny along with your keyhole and insert it into your pie-hole!</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259750">

			<div class="comment by-nighthawk ">

				<p class="commentcredit">

					<span class="commenter">nighthawk</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259750">
						October 17, 2015 9:57 AM					</a>

				</p>

				<p>@Clive Robinson</p>
<p>Ok, you should educate yourself a bit, there has never been nor is there ever going to be any cyber-war.</p>
<p>Go read up a bit on the history of Bell-Labs and Plan9 from outer space.</p>
<p>Plan9 &#8211; does not stop packets, plan9 is impervious to people wanting to break in, in other-words say hello to Unix V9 more Unix than Unix.</p>
<p>So what you have with the GNU &#8211; is Governments Not Unix, this is how the NSA enjoy&#8217;s spying on Billions of people, OWL &#8211; Open Wall Linux, yeap Plan9 goes directly through it&#8217;s firewall. SSL wrappers are broken on Windows, Apple, Linux &amp; BSD the reason, SocksFS stealing all the information as your SSL makes its connection.</p>
<p>General Alexander called it, his most top secret CNE &#8211; Computer Network Exploitation</p>
<p>It&#8217;s so top secret it&#8217;s exactly what the russian&#8217;s use to spy on all there own Linux users that are too dumb to realise there living in a dream world, where all the software was broken by DESIGN by one agency in particular!</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259751">

			<div class="comment by-nighthawk ">

				<p class="commentcredit">

					<span class="commenter">nighthawk</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259751">
						October 17, 2015 10:17 AM					</a>

				</p>

				<p>@Clive Robinson</p>
<p>Starting to wake up from the Dream?</p>
<p>Welcome to the Desert of the Real!</p>
<p>CA certificates are inserted into Linux with a heavily obfuscated Kernel that is millions of line&#8217;s of code that the average user will never fully decipher in there life-time.</p>
<p>Plan9 is 120&#8217;000 Lines of ANSI-C the standard is ANSI-17024 Full Unicode Support and a kernel thats easy to read understand and digest with no obfuscated code or CA&#8217;s!</p>
<p>8-bits is as good as it gets, everything else running X is highly suspect!</p>
<p>UUID-STTY (oh ah now we&#8217;re getting some light on what&#8217;s really going on!)</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259752">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259752">
						October 17, 2015 10:24 AM					</a>

				</p>

				<p>@ Clive Robinson</p>
<p>I think COTS has a lot to do with it. Remember, though, we&#8217;re talking about design not manufacturing. The NSA, DOD, and defense contractors all keep plenty of design staff on hand for all kinds of stuff. The manufacturing side is outsourced or contracted plenty. On ASIC side, there&#8217;s plenty of companies in the U.S. with the RTL, packaging, etc being pushed to Asia. We still dominate in EDA tools, too, with virtually everyone using the Big Three.</p>
<p>So, one must wonder what staff they have for FPGA/ASIC design and what solutions they&#8217;re capable of pulling off. I know they have contractors like <a href="http://502design.com/fpga.html" rel="nofollow ugc">502 design</a> that can help. They have COTS contractors with FPGA/ASIC design capabilities, cleared staff, certified fabs, etc. Still a small segment but one would think they&#8217;d leverage it more on brute-force stuff. Not sure what&#8217;s up with them.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259753">

			<div class="comment by-nighthawk ">

				<p class="commentcredit">

					<span class="commenter">nighthawk</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259753">
						October 17, 2015 10:52 AM					</a>

				</p>

				<p>@ Clive Robinson</p>
<p>Wakey, Wakey, Neo&#8230;</p>
<p>Follow the White Rabbit!</p>
<p><a href="http://glenda.cat-v.org/gallery/glenda_classic_medium.jpg" rel="nofollow ugc">http://glenda.cat-v.org/gallery/glenda_classic_medium.jpg</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259754">

			<div class="comment by-purple-shelf ">

				<p class="commentcredit">

					<span class="commenter">purple shelf</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259754">
						October 17, 2015 12:15 PM					</a>

				</p>

				<p>Judging by the trolling, the NSA must be <em>really</em> upset about this one.</p>
<p>I am surprised that, after disabling the offending DHE ciphers from my browser and keeping the elliptic curve versions (as recommended by the EFF guidelines linked above), nothing appears to have broken. Am I missing something obvious? Is it really a case that not that many sites use it?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259755">

			<div class="comment by-nighthawk ">

				<p class="commentcredit">

					<span class="commenter">nighthawk</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259755">
						October 17, 2015 12:39 PM					</a>

				</p>

				<p>@ purple shelf</p>
<p>The EFF? Freedom Foundation &#8211; Define freedom?</p>
<p>Free to put back-door&#8217;s in your operating system at the TCP/IP layer?</p>
<p>Free to put back-door&#8217;s in your kernel?</p>
<p>Free to Spy on you with your mobile phone?</p>
<p>Why&#8217;d you suppose the called a Plan of anything? Why not Code 9 or Cool OS 9</p>
<p>Why Plan 9 from Outer Space&#8230; Well lets take a closer look at that &#8220;Monster Mind&#8221; that we&#8217;ve all heard so much about and lets take a look at the Google white board and get a feel and understanding for what Google actually stands for&#8230;</p>
<p><a href="http://regmedia.co.uk/2006/03/08/google_whitboard_extracts.jpg" rel="nofollow ugc">http://regmedia.co.uk/2006/03/08/google_whitboard_extracts.jpg</a></p>
<p>Government<br />
Online<br />
Observation<br />
Global<br />
Linux<br />
Environment</p>
<p>&#8211;Google!</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259756">

			<div class="comment by-nighthawk ">

				<p class="commentcredit">

					<span class="commenter">nighthawk</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259756">
						October 17, 2015 1:03 PM					</a>

				</p>

				<p>@ purple shelf</p>
<p>Meet the illuminati and the freemasonry that&#8217;s really running the venture capital world of america.</p>
<p>Plan9 &amp; the X11 window manager (9&amp;11), oh yeah, be afraid of that black budget and that giant tax free triangle.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259757">

			<div class="comment by-bill-stewart ">

				<p class="commentcredit">

					<span class="commenter">Bill Stewart</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259757">
						October 17, 2015 1:19 PM					</a>

				</p>

				<p>A couple of issues people have brought up above<br />
&#8211; Breaking RSA is much easier than breaking DH, for a given length &#8211; Yes, that&#8217;s true, which is why anybody who has a choice has switched away from RSA-1024 to RSA-2048 or more.  But while it&#8217;s 100x harder to break DH-1024, breaking RSA-1024 would only get you one target&#8217;s private keys, but a small number of DH-1024 primes are shared by millions of users, so there&#8217;s a huge payoff.</p>
<ul>
<li>&#8220;generates a new DH keypair every single time you connect.&#8221;  Yes, but once they&#8217;ve pre-analyzed the prime, cracking each new keypair is relatively trivial.   So, as the comment said, if you&#8217;re using a common DH prime, the NSA may have done that.  Which is fine, as far as it goes&#8230; but the alternative to using a common prime (which you negotiate by saying &#8220;Is Group 1/2/5/14 ok with you?&#8221;) is to negotiate the prime itself, </li>
</ul>
<ul>
<li>which not only takes a lot longer to exchange, </li>
<li>and risks all the various implementation/padding/etc. bugs that are possible in that kind of negotiation, </li>
<li>including the risk of negotiation failing and falling back to a cracked DH group, </li>
<li>but also requires the party who offers the prime to generate it and test it well (which is either too slow for most uses, or needs to be done in advance, e.g. generate a new prime every day), </li>
<li>and requires the other party to either trust that the prime is good (probably safe, except for the risks in transferring the number), or to test that it&#8217;s prime (slow, though I suppose you could do one random step of Miller-Rabin and get a 3/4 chance of catching a composite, instead of doing a longer test, since you assume that other people will also test the same prime.) </li>
<li>And of course it requires you to get everybody to adopt new libraries with that negotiation protocol, so good luck with that; it&#8217;s probably easier to get everybody to accept a new DH-2048 group.
</li>
</ul>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259758">

			<div class="comment by-earl-killian ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.killian.com/earl/bio.html' rel='external nofollow ugc' class='url'>Earl Killian</a></span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259758">
						October 17, 2015 1:25 PM					</a>

				</p>

				<p>@Anura</p>
<p>Yes, except that TLS 1.3 is supposedly in the works, so in theory such a thing could be added to it. If it is too late for TLS 1.3, I&#8217;m sure there will be a 1.4 someday.</p>
<p>Yes, ideally the 2048-bit DH parameters would be generated periodically (I have a cron script do it monthly for 3072-bit parameters), but that seems less likely to happen internet-wide than getting TLS 1.4 to change&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259759">

			<div class="comment by-nighthawk ">

				<p class="commentcredit">

					<span class="commenter">nighthawk</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259759">
						October 17, 2015 1:41 PM					</a>

				</p>

				<p>@ purple shelf</p>
<p>Remember the TAO -ANT&#8217;s or Tailored Access Operation ANT &#8211; Catalog?</p>
<p>Meet the ANT&#8217;s created by a hacker called Mycroft.</p>
<p><a href="http://9gridchan.org/" rel="nofollow ugc">http://9gridchan.org/</a></p>
<p>See how it all start&#8217;s to come together, not a nice image isn&#8217;t it!</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259760">

			<div class="comment by-z-lozinski ">

				<p class="commentcredit">

					<span class="commenter">Z.Lozinski</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259760">
						October 17, 2015 1:49 PM					</a>

				</p>

				<p>@ Nick P<br />
&#8220;So, one must wonder what staff they have for FPGA/ASIC design and what solutions they&#8217;re capable of pulling off. &#8230;  Not sure what&#8217;s up with them.&#8221;</p>
<p>I know in the mid/late 1980s that the NSA had in-house silicon designers.  This was after Carver Mead and Lynn Conway&#8217;s work for DARPA on VLSI.  The NSA team published a book describing the library of re-usable modules they had created.  II read through parts of the book in Foyle&#8217;s bookshop in London, but I couldn&#8217;t afford it as it was very expensive. (Over GBP 50, when technical books were GBP 20).</p>
<p>A recent (2011) NSA publication &#8220;The Next Wave: The National Security Agency&#8217;s Review of Emerging Technology. High Confidence Software and Systems&#8221; has a paper on Cryptol, a domain specific language developed by the NSA for cryptographic algorithms, and the associated toolchain to compile down to FPGAs.  There is an example of using Cryptol for 128-bit AES on Xilinx Virtex 4 FPGAs.  (I assume the choice of 128-bit AES is to avoid having to get approval to describe a production implementation).</p>
<p>You can find Next Wave online, but the .PDF seems to be malformed, and it breaks Safari Web-Kit.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259761">

			<div class="comment by-earl-killian ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.killian.com/earl/bio.html' rel='external nofollow ugc' class='url'>Earl Killian</a></span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259761">
						October 17, 2015 1:59 PM					</a>

				</p>

				<p>@Clive Robinson</p>
<p>You wrote: &#8220;Why would you want to use DH if you already had the servers Public Key? DH is a protocol for negotiating a secret key between two parties that have had no previous contact or secure side channel available to securely exchange a key or secret.&#8221;</p>
<p>We already use DH when we have the server&#8217;s public key. Consider the TLS 1.2 cipher TLS_DHE_RSA_WITH_AES_128_GCM_SHA256 where DHE is used for symmetric key exchange and RSA is used for authentication.</p>
<p>You wrote: &#8220;To encrypt DH you would have to have had contact or a secure channel to get the key to do the AES encryption, thus would not need DH.&#8221;</p>
<p>Again, as I said in the original comment, the client would encrypt a random number to be used for symmetric encryption using the server&#8217;s public key. No secure channel is required.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259762">

			<div class="comment by-who ">

				<p class="commentcredit">

					<span class="commenter">Who?</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259762">
						October 17, 2015 2:13 PM					</a>

				</p>

				<p>@Clive Robinson</p>
<blockquote><p>As Bruce has noted in the past a necessary part of being a designer of crypto systems, is the ability to think up ways to attack not just others systems but your own designs as well.  And we need to encourage the &#8220;Thinking Hinky&#8221; attitude in people not repress it, one way we know works is by engaging peoples curiosity, perhaps the most famous mathematical one being an enigmatic note about the lack of space in a margin&#8230;</p></blockquote>
<p>Very true.  It is the only way to let cryptography advance.</p>
<p>Nice reference to Fermat&#8217;s last theorem.  An old theorem that was successfully proof two decades ago by Andrew Willes using&#8230; elliptic curves.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259763">

			<div class="comment by-czerno ">

				<p class="commentcredit">

					<span class="commenter">Czerno</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259763">
						October 17, 2015 2:14 PM					</a>

				</p>

				<p>@Nick P wrote: &#8220;So, this result assumes they have a supercomputer with hundreds of thousands of ASIC&#8217;s. If I read it right.&#8221;</p>
<p>Question for you all : is that kind of computer in existence and viable ? And, I mean, having acceptable reliability (MTBF calculations, anyone ?)</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259764">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259764">
						October 17, 2015 3:17 PM					</a>

				</p>

				<p>@ Z. Lozinski</p>
<p>I&#8217;ve seen Next Wave before. That and other hardware crypto work are mainly done with Galois Inc and Rockwell-Collins, respectively. Galois open-sourced their CRYPTOL language and compiler. Rockwell-Collins has several EAL7-grade toolchains that they describe in detail but probably have no intension of open-sourcing. 😉 So, those docs in Next Wave only hint at a handful of hardware experts with the real work done by contractors.</p>
<p>We&#8217;re still left to wonder what their level of staffing is. However, TAO catalog reveals majority is custom boards or devices w/ COTS IC&#8217;s. If they have the ASIC capability, they use it sparingly.</p>
<p>@ Czerno</p>
<p>&#8220;Question for you all : is that kind of computer in existence and viable ? And, I mean, having acceptable reliability (MTBF calculations, anyone ?)&#8221;</p>
<p>Every HPC cluster is a bunch of ASIC&#8217;s working together. Reliable enough. 😉 The model for this would be general-purpose CPU&#8217;s and I/O with a ton of co-processors. These co-processors would connect to a memory or I/O bus. The standard RAS features in HPC or NUMA machines could be used here. The CPU&#8217;s and I/O would act as drivers to push data into ASIC&#8217;s, monitor their work, and pull data from them. The ASIC&#8217;s would also start out as FPGA&#8217;s solving smaller versions of the problem for proof of concept.</p>
<p>That&#8217;s how I see it playing out if they do it.</p>
<p>Note: They might also use high-end GPU&#8217;s if the algorithm works on them just because many existing HPC solutions are using them.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259765">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259765">
						October 17, 2015 4:54 PM					</a>

				</p>

				<p>@ Earl Killian,</p>
<blockquote><p>as I said in the original comment, the client would encrypt a random number to be used for symmetric encryption using the server&#8217;s public key. No secure channel is required.</p></blockquote>
<p>If you do that to make a secret symmetric key to encrypt the DH why do you need to use DH just to make another secret symmetric key?</p>
<p>In the case you are thinking up the use of the PK cert is the secure channel, and you would have no need to use DH for it&#8217;s original purpose which was to securely come up with a secret key on an open channel&#8230; Thus the idea is in the use case you describe a redundant step.</p>
<p>If you are thinking of another reason to use a secure channel (PK cert) to establish another secure channel with DH then you need to state why you think it&#8217;s not a redundant step. That is why you think the first secure channel (PK cert) should not be used for anything except for DH to make a key for a second secure channel to be used instead of the first secure channel&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259766">

			<div class="comment by-earl-killian ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.killian.com/earl/bio.html' rel='external nofollow ugc' class='url'>Earl Killian</a></span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259766">
						October 18, 2015 9:58 AM					</a>

				</p>

				<p>@Clive Robinson</p>
<p>The reason to use DH after creating a temporary encryption key is to get an ephemeral key for forward secrecy:<br />
<a href="https://en.wikipedia.org/wiki/Forward_secrecy" rel="nofollow ugc">https://en.wikipedia.org/wiki/Forward_secrecy</a></p>
<p>The random key sent by the client would not satisfy forward secrecy. When you see &#8220;DHE&#8221; or &#8220;ECDHE&#8221; in a listing from &#8220;openssl ciphers&#8221; you are getting forward secrecy.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259767">

			<div class="comment by-dirk-praet ">

				<p class="commentcredit">

					<span class="commenter">Dirk Praet</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259767">
						October 18, 2015 12:08 PM					</a>

				</p>

				<p>@ Nick P. , @ Grauhut, @ CallMeLateForSupper, @ All TAILS users</p>
<p><i>&#8230; move to ECC or use 2,048-bit minimum. Bernstein has made it super easy with the NaCl implementations with curves giving tons of security and efficiency at same time. Little excuse other than social factors.</i></p>
<p><i><a href="https://weakdh.org/sysadmin.html" rel="nofollow ugc">https://weakdh.org/sysadmin.html</a></i></p>
<p>Thanks for the pointers, guys. A few comments:</p>
<p>1) For securing OpenSSH, I recommend using <a href="https://stribika.github.io/2015/01/04/secure-secure-shell.html" rel="nofollow ugc">https://stribika.github.io/2015/01/04/secure-secure-shell.html</a> , referenced in @CallMeLateForSupper&#8217;s EFF-link, instead of <a href="https://weakdh.org/sysadmin.html" rel="nofollow ugc">https://weakdh.org/sysadmin.html</a> . It contains detailed instructions for setting Ciphers, KexAlgorithms, MACs, HostKeyAlgorithms etc.</p>
<p>2) When recreating the /etc/ssh/moduli file with &#8220;<i>ssh-keygen -G /etc/ssh/moduli.all -b 4096</i>&#8221; and &#8220;<i>ssh-keygen -T /etc/ssh/moduli.safe -f /etc/ssh/moduli.all</i>&#8220;, make sure to execute those commands on a somewhat recent and powerful machine. On one of my old laptops it ran for several days.</p>
<p>3) Attention TAILS users: current version 1.6 ships with a <em>really</em> old version of openssh-client that doesn&#8217;t yet support most of the recommendations made in above stribika.github.io page. Which means that after every boot you need to upgrade that package with &#8220;<i>sudo apt-get install openssh-client=1:6.6p1-4~bpo70+1</i>&#8221; (or higher) if you plan on doing any (NSA-proof) SSH-sessions.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259768">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259768">
						October 18, 2015 1:23 PM					</a>

				</p>

				<p>@ Dirk</p>
<p>&#8220;When recreating the /etc/ssh/moduli file with &#8220;ssh-keygen -G /etc/ssh/moduli.all -b 4096&#8221; and &#8220;ssh-keygen -T /etc/ssh/moduli.safe -f /etc/ssh/moduli.all&#8221;, make sure to execute those commands on a somewhat recent and powerful machine. On one of my old laptops it ran for several days.&#8221;</p>
<p>I wonder if that&#8217;s the algorithm, RNG, or implementation problem. If you can, see if it&#8217;s using /dev/random. If it is, force it to use /dev/urandom to see if you get better results. If you do get better results, then we know the solution is to use a fast CRNG seeded with /dev/random for default case. A keygen taking hours to days is too much delay to get any uptake.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259769">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259769">
						October 18, 2015 8:50 PM					</a>

				</p>

				<p>@ Earl Killian</p>
<blockquote><p>The reason to use DH after creating a temporary encryption key is to get an ephemeral key for forward secrecy:</p></blockquote>
<p>And the reason for creating the ephemeral key is?</p>
<p>To deal with the possibility that the server private key was compromised by heartbleed or blackbag job etc etc.</p>
<p>So your proposal to solve the issue of a potentially broken ephemeral key protocol is to try and fix it with more of what it was designed to protect against in the first place.</p>
<p>Thus if the server private key ever gets compromised, your fix gets striped off and the broken ephemeral key protocol designed to protect against the possibility gets exposed.</p>
<p>So your idea gains you no protection just added complication, thus at best it&#8217;s a redundant step.</p>
<p>But it could be worse, that random number you encrypt with the server public key gets exposed to the attacker. Due to the way people have written crypto systems in the past, there is a high likelihood that knowing that random number and the system the client uses the attacker can use it to predict the next random number you are going to use as the client secret in the DH protocol&#8230;</p>
<p>So back to you to explain where you think the advantages are in your idea.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259770">

			<div class="comment by-ex-asioworkman ">

				<p class="commentcredit">

					<span class="commenter">Ex ASIOworkman</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259770">
						October 19, 2015 8:33 AM					</a>

				</p>

				<p>Curtisy of <a href="http://www.guru3d.com/news-story/how-is-nsa-breaking-so-much-crypto.html" rel="nofollow ugc">http://www.guru3d.com/news-story/how-is-nsa-breaking-so-much-crypto.html</a></p>
<p>There have been rumors for years that the NSA can decrypt a significant fraction of encrypted Internet traffic. In 2012, James Bamford published an article quoting anonymous former NSA officials stating that the agency had achieved a &#8216;computing breakthrough&#8217; that gave them &#8216;the ability to crack current public encryption.&#8217;</p>
<p>The Snowden documents also hint at some extraordinary capabilities: they show that NSA has built extensive infrastructure to intercept and decrypt VPN traffic and suggest that the agency can decrypt at least some HTTPS and SSH connections on demand. However, the documents do not explain how these breakthroughs work.</p>
<pre><code>The key is, somewhat ironically, Diffie-Hellman key exchange, an algorithm that we and many others have advocated as a defense against mass surveillance. Diffie-Hellman is a cornerstone of modern cryptography used for VPNs, HTTPS websites, email, and many other protocols. Our paper shows that, through a confluence of number theory and bad implementation choices, many real-world users of Diffie-Hellman are likely vulnerable to state-level attackers. 

For the nerds in the audience, here's what's wrong: If a client and server are speaking Diffie-Hellman, they first need to agree on a large prime number with a particular form. There seemed to be no reason why everyone couldn't just use the same prime, and, in fact, many applications tend to use standardized or hard-coded primes. But there was a very important detail that got lost in translation between the mathematicians and the practitioners: an adversary can perform a single enormous computation to “crack” a particular prime, then easily break any individual connection that uses that prime.

How enormous a computation, you ask? Possibly a technical feat on a scale (relative to the state of computing at the time) not seen since the Enigma cryptanalysis during World War II. Even estimating the difficulty is tricky, due to the complexity of the algorithm involved, but our paper gives some conservative estimates. For the most common strength of Diffie-Hellman (1024 bits), it would cost a few hundred million dollars to build a machine, based on special purpose hardware, that would be able to crack one Diffie-Hellman prime every year. 

Would this be worth it for an intelligence agency? Since a handful of primes are so widely reused, the payoff, in terms of connections they could decrypt, would be enormous. Breaking a single, common 1024-bit prime would allow NSA to passively decrypt connections to two-thirds of VPNs and a quarter of all SSH servers globally. Breaking a second 1024-bit prime would allow passive eavesdropping on connections to nearly 20% of the top million HTTPS websites. In other words, a one-time investment in massive computation would make it possible to eavesdrop on trillions of encrypted connections.
</code></pre>
<p>NOTE : The real capabilities of monitoring are far more powerful, at least in Australia.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259771">

			<div class="comment by-rgaff ">

				<p class="commentcredit">

					<span class="commenter">rgaff</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259771">
						October 19, 2015 10:46 AM					</a>

				</p>

				<p>@Nick P, Dirk</p>
<p>In my experience, the first command seems to generate lots of random prime &#8220;candidates&#8221;&#8230; right?  That runs relatively fast.  It&#8217;s the second command that sifts through those candidates to find the ones that are real primes that takes so long.  Thus, it&#8217;s probably not the RNG that&#8217;s the bottleneck.</p>
<p>But if you have really slow and old machines, you can always generate it on another faster one and copy it over (just do so on a private network so there&#8217;s less likelihood of your connection being snooped).</p>
<p>But keep in mind that simply generating 2048-bit primes on a Raspberry Pi 2 isn&#8217;t bad.  You can put multiple sizes in that moduli file (just like it had originally).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259772">

			<div class="comment by-dirk-praet ">

				<p class="commentcredit">

					<span class="commenter">Dirk Praet</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259772">
						October 19, 2015 4:36 PM					</a>

				</p>

				<p>@ rgaff, @ Nick P.</p>
<p><i>In my experience, the first command seems to generate lots of random prime &#8220;candidates&#8221;&#8230; right?</i></p>
<p>Yep. The first command generated 850k+ candidates and took less than an hour. The second one took almost 60 hours to complete on a 10 year-old laptop stuffed with RAM. It generated a moduli file with just 40 records. ssh-keygen seems to use /dev/random indeed.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259773">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259773">
						October 19, 2015 5:19 PM					</a>

				</p>

				<p>@ Dirk, rgaff</p>
<p>The source is mostly in modulo.c, etc. I looked at it. That particular procedure is heavy enough in domain knowledge that an amateur isn&#8217;t speeding it up any aside from an optimized, assembler implementation for their own hardware. More likely to &#8220;optimize&#8221; away some of its security or performance in corner cases.  Well, at least I looked&#8230;</p>
<p>re copy it over</p>
<p>I&#8217;m trying to avoid that as the modern machines are less trustworthy. Best options are an old gaming desktop, hand-me-down server (esp Itanium), Linux on older gaming device (eg PS2), embedded board with DSP, lower subversion FPGA (esp cost/energy-optimized), and GPGPU on recent (probably safe) or older GPU. I mean, anything might work if it&#8217;s truly airgapped. Just gotta remember that what&#8217;s generating your keys and configurations is basically the root of trust. You don&#8217;t want anything getting in or out without lots of effort.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259774">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259774">
						October 19, 2015 6:01 PM					</a>

				</p>

				<p>@ Nick P, et al,</p>
<blockquote><p>I&#8217;m trying to avoid that as the modern machines are less trustworthy. Best options are an old gaming desktop, hand-me-down server&#8230; </p></blockquote>
<p>You might want to look at some of the PC104 and similar cage mount PCs for industrial control, most don&#8217;t have UFEI etc and are designed to take old fashioned ROM chips for the BIOS etc and you can pick and chose what IO cards you add. A friend has a system running Linux with eight serial ports and old fashioned 10BaseT networking, it runs a fairly sophisticated CANbus control system.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259775">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259775">
						October 19, 2015 6:26 PM					</a>

				</p>

				<p>@ Clive Robinson</p>
<p>Appreciate the tip. Got any good sources for stuff like that past the few links that pop up in Google?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259776">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259776">
						October 20, 2015 12:47 AM					</a>

				</p>

				<p>@ Nick P,</p>
<p>Most of the details I have apply to the UK side of the puddle.</p>
<p>However the PC/104 Consortium has a products page,</p>
<p><a href="http://www.pc104.org/products" rel="nofollow ugc">http://www.pc104.org/products</a></p>
<p>From which you can work your way to the distributors of the various manufacturers in your region. Often the distributors will carry product not just from consortium members but other manufacturers as well.</p>
<p>What you are looking for is the older PC104 boards with the PC AT interface if you want to build your own interface cards. I&#8217;ve never been that fond of PCie as you have to get in interface chips that are QFP or worse which makes old school prototyping a pain in the 455.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259777">

			<div class="comment by-taz ">

				<p class="commentcredit">

					<span class="commenter">Taz</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259777">
						October 20, 2015 1:33 PM					</a>

				</p>

				<p>Please!!!</p>
<p>What else can be done to hit the NSA and its personnel?</p>
<p>&#8220;Rest of us&#8221; need a plan. Hit them where it hurts &#8211; their wallet.</p>
<p>Getting even must evolve into a recurring pattern. Not a one off event.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259778">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259778">
						October 20, 2015 1:51 PM					</a>

				</p>

				<p>@Taz,</p>
<blockquote><p>Hit them where it hurts &#8211; their wallet.</p></blockquote>
<p>Their wallet <b>is</b> your wallet!</p>
<p>This joint is getting so quiet, one can almost <i>read</i> a needle drop! Need some controversial subjects to discuss! I have a few, but they are &#8220;too&#8221; controversial and career-limiting for me to start! My sockpuppet is turning in its grave!</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259779">

			<div class="comment by-anura ">

				<p class="commentcredit">

					<span class="commenter">Anura</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259779">
						October 20, 2015 3:12 PM					</a>

				</p>

				<p>@Wael</p>
<p>We could always go off topic in the squid post and start discussing the merits of market socialism, i.e. eliminating private property ownership (as in land, buildings, homes, etc), as well as eliminating corporations, replacing them with cooperatives, NPOs, and publicly owned companies.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259780">

			<div class="comment by-rgaff ">

				<p class="commentcredit">

					<span class="commenter">rgaff</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259780">
						October 20, 2015 4:37 PM					</a>

				</p>

				<p>@Nick P</p>
<p>Regarding avoiding copying it over, due to modern machines being less trustworthy&#8230;</p>
<p>You do have a very good point, of course&#8230;</p>
<p>It really comes down to &#8220;how secure&#8221; one wants to get, and not everyone has the same needs (&#8220;threat model&#8221;).  At the same time, even those of us who (&#8220;think&#8221; we) don&#8217;t need &#8220;perfect&#8221; security (as if there ever was such a thing) we still shouldn&#8217;t get complacent and not keep learning and improving our security over time&#8230; cause the &#8220;bad guys&#8221; are always getting better and better at what they do, we gotta keep up the pace too to keep from getting totally squashed like little bugs.  Security is a road, not a destination.</p>
<p>In this particular case, the way I understand it, the bigger the prime, the less important that it be unique or non-common, because it would take too much resources to crack.  So, for example, when I regenerated all my /etc/ssh/moduli files on all my machines, I generated 2048, 3072, and 4096 on every machine itself&#8230; whereas I generated the 6144 one on only the faster machines and copied to slower ones, and the 8192 I only bothered to generate once and copy the exact same values to all machines.  Yep, it takes a few days, but I think it&#8217;ll work for a few years until the next vulnerability is discovered&#8230;</p>
<p>As far as being secret or truly random&#8230; surely they can&#8217;t be needing to be totally secret and random&#8230; otherwise they wouldn&#8217;t have included the same values in a common file for all users, right?  It&#8217;s just that the shorter ones have a more feasible precomputation attack that becomes even more valuable to expend the resources on when they&#8217;re all common&#8230;</p>
<p>And for those of you who are talking about air gapped&#8230; you don&#8217;t need SSH installed at all on those machines, right? 🙂</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259781">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259781">
						October 20, 2015 7:47 PM					</a>

				</p>

				<p>@ rgaff</p>
<p>&#8220;Yep, it takes a few days, but I think it&#8217;ll work for a few years until the next vulnerability is discovered&#8230;&#8221;</p>
<p>Haha. Realistic perspective.</p>
<p>&#8220;And for those of you who are talking about air gapped&#8230; you don&#8217;t need SSH installed at all on those machines, right? :)&#8221;</p>
<p>Idk about them but I&#8217;m only talking about source machine. That is, the machine that generates the entropy, secrets, or binaries the rest depend on. Optionally that stores their configurations or backups. Needs to be extremely isolated from the computers actually running SSH and connecting to untrusted networks. A basic design principle of mine.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259782">

			<div class="comment by-dirk-praet ">

				<p class="commentcredit">

					<span class="commenter">Dirk Praet</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259782">
						October 20, 2015 8:49 PM					</a>

				</p>

				<p>@ Nick P., @rgaff</p>
<p><i>&#8220;Yep, it takes a few days, but I think it&#8217;ll work for a few years until the next vulnerability is discovered&#8230;&#8221;</i></p>
<p>Still I believe it&#8217;s quite worth doing these little things. Like everyone else, I know there&#8217;s many more known and unknown attack surfaces (hardware, 0days etc.), but every effort &#8211; however small &#8211; that messes with 5Eyes and other criminal decryption capabilities of internet traffic is a step in the right direction.</p>
<p>I&#8217;m actually feeling quite pleased with the TAILS customisations I&#8217;ve been doing over the last couple of weeks &#8211; including this one &#8211; and I hope to be able to dump some of that stuff on Github at some point. Improved the PyBitmessage installation and configuration script and added a couple of extra lines to persistently disable RC4 and the two security.ssl3.dhe_* values in my TAILS start-up script today. Apparently, Firefox still has RC4 enabled by default and won&#8217;t be getting rid of it before January next year (FF44).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259783">

			<div class="comment by-rgaff ">

				<p class="commentcredit">

					<span class="commenter">rgaff</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259783">
						October 21, 2015 1:37 AM					</a>

				</p>

				<p>@ Dirk</p>
<p>I&#8217;d love to see your security improvements to TAILS when they&#8217;re released.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259784">

			<div class="comment by-rgaff ">

				<p class="commentcredit">

					<span class="commenter">rgaff</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259784">
						October 21, 2015 1:49 AM					</a>

				</p>

				<p>@Nick P</p>
<p>Speaking of a higher security machine that generates entropy, secrets, etc, that others depend upon&#8230; I wonder if <a href="http://wiki.cryptech.is" rel="nofollow ugc">http://wiki.cryptech.is</a> will ever produce something usable&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259785">

			<div class="comment by-jiminy-jones ">

				<p class="commentcredit">

					<span class="commenter">jiminy jones</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259785">
						October 21, 2015 10:23 AM					</a>

				</p>

				<p>Absolutely the min RSA-2048 (ASD publicly released advice) is not likely secure, more likey RSA-4096 minimum would be our safest bet they&#8217;d be hoping on.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259786">

			<div class="comment by-saklater-quests ">

				<p class="commentcredit">

					<span class="commenter">saklater quests</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259786">
						October 21, 2015 10:34 AM					</a>

				</p>

				<p>Turing broke the Enigma machines possible codings using his mind and a simple mechanised system. Once you discover a repeating or predictable series of patterns or protocols ( with any ability to detect information denoting order or intelligence, you have an angle)</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259787">

			<div class="comment by-earl-killian ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.killian.com/earl/bio.html' rel='external nofollow ugc' class='url'>Earl Killian</a></span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259787">
						October 21, 2015 12:25 PM					</a>

				</p>

				<p>@Clive Robinson</p>
<p>I was aware of that point when I proposed encrypting the DH key exchange but I still thought it was worthwhile because it requires Eve to accomplish two tasks rather than just one. Eve must both obtain the private key and break all the DH exchanges. It is a two-layer defense.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259788">

			<div class="comment by-ianf ">

				<p class="commentcredit">

					<span class="commenter">ianf</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259788">
						October 21, 2015 1:20 PM					</a>

				</p>

				<p>@ <b>saklater quests</b></p>
<p>Alan Turing was without a doubt a Copernicus-class genius (whom his fellow Brits treated extraordinarily harshly and inhumanely, but that&#8217;s another topic). You are however misinformed as to who broke the Enigma coding principles &#8211; it was a group of Polish mathematically-minded cryptographers who first done it in 1932, when an Enigma box that the Wehrmacht never knew was lost &#8220;fell into&#8221; their lap. They were also the ones to first construct mechanical emulators/ validators for the Enigma, that later stood model for Turing&#8217;s improved and enlarged &#8220;bombe&#8221; version. It <a href="http://www.bbc.com/news/magazine-28167071" rel="nofollow ugc">only took the British 75 years to half-officially acknowledge it</a>, well after the last of sole-British-Bletchley-credit heralds have died. Now that you know the score (described previously in many a code breaking history book—I&#8217;ve known it for 25+ years), you should not perpetuate the untruth.</p>
<ul><b>ObMovieContext</b>: &#8220;Enigma&#8221; (2001) with <a href="https://en.wikipedia.org/wiki/Enigma_(2001_film)#Plot" rel="nofollow ugc">Kate Winslet as love interest to liven up the otherwise dreary task of portraying hush-hush code breaking operation in wartime Britain</a>. Stupid plot point involving a Polish code-breaker willing to betray the British for suppressing just-deciphered knowledge of the Katyn massacre—by boarding an U-boat off Scotland.</ul>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259789">

			<div class="comment by-justin ">

				<p class="commentcredit">

					<span class="commenter">Justin</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259789">
						October 22, 2015 10:02 PM					</a>

				</p>

				<p>@ ianf</p>
<blockquote><p>Alan Turing &#8230; whom his fellow Brits treated extraordinarily harshly and inhumanely, &#8230;</p></blockquote>
<p>Nothing&#8217;s changed.  They don&#8217;t treat people any better than that today.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259790">

			<div class="comment by-ianf ">

				<p class="commentcredit">

					<span class="commenter">ianf</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259790">
						October 23, 2015 1:50 AM					</a>

				</p>

				<p><b>OT</b>. I read it, so you won&#8217;t have to. Reports <i>The Guardian</i> (2 items):</p>
<p><b>An extremely rare and fully operational Nazi Enigma machine has sold for $365,000 in New York, setting a new record at auction</b>.</p>
<p>The M4 machine, which was built between 1943 and 1945, is one of around 150 to have survived from an estimated 1,500 that were built as Nazi Germany fought to fend off the Allies. […]</p>
<p>The <b>M4, with four rotors</b>, is the scarcest of all Enigma encryption machines and was used on naval submarines.</p>
<p>Its manufacture was ordered by German Admiral Karl Donitz due to concerns that the three-rotor Enigma machine had been compromised following the capture of a U-boat in August 1941. […]</p>
<p>Bonhams sold a fully operational <b>M3 Enigma</b> machine for $269,000 at auction in New York last April. <a href="http://gu.com/p/4dhe6" rel="nofollow ugc">http://gu.com/p/4dhe6</a></p>
<ul>Damn, my 1953 <a href="https://mechanicalcalculators.wordpress.com/about/original-odhner-calculators/" rel="nofollow ugc"><b>Original Odhner 127</b></a> (in Grey) mechanical calculator #127-684916, pretty much an enigma for me, is only worth £39.79 on eBay, but so far nobody has made me an offer I couldn&#8217;t refuse!</ul>
<p><b>Disastrous cold war operation provoked row over MI6 responsibility</b>.</p>
<p>A disastrous MI6 operation that resulted in the headless body of a navy frogman being washed up in Chichester harbour provoked a furious row over who should be responsible for Britain’s secret intelligence service, hitherto classified files show.</p>
<p>Commander Lionel “Buster” Crabb was asked by MI6 to inspect the propeller and hull of a new Soviet cruiser, the <i>Ordzhonikidze</i>, which was moored at Portsmouth during Nikita Khrushchev and Marshal Nikolai Bulganin’s official visit to Britain in 1956. But Crabb vanished, and a coroner later ruled that a headless body found in June 1957 was his. […]</p>
<p>An official inquiry attacked MI6 for “errors in tradecraft”, describing as “criminal folly” the decision by Bernard Smith, the officer in charge of the operation, to sign his real name and address in the register of the Sally Port hotel, where he stayed the night with Crabb before the operation. It also noted that the 47-year-old Crabb had not done any diving for six months. An inquest jury on Crabb recorded an open verdict. […] <a href="http://gu.com/p/4dh6y" rel="nofollow ugc">http://gu.com/p/4dh6y</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259791">

			<div class="comment by-markh ">

				<p class="commentcredit">

					<span class="commenter">MarkH</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259791">
						October 24, 2015 6:57 PM					</a>

				</p>

				<p>Probably I&#8217;m getting too old to follow some of these discussions &#8230;</p>
<p>It looked to me, like some comments expressed concern about the security of transferring DH prime candidates from one locus to another.  Probably, I misunderstood.</p>
<p>The mathematical group used for DH key agreement does not need to secret. In most practical applications, it <b>cannot</b> be kept secret!</p>
<p>The same goes for candidate numbers to be tested for suitability as the basis of a DH discrete log group. You can publish them all in the newspaper, it will make no difference!</p>
<p>As distinct from typical crypto applications, it doesn&#8217;t even matter if your attacker knows the internal state of your PRBG. You can post the seed on a highway billboard.</p>
<p>Even using a PRBG is overkill. You could just as well hash strings of ASCII from your favorite news site. Precomputation is estimated to be ultra expensive. It can&#8217;t be done for more than a small list of primes. All you need to be safe from this attack, is not to be on the list! Protection is about the prime being <i>distinct</i>, not <i>impossible to predict</i>.</p>
<p>For a prime to form the basis of a DH multiplication group secure against the precomputation attack, it is necessary and sufficient to be:</p>
<p>• safe:  based on a Sophie Germain prime<br />
• large:  even 1024 bits is estimated to be massively costly to break using today&#8217;s techniques; of course, bigger is safer<br />
• fresh:  distinct from the commonly used DH primes</p>
<p>That&#8217;s it!  <b>You don&#8217;t need anything else.</b></p>
<p>Apart from replacing all of your crypto software with malware, there is only one useful attack an opponent could possibly make against the machine used to compute your DH prime, and that is to tamper with the pseudo-random generation in such a way that with <i>high probability</i>, you will choose a prime that has already been precomputed, or a prime that so many other people will also derive as to render precomputation cost-effective.</p>
<p>That&#8217;s it.  No other attack means anything at all.</p>
<p>Even if the Bad Guys (TM) DID infect your generating machine with malware, it is easy to validate your prime.  You can do it as many times as you want on any computer anywhere.</p>
<p>1) Test it for primality, and then subtract one and test half of that for primality.</p>
<p>2) Check against the widely used primes already out there, to make sure it&#8217;s not on the list.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259792">

			<div class="comment by-carpetcat ">

				<p class="commentcredit">

					<span class="commenter">CarpetCat</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259792">
						October 25, 2015 11:58 AM					</a>

				</p>

				<p>@MarkH</p>
<p>Thanks!</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259793">

			<div class="comment by-gryzor ">

				<p class="commentcredit">

					<span class="commenter">gryzor</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259793">
						October 30, 2015 6:44 AM					</a>

				</p>

				<p>&#8220;Now that this is out, I&#8217;m sure there are a lot of really upset people inside the NSA.&#8221;</p>
<p>I guess I am more upset knowing what they do, than they can ever be knowing that we know.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-259794">

			<div class="comment by-clemens ">

				<p class="commentcredit">

					<span class="commenter">Clemens</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259794">
						December 1, 2015 12:55 PM					</a>

				</p>

				<p>@Bruce: Please fix the link you added on Nov 15 (&#8220;How to protect yourself&#8221;), it should be<br />
<a href="https://www.eff.org/deeplinks/2015/10/how-to-protect-yourself-from-nsa-attacks-1024-bit-DH" rel="nofollow ugc">https://www.eff.org/deeplinks/2015/10/how-to-protect-yourself-from-nsa-attacks-1024-bit-DH</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-259795">

			<div class="comment by-dharma ">

				<p class="commentcredit">

					<span class="commenter">Dharma</span> •

					<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/#comment-259795">
						January 18, 2020 6:12 PM					</a>

				</p>

				<p><a href="https://www.youtube.com/watch?v=jRCJLZl91zU&#038;t=15s" rel="nofollow ugc">https://www.youtube.com/watch?v=jRCJLZl91zU&#038;t=15s</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

	<p class="subscribe-comments">
		<a href="https://www.schneier.com/blog/archives/2015/10/breaking_diffie.html/feed/">
			<img alt="Atom Feed" src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/rss.png">
			Subscribe to comments on this entry		</a>
	</p>

		<div id="respond" class="comment-respond">
		<h2 class="comments-open-header">Leave a comment <small><a rel="nofollow" id="cancel-comment-reply-link" href="/blog/archives/2015/10/breaking_diffie.html#respond" style="display:none;">Cancel reply</a></small></h2><form action="https://www.schneier.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><a href="https://www.schneier.com/wp-login.php?redirect_to=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2015%2F10%2Fbreaking_diffie.html" title="Login">Login</a><p class="comment-form-author"><label for="author">Name</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" /></p>
<p class="comment-form-email"><label for="email">Email</label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" /></p>
<p class="comment-form-url"><label for="url">URL:</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p>
<p class="comment-form-cookies-consent"><input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox" value="yes" /> <label for="wp-comment-cookies-consent">Remember personal info?</label></p>

<p class="comment-form-author">

	<label for="comm_capt_challenge">
		Fill in the blank: the name of this blog is Schneier on ___________ (required):	</label>

	<input id="comm_capt_challenge" name="comm_capt_challenge" size="30" type="text" />
</p>

<div class="comment-form-comment">

	<label for="comment">Comments:</label>

	<textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea>

	<div id="preview-box" class="preview-box hide"></div>
	<img class="comment-loading hide" src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/loader.gif" />

</div>

<p id="allowed">

	<strong>Allowed HTML</strong>
	&lt;a href=&quot;URL&quot;&gt; &bull; &lt;em&gt; &lt;cite&gt; &lt;i&gt; &bull; &lt;strong&gt; &lt;b&gt; &bull; &lt;sub&gt; &lt;sup&gt; &bull; &lt;ul&gt; &lt;ol&gt; &lt;li&gt; &bull; &lt;blockquote&gt; &lt;pre&gt;
	<strong>Markdown Extra</strong> syntax via <a href="https://michelf.ca/projects/php-markdown/extra/">https://michelf.ca/projects/php-markdown/extra/</a>
</p>

<input type="hidden" id="wp_comment_nonce" name="wp_comment_nonce" value="4b1534b792" /><input type="hidden" name="_wp_http_referer" value="/blog/archives/2015/10/breaking_diffie.html" />
<input type="button" id="comment-preview" class="comment-preview comment-actions" value="Preview" />
<input type="button" id="comment-write" class="comment-write comment-actions hide" value="Edit" />

<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Submit" /> <input type='hidden' name='comment_post_ID' value='7321' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p></form>	</div><!-- #respond -->
	
	<div class="stepthrough">
		<a href="https://www.schneier.com/blog/archives/2015/10/problems_with_d.html" rel="prev">← Problems with DNA Evidence</a>		<a href="https://www.schneier.com/blog/archives/2015/10/mapping_finfish.html" rel="next">Mapping FinFisher Users →</a>	</div>

	
<p id="powered">Sidebar photo of Bruce Schneier by Joe MacInnis.</p>
		</div>

		
<aside>
	<div class="sidebar" id="sidebar-two">
		<section><div class="sidesection widget widget_schneier_about" id="schneier_about-2"><h3>About Bruce Schneier</h3><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/Bruce-Schneier.jpg" /><p><p class="small">I am a <a href="https://public-interest-tech.com/">public-interest technologist</a>, working at the intersection of security, technology, and people. I've been writing about security issues on my <a href="/">blog</a> since 2004, and in my monthly <a href="/crypto-gram/">newsletter</a> since 1998. I'm a fellow and lecturer at Harvard's <a href="https://www.hks.harvard.edu/faculty/bruce-schneier">Kennedy School</a>, a board member of <a href="https://www.eff.org/">EFF</a>, and the Chief of Security Architecture at <a href="https://inrupt.com/">Inrupt, Inc.</a> This personal website expresses the opinions of none of those organizations.</p>
</p></div></section><section><div class="sidesection widget widget_schneier_related_posts" id="schneier_related_posts-2"><h3>Related Entries</h3>
<ul>

	<li><a href="https://www.schneier.com/blog/archives/2021/03/illegal-content-and-the-blockchain.html">Illegal Content and the Blockchain</a></li><li><a href="https://www.schneier.com/blog/archives/2021/03/national-security-risks-of-late-stage-capitalism.html">National Security Risks of Late-Stage Capitalism</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/weis-2021-call-for-papers.html">WEIS 2021 Call for Papers</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/ransomware-profitability.html">Ransomware Profitability</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/presidential-cybersecurity-and-pelotons.html">Presidential Cybersecurity and Pelotons</a></li><li><a href="https://www.schneier.com/blog/archives/2021/01/police-have-disrupted-the-emotet-botnet.html">Police Have Disrupted the Emotet Botnet</a></li>
</ul>
</div></section><section><div class="sidesection widget widget_schneier_featured_essays" id="schneier_featured_essays-2"><h3>Featured Essays</h3>
	<ul>
		<li><a href="https://www.schneier.com/essays/archives/2016/04/the_value_of_encrypt.html">The Value of Encryption</a></li><li><a href="https://www.schneier.com/essays/archives/2016/03/data_is_a_toxic_asse.html">Data Is a Toxic Asset, So Why Not Throw It Out?</a></li><li><a href="https://www.schneier.com/essays/archives/2014/01/how_the_nsa_threaten.html">How the NSA Threatens National Security</a></li><li><a href="https://www.schneier.com/essays/archives/2009/01/terrorists_may_use_g.html">Terrorists May Use Google Earth, But Fear Is No Reason to Ban It</a></li><li><a href="https://www.schneier.com/essays/archives/2007/01/in_praise_of_securit.html">In Praise of Security Theater</a></li><li><a href="https://www.schneier.com/essays/archives/2006/08/refuse_to_be_terrori.html">Refuse to be Terrorized</a></li><li><a href="https://www.schneier.com/essays/archives/2006/05/the_eternal_value_of.html">The Eternal Value of Privacy</a></li><li><a href="https://www.schneier.com/essays/archives/2005/09/terrorists_dont_do_m.html">Terrorists Don&#039;t Do Movie Plots</a></li>	</ul>

	<p><a href="https://www.schneier.com/essays/">More Essays</a></p></div></section><section><div class="sidesection widget widget_schneier_archives" id="schneier_archives-2"><h3>Blog Archives</h3>
<ul>

	<li><a href="https://www.schneier.com/blog/calendar.html/">Archive by Month</a></li><li><a href="https://www.schneier.com/blog/newcomments.html/">100 Latest Comments</a></li></ul>

<h4>Blog Tags</h4><ul class="top-tags"><li><a href="https://www.schneier.com/tag/3d-printers/">3d printers</a></li><li><a href="https://www.schneier.com/tag/9-11/">9/11</a></li><li><a href="https://www.schneier.com/tag/aaron-swartz/">Aaron Swartz</a></li><li><a href="https://www.schneier.com/tag/academic/">academic</a></li><li><a href="https://www.schneier.com/tag/academic-papers/">academic papers</a></li><li><a href="https://www.schneier.com/tag/accountability/">accountability</a></li><li><a href="https://www.schneier.com/tag/aclu/">ACLU</a></li><li><a href="https://www.schneier.com/tag/activism/">activism</a></li><li><a href="https://www.schneier.com/tag/adobe/">Adobe</a></li><li><a href="https://www.schneier.com/tag/advanced-persistent-threats/">advanced persistent threats</a></li><li><a href="https://www.schneier.com/tag/adware/">adware</a></li><li><a href="https://www.schneier.com/tag/aes/">AES</a></li><li><a href="https://www.schneier.com/tag/afghanistan/">Afghanistan</a></li><li><a href="https://www.schneier.com/tag/air-marshals/">air marshals</a></li><li><a href="https://www.schneier.com/tag/air-travel/">air travel</a></li><li><a href="https://www.schneier.com/tag/airgaps/">airgaps</a></li><li><a href="https://www.schneier.com/tag/al-qaeda/">al Qaeda</a></li><li><a href="https://www.schneier.com/tag/alarms/">alarms</a></li><li><a href="https://www.schneier.com/tag/algorithms/">algorithms</a></li><li><a href="https://www.schneier.com/tag/alibis/">alibis</a></li><li><a href="https://www.schneier.com/tag/amazon/">Amazon</a></li><li><a href="https://www.schneier.com/tag/android/">Android</a></li><li><a href="https://www.schneier.com/tag/anonymity/">anonymity</a></li><li><a href="https://www.schneier.com/tag/anonymous/">Anonymous</a></li><li><a href="https://www.schneier.com/tag/antivirus/">antivirus</a></li><li><a href="https://www.schneier.com/tag/apache/">Apache</a></li><li><a href="https://www.schneier.com/tag/apple/">Apple</a></li><li><a href="https://www.schneier.com/tag/applied-cryptography/">Applied Cryptography</a></li><li><a href="https://www.schneier.com/tag/artificial-intelligence/">artificial intelligence</a></li><li><a href="https://www.schneier.com/tag/assassinations/">assassinations</a></li></ul><p><a href="https://www.schneier.com/blog/tags.html/">More Tags</a></p></div></section><section><div class="sidesection widget widget_schneier_latest_book" id="schneier_latest_book-3"><h3>Latest Book</h3><a href="https://www.schneier.com/books/click-here/"><img class="sidepic" alt="Click Here to Kill Everybody" src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2018/07/book-ch2-200w.png" /></a><p><a href="https://www.schneier.com/books/">More Books</a></p></div></section><section><div class="sidesection widget widget_schneier_promotion" id="schneier_promotion-2">
<a href="https://www.eff.org/issues/bloggers/legal/join">
	<img src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/join-eff@2x.png" id="effbutton" alt="Support Bloggers' Rights!" title="Support Bloggers' Rights!" /></a>

<a href="https://npo.networkforgood.org/Donate/Donate.aspx?npoSubscriptionId=8252">
	<img src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/support-epic@2x.png" alt="Defend Privacy--Support Epic" title="Defend Privacy--Support Epic" /></a>
</div></section>	</div>
</aside>

		<footer>
			<nav>
				<div class="nav" id="footer-nav">
					<div class="menu-main-menu-container"><ul id="menu-main-menu-1" class="menu"><li class="menu1 menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-50175 current-menu-item"><a href="https://www.schneier.com">Blog</a></li>
<li class="menu2 menu-item menu-item-type-post_type menu-item-object-page menu-item-50916"><a href="https://www.schneier.com/crypto-gram/">Newsletter</a></li>
<li class="menu3 menu-item menu-item-type-post_type menu-item-object-page menu-item-50166"><a href="https://www.schneier.com/books/">Books</a></li>
<li class="menu4 menu-item menu-item-type-custom menu-item-object-custom menu-item-50169"><a href="https://www.schneier.com/essays/">Essays</a></li>
<li class="menu5 menu-item menu-item-type-custom menu-item-object-custom menu-item-50170"><a href="https://www.schneier.com/news/">News</a></li>
<li class="menu6 menu-item menu-item-type-custom menu-item-object-custom menu-item-50171"><a href="https://www.schneier.com/talks/">Talks</a></li>
<li class="menu7 menu-item menu-item-type-post_type menu-item-object-page menu-item-50167"><a href="https://www.schneier.com/academic/">Academic</a></li>
<li class="menu8 menu-item menu-item-type-post_type menu-item-object-page menu-item-50174"><a href="https://www.schneier.com/blog/about/">About Me</a></li>
</ul></div>				</div>
			</nav>
		</footer>

		</div><!--#main-->
	</div><!--#wrapper-->

		<script type="text/javascript">
		(function () {
			var c = document.body.className;
			c = c.replace(/woocommerce-no-js/, 'woocommerce-js');
			document.body.className = c;
		})();
	</script>
	<script type='text/javascript' src='https://c0.wp.com/p/woocommerce/5.1.0/assets/js/jquery-cookie/jquery.cookie.min.js' id='jquery-cookie-js'></script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/vendor/socialshareprivacy/js/socialshareprivacy.js?ver=1.0.1' id='social-share-privacy-js'></script>
<script type='text/javascript' id='social-share-privacy-icons-js-extra'>
/* <![CDATA[ */
var schneierSocial = {"path":"https:\/\/www.schneier.com\/wp-content\/themes\/schneier\/assets\/vendor\/socialshareprivacy\/"};
/* ]]> */
</script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/vendor/socialshareprivacy/js/icons.js?ver=1.0.0' id='social-share-privacy-icons-js'></script>
<script type='text/javascript' id='schneier-comment-js-extra'>
/* <![CDATA[ */
var schneierComment = {"translateErrorSecurityAnswerWrong":"Your response to the challenge question ('The name of this blog is Schneier on ____') was not correct. Please try again.","ajax_url":"https:\/\/www.schneier.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/js/comment.js?ver=1.0.1' id='schneier-comment-js'></script>
<script type='text/javascript' src='https://c0.wp.com/c/5.7/wp-includes/js/wp-embed.min.js' id='wp-embed-js'></script>

</body>

</html>
