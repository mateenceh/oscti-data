<!DOCTYPE html>
<html lang="en-US">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<title>MongoDB Offers Field Level Encryption - Schneier on Security</title>
	<meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel='dns-prefetch' href='//c0.wp.com' />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Feed" href="https://www.schneier.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Comments Feed" href="https://www.schneier.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; MongoDB Offers Field Level Encryption Comments Feed" href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html/feed/" />
<link rel='stylesheet' id='wp-block-library-css'  href='https://c0.wp.com/c/5.7/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all' />
<style id='wp-block-library-inline-css' type='text/css'>
.has-text-align-justify{text-align:justify;}
</style>
<style id='woocommerce-inline-inline-css' type='text/css'>
.woocommerce form .form-row .required { visibility: visible; }
</style>
<link rel='stylesheet' id='schneier-css'  href='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/style.css?ver=1.0.0' type='text/css' media='all' />
<link rel='stylesheet' id='schneier-main-css'  href='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/dist/css/style.css?ver=1.0.2' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css'  href='https://c0.wp.com/p/jetpack/9.5.2/css/jetpack.css' type='text/css' media='all' />
<script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js?ver=3.5.1' id='jquery-js'></script>
<link rel="https://api.w.org/" href="https://www.schneier.com/wp-json/" /><link rel="alternate" type="application/json" href="https://www.schneier.com/wp-json/wp/v2/posts/12119" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://www.schneier.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://www.schneier.com/wp-includes/wlwmanifest.xml" /> 

<link rel="canonical" href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html" />
<link rel='shortlink' href='https://www.schneier.com/?p=12119' />
<link rel="alternate" type="application/json+oembed" href="https://www.schneier.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2019%2F06%2Fmongodb_offers_.html" />
<link rel="alternate" type="text/xml+oembed" href="https://www.schneier.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2019%2F06%2Fmongodb_offers_.html&#038;format=xml" />
	<noscript><style>.woocommerce-product-gallery{ opacity: 1 !important; }</style></noscript>
	<link rel="icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-32x32.png" sizes="32x32" />
<link rel="icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-180x180.png" />
<meta name="msapplication-TileImage" content="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-270x270.png" />
		<style type="text/css" id="wp-custom-css">
			#schneier_promotion-2 img {
    max-width: 180px;
}		</style>
		</head>

<body class="post-template-default single single-post postid-12119 single-format-standard theme-schneier woocommerce-no-js">

	<div id="wrapper">
		<div id="main">

			<header>
				<div id="header">
					<h1>
						<a href="https://www.schneier.com/" rel="home">
							Schneier on Security						</a>
					</h1>
				</div>
			</header>

			<nav>
				<div class="nav" id="header-nav">
					<div class="menu-main-menu-container"><ul id="menu-main-menu" class="menu"><li id="menu-item-50175" class="menu1 menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-50175 current-menu-item"><a href="https://www.schneier.com">Blog</a></li>
<li id="menu-item-50916" class="menu2 menu-item menu-item-type-post_type menu-item-object-page menu-item-50916"><a href="https://www.schneier.com/crypto-gram/">Newsletter</a></li>
<li id="menu-item-50166" class="menu3 menu-item menu-item-type-post_type menu-item-object-page menu-item-50166"><a href="https://www.schneier.com/books/">Books</a></li>
<li id="menu-item-50169" class="menu4 menu-item menu-item-type-custom menu-item-object-custom menu-item-50169"><a href="https://www.schneier.com/essays/">Essays</a></li>
<li id="menu-item-50170" class="menu5 menu-item menu-item-type-custom menu-item-object-custom menu-item-50170"><a href="https://www.schneier.com/news/">News</a></li>
<li id="menu-item-50171" class="menu6 menu-item menu-item-type-custom menu-item-object-custom menu-item-50171"><a href="https://www.schneier.com/talks/">Talks</a></li>
<li id="menu-item-50167" class="menu7 menu-item menu-item-type-post_type menu-item-object-page menu-item-50167"><a href="https://www.schneier.com/academic/">Academic</a></li>
<li id="menu-item-50174" class="menu8 menu-item menu-item-type-post_type menu-item-object-page menu-item-50174"><a href="https://www.schneier.com/blog/about/">About Me</a></li>
</ul></div>				</div>
			</nav>

			
<aside>
	<div class="sidebar" id="sidebar-one">
		<section><div class="sidesection widget widget_schneier_search" id="schneier_search-3"><h3>Search</h3>
<p class="small">
	<em>Powered by <a href="https://duckduckgo.com/">DuckDuckGo</a></em></p>

<form method="get" action="https://duckduckgo.com/">

	<input type="hidden" name="kh" value="1" /><!-- use https -->

	<input id="search" name="q" size="15" maxlength="255" />

	<input type="submit" value="Go" /><br>

	<input type="radio" name="sites" id="searchblog" value="www.schneier.com/blog" />
	<label for="searchblog">Blog</label>

	<input type="radio" name="sites" id="searchessays" value="www.schneier.com/essays" />
	<label for="searchessays">Essays</label>

	<input type="radio" name="sites" id="searchall" value="www.schneier.com" checked="" />
	<label for="searchall">Whole site</label>

</form>
</div></section><section><div class="sidesection widget widget_schneier_social" id="schneier_social-2"><h3>Subscribe</h3>
<div id="subscription-buttons">

	<a href="https://www.schneier.com/feed/atom"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/rss-32px.png" alt="Atom Feed" /></a><a href="https://www.facebook.com/bruce.schneier"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/facebook-32px.png" alt="Facebook" /></a><a href="https://twitter.com/schneierblog/"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/twitter-32px.png" alt="Twitter" /></a><a href="https://www.amazon.com/Schneier-on-Security/dp/B0053HDDWW/"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/kindle-32px.png" alt="Kindle" /></a><a href="https://www.schneier.com/crypto-gram"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/email-32px.png" alt="E-Mail Newsletter (Crypto-Gram)" /></a>
</div>
</div></section>	</div>
</aside>

			<div id="content">

				
		<p id="breadcrumbs">

			<a href="https://www.schneier.com">Home</a><a href="https://www.schneier.com/blog/archives/">Blog</a>		</p>

		
<article id="post-12119" class="post-12119 post type-post status-publish format-standard hentry category-uncategorized tag-authentication tag-cryptography tag-encryption tag-hacking tag-keys">

	<div class="article">

		<h2 class="entry">MongoDB Offers Field Level Encryption</h2>
		<p>MongoDB now has the ability to <a href="https://www.wired.com/story/field-level-encryption-databases-mongobd/">encrypt data by field</a>:</p>
<blockquote><p>MongoDB calls the new feature Field Level Encryption. It works kind of like end-to-end encrypted messaging, which scrambles data as it moves across the internet, revealing it only to the sender and the recipient. In such a &#8220;client-side&#8221; encryption scheme, databases utilizing Field Level Encryption will not only require a system login, but will additionally require specific keys to process and decrypt specific chunks of data locally on a user&#8217;s device as needed. That means MongoDB itself and cloud providers won&#8217;t be able to access customer data, and a database&#8217;s administrators or remote managers don&#8217;t need to have access to everything either.</p>
<p>For regular users, not much will be visibly different. If their credentials are stolen and they aren&#8217;t using multifactor authentication, an attacker will still be able to access everything the victim could. But the new feature is meant to eliminate single points of failure. With Field Level Encryption in place, a hacker who steals an administrative username and password, or finds a software vulnerability that gives them system access, still won&#8217;t be able to use these holes to access readable data.</p></blockquote>

		
			<p class="entry-tags">
				<span class="tags-links">Tags: <a href="https://www.schneier.com/tag/authentication/" rel="tag">authentication</a>, <a href="https://www.schneier.com/tag/cryptography/" rel="tag">cryptography</a>, <a href="https://www.schneier.com/tag/encryption/" rel="tag">encryption</a>, <a href="https://www.schneier.com/tag/hacking/" rel="tag">hacking</a>, <a href="https://www.schneier.com/tag/keys/" rel="tag">keys</a></span>			</p>

		
		
		<p class="posted">
			<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html" rel="bookmark">Posted on June 26, 2019 at 1:03 PM</a>			•
			<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html#comments">22 Comments</a>		</p>

		<aside><div class="schneier-share share" data-uri="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html" data-title="MongoDB Offers Field Level Encryption" data-order="facebook twitter tumblr" data-social-share-privacy="true" /></aside>
	</div>

</article>


	<h3 id="comments">Comments</h3>

	
		<article class="comment even thread-even depth-1" id="comment-337656">

			<div class="comment by-alejandro ">

				<p class="commentcredit">

					<span class="commenter">Alejandro</span> •

					<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html/#comment-337656">
						June 26, 2019 1:40 PM					</a>

				</p>

				<p>Sounds wonderful.</p>
<p>What&#8217;s the catch?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-337657">

			<div class="comment by-steven-clark ">

				<p class="commentcredit">

					<span class="commenter">Steven Clark</span> •

					<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html/#comment-337657">
						June 26, 2019 1:45 PM					</a>

				</p>

				<p>I&#8217;m not getting the part where the database should have any say in this.  Shouldn&#8217;t every database be capable of field level encryption if you choose the right raw field types and encrypt at the application?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-337658">

			<div class="comment by-jeremy ">

				<p class="commentcredit">

					<span class="commenter">Jeremy</span> •

					<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html/#comment-337658">
						June 26, 2019 2:32 PM					</a>

				</p>

				<p>@Steven Clark &#8211; Agreed.</p>
<p>@Alejandro &#8211; I don&#8217;t have technical details for this particular implementation, but the typical drawbacks to having the client end-to-end encrypt data that&#8217;s going to be stored on a server are:</p>
<ol>
<li>
<p>The server cannot search, filter, index, or otherwise process the data in any way.</p>
</li>
<li>
<p>The server cannot compress or deduplicate the data, and thus needs more storage space (and possibly more bandwidth).  Clients can potentially compress before encrypting, but cannot deduplicate data across multiple accounts.</p>
</li>
<li>
<p>The client can only read the data from a device where their key is stored.</p>
</li>
<li>
<p>If the client loses their key, the data is unrecoverable.</p>
</li>
</ol>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-337659">

			<div class="comment by-gweihir ">

				<p class="commentcredit">

					<span class="commenter">Gweihir</span> •

					<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html/#comment-337659">
						June 26, 2019 2:41 PM					</a>

				</p>

				<p>On the other hand, an Attacker that has time and collects data that is being accessed still gets pretty much everything of value.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-337660">

			<div class="comment by-gweihir ">

				<p class="commentcredit">

					<span class="commenter">Gweihir</span> •

					<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html/#comment-337660">
						June 26, 2019 2:44 PM					</a>

				</p>

				<p>Ah, correction, the attacker will get everything that was used to search and select this data. That still has to be done or the whole benefits of using a DB goes out the window. Sounds excessively slow as it is though.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-337661">

			<div class="comment by-sed-contra ">

				<p class="commentcredit">

					<span class="commenter">Sed Contra</span> •

					<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html/#comment-337661">
						June 26, 2019 3:00 PM					</a>

				</p>

				<p>So we will never have to hear it said that “MongoDB pwned in game of life”.</p>
<p><a href="https://youtube.com/watch?v=SKRma7PDW10" rel="nofollow ugc">https://youtube.com/watch?v=SKRma7PDW10</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-337662">

			<div class="comment by-david-leppik ">

				<p class="commentcredit">

					<span class="commenter">David Leppik</span> •

					<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html/#comment-337662">
						June 26, 2019 5:08 PM					</a>

				</p>

				<p>Looking at the release notes, they give an example of a record containing personal information. The person&#8217;s name is public, but Social Security Number, Phone, and Email are each encrypted.</p>
<p>It&#8217;s somewhat more convenient and obvious than storing encrypted fields in a database where the database doesn&#8217;t know anything about the encryption. They&#8217;ve taken a simple programming task and turned it into a DB administration task. I suspect they wouldn&#8217;t have bothered, except that as a primarily cloud-hosted database they can offer it as a service.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-337663">

			<div class="comment by-doug ">

				<p class="commentcredit">

					<span class="commenter">Doug</span> •

					<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html/#comment-337663">
						June 26, 2019 5:52 PM					</a>

				</p>

				<p>Available in Lotus/IBM/HCL Notes since 1993. Glad the rest of the world is catching up!</p>
<p>This is a brief description that is for version 8.5 but applies back to the original rev.</p>
<p><a href="https://www.ibm.com/support/knowledgecenter/en/SSVRGU_8.5.3/com.ibm.designer.domino.main.doc/H_DOCUMENT_AND_FIELD_ENCRYPTION_OVERVIEW.html" rel="nofollow ugc">https://www.ibm.com/support/knowledgecenter/en/SSVRGU_8.5.3/com.ibm.designer.domino.main.doc/H_DOCUMENT_AND_FIELD_ENCRYPTION_OVERVIEW.html</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-337664">

			<div class="comment by-mike-d ">

				<p class="commentcredit">

					<span class="commenter">Mike D.</span> •

					<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html/#comment-337664">
						June 26, 2019 7:50 PM					</a>

				</p>

				<p>@Jeremy Couldn&#8217;t the database deduplicate on a full-field basis, in the specific case where the same user using the same key stores the same object using, say, different devices? It would seem the ciphertexts would match in this case. The server could use hashes to detect candidate duplicates and full compares to be sure.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-337665">

			<div class="comment by-evan ">

				<p class="commentcredit">

					<span class="commenter">Evan</span> •

					<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html/#comment-337665">
						June 26, 2019 8:37 PM					</a>

				</p>

				<p>@Mike D.</p>
<p>I haven&#8217;t looked at this implementation, but it would be reasonable to use a salt value (even the row key would do) to prevent two fields with the same data hashing to the same value. The fact that two encrypted rows are the same is actually pretty useful for correlation (and possibly frequency analysis).</p>
<p>IIRC, MongoDB is mostly key-value rather than rich indexes like and aggregation like SQL. This means that you don&#8217;t lose much expressiveness if you encrypt the value part.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-337666">

			<div class="comment by-ismar ">

				<p class="commentcredit">

					<span class="commenter">Ismar</span> •

					<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html/#comment-337666">
						June 26, 2019 11:04 PM					</a>

				</p>

				<p>“One reason that no one did this before was because they didn’t perceive customer demand the way that it’s easy to perceive today,&#8221; says Davi Ottenheimer, MongoDB&#8217;s vice president of trust and digital ethics. All those high-profile database breaches have finally started to make companies aware of what solid encryption is worth.”</p>
<p>Encouraging sign</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-337667">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html/#comment-337667">
						June 27, 2019 3:15 AM					</a>

				</p>

				<p>@ Alejandro,</p>
<blockquote><p>Sounds wonderful. What&#8217;s the catch?</p></blockquote>
<p>The article is far from clear on what the mechanics of this scheme are, so any answer will have to be made on assumptions.</p>
<p>It also helps if you have Dorothy Dennings book on database security via encryption.</p>
<p>As a basic proviso a database consists of a large number of records which are made up of fields usually laid out in a consistant form. That is one field will be some kind of index called the &#8220;Primary Key&#8221; or a combination of two or more fields that will be unique to each record.</p>
<p>Where as a primary key can be just an integer sequential serial number for each record secondary keys can be like house addresses where a house number street name and local region identifier can be strings of alpha chars.</p>
<p>An integer primary key field generaly contains no usefull information unless you know how the records were ordered. Secondary key fields almost by definition carry usefull information. Therefore a primary key field does not of necessity need to be encrypted where as the  secondary key fields do.</p>
<p>Fields that are not encrypted can be searched for by the database engine on the cloud host, whilst encrypted fields can only be searched where they have been decrypted back to plaintext.</p>
<p>As the decryption can be done at eirher the DB Server or Client application.</p>
<p>One way a search can be done securely at a server is with the equivalent of an HSM. The HSM contains the field keys thus you could arange for a HSM to take a value, range of values or search string to check, and the appropriate field identifier as the base input the DB then sends each record to the HSM and gets a boolian &#8220;Yes/No&#8221; response for that record from the HSM. As you can appreciate having to check tens of thousands of records is going to be a slow process&#8230; However even slower would be to do the same thing on a distant client where you have all the network delays etc as well.</p>
<p>The great hope to break this deadlock issue was a new type of encryption that would alow you to do mathmatics on encrypted data without having to decrypt first.</p>
<p>In some respects we can already do so. For instance a stream cipher using an addative encryption rather than an XOR alows with Chinese Clock Mathmatics numbers to be added or subtracted. But you have know idea without decrypting if you have got to zero, so you can not do comparison operations which is the fundemental operation of searching&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-337668">

			<div class="comment by-no-one-ex-cathedra ">

				<p class="commentcredit">

					<span class="commenter">No One / Ex Cathedra</span> •

					<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html/#comment-337668">
						June 27, 2019 4:47 AM					</a>

				</p>

				<p>But the companies involved must still have access to the information in the databases&#8211;or did I miss something?  How will the companies involved process the plaintext data if they cannot access it?</p>
<p>I also like that the end-users will be able to keep an eye on the integrity of their data.</p>
<p>Folks who are crypto savvy might end up sleeping better at night.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-337669">

			<div class="comment by-gregw ">

				<p class="commentcredit">

					<span class="commenter">GregW</span> •

					<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html/#comment-337669">
						June 27, 2019 6:13 AM					</a>

				</p>

				<p>@Jeremy,<br />
Good list of reasons field level encryption makes sense.</p>
<p>I&#8217;d call out two more as someone frustrated that my current database doesn&#8217;t have field level encryption.</p>
<p>First, field level encryption allows data in your database that you don&#8217;t want the DBA and/or DBA/app support personnel to be able to view when carrying out their daily duties. Payroll-related, sensitive PII data, credit cards etc. (Now it&#8217;s really better not to store that data at all if you can possibly figure out an alternative (data is a liability!), especially credit cards which can be stored by your payment processor, but that won&#8217;t work in every situation.)</p>
<p>The only people with a need to know the plaintext are the service account ingesting the data and the service account or individual authorized to read the data. And the database application itself. Perhaps the DBA has access to a recovery key of some kind whose use/retrieval can be governed by a security policy, stored in a two-key safe, etc.</p>
<p>Second, if your database is not for an application, but instead used for analytics and reporting (data warehouse/business intelligence/data lake/etc), the many off the shelf reporting and visualization clients have no client side encryption as there is no standard SQL-level support for specifying public/private keys.</p>
<p>Once your database has to support even a single use case with sensitive data ( say mashing up payroll-related sales commissions with a billion rows of transactional sales data), you are pushed into a trio of choices:</p>
<p>1) Don&#8217;t use or allow the business to use traditional reporting tools. Build custom apps for ingesting and viewing the data and do encryption/decryption there.<br />
2) Bring the sensitive data into a completely separate database from your main datastore, one.which is much more tightly segregated/controlled. Create jobs to move/copy all the transactional data needed for mashup into this database. This may be expensive if theres a lot of data. This may either require the data to arrive late or require additional care to ensure it doesnt get out of sync with your primary datastore depending on how you implement the data movement.<br />
3) Bring the sensitive data into it&#8217;s own database, leave the transactional data elsewhere and do the mashup/JOIN operations in the reporting tool&#8217;s memory&#8230; which tends to be slower than an in-database join as provided in options 1 or 2.</p>
<p>Field level encryption would allow some mitigation of these risks/costs.</p>
<p>It&#8217;s true you are increasing the surface area of code (ie a huge database app) with access to your particularly sensitive data but the ability to reduce insider access to that data would seem to outweigh that.</p>
<p>I can understand why field level encryption might be best done at the application level whenever that&#8217;s possible, but I don&#8217;t really understand why field level encryption wouldn&#8217;t be a useful security feature particularly in columnar (analytics-oriented) databases. Am I wrong?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-337670">

			<div class="comment by-me ">

				<p class="commentcredit">

					<span class="commenter">Me</span> •

					<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html/#comment-337670">
						June 27, 2019 12:27 PM					</a>

				</p>

				<p>So, does this mean that the encrypted fields cannot be used to search?</p>
<p>Or does this mean that searches what include filtering on encrypted fields will pull everything local, decrypt, and then filter, which would be very slow and wasteful?</p>
<p>We already saw the article about the practical attack on the theoretical encrypted database that could recreate the data based solely on statistics and knowing which rows were returned based on queries that couldn&#8217;t be read (except for the field names).  So I assume this isn&#8217;t that.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-337671">

			<div class="comment by-fragile ">

				<p class="commentcredit">

					<span class="commenter">fragile</span> •

					<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html/#comment-337671">
						June 27, 2019 2:06 PM					</a>

				</p>

				<p>Client calls helpdesk : &#8220;my query doesn&#8217;t work, i get strange results&#8221;<br />
Helpdesk : &#8220;sorry, can&#8217;t help you, we cant&#8217;s see a thing&#8221;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-337672">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html/#comment-337672">
						June 27, 2019 4:42 PM					</a>

				</p>

				<p>@ Me,</p>
<blockquote><p>So, does this mean that the encrypted fields cannot be used to search?</p></blockquote>
<p>With current encryption unless you have the key or known encrypted value for zero then no.</p>
<p>As I mentioned above there are various things you can do with stream encrypted data provided you know the size (2^N) of the field used for integers in a record field[1]. Likewise there are other things you can do with other forms of encryption. However the problem with searching is &#8220;finding zero&#8221; or &#8220;within a range&#8221; when comparing and this is a whole different balk game.</p>
<p>So for now atleast to search you have to do it at the server end or at the client end. The cliebt end as you note &#8220;which would be very slow and wasteful&#8221;.</p>
<p>But worse it leaves you open to all sorts of risk that most would not at first realise. An obvious short cut would be for the client to encrypt the desired search value and send that in the queary to the DataBase Engine. Whilst it works and plaintext is not revealed it alows for easy statistical analysis which is bad, at the best of times. There are techniques that use different keys on the same record field and a secondary mac field. If the Database Engine has a match on the encrypted field value the client has sent, the client if lacking the proper key will on decrypting the record mac field will not get a correct result (within certain limits). Such tricks do make improvments in reducing the records downloaded but they only make the statistical problem slightly more difficult.</p>
<p>All in all searching encrypted database record fields withour first decrypring is something that has engaged some of the finest minds for something like seven decades. What we do know is that nobody has proved you can not do it so people keep thinking on the problem and in times past I wasted ebough time to write a dissertation on the subject, then I wised up and realised it needs something that several decades later is still sitting like a miraja on the distant horizon.</p>
<p>But techbology has moved on and now it&#8217;s nolonger a theoretical activity. Those who have invested large amounts in Cloud Infrastructure are starting to see reluctance increasing as more and more stories about Silicon Valley Companies having &#8220;special relationships&#8221; with various US and other Five Eye intelligence agencies and even law enforcment agencies. Their &#8220;Trust us we&#8217;re the good guys&#8221; image is not so much tarnished as compleatly shattered. And it&#8217;s not just Databases in the traditional sense it&#8217;s &#8220;Software as a Service&#8221; as well. There are some quite creepy rumours surfacing about those in education where not just schools but colleges and universities have handed over students PII to Google and Microsoft both of whom are using it for all sorts of purposes that would horrify the students parents, if not the students&#8230;<br />
However drawing the attention of the academic institutions hierarchy to what is happening is rebuffed, poo-pooed or in less polite ways denigrated, and refusal to use these systems considered if not directly threatened as termination of the students education&#8230;</p>
<p>[1] One of the joys of a language with a limited number of words is that sometimes words get reused in different domains of endevor thus can even when used in context be confusing. Hence field in a record has a very different meaning to the mathmatical use of field.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-337673">

			<div class="comment by-realfakenews ">

				<p class="commentcredit">

					<span class="commenter">RealFakeNews</span> •

					<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html/#comment-337673">
						June 28, 2019 9:32 PM					</a>

				</p>

				<p>Wow.</p>
<p>I&#8217;ve been doing this for decades already. Why does the DB engine need to get involved?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-337674">

			<div class="comment by-realfakenews ">

				<p class="commentcredit">

					<span class="commenter">RealFakeNews</span> •

					<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html/#comment-337674">
						June 28, 2019 9:36 PM					</a>

				</p>

				<p>I&#8217;ve not needed to do it, but if you insist on certain encrypted data being searchable, store only specific fields as a hash value in addition to the encrypted value.</p>
<p>You double the database size, but you wanted to search it, right?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-337675">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> •

					<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html/#comment-337675">
						June 29, 2019 12:43 PM					</a>

				</p>

				<p>@ RealFakeNews,</p>
<blockquote><p>if you insist on certain encrypted data being searchable, store only specific fields as a hash value in addition to the encrypted value.</p></blockquote>
<p>That opens up a whole bunch of statistical attacks.</p>
<p>Hashing a value smaller than the hash size is in effect a simple &#8220;substitution cipher&#8221; with large alphabet. It also only works for &#8220;exact matches&#8221; not &#8220;range matches&#8221;.</p>
<p>Further a problem with hashes is &#8220;Dictionary Attacks&#8221; especially with precomputed rainbow tables.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-337676">

			<div class="comment by-davi-ottenheimer ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.flyingpenguin.com/' rel='external nofollow ugc' class='url'>Davi Ottenheimer</a></span> •

					<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html/#comment-337676">
						July 2, 2019 11:16 AM					</a>

				</p>

				<p>We did it! Looking forward in the coming months to discussing why I drove this feature into the database and how it ultimately was designed.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-356409">

			<div class="comment by-anonymous ">

				<p class="commentcredit">

					<span class="commenter">Anonymous</span> •

					<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html/#comment-356409">
						October 7, 2020 12:54 AM					</a>

				</p>

				<p>Indeed a great feature<br />
Lacking is the ability to search over the encrypted data.<br />
More over and maybe the biggest pitfall is that it is very tightly coupled with MongoDb.</p>
<p>Organizations from a certain size have multiple data sources, all containing PI data.<br />
They are trying to avoid as much as possible cutom solutions and looking for a complete holistic solutions which will work with all their databases on all clouds and on-prem environements.</p>
<p>The only one which does that (and with the search capability) is <a href="http://www.kindite.com" rel="nofollow ugc">http://www.kindite.com</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

	<p class="subscribe-comments">
		<a href="https://www.schneier.com/blog/archives/2019/06/mongodb_offers_.html/feed/">
			<img alt="Atom Feed" src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/rss.png">
			Subscribe to comments on this entry		</a>
	</p>

		<div id="respond" class="comment-respond">
		<h2 class="comments-open-header">Leave a comment <small><a rel="nofollow" id="cancel-comment-reply-link" href="/blog/archives/2019/06/mongodb_offers_.html#respond" style="display:none;">Cancel reply</a></small></h2><form action="https://www.schneier.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><a href="https://www.schneier.com/wp-login.php?redirect_to=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2019%2F06%2Fmongodb_offers_.html" title="Login">Login</a><p class="comment-form-author"><label for="author">Name</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" /></p>
<p class="comment-form-email"><label for="email">Email</label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" /></p>
<p class="comment-form-url"><label for="url">URL:</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p>
<p class="comment-form-cookies-consent"><input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox" value="yes" /> <label for="wp-comment-cookies-consent">Remember personal info?</label></p>

<p class="comment-form-author">

	<label for="comm_capt_challenge">
		Fill in the blank: the name of this blog is Schneier on ___________ (required):	</label>

	<input id="comm_capt_challenge" name="comm_capt_challenge" size="30" type="text" />
</p>

<div class="comment-form-comment">

	<label for="comment">Comments:</label>

	<textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea>

	<div id="preview-box" class="preview-box hide"></div>
	<img class="comment-loading hide" src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/loader.gif" />

</div>

<p id="allowed">

	<strong>Allowed HTML</strong>
	&lt;a href=&quot;URL&quot;&gt; &bull; &lt;em&gt; &lt;cite&gt; &lt;i&gt; &bull; &lt;strong&gt; &lt;b&gt; &bull; &lt;sub&gt; &lt;sup&gt; &bull; &lt;ul&gt; &lt;ol&gt; &lt;li&gt; &bull; &lt;blockquote&gt; &lt;pre&gt;
	<strong>Markdown Extra</strong> syntax via <a href="https://michelf.ca/projects/php-markdown/extra/">https://michelf.ca/projects/php-markdown/extra/</a>
</p>

<input type="hidden" id="wp_comment_nonce" name="wp_comment_nonce" value="4b1534b792" /><input type="hidden" name="_wp_http_referer" value="/blog/archives/2019/06/mongodb_offers_.html" />
<input type="button" id="comment-preview" class="comment-preview comment-actions" value="Preview" />
<input type="button" id="comment-write" class="comment-write comment-actions hide" value="Edit" />

<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Submit" /> <input type='hidden' name='comment_post_ID' value='12119' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p></form>	</div><!-- #respond -->
	
	<div class="stepthrough">
		<a href="https://www.schneier.com/blog/archives/2019/06/person_in_latex.html" rel="prev">← Person in Latex Mask Impersonated French Minister</a>		<a href="https://www.schneier.com/blog/archives/2019/06/spanish_soccer_.html" rel="next">Spanish Soccer League App Spies on Fans →</a>	</div>

	
<p id="powered">Sidebar photo of Bruce Schneier by Joe MacInnis.</p>
		</div>

		
<aside>
	<div class="sidebar" id="sidebar-two">
		<section><div class="sidesection widget widget_schneier_about" id="schneier_about-2"><h3>About Bruce Schneier</h3><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/Bruce-Schneier.jpg" /><p><p class="small">I am a <a href="https://public-interest-tech.com/">public-interest technologist</a>, working at the intersection of security, technology, and people. I've been writing about security issues on my <a href="/">blog</a> since 2004, and in my monthly <a href="/crypto-gram/">newsletter</a> since 1998. I'm a fellow and lecturer at Harvard's <a href="https://www.hks.harvard.edu/faculty/bruce-schneier">Kennedy School</a>, a board member of <a href="https://www.eff.org/">EFF</a>, and the Chief of Security Architecture at <a href="https://inrupt.com/">Inrupt, Inc.</a> This personal website expresses the opinions of none of those organizations.</p>
</p></div></section><section><div class="sidesection widget widget_schneier_related_posts" id="schneier_related_posts-2"><h3>Related Entries</h3>
<ul>

	<li><a href="https://www.schneier.com/blog/archives/2021/03/illegal-content-and-the-blockchain.html">Illegal Content and the Blockchain</a></li><li><a href="https://www.schneier.com/blog/archives/2021/03/national-security-risks-of-late-stage-capitalism.html">National Security Risks of Late-Stage Capitalism</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/weis-2021-call-for-papers.html">WEIS 2021 Call for Papers</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/ransomware-profitability.html">Ransomware Profitability</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/presidential-cybersecurity-and-pelotons.html">Presidential Cybersecurity and Pelotons</a></li><li><a href="https://www.schneier.com/blog/archives/2021/01/police-have-disrupted-the-emotet-botnet.html">Police Have Disrupted the Emotet Botnet</a></li>
</ul>
</div></section><section><div class="sidesection widget widget_schneier_featured_essays" id="schneier_featured_essays-2"><h3>Featured Essays</h3>
	<ul>
		<li><a href="https://www.schneier.com/essays/archives/2016/04/the_value_of_encrypt.html">The Value of Encryption</a></li><li><a href="https://www.schneier.com/essays/archives/2016/03/data_is_a_toxic_asse.html">Data Is a Toxic Asset, So Why Not Throw It Out?</a></li><li><a href="https://www.schneier.com/essays/archives/2014/01/how_the_nsa_threaten.html">How the NSA Threatens National Security</a></li><li><a href="https://www.schneier.com/essays/archives/2009/01/terrorists_may_use_g.html">Terrorists May Use Google Earth, But Fear Is No Reason to Ban It</a></li><li><a href="https://www.schneier.com/essays/archives/2007/01/in_praise_of_securit.html">In Praise of Security Theater</a></li><li><a href="https://www.schneier.com/essays/archives/2006/08/refuse_to_be_terrori.html">Refuse to be Terrorized</a></li><li><a href="https://www.schneier.com/essays/archives/2006/05/the_eternal_value_of.html">The Eternal Value of Privacy</a></li><li><a href="https://www.schneier.com/essays/archives/2005/09/terrorists_dont_do_m.html">Terrorists Don&#039;t Do Movie Plots</a></li>	</ul>

	<p><a href="https://www.schneier.com/essays/">More Essays</a></p></div></section><section><div class="sidesection widget widget_schneier_archives" id="schneier_archives-2"><h3>Blog Archives</h3>
<ul>

	<li><a href="https://www.schneier.com/blog/calendar.html/">Archive by Month</a></li><li><a href="https://www.schneier.com/blog/newcomments.html/">100 Latest Comments</a></li></ul>

<h4>Blog Tags</h4><ul class="top-tags"><li><a href="https://www.schneier.com/tag/3d-printers/">3d printers</a></li><li><a href="https://www.schneier.com/tag/9-11/">9/11</a></li><li><a href="https://www.schneier.com/tag/aaron-swartz/">Aaron Swartz</a></li><li><a href="https://www.schneier.com/tag/academic/">academic</a></li><li><a href="https://www.schneier.com/tag/academic-papers/">academic papers</a></li><li><a href="https://www.schneier.com/tag/accountability/">accountability</a></li><li><a href="https://www.schneier.com/tag/aclu/">ACLU</a></li><li><a href="https://www.schneier.com/tag/activism/">activism</a></li><li><a href="https://www.schneier.com/tag/adobe/">Adobe</a></li><li><a href="https://www.schneier.com/tag/advanced-persistent-threats/">advanced persistent threats</a></li><li><a href="https://www.schneier.com/tag/adware/">adware</a></li><li><a href="https://www.schneier.com/tag/aes/">AES</a></li><li><a href="https://www.schneier.com/tag/afghanistan/">Afghanistan</a></li><li><a href="https://www.schneier.com/tag/air-marshals/">air marshals</a></li><li><a href="https://www.schneier.com/tag/air-travel/">air travel</a></li><li><a href="https://www.schneier.com/tag/airgaps/">airgaps</a></li><li><a href="https://www.schneier.com/tag/al-qaeda/">al Qaeda</a></li><li><a href="https://www.schneier.com/tag/alarms/">alarms</a></li><li><a href="https://www.schneier.com/tag/algorithms/">algorithms</a></li><li><a href="https://www.schneier.com/tag/alibis/">alibis</a></li><li><a href="https://www.schneier.com/tag/amazon/">Amazon</a></li><li><a href="https://www.schneier.com/tag/android/">Android</a></li><li><a href="https://www.schneier.com/tag/anonymity/">anonymity</a></li><li><a href="https://www.schneier.com/tag/anonymous/">Anonymous</a></li><li><a href="https://www.schneier.com/tag/antivirus/">antivirus</a></li><li><a href="https://www.schneier.com/tag/apache/">Apache</a></li><li><a href="https://www.schneier.com/tag/apple/">Apple</a></li><li><a href="https://www.schneier.com/tag/applied-cryptography/">Applied Cryptography</a></li><li><a href="https://www.schneier.com/tag/artificial-intelligence/">artificial intelligence</a></li><li><a href="https://www.schneier.com/tag/assassinations/">assassinations</a></li></ul><p><a href="https://www.schneier.com/blog/tags.html/">More Tags</a></p></div></section><section><div class="sidesection widget widget_schneier_latest_book" id="schneier_latest_book-3"><h3>Latest Book</h3><a href="https://www.schneier.com/books/click-here/"><img class="sidepic" alt="Click Here to Kill Everybody" src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2018/07/book-ch2-200w.png" /></a><p><a href="https://www.schneier.com/books/">More Books</a></p></div></section><section><div class="sidesection widget widget_schneier_promotion" id="schneier_promotion-2">
<a href="https://www.eff.org/issues/bloggers/legal/join">
	<img src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/join-eff@2x.png" id="effbutton" alt="Support Bloggers' Rights!" title="Support Bloggers' Rights!" /></a>

<a href="https://npo.networkforgood.org/Donate/Donate.aspx?npoSubscriptionId=8252">
	<img src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/support-epic@2x.png" alt="Defend Privacy--Support Epic" title="Defend Privacy--Support Epic" /></a>
</div></section>	</div>
</aside>

		<footer>
			<nav>
				<div class="nav" id="footer-nav">
					<div class="menu-main-menu-container"><ul id="menu-main-menu-1" class="menu"><li class="menu1 menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-50175 current-menu-item"><a href="https://www.schneier.com">Blog</a></li>
<li class="menu2 menu-item menu-item-type-post_type menu-item-object-page menu-item-50916"><a href="https://www.schneier.com/crypto-gram/">Newsletter</a></li>
<li class="menu3 menu-item menu-item-type-post_type menu-item-object-page menu-item-50166"><a href="https://www.schneier.com/books/">Books</a></li>
<li class="menu4 menu-item menu-item-type-custom menu-item-object-custom menu-item-50169"><a href="https://www.schneier.com/essays/">Essays</a></li>
<li class="menu5 menu-item menu-item-type-custom menu-item-object-custom menu-item-50170"><a href="https://www.schneier.com/news/">News</a></li>
<li class="menu6 menu-item menu-item-type-custom menu-item-object-custom menu-item-50171"><a href="https://www.schneier.com/talks/">Talks</a></li>
<li class="menu7 menu-item menu-item-type-post_type menu-item-object-page menu-item-50167"><a href="https://www.schneier.com/academic/">Academic</a></li>
<li class="menu8 menu-item menu-item-type-post_type menu-item-object-page menu-item-50174"><a href="https://www.schneier.com/blog/about/">About Me</a></li>
</ul></div>				</div>
			</nav>
		</footer>

		</div><!--#main-->
	</div><!--#wrapper-->

		<script type="text/javascript">
		(function () {
			var c = document.body.className;
			c = c.replace(/woocommerce-no-js/, 'woocommerce-js');
			document.body.className = c;
		})();
	</script>
	<script type='text/javascript' src='https://c0.wp.com/p/woocommerce/5.1.0/assets/js/jquery-cookie/jquery.cookie.min.js' id='jquery-cookie-js'></script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/vendor/socialshareprivacy/js/socialshareprivacy.js?ver=1.0.1' id='social-share-privacy-js'></script>
<script type='text/javascript' id='social-share-privacy-icons-js-extra'>
/* <![CDATA[ */
var schneierSocial = {"path":"https:\/\/www.schneier.com\/wp-content\/themes\/schneier\/assets\/vendor\/socialshareprivacy\/"};
/* ]]> */
</script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/vendor/socialshareprivacy/js/icons.js?ver=1.0.0' id='social-share-privacy-icons-js'></script>
<script type='text/javascript' id='schneier-comment-js-extra'>
/* <![CDATA[ */
var schneierComment = {"translateErrorSecurityAnswerWrong":"Your response to the challenge question ('The name of this blog is Schneier on ____') was not correct. Please try again.","ajax_url":"https:\/\/www.schneier.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/js/comment.js?ver=1.0.1' id='schneier-comment-js'></script>
<script type='text/javascript' src='https://c0.wp.com/c/5.7/wp-includes/js/wp-embed.min.js' id='wp-embed-js'></script>

</body>

</html>
