<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="https://news.sophos.com/xmlrpc.php">
<link rel="alternate" hreflang="en-us" href="https://news.sophos.com/en-us/2020/02/25/cloud-snooper-attack-bypasses-firewall-security-measures/" /><!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl+ '&gtm_auth=d5XceCG5H_eblswmMfURjQ&gtm_preview=env-2&gtm_cookies_win=x';f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5L6H3LN');</script>
<!-- End Google Tag Manager -->
<title>&#8216;Cloud Snooper&#8217; Attack Bypasses Firewall Security Measures &#8211; Sophos News</title>
<meta name='robots' content='max-image-preview:large' />
<!-- Jetpack Site Verification Tags -->
<meta name="google-site-verification" content="8r1qg681OjOolfxmHEY1IYupmTBdyKXc-OPfpgeQHFk" />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel='dns-prefetch' href='//v0.wordpress.com' />
<link rel="alternate" type="application/rss+xml" title="Sophos News &raquo; Feed" href="https://news.sophos.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sophos News &raquo; Comments Feed" href="https://news.sophos.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sophos News &raquo; &#8216;Cloud Snooper&#8217; Attack Bypasses Firewall Security Measures Comments Feed" href="https://news.sophos.com/en-us/2020/02/25/cloud-snooper-attack-bypasses-firewall-security-measures/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/news.sophos.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.7"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='all-css-0' href='https://news.sophos.com/_static/??/wp-includes/css/dist/block-library/style.min.css,/wp-content/themes/sophosnews-2017/style.css,/wp-content/mu-plugins/jetpack-9.5/css/jetpack.css?m=1615321555' type='text/css' media='all' />
<style id='wp-block-library-inline-css'>
.has-text-align-justify{text-align:justify;}
</style>
<script type='text/javascript' src='https://news.sophos.com/_static/??-eJzTLy/QzcxLzilNSS3WzwKiwtLUokoopZebmaeXVayjj0+Rbm5melFiSSpUsX2uraGZoamxkaGpqWkWAK9EIho='></script>
<link rel="https://api.w.org/" href="https://news.sophos.com/wp-json/" /><link rel="alternate" type="application/json" href="https://news.sophos.com/wp-json/wp/v2/posts/62091" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://news.sophos.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://news.sophos.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.7" />
<link rel="canonical" href="https://news.sophos.com/en-us/2020/02/25/cloud-snooper-attack-bypasses-firewall-security-measures/" />
<link rel='shortlink' href='https://news.sophos.com/?p=62091' />
<link rel="alternate" type="application/json+oembed" href="https://news.sophos.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fnews.sophos.com%2Fen-us%2F2020%2F02%2F25%2Fcloud-snooper-attack-bypasses-firewall-security-measures%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://news.sophos.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fnews.sophos.com%2Fen-us%2F2020%2F02%2F25%2Fcloud-snooper-attack-bypasses-firewall-security-measures%2F&#038;format=xml" />
<style type='text/css'>img#wpstats{display:none}</style><link rel="amphtml" href="https://news.sophos.com/en-us/2020/02/25/cloud-snooper-attack-bypasses-firewall-security-measures/amp/">
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="&#8216;Cloud Snooper&#8217; Attack Bypasses Firewall Security Measures" />
<meta property="og:url" content="https://news.sophos.com/en-us/2020/02/25/cloud-snooper-attack-bypasses-firewall-security-measures/" />
<meta property="og:description" content="In the course of investigating a malware infection of cloud infrastructure servers hosted in the Amazon Web Services (AWS) cloud, SophosLabs discovered a sophisticated attack that employed a unique…" />
<meta property="article:published_time" content="2020-02-25T13:30:43+00:00" />
<meta property="article:modified_time" content="2020-04-14T11:25:49+00:00" />
<meta property="og:site_name" content="Sophos News" />
<meta property="og:image" content="https://news.sophos.com/wp-content/uploads/2020/02/snoopy_x4_labels-1.png" />
<meta property="og:image:width" content="4096" />
<meta property="og:image:height" content="2764" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:text:title" content="&#8216;Cloud Snooper&#8217; Attack Bypasses Firewall Security Measures" />
<meta name="twitter:image" content="https://news.sophos.com/wp-content/uploads/2020/02/snoopy_x4_labels-1.png?w=640" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="fb:admins" content="28552295016" />

<!-- End Jetpack Open Graph Tags -->
<link rel="icon" href="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=32" sizes="32x32" />
<link rel="icon" href="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=192" sizes="192x192" />
<link rel="apple-touch-icon" href="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=180" />
<meta name="msapplication-TileImage" content="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=270" />
</head>

<body class="post-template-default single single-post postid-62091 single-format-standard group-blog">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5L6H3LN&gtm_auth=d5XceCG5H_eblswmMfURjQ&gtm_preview=env-2&gtm_cookies_win=x"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<div id="page" class="hfeed site">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

	<header id="masthead" class="site-header">

		<div class="header-container">

			<div class="site-branding">
				<h1 class="site-title">
										<a class="site-logo" href="https://www.sophos.com/en-us.aspx" rel="home">
						Sophos News					</a>
				</h1>
			</div> <!-- site-branding -->

			<nav class="primary-header-navigation" role="navigation">
				<ul id="menu-en-us-primary" class="menu"><li id="menu-item-33368" class="has-icons menu-item menu-item-type-custom menu-item-object-custom menu-item-33368"><a href="https://www.sophos.com/en-us/products.aspx">Products<div class="menu-item-description"></div></a></li>
<li id="menu-item-33382" class="has-icons menu-item menu-item-type-custom menu-item-object-custom menu-item-33382"><a href="https://www.sophos.com/en-us/solutions.aspx">Solutions<div class="menu-item-description"></div></a></li>
<li id="menu-item-33390" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33390"><a href="//www.sophos.com/en-us/partners.aspx">Partners<div class="menu-item-description"></div></a></li>
<li id="menu-item-33391" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33391"><a href="//www.sophos.com/en-us/support.aspx">Support<div class="menu-item-description"></div></a></li>
<li id="menu-item-33392" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33392"><a href="//www.sophos.com/en-us/company.aspx">Company<div class="menu-item-description"></div></a></li>
<li id="menu-item-33393" class="is-icon icon-download menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-33393"><a href="#">Downloads<div class="menu-item-description"></div></a>
<ul class="sub-menu">
	<li id="menu-item-33394" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33394"><a href="//www.sophos.com/en-us/products/free-trials.aspx">Free Trials<div class="menu-item-description">All product trials in one place.</div></a></li>
	<li id="menu-item-33395" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33395"><a href="//www.sophos.com/en-us/products/free-tools.aspx">Free Tools<div class="menu-item-description">Try our tools for use at home.</div></a></li>
	<li id="menu-item-33396" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33396"><a href="//www.sophos.com/en-us/products/request-a-quote.aspx">Get Pricing<div class="menu-item-description">The right price every time.</div></a></li>
</ul>
</li>
<li id="menu-item-33397" class="is-icon icon-search menu-item menu-item-type-custom menu-item-object-custom menu-item-33397"><a href="//www.sophos.com/en-us/search-results.aspx">Search<div class="menu-item-description"></div></a></li>
<li id="menu-item-33398" class="is-icon icon-account menu-item menu-item-type-custom menu-item-object-custom menu-item-33398"><a href="//www.sophos.com/en-us/login.aspx">Sign In<div class="menu-item-description"></div></a></li>
</ul>			</nav>

		</div>
	</header> <!-- site-header -->

	<div class="secondary-header">
		<div class="secondary-header-container container">
			<nav class="secondary-header-navigation" role="navigation">
				<ul id="menu-en-us-secondary" class="menu"><li id="menu-item-33399" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33399"><a href="//www.sophos.com/en-us/company.aspx">Overview</a></li>
<li id="menu-item-33401" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33401"><a href="//www.sophos.com/en-us/company/press.aspx">Press</a></li>
<li id="menu-item-33402" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33402"><a href="//secure2.sophos.com/en-us/company/events.aspx">Events</a></li>
<li id="menu-item-33403" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33403"><a href="//www.sophos.com/en-us/company/community.aspx">Community</a></li>
<li id="menu-item-33404" class="menu-item-blog menu-item menu-item-type-custom menu-item-object-custom menu-item-33404"><a href="/">Blog</a></li>
<li id="menu-item-33405" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33405"><a href="//secure2.sophos.com/en-us/company/careers.aspx">Careers</a></li>
<li id="menu-item-33406" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33406"><a href="//www.sophos.com/en-us/company/contact.aspx">Contact</a></li>
</ul>			</nav>
		</div>
	</div> <!-- secondary-header -->

	<div class="news-header">
		<div class="news-header-container container">

			<div class="news-branding">
				<h1 class="news-title">
					<a class="news-logo" href="https://news.sophos.com/en-us/" rel="home">
						Sophos News					</a>
				</h1>
			</div> <!-- news-branding -->

			<div class="mobile-menu-toggle">
				<a href="#newsmenu">
											Menu									</a>
			</div>

			<div class="mobile-search-toggle">
				<a class="icon icon-search-secondary" href="#search">
					Search				</a>
			</div>

			<nav class="news-header-navigation" role="navigation">
				<ul id="menu-en-us-tertiary" class="menu"><li id="menu-item-33407" class="is-icon icon-search menu-item menu-item-type-custom menu-item-object-custom menu-item-33407"><a href="#search">Search</a></li>
</ul>			</nav>

			<div class="site-search-block" style="display: none;">
				<form role="search" class="search-form" method="get" action="https://news.sophos.com/en-us/">
					<fieldset>
						<div class="field">
							<input type="text" value="" name="s" class="search-field" placeholder="Search">
						</div>
						<div class="submit">
							<button type="submit" class="search-submit icon icon-search-secondary">
								Go							</button>
						</div>
					</fieldset>
				</form>
				<a class="icon" href="#search-close">
					Close				</a>
			</div>
		</div>
	</div> <!-- news-header -->

	<div id="content" class="site-content">
		<div class="content-container">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			
<article id="post-62091" class="post-62091 post type-post status-publish format-standard hentry category-sophoslabs-uncut region-en-us">

	<header class="entry-header">

		<h1 class="entry-title">&#8216;Cloud Snooper&#8217; Attack Bypasses Firewall Security Measures</h1>
		<div class="entry-categories">
			<a href="https://news.sophos.com/en-us/category/sophoslabs/sophoslabs-uncut/">SophosLabs Uncut</a>		</div>

		
		<div class="entry-meta">
			<span class="posted-on"><a href="https://news.sophos.com/en-us/2020/02/25/cloud-snooper-attack-bypasses-firewall-security-measures/" rel="bookmark">25 February 2020</a></span>		</div><!-- .entry-meta -->

		<div class="entry-social">
			
	<ul class="social-sharing" id="social-sharing">
		<li class="comments">
			<a href="#comments" title="Leave a Reply">
				6			</a>
		</li>
		<li class="twitter"><a class="js-share-modal" href="http://twitter.com/intent/tweet?text=%26%238216%3BCloud%20Snooper%26%238217%3B%20Attack%20Bypasses%20Firewall%20Security%20Measures%20https%3A%2F%2Fnews.sophos.com%2F%3Fp%3D62091" data-title="" title="Share on Twitter">Share on Twitter</a></li>
		<li class="facebook"><a class="js-share-modal" href="http://www.facebook.com/share.php?u=https://news.sophos.com/?p=62091&#038;title=&#8216;Cloud%20Snooper&#8217;%20Attack%20Bypasses%20Firewall%20Security%20Measures" data-title="&#8216;Cloud Snooper&#8217; Attack Bypasses Firewall Security Measures" title="Share on Facebook">Share on Facebook</a></li>
		<li class="linkedin">
			<a
				href="http://www.linkedin.com/shareArticle?mini=true&url=https://news.sophos.com/en-us/2020/02/25/cloud-snooper-attack-bypasses-firewall-security-measures/"
				data-title="&#8216;Cloud Snooper&#8217; Attack Bypasses Firewall Security Measures"
				title="Share on LinkedIn"
				onclick="window.open(this.href, '', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
			>
				Share on LinkedIn			</a>
		</li>
	</ul>

			</div><!-- .entry-social -->
	</header><!-- .entry-header -->

	
	<div class="entry-meta">
		<span class="byline">By <span class="author vcard"><a href="https://news.sophos.com/en-us/author/sergei-shevchenko/" title="Posts by Sergei Shevchenko" class="author url fn" rel="author">Sergei Shevchenko</a></span><span class="author vcard"><a href="https://news.sophos.com/en-us/author/timothy-easton/" title="Posts by Timothy Easton" class="author url fn" rel="author">Timothy Easton</a></span></span>	</div><!-- .entry-meta -->

	<div class="entry-content">
		<p>In the course of investigating a malware infection of cloud infrastructure servers hosted in the Amazon Web Services (AWS) cloud, SophosLabs discovered a sophisticated attack that employed a unique combination of techniques to evade detection and that permits the malware to communicate freely with its command and control (C2) servers through a firewall that should, under normal circumstances, prevent precisely that kind of communication from reaching the infected server.</p>
<p>We have published <a href="https://www.sophos.com/en-us/medialibrary/PDFs/technical-papers/sophoslabs-cloud-snooper-report.pdf" target="_blank" rel="noopener noreferrer">an in-depth report on the attack</a>, which we have named <strong>Cloud Snooper</strong>.</p>
<p>Though we discovered the technique in use on AWS, the problem is not an AWS problem per se. It represents a method of piggybacking C2 traffic on a legitimate traffic, such as normal web traffic, in a way that can bypass many, if not most, firewalls.</p>
<p>The complexity of the attack and the use of a bespoke APT (Advanced Persistent Threat) toolset gives us reason to believe that the malware and its operators were an advanced threat actor, possibly nation-state sponsored.</p>
<p>The compromised systems were running both Linux and Windows EC2 instances.</p>
<h2>Anomalous traffic raises alerts</h2>
<p>As often happens with incidents like this, our investigation started when someone noticed an anomaly. While the AWS security groups (SGs) were properly tuned, set up only to allow inbound HTTP or HTTPS traffic, the compromised Linux system was still listening for inbound connections on ports 2080/TCP and 2053/TCP.</p>
<p>An analysis of this system revealed the presence of a rootkit that granted the malware&#8217;s operators the ability to remotely control the server through the AWS SGs. But this rootkit&#8217;s capabilities are not limited to doing this in the Amazon cloud: It also could be used to communicate with, and remotely control, malware on any server behind any boundary firewall, even an on-premises server.</p>
<p>By unwinding other elements of this attack, we further identified other Linux hosts, infected with the same or a similar rootkit.</p>
<p>Finally, we identified a compromised Windows system with a backdoor that communicated with a similar C2 as other compromised Linux hosts, using a very similar configuration format. The backdoor is apparently based on source code of the infamous Gh0st RAT malware.</p>
<p>At this point in the investigation, we still have some open questions. For example, it is still unclear how the attackers managed to compromise the client&#8217;s system in the first place. One of the working theories is that the attackers broke into a server through SSH, protected with password authentication.</p>
<h2>High-level illustration</h2>
<p>Before we start our technical description, let us provide a high-level view of the Cloud Snooper attack. Doing so might help the reader to get an overall idea of how its elements are related to each other.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2020/02/snoopy.png"><img loading="lazy" class="alignnone wp-image-64514 size-large" style="border: 1px solid #777;" src="https://news.sophos.com/wp-content/uploads/2020/02/snoopy_x4_labels-1.png?w=640" alt="" width="640" height="432" srcset="https://news.sophos.com/wp-content/uploads/2020/02/snoopy_x4_labels-1.png 4096w, https://news.sophos.com/wp-content/uploads/2020/02/snoopy_x4_labels-1.png?resize=300,202 300w, https://news.sophos.com/wp-content/uploads/2020/02/snoopy_x4_labels-1.png?resize=768,518 768w, https://news.sophos.com/wp-content/uploads/2020/02/snoopy_x4_labels-1.png?resize=1024,691 1024w, https://news.sophos.com/wp-content/uploads/2020/02/snoopy_x4_labels-1.png?resize=1536,1037 1536w, https://news.sophos.com/wp-content/uploads/2020/02/snoopy_x4_labels-1.png?resize=2048,1382 2048w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>In the illustration above, our castle represents the targeted server infrastructure; In the case of the incident we investigated, the server was hosted by Amazon Web Services (AWS). At its perimeter, the <em>AWS Security Groups</em> (SGs) &#8211; a set of firewall rules that provide security at the protocol and port access level – limit the inbound network traffic.</p>
<p>For example, you might typically set up an AWS Security Group that only allows web traffic – that is, TCP packets that arrive at ports 80 or 443 – to reach your server. Network traffic with any other destination port never makes it past the SGs.</p>
<p>The infection involves a rootkit that inspects network traffic, and a backdoor that the attackers leverage the rootkit to send commands to, and receive data from, the backdoor.</p>
<p>In order to get around the firewall rules, depicted here as guards, the attackers communicate with the rootkit by sending innocent-looking requests (depicted in the illustration as a wolf in sheep&#8217;s clothing) to the web server on the normal web server ports. A listener that inspects inbound traffic before it reaches the web server intercepts the specially-crafted requests, and sends instructions to the malware based on characteristics of those requests.</p>
<p>The listener sends a &#8220;reconstructed&#8221; C2 command to the backdoor Trojan installed by the rootkit. Depending on the commands included into C2 traffic, the attacker may use the backdoor to steal sensitive data from the target.</p>
<p>The collected data is then delivered back with the C2 traffic. Only this time, the rootkit has to masquerade it again in order to bypass the guards: the wolf dresses itself in sheep&#8217;s clothing once again. Once outside, the C2 traffic delivers the collected data back to the attackers.</p>
<p>During an entire operation, the normal web traffic, depicted as sheep, keeps flowing to and from the web server through the allowed gate. Visually, the C2 traffic stays largely indistinguishable from the legitimate web traffic.</p>
<h2>Dismantling the Cloud Snooper tools</h2>
<p>As you will see from the description below, some samples that we collected are directly related to each other, while others belong to a completely different malware family. Nevertheless, all these samples were collected from the same infrastructure, and thus, we consider them part of the same toolset.</p>
<p>The description starts with the Linux malware, then progresses into its Windows counterpart that is apparently based on Gh0st RAT.</p>
<p>Overall, we discovered and studied 10 samples in the course of the investigation, which can be broken down as:</p>
<table>
<tbody>
<tr style="background-color: #656565; color: #ffffff;">
<th>#</th>
<th>MD5</th>
<th>Name</th>
<th>Filesize</th>
<th>Platform</th>
</tr>
<tr style="background-color: #efefef; font-style: italic;">
<td colspan="5">Linux Malware, Group 1</td>
</tr>
<tr>
<td>1</td>
<td>a3f1e4b337ba1ed35cac3fab75cec369</td>
<td>snd_floppy</td>
<td>738,368</td>
<td>ELF64, x86-64</td>
</tr>
<tr>
<td>2</td>
<td>6a1d21d3fd074520cb6a1fda76d163da</td>
<td>snd_floppy</td>
<td>738,368</td>
<td>ELF64, x86-64</td>
</tr>
<tr>
<td>3</td>
<td>c7a3fefb3c231ad3b683f00edd0e26e4</td>
<td>snoopy</td>
<td>305,309</td>
<td>ELF64, x86-64</td>
</tr>
<tr>
<td>4</td>
<td>9cd93bb2a12cf4ef49ee1ba5bb0e4a95</td>
<td>snd_floppy</td>
<td>544,832</td>
<td>ELF64, x86-64</td>
</tr>
<tr>
<td>5</td>
<td>15e96f0ee3abc9d5d2395c99aabc3b92</td>
<td>vsftpd</td>
<td>60,456</td>
<td>ELF64, x86-64</td>
</tr>
<tr>
<td>6</td>
<td>2b7d54251068a668c4fe8f988bfc3ab5</td>
<td>ips</td>
<td>35,580</td>
<td>ELF32, x86</td>
</tr>
<tr style="background-color: #efefef; font-style: italic;">
<td colspan="5">Linux Malware, Group 2 – Gh0st RAT</td>
</tr>
<tr>
<td>7</td>
<td>ecac141c99e8cef83389203b862b24fd</td>
<td>snort</td>
<td>64,412</td>
<td>ELF32, x86</td>
</tr>
<tr>
<td>8</td>
<td>67c8235ac0861c8622ac2ddb1f5c4a18</td>
<td>javad</td>
<td>64,412</td>
<td>ELF32, x86</td>
</tr>
<tr>
<td>9</td>
<td>850bf958f07e6c33a496b39be18752f3</td>
<td>nood.bin</td>
<td>66,000</td>
<td>ELF32, x86</td>
</tr>
<tr style="background-color: #efefef; font-style: italic;">
<td colspan="5">Windows Malware – Gh0st RAT</td>
</tr>
<tr>
<td>10</td>
<td>a59c83285679296758bf8589277abde7</td>
<td>NSIProvider.dll</td>
<td>219,648</td>
<td>PE32, x86</td>
</tr>
<tr>
<td>11</td>
<td>76380fea8fb56d3bb3c329f193883edf</td>
<td>NSIProvider.dll.crt</td>
<td>516,097</td>
<td>[encrypted]</td>
</tr>
</tbody>
</table>
<h2>The Cloud Snooper communications handler</h2>
<p>The central piece of the attack is a file named <code>snd_floppy</code> – a kernel module that sets up a network packet filter, using a Netfilter hook (<code>NF_INET_LOCAL_IN</code> and <code>NF_INET_LOCAL_OUT</code>).</p>
<p>This component was instrumental in giving the malware&#8217;s operators the ability to communicate with the malware, despite the firewall protecting the AWS EC2 servers.</p>
<p>The <code>NF_INET_LOCAL_IN</code> is a type of hook that is triggered before the packet reaches the destination port.</p>
<p>The installed hook handler inspects the socket buffer of every IPv4 packet, looking for a command concealed within a header – the command being the source port number of the packet originating from the attacker&#8217;s machine. These commands/source ports can be one of the following port numbers: <code>1010</code>, <code>2020</code>, <code>6060</code>, <code>7070</code>, <code>8080</code>, <code>9999</code>.</p>
<p>Firewalls typically prevent machines behind the firewall from receiving traffic sent to arbitrary <em>destination</em> ports, but they don&#8217;t pay attention to the <em>source</em> ports, because source ports are normally ephemeral, and not relevant to the server or the services it is hosting.</p>
<p>In a typical cloud instance, the server may be set up to receive traffic from any IP address on port 80/TCP (for HTTP) and on 443/TCP (for HTTPS), so the firewall will let any traffic to those ports through to the server. So long as the traffic coming in to one of these standard ports fits the pattern the communications handler is looking for, it will execute one of its built-in instructions. Anything else will be ignored, and the server will serve web pages as normal to browsers.</p>
<p>For example, if the communications handler receives a TCP SYN packet with an origin port of <code>6060</code>, the malware will decrypt an embedded file that has been encrypted with RC4 (the key is <em>&#8216;YaHo0@&#8217;</em>).</p>
<p>It will then drop that decrypted file as <code>/tmp/snoopy</code>, wait for half a second, and then execute it as a usermode application with the <em>call_usermodehelper()</em> syscall. Immediately after that, it deletes the <code>/tmp/snoopy</code> file, so the snoopy application remains running in memory with no physical file present.</p>
<p>If the command is <code>9999</code> as a TCP SYN packet, the <code>/tmp/snoopy</code> process self-terminates (in case <code>killall</code> is supported by OS), by passing the following commands to <em>call_usermodehelper()</em> syscall.</p>
<pre style="background-color: #fff;">/bin/sh -c /tmp/snoopy
rm -rf /tmp/snoopy
killall /tmp/snoopy
</pre>
<p>NOTE: executing <code>snoopy</code> again while it’s already running has no effect; by using a file lock mechanism, <code>snoopy</code> makes sure only one instance is running. If that happens, it will output:</p>
<pre style="background-color: #fff;">[ERROR] there is already a instance.
</pre>
<p>Here is the logic of the <code>NF_INET_LOCAL_IN</code> hook handler, which listens for SYN packets sent to the server, using the various source ports:</p>
<pre style="margin: 0; line-height: 125%; background-color: #fff;"><span style="color: #0000ff;">if</span> tcp:
    <span style="color: #0000ff;">if</span> tcp.src_port == 6060:
        <span style="color: #0000ff;">if</span> tcp.flags == SYN:
            drop_payload()        <span style="color: #008000;"># drops/runs snoopy</span>
            <span style="color: #0000ff;">return</span> NF_STOP
    <span style="color: #0000ff;">elif</span> tcp.src_port == 7070:
        tcp.dst_port = 2080
        adjust_tcp_checksum()
        <span style="color: #0000ff;">return</span> NF_STOP
    <span style="color: #0000ff;">elif</span> tcp.src_port == 9999:
        <span style="color: #0000ff;">if</span> tcp.flags == SYN:
            kill_payload()        <span style="color: #008000;"># kills snoopy process</span>
            <span style="color: #0000ff;">return</span> NF_STOP
    <span style="color: #0000ff;">elif</span> tcp.src_port == 2020:
        <span style="color: #0000ff;">return</span> NF_STOP
    <span style="color: #0000ff;">elif</span> tcp.src_port == 1010:
        tcp.dst_port = 22
        adjust_tcp_checksum()
        <span style="color: #0000ff;">return</span> NF_STOP
    <span style="color: #0000ff;">else</span>:
        <span style="color: #0000ff;">return</span> NF_ACCEPT
<span style="color: #0000ff;">elif</span> udp:
    <span style="color: #0000ff;">if</span> udp.src_port == 8080:
        udp.dst_port = 2053
        adjust_udp_checksum()
        <span style="color: #0000ff;">return</span> NF_STOP
<span style="color: #0000ff;">else</span>:
    <span style="color: #0000ff;">return</span> NF_ACCEPT
</pre>
<p>And here is the logic of the <code>NF_INET_LOCAL_OUT</code> hook handler:</p>
<pre style="margin: 0; line-height: 125%; background-color: #fff;"><span style="color: #0000ff;">if</span> tcp:
    <span style="color: #0000ff;">if</span> tcp.dst_port == 7070:
        tcp.src_port = 443        <span style="color: #008000;"># or, 80 in another variant</span>
        adjust_udp_checksum()
        <span style="color: #0000ff;">return</span> NF_STOP
    <span style="color: #0000ff;">if</span> tcp.dst_port == 2020:
        <span style="color: #0000ff;">return</span> NF_STOP
    <span style="color: #0000ff;">if</span> tcp.dst_port == 1010:
        tcp.src_port = 443        <span style="color: #008000;"># or, 80 in another variant</span>
        adjust_udp_checksum()
        <span style="color: #0000ff;">return</span> NF_STOP
    <span style="color: #0000ff;">else</span>:
        <span style="color: #0000ff;">return</span> NF_ACCEPT
<span style="color: #0000ff;">elif</span> upd:
    <span style="color: #0000ff;">if</span> udp.dst_port == 8080:
        udp.src_port = 53
        <span style="color: #0000ff;">return</span> NF_STOP
<span style="color: #0000ff;">else</span>:
    <span style="color: #0000ff;">return</span> NF_ACCEPT
</pre>
<h2>Explanation</h2>
<p>To trigger the payload (<code>snoopy</code>) activation, an attacker would send the following packet:</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2020/01/sophos-cloud-snooper-diagram1.png"><img loading="lazy" class="alignnone wp-image-64509" style="border: 1px solid #c9c9c9;" src="https://news.sophos.com/wp-content/uploads/2020/02/diagram1_new.png" alt="" width="640" height="238" srcset="https://news.sophos.com/wp-content/uploads/2020/02/diagram1_new.png 1301w, https://news.sophos.com/wp-content/uploads/2020/02/diagram1_new.png?resize=300,111 300w, https://news.sophos.com/wp-content/uploads/2020/02/diagram1_new.png?resize=768,285 768w, https://news.sophos.com/wp-content/uploads/2020/02/diagram1_new.png?resize=1024,380 1024w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>Next, the <code>snoopy</code> module would be accessed by the C2, using source port 7070 for TCP-based or 8080 for UDP-based control:</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2020/01/sophos-cloud-snooper-diagram2.png"><img loading="lazy" class="alignnone wp-image-64511 size-large" style="border: 1px solid #c9c9c9;" src="https://news.sophos.com/wp-content/uploads/2020/02/diagram2_new.png?w=640" alt="" width="640" height="204" srcset="https://news.sophos.com/wp-content/uploads/2020/02/diagram2_new.png 1950w, https://news.sophos.com/wp-content/uploads/2020/02/diagram2_new.png?resize=300,96 300w, https://news.sophos.com/wp-content/uploads/2020/02/diagram2_new.png?resize=768,245 768w, https://news.sophos.com/wp-content/uploads/2020/02/diagram2_new.png?resize=1024,327 1024w, https://news.sophos.com/wp-content/uploads/2020/02/diagram2_new.png?resize=1536,491 1536w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>On the way back, the <code>NF_INET_LOCAL_OUT</code> hook handler rebuilds the packet again, to make sure its source port is restored back to the original port where the incoming packet was destined for. This way, the C2 traffic transparently flows through the port(s) allowed by AWS SGs:</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2020/01/sophos-cloud-snooper-diagram3.png"><img loading="lazy" class="alignnone wp-image-64512 size-large" style="border: 1px solid #c9c9c9;" src="https://news.sophos.com/wp-content/uploads/2020/02/diagram3_new.png?w=640" alt="" width="640" height="212" srcset="https://news.sophos.com/wp-content/uploads/2020/02/diagram3_new.png 1794w, https://news.sophos.com/wp-content/uploads/2020/02/diagram3_new.png?resize=300,99 300w, https://news.sophos.com/wp-content/uploads/2020/02/diagram3_new.png?resize=768,254 768w, https://news.sophos.com/wp-content/uploads/2020/02/diagram3_new.png?resize=1024,338 1024w, https://news.sophos.com/wp-content/uploads/2020/02/diagram3_new.png?resize=1536,508 1536w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>No other Netfilter hooks within the chain, such as iptables INPUT/OUTPUT rules, will process the packet if the hook returns <code>NF_STOP</code>. This appears to be the purpose of the TCP command 2020: to bypass other Netfilter hooks.</p>
<p>In instances where the Netfilter receives inbound traffic with a source port of 1010/TCP, it directs the contents to the Secure Shell (SSH) port, 22/TCP. For outbound traffic we have seen two variants using either port 80 or port 443. This will allow for an SSH connection to step around an AWS SG with IP restrictions on traffic to port 22.</p>
<p>Hence, the ultimate purpose of the <code>snd_floppy</code> rootkit is to provide a covert control channel for the <code>snoopy</code> usermode process, running on a compromised host.</p>
<p>Such covert control channels can be established via any port allowed by AWS SGs, be it 80, 443, 22, or any other port.</p>
<p>From the outside, the compromised system will show an unusually large volume of traffic that comes from the remote ports 6060, 7070, 8080, and 9999.</p>
<p>But what is the <code>snoopy</code> module? What does it do?</p>
<h2>The Snoopy Module</h2>
<p><code>snoopy</code> is a backdoor trojan that can be executed both as a command line tool and as a daemon (though it needs to be launched with the <code>-d</code> flag for that). The backdoor&#8217;s internal version is 3.0.1-2.20170303.</p>
<p>It opens HTTP and/or DNS services on a compromised system, and allows tunneling of the traffic, operating both as a reverse SOCKS5 proxy server, and client.</p>
<p>For example, the incoming control traffic can also be relayed to a different server.</p>
<p>When run with <code>-h</code> option, the tool prints the following syntax:</p>
<pre style="background-color: #fff;">Usage: rrtserver [OPTIONS]
OPTIONS:
	-h
	-d
	-s IPv4[:PORT:{udp|tcp}:{dns|http|none}]
</pre>
<p>Where:</p>
<ul>
<li><code>-h</code> option will print out the usage above</li>
<li><code>-d</code> will run the tool as daemon</li>
<li><code>-s</code> allows to specify a server address to bind the listening socket to, its port number, and what protocol is used for the traffic: either UDP-based DNS or TCP-based HTTP</li>
</ul>
<p>The binary requires root privilege; when run, it calls <code>geteuid()</code> to get the user ID. If it fails, it prints the line below and quits:</p>
<pre style="background-color: #fff;"><em>"Administrator privileges are required."</em>
</pre>
<p>It sets the working directory to <code>/tmp</code>, and obtains a lock for the file <code>/tmp/rrtserver-lock</code>. The lock file is used to make sure there is only one version of the tool running.</p>
<p>The incoming HTTP traffic is accepted on port 2080, and DNS traffic on port 2053.</p>
<p><strong>NOTE</strong>: the port numbers 2080 and 2053 are default ones; the tool can be executed with different port numbers specified as parameters.</p>
<p>Snoopy parses the received DNS/HTTP traffic to extract hidden commands within it &#8211; such commands are called <em>&#8220;rrootkit messages&#8221;</em> and are distinguished by the presence of a magic header or marker.</p>
<p>For example, to find <em>&#8220;rrootkit messages&#8221;</em> in HTTP traffic, Snoopy parses the HTTP request to see if it starts with <code>"GET /* HTTP/1.1\r\ndata:"</code> or <code>"HTTP/1.1 200 OK\r\ndata:"</code>.</p>
<p>Next, the <em>&#8220;rrootkit messages&#8221;</em> would start from a magic header <code>0xE381B7F5</code>. If this header is found, such data is called <em>msg-data</em>.</p>
<p>The received <em>msg-data</em> is then decrypted with RC4, using the quite specific key <em>&#8216;A YARN-based system for parallel processing of large data sets&#8217;</em>.</p>
<p>The tool then initiates several additional components. These components will process the received <em>msg-data</em>.</p>
<p>Depending on a separate magic header within each <em>msg-data</em>, the data will be processed by a different component.</p>
<p>The initiated components are:</p>
<ul>
<li><strong>view-shell</strong> (magic header <code>0xFC72E392</code>): pty (pseudo terminal) that allows remote shell
<ul>
<li>the <code>HISTFILE</code> variable is cleared, to make sure <code>/bin/sh</code> execution leaves no history</li>
<li>the received commands are then executed with <code>/bin/sh</code></li>
</ul>
</li>
<li><strong>view-file</strong> (magic header <code>0xFC72E393</code>): file manager that accepts 3 commands:
<ul>
<li><em>&#8216;get&#8217;</em> &#8211; read files</li>
<li><em>&#8216;put&#8217;</em> &#8211; save file</li>
<li>any other command &#8211; execute file with <em>popen()</em> syscall</li>
</ul>
</li>
<li><strong>view-proxy</strong> (magic header <code>0xFC72E394</code>): proxy server that accepts the following commands:
<ul>
<li><em>&#8216;exit&#8217;</em> or <em>&#8216;quit&#8217;</em> &#8211; quit proxy server</li>
<li><em>&#8216;socks5&#8217;</em> &#8211; starts SOCKS5 proxy server, authentication is provided with user/password passed with the <code>'-u'</code> and <code>'-p'</code> parameters</li>
<li><em>&#8216;rcsocks-cmd: socks is closed.&#8217;</em> &#8211; closes SOCKS proxy</li>
</ul>
<p>The SOCKS5 server is based on <a href="https://github.com/tostercx/ssocks">the open-source sSocks proxy</a> implementation.</li>
<li><strong>view-pipe</strong> (magic header <code>0xFC72E398</code>): p2p communicator, that receives commands <em>&#8216;pwd&#8217;</em>, <em>&#8216;exit&#8217;</em>, <em>&#8216;quit&#8217;</em>, <em>&#8216;connect&#8217;</em><br />
On receiving the <em>&#8216;connect&#8217;</em> command, it accepts the same parameters as the command-line tool (server IP, port, protocol) and starts tunneling commands to another peer.<br />
The pipe appears to be used to establish connections to other peers.<br />
The negotiation protocol to other peers includes a message <em>&#8216;rrootkit-negotiation: hello&#8217;</em>.<br />
Once the connection is established, the logged message displays what peers have been connected, and that a new network node is now open:</p>
<ul>
<li><em>&#8220;view-pipe: left[address, port]-&gt;right[address, port].&#8221;</em></li>
<li><em>&#8220;view-pipe: the network node is opened.&#8221; </em></li>
</ul>
</li>
<li><strong>view-myproto</strong> (magic header <code>0xFC72E397</code>): a &#8216;ping&#8217;/&#8217;pong&#8217;; depending on a flag it receives, it either:
<ul>
<li>receives a message <em>&#8220;rrootkit-negotiation: hello&#8221;</em>, then responds back <em>&#8220;rrootkit-negotiation: ok, go on&#8221;</em></li>
<li>checks if the received message was <em>&#8220;rrootkit-negotiation: ok, go on&#8221;</em></li>
</ul>
</li>
<li><strong>loop-notifier</strong> &#8211; creates a pipe, a data channel for inter-process communication (IPC).<br />
The backdoor allows control via IPC pipe as a backup control channel.</li>
</ul>
<h2>Logging</h2>
<p><code>snoopy</code> stores many debug messages in clear text.</p>
<p>However, with the internal level of logging set to 0 (none), no debug messages are ever printed. Hence, these debug messages are only used in the testing phase of the malware.</p>
<p>Some of the debug messages are in Chinese:</p>
<ul>
<li>远程路径太长! &#8211; The remote path is too long!</li>
<li>远程文件不存在! &#8211; The remote file does not exist!</li>
<li>远程内存空间分配失败! &#8211; Remote memory space allocation failed!</li>
<li>远程路径不存在! &#8211; The remote path does not exist!</li>
<li>远程文件已存在! &#8211; The remote file already exists!</li>
<li>连接失败! &#8211; Connection failed!</li>
<li>连接成功! &#8211; Connection succeeded!</li>
<li>参数错误! &#8211; Parameter error!</li>
</ul>
<p>Some messages reveal poor English grammar:</p>
<ul>
<li>view don&#8217;t found</li>
<li>view-shell: data do not belong to SHELL</li>
</ul>
<h2>Building a Client</h2>
<p>By knowing how the C2 protocol works, it is possible to build a client to talk to <code>snoopy</code> either directly, or via <code>snd_floppy</code> rootkit.</p>
<p>What for?</p>
<p>Firstly, the client can ping a host located in the same network to see if it&#8217;s infected or not.</p>
<p>Secondly, if a host is infected, the client can disinfect it remotely by instructing <code>snoopy</code> to execute its disinfection routine (see the <code>rmmod</code> command below – after serving it, the rootkit stopped responding as it was unloaded).</p>
<p>Last but not least, building such a client is cool.</p>
<p>The following screenshot demonstrates the client in action. The <code>snd_floppy</code> rootkit intercepts traffic on port 22, even though it’s destined to the SSH daemon (seen as <code>981/sshd</code> in the snapshot below). Next, it re-routes such traffic internally to the <code>snoopy</code> module.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2019/11/image7.png"><img loading="lazy" class="alignnone size-full wp-image-62270" src="https://news.sophos.com/wp-content/uploads/2019/11/image7.png" alt="" width="640" height="434" srcset="https://news.sophos.com/wp-content/uploads/2019/11/image7.png 1154w, https://news.sophos.com/wp-content/uploads/2019/11/image7.png?resize=300,203 300w, https://news.sophos.com/wp-content/uploads/2019/11/image7.png?resize=768,520 768w, https://news.sophos.com/wp-content/uploads/2019/11/image7.png?resize=1024,694 1024w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>As long as the rootkit is active, the attackers may attempt to smuggle the control traffic through any port allowed by the firewall (the screenshot demonstrates that using ports 21 and 24 makes no difference – these packets are still re-routed by the rootkit to the backdoor).</p>
<h2>Gh0st RAT (the Linux version)</h2>
<p>Apart from those samples, we have also recovered a different Linux backdoor, a backdoor that does not open any ports. Instead, it relies on a C2 polling mechanism.</p>
<p>The analysis of this bot functionality reveals it belongs to <a href="https://en.wikipedia.org/wiki/Gh0st_RAT">Gh0st RAT</a>, only it&#8217;s a version that has been written for Linux.</p>
<p>It is hard to tell if Gh0st always existed as a multi-platform RAT, or whether the attackers developed a Linux-based Gh0st after <a href="https://github.com/sincoder/gh0st">the source code of Gh0st for Windows was leaked online</a>.</p>
<p>At the end of the day, it makes sense to have clients deployed across various platforms, using a unified configuration format and C2 protocol, while having a single server for all those clients.</p>
<p>Still, we will leave the guesswork out of this description, rather focusing on what the recovered samples actually do.</p>
<p><code>/bin/snort</code> is a backdoor that contacts a remote C2 to fetch and execute commands. Its internal config file is encrypted with RC4, using the password: <code>"r0st@#$"</code>:</p>
<pre style="background-color: #fff;">185[.]86[.]151[.]67:443;|1;1;1;1;1;0;0;|10-20;|10
</pre>
<p>the <code>'1;1;1;1;1;0;0;'</code> part of the config are the flags that stand for seven days of the week.</p>
<p>the <code>'10-20;'</code> seem to indicate working hours (10am to 8pm), so current weekday and current hour should match what&#8217;s in config.</p>
<p>If there is no match, the bot falls asleep for just over seven minutes (423.756 seconds), then checks the time again.</p>
<p>In case of a match, it attempts to reach the C2; if it cannot, it retries again in one minute.</p>
<p>Traffic to the C2 is encrypted with double RC4, where a key is randomly generated based on the current time.</p>
<p>The backdoor has six commands:</p>
<ul>
<li>The bot clears environmental variable <code>HISTFILE</code>, to make sure no history is kept for <code>/bin/bash</code> execution; the C2 responds with a string, the bot sets the <code>TERM</code> variable to that string<br />
Next, it receives a command and executes it with <code>/bin/bash</code>, with or without the <code>'-c'</code> switch (allows for executing commands as provided within the quotes)<br />
The output from the executed command is sent back</li>
<li>File manipulations:
<ul style="list-style-type: circle;">
<li>Locate and obtain timestamp for the specified file</li>
<li>Rename specified file</li>
<li>Recursively delete all files in the specified directory</li>
</ul>
</li>
<li>More file manipulations:
<ul style="list-style-type: circle;">
<li>Read the contents of the specified file</li>
<li>Recursive search for files</li>
<li>Write data into a specified file</li>
<li>Create specified directory</li>
</ul>
</li>
<li>The next two commands manipulate file descriptors with <em>fcntl()</em> syscall, and fork child processes</li>
<li>Receive data and save it into a local file <code>/usr/include/sdfwex.h</code></li>
</ul>
<p>It appears that <code>/usr/include/sdfwex.h</code> contains a timestamp (year, month, day, hour, minutes) for when the C2 connection should commence.</p>
<p>If the bot cannot open this file, it tries to open <code>/tmp/.llock</code> &#8211; if that file also cannot be opened, the bot skips the timestamp check, and proceeds with trying to connect to the C2.</p>
<p>Other variations of this sample use different configurations, such as:</p>
<pre style="background-color: #fff;">cloud[.]newsofnp[.]com:443;|1;1;1;1;1;1;1;|00-24;|1
load[.]CollegeSmooch[.]com:82;|1;1;1;1;1;1;1;|00-24;|10
</pre>
<p>For the beacon signal it sends to the C2, it collects basic system configuration into a fingerprint. This info consists of:</p>
<ul>
<li>Hostname and IP address</li>
<li>Platform type, as read from <code>/proc/version</code>, such as <code>'x86_64'</code></li>
<li>Full name of the Linux version, as read from <code>/etc/issue.net</code> and <code>/etc/issue</code>, such as:
<ul style="list-style-type: circle;">
<li><em>&#8216;Red Hat Enterprise Linux Server release 6.10 (Santiago)&#8217;</em></li>
<li><em>&#8216;Ubuntu 16.04.5 LTS&#8217;</em></li>
</ul>
</li>
</ul>
<p>The communications with the C2 are always encrypted using a bespoke algorithm that relies on a time-based random RC4 key with extra encryption layers.</p>
<h2>Windows Malware</h2>
<p><code>NSIProvider.dll</code> is a malicious Windows service DLL, executed under <code>svchost.exe</code>.</p>
<p>The service name is NSIProvider, registered with the description name <em>&#8220;Netword Store Interface Provider&#8221;</em>.</p>
<p><strong>NOTE</strong>: &#8216;Netword&#8217; with &#8216;d&#8217;.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2019/11/image8.png"><img loading="lazy" class="alignnone size-full wp-image-62279" style="border: 1px solid #bbb;" src="https://news.sophos.com/wp-content/uploads/2019/11/image8.png" alt="" width="512" height="205" srcset="https://news.sophos.com/wp-content/uploads/2019/11/image8.png 512w, https://news.sophos.com/wp-content/uploads/2019/11/image8.png?resize=300,120 300w" sizes="(max-width: 512px) 100vw, 512px" /></a></p>
<p>The DLL is heavily obfuscated.</p>
<p>Once started as a service, it conveniently spits out debug messages documenting the operation.</p>
<p>Sysinternal&#8217;s DebugView shows these messages:</p>
<pre style="background-color: #fff;">00000000	0.00000000	[4052] DLL_PROCESS_ATTACH.	
00000001	0.00489140	[4052] Rundll32Entry()	
00000002	0.01733349	[4052] ServerLoadPayload()	
00000003	0.01749189	[4052] Get Module File Name.	
00000004	0.01753826	[4052] Get Payload File Name.	
00000005	0.01757095	[4052] Switch to payload directory.	
00000006	0.01768074	[4052] Read Payload File.	
00000007	0.01811264	[4052] Decrypt Payload Data.	
00000008	0.06122175	[4052] Verify Payload Data.	
00000009	0.06732560	[4052] ServerExecutePayload()	
00000010	0.06740102	[4052] Call Shellcode.‬‬‬
</pre>
<p>Once loaded, the DLL locates the encrypted payload file and loads it into memory.<br />
The steps are:</p>
<ul>
<li>Get current module filename with <em>GetModuleFileName()</em> API, i.e. <code>%PATH%\NSIProvider.dll</code></li>
<li>Concatenate current module filename with <code>‘.crt’</code>, e.g. <code>%PATH%\NSIProvider.dll.crt</code></li>
<li>Allocate memory with <em>VirtualAlloc()</em> and read the entire payload file into memory</li>
<li>Initialise a permutation table that consists of 256 DWORDs<br />
Each value of the permutation table is calculated as:</p>
<pre style="background-color: #fff;">*ptr= ((*ptr &gt;&gt; 1) &amp; 0x54384748 | ~(*ptr &gt;&gt; 1) &amp; 0xABC7B8B7) ^ 0x467F3B97;
...
PERM_TABLE[*index] = *ptr;
</pre>
</li>
<li>Start decryption loop &#8211; in this loop, a key value is subtracted from each byte of the encrypted payload; the key value itself is calculated in each iteration based on the previous key value, current index of the decrypted byte, and the permutation table:
<pre style="background-color: #fff;">ptr = __ptr_index++;
val = PERM_TABLE[((*ptr &amp; 0x67612505 | ~*ptr &amp; 0x989EDAFA) ^ (KEY &amp; 0x67612505 | ~KEY &amp; 0x989EDAFA)) &amp; ((*ptr &amp; 0x67612505 | ~*ptr &amp; 0x989EDAFA) ^ (KEY &amp; 0x67612505 | ~KEY &amp; 0x989EDAFA) ^ 0xFFFFFF00)];
KEY = (val &amp; 0x432AA81D | ~val &amp; 0xBCD557E2) ^ ((KEY &gt;&gt; 8) &amp; 0x432AA81D | ~(KEY &gt;&gt; 8) &amp; 0xBCD557E2);
</pre>
</li>
<li>The decrypted payload reveals a checksum, a number of zero bytes, followed with the initial shellcode itself:<br />
<a href="https://news.sophos.com/wp-content/uploads/2019/11/image9.png"><img loading="lazy" class="alignnone size-full wp-image-62283" style="border: 1px solid #c9c9c9;" src="https://news.sophos.com/wp-content/uploads/2019/11/image9.png" alt="" width="640" height="208" srcset="https://news.sophos.com/wp-content/uploads/2019/11/image9.png 746w, https://news.sophos.com/wp-content/uploads/2019/11/image9.png?resize=300,97 300w" sizes="(max-width: 640px) 100vw, 640px" /></a></li>
</ul>
<p>The decrypted payload blob is copied into a newly allocated memory buffer and the initial shellcode (starts from bytes <code>EB 17 58</code> in the image above) is called.</p>
<p>The initial shellcode will then decrypt the rest of the blob, using an XOR key that starts from <code>0x2B</code>, and then incremented by the index of the decrypted byte, i.e. the XOR key values are: <code>0x2B</code>, <code>0x2C</code>, <code>0x2E</code>, <code>0x31</code>, etc.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2019/11/image10.png"><img loading="lazy" class="alignnone size-full wp-image-62285" style="border: 1px solid #c9c9c9;" src="https://news.sophos.com/wp-content/uploads/2019/11/image10.png" alt="" width="640" height="446" srcset="https://news.sophos.com/wp-content/uploads/2019/11/image10.png 750w, https://news.sophos.com/wp-content/uploads/2019/11/image10.png?resize=300,209 300w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>As the rest of the blob is decrypted, the configuration file is decrypted as well, followed by other parts.</p>
<p>After the initial shellcode has finished the decryption, the fully decrypted blob will consist of:</p>
<ul>
<li>Initial shellcode</li>
<li>Decrypted config:
<pre style="background-color: #fff;">Microsoft.Windows.BNG|‪ssl[.]newsofnp[.]com:443‬;|1;1;1;1;1;1;1;|00-24;|1
</pre>
</li>
<li>Zlib-compressed LIBEAY32.dll (77,871 bytes, 167,936 bytes when decompressed)</li>
<li>Zlib-compressed LIBEAY32.dll (386,876 bytes, 851,968 bytes when decompressed)</li>
<li>Backdoor, implemented in the form of a second-stage shellcode</li>
</ul>
<p>Once it’s decoded, the second-stage shellcode is called – this is the backdoor itself.</p>
<p>When it gets control, it dynamically obtains all APIs it needs by using hard-coded API hashes. To find matching hashes from the API names, the shellcode relies on a a slight modification of the ROR-13 algorithm. The only difference is that it checks if the zero byte is at the end of the loop, thus has an additional ROR for the terminating zero byte.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2019/11/image11.jpeg"><img loading="lazy" class="alignnone size-full wp-image-62287" style="border: 1px solid #c9c9c9;" src="https://news.sophos.com/wp-content/uploads/2019/11/image11.jpeg" alt="" width="465" height="498" srcset="https://news.sophos.com/wp-content/uploads/2019/11/image11.jpeg 465w, https://news.sophos.com/wp-content/uploads/2019/11/image11.jpeg?resize=280,300 280w" sizes="(max-width: 465px) 100vw, 465px" /></a></p>
<p>All the required DLLs are loaded dynamically.</p>
<p>Next, it will decompress and load 2 stubs as DLLs. Both DLLs have the internal name LIBEAY32.dll.</p>
<p>Both DLLs rely on an older (2004) build of the libeay32.dll – below are some strings found in the body of these DLLs:</p>
<pre style="background-color: #fff;">MD2 part of OpenSSL 0.9.7d 17 Mar 2004
MD4 part of OpenSSL 0.9.7d 17 Mar 2004
MD5 part of OpenSSL 0.9.7d 17 Mar 2004
SHA part of OpenSSL 0.9.7d 17 Mar 2004
SHA1 part of OpenSSL 0.9.7d 17 Mar 2004
</pre>
<p>The backdoor relies on these DLLs for crypto-functions required to communicate with the C2.</p>
<p>The config format is consistent with the ELF binaries, i.e., the seven <code>'1;'</code> means the bot should be active seven days a week, all hours (00-24), the C2 communicates via HTTPS.</p>
<p>The same config is <a href="https://www.nccgroup.trust/uk/about-us/newsroom-and-events/blogs/2018/april/decoding-network-data-from-a-gh0st-rat-variant/">known to be used by Gh0st RAT</a>.</p>
<p>Just like <code>/bin/snort</code> described above, the bot also checks if the current day and hour match what&#8217;s specified in the config.</p>
<p>If there is no match, the bot also falls asleep for just over seven minutes (423.756 seconds), then checks the time again.</p>
<p>The code snippets below demonstrate that the 423,756-millisecond delay specified within <code>/bin/snort</code> executable is identical to its Windows counter-part:</p>
<table>
<tbody>
<tr>
<th>ELF executable: /bin/snort</th>
<th>Windows<br />
shellcode:</th>
</tr>
<tr>
<td><a href="https://news.sophos.com/wp-content/uploads/2019/11/image12.png"><img loading="lazy" class="alignnone size-full wp-image-62290" src="https://news.sophos.com/wp-content/uploads/2019/11/image12.png" alt="" width="640" height="245" srcset="https://news.sophos.com/wp-content/uploads/2019/11/image12.png 642w, https://news.sophos.com/wp-content/uploads/2019/11/image12.png?resize=300,115 300w" sizes="(max-width: 640px) 100vw, 640px" /></a></td>
<td><a href="https://news.sophos.com/wp-content/uploads/2019/11/image13.png"><img loading="lazy" class="alignnone size-full wp-image-62291" src="https://news.sophos.com/wp-content/uploads/2019/11/image13.png" alt="" width="640" height="223" srcset="https://news.sophos.com/wp-content/uploads/2019/11/image13.png 705w, https://news.sophos.com/wp-content/uploads/2019/11/image13.png?resize=300,105 300w" sizes="(max-width: 640px) 100vw, 640px" /></a></td>
</tr>
</tbody>
</table>
<p>On Linux, the number 423,756 is multiplied by 1,000, then passed to <em>usleep()</em> syscall that takes an argument in microseconds.</p>
<p>On Windows, the same number is passed to Sleep() API, which takes the argument in milliseconds.</p>
<p>In both cases, the achieved delay is identical: 7.062 seconds.</p>
<h2>Conclusion</h2>
<p>This case is extremely interesting as it demonstrates the true multi-platform nature of a modern attack.</p>
<p>A well-financed, competent, determined attacker will unlikely ever to be restricted by the boundaries imposed by different platforms.</p>
<p>Building a unified server infrastructure that serves various agents working on different platforms makes perfect sense for them.</p>
<p>When it comes to prevention against this or similar attacks, AWS SGs provide a robust boundary firewall for EC2 instances. However, this firewall does not eliminate the need for network administrators to keep all external-facing services fully patched.</p>
<p>The default installation for the SSH server also needs extra steps to harden it against attacks, turning it into a rock-solid communication daemon.</p>
<h2>IOC</h2>
<p><strong>Ports open on a local host</strong></p>
<ul>
<li>tcp 2080</li>
<li>udp 2053</li>
<li>tcp 10443</li>
</ul>
<p><strong>Example:</strong></p>
<pre style="background-color: #fff;">user@host:~$ sudo netstat -peanut | grep ":2080 \|:2053 "
tcp  0  0 0.0.0.0:<mark>2080</mark>    0.0.0.0:*    LISTEN  0  34402  2226/<mark>snoopy</mark>
udp  0  0 0.0.0.0:<mark>2053</mark>    0.0.0.0:*            0  34398  2224/<mark>snoopy</mark></pre>
<p><strong>To check if these ports are open on a remote compromised host with IP 192.168.5.150:</strong></p>
<pre style="background-color: #fff;">user@host:~$ sudo nmap 192.168.5.150 -p 2080
...
PORT     STATE    SERVICE
<mark>2080</mark>/tcp filtered autodesk-nlm</pre>
<pre style="background-color: #fff;">user@host:~$ sudo nmap 192.168.5.150 -p 2053 -sU
...
PORT     STATE    SERVICE
<mark>2053</mark>/udp filtered lot105-ds-upd</pre>
<p><strong>Inbound connections from the remote ports:</strong><br />
<code>1010</code>, <code>2020</code>, <code>6060</code>, <code>7070</code>, <code>8080</code>, <code>9999</code></p>
<p><strong>Domains:</strong></p>
<ul>
<li>cloud[.]newsofnp[.]com</li>
<li>ssl[.]newsofnp[.]com</li>
<li>load[.]CollegeSmooch[.]com</li>
</ul>
<p><strong>IPs:</strong></p>
<ul>
<li>62[.]113[.]255[.]18</li>
<li>89[.]33[.]246[.]111</li>
<li>185[.]86[.]151[.]67</li>
</ul>
<p><strong>Filenames:</strong></p>
<ul>
<li>/tmp/rrtserver-lock</li>
<li>/proc/sys/rrootkit</li>
<li>/tmp/rrtkernel.ko</li>
<li>/usr/bin/snd_floppy</li>
</ul>
<p><strong>Kernel module:</strong></p>
<ul>
<li>snd_floppy<br />
<strong>Example:</strong></p>
<pre style="background-color: #fff;">user@host:~$ sudo lsmod | grep "snd_floppy"
<mark>snd_floppy</mark> 316594 0
</pre>
</li>
</ul>
<p><strong>Syslog messages:</strong></p>
<ul>
<li><em>&#8220;&#8230;insmod: ERROR: could not insert module /usr/bin/snd_floppy: File exists&#8221;</em></li>
<li><em>&#8220;&#8230;kernel: snd_floppy: loading out-of-tree module taints kernel.&#8221;</em></li>
<li><em>&#8220;&#8230;kernel: snd_floppy: module verification failed: signature and/or required key missing – tainting kernel&#8221;</em></li>
</ul>
			</div><!-- .entry-content -->

</article><!-- #post-## -->

					<nav class="navigation post-navigation" role="navigation">
			<h2 class="screen-reader-text">Post navigation</h2>
			<div class="nav-links">
	   			<div class="nav-previous">
											<span class="nav-label">Prev</span>
						<a href="https://news.sophos.com/en-us/2020/02/21/five-steps-to-avoid-a-cloud-data-breach/" rel="prev">Five steps to avoid a cloud data breach</a>
						   			</div>
	   			<div class="nav-next">
											<span class="nav-label">Next</span>
						<a href="https://news.sophos.com/en-us/2020/02/25/harden-your-public-cloud-environment-against-apt-style-attacks/" rel="next">Harden your public cloud environment against APT-style attacks</a>
						   			</div>
		 	</div><!-- .nav-links -->
		</nav><!-- .navigation -->
		
			<div class="article-author-block article-co-authors-block">
	
					<h2 class="author-title">
				About the Authors			</h2>
		
					<div class="author-block-container">
				<div class="author-profile">
					<img alt='' src='https://secure.gravatar.com/avatar/41304abfe857c08aed7293c24a6c93fb?s=145&#038;d=blank&#038;r=g' class='avatar avatar-145 photo' height='145' width='145' />				</div> <!-- .author-profile -->

				<div class="author-description">
					<h3 class="author-name"><a href="https://news.sophos.com/en-us/author/sergei-shevchenko/" title="Posts by Sergei Shevchenko" class="author url fn" rel="author">Sergei Shevchenko</a></h3>

					
					<div class="author-bio">
						<p>Sergei Shevchenko has 20 years of professional experience reverse engineering malware and is a recognized expert in his field. His analysis of high-profile malware attacks, including previous years' Bangladesh Bank heist, attacks on other banks, cyber espionage within managed service providers and ransomware attacks affecting thousands of vital service organizations globally, is the go-to information source for risk and technology officers and their teams around the world. He manages our threat research team in Sydney.</p>
					</div> <!-- .author-bio -->
				</div> <!-- .author-description -->
			</div> <!-- .author-block-container -->
					<div class="author-block-container">
				<div class="author-profile">
					<img alt='' src='https://secure.gravatar.com/avatar/5662f1a92608ddd1eed96bcdadedfe60?s=145&#038;d=blank&#038;r=g' class='avatar avatar-145 photo' height='145' width='145' />				</div> <!-- .author-profile -->

				<div class="author-description">
					<h3 class="author-name"><a href="https://news.sophos.com/en-us/author/timothy-easton/" title="Posts by Timothy Easton" class="author url fn" rel="author">Timothy Easton</a></h3>

					
					<div class="author-bio">
						<p>As a senior threat researcher at Sophos for over 9 years I've had the enjoyable opportunity to pull apart the latest threats whether they be parasitics, rootkits, memory residence malware or any other threat. When I'm not chasing down infection chains I like to get out my mountain bike &amp; hit the trails.</p>
					</div> <!-- .author-bio -->
				</div> <!-- .author-description -->
			</div> <!-- .author-block-container -->
			</div>

			
<div id="comments" class="comments-area">

	
			<h2 class="comments-title">
			<span>6</span> Comments		</h2>

		<section class="comments-list">
		<article class="comment even thread-even depth-1 parent " id="comment-175703" itemprop="comment" itemscope itemtype="http://schema.org/Comment">
			<div class="comment-wrapper">
				<figure class="gravatar"><img alt='' src='https://news.sophos.com/wp-content/themes/sophosnews-2017/img/avatars/avatar-three.png' srcset='https://news.sophos.com/wp-content/themes/sophosnews-2017/img/avatars/avatar-one.png 2x' class='avatar avatar-60 photo' height='60' width='60' /></figure>
				<div class="comment-meta post-meta" role="complementary">
					<h2 class="comment-author">
													Nikesh Doshi											</h2>
					<time class="comment-meta-item" datetime="2020-02-25T10:52-05:00" itemprop="datePublished"><a href="#comment-175703" itemprop="url">25 February 2020 at 10:52 am</a></time>
														</div>
				<div class="comment-content post-content" itemprop="text">
					<p>This can also occur in Azure, right?<br />
How do we prevent that?</p>
					<a rel='nofollow' class='comment-reply-link' href='https://news.sophos.com/en-us/2020/02/25/cloud-snooper-attack-bypasses-firewall-security-measures/?replytocom=175703#respond' data-commentid="175703" data-postid="62091" data-belowelement="comment-175703" data-respondelement="respond" data-replyto="Reply to Nikesh Doshi" aria-label='Reply to Nikesh Doshi'>Reply</a>				</div>
			</div>

	<section class="child-comments comments-list">
		<article class="comment odd alt depth-2 parent " id="comment-175805" itemprop="comment" itemscope itemtype="http://schema.org/Comment">
			<div class="comment-wrapper">
				<figure class="gravatar"><img alt='' src='https://news.sophos.com/wp-content/themes/sophosnews-2017/img/avatars/avatar-two.png' srcset='https://news.sophos.com/wp-content/themes/sophosnews-2017/img/avatars/avatar-one.png 2x' class='avatar avatar-60 photo avatar-default' height='60' width='60' /></figure>
				<div class="comment-meta post-meta" role="complementary">
					<h2 class="comment-author">
													Competetive_charity											</h2>
					<time class="comment-meta-item" datetime="2020-02-26T14:04-05:00" itemprop="datePublished"><a href="#comment-175805" itemprop="url">26 February 2020 at 2:04 pm</a></time>
														</div>
				<div class="comment-content post-content" itemprop="text">
					<p>What policy set on a we server or an ingress would avoid this , any ideas?<br />
Nice writeup , though some of the time spent on drawing the picture and analogy could have been used to specify some ideas on defending against or mitigating ?</p>
					<a rel='nofollow' class='comment-reply-link' href='https://news.sophos.com/en-us/2020/02/25/cloud-snooper-attack-bypasses-firewall-security-measures/?replytocom=175805#respond' data-commentid="175805" data-postid="62091" data-belowelement="comment-175805" data-respondelement="respond" data-replyto="Reply to Competetive_charity" aria-label='Reply to Competetive_charity'>Reply</a>				</div>
			</div>

	<section class="child-comments comments-list">
		<article class="comment even depth-3  " id="comment-175887" itemprop="comment" itemscope itemtype="http://schema.org/Comment">
			<div class="comment-wrapper">
				<figure class="gravatar"><img alt='' src='https://news.sophos.com/wp-content/themes/sophosnews-2017/img/avatars/avatar-three.png' srcset='https://news.sophos.com/wp-content/themes/sophosnews-2017/img/avatars/avatar-three.png 2x' class='avatar avatar-60 photo' height='60' width='60' /></figure>
				<div class="comment-meta post-meta" role="complementary">
					<h2 class="comment-author">
													ZA											</h2>
					<time class="comment-meta-item" datetime="2020-02-27T12:17-05:00" itemprop="datePublished"><a href="#comment-175887" itemprop="url">27 February 2020 at 12:17 pm</a></time>
														</div>
				<div class="comment-content post-content" itemprop="text">
					<p>It mentions above in the post,    &#8220;network administrators to keep all external-facing services fully patched.</p>
<p>The default installation for the SSH server also needs extra steps to harden it against attacks, turning it into a rock-solid communication daemon.&#8221;   Assumption of this kind of attack was &#8216;somehow rootkit gets installed in EC2, not sure how&#8217;.  All comes down to patching and SSH hardening based on this article.</p>
					<a rel='nofollow' class='comment-reply-link' href='https://news.sophos.com/en-us/2020/02/25/cloud-snooper-attack-bypasses-firewall-security-measures/?replytocom=175887#respond' data-commentid="175887" data-postid="62091" data-belowelement="comment-175887" data-respondelement="respond" data-replyto="Reply to ZA" aria-label='Reply to ZA'>Reply</a>				</div>
			</div>

	</article></section></article></section></article>
		<article class="comment odd alt thread-odd thread-alt depth-1  " id="comment-175725" itemprop="comment" itemscope itemtype="http://schema.org/Comment">
			<div class="comment-wrapper">
				<figure class="gravatar"><img alt='' src='https://news.sophos.com/wp-content/themes/sophosnews-2017/img/avatars/avatar-one.png' srcset='https://news.sophos.com/wp-content/themes/sophosnews-2017/img/avatars/avatar-three.png 2x' class='avatar avatar-60 photo avatar-default' height='60' width='60' /></figure>
				<div class="comment-meta post-meta" role="complementary">
					<h2 class="comment-author">
													Anonymous											</h2>
					<time class="comment-meta-item" datetime="2020-02-25T16:45-05:00" itemprop="datePublished"><a href="#comment-175725" itemprop="url">25 February 2020 at 4:45 pm</a></time>
														</div>
				<div class="comment-content post-content" itemprop="text">
					<p>Thank you for the illustration, I was just about to give up reading on the highly technical part of the article when I was able to refer back and see the devil letting the wolf-sheep in the pen and then it all made sense&#8230;.</p>
					<a rel='nofollow' class='comment-reply-link' href='https://news.sophos.com/en-us/2020/02/25/cloud-snooper-attack-bypasses-firewall-security-measures/?replytocom=175725#respond' data-commentid="175725" data-postid="62091" data-belowelement="comment-175725" data-respondelement="respond" data-replyto="Reply to " aria-label='Reply to '>Reply</a>				</div>
			</div>

	</article>
		<article class="comment even thread-even depth-1  " id="comment-175800" itemprop="comment" itemscope itemtype="http://schema.org/Comment">
			<div class="comment-wrapper">
				<figure class="gravatar"><img alt='' src='https://news.sophos.com/wp-content/themes/sophosnews-2017/img/avatars/avatar-two.png' srcset='https://news.sophos.com/wp-content/themes/sophosnews-2017/img/avatars/avatar-one.png 2x' class='avatar avatar-60 photo' height='60' width='60' /></figure>
				<div class="comment-meta post-meta" role="complementary">
					<h2 class="comment-author">
													Ben											</h2>
					<time class="comment-meta-item" datetime="2020-02-26T12:25-05:00" itemprop="datePublished"><a href="#comment-175800" itemprop="url">26 February 2020 at 12:25 pm</a></time>
														</div>
				<div class="comment-content post-content" itemprop="text">
					<p>That is a great illustration &#8211; is it okay to replicate as long as we leave the &#8216;Sophos Labs&#8217; in the corner of the pic?</p>
					<a rel='nofollow' class='comment-reply-link' href='https://news.sophos.com/en-us/2020/02/25/cloud-snooper-attack-bypasses-firewall-security-measures/?replytocom=175800#respond' data-commentid="175800" data-postid="62091" data-belowelement="comment-175800" data-respondelement="respond" data-replyto="Reply to Ben" aria-label='Reply to Ben'>Reply</a>				</div>
			</div>

	</article>
		<article class="comment odd alt thread-odd thread-alt depth-1  " id="comment-175804" itemprop="comment" itemscope itemtype="http://schema.org/Comment">
			<div class="comment-wrapper">
				<figure class="gravatar"><img alt='' src='https://news.sophos.com/wp-content/themes/sophosnews-2017/img/avatars/avatar-two.png' srcset='https://news.sophos.com/wp-content/themes/sophosnews-2017/img/avatars/avatar-two.png 2x' class='avatar avatar-60 photo' height='60' width='60' /></figure>
				<div class="comment-meta post-meta" role="complementary">
					<h2 class="comment-author">
													Maksym											</h2>
					<time class="comment-meta-item" datetime="2020-02-26T13:27-05:00" itemprop="datePublished"><a href="#comment-175804" itemprop="url">26 February 2020 at 1:27 pm</a></time>
														</div>
				<div class="comment-content post-content" itemprop="text">
					<p>This kind of attack is only only possible with L3 firewalls without application inspections. Do yourself a favor, install NextGen firewall at your AWS/Azure Private Cloud in front web-server, slap inbound decryption proxy and sleep at night =)</p>
					<a rel='nofollow' class='comment-reply-link' href='https://news.sophos.com/en-us/2020/02/25/cloud-snooper-attack-bypasses-firewall-security-measures/?replytocom=175804#respond' data-commentid="175804" data-postid="62091" data-belowelement="comment-175804" data-respondelement="respond" data-replyto="Reply to Maksym" aria-label='Reply to Maksym'>Reply</a>				</div>
			</div>

	</article></section>
		
	
	
		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/en-us/2020/02/25/cloud-snooper-attack-bypasses-firewall-security-measures/#respond" style="display:none;">Cancel reply</a></small></h3><form action="https://news.sophos.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><p class="comment-notes"><span id="email-notes">Your email address will not be published.</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" /></p>
<p class="comment-form-email"><label for="email">Email</label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" aria-describedby="email-notes" /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p>
<p class="comment-form-cookies-consent"><input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox" value="yes" /> <label for="wp-comment-cookies-consent">Save my name, email, and website in this browser for the next time I comment.</label></p>
<input type="hidden" name="redirect_to" value="https://news.sophos.com/en-us/2020/02/25/cloud-snooper-attack-bypasses-firewall-security-measures/" id="redirect_to"><p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='62091' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="ea33ded028" /></p><input type="hidden" id="ak_js" name="ak_js" value="205"/><textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100" style="display: none !important;"></textarea></form>	</div><!-- #respond -->
	
</div><!-- #comments -->

		
		</main><!-- #main -->
	</div><!-- #primary -->


<div id="secondary" class="widget-area" role="complementary">
			
		<div id="second-article-wrapper" class="article-wrapper">
			<h3 class="widget-title">You might also enjoy...</h3>
			<article id="post-72266" class="second-featured post-72266 post type-post status-publish format-standard has-post-thumbnail hentry category-mtr category-security-operations tag-mtr tag-ransomware tag-sidebar tag-sophos-managed-threat-response-mtr tag-sophos-mtr region-en-us">
	<div class="second-featured__image" style="background-image: url('https://news.sophos.com/wp-content/uploads/2020/08/sophos-news-ft-img-mtr_v3.png?w=640');">
		<div class="featured-entry-meta">
			<div class="featured-entry-date">
				<span class="day-num">03</span>
				<span class="month">Feb</span>
			</div>
		</div>
	</div>
	<div class="second-featured__content">
		<header class="featured-entry-header">
			<div class="featured-entry-categories">
					<a href="https://news.sophos.com/en-us/category/mtr/">MTR</a> &bull; <a href="https://news.sophos.com/en-us/category/security-operations/">Security Operations</a>			</div>
			<h1 class="featured-entry-title dot-ellipsis dot-resize-update dot-load-update dot-height-130"><a href="https://news.sophos.com/en-us/2021/02/03/mtr-casebook-uncovering-a-backdoor-implant-in-a-solarwinds-orion-server/" rel="bookmark">MTR casebook: Uncovering a backdoor implant in a SolarWinds Orion server</a></h1>		</header> <!-- featured-entry-header -->
	</div>
</article> <!-- post -->
<article id="post-72321" class="second-featured post-72321 post type-post status-publish format-standard has-post-thumbnail hentry category-products tag-sidebar tag-zero-trust tag-ztna region-en-us">
	<div class="second-featured__image" style="background-image: url('https://news.sophos.com/wp-content/uploads/2021/02/ZTNA-header.png?w=640');">
		<div class="featured-entry-meta">
			<div class="featured-entry-date">
				<span class="day-num">02</span>
				<span class="month">Feb</span>
			</div>
		</div>
	</div>
	<div class="second-featured__content">
		<header class="featured-entry-header">
			<div class="featured-entry-categories">
					<a href="https://news.sophos.com/en-us/category/products/">Sophos Products</a>			</div>
			<h1 class="featured-entry-title dot-ellipsis dot-resize-update dot-load-update dot-height-130"><a href="https://news.sophos.com/en-us/2021/02/02/sophos-zero-trust-network-access-ztna-is-coming-soon/" rel="bookmark">Sophos zero trust network access (ZTNA) is coming soon</a></h1>		</header> <!-- featured-entry-header -->
	</div>
</article> <!-- post -->
<article id="post-72021" class="second-featured post-72021 post type-post status-publish format-standard has-post-thumbnail hentry category-products tag-mtr tag-rapid-response tag-sidebar tag-sophos-mtr tag-sophos-rapid-response region-en-us">
	<div class="second-featured__image" style="background-image: url('https://news.sophos.com/wp-content/uploads/2020/08/sophos-news-ft-img-mtr_v1.png?w=640');">
		<div class="featured-entry-meta">
			<div class="featured-entry-date">
				<span class="day-num">19</span>
				<span class="month">Jan</span>
			</div>
		</div>
	</div>
	<div class="second-featured__content">
		<header class="featured-entry-header">
			<div class="featured-entry-categories">
					<a href="https://news.sophos.com/en-us/category/products/">Sophos Products</a>			</div>
			<h1 class="featured-entry-title dot-ellipsis dot-resize-update dot-load-update dot-height-130"><a href="https://news.sophos.com/en-us/2021/01/19/451-research-impact-report-on-sophos-rapid-response-service/" rel="bookmark">451 Research Impact Report on Sophos Rapid Response service</a></h1>		</header> <!-- featured-entry-header -->
	</div>
</article> <!-- post -->
<article id="post-71626" class="second-featured post-71626 post type-post status-publish format-standard has-post-thumbnail hentry category-products tag-edr tag-intercept-x-advanced-for-server-with-edr tag-intercept-x-with-edr tag-live-discover tag-sidebar region-en-us">
	<div class="second-featured__image" style="background-image: url('https://news.sophos.com/wp-content/uploads/2020/12/APIs-hero.png?w=640');">
		<div class="featured-entry-meta">
			<div class="featured-entry-date">
				<span class="day-num">17</span>
				<span class="month">Dec</span>
			</div>
		</div>
	</div>
	<div class="second-featured__content">
		<header class="featured-entry-header">
			<div class="featured-entry-categories">
					<a href="https://news.sophos.com/en-us/category/products/">Sophos Products</a>			</div>
			<h1 class="featured-entry-title dot-ellipsis dot-resize-update dot-load-update dot-height-130"><a href="https://news.sophos.com/en-us/2020/12/17/sophos-edr-live-discover-apis-are-now-generally-available/" rel="bookmark">Sophos EDR Live Discover APIs are now generally available</a></h1>		</header> <!-- featured-entry-header -->
	</div>
</article> <!-- post -->
		</div>

	</div> <!-- #secondary -->


		</div> <!-- .container -->
	</div> <!-- #content -->
	<footer>
		<section class="cta">
			<p>Start a Sophos demo in less than a minute. See exactly how our solutions work in a full environment without a commitment.</p>
			<a href="https://secure2.sophos.com/en-us/products/demos.aspx?cmp=70130000001xKqzAAE">Learn More</a>
		</section>
		<section class="connected">
			<div class="social">
				<h3>Stay Connected</h3>
				<ul>
					<li><a href="https://www.facebook.com/securitybysophos" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/facebook-icon.svg?la=en&amp;hash=1CA0A5A0E9C9999E7E079A5D32C86E9BF9C7AD1E" alt="Facebook"></a>
					</li>
					<li><a href="https://www.instagram.com/sophossecurity/" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/instagram-icon.svg?la=en&amp;hash=2B50C2B67C3023D9E7D4E1C3A16401EAD8F10F76" alt="Instagram"></a>
					</li>
					<li><a href="https://www.linkedin.com/company/sophos" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/linkedin-icon.svg?la=en&amp;hash=B6D5378C1E1A16F239A4C862EAE3499B8EC1F3F9" alt="LinkedIn"></a></li>
					<li><a href="https://www.sophos.com/en-us/company/rss-feeds.aspx"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/rss-icon.svg?la=en&amp;hash=76C4DAFD331DC675814191A66794A778D8C6DCF7" alt="RSS"></a></li>
					<li><a href="https://twitter.com/Sophos" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/twitter-icon.svg?la=en&amp;hash=9A90D9F99ABE6454741BBAAF9C3FB6966624C92D" alt="Twitter"></a></li>
					<li><a href="https://www.youtube.com/user/SophosProducts" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/youtube-icon.svg?la=en&amp;hash=CCCF647AFA78C8DB74D654DB9FEFBF0AC54F42D3" alt="YouTube"></a></li>
				</ul>
			</div>
			<ul class="links">
				<li><a href="https://www.sophos.com/en-us/company/careers.aspx">Careers </a></li>
				<li><a href="https://www.sophos.com/en-us/partners/partner-locator.aspx">Find a Partner</a></li>
				<li><a href="https://secure2.sophos.com/en-us/support.aspx">Support</a></li>
				<li><a href="https://www.sophos.com/en-us/threat-center/technical-papers.aspx">Technical Papers</a></li>
				<li><a href="https://www.sophos.com/en-us/security-news-trends/whitepapers.aspx">Whitepapers</a></li>
			</ul>
		</section>
		<section class="legal">
			<div class="copyright">&copy; 1997 - 2021 Sophos Ltd. All rights reserved</div>
			<ul>
				<li><a href="https://www.sophos.com/en-us/legal.aspx">Legal</a></li>
				<li><a href="https://www.sophos.com/en-us/legal/sophos-group-privacy-policy.aspx">Privacy</a></li>
				<li><a href="https://www.sophos.com/en-us/legal/cookie-information.aspx">Cookie Information</a></li>
				<li><a href="https://www.sophos.com/en-us/legal/modern-slavery-act-transparency-statement.aspx">Modern Slavery Statement</a></li>
			</ul>
		</section>
		<div class="vip" style="background: #002939">
			Powered by <a href="https://wpvip.com/?utm_source=vip_powered_wpcom&#038;utm_medium=web&#038;utm_campaign=VIP%20Footer%20Credit&#038;utm_term=news.sophos.com" rel="generator nofollow" class="powered-by-wpcom">WordPress VIP</a>		</div>
	</footer>
	<script id='sophos-js-core-js-extra'>
var PG8Data = {"startPage":"1","maxPages":"1","nextLink":""};
</script>
<script type='text/javascript' src='https://news.sophos.com/_static/??-eJyVkMEOwiAMhl9IQGY2T8ZHMcjqxkaBUHD69mKWJR48jKSX/v2+NqlYAtPeJXBJpBEQSJAPoycHC7HmKM9iolIF8rMB9mx4w2UJ+BrwiQ5i1w7tYwUNrxQV7efXiOdkbL2lFQZlBlctBhWTg1jtDapa+WabZJy2uQda34pYFrAIwb45GvcPKi3gHfrf+XYZMws2D8aRULMhhCRuxRUPH7GwV7zITranRrZtN30AbTfKEQ=='></script>
<script src='https://stats.wp.com/e-202112.js' defer></script>
<script>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:9.5.2',blog:'166161023',post:'62091',tz:'-4',srv:'news.sophos.com'} ]);
	_stq.push([ 'clickTrackerInit', '166161023', '62091' ]);
</script>
</body>
</html>
