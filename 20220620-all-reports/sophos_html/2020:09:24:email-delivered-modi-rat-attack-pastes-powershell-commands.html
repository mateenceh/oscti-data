<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="https://news.sophos.com/xmlrpc.php">
<link rel="alternate" hreflang="en-us" href="https://news.sophos.com/en-us/2020/09/24/email-delivered-modi-rat-attack-pastes-powershell-commands/" /><!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl+ '&gtm_auth=d5XceCG5H_eblswmMfURjQ&gtm_preview=env-2&gtm_cookies_win=x';f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5L6H3LN');</script>
<!-- End Google Tag Manager -->
<title>Email-delivered MoDi RAT attack pastes PowerShell commands &#8211; Sophos News</title>
<meta name='robots' content='max-image-preview:large' />
<!-- Jetpack Site Verification Tags -->
<meta name="google-site-verification" content="8r1qg681OjOolfxmHEY1IYupmTBdyKXc-OPfpgeQHFk" />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel='dns-prefetch' href='//v0.wordpress.com' />
<link rel="alternate" type="application/rss+xml" title="Sophos News &raquo; Feed" href="https://news.sophos.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sophos News &raquo; Comments Feed" href="https://news.sophos.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sophos News &raquo; Email-delivered MoDi RAT attack pastes PowerShell commands Comments Feed" href="https://news.sophos.com/en-us/2020/09/24/email-delivered-modi-rat-attack-pastes-powershell-commands/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/news.sophos.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.7"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='all-css-0' href='https://news.sophos.com/_static/??/wp-includes/css/dist/block-library/style.min.css,/wp-content/themes/sophosnews-2017/style.css,/wp-content/mu-plugins/jetpack-9.5/css/jetpack.css?m=1615460519' type='text/css' media='all' />
<style id='wp-block-library-inline-css'>
.has-text-align-justify{text-align:justify;}
</style>
<script type='text/javascript' src='https://news.sophos.com/_static/??-eJzTLy/QzcxLzilNSS3WzwKiwtLUokoopZebmaeXVayjj0+Rbm5melFiSSpUsX2uraGZoamxkaGpmWEWAK8/Ihc='></script>
<link rel="https://api.w.org/" href="https://news.sophos.com/wp-json/" /><link rel="alternate" type="application/json" href="https://news.sophos.com/wp-json/wp/v2/posts/69522" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://news.sophos.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://news.sophos.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.7" />
<link rel="canonical" href="https://news.sophos.com/en-us/2020/09/24/email-delivered-modi-rat-attack-pastes-powershell-commands/" />
<link rel='shortlink' href='https://news.sophos.com/?p=69522' />
<link rel="alternate" type="application/json+oembed" href="https://news.sophos.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fnews.sophos.com%2Fen-us%2F2020%2F09%2F24%2Femail-delivered-modi-rat-attack-pastes-powershell-commands%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://news.sophos.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fnews.sophos.com%2Fen-us%2F2020%2F09%2F24%2Femail-delivered-modi-rat-attack-pastes-powershell-commands%2F&#038;format=xml" />
<style type='text/css'>img#wpstats{display:none}</style><link rel="amphtml" href="https://news.sophos.com/en-us/2020/09/24/email-delivered-modi-rat-attack-pastes-powershell-commands/amp/">
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Email-delivered MoDi RAT attack pastes PowerShell commands" />
<meta property="og:url" content="https://news.sophos.com/en-us/2020/09/24/email-delivered-modi-rat-attack-pastes-powershell-commands/" />
<meta property="og:description" content="Fileless attack scripts an interaction with the clipboard to evade detection" />
<meta property="article:published_time" content="2020-09-24T13:00:12+00:00" />
<meta property="article:modified_time" content="2020-09-24T08:22:39+00:00" />
<meta property="og:site_name" content="Sophos News" />
<meta property="og:image" content="https://news.sophos.com/wp-content/uploads/2020/09/modirat_featured.png?w=640" />
<meta property="og:image:secure_url" content="https://news.sophos.com/wp-content/uploads/2020/09/modirat_featured.png?w=640" />
<meta property="og:image:width" content="640" />
<meta property="og:image:height" content="295" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:text:title" content="Email-delivered MoDi RAT attack pastes PowerShell commands" />
<meta name="twitter:image" content="https://news.sophos.com/wp-content/uploads/2020/09/modirat_featured.png?w=640" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="fb:admins" content="28552295016" />

<!-- End Jetpack Open Graph Tags -->
<link rel="icon" href="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=32" sizes="32x32" />
<link rel="icon" href="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=192" sizes="192x192" />
<link rel="apple-touch-icon" href="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=180" />
<meta name="msapplication-TileImage" content="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=270" />
</head>

<body class="post-template-default single single-post postid-69522 single-format-standard group-blog">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5L6H3LN&gtm_auth=d5XceCG5H_eblswmMfURjQ&gtm_preview=env-2&gtm_cookies_win=x"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<div id="page" class="hfeed site">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

	<header id="masthead" class="site-header">

		<div class="header-container">

			<div class="site-branding">
				<h1 class="site-title">
										<a class="site-logo" href="https://www.sophos.com/en-us.aspx" rel="home">
						Sophos News					</a>
				</h1>
			</div> <!-- site-branding -->

			<nav class="primary-header-navigation" role="navigation">
				<ul id="menu-en-us-primary" class="menu"><li id="menu-item-33368" class="has-icons menu-item menu-item-type-custom menu-item-object-custom menu-item-33368"><a href="https://www.sophos.com/en-us/products.aspx">Products<div class="menu-item-description"></div></a></li>
<li id="menu-item-33382" class="has-icons menu-item menu-item-type-custom menu-item-object-custom menu-item-33382"><a href="https://www.sophos.com/en-us/solutions.aspx">Solutions<div class="menu-item-description"></div></a></li>
<li id="menu-item-33390" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33390"><a href="//www.sophos.com/en-us/partners.aspx">Partners<div class="menu-item-description"></div></a></li>
<li id="menu-item-33391" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33391"><a href="//www.sophos.com/en-us/support.aspx">Support<div class="menu-item-description"></div></a></li>
<li id="menu-item-33392" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33392"><a href="//www.sophos.com/en-us/company.aspx">Company<div class="menu-item-description"></div></a></li>
<li id="menu-item-33393" class="is-icon icon-download menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-33393"><a href="#">Downloads<div class="menu-item-description"></div></a>
<ul class="sub-menu">
	<li id="menu-item-33394" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33394"><a href="//www.sophos.com/en-us/products/free-trials.aspx">Free Trials<div class="menu-item-description">All product trials in one place.</div></a></li>
	<li id="menu-item-33395" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33395"><a href="//www.sophos.com/en-us/products/free-tools.aspx">Free Tools<div class="menu-item-description">Try our tools for use at home.</div></a></li>
	<li id="menu-item-33396" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33396"><a href="//www.sophos.com/en-us/products/request-a-quote.aspx">Get Pricing<div class="menu-item-description">The right price every time.</div></a></li>
</ul>
</li>
<li id="menu-item-33397" class="is-icon icon-search menu-item menu-item-type-custom menu-item-object-custom menu-item-33397"><a href="//www.sophos.com/en-us/search-results.aspx">Search<div class="menu-item-description"></div></a></li>
<li id="menu-item-33398" class="is-icon icon-account menu-item menu-item-type-custom menu-item-object-custom menu-item-33398"><a href="//www.sophos.com/en-us/login.aspx">Sign In<div class="menu-item-description"></div></a></li>
</ul>			</nav>

		</div>
	</header> <!-- site-header -->

	<div class="secondary-header">
		<div class="secondary-header-container container">
			<nav class="secondary-header-navigation" role="navigation">
				<ul id="menu-en-us-secondary" class="menu"><li id="menu-item-33399" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33399"><a href="//www.sophos.com/en-us/company.aspx">Overview</a></li>
<li id="menu-item-33401" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33401"><a href="//www.sophos.com/en-us/company/press.aspx">Press</a></li>
<li id="menu-item-33402" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33402"><a href="//secure2.sophos.com/en-us/company/events.aspx">Events</a></li>
<li id="menu-item-33403" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33403"><a href="//www.sophos.com/en-us/company/community.aspx">Community</a></li>
<li id="menu-item-33404" class="menu-item-blog menu-item menu-item-type-custom menu-item-object-custom menu-item-33404"><a href="/">Blog</a></li>
<li id="menu-item-33405" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33405"><a href="//secure2.sophos.com/en-us/company/careers.aspx">Careers</a></li>
<li id="menu-item-33406" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33406"><a href="//www.sophos.com/en-us/company/contact.aspx">Contact</a></li>
</ul>			</nav>
		</div>
	</div> <!-- secondary-header -->

	<div class="news-header">
		<div class="news-header-container container">

			<div class="news-branding">
				<h1 class="news-title">
					<a class="news-logo" href="https://news.sophos.com/en-us/" rel="home">
						Sophos News					</a>
				</h1>
			</div> <!-- news-branding -->

			<div class="mobile-menu-toggle">
				<a href="#newsmenu">
											Menu									</a>
			</div>

			<div class="mobile-search-toggle">
				<a class="icon icon-search-secondary" href="#search">
					Search				</a>
			</div>

			<nav class="news-header-navigation" role="navigation">
				<ul id="menu-en-us-tertiary" class="menu"><li id="menu-item-33407" class="is-icon icon-search menu-item menu-item-type-custom menu-item-object-custom menu-item-33407"><a href="#search">Search</a></li>
</ul>			</nav>

			<div class="site-search-block" style="display: none;">
				<form role="search" class="search-form" method="get" action="https://news.sophos.com/en-us/">
					<fieldset>
						<div class="field">
							<input type="text" value="" name="s" class="search-field" placeholder="Search">
						</div>
						<div class="submit">
							<button type="submit" class="search-submit icon icon-search-secondary">
								Go							</button>
						</div>
					</fieldset>
				</form>
				<a class="icon" href="#search-close">
					Close				</a>
			</div>
		</div>
	</div> <!-- news-header -->

	<div id="content" class="site-content">
		<div class="content-container">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			
<article id="post-69522" class="post-69522 post type-post status-publish format-standard has-post-thumbnail hentry category-sophoslabs-uncut tag-dll-injection tag-fileless tag-fileless-malware tag-modi-rat tag-reflective-loader tag-scripted-attack tag-vbe region-en-us">

	<header class="entry-header">

		<h1 class="entry-title">Email-delivered MoDi RAT attack pastes PowerShell commands</h1>
		<div class="entry-categories">
			<a href="https://news.sophos.com/en-us/category/sophoslabs/sophoslabs-uncut/">SophosLabs Uncut</a>&bull;<a href="https://news.sophos.com/en-us/tag/dll-injection/">DLL injection</a>&bull;<a href="https://news.sophos.com/en-us/tag/fileless/">fileless</a>&bull;<a href="https://news.sophos.com/en-us/tag/fileless-malware/">fileless malware</a>&bull;<a href="https://news.sophos.com/en-us/tag/modi-rat/">MoDi RAT</a>&bull;<a href="https://news.sophos.com/en-us/tag/reflective-loader/">reflective loader</a>&bull;<a href="https://news.sophos.com/en-us/tag/scripted-attack/">scripted attack</a>&bull;<a href="https://news.sophos.com/en-us/tag/vbe/">VBE</a>		</div>

					<div class="entry-excerpt">
				<p>Fileless attack scripts an interaction with the clipboard to evade detection</p>
			</div>
		
		<div class="entry-meta">
			<span class="posted-on"><a href="https://news.sophos.com/en-us/2020/09/24/email-delivered-modi-rat-attack-pastes-powershell-commands/" rel="bookmark">24 September 2020</a></span>		</div><!-- .entry-meta -->

		<div class="entry-social">
			
	<ul class="social-sharing" id="social-sharing">
		<li class="comments">
			<a href="#comments" title="Leave a Reply">
				0			</a>
		</li>
		<li class="twitter"><a class="js-share-modal" href="http://twitter.com/intent/tweet?text=Email-delivered%20MoDi%20RAT%20attack%20pastes%20PowerShell%20commands%20https%3A%2F%2Fnews.sophos.com%2F%3Fp%3D69522" data-title="" title="Share on Twitter">Share on Twitter</a></li>
		<li class="facebook"><a class="js-share-modal" href="http://www.facebook.com/share.php?u=https://news.sophos.com/?p=69522&#038;title=Email-delivered%20MoDi%20RAT%20attack%20pastes%20PowerShell%20commands" data-title="Email-delivered MoDi RAT attack pastes PowerShell commands" title="Share on Facebook">Share on Facebook</a></li>
		<li class="linkedin">
			<a
				href="http://www.linkedin.com/shareArticle?mini=true&url=https://news.sophos.com/en-us/2020/09/24/email-delivered-modi-rat-attack-pastes-powershell-commands/"
				data-title="Email-delivered MoDi RAT attack pastes PowerShell commands"
				title="Share on LinkedIn"
				onclick="window.open(this.href, '', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
			>
				Share on LinkedIn			</a>
		</li>
	</ul>

			</div><!-- .entry-social -->
	</header><!-- .entry-header -->

		<div class="entry-featured-image">
		<img width="640" height="295" src="https://news.sophos.com/wp-content/uploads/2020/09/modirat_featured.png?w=640" class="attachment-post-thumbnail size-post-thumbnail wp-post-image" alt="" loading="lazy" srcset="https://news.sophos.com/wp-content/uploads/2020/09/modirat_featured.png 743w, https://news.sophos.com/wp-content/uploads/2020/09/modirat_featured.png?resize=300,138 300w" sizes="(max-width: 640px) 100vw, 640px" />	</div> <!-- .featured-image -->
	
	<div class="entry-meta">
		<span class="byline">By <span class="author vcard"><a href="https://news.sophos.com/en-us/author/andrew-brandt/" title="Posts by Andrew Brandt" class="author url fn" rel="author">Andrew Brandt</a></span><span class="author vcard"><a href="https://news.sophos.com/en-us/author/fraser-howard/" title="Posts by Fraser Howard" class="author url fn" rel="author">Fraser Howard</a></span><span class="author vcard"><a href="https://news.sophos.com/en-us/author/odbaadf00d/" title="Posts by Andrew O&#039;Donnell" class="author url fn" rel="author">Andrew O&#039;Donnell</a></span></span>	</div><!-- .entry-meta -->

	<div class="entry-content">
		<p>SophosLabs researchers Fraser Howard and Andrew O&#8217;Donnell stumbled upon an unusual <em>reflective loader</em> attack method last month while hunting through threat telemetry. The attack chain started with a malicious email message that contained some hostile VB scripting code, and concluded by delivering a commodity remote access Trojan named MoDi RAT.</p>
<p>These kinds of detections often lead to interesting, divergent attacks, which is what the detection teams are looking for. Diving down the rabbit hole, Howard and O&#8217;Donnell discovered a few intriguing twists to the convoluted attack, which included a Scheduled Task that started a Visual Basic Script file that, in turn, launches PowerShell and then literally <em>pasted the text of the commands into the PowerShell window</em>, rather than passing the command string as a parameter.</p>
<p>But let&#8217;s not get ahead of ourselves. Here is Howard&#8217;s root cause analysis (RCA) of the attack chain.</p>
<p><strong>AMSI vs. MoDi RAT</strong></p>
<p>The attack analysis pivoted on some of the data collected from Sophos endpoint products using Microsoft&#8217;s <a href="https://docs.microsoft.com/en-us/windows/win32/amsi/antimalware-scan-interface-portal" target="_blank" rel="noopener noreferrer">Antimalware Scan Interface (AMSI)</a>. The root cause of the attack triggered our telemetry: a malicious script, delivered (most likely) via spam. In the example below, the user&#8217;s browser (Edge, highlighted in red below) started the attack chain, which you can see in this snippet of the threat case.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2020/09/modirat_attack-chain-RCA.png"><img loading="lazy" class="alignnone size-full wp-image-69523" src="https://news.sophos.com/wp-content/uploads/2020/09/modirat_attack-chain-RCA.png" alt="" width="640" height="431" srcset="https://news.sophos.com/wp-content/uploads/2020/09/modirat_attack-chain-RCA.png 1097w, https://news.sophos.com/wp-content/uploads/2020/09/modirat_attack-chain-RCA.png?resize=300,202 300w, https://news.sophos.com/wp-content/uploads/2020/09/modirat_attack-chain-RCA.png?resize=768,517 768w, https://news.sophos.com/wp-content/uploads/2020/09/modirat_attack-chain-RCA.png?resize=1024,690 1024w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>The attack begins when a recipient of the malspam opens the <span style="font-size: 1em;">message attachment. The Visual Basic Script in the message attachment connects to a remote site, which is the entry point into a series of HTTP 302 redirects that eventually lead to a .Zip archive, hosted in OneDrive cloud storage, that contains an encoded VBS (VBE) file. </span></p>
<p>With the VBE file in hand, we set about reproducing the entire attack to get a complete picture, right through to the payload.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2020/09/modirat_schtasks.png"><img loading="lazy" class="alignnone size-full wp-image-69585" src="https://news.sophos.com/wp-content/uploads/2020/09/modirat_schtasks.png" alt="" width="640" height="169" srcset="https://news.sophos.com/wp-content/uploads/2020/09/modirat_schtasks.png 816w, https://news.sophos.com/wp-content/uploads/2020/09/modirat_schtasks.png?resize=300,79 300w, https://news.sophos.com/wp-content/uploads/2020/09/modirat_schtasks.png?resize=768,202 768w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>The initial VBScript writes out a second VBS file to the filesystem, and inserts three new entries into the Windows Registry that contain binary data, written out as 8-digit binary numbers. It then launches a system utility to create a new Scheduled Task that, at a predetermined time in the future, launches the VBS script.</p>
<p>When the Scheduled Task runs, it uses wscript.exe to launch the VBS. The VBS code launches PowerShell and then runs this code, which takes data from the VBS and inserts it into the system&#8217;s clipboard, where it can then programmatically &#8220;paste&#8221; the commands into the PowerShell window using the VBS <em>SendKeys</em> command.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2020/09/modirat_clipboard-code.png"><img loading="lazy" class="alignnone size-full wp-image-69586" src="https://news.sophos.com/wp-content/uploads/2020/09/modirat_clipboard-code.png" alt="" width="640" height="327" srcset="https://news.sophos.com/wp-content/uploads/2020/09/modirat_clipboard-code.png 738w, https://news.sophos.com/wp-content/uploads/2020/09/modirat_clipboard-code.png?resize=300,153 300w" sizes="(max-width: 640px) 100vw, 640px" /></a>This neat little trick to deliver the powershell commands seems designed to evade detection by keeping the commands they execute under the radar, rather than attracting attention by spawning an instance of PowerShell with some interesting command-line parameters that might trigger all sorts of security product alerts. From this point on, the attack is fileless.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2020/09/modirat_registrykeys.png"><img loading="lazy" class="alignnone size-full wp-image-69587" src="https://news.sophos.com/wp-content/uploads/2020/09/modirat_registrykeys.png" alt="" width="416" height="252" srcset="https://news.sophos.com/wp-content/uploads/2020/09/modirat_registrykeys.png 416w, https://news.sophos.com/wp-content/uploads/2020/09/modirat_registrykeys.png?resize=300,182 300w" sizes="(max-width: 416px) 100vw, 416px" /></a></p>
<p>In the next step, PowerShell extracts a .NET decoder executable from one of the Registry blobs (labeled <strong><em>Entreur</em> </strong>in the Registry) that the VBE had created earlier, and reflectively loads it by injecting it into a system process.</p>
<p>The decoder executable, in turn, extracts the .NET injector and payload blobs (labeled in the Registry as <strong><em>inj</em></strong> and <strong><em>Myfile</em></strong>, respectively) from the Registry. Then the injector loads the payload (injecting into the host application, msbuild.exe).</p>
<p>Notably, the initial Zip payload name (&#8220;Timbres-electroniques&#8221;) and several other strings, including the <em>Entreur</em> Registry key were comprised of words from the French language. Some of the targets of these attacks were French firms.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2020/09/modirat_inj.png"><img loading="lazy" class="alignnone size-full wp-image-69588" src="https://news.sophos.com/wp-content/uploads/2020/09/modirat_inj.png" alt="" width="583" height="249" srcset="https://news.sophos.com/wp-content/uploads/2020/09/modirat_inj.png 583w, https://news.sophos.com/wp-content/uploads/2020/09/modirat_inj.png?resize=300,128 300w" sizes="(max-width: 583px) 100vw, 583px" /></a></p>
<p>The diagram below summarizes all this and illustrates the key components of the attack chain.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2020/09/modirat_fileless-attack-chain.png"><img loading="lazy" class="alignnone size-full wp-image-69525" src="https://news.sophos.com/wp-content/uploads/2020/09/modirat_fileless-attack-chain.png" alt="" width="640" height="389" srcset="https://news.sophos.com/wp-content/uploads/2020/09/modirat_fileless-attack-chain.png 1445w, https://news.sophos.com/wp-content/uploads/2020/09/modirat_fileless-attack-chain.png?resize=300,182 300w, https://news.sophos.com/wp-content/uploads/2020/09/modirat_fileless-attack-chain.png?resize=768,467 768w, https://news.sophos.com/wp-content/uploads/2020/09/modirat_fileless-attack-chain.png?resize=1024,623 1024w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>The three .NET executable layers (decoder, injector, and payload) do not touch the disk, but we proactively blocked the attack based on our recognition of the technique the attackers employ to deliver the payload filelessly.</p>
<p>Despite already proactively blocking this attack, as a result of our further investigation we were able to enhance existing detections to provide additional resilience against similar attacks we might see in the future.</p>
<h3>Why you should upgrade from older Windows</h3>
<p>Microsoft&#8217;s <a href="https://docs.microsoft.com/en-us/windows/win32/amsi/antimalware-scan-interface-portal" target="_blank" rel="noopener noreferrer">AMSI framework</a> that <a href="https://support.sophos.com/support/s/article/KB-000039096?language=en_US" target="_blank" rel="noopener noreferrer">helps us intercept and neutralize these kinds of attacks</a> is only available on certain recent flavors of Windows (Windows 10, Windows Server 2016 and Windows Server 2019). If there&#8217;s one single reason why users of older versions of Windows should upgrade, it&#8217;s this: AMSI protection is crucial to helping us defend against many of today&#8217;s attacks, particularly those that use fileless techniques.</p>
<p>This attack typifies how most of the fileless attacks that we see work. AMSI provides the capability for Sophos to proactively protect customers against a range of similar attacks, and the telemetry we&#8217;re able to get lets us dive into these rabbit holes so we can identify and enhance our protections more effectively.</p>
<p>Sophos endpoint products will detect the components of this attack as <strong>AMSI/Reflect-D</strong>, <strong>Troj/VBSInj-D</strong>, and <strong>AMSI/ModiRat-A</strong>.</p>
<h3>Indicators of compromise</h3>
<p>IoCs relating to this investigation have been <a href="https://github.com/sophoslabs/IoCs/blob/master/MoDi-RAT-reflective-injection.csv" target="_blank" rel="noopener noreferrer">posted to the SophosLabs Github</a>.</p>
			</div><!-- .entry-content -->

</article><!-- #post-## -->

					<nav class="navigation post-navigation" role="navigation">
			<h2 class="screen-reader-text">Post navigation</h2>
			<div class="nav-links">
	   			<div class="nav-previous">
											<span class="nav-label">Prev</span>
						<a href="https://news.sophos.com/en-us/2020/09/22/mtr-casebook-blocking-a-15-million-maze-ransomware-attack/" rel="prev">MTR Casebook: Blocking a $15 million Maze ransomware attack</a>
						   			</div>
	   			<div class="nav-next">
											<span class="nav-label">Next</span>
						<a href="https://news.sophos.com/en-us/2020/09/25/sophos-to-be-included-in-the-2020-mitre-engenuity-attck%ef%b8%8f-evaluations-for-enterprise/" rel="next">Sophos to be included in the 2020 MITRE Engenuity ATT&amp;CK®️ Evaluations for Enterprise</a>
						   			</div>
		 	</div><!-- .nav-links -->
		</nav><!-- .navigation -->
		
			<div class="article-author-block article-co-authors-block">
	
					<h2 class="author-title">
				About the Authors			</h2>
		
					<div class="author-block-container">
				<div class="author-profile">
					<img alt='' src='https://secure.gravatar.com/avatar/216532880604c8cf0600f4bc964cf01d?s=145&#038;d=blank&#038;r=g' class='avatar avatar-145 photo' height='145' width='145' />				</div> <!-- .author-profile -->

				<div class="author-description">
					<h3 class="author-name"><a href="https://news.sophos.com/en-us/author/andrew-brandt/" title="Posts by Andrew Brandt" class="author url fn" rel="author">Andrew Brandt</a></h3>

					
					<div class="author-bio">
						<p>Andrew Brandt is a Principal Researcher for Sophos, specializing in security analytics and the forensic, retrospective analysis of malware infections and cyberattacks. In brief, he does whatever it takes to make life and business difficult for cybercriminals, spies, and other Internet miscreants. </p>
					</div> <!-- .author-bio -->
				</div> <!-- .author-description -->
			</div> <!-- .author-block-container -->
					<div class="author-block-container">
				<div class="author-profile">
					<img alt='' src='https://secure.gravatar.com/avatar/8e69986cae5972e972239f0c176287fc?s=145&#038;d=blank&#038;r=g' class='avatar avatar-145 photo' height='145' width='145' />				</div> <!-- .author-profile -->

				<div class="author-description">
					<h3 class="author-name"><a href="https://news.sophos.com/en-us/author/fraser-howard/" title="Posts by Fraser Howard" class="author url fn" rel="author">Fraser Howard</a></h3>

					
					<div class="author-bio">
						<p>Fraser is one of the Principal Threat Researchers in SophosLabs. He has been working for Sophos since 2006. His main interest is in dynamic analysis &amp; protection, and is at his happiest when adding behavioral protections to thwart today's cyber attacks.</p>
					</div> <!-- .author-bio -->
				</div> <!-- .author-description -->
			</div> <!-- .author-block-container -->
					<div class="author-block-container">
				<div class="author-profile">
					<img alt='' src='https://secure.gravatar.com/avatar/a3932c9d864b5eff3a869c1e693f3a9b?s=145&#038;d=blank&#038;r=g' class='avatar avatar-145 photo' height='145' width='145' />				</div> <!-- .author-profile -->

				<div class="author-description">
					<h3 class="author-name"><a href="https://news.sophos.com/en-us/author/odbaadf00d/" title="Posts by Andrew O&#039;Donnell" class="author url fn" rel="author">Andrew O&#039;Donnell</a></h3>

					
					<div class="author-bio">
						<p>Andrew O'Donnell works as a senior threat researcher for SophosLabs and has been working at Sophos since 2007.</p>
<p>His areas of interest include attack tools, reverse engineering, malware analysis, and finding ways to defend against attacks at all stages.</p>
					</div> <!-- .author-bio -->
				</div> <!-- .author-description -->
			</div> <!-- .author-block-container -->
			</div>

			
<div id="comments" class="comments-area">

	
	
	
		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/en-us/2020/09/24/email-delivered-modi-rat-attack-pastes-powershell-commands/#respond" style="display:none;">Cancel reply</a></small></h3><form action="https://news.sophos.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><p class="comment-notes"><span id="email-notes">Your email address will not be published.</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" /></p>
<p class="comment-form-email"><label for="email">Email</label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" aria-describedby="email-notes" /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p>
<p class="comment-form-cookies-consent"><input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox" value="yes" /> <label for="wp-comment-cookies-consent">Save my name, email, and website in this browser for the next time I comment.</label></p>
<input type="hidden" name="redirect_to" value="https://news.sophos.com/en-us/2020/09/24/email-delivered-modi-rat-attack-pastes-powershell-commands/" id="redirect_to"><p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='69522' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="7c815ec36e" /></p><input type="hidden" id="ak_js" name="ak_js" value="72"/><textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100" style="display: none !important;"></textarea></form>	</div><!-- #respond -->
	
</div><!-- #comments -->

		
		</main><!-- #main -->
	</div><!-- #primary -->


<div id="secondary" class="widget-area" role="complementary">
			
		<div id="second-article-wrapper" class="article-wrapper">
			<h3 class="widget-title">You might also enjoy...</h3>
			<article id="post-69352" class="second-featured post-69352 post type-post status-publish format-standard has-post-thumbnail hentry category-sophoslabs-uncut tag-maze tag-ragnar-locker tag-ransomware tag-sdrsmlink tag-troj-ransom-gav tag-troj-swrort-eg tag-virtual-machine tag-vm region-en-us">
	<div class="second-featured__image" style="background-image: url('https://news.sophos.com/wp-content/uploads/2020/09/maze-ransom-note.png?w=640');">
		<div class="featured-entry-meta">
			<div class="featured-entry-date">
				<span class="day-num">17</span>
				<span class="month">Sep</span>
			</div>
		</div>
	</div>
	<div class="second-featured__content">
		<header class="featured-entry-header">
			<div class="featured-entry-categories">
					<a href="https://news.sophos.com/en-us/category/sophoslabs/sophoslabs-uncut/">SophosLabs Uncut</a>			</div>
			<h1 class="featured-entry-title dot-ellipsis dot-resize-update dot-load-update dot-height-130"><a href="https://news.sophos.com/en-us/2020/09/17/maze-attackers-adopt-ragnar-locker-virtual-machine-technique/" rel="bookmark">Maze attackers adopt Ragnar Locker virtual machine technique</a></h1>		</header> <!-- featured-entry-header -->
	</div>
</article> <!-- post -->
<article id="post-68973" class="second-featured post-68973 post type-post status-publish format-standard has-post-thumbnail hentry category-sophoslabs-uncut tag-fakealert tag-fleeceware tag-fraud tag-mal-fakealert tag-technical-support-scam region-en-us">
	<div class="second-featured__image" style="background-image: url('https://news.sophos.com/wp-content/uploads/2020/09/supportscam-2.png?w=640');">
		<div class="featured-entry-meta">
			<div class="featured-entry-date">
				<span class="day-num">09</span>
				<span class="month">Sep</span>
			</div>
		</div>
	</div>
	<div class="second-featured__content">
		<header class="featured-entry-header">
			<div class="featured-entry-categories">
					<a href="https://news.sophos.com/en-us/category/sophoslabs/sophoslabs-uncut/">SophosLabs Uncut</a>			</div>
			<h1 class="featured-entry-title dot-ellipsis dot-resize-update dot-load-update dot-height-130"><a href="https://news.sophos.com/en-us/2020/09/09/faking-it-the-thriving-business-of-fake-alert-web-scams/" rel="bookmark">Faking it: the thriving business of &#8220;fake alert&#8221; web scams</a></h1>		</header> <!-- featured-entry-header -->
	</div>
</article> <!-- post -->
<article id="post-67764" class="second-featured post-67764 post type-post status-publish format-standard has-post-thumbnail hentry category-sophoslabs-uncut tag-65529-tcp tag-8088-tcp tag-cve-2017-8570 tag-eternalblue tag-exploits tag-hadoop tag-lemon_duck tag-maldoc tag-mimikatz tag-smbghost tag-yarn region-en-us">
	<div class="second-featured__image" style="background-image: url('https://news.sophos.com/wp-content/uploads/2020/08/lemonduck.jpg?w=500');">
		<div class="featured-entry-meta">
			<div class="featured-entry-date">
				<span class="day-num">25</span>
				<span class="month">Aug</span>
			</div>
		</div>
	</div>
	<div class="second-featured__content">
		<header class="featured-entry-header">
			<div class="featured-entry-categories">
					<a href="https://news.sophos.com/en-us/category/sophoslabs/sophoslabs-uncut/">SophosLabs Uncut</a>			</div>
			<h1 class="featured-entry-title dot-ellipsis dot-resize-update dot-load-update dot-height-130"><a href="https://news.sophos.com/en-us/2020/08/25/lemon_duck-cryptominer-targets-cloud-apps-linux/" rel="bookmark">Lemon_Duck cryptominer targets cloud apps &#038; Linux</a></h1>		</header> <!-- featured-entry-header -->
	</div>
</article> <!-- post -->
<article id="post-67967" class="second-featured post-67967 post type-post status-publish format-standard has-post-thumbnail hentry category-sophoslabs-uncut region-en-us">
	<div class="second-featured__image" style="background-image: url('https://news.sophos.com/wp-content/uploads/2020/07/lock-and-key-e1595364579343.jpg?w=640');">
		<div class="featured-entry-meta">
			<div class="featured-entry-date">
				<span class="day-num">27</span>
				<span class="month">Jul</span>
			</div>
		</div>
	</div>
	<div class="second-featured__content">
		<header class="featured-entry-header">
			<div class="featured-entry-categories">
					<a href="https://news.sophos.com/en-us/category/sophoslabs/sophoslabs-uncut/">SophosLabs Uncut</a>			</div>
			<h1 class="featured-entry-title dot-ellipsis dot-resize-update dot-load-update dot-height-130"><a href="https://news.sophos.com/en-us/2020/07/27/prolock-ransomware-gives-you-the-first-8-kilobytes-of-decryption-for-free/" rel="bookmark">ProLock ransomware gives you the first 8 kilobytes of decryption for free</a></h1>		</header> <!-- featured-entry-header -->
	</div>
</article> <!-- post -->
		</div>

	</div> <!-- #secondary -->


		</div> <!-- .container -->
	</div> <!-- #content -->
	<footer>
		<section class="cta">
			<p>Start a Sophos demo in less than a minute. See exactly how our solutions work in a full environment without a commitment.</p>
			<a href="https://secure2.sophos.com/en-us/products/demos.aspx?cmp=70130000001xKqzAAE">Learn More</a>
		</section>
		<section class="connected">
			<div class="social">
				<h3>Stay Connected</h3>
				<ul>
					<li><a href="https://www.facebook.com/securitybysophos" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/facebook-icon.svg?la=en&amp;hash=1CA0A5A0E9C9999E7E079A5D32C86E9BF9C7AD1E" alt="Facebook"></a>
					</li>
					<li><a href="https://www.instagram.com/sophossecurity/" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/instagram-icon.svg?la=en&amp;hash=2B50C2B67C3023D9E7D4E1C3A16401EAD8F10F76" alt="Instagram"></a>
					</li>
					<li><a href="https://www.linkedin.com/company/sophos" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/linkedin-icon.svg?la=en&amp;hash=B6D5378C1E1A16F239A4C862EAE3499B8EC1F3F9" alt="LinkedIn"></a></li>
					<li><a href="https://www.sophos.com/en-us/company/rss-feeds.aspx"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/rss-icon.svg?la=en&amp;hash=76C4DAFD331DC675814191A66794A778D8C6DCF7" alt="RSS"></a></li>
					<li><a href="https://twitter.com/Sophos" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/twitter-icon.svg?la=en&amp;hash=9A90D9F99ABE6454741BBAAF9C3FB6966624C92D" alt="Twitter"></a></li>
					<li><a href="https://www.youtube.com/user/SophosProducts" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/youtube-icon.svg?la=en&amp;hash=CCCF647AFA78C8DB74D654DB9FEFBF0AC54F42D3" alt="YouTube"></a></li>
				</ul>
			</div>
			<ul class="links">
				<li><a href="https://www.sophos.com/en-us/company/careers.aspx">Careers </a></li>
				<li><a href="https://www.sophos.com/en-us/partners/partner-locator.aspx">Find a Partner</a></li>
				<li><a href="https://secure2.sophos.com/en-us/support.aspx">Support</a></li>
				<li><a href="https://www.sophos.com/en-us/threat-center/technical-papers.aspx">Technical Papers</a></li>
				<li><a href="https://www.sophos.com/en-us/security-news-trends/whitepapers.aspx">Whitepapers</a></li>
			</ul>
		</section>
		<section class="legal">
			<div class="copyright">&copy; 1997 - 2021 Sophos Ltd. All rights reserved</div>
			<ul>
				<li><a href="https://www.sophos.com/en-us/legal.aspx">Legal</a></li>
				<li><a href="https://www.sophos.com/en-us/legal/sophos-group-privacy-policy.aspx">Privacy</a></li>
				<li><a href="https://www.sophos.com/en-us/legal/cookie-information.aspx">Cookie Information</a></li>
				<li><a href="https://www.sophos.com/en-us/legal/modern-slavery-act-transparency-statement.aspx">Modern Slavery Statement</a></li>
			</ul>
		</section>
		<div class="vip" style="background: #002939">
			Powered by <a href="https://wpvip.com/?utm_source=vip_powered_wpcom&#038;utm_medium=web&#038;utm_campaign=VIP%20Footer%20Credit&#038;utm_term=news.sophos.com" rel="generator nofollow" class="powered-by-wpcom">WordPress VIP</a>		</div>
	</footer>
	<script id='sophos-js-core-js-extra'>
var PG8Data = {"startPage":"1","maxPages":"1","nextLink":""};
</script>
<script type='text/javascript' src='https://news.sophos.com/_static/??-eJyVkMEOwiAMhl9IYCxuxoPxUQyyurFRIJQ5fXsxyxIPHkbSS/9+X5tULIFp7xK4JNIACCTIh8GTg4VYXcmTGClXhvxkgD1rXnOZA74GfKSD2LVD+1hAwytFRfv5NeJzMrbc0gqDMr0rFoOKyUEs9npVrHyzTTJO27kDWt+KmBewCMG+ORr3D8ot4B263/l2GWcW7NwbR0JNhhCSuGVXPHzEzF7xIlvZHNuqkefxA21LyhQ='></script>
<script src='https://stats.wp.com/e-202112.js' defer></script>
<script>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:9.5.2',blog:'166161023',post:'69522',tz:'-4',srv:'news.sophos.com'} ]);
	_stq.push([ 'clickTrackerInit', '166161023', '69522' ]);
</script>
</body>
</html>
