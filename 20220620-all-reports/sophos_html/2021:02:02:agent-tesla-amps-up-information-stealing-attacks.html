<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="https://news.sophos.com/xmlrpc.php">
<link rel="alternate" hreflang="en-us" href="https://news.sophos.com/en-us/2021/02/02/agent-tesla-amps-up-information-stealing-attacks/" /><!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl+ '&gtm_auth=d5XceCG5H_eblswmMfURjQ&gtm_preview=env-2&gtm_cookies_win=x';f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5L6H3LN');</script>
<!-- End Google Tag Manager -->
<title>Agent Tesla amps up information stealing attacks &#8211; Sophos News</title>
<meta name='robots' content='max-image-preview:large' />
<!-- Jetpack Site Verification Tags -->
<meta name="google-site-verification" content="8r1qg681OjOolfxmHEY1IYupmTBdyKXc-OPfpgeQHFk" />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel='dns-prefetch' href='//v0.wordpress.com' />
<link rel="alternate" type="application/rss+xml" title="Sophos News &raquo; Feed" href="https://news.sophos.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sophos News &raquo; Comments Feed" href="https://news.sophos.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sophos News &raquo; Agent Tesla amps up information stealing attacks Comments Feed" href="https://news.sophos.com/en-us/2021/02/02/agent-tesla-amps-up-information-stealing-attacks/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/news.sophos.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.7"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='all-css-0' href='https://news.sophos.com/_static/??/wp-includes/css/dist/block-library/style.min.css,/wp-content/themes/sophosnews-2017/style.css,/wp-content/mu-plugins/jetpack-9.5/css/jetpack.css?m=1616171106' type='text/css' media='all' />
<style id='wp-block-library-inline-css'>
.has-text-align-justify{text-align:justify;}
</style>
<script type='text/javascript' src='https://news.sophos.com/_static/??-eJzTLy/QzcxLzilNSS3WzwKiwtLUokoopZebmaeXVayjj0+Rbm5melFiSSpUsX2uraGZoamxkaGpqUUWAK9KIh0='></script>
<link rel="https://api.w.org/" href="https://news.sophos.com/wp-json/" /><link rel="alternate" type="application/json" href="https://news.sophos.com/wp-json/wp/v2/posts/72064" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://news.sophos.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://news.sophos.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.7" />
<link rel="canonical" href="https://news.sophos.com/en-us/2021/02/02/agent-tesla-amps-up-information-stealing-attacks/" />
<link rel='shortlink' href='https://news.sophos.com/?p=72064' />
<link rel="alternate" type="application/json+oembed" href="https://news.sophos.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fnews.sophos.com%2Fen-us%2F2021%2F02%2F02%2Fagent-tesla-amps-up-information-stealing-attacks%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://news.sophos.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fnews.sophos.com%2Fen-us%2F2021%2F02%2F02%2Fagent-tesla-amps-up-information-stealing-attacks%2F&#038;format=xml" />
<style type='text/css'>img#wpstats{display:none}</style><link rel="amphtml" href="https://news.sophos.com/en-us/2021/02/02/agent-tesla-amps-up-information-stealing-attacks/amp/">
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Agent Tesla amps up information stealing attacks" />
<meta property="og:url" content="https://news.sophos.com/en-us/2021/02/02/agent-tesla-amps-up-information-stealing-attacks/" />
<meta property="og:description" content="Recent updates to this common RAT add new communications methods and subvert the operating system&#8217;s own defenses" />
<meta property="article:published_time" content="2021-02-02T13:30:13+00:00" />
<meta property="article:modified_time" content="2021-02-03T13:22:00+00:00" />
<meta property="og:site_name" content="Sophos News" />
<meta property="og:image" content="https://news.sophos.com/wp-content/uploads/2021/01/electricity-2057082_1280-e1611695199423.jpg?w=640" />
<meta property="og:image:secure_url" content="https://news.sophos.com/wp-content/uploads/2021/01/electricity-2057082_1280-e1611695199423.jpg?w=640" />
<meta property="og:image:width" content="640" />
<meta property="og:image:height" content="314" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:text:title" content="Agent Tesla amps up information stealing attacks" />
<meta name="twitter:image" content="https://news.sophos.com/wp-content/uploads/2021/01/electricity-2057082_1280-e1611695199423.jpg?w=640" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="fb:admins" content="28552295016" />

<!-- End Jetpack Open Graph Tags -->
<link rel="icon" href="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=32" sizes="32x32" />
<link rel="icon" href="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=192" sizes="192x192" />
<link rel="apple-touch-icon" href="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=180" />
<meta name="msapplication-TileImage" content="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=270" />
</head>

<body class="post-template-default single single-post postid-72064 single-format-standard group-blog">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5L6H3LN&gtm_auth=d5XceCG5H_eblswmMfURjQ&gtm_preview=env-2&gtm_cookies_win=x"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<div id="page" class="hfeed site">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

	<header id="masthead" class="site-header">

		<div class="header-container">

			<div class="site-branding">
				<h1 class="site-title">
										<a class="site-logo" href="https://www.sophos.com/en-us.aspx" rel="home">
						Sophos News					</a>
				</h1>
			</div> <!-- site-branding -->

			<nav class="primary-header-navigation" role="navigation">
				<ul id="menu-en-us-primary" class="menu"><li id="menu-item-33368" class="has-icons menu-item menu-item-type-custom menu-item-object-custom menu-item-33368"><a href="https://www.sophos.com/en-us/products.aspx">Products<div class="menu-item-description"></div></a></li>
<li id="menu-item-33382" class="has-icons menu-item menu-item-type-custom menu-item-object-custom menu-item-33382"><a href="https://www.sophos.com/en-us/solutions.aspx">Solutions<div class="menu-item-description"></div></a></li>
<li id="menu-item-33390" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33390"><a href="//www.sophos.com/en-us/partners.aspx">Partners<div class="menu-item-description"></div></a></li>
<li id="menu-item-33391" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33391"><a href="//www.sophos.com/en-us/support.aspx">Support<div class="menu-item-description"></div></a></li>
<li id="menu-item-33392" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33392"><a href="//www.sophos.com/en-us/company.aspx">Company<div class="menu-item-description"></div></a></li>
<li id="menu-item-33393" class="is-icon icon-download menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-33393"><a href="#">Downloads<div class="menu-item-description"></div></a>
<ul class="sub-menu">
	<li id="menu-item-33394" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33394"><a href="//www.sophos.com/en-us/products/free-trials.aspx">Free Trials<div class="menu-item-description">All product trials in one place.</div></a></li>
	<li id="menu-item-33395" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33395"><a href="//www.sophos.com/en-us/products/free-tools.aspx">Free Tools<div class="menu-item-description">Try our tools for use at home.</div></a></li>
	<li id="menu-item-33396" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33396"><a href="//www.sophos.com/en-us/products/request-a-quote.aspx">Get Pricing<div class="menu-item-description">The right price every time.</div></a></li>
</ul>
</li>
<li id="menu-item-33397" class="is-icon icon-search menu-item menu-item-type-custom menu-item-object-custom menu-item-33397"><a href="//www.sophos.com/en-us/search-results.aspx">Search<div class="menu-item-description"></div></a></li>
<li id="menu-item-33398" class="is-icon icon-account menu-item menu-item-type-custom menu-item-object-custom menu-item-33398"><a href="//www.sophos.com/en-us/login.aspx">Sign In<div class="menu-item-description"></div></a></li>
</ul>			</nav>

		</div>
	</header> <!-- site-header -->

	<div class="secondary-header">
		<div class="secondary-header-container container">
			<nav class="secondary-header-navigation" role="navigation">
				<ul id="menu-en-us-secondary" class="menu"><li id="menu-item-33399" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33399"><a href="//www.sophos.com/en-us/company.aspx">Overview</a></li>
<li id="menu-item-33401" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33401"><a href="//www.sophos.com/en-us/company/press.aspx">Press</a></li>
<li id="menu-item-33402" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33402"><a href="//secure2.sophos.com/en-us/company/events.aspx">Events</a></li>
<li id="menu-item-33403" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33403"><a href="//www.sophos.com/en-us/company/community.aspx">Community</a></li>
<li id="menu-item-33404" class="menu-item-blog menu-item menu-item-type-custom menu-item-object-custom menu-item-33404"><a href="/">Blog</a></li>
<li id="menu-item-33405" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33405"><a href="//secure2.sophos.com/en-us/company/careers.aspx">Careers</a></li>
<li id="menu-item-33406" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33406"><a href="//www.sophos.com/en-us/company/contact.aspx">Contact</a></li>
</ul>			</nav>
		</div>
	</div> <!-- secondary-header -->

	<div class="news-header">
		<div class="news-header-container container">

			<div class="news-branding">
				<h1 class="news-title">
					<a class="news-logo" href="https://news.sophos.com/en-us/" rel="home">
						Sophos News					</a>
				</h1>
			</div> <!-- news-branding -->

			<div class="mobile-menu-toggle">
				<a href="#newsmenu">
											Menu									</a>
			</div>

			<div class="mobile-search-toggle">
				<a class="icon icon-search-secondary" href="#search">
					Search				</a>
			</div>

			<nav class="news-header-navigation" role="navigation">
				<ul id="menu-en-us-tertiary" class="menu"><li id="menu-item-33407" class="is-icon icon-search menu-item menu-item-type-custom menu-item-object-custom menu-item-33407"><a href="#search">Search</a></li>
</ul>			</nav>

			<div class="site-search-block" style="display: none;">
				<form role="search" class="search-form" method="get" action="https://news.sophos.com/en-us/">
					<fieldset>
						<div class="field">
							<input type="text" value="" name="s" class="search-field" placeholder="Search">
						</div>
						<div class="submit">
							<button type="submit" class="search-submit icon icon-search-secondary">
								Go							</button>
						</div>
					</fieldset>
				</form>
				<a class="icon" href="#search-close">
					Close				</a>
			</div>
		</div>
	</div> <!-- news-header -->

	<div id="content" class="site-content">
		<div class="content-container">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			
<article id="post-72064" class="post-72064 post type-post status-publish format-standard has-post-thumbnail hentry category-sophoslabs-uncut tag-agent-tesla tag-amsi tag-telegram tag-tor region-en-us">

	<header class="entry-header">

		<h1 class="entry-title">Agent Tesla amps up information stealing attacks</h1>
		<div class="entry-categories">
			<a href="https://news.sophos.com/en-us/category/sophoslabs/sophoslabs-uncut/">SophosLabs Uncut</a>&bull;<a href="https://news.sophos.com/en-us/tag/agent-tesla/">Agent Tesla</a>&bull;<a href="https://news.sophos.com/en-us/tag/amsi/">AMSI</a>&bull;<a href="https://news.sophos.com/en-us/tag/telegram/">Telegram</a>&bull;<a href="https://news.sophos.com/en-us/tag/tor/">Tor</a>		</div>

					<div class="entry-excerpt">
				<p>Recent updates to this common RAT add new communications methods and subvert the operating system&#8217;s own defenses</p>
			</div>
		
		<div class="entry-meta">
			<span class="posted-on"><a href="https://news.sophos.com/en-us/2021/02/02/agent-tesla-amps-up-information-stealing-attacks/" rel="bookmark">2 February 2021</a></span>		</div><!-- .entry-meta -->

		<div class="entry-social">
			
	<ul class="social-sharing" id="social-sharing">
		<li class="comments">
			<a href="#comments" title="Leave a Reply">
				0			</a>
		</li>
		<li class="twitter"><a class="js-share-modal" href="http://twitter.com/intent/tweet?text=Agent%20Tesla%20amps%20up%20information%20stealing%20attacks%20https%3A%2F%2Fnews.sophos.com%2F%3Fp%3D72064" data-title="" title="Share on Twitter">Share on Twitter</a></li>
		<li class="facebook"><a class="js-share-modal" href="http://www.facebook.com/share.php?u=https://news.sophos.com/?p=72064&#038;title=Agent%20Tesla%20amps%20up%20information%20stealing%20attacks" data-title="Agent Tesla amps up information stealing attacks" title="Share on Facebook">Share on Facebook</a></li>
		<li class="linkedin">
			<a
				href="http://www.linkedin.com/shareArticle?mini=true&url=https://news.sophos.com/en-us/2021/02/02/agent-tesla-amps-up-information-stealing-attacks/"
				data-title="Agent Tesla amps up information stealing attacks"
				title="Share on LinkedIn"
				onclick="window.open(this.href, '', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
			>
				Share on LinkedIn			</a>
		</li>
	</ul>

			</div><!-- .entry-social -->
	</header><!-- .entry-header -->

		<div class="entry-featured-image">
		<img width="640" height="314" src="https://news.sophos.com/wp-content/uploads/2021/01/electricity-2057082_1280-e1611695199423.jpg?w=640" class="attachment-post-thumbnail size-post-thumbnail wp-post-image" alt="" loading="lazy" srcset="https://news.sophos.com/wp-content/uploads/2021/01/electricity-2057082_1280-e1611695199423.jpg 1273w, https://news.sophos.com/wp-content/uploads/2021/01/electricity-2057082_1280-e1611695199423.jpg?resize=300,147 300w, https://news.sophos.com/wp-content/uploads/2021/01/electricity-2057082_1280-e1611695199423.jpg?resize=768,376 768w, https://news.sophos.com/wp-content/uploads/2021/01/electricity-2057082_1280-e1611695199423.jpg?resize=1024,502 1024w" sizes="(max-width: 640px) 100vw, 640px" />	</div> <!-- .featured-image -->
	
	<div class="entry-meta">
		<span class="byline">By <span class="author vcard"><a href="https://news.sophos.com/en-us/author/sean-gallagher/" title="Posts by Sean Gallagher" class="author url fn" rel="author">Sean Gallagher</a></span><span class="author vcard"><a href="https://news.sophos.com/en-us/author/markel-picado/" title="Posts by Markel Picado" class="author url fn" rel="author">Markel Picado</a></span></span>	</div><!-- .entry-meta -->

	<div class="entry-content">
		<p>The Agent Tesla family of remote access trojan (RAT) malware has been active for over seven years, yet it remains one of the most common threats to Windows users. A variety of attackers use the malware to steal user credentials and other information from victims through screenshots, keyboard logging, and clipboard capture.</p>
<p>Because the malware&#8217;s compiler hard-codes operator-specific variables at build time, Agent Tesla behavior can vary widely—and the malware continues to evolve. Recent changes increased the number of applications targeted for credential theft, including web browsers, email clients, virtual private network clients, and other software that store user names and passwords. The evolution of the tool also extends to its delivery package, with one version that now targets Microsoft&#8217;s Anti-Malware Software Interface (AMSI) in an attempt to defeat endpoint protection software.</p>
<p>SophosLabs has tracked multiple actors using Agent Tesla, including the ones behind the <a href="https://news.sophos.com/en-us/2020/05/14/raticate/">RATicate campaigns</a> we began investigating in November of 2019.  We&#8217;ve continued to see new variants in a growing number of attacks over the past 10 months; as recently as December of 2020, Agent Tesla accounted for 20 percent of malware email attachments detected in Sophos customer telemetry.</p>
<p>In this report, we will delve into the two currently active versions we&#8217;ve identified, which we&#8217;ve identified as Agent Tesla version 2 and version 3. The differences between the two demonstrate how the RAT has evolved, employing multiple types of defense evasion and obfuscation to avoid detection—including options to install and use the Tor anonymizing network client, and the Telegram messaging API, for command and control (C2) communications. The differences we see between v2 and v3 of Agent Tesla appear to be focused on improving the success rate of the malware against sandbox defenses and malware scanners, and on providing more C2 options to their attacker customers.</p>
<h3><strong>Build-a-bot</strong></h3>
<p>Both current versions of Agent Tesla use a set of global variables that determine the functionality and behavior of the malware. The attacker provides the values for these variables in the form of a configuration file that govern a wide variety of behaviors, such as the delay time between C2 attempts (shown below).</p>
<figure id="attachment_72122" aria-describedby="caption-attachment-72122" style="width: 640px" class="wp-caption alignnone"><a style="font-size: 1em" href="https://news.sophos.com/wp-content/uploads/2021/01/Behavior_Code.png"><img loading="lazy" class="wp-image-72122 size-full" src="https://news.sophos.com/wp-content/uploads/2021/01/Behavior_Code.png" alt="" width="640" height="496" srcset="https://news.sophos.com/wp-content/uploads/2021/01/Behavior_Code.png 886w, https://news.sophos.com/wp-content/uploads/2021/01/Behavior_Code.png?resize=300,233 300w, https://news.sophos.com/wp-content/uploads/2021/01/Behavior_Code.png?resize=768,596 768w" sizes="(max-width: 640px) 100vw, 640px" /></a><figcaption id="caption-attachment-72122" class="wp-caption-text">Some of the configuration variables that drive Agent Tesla&#8217;s behavior.</figcaption></figure>
<p>The variables common to both versions of Agent Tesla determine which network protocol is to be used for C2 communications, based on an integer value set by the configuration file. They also can enable or disable the following behaviors:</p>
<ul>
<li>Persistence (allowing the RAT to restart when the operating system is rebooted)</li>
<li>Activation of a remote uninstall feature</li>
<li>Collection of the infected host&#8217;s IP address</li>
<li>Sending a success message to the C2 after installation</li>
<li>Whether or not to steal data via screenshots</li>
<li>Whether or not to log keystrokes (and, in Agent Tesla v3, steal the contents of the Windows system clipboard).</li>
<li>In Agent Tesla v3, whether or not to deploy a Tor client to conceal communications.</li>
</ul>
<p>The RAT&#8217;s compiler encodes these options into the executable that&#8217;s delivered to the victim.</p>
<h3>Special delivery</h3>
<p>Agent Tesla usually arrives in a malicious spam email as an attachment. In the example below, the malware that drops Agent Tesla is disguised as a .zip compressed file attachment that the attacker claims contains a catalog for the recipient to review:</p>
<figure id="attachment_72229" aria-describedby="caption-attachment-72229" style="width: 640px" class="wp-caption alignnone"><a href="https://news.sophos.com/wp-content/uploads/2021/01/teslamail.jpg"><img loading="lazy" class="size-full wp-image-72229" src="https://news.sophos.com/wp-content/uploads/2021/01/teslamail.jpg" alt="" width="640" height="328" srcset="https://news.sophos.com/wp-content/uploads/2021/01/teslamail.jpg 826w, https://news.sophos.com/wp-content/uploads/2021/01/teslamail.jpg?resize=300,154 300w, https://news.sophos.com/wp-content/uploads/2021/01/teslamail.jpg?resize=768,393 768w" sizes="(max-width: 640px) 100vw, 640px" /></a><figcaption id="caption-attachment-72229" class="wp-caption-text">A malicious email carrying an Agent Tesla packer (source: VirusTotal)</figcaption></figure>
<p>More recent versions of Agent Tesla use a number of methods to both make sandbox and static analysis more difficult and evade endpoint detection. Going beyond the use of packers to obfuscate code, these multi-stage malware installers also pull in components hosted (in some cases) in plain view on legitimate websites. The Agent Tesla installer also attempts to overwrite code in Microsoft&#8217;s AMSI.</p>
<figure id="attachment_72090" aria-describedby="caption-attachment-72090" style="width: 624px" class="wp-caption alignnone"><a href="https://news.sophos.com/wp-content/uploads/2021/01/packer2_agent_tesla.png"><img loading="lazy" class="wp-image-72090 size-full" src="https://news.sophos.com/wp-content/uploads/2021/01/packer2_agent_tesla.png" alt="" width="624" height="364" srcset="https://news.sophos.com/wp-content/uploads/2021/01/packer2_agent_tesla.png 624w, https://news.sophos.com/wp-content/uploads/2021/01/packer2_agent_tesla.png?resize=300,175 300w" sizes="(max-width: 624px) 100vw, 624px" /></a><figcaption id="caption-attachment-72090" class="wp-caption-text">The workflow of the new multi-stage Agent Tesla installer.</figcaption></figure>
<p>The first stage is a .NET-based downloader, which grabs chunks of base64-encoded, obfuscated code for the second stage from websites such as Pastebin and a Pastebin clone called <em>Hastebin</em>. The base64-encoded chunks are delimited from the rest of the HTML content by three &#8220;@&#8221; symbols, before and after the chunk, as shown in the sample below:</p>
<figure id="attachment_72183" aria-describedby="caption-attachment-72183" style="width: 640px" class="wp-caption alignnone"><a href="https://news.sophos.com/wp-content/uploads/2021/01/response.png"><img loading="lazy" class="size-full wp-image-72183" src="https://news.sophos.com/wp-content/uploads/2021/01/response.png" alt="" width="640" height="104" srcset="https://news.sophos.com/wp-content/uploads/2021/01/response.png 1225w, https://news.sophos.com/wp-content/uploads/2021/01/response.png?resize=300,49 300w, https://news.sophos.com/wp-content/uploads/2021/01/response.png?resize=768,125 768w, https://news.sophos.com/wp-content/uploads/2021/01/response.png?resize=1024,166 1024w" sizes="(max-width: 640px) 100vw, 640px" /></a><figcaption id="caption-attachment-72183" class="wp-caption-text">An example of a response to a download request by Agent Tesla&#8217;s multi-stage downloader.</figcaption></figure>
<p>The downloader also tries to get the memory address of <strong><a href="https://docs.microsoft.com/en-us/windows/win32/api/amsi/nf-amsi-amsiscanbuffer">AmsiScanBuffe</a>r</strong>—calling Windows&#8217; <strong>amsi.dll </strong>with the Windows <strong><a href="https://docs.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya">LoadLibraryA</a> </strong>function to get the DLL&#8217;s base address, and then <strong><a href="https://docs.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress">GetProcAddress</a> </strong>using that base address and  the &#8220;AmsiScanBuffer&#8221; procedure name to get the address of the function.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2021/01/AGENT_TESLA_AMSI_scan1.png"><img loading="lazy" class="alignnone wp-image-72094 size-full" src="https://news.sophos.com/wp-content/uploads/2021/01/AGENT_TESLA_AMSI_scan1.png" alt="" width="1289" height="234" srcset="https://news.sophos.com/wp-content/uploads/2021/01/AGENT_TESLA_AMSI_scan1.png 1289w, https://news.sophos.com/wp-content/uploads/2021/01/AGENT_TESLA_AMSI_scan1.png?resize=300,54 300w, https://news.sophos.com/wp-content/uploads/2021/01/AGENT_TESLA_AMSI_scan1.png?resize=768,139 768w, https://news.sophos.com/wp-content/uploads/2021/01/AGENT_TESLA_AMSI_scan1.png?resize=1024,186 1024w" sizes="(max-width: 1289px) 100vw, 1289px" /></a></p>
<p>Once Agent Tesla gets the address of AmsiScanBuffer, it patches the first 8 bytes of this function in memory:<a href="https://news.sophos.com/wp-content/uploads/2021/01/AGENTTESLA_AMSISCAN3.png"><img loading="lazy" class="alignnone size-full wp-image-72095" src="https://news.sophos.com/wp-content/uploads/2021/01/AGENTTESLA_AMSISCAN3.png" alt="" width="624" height="524" srcset="https://news.sophos.com/wp-content/uploads/2021/01/AGENTTESLA_AMSISCAN3.png 624w, https://news.sophos.com/wp-content/uploads/2021/01/AGENTTESLA_AMSISCAN3.png?resize=300,252 300w" sizes="(max-width: 624px) 100vw, 624px" /></a>These are the patched x86 instructions these opcodes refer to:</p>
<pre>.data:00000000    B8 57 00 07 80        mov eax, 0x80070057
.data:00000005    C2 18 00              ret 0x18</pre>
<p>The effect of this patch to the AmsiScanBuffer routine forces AMSI to return an error (<a href="https://docs.microsoft.com/en-us/windows/win32/seccrypto/common-hresult-values" target="_blank" rel="noopener">code 0x80070057</a>), making all the AMSI scans of memory appear to be invalid. This sabotages endpoint protection software dependent on AMSI, by essentially making them skip further AMSI scans for dynamically loaded assemblies within the Agent Tesla process. Since this happens early in the first stage downloader&#8217;s execution, it renders ineffective any AMSI protection against the subsequent components of the downloader, the second-stage loader, and the Agent Tesla payload itself.</p>
<p>After downloading the chunks, the downloader stage joins and decodes them, then decrypts them with a simple algorithm. The decoded and decrypted buffer is the second stage—a loader that carries the final Agent Tesla payload.</p>
<p>The second stage uses a series of steps to avoid sandbox analysis through debugging. First, using the Microsoft .NET <em>Debugger</em> class, it checks to see if a debugger is attached by checking the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.debugger.isattached?view=netcore-3.1">Debugger.IsAttached </a>property, and then c<span style="font-size: 1em">hecks to see if logging is enabled by using the </span><a style="font-size: 1em" href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.debugger.islogging?view=netcore-3.1">Debugger.IsLogging</a><span style="font-size: 1em"> method. Then, using the</span> <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-ntsetinformationthread">NtSetInformationThread </a>Windows API function, it sets the <strong>ThreadHideFromDebugger</strong> field in order to hide the thread from the debugger. Once this value is set, the debugger never gets information from the thread, and the practical effect is that it detatches the debugger.</p>
<p>This technique is hardly new, but it remains very effective.</p>
<h3>Tesla uncoils</h3>
<p>Overall, the functionality of Agent Tesla v2 and v3 is largely the same, with a few notable differences noted below :</p>
<figure id="attachment_72123" aria-describedby="caption-attachment-72123" style="width: 640px" class="wp-caption alignnone"><a style="font-size: 1em" href="https://news.sophos.com/wp-content/uploads/2021/01/Behavior_Graph_2.png"><img loading="lazy" class="wp-image-72123 size-full" src="https://news.sophos.com/wp-content/uploads/2021/01/Behavior_Graph_2.png" alt="" width="640" height="388" srcset="https://news.sophos.com/wp-content/uploads/2021/01/Behavior_Graph_2.png 1219w, https://news.sophos.com/wp-content/uploads/2021/01/Behavior_Graph_2.png?resize=300,182 300w, https://news.sophos.com/wp-content/uploads/2021/01/Behavior_Graph_2.png?resize=768,466 768w, https://news.sophos.com/wp-content/uploads/2021/01/Behavior_Graph_2.png?resize=1024,621 1024w" sizes="(max-width: 640px) 100vw, 640px" /></a><figcaption id="caption-attachment-72123" class="wp-caption-text">A comparison of the behaviors and workflow of Agent Tesla V2 and V3, with areas of difference in V3 highlighted. (Click to enlarge)</figcaption></figure>
<p>The first thing both versions of Agent Telsa do when activated is to check for (and kill) any other running instances of Agent Tesla—a step taken to ensure that the originally deployed copy is removed if the bot is configured to establish persistence.</p>
<p>It then initializes additional, dynamically-set global variables (such as an identifying number and name) and the folder to be used for installation. These vary from sample to sample.</p>
<p>The malware then performs another sandbox evasion technique, initializing a timer that is used to check if the code is being executed on a sandbox. The timer has a procedure that uses <a href="https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-getlastinputinfo">GetLastInputInfo </a>to retrieve and compare user input; if there&#8217;s no user input detected, Agent Tesla shuts down.</p>
<h3>Choosing a carrier</h3>
<p>Both v2 and v3 of Agent Tesla can be configured to communicate over HTTP, SMTP, and FTP. Agent Tesla v3 adds the Telegram chat protocol as an option. Each follows a slightly different path to push stolen data back to the attacker:</p>
<ul>
<li>HTTP: Directly sends data to a web panel controlled by the attacker.</li>
<li>SMTP: Sends data using a stolen mail account to a mail server controlled by the attacker.</li>
<li>FTP: Uploads data to an FTP server controlled by the attacker. (Rarely used, this method might permit anyone to recover the stolen information from that server because the address of the FTP server as well as the username and password are encoded into the malware binary.)</li>
<li>TELEGRAM: Sends the exfiltrated data to a private Telegram chat room.</li>
</ul>
<p>The attacker chooses one of these C2 communications channels as part of the pre-build configuration process; in the majority of cases we&#8217;ve observed, the attacker uses SMTP for communication with the C2 server, possibly because it is more secure for the operator, and requires less infrastructure. (The attacker only needs an email account for SMTP, while the HTTP method would require the attacker to establish and maintain a web server running a control panel.)</p>
<figure id="attachment_72138" aria-describedby="caption-attachment-72138" style="width: 974px" class="wp-caption alignnone"><a style="font-size: 1em" href="https://news.sophos.com/wp-content/uploads/2021/01/C2protocol.png"><img loading="lazy" class="wp-image-72138 size-full" src="https://news.sophos.com/wp-content/uploads/2021/01/C2protocol.png" alt="" width="974" height="368" srcset="https://news.sophos.com/wp-content/uploads/2021/01/C2protocol.png 974w, https://news.sophos.com/wp-content/uploads/2021/01/C2protocol.png?resize=300,113 300w, https://news.sophos.com/wp-content/uploads/2021/01/C2protocol.png?resize=768,290 768w" sizes="(max-width: 974px) 100vw, 974px" /></a><figcaption id="caption-attachment-72138" class="wp-caption-text">Agent Tesla code checking the value of the C2 protocol variable to select communications type.</figcaption></figure>
<p>The HTTP C2 method does have certain benefits for the attacker, however. The HTTP C2 protocol is the only one that supports remote execution of any of Agent Tesla&#8217;s functions. While the information-stealing behavior of Agent Tesla is largely the same across all C2 communications protocols, there are two that <em>only</em> work with HTTP:  a remote uninstall feature, and a feature that lets the operator know the bot has been installed successfully.</p>
<p>In Agent Tesla v2, an additional variable (which we refer to in our analysis as &#8220;keepalive&#8221;) also determines whether these features work; The malware&#8217;s developers apparently decided this variable was redundant and eliminated it in Agent Tesla v3. Even the new Telegram chat protocol is one-way only.</p>
<p><a style="font-size: 1em" href="https://news.sophos.com/wp-content/uploads/2021/01/C2_Overview.png"><img loading="lazy" class="size-full wp-image-72124" src="https://news.sophos.com/wp-content/uploads/2021/01/C2_Overview.png" alt="" width="640" height="356" srcset="https://news.sophos.com/wp-content/uploads/2021/01/C2_Overview.png 1004w, https://news.sophos.com/wp-content/uploads/2021/01/C2_Overview.png?resize=300,167 300w, https://news.sophos.com/wp-content/uploads/2021/01/C2_Overview.png?resize=768,427 768w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>An overview of Agent Tesla&#8217;s command and control traffic for each available network protocol.In both versions of Agent Tesla, if HTTP is selected as the C2 protocol, the malware sends an empty HTTP message to the C2 server.</p>
<figure id="attachment_72169" aria-describedby="caption-attachment-72169" style="width: 640px" class="wp-caption alignnone"><a href="https://news.sophos.com/wp-content/uploads/2021/01/Botinstalled.png"><img loading="lazy" class="size-full wp-image-72169" src="https://news.sophos.com/wp-content/uploads/2021/01/Botinstalled.png" alt="" width="640" height="282" srcset="https://news.sophos.com/wp-content/uploads/2021/01/Botinstalled.png 912w, https://news.sophos.com/wp-content/uploads/2021/01/Botinstalled.png?resize=300,132 300w, https://news.sophos.com/wp-content/uploads/2021/01/Botinstalled.png?resize=768,339 768w" sizes="(max-width: 640px) 100vw, 640px" /></a><figcaption id="caption-attachment-72169" class="wp-caption-text">The reversed Agent Tesla code that sends an HTTP ACK message to signal installation of the malware.</figcaption></figure>
<p>The setting also enables a timer that sends empty HTTP messages each time it is triggered to keep the session with the C2 server active, and another timer that periodically checks to see if the malware&#8217;s operator has issued a command that it should uninstall itself from the infected system.</p>
<figure id="attachment_72170" aria-describedby="caption-attachment-72170" style="width: 640px" class="wp-caption alignnone"><a href="https://news.sophos.com/wp-content/uploads/2021/01/keepalive.png"><img loading="lazy" class="size-full wp-image-72170" src="https://news.sophos.com/wp-content/uploads/2021/01/keepalive.png" alt="" width="640" height="187" srcset="https://news.sophos.com/wp-content/uploads/2021/01/keepalive.png 974w, https://news.sophos.com/wp-content/uploads/2021/01/keepalive.png?resize=300,88 300w, https://news.sophos.com/wp-content/uploads/2021/01/keepalive.png?resize=768,225 768w" sizes="(max-width: 640px) 100vw, 640px" /></a><figcaption id="caption-attachment-72170" class="wp-caption-text">The &#8220;keepalive&#8221; code that sends periodic empty messages to the Agent Tesla C2 server.</figcaption></figure>
<p>&nbsp;</p>
<figure id="attachment_72161" aria-describedby="caption-attachment-72161" style="width: 640px" class="wp-caption alignnone"><a href="https://news.sophos.com/wp-content/uploads/2021/01/uninstall.png"><img loading="lazy" class="size-full wp-image-72161" src="https://news.sophos.com/wp-content/uploads/2021/01/uninstall.png" alt="" width="640" height="209" srcset="https://news.sophos.com/wp-content/uploads/2021/01/uninstall.png 974w, https://news.sophos.com/wp-content/uploads/2021/01/uninstall.png?resize=300,98 300w, https://news.sophos.com/wp-content/uploads/2021/01/uninstall.png?resize=768,251 768w" sizes="(max-width: 640px) 100vw, 640px" /></a><figcaption id="caption-attachment-72161" class="wp-caption-text">Reversed uninstall code in Agent Tesla.</figcaption></figure>
<p>The HTTP C2 channel is also the only one that encrypts its content. While it does not inherently use HTTPS, the content of the C2 traffic is Triple DES encrypted, using a key set in the configuration file.</p>
<p>Agent Tesla v3 adds another enhancement to HTTP communications—the alternative of using a Tor proxy. If selected in the configuration file, the malware downloads and installs a Tor client from the official Tor site. If the Tor client is already present, it kills the process before installing the new one, and writes a <strong>torrc</strong> configuration file from encrypted strings hardcoded into the malware.</p>
<figure id="attachment_72225" aria-describedby="caption-attachment-72225" style="width: 640px" class="wp-caption alignnone"><a href="https://news.sophos.com/wp-content/uploads/2021/01/c2_tor.png"><img loading="lazy" class="size-full wp-image-72225" src="https://news.sophos.com/wp-content/uploads/2021/01/c2_tor.png" alt="" width="640" height="80" srcset="https://news.sophos.com/wp-content/uploads/2021/01/c2_tor.png 1217w, https://news.sophos.com/wp-content/uploads/2021/01/c2_tor.png?resize=300,37 300w, https://news.sophos.com/wp-content/uploads/2021/01/c2_tor.png?resize=768,96 768w, https://news.sophos.com/wp-content/uploads/2021/01/c2_tor.png?resize=1024,128 1024w" sizes="(max-width: 640px) 100vw, 640px" /></a><figcaption id="caption-attachment-72225" class="wp-caption-text">Code in Agent Tesla v3 that retrieves a Tor client.</figcaption></figure>
<h3></h3>
<h3>Setting malware persistence</h3>
<p>If the malware&#8217;s operator has set the persistence to &#8220;true&#8221; in the configuration, the malware copies itself to a folder and sets that folder&#8217;s attributes to &#8220;Hidden&#8221; and &#8220;System&#8221; in order to conceal it from view in Windows Explorer. It also puts the installation folder path into the Windows Registry&#8217;s <strong>SOFTWARE\Microsoft\Windows\CurrentVersion\Run</strong>  and <strong>SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\StartupApproved\Run</strong> keys.</p>
<figure id="attachment_72137" aria-describedby="caption-attachment-72137" style="width: 640px" class="wp-caption alignnone"><a href="https://news.sophos.com/wp-content/uploads/2021/01/Persistence_code.png"><img loading="lazy" class="size-full wp-image-72137" src="https://news.sophos.com/wp-content/uploads/2021/01/Persistence_code.png" alt="" width="640" height="258" srcset="https://news.sophos.com/wp-content/uploads/2021/01/Persistence_code.png 974w, https://news.sophos.com/wp-content/uploads/2021/01/Persistence_code.png?resize=300,121 300w, https://news.sophos.com/wp-content/uploads/2021/01/Persistence_code.png?resize=768,310 768w" sizes="(max-width: 640px) 100vw, 640px" /></a><figcaption id="caption-attachment-72137" class="wp-caption-text">A snippet of reversed code from Agent Tesla showing how the RAT establishes persistence on an infected WIndows system.</figcaption></figure>
<h3>Taking fingerprints</h3>
<p>In Agent Tesla v3, the same variable that enables persistence also triggers collection of the infected system&#8217;s external IP address—one  data point the malware uses to fingerprint its host for identification by its operator. The malware does this by using the public web API of ipify<a class="external-link" href="https://www.ipify.org/" rel="nofollow">.</a>org.</p>
<figure id="attachment_72189" aria-describedby="caption-attachment-72189" style="width: 640px" class="wp-caption alignnone"><a href="https://news.sophos.com/wp-content/uploads/2021/01/Characteristics_ExternalIP.png"><img loading="lazy" class="size-full wp-image-72189" src="https://news.sophos.com/wp-content/uploads/2021/01/Characteristics_ExternalIP.png" alt="" width="640" height="272" srcset="https://news.sophos.com/wp-content/uploads/2021/01/Characteristics_ExternalIP.png 1251w, https://news.sophos.com/wp-content/uploads/2021/01/Characteristics_ExternalIP.png?resize=300,127 300w, https://news.sophos.com/wp-content/uploads/2021/01/Characteristics_ExternalIP.png?resize=768,326 768w, https://news.sophos.com/wp-content/uploads/2021/01/Characteristics_ExternalIP.png?resize=1024,435 1024w" sizes="(max-width: 640px) 100vw, 640px" /></a><figcaption id="caption-attachment-72189" class="wp-caption-text">Code in Agent Tesla v3 that obtains the host&#8217;s external IP address.</figcaption></figure>
<p>Other than the IP address, the fingerprinting data Agent Tesla v3 collects is the same as that in v2:</p>
<ul>
<li>Processor name (taken from the Windows Management Interface&#8217;s <a href="https://docs.microsoft.com/en-us/windows/win32/cimwin32prov/win32-processor">Win32_Processor.Name </a>class)</li>
<li>Total memory (via .NET&#8217;s <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.visualbasic.devices.computerinfo.totalphysicalmemory?view=net-5.0">ComputerInfo().TotalPhysicalMemory</a>)</li>
<li>Operating System (with .NET&#8217;s <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.visualbasic.devices.computerinfo.osfullname?view=net-5.0">ComputerInfo().OSFullName</a>)</li>
<li>User name (with .NET&#8217;s <a href="https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.systeminformation.username?view=net-5.0">SystemInformation.UserName</a> property)</li>
<li>Computer name (with .NET&#8217;s<a href="https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.systeminformation.computername?view=net-5.0"> SystemInformation.ComputerName</a> property)</li>
<li>Current date and time (with .NET&#8217;s <a href="https://docs.microsoft.com/en-us/dotnet/api/system.datetime.now?view=net-5.0">DateTime.Now</a>)</li>
</ul>
<figure id="attachment_72188" aria-describedby="caption-attachment-72188" style="width: 562px" class="wp-caption alignnone"><a href="https://news.sophos.com/wp-content/uploads/2021/01/HostFingerPrint_1.png"><img loading="lazy" class="wp-image-72188 size-full" src="https://news.sophos.com/wp-content/uploads/2021/01/HostFingerPrint_1.png" alt="" width="562" height="522" srcset="https://news.sophos.com/wp-content/uploads/2021/01/HostFingerPrint_1.png 562w, https://news.sophos.com/wp-content/uploads/2021/01/HostFingerPrint_1.png?resize=300,279 300w" sizes="(max-width: 562px) 100vw, 562px" /></a><figcaption id="caption-attachment-72188" class="wp-caption-text">Reversed code from Agent Telsa&#8217;s host fingerprinting function.</figcaption></figure>
<h3>Stealing the keys</h3>
<p>Agent Tesla gathers user credentials. In Agent Tesla v3, the number of applications targeted for credential harvesting has been expanded considerably—the current list of applications targeted includes, but is not limited to:</p>
<ul>
<li>Opera Browser</li>
<li>Yandex Browser</li>
<li>Chromium</li>
<li>Chrome</li>
<li>Firefox</li>
<li>OpenVPN</li>
<li>FTPNavigator</li>
<li>WinSCP</li>
<li>OperaMail</li>
<li>Outlook</li>
<li>SmartFTP</li>
<li>WinVNC4</li>
</ul>
<p>Agent Tesla bundles the stolen credentials with the host fingerprint data, and transmits them back to the C2 once during execution. The malware doesn&#8217;t repeat this process unless it has been configured for persistence and the infected system restarts.</p>
<p>The credential-stealing function also includes code which launches a separate thread to exfiltrate browser cookies. While this code is present in all the samples of Agent Tesla from both v2 and v3, it isn&#8217;t always used. Also, this feature is not set from the configuration file—so, perhaps, it&#8217;s a premium feature attackers must buy from Agent Tesla&#8217;s developer.</p>
<h3>Screenshot exfiltration</h3>
<p>If this option is enabled, a timer is initialized that captures an image of the infected system&#8217;s screen via .NET libraries.</p>
<figure id="attachment_72191" aria-describedby="caption-attachment-72191" style="width: 640px" class="wp-caption alignnone"><a href="https://news.sophos.com/wp-content/uploads/2021/01/Characteristics_Screenshots.png"><img loading="lazy" class="size-full wp-image-72191" src="https://news.sophos.com/wp-content/uploads/2021/01/Characteristics_Screenshots.png" alt="" width="640" height="318" srcset="https://news.sophos.com/wp-content/uploads/2021/01/Characteristics_Screenshots.png 893w, https://news.sophos.com/wp-content/uploads/2021/01/Characteristics_Screenshots.png?resize=300,149 300w, https://news.sophos.com/wp-content/uploads/2021/01/Characteristics_Screenshots.png?resize=768,382 768w" sizes="(max-width: 640px) 100vw, 640px" /></a><figcaption id="caption-attachment-72191" class="wp-caption-text">Agent Tesla&#8217;s screenshot code relies on .NET libraries.</figcaption></figure>
<p>The  function then sends the image to the C2 as JPEG images over the configured network protocol. As with the keyboard capture dumps, this routine is also initialized on a timer.</p>
<figure id="attachment_72163" aria-describedby="caption-attachment-72163" style="width: 640px" class="wp-caption alignnone"><a href="https://news.sophos.com/wp-content/uploads/2021/01/screenshot_timer.png"><img loading="lazy" class="size-full wp-image-72163" src="https://news.sophos.com/wp-content/uploads/2021/01/screenshot_timer.png" alt="" width="640" height="250" srcset="https://news.sophos.com/wp-content/uploads/2021/01/screenshot_timer.png 974w, https://news.sophos.com/wp-content/uploads/2021/01/screenshot_timer.png?resize=300,117 300w, https://news.sophos.com/wp-content/uploads/2021/01/screenshot_timer.png?resize=768,300 768w" sizes="(max-width: 640px) 100vw, 640px" /></a><figcaption id="caption-attachment-72163" class="wp-caption-text">The screenshot exfiltration code in Agent Tesla.</figcaption></figure>
<h3>Keystroke capture</h3>
<p>If the hookkeyboard setting is enabled, the malware records all keystrokes and periodically sends the logs to the C2 server on a schedule. In Agent Telsa v3, the developers can now capture data from the Windows clipboard; this data is sent back to the C2 by the same timer.</p>
<figure id="attachment_72171" aria-describedby="caption-attachment-72171" style="width: 640px" class="wp-caption alignnone"><a href="https://news.sophos.com/wp-content/uploads/2021/01/keyboardhook.png"><img loading="lazy" class="wp-image-72171 size-full" src="https://news.sophos.com/wp-content/uploads/2021/01/keyboardhook.png" alt="" width="640" height="216" srcset="https://news.sophos.com/wp-content/uploads/2021/01/keyboardhook.png 974w, https://news.sophos.com/wp-content/uploads/2021/01/keyboardhook.png?resize=300,101 300w, https://news.sophos.com/wp-content/uploads/2021/01/keyboardhook.png?resize=768,259 768w" sizes="(max-width: 640px) 100vw, 640px" /></a><figcaption id="caption-attachment-72171" class="wp-caption-text">Keyboard log exfiltration code in Agent Tesla.</figcaption></figure>
<h3>Insulating from attack</h3>
<p>The most common delivery method for Agent Tesla is malicious spam—such as the emails we highlighted in our RATicate research. Agent Tesla remains a consistent threat—for many months, it has remained among the top families of malware in malicious attachments caught by Sophos. <span style="font-size: 1em">Because of this sustained stream of Agent Tesla attacks, we believe that the malware will continue to be updated and modified by its developers to evade endpoint and email protection tools.</span></p>
<p>The email accounts used to spread Agent Tesla are often legitimate accounts that have been compromised. Organizations and individuals should, as always, treat email attachments from unknown senders with caution, and verify attachments before opening them. Sophos endpoint protection detects Agent Tesla&#8217;s installer malware and the RAT itself, both through machine learning and detection signatures, and protects against AMSI bypass attacks by preventing removal of AMSI registration. Indicators of compromise for Agent Tesla are posted on <a href="https://github.com/sophoslabs/IoCs/blob/master/Troj-AgentTesla.csv">SophosLabs&#8217; GitHub page</a>.</p>
<h4>SophosLabs would like to acknowledge Sivagnanam Gn and Michael Wood for their contributions to this report.</h4>
			</div><!-- .entry-content -->

</article><!-- #post-## -->

					<nav class="navigation post-navigation" role="navigation">
			<h2 class="screen-reader-text">Post navigation</h2>
			<div class="nav-links">
	   			<div class="nav-previous">
											<span class="nav-label">Prev</span>
						<a href="https://news.sophos.com/en-us/2021/01/26/nefilim-ransomware-attack-uses-ghost-credentials/" rel="prev">Nefilim Ransomware Attack Uses “Ghost” Credentials</a>
						   			</div>
	   			<div class="nav-next">
											<span class="nav-label">Next</span>
						<a href="https://news.sophos.com/en-us/2021/02/02/sophos-zero-trust-network-access-ztna-is-coming-soon/" rel="next">Sophos zero trust network access (ZTNA) is coming soon</a>
						   			</div>
		 	</div><!-- .nav-links -->
		</nav><!-- .navigation -->
		
			<div class="article-author-block article-co-authors-block">
	
					<h2 class="author-title">
				About the Authors			</h2>
		
					<div class="author-block-container">
				<div class="author-profile">
					<img width="145" height="145" src="https://news.sophos.com/wp-content/uploads/2020/02/sean-gallagher.jpg?w=145" class="avatar avatar-145 photo wp-post-image" alt="Sean Gallagher" />				</div> <!-- .author-profile -->

				<div class="author-description">
					<h3 class="author-name"><a href="https://news.sophos.com/en-us/author/sean-gallagher/" title="Posts by Sean Gallagher" class="author url fn" rel="author">Sean Gallagher</a></h3>

					
					<div class="author-bio">
						<p>Sean Gallagher is a Senior Threat Researcher at Sophos. </p>
<p>Previously, Gallagher was IT and National Security Editor at Ars Technica, where he focused on information security and digital privacy issues, cybercrime, cyber espionage and cyber warfare. He has been a security researcher, technology journalist and information technology practitioner for over 20 years.</p>
					</div> <!-- .author-bio -->
				</div> <!-- .author-description -->
			</div> <!-- .author-block-container -->
					<div class="author-block-container">
				<div class="author-profile">
					<img width="145" height="145" src="https://news.sophos.com/wp-content/uploads/2020/03/d00rt.jpg?w=145" class="avatar avatar-145 photo wp-post-image" alt="d00rt" />				</div> <!-- .author-profile -->

				<div class="author-description">
					<h3 class="author-name"><a href="https://news.sophos.com/en-us/author/markel-picado/" title="Posts by Markel Picado" class="author url fn" rel="author">Markel Picado</a></h3>

					
					<div class="author-bio">
						<p>Threat Researcher at SophosLabs. Working in Dynamic Protection Team analyzing and detecting new threats. I like bot emulation, automatic detection, obfuscation and botnet tracking. - "If it can be opened with a debugger then I like it." Twitter: @D00RT_RM</p>
					</div> <!-- .author-bio -->
				</div> <!-- .author-description -->
			</div> <!-- .author-block-container -->
			</div>

			
<div id="comments" class="comments-area">

	
	
	
		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/en-us/2021/02/02/agent-tesla-amps-up-information-stealing-attacks/#respond" style="display:none;">Cancel reply</a></small></h3><form action="https://news.sophos.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><p class="comment-notes"><span id="email-notes">Your email address will not be published.</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" /></p>
<p class="comment-form-email"><label for="email">Email</label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" aria-describedby="email-notes" /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p>
<p class="comment-form-cookies-consent"><input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox" value="yes" /> <label for="wp-comment-cookies-consent">Save my name, email, and website in this browser for the next time I comment.</label></p>
<input type="hidden" name="redirect_to" value="https://news.sophos.com/en-us/2021/02/02/agent-tesla-amps-up-information-stealing-attacks/" id="redirect_to"><p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='72064' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="790b52bc91" /></p><input type="hidden" id="ak_js" name="ak_js" value="7"/><textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100" style="display: none !important;"></textarea></form>	</div><!-- #respond -->
	
</div><!-- #comments -->

		
		</main><!-- #main -->
	</div><!-- #primary -->


<div id="secondary" class="widget-area" role="complementary">
			
		<div id="second-article-wrapper" class="article-wrapper">
			<h3 class="widget-title">You might also enjoy...</h3>
			<article id="post-71298" class="second-featured post-71298 post type-post status-publish format-standard has-post-thumbnail hentry category-sophoslabs-uncut tag-malware-as-a-service tag-systembc region-en-us">
	<div class="second-featured__image" style="background-image: url('https://news.sophos.com/wp-content/uploads/2020/12/tv-remote-e1607983796505.jpg?w=640');">
		<div class="featured-entry-meta">
			<div class="featured-entry-date">
				<span class="day-num">16</span>
				<span class="month">Dec</span>
			</div>
		</div>
	</div>
	<div class="second-featured__content">
		<header class="featured-entry-header">
			<div class="featured-entry-categories">
					<a href="https://news.sophos.com/en-us/category/sophoslabs/sophoslabs-uncut/">SophosLabs Uncut</a>			</div>
			<h1 class="featured-entry-title dot-ellipsis dot-resize-update dot-load-update dot-height-130"><a href="https://news.sophos.com/en-us/2020/12/16/systembc/" rel="bookmark">Ransomware operators use SystemBC RAT as off-the-shelf Tor backdoor</a></h1>		</header> <!-- featured-entry-header -->
	</div>
</article> <!-- post -->
<article id="post-69522" class="second-featured post-69522 post type-post status-publish format-standard has-post-thumbnail hentry category-sophoslabs-uncut tag-dll-injection tag-fileless tag-fileless-malware tag-modi-rat tag-reflective-loader tag-scripted-attack tag-vbe region-en-us">
	<div class="second-featured__image" style="background-image: url('https://news.sophos.com/wp-content/uploads/2020/09/modirat_featured.png?w=640');">
		<div class="featured-entry-meta">
			<div class="featured-entry-date">
				<span class="day-num">24</span>
				<span class="month">Sep</span>
			</div>
		</div>
	</div>
	<div class="second-featured__content">
		<header class="featured-entry-header">
			<div class="featured-entry-categories">
					<a href="https://news.sophos.com/en-us/category/sophoslabs/sophoslabs-uncut/">SophosLabs Uncut</a>			</div>
			<h1 class="featured-entry-title dot-ellipsis dot-resize-update dot-load-update dot-height-130"><a href="https://news.sophos.com/en-us/2020/09/24/email-delivered-modi-rat-attack-pastes-powershell-commands/" rel="bookmark">Email-delivered MoDi RAT attack pastes PowerShell commands</a></h1>		</header> <!-- featured-entry-header -->
	</div>
</article> <!-- post -->
<article id="post-67415" class="second-featured post-67415 post type-post status-publish format-standard has-post-thumbnail hentry category-sophoslabs-uncut tag-cloudeye tag-darkeye tag-darkeye-protector tag-maas tag-malware-as-as-service tag-nsis tag-raas tag-rat tag-rat-as-as-service tag-raticate tag-trojan region-en-us">
	<div class="second-featured__image" style="background-image: url('https://news.sophos.com/wp-content/uploads/2020/06/ratsnest.jpg?w=640');">
		<div class="featured-entry-meta">
			<div class="featured-entry-date">
				<span class="day-num">14</span>
				<span class="month">Jul</span>
			</div>
		</div>
	</div>
	<div class="second-featured__content">
		<header class="featured-entry-header">
			<div class="featured-entry-categories">
					<a href="https://news.sophos.com/en-us/category/sophoslabs/sophoslabs-uncut/">SophosLabs Uncut</a>			</div>
			<h1 class="featured-entry-title dot-ellipsis dot-resize-update dot-load-update dot-height-130"><a href="https://news.sophos.com/en-us/2020/07/14/raticate-rats-as-service-with-commercial-crypter/" rel="bookmark">RATicate upgrades &#8220;RATs as a Service&#8221; attacks with commercial &#8220;crypter&#8221;</a></h1>		</header> <!-- featured-entry-header -->
	</div>
</article> <!-- post -->
<article id="post-65442" class="second-featured post-65442 post type-post status-publish format-standard has-post-thumbnail hentry category-sophoslabs-uncut tag-infostealers tag-malware-analysis tag-raticate tag-remote-administration-tools region-en-us">
	<div class="second-featured__image" style="background-image: url('https://news.sophos.com/wp-content/uploads/2020/05/rattttt-e1589403726555.jpg?w=640');">
		<div class="featured-entry-meta">
			<div class="featured-entry-date">
				<span class="day-num">14</span>
				<span class="month">May</span>
			</div>
		</div>
	</div>
	<div class="second-featured__content">
		<header class="featured-entry-header">
			<div class="featured-entry-categories">
					<a href="https://news.sophos.com/en-us/category/sophoslabs/sophoslabs-uncut/">SophosLabs Uncut</a>			</div>
			<h1 class="featured-entry-title dot-ellipsis dot-resize-update dot-load-update dot-height-130"><a href="https://news.sophos.com/en-us/2020/05/14/raticate/" rel="bookmark">RATicate: an attacker&#8217;s waves of information-stealing malware</a></h1>		</header> <!-- featured-entry-header -->
	</div>
</article> <!-- post -->
		</div>

	</div> <!-- #secondary -->


		</div> <!-- .container -->
	</div> <!-- #content -->
	<footer>
		<section class="cta">
			<p>Start a Sophos demo in less than a minute. See exactly how our solutions work in a full environment without a commitment.</p>
			<a href="https://secure2.sophos.com/en-us/products/demos.aspx?cmp=70130000001xKqzAAE">Learn More</a>
		</section>
		<section class="connected">
			<div class="social">
				<h3>Stay Connected</h3>
				<ul>
					<li><a href="https://www.facebook.com/securitybysophos" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/facebook-icon.svg?la=en&amp;hash=1CA0A5A0E9C9999E7E079A5D32C86E9BF9C7AD1E" alt="Facebook"></a>
					</li>
					<li><a href="https://www.instagram.com/sophossecurity/" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/instagram-icon.svg?la=en&amp;hash=2B50C2B67C3023D9E7D4E1C3A16401EAD8F10F76" alt="Instagram"></a>
					</li>
					<li><a href="https://www.linkedin.com/company/sophos" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/linkedin-icon.svg?la=en&amp;hash=B6D5378C1E1A16F239A4C862EAE3499B8EC1F3F9" alt="LinkedIn"></a></li>
					<li><a href="https://www.sophos.com/en-us/company/rss-feeds.aspx"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/rss-icon.svg?la=en&amp;hash=76C4DAFD331DC675814191A66794A778D8C6DCF7" alt="RSS"></a></li>
					<li><a href="https://twitter.com/Sophos" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/twitter-icon.svg?la=en&amp;hash=9A90D9F99ABE6454741BBAAF9C3FB6966624C92D" alt="Twitter"></a></li>
					<li><a href="https://www.youtube.com/user/SophosProducts" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/youtube-icon.svg?la=en&amp;hash=CCCF647AFA78C8DB74D654DB9FEFBF0AC54F42D3" alt="YouTube"></a></li>
				</ul>
			</div>
			<ul class="links">
				<li><a href="https://www.sophos.com/en-us/company/careers.aspx">Careers </a></li>
				<li><a href="https://www.sophos.com/en-us/partners/partner-locator.aspx">Find a Partner</a></li>
				<li><a href="https://secure2.sophos.com/en-us/support.aspx">Support</a></li>
				<li><a href="https://www.sophos.com/en-us/threat-center/technical-papers.aspx">Technical Papers</a></li>
				<li><a href="https://www.sophos.com/en-us/security-news-trends/whitepapers.aspx">Whitepapers</a></li>
			</ul>
		</section>
		<section class="legal">
			<div class="copyright">&copy; 1997 - 2021 Sophos Ltd. All rights reserved</div>
			<ul>
				<li><a href="https://www.sophos.com/en-us/legal.aspx">Legal</a></li>
				<li><a href="https://www.sophos.com/en-us/legal/sophos-group-privacy-policy.aspx">Privacy</a></li>
				<li><a href="https://www.sophos.com/en-us/legal/cookie-information.aspx">Cookie Information</a></li>
				<li><a href="https://www.sophos.com/en-us/legal/modern-slavery-act-transparency-statement.aspx">Modern Slavery Statement</a></li>
			</ul>
		</section>
		<div class="vip" style="background: #002939">
			Powered by <a href="https://wpvip.com/?utm_source=vip_powered_wpcom&#038;utm_medium=web&#038;utm_campaign=VIP%20Footer%20Credit&#038;utm_term=news.sophos.com" rel="generator nofollow" class="powered-by-wpcom">WordPress VIP</a>		</div>
	</footer>
	<script id='sophos-js-core-js-extra'>
var PG8Data = {"startPage":"1","maxPages":"1","nextLink":""};
</script>
<script type='text/javascript' src='https://news.sophos.com/_static/??-eJyVkEEOwiAQRS8kIF20K+NRDLZjS8sAYcDq7R3TNHHhomTY8Hnvk4xao+iDz+CzyhMgkKIQp0AeVhLNWXdqJj4MhcWCeDaykZoDuQVyppM61NGHVEHDKydDx/ktkiVbV2/1BqOxo68Wo0nZQ6r2RlOtfLNdsr53ZQDa1orIBSJBdG+J1v+D+Ap4h+H3ff8Zi4iujNaTMoslhKxu7KpHSMjsFS+65em0PrfzB20wygw='></script>
<script src='https://stats.wp.com/e-202112.js' defer></script>
<script>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:9.5.2',blog:'166161023',post:'72064',tz:'-4',srv:'news.sophos.com'} ]);
	_stq.push([ 'clickTrackerInit', '166161023', '72064' ]);
</script>
</body>
</html>
