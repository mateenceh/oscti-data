
<!doctype html>
<html >
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-16x16.png">
	<link rel="manifest" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/site.webmanifest">
	<link rel="mask-icon" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/safari-pinned-tab.svg" color="#000000">
	<meta name="msapplication-TileColor" content="#000000">
	<meta name="theme-color" content="#000">
  <link rel="alternate" hreflang="en" href="https://unit42.paloaltonetworks.com/aws-resource-based-policy-apis/" />
<link rel="alternate" hreflang="ja" href="https://unit42.paloaltonetworks.jp/aws-resource-based-policy-apis/" />

	<!-- This site is optimized with the Yoast SEO plugin v15.2.1 - https://yoast.com/wordpress/plugins/seo/ -->
	<title>Information Leakage in AWS Resource-Based Policy APIs</title>
	<meta name="description" content="Researchers confirmed that 22 resource-based policy APIs across 16 different AWS services could be abused." />
	<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
	<link rel="canonical" href="https://unit42.paloaltonetworks.com/aws-resource-based-policy-apis/" />
	<meta property="og:locale" content="en_US" />
	<meta property="og:type" content="article" />
	<meta property="og:title" content="Information Leakage in AWS Resource-Based Policy APIs" />
	<meta property="og:description" content="Researchers confirmed that 22 resource-based policy APIs across 16 different AWS services could be abused." />
	<meta property="og:url" content="https://unit42.paloaltonetworks.com/aws-resource-based-policy-apis/" />
	<meta property="og:site_name" content="Unit42" />
	<meta property="article:published_time" content="2020-11-17T11:00:16+00:00" />
	<meta property="article:modified_time" content="2020-11-17T20:10:37+00:00" />
	<meta property="og:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/11/Cloud-providers.png" />
	<meta property="og:image:width" content="2001" />
	<meta property="og:image:height" content="1001" />
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:label1" content="Written by">
	<meta name="twitter:data1" content="Jay Chen">
	<meta name="twitter:label2" content="Est. reading time">
	<meta name="twitter:data2" content="6 minutes">
	<script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://unit42.paloaltonetworks.jp/#website","url":"https://unit42.paloaltonetworks.jp/","name":"Unit42","description":"Palo Alto Networks","potentialAction":[{"@type":"SearchAction","target":"https://unit42.paloaltonetworks.jp/?s={search_term_string}","query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"ImageObject","@id":"https://unit42.paloaltonetworks.com/aws-resource-based-policy-apis/#primaryimage","inLanguage":"en-US","url":"https://unit42.paloaltonetworks.com/wp-content/uploads/2020/11/Cloud-providers.png","width":2001,"height":1001,"caption":"This conceptual image illustrates some of the security and configuration issues involved with the cloud, such as the issue with AWS resource-based policy APIs discussed here."},{"@type":"WebPage","@id":"https://unit42.paloaltonetworks.com/aws-resource-based-policy-apis/#webpage","url":"https://unit42.paloaltonetworks.com/aws-resource-based-policy-apis/","name":"Information Leakage in AWS Resource-Based Policy APIs","isPartOf":{"@id":"https://unit42.paloaltonetworks.jp/#website"},"primaryImageOfPage":{"@id":"https://unit42.paloaltonetworks.com/aws-resource-based-policy-apis/#primaryimage"},"datePublished":"2020-11-17T11:00:16+00:00","dateModified":"2020-11-17T20:10:37+00:00","author":{"@id":"https://unit42.paloaltonetworks.jp/#/schema/person/27238d87f1cf670e404250877a8e2b47"},"description":"Researchers confirmed that 22 resource-based policy APIs across 16 different AWS services could be abused.","inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://unit42.paloaltonetworks.com/aws-resource-based-policy-apis/"]}]},{"@type":"Person","@id":"https://unit42.paloaltonetworks.jp/#/schema/person/27238d87f1cf670e404250877a8e2b47","name":"Jay Chen","image":{"@type":"ImageObject","@id":"https://unit42.paloaltonetworks.jp/#personlogo","inLanguage":"en-US","url":"https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg","caption":"Jay Chen"}}]}</script>
	<!-- / Yoast SEO plugin. -->


<link rel='dns-prefetch' href='//www.google.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Unit42 &raquo; Information Leakage in AWS Resource-Based Policy APIs Comments Feed" href="https://unit42.paloaltonetworks.com/aws-resource-based-policy-apis/feed/" />
<meta property="og:likes" content="5"/>
<meta property="og:readtime" content="6"/>
<meta property="og:views" content="3,609"/>
<meta property="og:date_created" content="November 17, 2020 at 3:00 AM"/>
<meta property="og:post_length" content="1418"/>
<meta property="og:category" content="Unit 42"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/unit-42/"/>
<meta property="og:author" content="Jay Chen"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/jaychenpaloaltonetworks-com/"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<meta property="og:post_image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/11/Cloud-providers.png"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"BlogPosting","headline":"Information Leakage in AWS Resource-Based Policy APIs","name":"Information Leakage in AWS Resource-Based Policy APIs","description":"Researchers confirmed that 22 resource-based policy APIs across 16 different AWS services could be abused.","url":"https:\/\/unit42.paloaltonetworks.com\/aws-resource-based-policy-apis\/","mainEntityOfPage":"https:\/\/unit42.paloaltonetworks.com\/aws-resource-based-policy-apis\/","datePublished":"November 17, 2020","articleBody":"Executive Summary\r\nUnit 42 researchers discovered a class of Amazon Web Services (AWS) APIs that can be abused to leak the AWS Identity and Access Management (IAM) users and roles in arbitrary accounts. Researchers confirmed that 22 APIs across 16 different AWS services could be abused the same way and the exploit works across all three AWS partitions (aws, aws-us-gov or aws-cn). AWS services that can be potentially abused by attackers include Amazon Simple Storage Service (S3), Amazon Key Management Service (KMS) and Amazon Simple Queue Service (SQS). A malicious actor may obtain the roster of an account, learn the organization's internal structure and launch targeted attacks against individuals. In a recent Red Team exercise, Unit 42 researchers compromised a customer\u2019s cloud account with thousands of workloads using a misconfigured IAM role identified by this technique.\r\n\r\nThe root cause of the issue is that the AWS backend proactively validates all the resource-based policies attached to resources such as Amazon Simple Storage Service (S3) buckets and customer-managed keys. Resource-based policies usually include a Principal field that specifies the identities (users or roles) allowed to access the resource. If the policy contains a nonexistent identity, the API call that creates or updates the policy will fail with an error message. This convenient feature, however, can be abused to check whether an identity exists in an AWS account. Adversaries can repeatedly invoke these APIs with different principals to enumerate the users and roles in a targeted account. Furthermore, the targeted account can't observe the enumeration because the API logs and error messages only appear in the attacker's account where the resource policies are manipulated. The \"stealthy\" property of the technique makes detection and prevention difficult. Attackers can have unrestricted time to perform reconnaissance on random or targeted AWS accounts without worrying about being noticed.\r\nAWS Resource-Based Policy\r\nAWS IAM manages permissions between users, resources and applications using various types of policies. Resource-based policy is a type of policy attached to resources within an AWS service. Each AWS service can have multiple resources and each resource can be attached with a different policy. For example, an S3 service can create multiple bucket resources and the SQS service can create multiple message queue resources. At the time of this writing, there are 26 AWS services that support resource-based policies, as shown in Table 1. The policy determines the actions that principals can perform on the attached resource. A principal can be an AWS user, role or service. The actions that can be performed depend on the type of service.\r\n\r\n[caption id=\"attachment_109554\" align=\"aligncenter\" width=\"738\"] Figure 1. Resource-based policy illustration.[\/caption]\r\n\r\nFigure 2 is an example resource-based policy attached to an S3 bucket. Two principals are allowed to access the bucket, user \u201cBob\u201d in account 123456789012 and IAM role \u201cqa-role\u201d in account 98765431098. The principals can perform three actions, GetObject, GetBucketLocation and ListBucket on S3 bucket \u201cawsexamplebucket\u201d. Note that the principals do not need to be in the same account as the bucket, meaning that a policy can also grant cross-account access to resources.\r\n\r\nFigure 2 is the simplest form of a policy. A more complicated policy may consist of multiple statements and conditions. To avoid human errors, AWS validates every field in the policy before the policy can be applied to a resource. The validator ensures the specified principals actually exist and the specified actions are supported by the service. In Figure 2, an error message is raised because \u201cGetFiles\u201d is not a supported action.\r\n\r\n[caption id=\"attachment_109556\" align=\"aligncenter\" width=\"900\"] Figure 2. Example S3 bucket policy (left) and error message when an action is mis-specified (right).[\/caption]\r\nAbusing Resource-Based Policy APIs\r\nPolicy validation is a feature from AWS that facilitates the user experience. While most users benefit from the feature, adversaries may also find the feature useful for performing reconnaissance in another account. Because the policy validator checks whether the specified principal exists, it gives adversaries a way to build up knowledge of a targeted account's roster gradually. As we will show, adversaries may abuse policy validators in multiple AWS services that support resource-based policies.\r\n\r\nWhen defining a principal in a resource-based policy, users ask AWS to authenticate and authorize the principal to access the resources in an AWS account. If we provide an invalid username or role name, the authentication will fail. One of the authentication best practices for implementing a secure authentication process is to avoid giving out account-specific information in error messages.\r\n\r\nThe AWS policy validator inadvertently leaks account-specific information in the error messages. When creating or updating a resource policy, the AWS policy validator explicitly reveals if the specified principal exists or not. An adversary could use the error messages to check whether a user or an IAM role exists in a targeted account. By repeating this process with a wordlist, an adversary can enumerate and discover the existing identities in a targeted account. Figures 3 and 4 show the error messages when we specify a nonexistent IAM role in different AWS services' resource policies. These policies are rejected and can't be saved. The process can also be performed programmatically using AWS APIs, making the enumeration scalable.\r\n\r\nOne concerning property of this technique is that it is completely unobservable by the target or victim. When making changes to a resource policy, the AWS CloudTrail logs and error messages only appear in the resource owner or the attacker's account. The \"stealthy\" property makes detection and prevention almost impossible.\r\n\r\nA similar technique was first published in a blog by Rhino Security Labs, in which they used the IAM role trust policy to check whether a cross-account IAM role exists. Unit 42 researchers identified and confirmed that at least 22 APIs across 16 AWS services can be exploited, as shown in Table 1. The commonality between these APIs is that they all take a resource policy as input and the policy needs to have a valid \"Principal\" field.\r\n\r\n[caption id=\"attachment_109558\" align=\"aligncenter\" width=\"900\"] Figure 3. Resource policies with nonexistent principals. AWS SQS (left) and AWS SNS (right).[\/caption]\r\n\r\n[caption id=\"attachment_109560\" align=\"aligncenter\" width=\"900\"] Figure 4. Resource policies with nonexistent principals. AWS KMS (left) and AWS Glue (right).[\/caption]\r\nConclusion\r\nDetecting and preventing identity reconnaissance using this technique is difficult as there are no observable logs in the targeted accounts. However, good IAM security hygiene can still effectively mitigate the threats from this type of attack. Although it\u2019s not possible to prevent an attacker from enumerating identities in AWS accounts, the enumeration can be made more difficult and you can monitor for suspicious activities taken after the reconnaissance. To mitigate this issue, we recommend the following IAM security best practices for organizations:\r\n\r\n \tRemove inactive users and roles to reduce the attack surface.\r\n \tAdd random strings to usernames and role names to make them more difficult to guess.\r\n \tLog in with identity provider and federation, so that no additional users are created in the AWS account.\r\n \tLog and monitor all the identity authentication activities.\r\n \tEnable two-factor authentication (2FA) for every user and IAM role.\r\n\r\nAppendix\r\n\r\n\r\n\r\nAWS Service\r\nAPIs for Updating Resource Policies (Python Boto3)\r\nAPIs can be abused\r\n\r\n\r\nAmazon Elastic Container Registry (Amazon ECR)\r\nset_repository_policy()\r\nYes\r\n\r\n\r\nAmazon Elastic Inference\r\nconfigured via IAM\r\nNo\r\n\r\n\r\nAWS Lambda\r\nadd_permission()\r\nYes\r\n\r\n\r\nAWS Serverless Application Repository\r\nPrincipal must be an account ID\r\nNo\r\n\r\n\r\nAWS Backup\r\nput_backup_vault_access_policy()\r\nYes\r\n\r\n\r\nAmazon Elastic File System (Amazon EFS)\r\nput_file_system_policy()\r\nYes\r\n\r\n\r\nAmazon FSx\r\nconfigured via IAM\r\nNo\r\n\r\n\r\nAmazon S3 Glacier\r\nset_vault_access_policy()\r\nYes\r\n\r\n\r\nAmazon Simple Storage Service (Amazon S3)\r\nput_bucket_policy()\r\nYes\r\n\r\n\r\nAWS Cloud9\r\nconfigured via IAM\r\nNo\r\n\r\n\r\nAWS CodeBuild\r\nPolicy principal needs to be account number, OU or organization\r\nNo\r\n\r\n\r\nAWS Identity and Access Management (IAM)\r\ncreate_role()\r\nupdate_assume_role_policy()\r\nYes\r\n\r\n\r\nAWS Key Management Service (AWS KMS)\r\nput_key_policy()\r\nYes\r\n\r\n\r\nAWS Secrets Manager\r\nput_resource_policy()\r\n\r\nvalidate_resource_policy()\r\nYes\r\n\r\n\r\nAmazon CloudWatch Logs\r\nconfigured via IAM\r\nNo\r\n\r\n\r\nAWS Database Migration Service\r\nconfigured via KMS\r\nNo\r\n\r\n\r\nAmazon API Gateway\r\ncreate_rest_api()\r\n\r\nupdate_rest_api()\r\nYes\r\n\r\n\r\nTransit Gateway Network Manager\r\nconfigured via IAM\r\nNo\r\n\r\n\r\nAWS Elemental MediaLive\r\nconfigured via IAM\r\nNo\r\n\r\n\r\nAWS Elemental MediaStore\r\nput_container_policy()\r\nYes\r\n\r\n\r\nAmazon Elasticsearch Service\r\ncreate_elasticsearch_domain()\r\n\r\nupdate_elasticsearch_domain_config()\r\nYes\r\n\r\n\r\nAWS Glue\r\nput_resource_policy()\r\nYes\r\n\r\n\r\nAmazon Simple Notification Service (Amazon SNS)\r\ncreate_topic()\r\n\r\nset_topic_attributes()\r\nYes\r\n\r\n\r\nAmazon Simple Queue Service (Amazon SQS)\r\ncreate_queue()\r\n\r\nset_queue_attributes()\r\nYes\r\n\r\n\r\nAWS IoT\r\nconfigured via IAM\r\nNo\r\n\r\n\r\nAmazon Simple Email Service (Amazon SES)\r\nput_identity_policy()\r\nYes\r\n\r\n\r\n\r\nTable 1. AWS services that support resource-based policies. Unit 42 researchers identified 22 APIs across 16 AWS services that can be abused.\r\n\r\n&nbsp;","publisher":{"@type":"Organization","@id":"#panworg"},"image":{"@type":"ImageObject","url":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/uploads\/2020\/11\/Cloud-providers.png","width":150,"height":75},"author":[{"@type":"Person","name":"Jay Chen"}]}</script><link rel='stylesheet' id='crayon-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dist/block-library/style.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dashicons.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='post-views-counter-frontend-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/post-views-counter/css/frontend.css?ver=1.3.2' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-horizontal-list-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-list-horizontal/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-post-translations-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-post-translations/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/css/wpp.css?ver=5.2.4' type='text/css' media='all' />
<link rel='stylesheet' id='unit42/css-css'  href='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/styles/main.css' type='text/css' media='all' />
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='application/json' id="wpp-json">
{"sampling_active":0,"sampling_rate":100,"ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-json\/wordpress-popular-posts\/v1\/popular-posts","ID":109551,"token":"04f7cebd2d","lang":0,"debug":0}
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/js/wpp.min.js?ver=5.2.4'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpml_xdomain_data = {"css_selector":"wpml-ls-item","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","current_lang":"en"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/res/js/xdomain-data.js?ver=4.4.3'></script>
<link rel='https://api.w.org/' href='https://unit42.paloaltonetworks.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://unit42.paloaltonetworks.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://unit42.paloaltonetworks.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.4.1" />
<link rel='shortlink' href='https://unit42.paloaltonetworks.com/?p=109551' />
<link rel="alternate" type="application/json+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Faws-resource-based-policy-apis%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Faws-resource-based-policy-apis%2F&#038;format=xml" />
<meta name="generator" content="WPML ver:4.4.3 stt:1,28;" />
<meta name="google-site-verification" content="zHZtYOWm9hm4SZgsH7wqiYcOwmsAsxDUDU4UD1QxB40" /><style>#wpdevart_lb_overlay{background-color:#000000;} #wpdevart_lb_overlay.wpdevart_opacity{opacity:0.8 !important;} #wpdevart_lb_main_desc{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;} #wpdevart_lb_information_content{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;}
		#wpdevart_lb_information_content{
			width:100%;	
		}
		#wpdevart_info_counter_of_imgs{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_caption{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_title{
			    display: inline-block;
				padding-left:5px;
				padding-right:5px;
				font-size:15px;
				color:#000000;
		}
		@-webkit-keyframes rotate {
			to   {-webkit-transform: rotate(360deg);}
			from  {-webkit-transform: rotate(0deg);}
		}
		@keyframes rotate {
			to   {transform: rotate(360deg);}
			from  {transform: rotate(0deg);}
		}
		#wpdevart_lb_loading_img,#wpdevart_lb_loading_img_first{
			-webkit-animation: rotate 2s linear  infinite;
    		animation: rotate 2s linear infinite;
		}
	  </style>        <script>var $ = jQuery;</script>
  
  
<script type="text/javascript">
;(function(win, doc, style, timeout) {
var STYLE_ID = 'at-body-style';
function getParent() {
return doc.getElementsByTagName('head')[0];
}
function addStyle(parent, id, def) {
if (!parent) {
return;
}
var style = doc.createElement('style');
style.id = id;
style.innerHTML = def;
parent.appendChild(style);
}
function removeStyle(parent, id) {
if (!parent) {
return;
}
var style = doc.getElementById(id);
if (!style) {
return;
}
parent.removeChild(style);
}
addStyle(getParent(), STYLE_ID, style);
setTimeout(function() {
removeStyle(getParent(), STYLE_ID);
}, timeout);
}(window, document, "body {visibility:hidden !important}", 3000));
</script>

<script src="//assets.adobedtm.com/9273d4aedcd2/0d76ae0322d7/launch-425c423d843b.min.js" async></script>
<script type="text/javascript" src="https://www.paloaltonetworks.com/content/dam/pan/en_US/includes/attribution.js"></script>
  </head>
  <body class="post-template-default single single-post postid-109551 single-format-standard">
    <!--[if IE]>
      <div class="alert alert-warning">
        You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.      </div>
    <![endif]-->
    <header class="haeder py-15 position-relative z-index-2">
  <div class="container px-sm-30 px-35">
    <div class="row">
      <div class="first-logo col-sm-auto col-6 mb-sm-0 mb-40 text-sm-center order-1">
                  <a href="https://www.paloaltonetworks.com/">
<!--<img src="/wp-content/uploads/2019/07/paloaltonetwork.svg" class="attachment-full size-full" alt="" height="43" width="124" />-->
<svg width="140" height="26" viewBox="0 0 140 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M59.4802 4.69592C57.6721 4.69592 55.7937 5.18876 53.469 6.43377L54.7605 9.62741C56.7794 8.50019 58.447 8.00735 59.6682 8.00735C61.0538 8.00735 61.6644 8.52395 61.6644 9.20483V9.25133C61.6644 9.72143 61.2883 9.97974 60.3729 10.0738L58.7766 10.238C54.7843 10.6606 53.1404 12.3985 53.1404 14.7934V14.9577C53.1404 17.2359 55.0188 19.0203 57.6721 19.0203C59.4192 19.0203 60.937 18.2826 61.8597 16.9807L62.1572 18.7857H65.7734V10.5904C65.7734 6.71584 63.5428 4.69592 59.4802 4.69592ZM59.1279 15.8969C57.7899 15.8969 57.1555 15.3803 57.1555 14.5816V14.5351C57.1555 13.8305 57.5543 13.3139 59.0101 13.1031L59.6445 13.0091C60.5713 12.8799 61.1406 12.7095 61.6644 12.3923V13.4317C61.6644 15.0052 60.6777 15.8969 59.1279 15.8969Z" fill="white"/>
<path d="M25.4785 4.78994L20.8528 0.164276L16.2271 4.78994L18.5281 7.09192L6.92828 18.6917L11.5539 23.3174L16.1796 18.6917L13.8787 16.3908L25.4785 4.78994Z" fill="white"/>
<path d="M11.6001 0.164048L0 11.7642L4.62603 16.3902L16.2262 4.79008L11.6001 0.164048Z" fill="white"/>
<path d="M27.7794 7.09215L16.1793 18.6923L20.8053 23.3183L32.4054 11.7182L27.7794 7.09215Z" fill="white"/>
<path d="M72.231 0H68.1219V18.7857H72.231V0Z" fill="white"/>
<path d="M46.2366 4.69592C44.3685 4.69592 42.8683 5.52249 42.0428 6.81709L41.7287 4.93046H38.1125V23.4806H42.2215V17.051C43.0037 18.2567 44.4832 19.0193 46.2366 19.0193C49.5242 19.0193 52.2013 16.1077 52.2013 12.0916V11.6215C52.2013 7.60853 49.5242 4.69592 46.2366 4.69592ZM47.9744 11.9759C47.9744 14.0888 46.871 15.6159 45.0391 15.6159C43.2072 15.6159 42.1038 14.0898 42.1038 11.9759V11.7414C42.1038 9.62741 43.2072 8.10137 45.0391 8.10137C46.871 8.10137 47.9744 9.62741 47.9744 11.7414V11.9759Z" fill="white"/>
<path d="M127.672 4.69592C123.469 4.69592 120.51 7.6075 120.51 11.6236V12.0937C120.51 16.1087 123.469 19.0213 127.672 19.0213C131.875 19.0213 134.834 16.1097 134.834 12.0937V11.6236C134.834 7.60853 131.875 4.69592 127.672 4.69592ZM130.607 11.9759C130.607 14.0888 129.504 15.6159 127.672 15.6159C125.84 15.6159 124.736 14.0898 124.736 11.9759V11.7414C124.736 9.62741 125.84 8.10137 127.672 8.10137C129.504 8.10137 130.607 9.62741 130.607 11.7414V11.9759Z" fill="white"/>
<path d="M138.708 5.54211V5.47185C138.708 5.07304 138.404 4.79097 137.863 4.79097H136.924V6.9514H137.37V6.22299H137.866L138.239 6.9514H138.732L138.274 6.09694C138.552 6.01119 138.708 5.80248 138.708 5.54211ZM137.369 5.18979H137.862C138.144 5.18979 138.261 5.28381 138.261 5.49562V5.51938C138.261 5.70742 138.143 5.82418 137.862 5.82418H137.369V5.18979Z" fill="white"/>
<path d="M137.769 3.63998C136.502 3.63998 135.539 4.60293 135.539 5.87067C135.539 7.13842 136.502 8.10137 137.769 8.10137C139.037 8.10137 140 7.13842 140 5.87067C140 4.60293 139.037 3.63998 137.769 3.63998ZM137.769 7.79554C136.666 7.79554 135.867 6.99687 135.867 5.86964C135.867 4.74241 136.666 3.94375 137.769 3.94375C138.873 3.94375 139.671 4.74241 139.671 5.86964C139.671 6.99687 138.873 7.79554 137.769 7.79554Z" fill="white"/>
<path d="M108.416 0H104.307V18.7857H108.416V0Z" fill="white"/>
<path d="M116.518 15.6159C115.321 15.6159 114.874 15.029 114.874 13.7613V8.10137H119.712V4.93149H114.874V1.76058L110.765 2.37121V14.159C110.765 17.3765 112.409 19.0203 115.697 19.0203C117.153 19.0203 118.867 18.5739 120.276 17.7753L119.102 14.8637C118.279 15.31 117.129 15.6159 116.518 15.6159Z" fill="white"/>
<path d="M95.6662 4.69592C93.8581 4.69592 91.9797 5.18876 89.655 6.43377L90.9465 9.62741C92.9654 8.50019 94.633 8.00735 95.8542 8.00735C97.2397 8.00735 97.8504 8.52395 97.8504 9.20483V9.25133C97.8504 9.72143 97.4743 9.97974 96.5589 10.0738L94.9626 10.238C90.9702 10.6606 89.3264 12.3985 89.3264 14.7934V14.9577C89.3264 17.2359 91.2048 19.0203 93.8581 19.0203C95.6042 19.0203 97.123 18.2826 98.0456 16.9807L98.3432 18.7857H101.959V10.5904C101.959 6.71584 99.7287 4.69592 95.6662 4.69592ZM95.3138 15.8969C93.9748 15.8969 93.3415 15.3803 93.3415 14.5816V14.5351C93.3415 13.8305 93.7403 13.3139 95.1961 13.1031L95.8304 13.0091C96.7572 12.8799 97.3265 12.7095 97.8493 12.3923V13.4317C97.8493 15.0052 96.8637 15.8969 95.3138 15.8969Z" fill="white"/>
<path d="M81.225 4.69592C77.022 4.69592 74.0629 7.6075 74.0629 11.6236V12.0937C74.0629 16.1087 77.022 19.0213 81.225 19.0213C85.4281 19.0213 88.3872 16.1097 88.3872 12.0937V11.6236C88.3862 7.60853 85.4281 4.69592 81.225 4.69592ZM84.1593 11.9759C84.1593 14.0888 83.0559 15.6159 81.224 15.6159C79.3921 15.6159 78.2887 14.0898 78.2887 11.9759V11.7414C78.2887 9.62741 79.3921 8.10137 81.224 8.10137C83.0559 8.10137 84.1593 9.62741 84.1593 11.7414V11.9759Z" fill="white"/>
<path d="M98.0446 22.1168H99.0975L100.551 24.0334H100.566V22.1168H101.532V25.4964H100.513L99.0251 23.5313H99.0107V25.4964H98.0446V22.1168Z" fill="white"/>
<path d="M102.816 22.1168H105.771L105.81 22.9372H103.825V23.4011H105.385V24.1491H103.825V24.676H105.868L105.829 25.4964H102.816V22.1168Z" fill="white"/>
<path d="M107.925 22.9857H106.742L106.78 22.1168H110.088L110.127 22.9857H108.944V25.4964H107.925V22.9857Z" fill="white"/>
<path d="M110.943 22.1168H112.024L112.575 24.4632H112.628L113.342 22.1168H114.333L115.033 24.4632H115.086L115.627 22.1168H116.66L115.771 25.4964H114.444L113.826 23.4589H113.797L113.169 25.4964H111.836L110.943 22.1168Z" fill="white"/>
<path d="M117.404 23.8071C117.404 22.7057 118.152 22.0155 119.335 22.0155C120.518 22.0155 121.267 22.7057 121.267 23.8071C121.267 24.9085 120.519 25.5987 119.335 25.5987C118.152 25.5987 117.404 24.9075 117.404 23.8071ZM120.257 23.8071C120.257 23.2234 119.92 22.8752 119.335 22.8752C118.75 22.8752 118.412 23.2234 118.412 23.8071C118.412 24.3919 118.75 24.7391 119.33 24.7391C119.914 24.7391 120.257 24.3909 120.257 23.8071Z" fill="white"/>
<path d="M122.363 22.1168H124.334C125.231 22.1168 125.672 22.5414 125.672 23.3287C125.672 23.8691 125.449 24.2369 125.014 24.4105L125.816 25.4974H124.667L124.044 24.6089H123.378V25.4974H122.363V22.1168ZM124.202 23.8164C124.54 23.8164 124.661 23.6284 124.661 23.3721C124.661 23.1159 124.54 22.933 124.202 22.933H123.377V23.8164H124.202Z" fill="white"/>
<path d="M126.989 22.1168H128.002V23.3628H128.418L129.408 22.1168H130.547L130.552 22.1209L129.259 23.7389L130.625 25.4923L130.62 25.4964H129.437L128.414 24.1977H128.002V25.4964H126.989V22.1168Z" fill="white"/>
<path d="M131.402 25.2743V24.3475H131.407C131.972 24.6327 132.523 24.7721 133 24.7721C133.363 24.7721 133.546 24.6853 133.546 24.5159C133.546 24.3465 133.425 24.3031 132.7 24.1873C131.909 24.0623 131.382 23.8247 131.382 23.1438C131.382 22.5115 131.938 22.0238 133.024 22.0238C133.459 22.0238 133.912 22.1158 134.333 22.2945V23.212L134.328 23.2172C133.927 22.9857 133.386 22.84 132.951 22.84C132.565 22.84 132.411 22.932 132.411 23.0859C132.411 23.2843 132.648 23.3029 133.242 23.4052C134.033 23.5406 134.56 23.7627 134.56 24.4777C134.56 25.0325 134.145 25.5884 132.952 25.5884C132.364 25.5884 131.894 25.4675 131.402 25.2743Z" fill="white"/>
</svg>

</a>

      </div>

      <div class="col-sm-auto col-6 text-sm-center order-sm-2 order-4 second-logo-unit">
        <a href="https://unit42.paloaltonetworks.com/"><img src="/wp-content/uploads/2019/07/unit42.svg" class="attachment-full size-full" alt="" height="35" width="105" /></a>
      </div>

      <div class="col-auto d-sm-none ml-auto mb-40 order-2">
        <button class="btn__search" data-toggle="collapse" data-target="#search"><i class="ui ui-1"></i></button>
      </div>

      <div id="search" class="collapse d-sm-block col-sm-auto col-12 ml-auto order-3">
        <div class="pt-sm-0 pt-20 pb-sm-0 pb-40 mt-sm-0 mt-n30">
                      <input type="search" placeholder="Search Unit 42" id="innerSearch" class="header__search" value="" required>
                  </div>
      </div>

      <div class="col-auto d-sm-none d-flex ml-auto align-items-center order-5">
        <button class="btn__menu rounded" data-toggle="collapse" data-target="#navigation">Menu</button>
      </div>
    </div>
  </div>
</header>

<nav id="navigation" class="site-nav collapse d-sm-block pb-20 mt-sm-10">
  <div class="container px-sm-30">
    <ul id="menu-primary-navigation" class="main-menu d-sm-flex font-weight-medium"><li id="menu-item-97290" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-97290"><a href="https://unit42.paloaltonetworks.com/tools/">Tools</a></li>
<li id="menu-item-41" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-41"><a href="https://unit42.paloaltonetworks.com/atoms/">ATOMs</a></li>
<li id="menu-item-98931" class="menu-item menu-item-type-post_type_archive menu-item-object-events menu-item-98931"><a href="https://unit42.paloaltonetworks.com/events/">Speaking Events</a></li>
<li id="menu-item-81229" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-81229"><a href="https://unit42.paloaltonetworks.com/about-unit-42/">About Us</a></li>
</ul>  </div>
</nav>

  <article class="article overflow-hidden">
    
<header class="article__header py-sm-25 pt-40 pb-25 bg-gray-700">
  <div class="container">
    
    <h1 class="article__header__title mb-sm-30 mb-40">Information Leakage in AWS Resource-Based Policy APIs</h1>

    <ul class="article__entry-meta d-flex flex-wrap align-items-center text-black">
      <li class="mr-10 mb-10 px-20 rounded-pill d-flex bg-gray-200"><div class="post-views post-109551 entry-meta">
				
				
				<span class="post-views-count">3,609</span>
			</div> <span class="ml-5">people reacted</span></li>
      <li class="d-sm-none col-12 p-0"></li>
      <li class="mr-10 mb-10 px-20 rounded-pill bg-gray-200"><span class="ldc-ul_cont idc_ul_cont_not_liked_inner" onclick="alter_ul_post_values(this,'109551','like')"><i class="ui ui-2"></i><span class="ml-5">5</span></span></li>
      <li class="mb-10 px-20 rounded-pill bg-gray-200"><span class="span-reading-time rt-reading-time"><span class="rt-label rt-prefix"></span> <span class="rt-time"> 6</span> <span class="rt-label rt-postfix"></span></span> min. read</li>
    </ul>

    <div class="article__share position-relative">
      <div class="dropdown dropdown-right">
        <button type="button" class="px-25 text-black bg-white text-uppercase rounded-pill" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Share <i class="ui ui-6 ml-10 align-text-top"></i>
        </button>
        <div class="dropdown-menu rounded-pill" role="toolbar">
          <div class="share-dropdown px-20 py-10 text-black font-size-sm">
            <div class="row align-items-center flex-nowrap">
              <div class="col">
                <div class="d-flex align-items-center">
                  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funit42.paloaltonetworks.com%2Faws-resource-based-policy-apis%2F" target="_blank"><i class="ui ui-7"></i></a>
                  <a href="https://twitter.com/home?status=https%3A%2F%2Funit42.paloaltonetworks.com%2Faws-resource-based-policy-apis%2F+-+Information+Leakage+in+AWS+Resource-Based+Policy+APIs" target="_blank"><i class="ui ui-8"></i></a>
                  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funit42.paloaltonetworks.com%2Faws-resource-based-policy-apis%2F&title=Information+Leakage+in+AWS+Resource-Based+Policy+APIs&summary=&source=" target="_blank"><i class="ui ui-9"></i></a>
                  <a href="//www.reddit.com/submit?url=https://unit42.paloaltonetworks.com/aws-resource-based-policy-apis/" target="_blank"><i class="ui ui-10"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>    <div class="article__summary py-25 text-gray-500 font-size-sm">
  <div class="container">
    <div class="row align-items-center no-gutters">
      <div class="col-sm-auto col-12 mb-sm-0 mb-35">
        <i class="ui ui-11 text-gray-700 mr-sm-20"></i>
      </div>
  
      <div class="col-sm col-12">
        <p>
          By <a href="https://unit42.paloaltonetworks.com/author/jaychenpaloaltonetworks-com/" title="Posts by Jay Chen" class="author url fn" rel="author">Jay Chen</a>        </p>
        <p><time datetime="2020-11-17T11:00:16+00:00">November 17, 2020 at 3:00 AM</time></p>
        <p>Category: <a href="https://unit42.paloaltonetworks.com/category/unit-42/" rel="category tag">Unit 42</a></p>
        <p>Tags: <a href="https://unit42.paloaltonetworks.com/tag/aws/" rel="tag">AWS</a>, <a href="https://unit42.paloaltonetworks.com/tag/iam/" rel="tag">IAM</a>, <a href="https://unit42.paloaltonetworks.com/tag/public-cloud/" rel="tag">public cloud</a></p>
      </div>
    </div>
  </div>
</div>    <div class="py-30 bg-white">
      <div class="container">
        <div class="article__content pb-30">
                      <figure class="mb-30 text-center">
              <img width="900" height="450" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/11/Cloud-providers.png" class="attachment-single size-single" alt="This conceptual image illustrates some of the security and configuration issues involved with the cloud, such as the issue with AWS resource-based policy APIs discussed here." />            </figure>
                    <p class="wpml-ls-statics-post_translations wpml-ls">This post is also available in: 
    <span class="wpml-ls-slot-post_translations wpml-ls-item wpml-ls-item-ja wpml-ls-first-item wpml-ls-last-item wpml-ls-item-legacy-post-translations"><a href="https://unit42.paloaltonetworks.jp/aws-resource-based-policy-apis/" class="wpml-ls-link"><span class="wpml-ls-native" lang="ja">日本語</span><span class="wpml-ls-display"><span class="wpml-ls-bracket"> (</span>Japanese<span class="wpml-ls-bracket">)</span></span></a></span></p><h2><strong>Executive Summary</strong></h2>
<p>Unit 42 researchers discovered a class of Amazon Web Services (AWS) APIs that can be abused to leak the AWS Identity and Access Management (IAM) users and roles in arbitrary accounts. Researchers confirmed that 22 APIs across 16 different AWS services could be abused the same way and the exploit works across all three <a href="https://docs.amazonaws.cn/en_us/general/latest/gr/aws-arns-and-namespaces.html">AWS partitions</a> (aws, aws-us-gov or aws-cn). AWS services that can be potentially abused by attackers include Amazon Simple Storage Service (S3), Amazon Key Management Service (KMS) and Amazon Simple Queue Service (SQS). A malicious actor may obtain the roster of an account, learn the organization&#8217;s internal structure and launch targeted attacks against individuals. In a recent <a href="https://www.paloaltonetworks.com/prisma/unit42-cloud-threat-research">Red Team exercise</a>, Unit 42 researchers compromised a customer’s cloud account with thousands of workloads using a misconfigured IAM role identified by this technique.</p>
<p>The root cause of the issue is that the AWS backend proactively validates all the <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html#policies_resource-based">resource-based policies</a> attached to resources such as Amazon Simple Storage Service (S3) buckets and customer-managed keys. Resource-based policies usually include a <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_principal.html">Principal</a> field that specifies the identities (users or roles) allowed to access the resource. If the policy contains a nonexistent identity, the API call that creates or updates the policy will fail with an error message. This convenient feature, however, can be abused to check whether an identity exists in an AWS account. Adversaries can repeatedly invoke these APIs with different principals to enumerate the users and roles in a targeted account. Furthermore, the targeted account can&#8217;t observe the enumeration because the API logs and error messages only appear in the attacker&#8217;s account where the resource policies are manipulated. The &#8220;stealthy&#8221; property of the technique makes detection and prevention difficult. Attackers can have unrestricted time to perform reconnaissance on random or targeted AWS accounts without worrying about being noticed.</p>
<h2><strong>AWS Resource-Based Policy</strong></h2>
<p>AWS IAM manages permissions between users, resources and applications using various types of <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html#policies_resource-based">policies</a>. <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html#policies_resource-based">Resource-based policy</a> is a type of policy attached to resources within an AWS service. Each AWS service can have multiple resources and each resource can be attached with a different policy. For example, an S3 service can create multiple bucket resources and the SQS service can create multiple message queue resources. At the time of this writing, there are <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_aws-services-that-work-with-iam.html">26 AWS services</a> that support resource-based policies, as shown in Table 1. The policy determines the actions that principals can perform on the attached resource. A principal can be an AWS user, role or service. The actions that can be performed depend on the type of service.</p>
<figure id="attachment_109554" aria-describedby="caption-attachment-109554" style="width: 738px" class="wp-caption aligncenter"><img class="wp-image-109554" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/11/word-image-41.png" alt="This shows 3 examples of AWS S3 buckets, illustrating how a resource-based policy can work in action. For example, User1 can GetObject, GetObjectTagging and CopyObject. " width="738" height="383" /><figcaption id="caption-attachment-109554" class="wp-caption-text">Figure 1. Resource-based policy illustration.</figcaption></figure>
<p>Figure 2 is an example resource-based policy attached to an S3 bucket. Two principals are allowed to access the bucket, user “Bob” in account 123456789012 and IAM role “qa-role” in account 98765431098. The principals can perform three actions, GetObject, GetBucketLocation and ListBucket on S3 bucket “awsexamplebucket”. Note that the principals do not need to be in the same account as the bucket, meaning that a policy can also grant cross-account access to resources.</p>
<p>Figure 2 is the simplest form of a policy. A more complicated policy may consist of multiple statements and conditions. To avoid human errors, AWS validates every field in the policy before the policy can be applied to a resource. The validator ensures the specified principals actually exist and the specified actions are supported by the service. In Figure 2, an error message is raised because “GetFiles” is not a supported action.</p>
<figure id="attachment_109556" aria-describedby="caption-attachment-109556" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-109556" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/11/word-image-42.png" alt="This represents the simplest form of a resource-based policy. In this example, an error message is raised because &quot;GetFiles&quot; is not a supported action. " width="900" height="540" /><figcaption id="caption-attachment-109556" class="wp-caption-text">Figure 2. Example S3 bucket policy (left) and error message when an action is mis-specified (right).</figcaption></figure>
<h2><strong>Abusing Resource-Based Policy APIs</strong></h2>
<p>Policy validation is a feature from AWS that facilitates the user experience. While most users benefit from the feature, adversaries may also find the feature useful for performing reconnaissance in another account. Because the policy validator checks whether the specified principal exists, it gives adversaries a way to build up knowledge of a targeted account&#8217;s roster gradually. As we will show, adversaries may abuse policy validators in multiple AWS services that support resource-based policies.</p>
<p>When defining a principal in a resource-based policy, users ask AWS to authenticate and authorize the principal to access the resources in an AWS account. If we provide an invalid username or role name, the authentication will fail. One of the <a href="https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html#authentication-responses">authentication best practices</a> for implementing a secure authentication process is to avoid giving out account-specific information in error messages.</p>
<p>The AWS policy validator inadvertently leaks account-specific information in the error messages. When creating or updating a resource policy, the AWS policy validator explicitly reveals if the specified principal exists or not. An adversary could use the error messages to check whether a user or an IAM role exists in a targeted account. By repeating this process with a wordlist, an adversary can enumerate and discover the existing identities in a targeted account. Figures 3 and 4 show the error messages when we specify a nonexistent IAM role in different AWS services&#8217; resource policies. These policies are rejected and can&#8217;t be saved. The process can also be performed programmatically using AWS APIs, making the enumeration scalable.</p>
<p>One concerning property of this technique is that it is completely unobservable by the target or victim. When making changes to a resource policy, the AWS CloudTrail logs and error messages only appear in the resource owner or the attacker&#8217;s account. The &#8220;stealthy&#8221; property makes detection and prevention almost impossible.</p>
<p>A similar technique was first published in a <a href="https://rhinosecuritylabs.com/aws/aws-role-enumeration-iam-p2/">blog by Rhino Security Labs</a>, in which they used the <a href="https://aws.amazon.com/blogs/security/how-to-use-trust-policies-with-iam-roles/">IAM role trust policy</a> to check whether a cross-account IAM role exists. Unit 42 researchers identified and confirmed that at least 22 APIs across 16 AWS services can be exploited, as shown in Table 1. The commonality between these APIs is that they all take a resource policy as input and the policy needs to have a valid &#8220;Principal&#8221; field.</p>
<figure id="attachment_109558" aria-describedby="caption-attachment-109558" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-109558" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/11/word-image-43.png" alt="This shows the error messages when we specify a nonexistent IAM role in AWS SQS (left) and AWS SNS (right). By repeating this process with a wordlist, an adversary can enumerate and discover the existing identities in a target account. " width="900" height="616" /><figcaption id="caption-attachment-109558" class="wp-caption-text">Figure 3. Resource policies with nonexistent principals. AWS SQS (left) and AWS SNS (right).</figcaption></figure>
<figure id="attachment_109560" aria-describedby="caption-attachment-109560" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-109560" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/11/word-image-44.png" alt="This shows the error messages when we specify a nonexistent IAM role in AWS KMS (left) and AWS Glue (right). By repeating this process with a wordlist, an adversary can enumerate and discover the existing identities in a target account. " width="900" height="464" /><figcaption id="caption-attachment-109560" class="wp-caption-text">Figure 4. Resource policies with nonexistent principals. AWS KMS (left) and AWS Glue (right).</figcaption></figure>
<h2>Conclusion</h2>
<p>Detecting and preventing identity reconnaissance using this technique is difficult as there are no observable logs in the targeted accounts. However, <a href="https://unit42.paloaltonetworks.com/iam-roles-compromised-workloads/">good IAM security hygiene</a> can still effectively mitigate the threats from this type of attack. Although it’s not possible to prevent an attacker from enumerating identities in AWS accounts, the enumeration can be made more difficult and you can monitor for suspicious activities taken after the reconnaissance. To mitigate this issue, we recommend the following IAM security best practices for organizations:</p>
<ul>
<li>Remove inactive users and roles to reduce the attack surface.</li>
<li>Add random strings to usernames and role names to make them more difficult to guess.</li>
<li>Log in with <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_providers.html">identity provider and federation,</a> so that no additional users are created in the AWS account.</li>
<li>Log and monitor all the identity authentication activities.</li>
<li>Enable two-factor authentication (2FA) for every user and IAM role.</li>
</ul>
<h2>Appendix</h2>
<table style="width: 101.464%;">
<tbody>
<tr>
<td style="width: 40.2451%;"><strong>AWS Service</strong></td>
<td style="width: 43.6381%;"><strong>APIs for Updating Resource Policies (Python </strong><a href="https://aws.amazon.com/sdk-for-python/"><strong>Boto3</strong></a><strong>)</strong></td>
<td style="width: 68.5203%;"><strong>APIs can be abused</strong></td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/ECR_IAM_policies.html"><strong>Amazon Elastic Container Registry (Amazon ECR)</strong></a></td>
<td style="width: 43.6381%;"><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/ecr.html#ECR.Client.set_repository_policy">set_repository_policy()</a></td>
<td style="width: 68.5203%;">Yes</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/elastic-inference.html"><strong>Amazon Elastic Inference</strong></a></td>
<td style="width: 43.6381%;"><a href="https://docs.aws.amazon.com/elastic-inference/latest/developerguide/setting-up-ei.html#ei-role-policy">configured via IAM</a></td>
<td style="width: 68.5203%;">No</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-auth-and-access-control.html"><strong>AWS Lambda</strong></a></td>
<td style="width: 43.6381%;"><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/lambda.html#Lambda.Client.add_permission">add_permission()</a></td>
<td style="width: 68.5203%;">Yes</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/serverlessrepo/latest/devguide/serverlessrepo-auth-and-access-control.html"><strong>AWS Serverless Application Repository</strong></a></td>
<td style="width: 43.6381%;"><a href="https://docs.aws.amazon.com/serverlessrepo/latest/devguide/security_iam_resource-based-policy-examples.html">Principal must be an account ID</a></td>
<td style="width: 68.5203%;">No</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/aws-backup/latest/devguide/security-considerations.html"><strong>AWS Backup</strong></a></td>
<td style="width: 43.6381%;"><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/backup.html#Backup.Client.put_backup_vault_access_policy">put_backup_vault_access_policy()</a></td>
<td style="width: 68.5203%;">Yes</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/efs/latest/ug/auth-and-access-control.html"><strong>Amazon Elastic File System (Amazon EFS)</strong></a></td>
<td style="width: 43.6381%;"><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/efs.html#EFS.Client.put_file_system_policy">put_file_system_policy()</a></td>
<td style="width: 68.5203%;">Yes</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/fsx/latest/WindowsGuide/access-control-overview.html"><strong>Amazon FSx</strong></a></td>
<td style="width: 43.6381%;"><a href="https://docs.aws.amazon.com/fsx/latest/WindowsGuide/access-control-manage-access-intro.html">configured via IAM</a></td>
<td style="width: 68.5203%;">No</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/amazonglacier/latest/dev/auth-and-access-control.html"><strong>Amazon S3 Glacier</strong></a></td>
<td style="width: 43.6381%;"><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/glacier.html#Glacier.Client.set_vault_access_policy">set_vault_access_policy()</a></td>
<td style="width: 68.5203%;">Yes</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/s3-access-control.html"><strong>Amazon Simple Storage Service (Amazon S3)</strong></a></td>
<td style="width: 43.6381%;"><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/s3.html#S3.Client.put_bucket_policy">put_bucket_policy()</a></td>
<td style="width: 68.5203%;">Yes</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/cloud9/latest/user-guide/auth-and-access-control.html"><strong>AWS Cloud9</strong></a></td>
<td style="width: 43.6381%;"><a href="https://docs.aws.amazon.com/cloud9/latest/user-guide/using-service-linked-roles.html">configured via IAM</a></td>
<td style="width: 68.5203%;">No</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/codebuild/latest/userguide/auth-and-access-control.html"><strong>AWS CodeBuild</strong></a></td>
<td style="width: 43.6381%;"><a href="https://docs.aws.amazon.com/codebuild/latest/userguide/project-sharing.html#project-sharing-share">Policy principal needs to be account number, OU or organization</a></td>
<td style="width: 68.5203%;">No</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_permissions-required.html"><strong>AWS Identity and Access Management (IAM)</strong></a></td>
<td style="width: 43.6381%;"><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/iam.html#IAM.Client.create_role">create_role()</a><br />
<a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/iam.html#IAM.Client.update_assume_role_policy">update_assume_role_policy()</a></td>
<td style="width: 68.5203%;">Yes</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/kms/latest/developerguide/control-access.html"><strong>AWS Key Management Service (AWS KMS)</strong></a></td>
<td style="width: 43.6381%;"><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/kms.html#KMS.Client.put_key_policy">put_key_policy()</a></td>
<td style="width: 68.5203%;">Yes</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/auth-and-access.html"><strong>AWS Secrets Manager</strong></a></td>
<td style="width: 43.6381%;"><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/secretsmanager.html#SecretsManager.Client.put_resource_policy">put_resource_policy()</a></p>
<p><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/secretsmanager.html#SecretsManager.Client.validate_resource_policy">validate_resource_policy()</a></td>
<td style="width: 68.5203%;">Yes</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/auth-and-access-control-cwl.html"><strong>Amazon CloudWatch Logs</strong></a></td>
<td style="width: 43.6381%;"><a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/iam-access-control-overview-cwl.html">configured via IAM</a></td>
<td style="width: 68.5203%;">No</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Security.IAMPermissions.html"><strong>AWS Database Migration Service</strong></a></td>
<td style="width: 43.6381%;"><a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Security.html#security_iam_resource-based-policy-examples">configured via KMS</a></td>
<td style="width: 68.5203%;">No</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/permissions.html"><strong>Amazon API Gateway</strong></a></td>
<td style="width: 43.6381%;"><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/apigateway.html#APIGateway.Client.create_rest_api">create_rest_api()</a></p>
<p><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/apigateway.html#APIGateway.Client.update_rest_api">update_rest_api()</a></td>
<td style="width: 68.5203%;">Yes</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/vpc/latest/tgw/nm-security-iam.html"><strong>Transit Gateway Network Manager</strong></a></td>
<td style="width: 43.6381%;"><a href="https://docs.aws.amazon.com/vpc/latest/tgw/nm-security-iam.html">configured via IAM</a></td>
<td style="width: 68.5203%;">No</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/medialive/latest/ug/setting-up-for-production.html"><strong>AWS Elemental MediaLive</strong></a></td>
<td style="width: 43.6381%;"><a href="https://docs.aws.amazon.com/medialive/latest/ug/setup-user-step-policies.html">configured via IAM</a></td>
<td style="width: 68.5203%;">No</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/mediastore/latest/ug/setting-up.html"><strong>AWS Elemental MediaStore</strong></a></td>
<td style="width: 43.6381%;"><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/mediastore.html#MediaStore.Client.put_container_policy">put_container_policy()</a></td>
<td style="width: 68.5203%;">Yes</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-createupdatedomains.html#es-createdomain-configure-access-policies"><strong>Amazon Elasticsearch Service</strong></a></td>
<td style="width: 43.6381%;"><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/es.html#ElasticsearchService.Client.create_elasticsearch_domain">create_elasticsearch_domain()</a></p>
<p><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/es.html#ElasticsearchService.Client.update_elasticsearch_domain_config">update_elasticsearch_domain_config()</a></td>
<td style="width: 68.5203%;">Yes</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/glue/latest/dg/authentication-and-access-control.html"><strong>AWS Glue</strong></a></td>
<td style="width: 43.6381%;"><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/glue.html#Glue.Client.put_resource_policy">put_resource_policy()</a></td>
<td style="width: 68.5203%;">Yes</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/sns/latest/dg/UsingIAMwithSNS.html"><strong>Amazon Simple Notification Service (Amazon SNS)</strong></a></td>
<td style="width: 43.6381%;"><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/sns.html#SNS.Client.create_topic">create_topic()</a></p>
<p><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/sns.html#SNS.Client.set_topic_attributes">set_topic_attributes()</a></td>
<td style="width: 68.5203%;">Yes</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/UsingIAM.html"><strong>Amazon Simple Queue Service (Amazon SQS)</strong></a></td>
<td style="width: 43.6381%;"><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/sqs.html#SQS.Client.create_queue">create_queue()</a></p>
<p><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/sqs.html#SQS.Client.set_queue_attributes">set_queue_attributes()</a></td>
<td style="width: 68.5203%;">Yes</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-security-identity.html"><strong>AWS IoT</strong></a></td>
<td style="width: 43.6381%;"><a href="https://docs.aws.amazon.com/iot/latest/developerguide/security_iam_service-with-iam.html#security_iam_service-with-iam-resource-based-policies">configured via IAM</a></td>
<td style="width: 68.5203%;">No</td>
</tr>
<tr>
<td style="width: 40.2451%;"><a href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/UsingWithIAM.html"><strong>Amazon Simple Email Service (Amazon SES)</strong></a></td>
<td style="width: 43.6381%;"><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/ses.html#SES.Client.put_identity_policy">put_identity_policy()</a></td>
<td style="width: 68.5203%;">Yes</td>
</tr>
</tbody>
</table>
<p><em>Table 1. AWS services that support resource-based policies. Unit 42 researchers identified 22 APIs across 16 AWS services that can be abused.</em></p>
<p>&nbsp;</p>
          <div class="article__subscribe mb-40 text-gray-400 bg-gray-200 rounded-lg">
  <h4 class="h3 mb-10 text-black">Get updates from <br class="d-sm-none"> Palo Alto<br class="d-sm-none"> Networks!</h4>
  <p>Sign up to receive the latest news, cyber threat intelligence and research from us</p>
  <!-- <form action="https://app-guse4001.marketo.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe"> -->
  <form action="https://start.paloaltonetworks.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe">
    <input type="hidden" value="1086" name="formid">
    <!-- <input type="hidden" value="818-CZC-273" name="munchkinId"> -->
    <input type="hidden" value="531-OCS-018" name="munchkinId">
    <input type="hidden" value="2141" name="lpId">
    <input type="hidden" value="1086" name="formVid">
    <input type="hidden" name="mkto_optinunit42" value="true">
    <input type="hidden" name="mkto_opt-in" value="true">
    <div class="row">
      <div class="col-sm col-12 mb-sm-0 mb-15">
        <input type="email" name="Email" placeholder="Email address" class="subscribe-field d-block w-100 px-sm-25 px-15 bg-white">
        <p class="error-mail d-none mt-15 text-danger" style="color: #dc3545">Please enter your email address!</p>
      </div>
      <div class="col-sm-auto col-12">
          <input type="submit" value="Subscribe" class="btn btn--black btn--sm w-100" disabled="disabled">
      </div>
    </div>

    <div class="google-recapth mt-15">
      <div class="g-recaptcha" data-expired-callback="captchaExpires" data-callback="captchaComplete" data-sitekey="6LfKOrwUAAAAAOwgjxrEcx-pcfwe8OquUw6ommTK"></div>
      <p class="error-recaptcha d-none mt-15 text-danger" style="color: #dc3545">Please mark, I'm not a robot!</p>
    </div>
  </form>

  <div class="font-size-ex-sm col-sm-7 p-0">
    <p>By submitting this form, you agree to our <a href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a> and acknowledge our <a href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy Statement</a>.</p>
  </div>
</div>

<script type="text/javascript" src="https://researchcenter.paloaltonetworks.com/wp-content/plugins/google-analyticator/external-tracking.min.js?ver=6.4.9"></script>
        </div>
      </div>
    </div>
  </article>
<div class="ignite20promo">
    <div class="container">
    <div class="ignite20text">
        <div>
            <div class="orange-bar-sm"></div><br/>
        <span class="promo-heading">Secure Today,<br/>for a Better<br/>Tomorrow</span>
        </div>
        <div class="promo-subtext"><span>Join us at IGNITE’20</span>
            <a href="https://ignitereg.paloaltonetworks.com/flow/paloaltonetworks/ignite20/regsc/login?source=unit42" onclick="return false;">
                <svg width="17" height="12" viewBox="0 0 17 12" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M1.41089 6L15.3143 6" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M10.1006 1L15.3144 6L10.1006 11" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a>
        </div>
        </div>
    </div> 
</div>
<script type="text/javascript">
    $('.ignite20promo').click(function(){
        window.open("https://ignitereg.paloaltonetworks.com/flow/paloaltonetworks/ignite20/regsc/login?source=unit42", "_blank"); 
    });
</script>    
<footer class="site-footer px-sm-0 px-15">
  <div class="pt-40">
    <div class="container pt-sm-30">
      <div class="row justify-content-lg-center">
        <div class="col-lg-11 col-12">
          <div class="row">
            <div class="col-lg-4 col-sm-3 col-12 order-sm-2">
              <nav class="footer-socials mb-sm-0 mb-25 text-white text-sm-right">
                                                <a href="https://twitter.com/Unit42_Intel" target="_blank"><span class="ui ui-4"></span></a>
                <a href="https://github.com/pan-unit42" target="_blank"><span class="ui ui-5"></span></a>
              </nav>
            </div>

            <div class="col-lg-8 col-sm-9 col-12 order-sm-1">
              <div class="row">
                <div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Popular Resources</h4><div class="menu-footer-company-phase-container"><ul id="menu-footer-company-phase" class="menu"><li id="menu-item-97096" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97096"><a target="_blank" href="https://www.paloaltonetworks.com/resources">Resource Center</a></li>
<li id="menu-item-97097" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97097"><a target="_blank" href="https://researchcenter.paloaltonetworks.com/">Blog</a></li>
<li id="menu-item-97098" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97098"><a target="_blank" href="https://www.paloaltonetworks.com/communities">Communities</a></li>
<li id="menu-item-97099" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97099"><a target="_blank" href="https://docs.paloaltonetworks.com/">Tech Docs</a></li>
<li id="menu-item-97100" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-97100"><a href="https://unit42.paloaltonetworks.com/">Unit 42</a></li>
<li id="menu-item-97101" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97101"><a target="_blank" href="https://www.paloaltonetworks.com/sitemap">Sitemap</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Legal Notices</h4><div class="menu-footer-legal-notices-phase-container"><ul id="menu-footer-legal-notices-phase" class="menu"><li id="menu-item-97093" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97093"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy</a></li>
<li id="menu-item-97094" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97094"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a></li>
<li id="menu-item-97095" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97095"><a target="_blank" href="https://www.paloaltonetworks.com/legal">Documents</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Account</h4><div class="menu-footer-trending-topics-phase-container"><ul id="menu-footer-trending-topics-phase" class="menu"><li id="menu-item-97102" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97102"><a href="https://start.paloaltonetworks.com/preference-center">Manage Subscriptions</a></li>
<li id="menu-item-97103" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97103"><a href="#">&nbsp;</a></li>
<li id="menu-item-97104" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97104"><a href="https://www.paloaltonetworks.com/security-disclosure">Report a Vulnerability</a></li>
</ul></div></div>              </div>
            </div>
          </div>

          
            <div class="copyrights py-25 mt-40">
               <p>© 2020 Palo Alto Networks, Inc. All rights reserved.</p>
            </div>
          
        </div>
      </div>
    </div>
  </div>
</footer>
    <script type="text/javascript">
	var isProcessing = false; 
    function alter_ul_post_values(obj,post_id,ul_type){
	
		if (isProcessing)    
		return;  
		isProcessing = true;   
		
		jQuery(obj).find("span").html("..");
                jQuery.ajax({
                    type: "POST",
                    url: "https://unit42.paloaltonetworks.com/wp-content/plugins/like-dislike-counter-for-posts-pages-and-comments/ajax_counter.php",
                    data: "post_id="+post_id+"&up_type="+ul_type,
                    success: function(msg){
                            jQuery(obj).find("span").html(msg);
                            isProcessing = false; 
                            jQuery(obj).find('svg').children('path').attr('stroke','#0050FF');
                            jQuery(obj).removeClass('idc_ul_cont_not_liked idc_ul_cont_not_liked_inner');
                    }
 		});
	}
	</script>
    <link rel='stylesheet' id='wpdevart_lightbox_front_end_css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/wpdevart_lightbox_front.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpdevart_lightbox_effects-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/effects_lightbox.css?ver=5.4.1' type='text/css' media='all' />
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/scripts/main.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/wp-embed.min.js?ver=5.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpdevart_lb_variables = {"eneble_lightbox_content":"enable","overlay_transparency_prancent":"80","enable_video_popuping":"enable","popup_background_color":"#000000","popup_loading_image":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/popup_loading.png","popup_initial_width":"350","popup_initial_height":"300","popup_youtube_width":"640","popup_youtube_height":"410","popup_vimeo_width":"500","popup_vimeo_height":"410","popup_max_width":"5000","popup_max_height":"5000","popup_position":"5","popup_fixed_position":"true","popup_outside_margin":"0","popup_border_width":"2","popup_border_color":"#000000","popup_border_radius":"10","control_buttons_show":"true","control_buttons_show_in_content":"false","control_buttons_height":"30","control_buttons_line_bg_color":"#000000","control_button_prev_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev.png","control_button_prev_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev_hover.png","control_button_next_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next.png","control_button_next_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next_hover.png","control_button_download_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download.png","control_button_download_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download_hover.png","control_button_innewwindow_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow.png","control_button_innewwindow_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow_hover.png","control_button_fullwidth_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth.png","control_button_fullwidht_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth_hover.png","control_button_fullwidthrest_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset.png","control_button_fullwidhtrest_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset_hover.png","control_button_close_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close.png","control_button_close_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close_hover.png","information_panel_show":"false","information_panel_show_in_content":"false","information_panel_bg_color":"#000000","information_panel_default_transparency":"100","information_panel_hover_trancparency":"100","information_panel_count_image_after_text":"Image","information_panel_count_image_middle_text":"of","information_panel_count_padding_left":"15","information_panel_count_padding_right":"4","information_panel_count_font_size":"20","information_panel_desc_padding_left":"15","information_panel_desc_padding_right":"4","information_panel_desc_font_size":"20","information_panel_desc_show_if_not":"true","information_panel_text_for_no_caption":"No Caption","information_panel_title_padding_left":"5","information_panel_title_padding_right":"5","information_panel_title_font_size":"15","information_panel_title_show_if_not":"true","information_panel_text_for_no_title":"No Title","information_panel_ordering":"{\"count\":[1,\"count\"],\"title\":[0,\"title\"],\"caption\":[0,\"caption\"]}"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/javascript/wpdevart_lightbox_front.js?ver=1.0'></script>
          
  </body>
</html>
