<!doctype html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="google-site-verification" content="_b2avZwzr79oru6lM2Ddae1fNpSIbPaP0H0WNkc2x3k"/>
    <meta name="msvalidate.01" content="CE77828A466C2513F660017CFCB6BA13"/>
    <link rel="icon" href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/favicon.ico">

    

            
    
    <link href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/css/main-8633bd3c28.css" rel="stylesheet">
    <script type="text/javascript"> var appInsights=window.appInsights||function(a){ function b(a){c[a]=function(){var b=arguments;c.queue.push(function(){c[a].apply(c,b)})}}var c={config:a},d=document,e=window;setTimeout(function(){var b=d.createElement("script");b.src=a.url||"https://az416426.vo.msecnd.net/scripts/a/ai.0.js",d.getElementsByTagName("script")[0].parentNode.appendChild(b)});try{c.cookie=d.cookie}catch(a){}c.queue=[];for(var f=["Event","Exception","Metric","PageView","Trace","Dependency"];f.length;)b("track"+f.pop());if(b("setAuthenticatedUserContext"),b("clearAuthenticatedUserContext"),b("startTrackEvent"),b("stopTrackEvent"),b("startTrackPage"),b("stopTrackPage"),b("flush"),!a.disableExceptionTracking){f="onerror",b("_"+f);var g=e[f];e[f]=function(a,b,d,e,h){var i=g&&g(a,b,d,e,h);return!0!==i&&c["_"+f](a,b,d,e,h),i}}return c }({ instrumentationKey:"dcb460fe-684e-4d39-bfcd-d3a6f2710a32" }); window.appInsights=appInsights,appInsights.queue&&0===appInsights.queue.length&&appInsights.trackPageView(); </script>
    <script>
        window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
        'Author': 'Aleksandr Matrosov',
        'ArticleCategory': 'Botnet',
        'ArticleSection': '(not set)',
        'cookie-bar-hq': true
    });

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PMDGSM');
</script>
<script>(function() {
  var _fbq = window._fbq || (window._fbq = []);
  if (!_fbq.loaded) {
    var fbds = document.createElement('script');
    fbds.async = true;
    fbds.src = '//connect.facebook.net/en_US/fbds.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(fbds, s);
    _fbq.loaded = true;
  }
  _fbq.push(['addPixelId', '1518099328403839']);
})();
window._fbq = window._fbq || [];
window._fbq.push(['track', 'PixelInitialized', {}]);
</script>
<noscript><img height="1" width="1" alt="" style="display:none" src="https://www.facebook.com/tr?id=1518099328403839&amp;ev=NoScript" /></noscript>
<meta property="fb:pages" content="56844830907" />
<!-- This site is optimized with the Yoast SEO plugin v9.2 - https://yoast.com/wordpress/plugins/seo/ -->
<title>The rise of TOR&#8209;based botnets | WeLiveSecurity</title>
<meta name="description" content="TOR-based botnets are not a new idea, but this summer we&#039;ve tracked some interesting real-world examples, Win32/Atrax and Win32/Agent.PTA."/>
<link rel="canonical" href="https://www.welivesecurity.com/2013/07/24/the-rise-of-tor-based-botnets/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="The rise of TOR&#8209;based botnets | WeLiveSecurity" />
<meta property="og:description" content="TOR-based botnets are not a new idea, but this summer we&#039;ve tracked some interesting real-world examples, Win32/Atrax and Win32/Agent.PTA." />
<meta property="og:url" content="https://www.welivesecurity.com/2013/07/24/the-rise-of-tor-based-botnets/" />
<meta property="og:site_name" content="WeLiveSecurity" />
<meta property="article:section" content="Botnet" />
<meta property="article:published_time" content="2013-07-24T18:02:33+00:00" />
<meta property="article:modified_time" content="2013-08-07T19:34:32+00:00" />
<meta property="og:updated_time" content="2013-08-07T19:34:32+00:00" />
<meta property="og:image" content="https://www.welivesecurity.com/wp-content/uploads/2013/07/shelob.jpg" />
<meta property="og:image:secure_url" content="https://www.welivesecurity.com/wp-content/uploads/2013/07/shelob.jpg" />
<meta property="og:image:width" content="637" />
<meta property="og:image:height" content="425" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="TOR-based botnets are not a new idea, but this summer we&#039;ve tracked some interesting real-world examples, Win32/Atrax and Win32/Agent.PTA." />
<meta name="twitter:title" content="The rise of TOR&#8209;based botnets | WeLiveSecurity" />
<meta name="twitter:site" content="@welivesecurity" />
<meta name="twitter:image" content="https://www.welivesecurity.com/wp-content/uploads/2013/07/shelob.jpg" />
<meta name="twitter:creator" content="@welivesecurity" />
<!-- / Yoast SEO plugin. -->

<link rel="alternate" type="application/rss+xml" title="WeLiveSecurity RSS 2.0 Feed" href="/rss-configurator/" /><style type="text/css" id="syntaxhighlighteranchor"></style>
        <link id="cookie-style" rel="stylesheet" type="text/css" href="https://assets.esetstatic.com/3PS/cookiebar.min.css">
</head>
<body class="no-js single noimage">
<noscript>
	<iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PMDGSM" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div class="main">
    <header id="site-header" class="container">
        <div class="row">
            <div class="col-md-4 col-sm-12 col-xs-12 pull-right" id="header-nav">
                <div class="row">
                    <div class="col-xs-12 mobile-search-input">
                        <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                    </div>
                    <div class="hidden-lg hidden-md col-sm-7 col-xs-8 hidden-xxs">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
                    <div class="col-md-8 hidden-sm hidden-xs languages">
                        <div class="dropdown">
	<button class="btn btn-default dropdown-toggle" type="button" id="main-language-picker" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
    	<span class="text">In English</span>
    	<span class="icomoon icon-icon_arrow"></span>
  	</button>
  	<ul class="dropdown-menu" aria-labelledby="main-language-picker">
            <li>
        <a href="/br/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/" title="In Deutsch">
            In Deutsch        </a>
    </li>
      	</ul>
</div>                    </div>
                    <div class="col-md-4 col-sm-2 col-xs-3 menu-trigger">
                        <div class="menu-btn">
	<span class="text">Menu</span>
	<button type="button" id="menu-trigger" class="tcon tcon-menu--xcross" aria-label="toggle menu">
        <span class="wrapper">
            <span class="tcon-menu__lines" aria-hidden="true"></span>
            <span class="tcon-visuallyhidden">toggle menu</span>
        </span>
    </button>
</div>                    </div>
                    <div class="hidden-lg hidden-md hidden-sm hidden-xs col-xs-2 mobile-search imc">
                        <button class="imc">
                            <span class="icomoon icon-icon_search imc"></span>
                        </button>
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12 imc" id="main-menu">
                        <nav class="menu clearfix imc">
                            <ul class="col-md-12 col-sm-6 col-xs-6 imc">
                                                                    <li class="">
                                        <a href="/">
                                            All Posts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/research">
                                            Research                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/category/how-to/">
                                            How To                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/videos/">
                                            Videos                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/podcasts/">
                                            Podcasts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/conference-papers/">
                                            Conference Materials                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/white-papers/">
                                            White Papers                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/threat-reports/">
                                            Threat Reports                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/magazine/">
                                            Magazine                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/our-experts/">
                                            Our Experts                                        </a>
                                    </li>
                                                            </ul>

                            <div class="col-md-12 col-sm-6 col-xs-6 imc">
                                <ul class="languages hidden-lg hidden-md hidden-xxs col-xs-12 imc">
                                        <li>
        <a href="/br/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/" title="In Deutsch">
            In Deutsch        </a>
    </li>
                                    </ul>
                                <div class="hidden-lg hidden-md col-xs-12 imc">
                                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="menu-overlay col-md-12 col-sm-12 col-xs-12 imc">
                        <div class="inner imc"></div>
                    </div>
                </div>
                <div class="row hidden-sm hidden-xs">
                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc  col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                </div>
            </div>
            <div class="col-md-5 hidden-sm hidden-xs pull-left" id="header-logo">
                <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                <span class="slogan hidden-sm hidden-xs">
						Award-winning news, views, and insight from the ESET <strong>security community</strong> 
					</span>
            </div>
        </div>
    </header>
        <section id="article-detail">
            <div class="hero-noimage">
	<div class="container promo-text">
		<div class="inner clearfix">
			<div class="col-md-11 col-sm-11 col-xs-12 no-padding">
				<h1>The rise of TOR&#8209;based botnets</h1>
<div class="excerpt">TOR-based botnets are not a new trend and were already being discussed a few years ago at Defcon 18 (“Resilient Botnet Command and Control with Tor”). But in the last year we’ve been able to confirm some interesting facts concerning the use of these ideas in real-world botnets. This topic was already discussed around the beginning</div>
<div class="post-meta">
    <div class="wls-authors">
            </div>
    <span class="meta">
		<span class="strong">
			<time datetime="2013-07-24 18:02:33">24 Jul 2013 - 06:02PM</time>
		</span>
			</span>
</div>
			</div>
		</div>
	</div>
</div>	

            <div class="content">
                <div class="social-wrapper" id="social-sharer">
                    <span class="text">Share</span>
	<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2013%2F07%2F24%2Fthe-rise-of-tor-based-botnets%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
		<span class="icomoon icon-icon_fb"></span>
	</a>
	<a class="share-twitter" href="https://twitter.com/intent/tweet?&url=https%3A%2F%2Fwww.welivesecurity.com%2F2013%2F07%2F24%2Fthe-rise-of-tor-based-botnets%2F&text=The rise of TOR&#8209;based botnets%0A&via=welivesecurity" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
		<span class="icomoon icon-icon_tw"></span>
	</a>
	<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2013%2F07%2F24%2Fthe-rise-of-tor-based-botnets%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
		<span class="icomoon icon-icon_in"></span>
	</a>
                </div>
                <div class="container">
                    <div class="row">
                        <div class="col-md-1 col-sm-1 hidden-xs">

                        </div>
                        <div class="col-md-10 col-sm-10 col-xs-12 formatted">

                            <div class="excerpt noimage">
                                <p>TOR-based botnets are not a new trend and were already being discussed a few years ago at Defcon 18 (“Resilient Botnet Command and Control with Tor”). But in the last year we’ve been able to confirm some interesting facts concerning the use of these ideas in real-world botnets. This topic was already discussed around the beginning</p>
                            </div>

                            <p><span style="color: #000000; font-family: Calibri; font-size: medium;">TOR-based botnets are not a new trend and were already being discussed a few years ago at Defcon 18 (“</span><a href="https://www.defcon.org/images/defcon-18/dc-18-presentations/D.Brown/DEFCON-18-Brown-TorCnC.pdf"><span style="color: #0563c1; font-family: Calibri; font-size: medium;">Resilient Botnet Command and Control with Tor</span></a><span style="color: #000000; font-family: Calibri; font-size: medium;">”). But in the last year we’ve been able to confirm some interesting facts concerning the use of these ideas in real-world botnets. This topic was already discussed around the beginning of 2013 in a Rapid7 blog post (“</span><a href="https://community.rapid7.com/community/infosec/blog/2012/12/06/skynet-a-tor-powered-botnet-straight-from-reddit"><span style="color: #0563c1; font-family: Calibri; font-size: medium;">Skynet, a Tor-powered botnet straight from Reddit</span></a><span style="color: #000000; font-family: Calibri; font-size: medium;">”). In early July Dancho Danchev also posted </span><a href="http://blog.webroot.com/2013/07/02/cybercriminals-experiment-with-tor-based-cc-ring-3-rootkit-empowered-spdy-form-grabbing-malware-bot/"><span style="color: #0563c1; font-family: Calibri; font-size: medium;">information</span></a><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;"> about a TOR-based C&amp;C for a ring-3 rootkit. </span></span></span></p>
<p><span style="color: #000000; font-family: Calibri; font-size: medium;">We have been tracking the rise of TOR-based botnets this summer. In July two different malware families were detected that use the </span><a href="https://www.torproject.org/docs/hidden-services.html.en"><span style="color: #0563c1; font-family: Calibri; font-size: medium;">TOR hidden service protocol</span></a><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;"> for stealth communication with C&amp;C’s. The TOR hidden service protocol is well-suited to organizing stealth communication channel with a C&amp;C but is slow for stealing high volumes of data from an infected machine. For cybercriminals the most useful way to use the hidden service protocol is for communicating with C&amp;C, getting update for configuration information, or downloading additional malicious modules. </span></span></span></p>
<p><span style="color: #000000; font-family: Calibri; font-size: medium;">In July ESET researchers detected two different types of TOR-based botnets based on the malware families </span><a href="http://virusradar.com/en/Win32_Atrax.A/description"><span style="color: #0563c1; font-family: Calibri; font-size: medium;">Win32/Atrax</span></a><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;"> and Win32/Agent.PTA. Both botnets have form-grabbing functionality for possible further fraud operations. The Atrax botnet looks more complex and interesting, so we begin this blog by analysing it.</span></span></span></p>
<h2>Win32/Atrax.A</h2>
<p><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">Win32/Atrax.A is an interesting TOR-based backdoor family which is installed by a simple downloader program we detect as Win32/TrojanDownloader.Tiny.NIR. The decompiled main routine of this downloader looks like this: </span></span></span></p>
<p><a href="/wp-content/uploads/2013/07/1.png"><img class="alignnone size-full wp-image-23070" alt="1" src="/wp-content/uploads/2013/07/1.png" width="873" height="306" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/07/1.png 873w, https://www.welivesecurity.com/wp-content/uploads/2013/07/1-300x105.png 300w" sizes="(max-width: 873px) 100vw, 873px" /></a></p>
<p><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">More interesting information is that its hardcoded domain name is “kundenservice-paypal.com”, registered in the middle of June (12-Jun-2013) (so named to pass itself off as PayPal Customer Service).</span></span></span></p>
<p><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">All trojan components and the downloader binary were compiled in July, according to information extracted from the PE header time stamp. </span></span></span></p>
<p><a href="/wp-content/uploads/2013/07/2.png"><img class="alignnone size-medium wp-image-23071" alt="2" src="/wp-content/uploads/2013/07/2-300x125.png" width="300" height="125" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/07/2-300x125.png 300w, https://www.welivesecurity.com/wp-content/uploads/2013/07/2.png 343w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>
<p><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">After download and execution of the main dropper file, the decompress routine is started for three PE modules: TOR client, DLL module for x86 and DLL module for x64 platform. For decompression WinAPI function <i>RtlDecompressBuffer()</i> Is used. The code for the decompiled decompress routine looks like this:</span></span></span></p>
<p><a href="/wp-content/uploads/2013/07/3.png"><img class="alignnone size-full wp-image-23072" alt="3" src="/wp-content/uploads/2013/07/3.png" width="386" height="539" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/07/3.png 386w, https://www.welivesecurity.com/wp-content/uploads/2013/07/3-214x300.png 214w" sizes="(max-width: 386px) 100vw, 386px" /></a></p>
<p><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">Before installation the dropper makes simple checks, so as to detect whether it’s on a virtual machine and any debugger activity. The bot ID is an MD5-calculated hash based on unique values from the system registry <i>DigitalProductID</i> and <i>MachineGuid</i>. Here’s the call graph for the routine that infects the machine (you&#8217;ll probably need to click it to view it as it&#8217;s an awkward size for the blog page.): </span></span></span></p>
<p><a href="/wp-content/uploads/2013/07/4.jpg"><img class="alignnone size-medium wp-image-23073" alt="4" src="/wp-content/uploads/2013/07/4-300x104.jpg" width="300" height="104" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/07/4-300x104.jpg 300w, https://www.welivesecurity.com/wp-content/uploads/2013/07/4.jpg 904w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>
<p><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">This routine tries during the last stages of execution to search for the initialization of additional AES-encrypted plugins in the <i>%APPDATA%</i> directory. All plugins are named according to the following pattern: <i>%APPDATA%\CC250462B0857727*</i>. Plugins are decrypted on the fly during the bot initialization process but the encryption key depends on the infected machine. This approach to plugin encryption makes it difficult to extract information during the forensic process.</span></span></span></p>
<p><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">The TOR client is embedded into the dropper executable and stored in the <i>%APPDATA%</i> directory as an AES-encrypted file. Initialization of the TOR connection takes place after checking for an active browser process and injection of TOR client code into the browser process by <i>NtSetContextThread()</i>. Win32/Atrax.A supports code injection techniques for x86 and x64 processes. </span></span></span></p>
<p><a href="/wp-content/uploads/2013/07/5.png"><img class="alignnone size-full wp-image-23074" alt="5" src="/wp-content/uploads/2013/07/5.png" width="378" height="200" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/07/5.png 378w, https://www.welivesecurity.com/wp-content/uploads/2013/07/5-300x158.png 300w" sizes="(max-width: 378px) 100vw, 378px" /></a></p>
<p><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">All communications between the C&amp;C and the bot are made via a special HTTP request function call. The prototype of this function looks like this:</span></span></span></p>
<p><a href="/wp-content/uploads/2013/07/6.png"><img class="alignnone size-full wp-image-23075" alt="6" src="/wp-content/uploads/2013/07/6.png" width="670" height="27" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/07/6.png 670w, https://www.welivesecurity.com/wp-content/uploads/2013/07/6-300x12.png 300w" sizes="(max-width: 670px) 100vw, 670px" /></a></p>
<p><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">If the second parameter <i>request_via_tor</i> setup is in the <i>TRUE</i> state all communications will be initialized by the TOR client. TOR communications have the following call graph:</span></span></span></p>
<p><a href="/wp-content/uploads/2013/07/7.jpg"><img class="alignnone size-full wp-image-23076" alt="7" src="/wp-content/uploads/2013/07/7.jpg" width="279" height="141" /></a></p>
<p><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">After execution a new thread with the Tor client software will be set up using the following parameters:</span></span></span></p>
<ul>
<li><span style="color: #000000;"><span style="font-size: medium;"><span style="font-family: Calibri;">AUTHENTICATE – password for authentication </span></span></span></li>
<li><span style="color: #000000;"><span style="font-size: medium;"><span style="font-family: Calibri;">SIGNAL NEWNYM – change proxy-nodes chain</span></span></span></li>
</ul>
<p><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">When the first connection is made with the C&amp;C, Atrax.A sends collected information about the infected system to an address inside the TOR network: </span></span></span></p>
<p><a href="/wp-content/uploads/2013/07/8.png"><img class="alignnone size-full wp-image-23077" alt="8" src="/wp-content/uploads/2013/07/8.png" width="819" height="42" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/07/8.png 819w, https://www.welivesecurity.com/wp-content/uploads/2013/07/8-300x15.png 300w" sizes="(max-width: 819px) 100vw, 819px" /></a></p>
<p><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">It isn’t possible to ascertain the original C&amp;C IP address or domain with a TOR enabled connection but it is possible to use the address generated in the TOR network for analysis. After we played a little bit with the internal address in the TOR network we found the following login panel for C&amp;C: </span></span></span></p>
<p><a href="/wp-content/uploads/2013/07/10.jpg"><img class="alignnone size-full wp-image-23078" alt="10" src="/wp-content/uploads/2013/07/10.jpg" width="383" height="243" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/07/10.jpg 383w, https://www.welivesecurity.com/wp-content/uploads/2013/07/10-300x190.jpg 300w, https://www.welivesecurity.com/wp-content/uploads/2013/07/10-65x42.jpg 65w" sizes="(max-width: 383px) 100vw, 383px" /></a></p>
<p><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">We recognize the name Atrax on the login screen. It’s the main reason why we chose the name Win32/Atrax.A for detection by ESET products.</span></span></span></p>
<p><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">Win32/Atrax.A supports the execution of remote commands for setting up bot behavior on the infected machine. The main routine for recognizing and executing remote commands looks like this:</span></span></span></p>
<p><a href="/wp-content/uploads/2013/07/9.png"><img class="alignnone size-full wp-image-23079" alt="9" src="/wp-content/uploads/2013/07/9.png" width="523" height="920" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/07/9.png 523w, https://www.welivesecurity.com/wp-content/uploads/2013/07/9-170x300.png 170w" sizes="(max-width: 523px) 100vw, 523px" /></a></p>
<p><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">The list of supported remote command types: </span></span></span></p>
<ul>
<li><span style="color: #000000;"><span style="font-size: medium;"><span style="font-family: Calibri;">dlexec &#8211; download and execute file</span></span></span></li>
<li><span style="color: #000000;"><span style="font-size: medium;"><span style="font-family: Calibri;">dlrunmem &#8211; download file and inject it to browser</span></span></span></li>
<li><span style="color: #000000;"><span style="font-size: medium;"><span style="font-family: Calibri;">dltorexec &#8211; download TOR executable file and execute</span></span></span></li>
<li><span style="color: #000000;"><span style="font-size: medium;"><span style="font-family: Calibri;">dltorrunmem &#8211; download TOR executable file inject it to browser </span></span></span></li>
<li><span style="color: #000000;"><span style="font-size: medium;"><span style="font-family: Calibri;">update &#8211; update itself</span></span></span></li>
<li><span style="color: #000000;"> <span style="font-size: medium;"><span style="font-family: Calibri;">install &#8211; download file, encrypt with AES and save to %APPDATA%</span></span></span></li>
<li><span style="color: #000000;"><span style="font-size: medium;"><span style="font-family: Calibri;">installexec &#8211; download file, encrypt with AES and save to %APPDATA% and execute afterward</span></span></span></li>
<li><span style="color: #000000;"><span style="font-size: medium;"><span style="font-family: Calibri;">kill &#8211; terminate all own threads</span></span></span></li>
</ul>
<p><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">After reconstruction of the structure of remote commands and the execution algorithm we tried playing with the C&amp;C protocol. We tried to send a status to C&amp;C confirming a successful plugin installation process and fortune smiled upon us: we got a path to the next plugin download: </span></span></span></p>
<p><a href="/wp-content/uploads/2013/07/11.png"><img class="alignnone size-full wp-image-23080" alt="11" src="/wp-content/uploads/2013/07/11.png" width="660" height="29" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/07/11.png 660w, https://www.welivesecurity.com/wp-content/uploads/2013/07/11-300x13.png 300w" sizes="(max-width: 660px) 100vw, 660px" /></a></p>
<p><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">Two different type of plugins were downloaded: the first is a form grabber and the second is a password stealer. All downloaded modules were compiled in July according to the compilation time stamp:</span></span></span></p>
<p><a href="/wp-content/uploads/2013/07/12.png"><img class="alignnone size-medium wp-image-23081" alt="12" src="/wp-content/uploads/2013/07/12-300x123.png" width="300" height="123" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/07/12-300x123.png 300w, https://www.welivesecurity.com/wp-content/uploads/2013/07/12.png 345w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>
<p>[Form Grabber]</p>
<p><a href="/wp-content/uploads/2013/07/13.png"><img class="alignnone size-medium wp-image-23082" alt="13" src="/wp-content/uploads/2013/07/13-300x123.png" width="300" height="123" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/07/13-300x123.png 300w, https://www.welivesecurity.com/wp-content/uploads/2013/07/13.png 344w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>
<p><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">[Password stealer]</span></span></span></p>
<p><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">Win32/Atrax.A is interesting example of a TOR-based botnet with AES encryption for additional plugins and a unique encryption key dependent on hardware parameters of the infected machine for its generation. We continue to track activity for this botnet.</span></span></span></p>
<h2>Win32/Agent.PTA</h2>
<p><span style="color: #000000; font-family: Calibri; font-size: medium;">Another family tracked in July and using a TOR-based communication protocol is </span><a href="http://virusradar.com/en/Win32_Agent.PTA/description"><span style="color: #0563c1; font-family: Calibri; font-size: medium;">Win32/Agent.PTA</span></a><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">. This is not a new malware family and has already been tracked by ESET since 2012. But the TOR-based protocol is new functionality detected during this summer. This trojan also uses TOR hidden service protocol for communicating with command control panel. Agent.PTA has embedded configuration information encrypted by RC4 cypher with C&amp;C addresses inside the TOR network. Decrypted configuration information looks like this:</span></span></span></p>
<p><a href="/wp-content/uploads/2013/07/14.png"><img class="alignnone size-full wp-image-23083" alt="14" src="/wp-content/uploads/2013/07/14.png" width="304" height="111" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/07/14.png 304w, https://www.welivesecurity.com/wp-content/uploads/2013/07/14-300x109.png 300w" sizes="(max-width: 304px) 100vw, 304px" /></a></p>
<p><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">Win32/Agent.PTA is a trojan with a simple form grabber and the ability to download additional plugins. This trojan also can activate a SOCKS5 proxy by receiving a special command from the C&amp;C.  </span></span></span></p>
<h2>Conclusion</h2>
<p><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">This year we had already detected TOR-based botnets but during the summer we have observed a growth in the numbers of malware families starting to use TOR-based communications. The TOR-based botnets make it really hard to pursue investigation and C&amp;C location tracking. But we have demonstrated with Win32/Atrax.A botnet that ways to analyze communication protocols have not changed and all the old tricks work with addresses in a TOR network too.</span></span></span></p>
<p><b><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">Anton Cherepanov, Malware Researcher<br />
</span></span></span></b><b><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">Aleksandr Matrosov, Security Intelligence Team Lead</span></span></span></b></p>
<p><b><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">                                                                                                                      </span></span></span></b></p>
<p><b><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">SHA1 hashes for analyzed samples:</span></span></span></b></p>
<p><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">Win32/TrojanDownloader.Tiny.NIR &#8211;                      7c19ad6b9b229bf559e7cfbbec2d1eb089318b54<br />
</span></span></span><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">Win32/Atrax.A (dropper) &#8211;                                          a7da414a5033cd3178fa5dc2cd52017e5e658b98<br />
</span></span></span><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">Win32/Atrax.B (formgrabber32) &#8211;                             5bcb59b0025ba397d30938d16bc6904475bb3f89<br />
</span></span></span><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">Win32/PSW.Agent.NXG (atraxstealer32) &#8211;            16b7b43625ccba34f67258fa1c4b8017e8d0e747<br />
</span></span></span><span style="font-size: medium;"><span style="color: #000000;"><span style="font-family: Calibri;">Win32/Agent.PTA &#8211;                                                         3a30e858294d214c68d14069c615017626d1b39d</span></span></span></p>
<p><span style="color: #000000; font-family: Calibri; font-size: medium;"> </span></p>
<p>&nbsp;</p>

                            
                                                            <div class="dot">
                                    <span class="icomoon icon-icon_article_dot"></span>
                                </div>

                                <div class="meta">
                                    <div class="wls-authors wls-authors-footer">
                                                                            </div>
                                    <span class="strong">
								        <time datetime="2013-07-24 18:02:33">24 Jul 2013 - 06:02PM</time>
                                    </span>
                                </div>
                            
                            <div class="widgets row">
                                <div class="col-md-12 col-sm-12 col-xs-12">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12 no-padding">
                                        <h3><span class="text">Newsletter</span></h3>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-12 newsletter-wrapper">
                                    			
		<div class="heading-line col-md-12 no-padding sidebar-item clearfix">
			<h3>
				<span class="text">Newsletter</span>
			</h3>

			<form action="//liondigital.us3.list-manage.com/subscribe/post?u=b76f82b1cc198ab1d80665c99&amp;id=102b0810e2" class="basic-searchform col-md-12 col-sm-12 col-xs-12 no-padding newsletter" method="post" role="search">
				<div class="search-input clearfix">
					<input type="text" name="email" value="" placeholder="Email...">
					<button>
						Submit					</button>
				</div>
			</form>		
		</div>
                                </div>
                            </div>

                                                            <div class="similar-articles row">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12">
                                        <h3><span class="text">Similar Articles</span></h3>
                                    </div>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/botnet/" class="category-tag-btn">Botnet</a>                                                <a href="https://www.welivesecurity.com/2020/10/12/eset-takes-part-global-operation-disrupt-trickbot/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2020/10/eset-trickbot-botnet-global-disruption-operation-623x432.jpg"
                                                         alt="The rise of TOR&#8209;based botnets">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2020/10/12/eset-takes-part-global-operation-disrupt-trickbot/">
                                                    ESET takes part in global operation to disrupt Trickbot                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/botnet/" class="category-tag-btn">Botnet</a>                                                <a href="https://www.welivesecurity.com/2020/04/23/eset-discovery-monero-mining-botnet-disrupted/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2020/04/ESET-usb-drives-monero-mining-botnet-disrupted-623x432.jpg"
                                                         alt="The rise of TOR&#8209;based botnets">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2020/04/23/eset-discovery-monero-mining-botnet-disrupted/">
                                                    Following ESET’s discovery, a&nbsp;Monero mining botnet is disrupted                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/botnet/" class="category-tag-btn">Botnet</a>                                                <a href="https://www.welivesecurity.com/2018/11/27/3ve-online-ad-fraud-disrupted/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2018/11/shutterstock_411660106-623x432.jpg"
                                                         alt="The rise of TOR&#8209;based botnets">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2018/11/27/3ve-online-ad-fraud-disrupted/">
                                                    3ve – Major online ad fraud operation disrupted                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/botnet/" class="category-tag-btn">Botnet</a>                                                <a href="https://www.welivesecurity.com/2018/08/21/smart-irrigation-systems-vulnerable-warn-researchers/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2018/08/Irrigation_Systems-623x432.jpg"
                                                         alt="The rise of TOR&#8209;based botnets">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2018/08/21/smart-irrigation-systems-vulnerable-warn-researchers/">
                                                    Smart irrigation systems vulnerable to attacks, warn researchers                                                </a>
                                            </h4>
                                        </article>
                                                                    </div>
                            
                            <div class="comments row">
                                <div class="heading-line col-xs-12">
                                    <h3><span class="text">Discussion</span></h3>
                                                                            
<div id="disqus_thread"></div>
                                                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    	</div> 	<footer id="site-footer">
		<div class="container">
			<div class="row">
				<div class="col-md-2">
                    <div class="hidden-sm hidden-xs">
                        <div class="logo-wrapper footer clearfix">
                            <div class="dark clearfix">
                                <a href="https://www.welivesecurity.com/" class="wls">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-1.svg" alt="Welivesecurity.com">
                                </a>
                                <a href="https://www.eset.com" class="eset">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-2.svg" alt="by ESET">
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="hidden-lg hidden-md">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
				</div>
				<nav id="footer" class="clearfix">
											<div class="mobile-block">
																<div class="col-md-2 col-md-offset-2">
										<ul>
																							<li>
													<a href="/">Home</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/about-us/">About Us</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/contact-us/">Contact Us</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/sitemap/">Sitemap</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/our-experts/">Our Experts</a>
												</li>
																							<li>
													<a href="https://eset.com">ESET</a>
												</li>
																					</ul>
									</div>
													</div>
											<div class="mobile-block">
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/research/">Research</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/category/how-to/">How To</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/categories/">Categories</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/rss-configurator/">RSS Configurator</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/news-widget-generator/">News Widget</a>
												</li>
																					</ul>
									</div>
													</div>
									</nav>
			</div>
			<div class="row">
				<div class="col-md-12 legal clearfix">
					<div class="wrap clearfix">
													<span>
								<a href="https://www.welivesecurity.com/privacy/">
									Privacy policy								</a>
							</span>
													<span>
								<a href="https://www.welivesecurity.com/legal-information/">
									Legal Information								</a>
							</span>
											</div>
					<span class="copyright pull-right">Copyright &copy; ESET, All Rights Reserved</span>
				</div>
							</div>
		</div>
	</footer>
	
	<button id="back-to-top" class="animated-scroll" data-target="absoluteTop">
		<span class="icomoon icon-icon_arrow"></span>
		<span class="text">Back to top</span>
	</button>

			<div class="social-wrapper-mobile hidden-lg hidden-md hidden-sm" id="mobile-article-sharer">
			<div class="col-xs-12">
				<div class="icons" style="text-align: center;">
											<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2013%2F07%2F24%2Fthe-rise-of-tor-based-botnets%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
							<span class="icomoon icon-icon_fb"></span>
						</a>
											<a class="share-twitter" href="https://twitter.com/intent/tweet?https%3A%2F%2Fwww.welivesecurity.com%2F2013%2F07%2F24%2Fthe-rise-of-tor-based-botnets%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
							<span class="icomoon icon-icon_tw"></span>
						</a>
											<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2013%2F07%2F24%2Fthe-rise-of-tor-based-botnets%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
							<span class="icomoon icon-icon_in"></span>
						</a>
									</div>
			</div>
		</div>
	
	<script>
		var baseUrl = "https://www.welivesecurity.com/";
	</script>
	
			<script>
            !function(){if(-1==window.document.cookie.indexOf("user_rec=1")){function e(e,o){var t=document.createElement("img");t.setAttribute("style","display:none"),t.src=e+o,window.document.body.appendChild(t)}function o(){d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Default%20status&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=defaultStatus&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c)}function t(){console.log("GA and GTM are loaded."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=11",e(u,a),e(s,c)}function n(){var e=new Date;e.setTime(e.getTime()+63072e6);var o="expires="+e.toUTCString();window.document.cookie="user_rec=1; "+o+"; path=/"}var d,a,c,i,r,l="UA-76266002-27",g=window.location.href,s="https://cdn1.esetstatic.com/ESET/INT/assets/img/check.png",u="https://www.google-analytics.com/collect",w="wls",m=0,h=function e(){i=window.ga&&ga.create?1:0,r=window.google_tag_manager?1:0,m++,console.log("Timer: ",m),h=setTimeout(e,500)};window.document.addEventListener&&(d=1e6*Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Script%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=scriptLoaded&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c),window.addEventListener("beforeunload",o),window.ga&&ga.create&&window.google_tag_manager?(t(),window.removeEventListener("beforeunload",o),n()):(setTimeout(h,500),setTimeout(function(){clearTimeout(h),i&&r?t():i&&!r?(console.log("GA is loaded and GTM is blocked."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=10",e(u,a),e(s,c)):!i&&r?(console.log("GA is blocked and GTM is loaded."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=01",e(u,a),e(s,c)):i||r||(console.log("GA is blocked and GTM is blocked."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=00",e(u,a),e(s,c)),window.removeEventListener("beforeunload",o),n()},1e4)))}}();
		</script>
	
	<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/js/main-0ba0c3843d.js"></script>
    <!-- Version: v1.1.76.32619db9.pro-awus -->
    		<script type="text/javascript">
			var disqus_config = function () { 
				this.language = "en";
			};
			var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":"", "numsVisible": false};
			var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
		</script>
		<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/static/js/crayon.min.js"></script>

			
		
    <script>
    	Main.init();
    </script>

    <script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"welivesecurity"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_count.js?ver=3.0.16'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var embedVars = {"disqusConfig":{"integration":"wordpress 3.0.16"},"disqusIdentifier":"23066 \/?p=23066","disqusShortname":"welivesecurity","disqusTitle":"The rise of TOR\u2011based botnets","disqusUrl":"https:\/\/www.welivesecurity.com\/2013\/07\/24\/the-rise-of-tor-based-botnets\/","postId":"23066"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_embed.js?ver=3.0.16'></script>
    <script src="https://assets.esetstatic.com/3PR/app.min.js"></script>
  </body>
</html>