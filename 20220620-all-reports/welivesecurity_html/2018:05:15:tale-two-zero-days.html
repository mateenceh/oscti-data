<!doctype html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="google-site-verification" content="_b2avZwzr79oru6lM2Ddae1fNpSIbPaP0H0WNkc2x3k"/>
    <meta name="msvalidate.01" content="CE77828A466C2513F660017CFCB6BA13"/>
    <link rel="icon" href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/favicon.ico">

    

            
    
    <link href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/css/main-8633bd3c28.css" rel="stylesheet">
    <script type="text/javascript"> var appInsights=window.appInsights||function(a){ function b(a){c[a]=function(){var b=arguments;c.queue.push(function(){c[a].apply(c,b)})}}var c={config:a},d=document,e=window;setTimeout(function(){var b=d.createElement("script");b.src=a.url||"https://az416426.vo.msecnd.net/scripts/a/ai.0.js",d.getElementsByTagName("script")[0].parentNode.appendChild(b)});try{c.cookie=d.cookie}catch(a){}c.queue=[];for(var f=["Event","Exception","Metric","PageView","Trace","Dependency"];f.length;)b("track"+f.pop());if(b("setAuthenticatedUserContext"),b("clearAuthenticatedUserContext"),b("startTrackEvent"),b("stopTrackEvent"),b("startTrackPage"),b("stopTrackPage"),b("flush"),!a.disableExceptionTracking){f="onerror",b("_"+f);var g=e[f];e[f]=function(a,b,d,e,h){var i=g&&g(a,b,d,e,h);return!0!==i&&c["_"+f](a,b,d,e,h),i}}return c }({ instrumentationKey:"dcb460fe-684e-4d39-bfcd-d3a6f2710a32" }); window.appInsights=appInsights,appInsights.queue&&0===appInsights.queue.length&&appInsights.trackPageView(); </script>
    <script>
        window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
        'Author': 'Anton Cherepanov',
        'ArticleCategory': 'Vulnerability',
        'ArticleSection': 'Research',
        'cookie-bar-hq': true
    });

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PMDGSM');
</script>
<script>(function() {
  var _fbq = window._fbq || (window._fbq = []);
  if (!_fbq.loaded) {
    var fbds = document.createElement('script');
    fbds.async = true;
    fbds.src = '//connect.facebook.net/en_US/fbds.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(fbds, s);
    _fbq.loaded = true;
  }
  _fbq.push(['addPixelId', '1518099328403839']);
})();
window._fbq = window._fbq || [];
window._fbq.push(['track', 'PixelInitialized', {}]);
</script>
<noscript><img height="1" width="1" alt="" style="display:none" src="https://www.facebook.com/tr?id=1518099328403839&amp;ev=NoScript" /></noscript>
<meta property="fb:pages" content="56844830907" />
<!-- This site is optimized with the Yoast SEO plugin v9.2 - https://yoast.com/wordpress/plugins/seo/ -->
<title>A tale of two zero&#8209;days | WeLiveSecurity</title>
<meta name="description" content="ESET researchers identified a malicious PDF sample that revealed that the sample exploited two unknown vulnerabilities, a remote-code execution vulnerability in Adobe Reader and a privilege escalation vulnerability in Microsoft Windows, that when combined became extremely powerful."/>
<link rel="canonical" href="https://www.welivesecurity.com/2018/05/15/tale-two-zero-days/" />
<meta property="og:locale" content="en_US" />
<meta property="og:locale:alternate" content="pt_BR" />
<meta property="og:locale:alternate" content="fr_FR" />
<meta property="og:locale:alternate" content="de_DE" />
<meta property="og:type" content="article" />
<meta property="og:title" content="A tale of two zero&#8209;days | WeLiveSecurity" />
<meta property="og:description" content="ESET researchers identified a malicious PDF sample that revealed that the sample exploited two unknown vulnerabilities, a remote-code execution vulnerability in Adobe Reader and a privilege escalation vulnerability in Microsoft Windows, that when combined became extremely powerful." />
<meta property="og:url" content="https://www.welivesecurity.com/2018/05/15/tale-two-zero-days/" />
<meta property="og:site_name" content="WeLiveSecurity" />
<meta property="article:section" content="Vulnerability" />
<meta property="article:published_time" content="2018-05-15T12:58:45+00:00" />
<meta property="article:modified_time" content="2018-05-18T00:11:18+00:00" />
<meta property="og:updated_time" content="2018-05-18T00:11:18+00:00" />
<meta property="og:image" content="https://www.welivesecurity.com/wp-content/uploads/2018/05/0Days_PDF-1024x1024.jpg" />
<meta property="og:image:secure_url" content="https://www.welivesecurity.com/wp-content/uploads/2018/05/0Days_PDF-1024x1024.jpg" />
<meta property="og:image:width" content="1024" />
<meta property="og:image:height" content="1024" />
<meta property="og:image:alt" content="PDF sample" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="ESET researchers identified a malicious PDF sample that revealed that the sample exploited two unknown vulnerabilities, a remote-code execution vulnerability in Adobe Reader and a privilege escalation vulnerability in Microsoft Windows, that when combined became extremely powerful." />
<meta name="twitter:title" content="A tale of two zero&#8209;days | WeLiveSecurity" />
<meta name="twitter:site" content="@welivesecurity" />
<meta name="twitter:image" content="https://www.welivesecurity.com/wp-content/uploads/2018/05/0Days_PDF.jpg" />
<meta name="twitter:creator" content="@welivesecurity" />
<!-- / Yoast SEO plugin. -->

<link rel="alternate" href="https://www.welivesecurity.com/br/2018/05/22/vulnerabilidades-zero-day-permitem-atacar-o-windows/" hreflang="pt" />
<link rel="alternate" href="https://www.welivesecurity.com/fr/2018/05/16/deux-vulnerabilites-jour0-pdf/" hreflang="fr" />
<link rel="alternate" href="https://www.welivesecurity.com/2018/05/15/tale-two-zero-days/" hreflang="en" />
<link rel="alternate" href="https://www.welivesecurity.com/la-es/2018/05/21/vulnerabilidades-zero-day-misma-muestra-afecta-adobe-reader-windows/" hreflang="es" />
<link rel="alternate" href="https://www.welivesecurity.com/deutsch/2018/05/16/windows-und-adobe-sicherheitsluecken-aufgedeckt/" hreflang="de" />
<link rel="alternate" type="application/rss+xml" title="WeLiveSecurity RSS 2.0 Feed" href="/rss-configurator/" /><style type="text/css" id="syntaxhighlighteranchor"></style>
        <link id="cookie-style" rel="stylesheet" type="text/css" href="https://assets.esetstatic.com/3PS/cookiebar.min.css">
</head>
<body class="no-js single wide">
<noscript>
	<iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PMDGSM" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div class="main">
    <header id="site-header" class="container">
        <div class="row">
            <div class="col-md-4 col-sm-12 col-xs-12 pull-right" id="header-nav">
                <div class="row">
                    <div class="col-xs-12 mobile-search-input">
                        <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                    </div>
                    <div class="hidden-lg hidden-md col-sm-7 col-xs-8 hidden-xxs">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
                    <div class="col-md-8 hidden-sm hidden-xs languages">
                        <div class="dropdown">
	<button class="btn btn-default dropdown-toggle" type="button" id="main-language-picker" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
    	<span class="text">In English</span>
    	<span class="icomoon icon-icon_arrow"></span>
  	</button>
  	<ul class="dropdown-menu" aria-labelledby="main-language-picker">
            <li>
        <a href="/br/2018/05/22/vulnerabilidades-zero-day-permitem-atacar-o-windows/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/2018/05/16/deux-vulnerabilites-jour0-pdf/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/2018/05/21/vulnerabilidades-zero-day-misma-muestra-afecta-adobe-reader-windows/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/2018/05/16/windows-und-adobe-sicherheitsluecken-aufgedeckt/" title="In Deutsch">
            In Deutsch        </a>
    </li>
      	</ul>
</div>                    </div>
                    <div class="col-md-4 col-sm-2 col-xs-3 menu-trigger">
                        <div class="menu-btn">
	<span class="text">Menu</span>
	<button type="button" id="menu-trigger" class="tcon tcon-menu--xcross" aria-label="toggle menu">
        <span class="wrapper">
            <span class="tcon-menu__lines" aria-hidden="true"></span>
            <span class="tcon-visuallyhidden">toggle menu</span>
        </span>
    </button>
</div>                    </div>
                    <div class="hidden-lg hidden-md hidden-sm hidden-xs col-xs-2 mobile-search imc">
                        <button class="imc">
                            <span class="icomoon icon-icon_search imc"></span>
                        </button>
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12 imc" id="main-menu">
                        <nav class="menu clearfix imc">
                            <ul class="col-md-12 col-sm-6 col-xs-6 imc">
                                                                    <li class="">
                                        <a href="/">
                                            All Posts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/research">
                                            Research                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/category/how-to/">
                                            How To                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/videos/">
                                            Videos                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/podcasts/">
                                            Podcasts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/conference-papers/">
                                            Conference Materials                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/white-papers/">
                                            White Papers                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/threat-reports/">
                                            Threat Reports                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/magazine/">
                                            Magazine                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/our-experts/">
                                            Our Experts                                        </a>
                                    </li>
                                                            </ul>

                            <div class="col-md-12 col-sm-6 col-xs-6 imc">
                                <ul class="languages hidden-lg hidden-md hidden-xxs col-xs-12 imc">
                                        <li>
        <a href="/br/2018/05/22/vulnerabilidades-zero-day-permitem-atacar-o-windows/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/2018/05/16/deux-vulnerabilites-jour0-pdf/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/2018/05/21/vulnerabilidades-zero-day-misma-muestra-afecta-adobe-reader-windows/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/2018/05/16/windows-und-adobe-sicherheitsluecken-aufgedeckt/" title="In Deutsch">
            In Deutsch        </a>
    </li>
                                    </ul>
                                <div class="hidden-lg hidden-md col-xs-12 imc">
                                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="menu-overlay col-md-12 col-sm-12 col-xs-12 imc">
                        <div class="inner imc"></div>
                    </div>
                </div>
                <div class="row hidden-sm hidden-xs">
                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc  col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                </div>
            </div>
            <div class="col-md-5 hidden-sm hidden-xs pull-left" id="header-logo">
                <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                <span class="slogan hidden-sm hidden-xs">
						Award-winning news, views, and insight from the ESET <strong>security community</strong> 
					</span>
            </div>
        </div>
    </header>
        <section id="article-detail">
            <div class="hero-wide" style="background-image: url('../../../../wp-content/uploads/2018/05/0Days_PDF.jpg'); background-position: 50% 50%;">
    <div class="text-wrapper">
        <div class="container promo-text">
            <div class="col-md-11 col-sm-11 col-xs-12 no-padding">
                <h1>A tale of two zero&#8209;days</h1>
<div class="excerpt">Double zero-day vulnerabilities fused into one. A mysterious sample enables attackers to execute arbitrary code with the highest privileges on intended targets</div>
<div class="post-meta">
    <div class="wls-authors">
                <div class="wls-author with-avatar">
                            <div class="wls-author-avatar">
                    <a href="https://www.welivesecurity.com/author/acherepanov/" title="Anton Cherepanov">
                        <img src="https://www.welivesecurity.com/wp-content/uploads/2020/03/Anton_Cherepanov-222x179.jpg" alt="Anton Cherepanov">
                    </a>
                </div>
                        <div class="wls-author-name">
                <a href="https://www.welivesecurity.com/author/acherepanov/" title="Anton Cherepanov">
                    Anton Cherepanov                </a>
            </div>
        </div>
            </div>
    <span class="meta">
		<span class="strong">
			<time datetime="2018-05-15 14:58:45">15 May 2018 - 02:58PM</time>
		</span>
			</span>
</div>
            </div>
        </div>
    </div>
</div>

            <div class="content">
                <div class="social-wrapper" id="social-sharer">
                    <span class="text">Share</span>
	<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2018%2F05%2F15%2Ftale-two-zero-days%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
		<span class="icomoon icon-icon_fb"></span>
	</a>
	<a class="share-twitter" href="https://twitter.com/intent/tweet?&url=https%3A%2F%2Fwww.welivesecurity.com%2F2018%2F05%2F15%2Ftale-two-zero-days%2F&text=A tale of two zero&#8209;days%0A&via=welivesecurity" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
		<span class="icomoon icon-icon_tw"></span>
	</a>
	<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2018%2F05%2F15%2Ftale-two-zero-days%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
		<span class="icomoon icon-icon_in"></span>
	</a>
                </div>
                <div class="container">
                    <div class="row">
                        <div class="col-md-1 col-sm-1 hidden-xs">

                        </div>
                        <div class="col-md-10 col-sm-10 col-xs-12 formatted">

                            <div class="excerpt wide">
                                <p>Double zero-day vulnerabilities fused into one. A mysterious sample enables attackers to execute arbitrary code with the highest privileges on intended targets</p>
                            </div>

                            <p>Late in March 2018, ESET researchers identified an interesting malicious PDF sample. A closer look revealed that the sample exploits two previously unknown vulnerabilities: a remote-code execution vulnerability in Adobe Reader and a privilege escalation vulnerability in Microsoft Windows.</p>
<p>The use of the combined vulnerabilities is extremely powerful, as it allows an attacker to execute arbitrary code with the highest possible privileges on the vulnerable target, and with only the most minimal of user interaction. APT groups regularly use such combinations to perform their attacks, such as in the <a href="https://www.welivesecurity.com/2017/05/09/sednit-adds-two-zero-day-exploits-using-trumps-attack-syria-decoy/">Sednit campaign from last year.</a></p>
<p>Once the PDF sample was discovered, ESET contacted and worked together with the Microsoft Security Response Center, Windows Defender ATP research team, and Adobe Product Security Incident Response Team as they fixed these bugs.</p>
<p>Patches and advisories from Adobe and Microsoft are available here:</p>
<ul>
<li><a href="https://helpx.adobe.com/security/products/acrobat/apsb18-09.html" target="_blank" rel="noopener">APSB18-09</a></li>
<li><a href="https://portal.msrc.microsoft.com/en-us/security-guidance/advisory/CVE-2018-8120" target="_blank" rel="noopener">CVE-2018-8120</a></li>
</ul>
<p>The affected product versions are the following:</p>
<ul>
<li>Acrobat DC (2018.011.20038 and earlier versions)</li>
<li>Acrobat Reader DC (2018.011.20038 and earlier versions )</li>
<li>Acrobat 2017 (011.30079 and earlier versions)</li>
<li>Acrobat Reader DC 2017 (2017.011.30079 and earlier versions)</li>
<li>Acrobat DC (Classic 2015) (2015.006.30417 and earlier versions)</li>
<li>Acrobat Reader DC (Classic 2015) (2015.006.30417 and earlier versions)</li>
<li>Windows 7 for 32-bit Systems Service Pack 1</li>
<li>Windows 7 for x64-based Systems Service Pack 1</li>
<li>Windows Server 2008 for 32-bit Systems Service Pack 2</li>
<li>Windows Server 2008 for Itanium-Based Systems Service Pack 2</li>
<li>Windows Server 2008 for x64-based Systems Service Pack 2</li>
<li>Windows Server 2008 R2 for Itanium-Based Systems Service Pack 1</li>
<li>Windows Server 2008 R2 for x64-based Systems Service Pack 1</li>
</ul>
<p>This blog covers technical details of the malicious sample and the vulnerabilities it exploited.</p>
<h2>Introduction</h2>
<p>PDF (Portable Document Format) is a file format for electronic documents and as with other popular document formats, it can be used by attackers to deliver malware to a victim’s computer. In order to execute their own malicious code, attackers have to find and exploit vulnerabilities in PDF viewer software. There are several PDF viewers; one very popular viewer is Adobe Reader.</p>
<p>The Adobe Reader software implements a security feature called a sandbox, also known in the viewer as Protected Mode. The detailed technical description of the sandbox implementation was published on Adobe’s blog pages in four parts (<a href="http://blogs.adobe.com/security/2010/10/inside-adobe-reader-protected-mode-part-1-design.html" target="_blank" rel="noopener">Part 1</a>, <a href="http://blogs.adobe.com/security/2010/10/inside-adobe-reader-protected-mode-part-2-the-sandbox-process.html" target="_blank" rel="noopener">Part 2</a>, <a href="http://blogs.adobe.com/security/2010/11/inside-adobe-reader-protected-mode-part-3-broker-process-policies-and-inter-process-communication.html" target="_blank" rel="noopener">Part 3</a>, <a href="http://blogs.adobe.com/security/2010/11/inside-adobe-reader-protected-mode-part-4-the-challenge-of-sandboxing.html" target="_blank" rel="noopener">Part 4</a>). The sandbox makes the exploitation process harder: even if code execution is achieved, the attacker still would have to bypass the sandbox’s protections in order to compromise the computer running Adobe Reader. Usually, sandbox bypass is achieved by exploiting a vulnerability in the operating system itself.</p>
<p>This is a rare case when the attackers were able to find vulnerabilities and write exploits for the Adobe Reader software and the operating system.</p>
<h2>CVE-2018-4990 – RCE in Adobe Reader</h2>
<p>The malicious PDF sample embeds JavaScript code that controls the whole exploitation process. Once the PDF file is opened, the JavaScript code is executed.</p>
<p>At the beginning of exploitation, the JavaScript code starts to manipulate the <span style="font-family: courier\ new, courier, monospace;">Button1</span> object. This object contains a specially crafted JPEG2000 image, which triggers a double-free vulnerability in Adobe Reader.</p>
<div id="attachment_111619" style="width: 345px" class="wp-caption aligncenter"><a href="/wp-content/uploads/2018/05/image1.png"><img class="wp-image-111619 size-full" src="/wp-content/uploads/2018/05/image1.png" alt="" width="335" height="253" srcset="https://www.welivesecurity.com/wp-content/uploads/2018/05/image1.png 335w, https://www.welivesecurity.com/wp-content/uploads/2018/05/image1-300x227.png 300w" sizes="(max-width: 335px) 100vw, 335px" /></a><p class="wp-caption-text">Figure 1. JavaScript code that manipulates the Button1 object</p></div>
<p>The JavaScript uses heap-spray techniques in order to corrupt internal data structures. After all these manipulations the attackers achieve their main goal: read and write memory access from their JavaScript code.</p>
<div id="attachment_111620" style="width: 343px" class="wp-caption aligncenter"><a href="/wp-content/uploads/2018/05/image2.png"><img class="size-full wp-image-111620" src="/wp-content/uploads/2018/05/image2.png" alt="" width="333" height="204" srcset="https://www.welivesecurity.com/wp-content/uploads/2018/05/image2.png 333w, https://www.welivesecurity.com/wp-content/uploads/2018/05/image2-300x184.png 300w" sizes="(max-width: 333px) 100vw, 333px" /></a><p class="wp-caption-text">Figure 2. JavaScript code used for reading and writing memory</p></div>
<p>Using these two primitives, the attacker locates the memory address of the <span style="font-family: courier\ new, courier, monospace;">EScript.api</span> plugin, which is the Adobe JavaScript engine. Using assembly instructions (ROP gadgets) from that module, the malicious JavaScript sets up a ROP chain that would lead to the execution of native shellcode.</p>
<div id="attachment_111621" style="width: 655px" class="wp-caption aligncenter"><a href="/wp-content/uploads/2018/05/image3.png"><img class="size-full wp-image-111621" src="/wp-content/uploads/2018/05/image3.png" alt="" width="645" height="443" srcset="https://www.welivesecurity.com/wp-content/uploads/2018/05/image3.png 645w, https://www.welivesecurity.com/wp-content/uploads/2018/05/image3-300x206.png 300w, https://www.welivesecurity.com/wp-content/uploads/2018/05/image3-151x103.png 151w" sizes="(max-width: 645px) 100vw, 645px" /></a><p class="wp-caption-text">Figure 3. Malicious JavaScript that builds a ROP chain</p></div>
<p>As the final step, the shellcode initializes a PE file embedded in the PDF and passes execution to it.</p>
<h2>CVE-2018-8120 – Privilege escalation in Microsoft Windows</h2>
<p>After having exploited the Adobe Reader vulnerability, the attacker has to break the sandbox. This is exactly the purpose of the second exploit we are discussing.</p>
<p>The root cause of this previously unknown vulnerability is located in the <span style="font-family: courier\ new, courier, monospace;">NtUserSetImeInfoEx</span> function of the <span style="font-family: courier\ new, courier, monospace;">win32k</span> Windows kernel component. Specifically, the <span style="font-family: courier\ new, courier, monospace;">SetImeInfoEx</span> subroutine of <span style="font-family: courier\ new, courier, monospace;">NtUserSetImeInfoEx</span> does not validate a data pointer, allowing a NULL pointer dereference.</p>
<div id="attachment_111622" style="width: 809px" class="wp-caption aligncenter"><a href="/wp-content/uploads/2018/05/image4.png"><img class="size-full wp-image-111622" src="/wp-content/uploads/2018/05/image4.png" alt="" width="799" height="549" srcset="https://www.welivesecurity.com/wp-content/uploads/2018/05/image4.png 799w, https://www.welivesecurity.com/wp-content/uploads/2018/05/image4-300x206.png 300w, https://www.welivesecurity.com/wp-content/uploads/2018/05/image4-768x528.png 768w, https://www.welivesecurity.com/wp-content/uploads/2018/05/image4-151x103.png 151w" sizes="(max-width: 799px) 100vw, 799px" /></a><p class="wp-caption-text">Figure 4. Disassembled SetImeInfoEx routine</p></div>
<p>As is evident in Figure 4, the <span style="font-family: courier\ new, courier, monospace;">SetImeInfoEx</span> function expects a pointer to an initialized WINDOWSTATION object as the first argument. The <span style="font-family: courier\ new, courier, monospace;">spklList</span> could be equal to zero if the attacker creates a new window station object and assigns it to the current process in user-mode. Thus, by mapping the NULL page and setting a pointer to offset 0x2C, the attacker can leverage this vulnerability to write to an arbitrary address in the kernel space. It should be noted that since Windows 8, a user process is not allowed to map the NULL page.</p>
<p>Since the attacker has arbitrary write primitive they could use different techniques, but in this case, the attacker chooses to use a technique described by <a href="http://www.ivanlef0u.tuxfamily.org/?p=86" target="_blank" rel="noopener">Ivanlef0u</a> and <a href="http://j00ru.vexillium.org/?p=290" target="_blank" rel="noopener">Mateusz &#8220;j00ru&#8221; Jurczyk and Gynvael Coldwin</a>. The attacker sets up a <a href="https://en.wikipedia.org/wiki/Call_gate_(Intel)" target="_blank" rel="noopener">call gate</a> to Ring 0 by rewriting the Global Descriptor Table (GDT). To do so an attacker gets the address of the original GDT using the SGDT assembly instruction, constructs their own table and then rewrites the original one using the above-mentioned vulnerability.</p>
<p>Then the exploit uses the <span style="font-family: courier\ new, courier, monospace;">CALL FAR</span> instruction to perform an inter-privilege level call.</p>
<div id="attachment_111623" style="width: 539px" class="wp-caption aligncenter"><a href="/wp-content/uploads/2018/05/image5.png"><img class="size-full wp-image-111623" src="/wp-content/uploads/2018/05/image5.png" alt="" width="529" height="106" srcset="https://www.welivesecurity.com/wp-content/uploads/2018/05/image5.png 529w, https://www.welivesecurity.com/wp-content/uploads/2018/05/image5-300x60.png 300w, https://www.welivesecurity.com/wp-content/uploads/2018/05/image5-522x106.png 522w" sizes="(max-width: 529px) 100vw, 529px" /></a><p class="wp-caption-text">Figure 5. The disassembled CALL FAR instruction</p></div>
<p>Once the code is executed in kernel mode, the exploit replaces the token of the current process with the system token.</p>
<h2>Conclusion</h2>
<p>Initially, ESET researchers discovered the PDF sample when it was uploaded to a public repository of malicious samples. The sample does not contain a final payload, which may suggest that it was caught during its early development stages. Even though the sample does not contain a real malicious final payload, the author(s) demonstrated a high level of skills in vulnerability discovery and exploit writing.</p>
<h2>Indicators of Compromise (IoC)</h2>

<table id="tablepress-550" class="tablepress tablepress-id-550">
<thead>
<tr class="row-1 odd">
	<th class="column-1"><strong>ESET detection names</strong></th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1">JS/Exploit.Pdfka.QNV trojan</td>
</tr>
<tr class="row-3 odd">
	<td class="column-1">Win32/Exploit.CVE-2018-8120.A trojan</td>
</tr>
<tr class="row-4 even">
	<td class="column-1"><strong>SHA-1 hashes</strong></td>
</tr>
<tr class="row-5 odd">
	<td class="column-1">C82CFEAD292EECA601D3CF82C8C5340CB579D1C6</td>
</tr>
<tr class="row-6 even">
	<td class="column-1">0D3F335CCCA4575593054446F5F219EBA6CD93FE</td>
</tr>
</tbody>
</table>


                            
                                                            <div class="dot">
                                    <span class="icomoon icon-icon_article_dot"></span>
                                </div>

                                <div class="meta">
                                    <div class="wls-authors wls-authors-footer">
                                                <div class="wls-author">
                        <div class="wls-author-name">
                <a href="https://www.welivesecurity.com/author/acherepanov/" title="Anton Cherepanov">
                    Anton Cherepanov                </a>
            </div>
        </div>
                                            </div>
                                    <span class="strong">
								        <time datetime="2018-05-15 14:58:45">15 May 2018 - 02:58PM</time>
                                    </span>
                                </div>
                            
                            <div class="widgets row">
                                <div class="col-md-12 col-sm-12 col-xs-12">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12 no-padding">
                                        <h3><span class="text">Newsletter</span></h3>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-12 newsletter-wrapper">
                                    			
		<div class="heading-line col-md-12 no-padding sidebar-item clearfix">
			<h3>
				<span class="text">Newsletter</span>
			</h3>

			<form action="//liondigital.us3.list-manage.com/subscribe/post?u=b76f82b1cc198ab1d80665c99&amp;id=102b0810e2" class="basic-searchform col-md-12 col-sm-12 col-xs-12 no-padding newsletter" method="post" role="search">
				<div class="search-input clearfix">
					<input type="text" name="email" value="" placeholder="Email...">
					<button>
						Submit					</button>
				</div>
			</form>		
		</div>
                                </div>
                            </div>

                                                            <div class="similar-articles row">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12">
                                        <h3><span class="text">Similar Articles</span></h3>
                                    </div>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/vulnerability/" class="category-tag-btn">Vulnerability</a>                                                <a href="https://www.welivesecurity.com/2021/03/16/google-fixes-chrome-zero-day-bug-exploited-wild/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/03/google-chrome-zero-day-patch.jpg"
                                                         alt="A tale of two zero&#8209;days">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/03/16/google-fixes-chrome-zero-day-bug-exploited-wild/">
                                                    Google fixes Chrome zero-day bug exploited in the wild                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/vulnerability/" class="category-tag-btn">Vulnerability</a>                                                <a href="https://www.welivesecurity.com/2021/03/04/microsoft-fixes-four-exchange-server-zero-day-vulnerabilities/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/03/shutterstock_785514268-623x432.jpg"
                                                         alt="A tale of two zero&#8209;days">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/03/04/microsoft-fixes-four-exchange-server-zero-day-vulnerabilities/">
                                                    Microsoft rushes out fixes for four zero-day flaws in Exchange Server                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/vulnerability/" class="category-tag-btn">Vulnerability</a>                                                <a href="https://www.welivesecurity.com/2021/02/15/record-breaking-number-vulnerabilities-reported-2020/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/02/vulnerabilities-reports-2020-record-623x427.jpg"
                                                         alt="A tale of two zero&#8209;days">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/02/15/record-breaking-number-vulnerabilities-reported-2020/">
                                                    Record-high number of vulnerabilities reported in 2020                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/vulnerability/" class="category-tag-btn">Vulnerability</a>                                                <a href="https://www.welivesecurity.com/2021/02/10/microsoft-patches-windows-kernel-flaw/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2020/11/Patch-tuesday-fixes-17-critical-bugs-windows-zeroday.jpg"
                                                         alt="A tale of two zero&#8209;days">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/02/10/microsoft-patches-windows-kernel-flaw/">
                                                    Microsoft patches actively exploited Windows kernel flaw                                                </a>
                                            </h4>
                                        </article>
                                                                    </div>
                            
                            <div class="comments row">
                                <div class="heading-line col-xs-12">
                                    <h3><span class="text">Discussion</span></h3>
                                                                            
<div id="disqus_thread"></div>
                                                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    	</div> 	<footer id="site-footer">
		<div class="container">
			<div class="row">
				<div class="col-md-2">
                    <div class="hidden-sm hidden-xs">
                        <div class="logo-wrapper footer clearfix">
                            <div class="dark clearfix">
                                <a href="https://www.welivesecurity.com/" class="wls">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-1.svg" alt="Welivesecurity.com">
                                </a>
                                <a href="https://www.eset.com" class="eset">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-2.svg" alt="by ESET">
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="hidden-lg hidden-md">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
				</div>
				<nav id="footer" class="clearfix">
											<div class="mobile-block">
																<div class="col-md-2 col-md-offset-2">
										<ul>
																							<li>
													<a href="/">Home</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/about-us/">About Us</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/contact-us/">Contact Us</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/sitemap/">Sitemap</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/our-experts/">Our Experts</a>
												</li>
																							<li>
													<a href="https://eset.com">ESET</a>
												</li>
																					</ul>
									</div>
													</div>
											<div class="mobile-block">
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/research/">Research</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/category/how-to/">How To</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/categories/">Categories</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/rss-configurator/">RSS Configurator</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/news-widget-generator/">News Widget</a>
												</li>
																					</ul>
									</div>
													</div>
									</nav>
			</div>
			<div class="row">
				<div class="col-md-12 legal clearfix">
					<div class="wrap clearfix">
													<span>
								<a href="https://www.welivesecurity.com/privacy/">
									Privacy policy								</a>
							</span>
													<span>
								<a href="https://www.welivesecurity.com/legal-information/">
									Legal Information								</a>
							</span>
											</div>
					<span class="copyright pull-right">Copyright &copy; ESET, All Rights Reserved</span>
				</div>
							</div>
		</div>
	</footer>
	
	<button id="back-to-top" class="animated-scroll" data-target="absoluteTop">
		<span class="icomoon icon-icon_arrow"></span>
		<span class="text">Back to top</span>
	</button>

			<div class="social-wrapper-mobile hidden-lg hidden-md hidden-sm" id="mobile-article-sharer">
			<div class="col-xs-12">
				<div class="icons" style="text-align: center;">
											<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2018%2F05%2F15%2Ftale-two-zero-days%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
							<span class="icomoon icon-icon_fb"></span>
						</a>
											<a class="share-twitter" href="https://twitter.com/intent/tweet?https%3A%2F%2Fwww.welivesecurity.com%2F2018%2F05%2F15%2Ftale-two-zero-days%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
							<span class="icomoon icon-icon_tw"></span>
						</a>
											<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2018%2F05%2F15%2Ftale-two-zero-days%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
							<span class="icomoon icon-icon_in"></span>
						</a>
									</div>
			</div>
		</div>
	
	<script>
		var baseUrl = "https://www.welivesecurity.com/";
	</script>
	
			<script>
            !function(){if(-1==window.document.cookie.indexOf("user_rec=1")){function e(e,o){var t=document.createElement("img");t.setAttribute("style","display:none"),t.src=e+o,window.document.body.appendChild(t)}function o(){d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Default%20status&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=defaultStatus&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c)}function t(){console.log("GA and GTM are loaded."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=11",e(u,a),e(s,c)}function n(){var e=new Date;e.setTime(e.getTime()+63072e6);var o="expires="+e.toUTCString();window.document.cookie="user_rec=1; "+o+"; path=/"}var d,a,c,i,r,l="UA-76266002-27",g=window.location.href,s="https://cdn1.esetstatic.com/ESET/INT/assets/img/check.png",u="https://www.google-analytics.com/collect",w="wls",m=0,h=function e(){i=window.ga&&ga.create?1:0,r=window.google_tag_manager?1:0,m++,console.log("Timer: ",m),h=setTimeout(e,500)};window.document.addEventListener&&(d=1e6*Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Script%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=scriptLoaded&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c),window.addEventListener("beforeunload",o),window.ga&&ga.create&&window.google_tag_manager?(t(),window.removeEventListener("beforeunload",o),n()):(setTimeout(h,500),setTimeout(function(){clearTimeout(h),i&&r?t():i&&!r?(console.log("GA is loaded and GTM is blocked."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=10",e(u,a),e(s,c)):!i&&r?(console.log("GA is blocked and GTM is loaded."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=01",e(u,a),e(s,c)):i||r||(console.log("GA is blocked and GTM is blocked."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=00",e(u,a),e(s,c)),window.removeEventListener("beforeunload",o),n()},1e4)))}}();
		</script>
	
	<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/js/main-0ba0c3843d.js"></script>
    <!-- Version: v1.1.76.32619db9.pro-azeu -->
    		<script type="text/javascript">
			var disqus_config = function () { 
				this.language = "en";
			};
			var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":"", "numsVisible": false};
			var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
		</script>
		<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/static/js/crayon.min.js"></script>

			
		
    <script>
    	Main.init();
    </script>

    <script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"welivesecurity"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_count.js?ver=3.0.16'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var embedVars = {"disqusConfig":{"integration":"wordpress 3.0.16"},"disqusIdentifier":"111616 https:\/\/ba-infohub-web01-v.hq.eset.com\/?p=111616","disqusShortname":"welivesecurity","disqusTitle":"A tale of two zero\u2011days","disqusUrl":"https:\/\/www.welivesecurity.com\/2018\/05\/15\/tale-two-zero-days\/","postId":"111616"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_embed.js?ver=3.0.16'></script>
    <script src="https://assets.esetstatic.com/3PR/app.min.js"></script>
  </body>
</html>