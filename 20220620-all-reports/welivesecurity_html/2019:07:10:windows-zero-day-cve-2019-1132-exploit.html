<!doctype html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="google-site-verification" content="_b2avZwzr79oru6lM2Ddae1fNpSIbPaP0H0WNkc2x3k"/>
    <meta name="msvalidate.01" content="CE77828A466C2513F660017CFCB6BA13"/>
    <link rel="icon" href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/favicon.ico">

    

            
    
    <link href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/css/main-8633bd3c28.css" rel="stylesheet">
    <script type="text/javascript"> var appInsights=window.appInsights||function(a){ function b(a){c[a]=function(){var b=arguments;c.queue.push(function(){c[a].apply(c,b)})}}var c={config:a},d=document,e=window;setTimeout(function(){var b=d.createElement("script");b.src=a.url||"https://az416426.vo.msecnd.net/scripts/a/ai.0.js",d.getElementsByTagName("script")[0].parentNode.appendChild(b)});try{c.cookie=d.cookie}catch(a){}c.queue=[];for(var f=["Event","Exception","Metric","PageView","Trace","Dependency"];f.length;)b("track"+f.pop());if(b("setAuthenticatedUserContext"),b("clearAuthenticatedUserContext"),b("startTrackEvent"),b("stopTrackEvent"),b("startTrackPage"),b("stopTrackPage"),b("flush"),!a.disableExceptionTracking){f="onerror",b("_"+f);var g=e[f];e[f]=function(a,b,d,e,h){var i=g&&g(a,b,d,e,h);return!0!==i&&c["_"+f](a,b,d,e,h),i}}return c }({ instrumentationKey:"dcb460fe-684e-4d39-bfcd-d3a6f2710a32" }); window.appInsights=appInsights,appInsights.queue&&0===appInsights.queue.length&&appInsights.trackPageView(); </script>
    <script>
        window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
        'Author': 'Anton Cherepanov',
        'ArticleCategory': 'Vulnerability',
        'ArticleSection': 'Research',
        'cookie-bar-hq': true
    });

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PMDGSM');
</script>
<script>(function() {
  var _fbq = window._fbq || (window._fbq = []);
  if (!_fbq.loaded) {
    var fbds = document.createElement('script');
    fbds.async = true;
    fbds.src = '//connect.facebook.net/en_US/fbds.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(fbds, s);
    _fbq.loaded = true;
  }
  _fbq.push(['addPixelId', '1518099328403839']);
})();
window._fbq = window._fbq || [];
window._fbq.push(['track', 'PixelInitialized', {}]);
</script>
<noscript><img height="1" width="1" alt="" style="display:none" src="https://www.facebook.com/tr?id=1518099328403839&amp;ev=NoScript" /></noscript>
<meta property="fb:pages" content="56844830907" />
<!-- This site is optimized with the Yoast SEO plugin v9.2 - https://yoast.com/wordpress/plugins/seo/ -->
<title>Windows zero&#8209;day CVE&#8209;2019&#8209;1132 exploited in targeted attacks | WeLiveSecurity</title>
<meta name="description" content="ESET research uncovers a zero-day exploit that leverages a vulnerability in Windows and has been deployed for a surgically targeted attack."/>
<link rel="canonical" href="https://www.welivesecurity.com/2019/07/10/windows-zero-day-cve-2019-1132-exploit/" />
<meta property="og:locale" content="en_US" />
<meta property="og:locale:alternate" content="pt_BR" />
<meta property="og:locale:alternate" content="fr_FR" />
<meta property="og:locale:alternate" content="de_DE" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Windows zero&#8209;day CVE&#8209;2019&#8209;1132 exploited in targeted attacks | WeLiveSecurity" />
<meta property="og:description" content="ESET research uncovers a zero-day exploit that leverages a vulnerability in Windows and has been deployed for a surgically targeted attack." />
<meta property="og:url" content="https://www.welivesecurity.com/2019/07/10/windows-zero-day-cve-2019-1132-exploit/" />
<meta property="og:site_name" content="WeLiveSecurity" />
<meta property="article:section" content="Vulnerability" />
<meta property="article:published_time" content="2019-07-10T09:30:42+00:00" />
<meta property="article:modified_time" content="2020-01-18T18:40:34+00:00" />
<meta property="og:updated_time" content="2020-01-18T18:40:34+00:00" />
<meta property="og:image" content="https://www.welivesecurity.com/wp-content/uploads/2019/07/zero-M.jpg" />
<meta property="og:image:secure_url" content="https://www.welivesecurity.com/wp-content/uploads/2019/07/zero-M.jpg" />
<meta property="og:image:width" content="1024" />
<meta property="og:image:height" content="768" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="ESET research uncovers a zero-day exploit that leverages a vulnerability in Windows and has been deployed for a surgically targeted attack." />
<meta name="twitter:title" content="Windows zero&#8209;day CVE&#8209;2019&#8209;1132 exploited in targeted attacks | WeLiveSecurity" />
<meta name="twitter:site" content="@welivesecurity" />
<meta name="twitter:image" content="https://www.welivesecurity.com/wp-content/uploads/2019/07/zero-M.jpg" />
<meta name="twitter:creator" content="@welivesecurity" />
<!-- / Yoast SEO plugin. -->

<link rel="alternate" href="https://www.welivesecurity.com/br/2019/07/11/vulnerabilidade-0-day-no-windows-e-explorada-em-ataques-direcionados/" hreflang="pt" />
<link rel="alternate" href="https://www.welivesecurity.com/fr/2019/07/10/exploit-zero-windows-attaques-ciblees/" hreflang="fr" />
<link rel="alternate" href="https://www.welivesecurity.com/2019/07/10/windows-zero-day-cve-2019-1132-exploit/" hreflang="en" />
<link rel="alternate" href="https://www.welivesecurity.com/la-es/2019/07/10/vulnerabilidad-zero-day-en-windows-explotada-en-ataques-dirigidos/" hreflang="es" />
<link rel="alternate" href="https://www.welivesecurity.com/deutsch/2019/07/10/windows-cve-2019-1132-exploit/" hreflang="de" />
<link rel="alternate" type="application/rss+xml" title="WeLiveSecurity RSS 2.0 Feed" href="/rss-configurator/" /><style type="text/css" id="syntaxhighlighteranchor"></style>
        <link id="cookie-style" rel="stylesheet" type="text/css" href="https://assets.esetstatic.com/3PS/cookiebar.min.css">
</head>
<body class="no-js single wide">
<noscript>
	<iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PMDGSM" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div class="main">
    <header id="site-header" class="container">
        <div class="row">
            <div class="col-md-4 col-sm-12 col-xs-12 pull-right" id="header-nav">
                <div class="row">
                    <div class="col-xs-12 mobile-search-input">
                        <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                    </div>
                    <div class="hidden-lg hidden-md col-sm-7 col-xs-8 hidden-xxs">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
                    <div class="col-md-8 hidden-sm hidden-xs languages">
                        <div class="dropdown">
	<button class="btn btn-default dropdown-toggle" type="button" id="main-language-picker" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
    	<span class="text">In English</span>
    	<span class="icomoon icon-icon_arrow"></span>
  	</button>
  	<ul class="dropdown-menu" aria-labelledby="main-language-picker">
            <li>
        <a href="/br/2019/07/11/vulnerabilidade-0-day-no-windows-e-explorada-em-ataques-direcionados/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/2019/07/10/exploit-zero-windows-attaques-ciblees/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/2019/07/10/vulnerabilidad-zero-day-en-windows-explotada-en-ataques-dirigidos/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/2019/07/10/windows-cve-2019-1132-exploit/" title="In Deutsch">
            In Deutsch        </a>
    </li>
      	</ul>
</div>                    </div>
                    <div class="col-md-4 col-sm-2 col-xs-3 menu-trigger">
                        <div class="menu-btn">
	<span class="text">Menu</span>
	<button type="button" id="menu-trigger" class="tcon tcon-menu--xcross" aria-label="toggle menu">
        <span class="wrapper">
            <span class="tcon-menu__lines" aria-hidden="true"></span>
            <span class="tcon-visuallyhidden">toggle menu</span>
        </span>
    </button>
</div>                    </div>
                    <div class="hidden-lg hidden-md hidden-sm hidden-xs col-xs-2 mobile-search imc">
                        <button class="imc">
                            <span class="icomoon icon-icon_search imc"></span>
                        </button>
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12 imc" id="main-menu">
                        <nav class="menu clearfix imc">
                            <ul class="col-md-12 col-sm-6 col-xs-6 imc">
                                                                    <li class="">
                                        <a href="/">
                                            All Posts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/research">
                                            Research                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/category/how-to/">
                                            How To                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/videos/">
                                            Videos                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/podcasts/">
                                            Podcasts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/conference-papers/">
                                            Conference Materials                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/white-papers/">
                                            White Papers                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/threat-reports/">
                                            Threat Reports                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/magazine/">
                                            Magazine                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/our-experts/">
                                            Our Experts                                        </a>
                                    </li>
                                                            </ul>

                            <div class="col-md-12 col-sm-6 col-xs-6 imc">
                                <ul class="languages hidden-lg hidden-md hidden-xxs col-xs-12 imc">
                                        <li>
        <a href="/br/2019/07/11/vulnerabilidade-0-day-no-windows-e-explorada-em-ataques-direcionados/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/2019/07/10/exploit-zero-windows-attaques-ciblees/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/2019/07/10/vulnerabilidad-zero-day-en-windows-explotada-en-ataques-dirigidos/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/2019/07/10/windows-cve-2019-1132-exploit/" title="In Deutsch">
            In Deutsch        </a>
    </li>
                                    </ul>
                                <div class="hidden-lg hidden-md col-xs-12 imc">
                                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="menu-overlay col-md-12 col-sm-12 col-xs-12 imc">
                        <div class="inner imc"></div>
                    </div>
                </div>
                <div class="row hidden-sm hidden-xs">
                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc  col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                </div>
            </div>
            <div class="col-md-5 hidden-sm hidden-xs pull-left" id="header-logo">
                <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                <span class="slogan hidden-sm hidden-xs">
						Award-winning news, views, and insight from the ESET <strong>security community</strong> 
					</span>
            </div>
        </div>
    </header>
        <section id="article-detail">
            <div class="hero-wide" style="background-image: url('../../../../wp-content/uploads/2019/07/zero-3.jpg'); background-position: 50% 50%;">
    <div class="text-wrapper">
        <div class="container promo-text">
            <div class="col-md-11 col-sm-11 col-xs-12 no-padding">
                <h1>Windows zero&#8209;day CVE&#8209;2019&#8209;1132 exploited in targeted attacks</h1>
<div class="excerpt">ESET research discovers a zero-day exploit that takes advantage of a local privilege escalation vulnerability in Windows</div>
<div class="post-meta">
    <div class="wls-authors">
                <div class="wls-author with-avatar">
                            <div class="wls-author-avatar">
                    <a href="https://www.welivesecurity.com/author/acherepanov/" title="Anton Cherepanov">
                        <img src="https://www.welivesecurity.com/wp-content/uploads/2020/03/Anton_Cherepanov-222x179.jpg" alt="Anton Cherepanov">
                    </a>
                </div>
                        <div class="wls-author-name">
                <a href="https://www.welivesecurity.com/author/acherepanov/" title="Anton Cherepanov">
                    Anton Cherepanov                </a>
            </div>
        </div>
            </div>
    <span class="meta">
		<span class="strong">
			<time datetime="2019-07-10 11:30:42">10 Jul 2019 - 11:30AM</time>
		</span>
			</span>
</div>
            </div>
        </div>
    </div>
</div>

            <div class="content">
                <div class="social-wrapper" id="social-sharer">
                    <span class="text">Share</span>
	<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2019%2F07%2F10%2Fwindows-zero-day-cve-2019-1132-exploit%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
		<span class="icomoon icon-icon_fb"></span>
	</a>
	<a class="share-twitter" href="https://twitter.com/intent/tweet?&url=https%3A%2F%2Fwww.welivesecurity.com%2F2019%2F07%2F10%2Fwindows-zero-day-cve-2019-1132-exploit%2F&text=Windows zero&#8209;day CVE&#8209;2019&#8209;1132 exploited in targeted attacks%0A&via=welivesecurity" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
		<span class="icomoon icon-icon_tw"></span>
	</a>
	<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2019%2F07%2F10%2Fwindows-zero-day-cve-2019-1132-exploit%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
		<span class="icomoon icon-icon_in"></span>
	</a>
                </div>
                <div class="container">
                    <div class="row">
                        <div class="col-md-1 col-sm-1 hidden-xs">

                        </div>
                        <div class="col-md-10 col-sm-10 col-xs-12 formatted">

                            <div class="excerpt wide">
                                <p>ESET research discovers a zero-day exploit that takes advantage of a local privilege escalation vulnerability in Windows</p>
                            </div>

                            <p>In June 2019, ESET researchers identified a zero-day exploit being used in a highly targeted attack in Eastern Europe.</p>
<p>The exploit abuses a local privilege escalation vulnerability in Microsoft Windows, specifically a NULL pointer dereference in the <span style="font-family: courier new, courier, monospace;">win32k.sys</span> component. Once the exploit was discovered and analyzed, it was reported to the Microsoft Security Response Center, who promptly fixed the vulnerability and released a <a href="https://portal.msrc.microsoft.com/en-us/security-guidance/advisory/CVE-2019-1132" target="_blank" rel="noopener">patch</a>.</p>
<p>The vulnerability affects the following Windows versions:</p>
<ul>
<li>Windows 7 for 32-bit Systems Service Pack 1</li>
<li>Windows 7 for x64-based Systems Service Pack 1</li>
<li>Windows Server 2008 for 32-bit Systems Service Pack 2</li>
<li>Windows Server 2008 for Itanium-Based Systems Service Pack 2</li>
<li>Windows Server 2008 for x64-based Systems Service Pack 2</li>
<li>Windows Server 2008 R2 for Itanium-Based Systems Service Pack 1</li>
<li>Windows Server 2008 R2 for x64-based Systems Service Pack 1</li>
</ul>
<p>This blog post focuses on the technical details of the vulnerability and its exploitation. <a href="https://www.welivesecurity.com/2019/07/11/buhtrap-zero-day-espionage-campaigns/" target="_blank" rel="noopener">Another post</a> delves into the malware sample and its broader implications.</p>
<h2>Exploitation</h2>
<p>As with a number of other Microsoft Windows <span style="font-family: courier new, courier, monospace;">win32k.sys</span> vulnerabilities disclosed in recent years, this exploit uses popup menu objects. For example, the Sednit group’s local privilege escalation exploit that <a href="https://www.welivesecurity.com/2017/05/09/sednit-adds-two-zero-day-exploits-using-trumps-attack-syria-decoy/" target="_blank" rel="noopener">we analyzed in 2017</a> used menu objects and techniques very similar to the current exploit.</p>
<p>This exploit creates two windows; one for the first stage and another one for the second stage of the exploitation. For the first window, it creates popup menu objects and appends menu items using the <span style="font-family: courier new, courier, monospace;">CreatePopupMenu</span> and <span style="font-family: courier new, courier, monospace;">AppendMenu</span> functions. In addition, the exploit sets up <span style="font-family: courier new, courier, monospace;">WH_CALLWNDPROC</span> and <span style="font-family: courier new, courier, monospace;">EVENT_SYSTEM_MENUPOPUPSTART</span> hooks.</p>
<p>Then the exploit displays a menu using the <span style="font-family: courier new, courier, monospace;">TrackPopupMenu</span> function. At this point the code hooked to <span style="font-family: courier new, courier, monospace;">EVENT_SYSTEM_MENUPOPUPSTART</span> gets executed. This code attempts to open as the first available item in the menu, by sending a sequence of <span style="font-family: courier new, courier, monospace;">MN_SELECTITEM</span>, <span style="font-family: courier new, courier, monospace;">MN_SELECTFIRSTVALIDITEM</span> and <span style="font-family: courier new, courier, monospace;">MN_OPENHIERARCHY</span> messages to the menu.</p>
<p>The next step is very important for triggering this vulnerability. The exploit must catch the moment in time when the initial menu is already created, but the sub-menu is only about to be created. For that, the exploit has code that handles the <span style="font-family: courier new, courier, monospace;">WM_NCCREATE</span> message in the <span style="font-family: courier new, courier, monospace;">WH_CALLWNDPROC</span> hook. When the exploit code detects the system is in this state, it sends <span style="font-family: courier new, courier, monospace;">MN_CANCELMENUS</span> (0x1E6) message to the first menu, which cancels that menu. However, its sub-menu is still about to be created.</p>
<p>Now if we check this sub-menu object in kernel mode, we would see that <span style="font-family: courier new, courier, monospace;">tagPOPUPMENU‑&gt;ppopupmenuRoot</span> equals 0. This state allows the attacker to use that element in this kernel structure as a NULL pointer dereference. The exploit allocates a new page at address 0x0 and this address will be treated as a <span style="font-family: courier new, courier, monospace;">tagPOPUPMENU</span> object (see Figure 1) by the kernel.</p>
<div id="attachment_127583" style="width: 411px" class="wp-caption aligncenter"><a href="/wp-content/uploads/2019/07/01_tagPOPUPMENU_NULL_red-1.png"><img class="wp-image-127583 size-full" src="/wp-content/uploads/2019/07/01_tagPOPUPMENU_NULL_red-1.png" alt="" width="401" height="539" srcset="https://www.welivesecurity.com/wp-content/uploads/2019/07/01_tagPOPUPMENU_NULL_red-1.png 401w, https://www.welivesecurity.com/wp-content/uploads/2019/07/01_tagPOPUPMENU_NULL_red-1-223x300.png 223w" sizes="(max-width: 401px) 100vw, 401px" /></a><p class="wp-caption-text"><i>Figure 1. The </i><span style="font-family: courier new, courier, monospace;">tagPOPUPMENU</span> <i>kernel structure</i></p></div>
<p>At this point, the attackers use the second window. The main exploit goal is to flip the <span style="font-family: courier new, courier, monospace;">bServerSideWindowProc</span> bit in the <span style="font-family: courier new, courier, monospace;">tagWND</span> structure of the second window. This causes the execution of a <span style="font-family: courier new, courier, monospace;">WndProc</span> procedure in kernel mode.</p>
<p>To perform that, the attackers leak the kernel memory address of the <span style="font-family: courier new, courier, monospace;">tagWND</span> structure of the second window by calling the non-exported <span style="font-family: courier new, courier, monospace;">HMValidateHandle</span> function in the <span style="font-family: courier new, courier, monospace;">user32.dll</span> library. Then the exploit crafts a fake <span style="font-family: courier new, courier, monospace;">tagPOPUPMENU</span> object at the NULL page and sends a <span style="font-family: courier new, courier, monospace;">MN_BUTTONDOWN</span> message to a sub-menu.</p>
<p>After that, the kernel will eventually execute the <span style="font-family: courier new, courier, monospace;">win32k!xxxMNOpenHierarchy</span> function.</p>
<div id="attachment_127584" style="width: 705px" class="wp-caption aligncenter"><a href="/wp-content/uploads/2019/07/02_HMAssignmentLock-1.png"><img class="wp-image-127584" src="/wp-content/uploads/2019/07/02_HMAssignmentLock-1.png" alt="" width="695" height="124" srcset="https://www.welivesecurity.com/wp-content/uploads/2019/07/02_HMAssignmentLock-1.png 703w, https://www.welivesecurity.com/wp-content/uploads/2019/07/02_HMAssignmentLock-1-300x53.png 300w" sizes="(max-width: 695px) 100vw, 695px" /></a><p class="wp-caption-text"><i>Figure 2. Disassembled code of the </i><span style="font-family: courier new, courier, monospace;"> win32k!xxxMNOpenHierarchy</span> function</p></div>
<p>This function passes a crafted object at the NULL page to <span style="font-family: courier new, courier, monospace;">win32k!HMAssignmentLock</span>. The <span style="font-family: courier new, courier, monospace;">bServerSideWindowProc</span> bit is set inside the <span style="font-family: courier new, courier, monospace;">win32k!HMDestroyUnlockedObject</span> function, which is located a few calls deeper inside <span style="font-family: courier new, courier, monospace;">win32k!HMAssignmentLock</span>.</p>
<div id="attachment_127585" style="width: 705px" class="wp-caption aligncenter"><a href="/wp-content/uploads/2019/07/03_HMDestroyUnlockedObject-1.png"><img class="wp-image-127585 size-full" src="/wp-content/uploads/2019/07/03_HMDestroyUnlockedObject-1.png" alt="" width="695" height="316" srcset="https://www.welivesecurity.com/wp-content/uploads/2019/07/03_HMDestroyUnlockedObject-1.png 695w, https://www.welivesecurity.com/wp-content/uploads/2019/07/03_HMDestroyUnlockedObject-1-300x136.png 300w" sizes="(max-width: 695px) 100vw, 695px" /></a><p class="wp-caption-text"><i>Figure 3. Disassembled code of the </i><span style="font-family: courier new, courier, monospace;">win32k!HMDestroyUnlockedObject</span> function</p></div>
<p>Everything is done! Now the exploit can send a specific message to the second window in order to execute <span style="font-family: courier new, courier, monospace;">WndProc</span> in kernel mode.</p>
<p>As a final step, the exploit replaces the token of the current process with the system token.</p>
<p>The published patch, among others, added a check for a NULL pointer in <span style="font-family: courier new, courier, monospace;">win32k!xxxMNOpenHierarchy</span> function.</p>
<div id="attachment_127588" style="width: 760px" class="wp-caption aligncenter"><a href="/wp-content/uploads/2019/07/Figure-4.-NULL_pointer.png"><img class="wp-image-127588" src="/wp-content/uploads/2019/07/Figure-4.-NULL_pointer.png" alt="" width="750" height="162" srcset="https://www.welivesecurity.com/wp-content/uploads/2019/07/Figure-4.-NULL_pointer.png 925w, https://www.welivesecurity.com/wp-content/uploads/2019/07/Figure-4.-NULL_pointer-300x65.png 300w, https://www.welivesecurity.com/wp-content/uploads/2019/07/Figure-4.-NULL_pointer-768x166.png 768w" sizes="(max-width: 750px) 100vw, 750px" /></a><p class="wp-caption-text"><i>Figure 4. Code differences between two </i><span style="font-family: courier new, courier, monospace;">win32k.sys</span><i> versions – original (left) and patched (right)</i></p></div>
<h2>Conclusion</h2>
<p>The exploit only works against older versions of Windows, because since Windows 8 a user process is not allowed to map the NULL page. Microsoft back-ported this mitigation to Windows 7 for x64-based systems.</p>
<p>People who still use Windows 7 for 32-bit systems Service Pack 1 should consider updating to newer operating systems, since extended support of Windows 7 Service Pack 1 ends on <a href="http://windows.microsoft.com/en-us/windows/lifecycle" target="_blank" rel="noopener">January 14<sup>th</sup>, 2020</a>. Which means that Windows 7 users won’t receive critical security updates. Thus, vulnerabilities like this one will stay unpatched forever.</p>
<h1>Indicators of Compromise (IoCs)</h1>

<table id="tablepress-713" class="tablepress tablepress-id-713">
<thead>
<tr class="row-1 odd">
	<th class="column-1">SHA-1 hash</th><th class="column-2">ESET detection name</th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1"><span style="font-family: courier new, courier, monospace;">CBC93A9DD769DEE98FFE1F43A4F5CADAF568E321</span><br />
</td><td class="column-2">Win32/Exploit.CVE-2019-1132.A</td>
</tr>
</tbody>
</table>


                            
                                                            <div class="dot">
                                    <span class="icomoon icon-icon_article_dot"></span>
                                </div>

                                <div class="meta">
                                    <div class="wls-authors wls-authors-footer">
                                                <div class="wls-author">
                        <div class="wls-author-name">
                <a href="https://www.welivesecurity.com/author/acherepanov/" title="Anton Cherepanov">
                    Anton Cherepanov                </a>
            </div>
        </div>
                                            </div>
                                    <span class="strong">
								        <time datetime="2019-07-10 11:30:42">10 Jul 2019 - 11:30AM</time>
                                    </span>
                                </div>
                            
                            <div class="widgets row">
                                <div class="col-md-12 col-sm-12 col-xs-12">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12 no-padding">
                                        <h3><span class="text">Newsletter</span></h3>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-12 newsletter-wrapper">
                                    			
		<div class="heading-line col-md-12 no-padding sidebar-item clearfix">
			<h3>
				<span class="text">Newsletter</span>
			</h3>

			<form action="//liondigital.us3.list-manage.com/subscribe/post?u=b76f82b1cc198ab1d80665c99&amp;id=102b0810e2" class="basic-searchform col-md-12 col-sm-12 col-xs-12 no-padding newsletter" method="post" role="search">
				<div class="search-input clearfix">
					<input type="text" name="email" value="" placeholder="Email...">
					<button>
						Submit					</button>
				</div>
			</form>		
		</div>
                                </div>
                            </div>

                                                            <div class="similar-articles row">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12">
                                        <h3><span class="text">Similar Articles</span></h3>
                                    </div>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/vulnerability/" class="category-tag-btn">Vulnerability</a>                                                <a href="https://www.welivesecurity.com/2021/03/16/google-fixes-chrome-zero-day-bug-exploited-wild/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/03/google-chrome-zero-day-patch.jpg"
                                                         alt="Windows zero&#8209;day CVE&#8209;2019&#8209;1132 exploited in targeted attacks">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/03/16/google-fixes-chrome-zero-day-bug-exploited-wild/">
                                                    Google fixes Chrome zero-day bug exploited in the wild                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/vulnerability/" class="category-tag-btn">Vulnerability</a>                                                <a href="https://www.welivesecurity.com/2021/03/04/microsoft-fixes-four-exchange-server-zero-day-vulnerabilities/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/03/shutterstock_785514268-623x432.jpg"
                                                         alt="Windows zero&#8209;day CVE&#8209;2019&#8209;1132 exploited in targeted attacks">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/03/04/microsoft-fixes-four-exchange-server-zero-day-vulnerabilities/">
                                                    Microsoft rushes out fixes for four zero-day flaws in Exchange Server                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/vulnerability/" class="category-tag-btn">Vulnerability</a>                                                <a href="https://www.welivesecurity.com/2021/02/15/record-breaking-number-vulnerabilities-reported-2020/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/02/vulnerabilities-reports-2020-record-623x427.jpg"
                                                         alt="Windows zero&#8209;day CVE&#8209;2019&#8209;1132 exploited in targeted attacks">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/02/15/record-breaking-number-vulnerabilities-reported-2020/">
                                                    Record-high number of vulnerabilities reported in 2020                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/vulnerability/" class="category-tag-btn">Vulnerability</a>                                                <a href="https://www.welivesecurity.com/2021/02/10/microsoft-patches-windows-kernel-flaw/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2020/11/Patch-tuesday-fixes-17-critical-bugs-windows-zeroday.jpg"
                                                         alt="Windows zero&#8209;day CVE&#8209;2019&#8209;1132 exploited in targeted attacks">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/02/10/microsoft-patches-windows-kernel-flaw/">
                                                    Microsoft patches actively exploited Windows kernel flaw                                                </a>
                                            </h4>
                                        </article>
                                                                    </div>
                            
                            <div class="comments row">
                                <div class="heading-line col-xs-12">
                                    <h3><span class="text">Discussion</span></h3>
                                                                            
<div id="disqus_thread"></div>
                                                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    	</div> 	<footer id="site-footer">
		<div class="container">
			<div class="row">
				<div class="col-md-2">
                    <div class="hidden-sm hidden-xs">
                        <div class="logo-wrapper footer clearfix">
                            <div class="dark clearfix">
                                <a href="https://www.welivesecurity.com/" class="wls">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-1.svg" alt="Welivesecurity.com">
                                </a>
                                <a href="https://www.eset.com" class="eset">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-2.svg" alt="by ESET">
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="hidden-lg hidden-md">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
				</div>
				<nav id="footer" class="clearfix">
											<div class="mobile-block">
																<div class="col-md-2 col-md-offset-2">
										<ul>
																							<li>
													<a href="/">Home</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/about-us/">About Us</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/contact-us/">Contact Us</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/sitemap/">Sitemap</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/our-experts/">Our Experts</a>
												</li>
																							<li>
													<a href="https://eset.com">ESET</a>
												</li>
																					</ul>
									</div>
													</div>
											<div class="mobile-block">
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/research/">Research</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/category/how-to/">How To</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/categories/">Categories</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/rss-configurator/">RSS Configurator</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/news-widget-generator/">News Widget</a>
												</li>
																					</ul>
									</div>
													</div>
									</nav>
			</div>
			<div class="row">
				<div class="col-md-12 legal clearfix">
					<div class="wrap clearfix">
													<span>
								<a href="https://www.welivesecurity.com/privacy/">
									Privacy policy								</a>
							</span>
													<span>
								<a href="https://www.welivesecurity.com/legal-information/">
									Legal Information								</a>
							</span>
											</div>
					<span class="copyright pull-right">Copyright &copy; ESET, All Rights Reserved</span>
				</div>
							</div>
		</div>
	</footer>
	
	<button id="back-to-top" class="animated-scroll" data-target="absoluteTop">
		<span class="icomoon icon-icon_arrow"></span>
		<span class="text">Back to top</span>
	</button>

			<div class="social-wrapper-mobile hidden-lg hidden-md hidden-sm" id="mobile-article-sharer">
			<div class="col-xs-12">
				<div class="icons" style="text-align: center;">
											<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2019%2F07%2F10%2Fwindows-zero-day-cve-2019-1132-exploit%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
							<span class="icomoon icon-icon_fb"></span>
						</a>
											<a class="share-twitter" href="https://twitter.com/intent/tweet?https%3A%2F%2Fwww.welivesecurity.com%2F2019%2F07%2F10%2Fwindows-zero-day-cve-2019-1132-exploit%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
							<span class="icomoon icon-icon_tw"></span>
						</a>
											<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2019%2F07%2F10%2Fwindows-zero-day-cve-2019-1132-exploit%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
							<span class="icomoon icon-icon_in"></span>
						</a>
									</div>
			</div>
		</div>
	
	<script>
		var baseUrl = "https://www.welivesecurity.com/";
	</script>
	
			<script>
            !function(){if(-1==window.document.cookie.indexOf("user_rec=1")){function e(e,o){var t=document.createElement("img");t.setAttribute("style","display:none"),t.src=e+o,window.document.body.appendChild(t)}function o(){d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Default%20status&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=defaultStatus&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c)}function t(){console.log("GA and GTM are loaded."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=11",e(u,a),e(s,c)}function n(){var e=new Date;e.setTime(e.getTime()+63072e6);var o="expires="+e.toUTCString();window.document.cookie="user_rec=1; "+o+"; path=/"}var d,a,c,i,r,l="UA-76266002-27",g=window.location.href,s="https://cdn1.esetstatic.com/ESET/INT/assets/img/check.png",u="https://www.google-analytics.com/collect",w="wls",m=0,h=function e(){i=window.ga&&ga.create?1:0,r=window.google_tag_manager?1:0,m++,console.log("Timer: ",m),h=setTimeout(e,500)};window.document.addEventListener&&(d=1e6*Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Script%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=scriptLoaded&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c),window.addEventListener("beforeunload",o),window.ga&&ga.create&&window.google_tag_manager?(t(),window.removeEventListener("beforeunload",o),n()):(setTimeout(h,500),setTimeout(function(){clearTimeout(h),i&&r?t():i&&!r?(console.log("GA is loaded and GTM is blocked."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=10",e(u,a),e(s,c)):!i&&r?(console.log("GA is blocked and GTM is loaded."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=01",e(u,a),e(s,c)):i||r||(console.log("GA is blocked and GTM is blocked."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=00",e(u,a),e(s,c)),window.removeEventListener("beforeunload",o),n()},1e4)))}}();
		</script>
	
	<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/js/main-0ba0c3843d.js"></script>
    <!-- Version: v1.1.76.32619db9.pro-azeu -->
    		<script type="text/javascript">
			var disqus_config = function () { 
				this.language = "en";
			};
			var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":"", "numsVisible": false};
			var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
		</script>
		<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/static/js/crayon.min.js"></script>

			
		
    <script>
    	Main.init();
    </script>

    <script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"welivesecurity"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_count.js?ver=3.0.16'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var embedVars = {"disqusConfig":{"integration":"wordpress 3.0.16"},"disqusIdentifier":"127540 https:\/\/ba-infohub-web01-v.hq.eset.com\/?p=127540","disqusShortname":"welivesecurity","disqusTitle":"Windows zero\u2011day CVE\u20112019\u20111132 exploited in targeted attacks","disqusUrl":"https:\/\/www.welivesecurity.com\/2019\/07\/10\/windows-zero-day-cve-2019-1132-exploit\/","postId":"127540"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_embed.js?ver=3.0.16'></script>
    <script src="https://assets.esetstatic.com/3PR/app.min.js"></script>
  </body>
</html>