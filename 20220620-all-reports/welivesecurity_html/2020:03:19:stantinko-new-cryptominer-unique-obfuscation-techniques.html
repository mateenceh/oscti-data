<!doctype html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="google-site-verification" content="_b2avZwzr79oru6lM2Ddae1fNpSIbPaP0H0WNkc2x3k"/>
    <meta name="msvalidate.01" content="CE77828A466C2513F660017CFCB6BA13"/>
    <link rel="icon" href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/favicon.ico">

    

            
    
    <link href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/css/main-8633bd3c28.css" rel="stylesheet">
    <script type="text/javascript"> var appInsights=window.appInsights||function(a){ function b(a){c[a]=function(){var b=arguments;c.queue.push(function(){c[a].apply(c,b)})}}var c={config:a},d=document,e=window;setTimeout(function(){var b=d.createElement("script");b.src=a.url||"https://az416426.vo.msecnd.net/scripts/a/ai.0.js",d.getElementsByTagName("script")[0].parentNode.appendChild(b)});try{c.cookie=d.cookie}catch(a){}c.queue=[];for(var f=["Event","Exception","Metric","PageView","Trace","Dependency"];f.length;)b("track"+f.pop());if(b("setAuthenticatedUserContext"),b("clearAuthenticatedUserContext"),b("startTrackEvent"),b("stopTrackEvent"),b("startTrackPage"),b("stopTrackPage"),b("flush"),!a.disableExceptionTracking){f="onerror",b("_"+f);var g=e[f];e[f]=function(a,b,d,e,h){var i=g&&g(a,b,d,e,h);return!0!==i&&c["_"+f](a,b,d,e,h),i}}return c }({ instrumentationKey:"dcb460fe-684e-4d39-bfcd-d3a6f2710a32" }); window.appInsights=appInsights,appInsights.queue&&0===appInsights.queue.length&&appInsights.trackPageView(); </script>
    <script>
        window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
        'Author': 'Vladislav Hrčka',
        'ArticleCategory': 'Malware',
        'ArticleSection': 'Research',
        'cookie-bar-hq': true
    });

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PMDGSM');
</script>
<script>(function() {
  var _fbq = window._fbq || (window._fbq = []);
  if (!_fbq.loaded) {
    var fbds = document.createElement('script');
    fbds.async = true;
    fbds.src = '//connect.facebook.net/en_US/fbds.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(fbds, s);
    _fbq.loaded = true;
  }
  _fbq.push(['addPixelId', '1518099328403839']);
})();
window._fbq = window._fbq || [];
window._fbq.push(['track', 'PixelInitialized', {}]);
</script>
<noscript><img height="1" width="1" alt="" style="display:none" src="https://www.facebook.com/tr?id=1518099328403839&amp;ev=NoScript" /></noscript>
<meta property="fb:pages" content="56844830907" />
<!-- This site is optimized with the Yoast SEO plugin v9.2 - https://yoast.com/wordpress/plugins/seo/ -->
<title>Stantinko’s new cryptominer features unique obfuscation techniques | WeLiveSecurity</title>
<meta name="description" content="ESET researchers bring to light unique obfuscation techniques discovered in the course of analyzing a new cryptomining module distributed by the Stantinko group’s botnet."/>
<link rel="canonical" href="https://www.welivesecurity.com/2020/03/19/stantinko-new-cryptominer-unique-obfuscation-techniques/" />
<meta property="og:locale" content="en_US" />
<meta property="og:locale:alternate" content="fr_FR" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Stantinko’s new cryptominer features unique obfuscation techniques | WeLiveSecurity" />
<meta property="og:description" content="ESET researchers bring to light unique obfuscation techniques discovered in the course of analyzing a new cryptomining module distributed by the Stantinko group’s botnet." />
<meta property="og:url" content="https://www.welivesecurity.com/2020/03/19/stantinko-new-cryptominer-unique-obfuscation-techniques/" />
<meta property="og:site_name" content="WeLiveSecurity" />
<meta property="article:section" content="Malware" />
<meta property="article:published_time" content="2020-03-19T10:30:05+00:00" />
<meta property="article:modified_time" content="2020-05-19T01:54:42+00:00" />
<meta property="og:updated_time" content="2020-05-19T01:54:42+00:00" />
<meta property="og:image" content="https://www.welivesecurity.com/wp-content/uploads/2020/03/stantinko-cryptominer-unique-obfuscation-techniques.jpg" />
<meta property="og:image:secure_url" content="https://www.welivesecurity.com/wp-content/uploads/2020/03/stantinko-cryptominer-unique-obfuscation-techniques.jpg" />
<meta property="og:image:width" content="1000" />
<meta property="og:image:height" content="657" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="ESET researchers bring to light unique obfuscation techniques discovered in the course of analyzing a new cryptomining module distributed by the Stantinko group’s botnet." />
<meta name="twitter:title" content="Stantinko’s new cryptominer features unique obfuscation techniques | WeLiveSecurity" />
<meta name="twitter:site" content="@welivesecurity" />
<meta name="twitter:image" content="https://www.welivesecurity.com/wp-content/uploads/2020/03/stantinko-cryptominer-unique-obfuscation-techniques.jpg" />
<meta name="twitter:creator" content="@welivesecurity" />
<!-- / Yoast SEO plugin. -->

<link rel="alternate" href="https://www.welivesecurity.com/fr/2020/03/20/nouveau-cryptomineur-stantinko-dobfuscation/" hreflang="fr" />
<link rel="alternate" href="https://www.welivesecurity.com/2020/03/19/stantinko-new-cryptominer-unique-obfuscation-techniques/" hreflang="en" />
<link rel="alternate" type="application/rss+xml" title="WeLiveSecurity RSS 2.0 Feed" href="/rss-configurator/" /><style type="text/css" id="syntaxhighlighteranchor"></style>
        <link id="cookie-style" rel="stylesheet" type="text/css" href="https://assets.esetstatic.com/3PS/cookiebar.min.css">
</head>
<body class="no-js single wide">
<noscript>
	<iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PMDGSM" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div class="main">
    <header id="site-header" class="container">
        <div class="row">
            <div class="col-md-4 col-sm-12 col-xs-12 pull-right" id="header-nav">
                <div class="row">
                    <div class="col-xs-12 mobile-search-input">
                        <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                    </div>
                    <div class="hidden-lg hidden-md col-sm-7 col-xs-8 hidden-xxs">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
                    <div class="col-md-8 hidden-sm hidden-xs languages">
                        <div class="dropdown">
	<button class="btn btn-default dropdown-toggle" type="button" id="main-language-picker" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
    	<span class="text">In English</span>
    	<span class="icomoon icon-icon_arrow"></span>
  	</button>
  	<ul class="dropdown-menu" aria-labelledby="main-language-picker">
            <li>
        <a href="/br/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/2020/03/20/nouveau-cryptomineur-stantinko-dobfuscation/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/" title="In Deutsch">
            In Deutsch        </a>
    </li>
      	</ul>
</div>                    </div>
                    <div class="col-md-4 col-sm-2 col-xs-3 menu-trigger">
                        <div class="menu-btn">
	<span class="text">Menu</span>
	<button type="button" id="menu-trigger" class="tcon tcon-menu--xcross" aria-label="toggle menu">
        <span class="wrapper">
            <span class="tcon-menu__lines" aria-hidden="true"></span>
            <span class="tcon-visuallyhidden">toggle menu</span>
        </span>
    </button>
</div>                    </div>
                    <div class="hidden-lg hidden-md hidden-sm hidden-xs col-xs-2 mobile-search imc">
                        <button class="imc">
                            <span class="icomoon icon-icon_search imc"></span>
                        </button>
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12 imc" id="main-menu">
                        <nav class="menu clearfix imc">
                            <ul class="col-md-12 col-sm-6 col-xs-6 imc">
                                                                    <li class="">
                                        <a href="/">
                                            All Posts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/research">
                                            Research                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/category/how-to/">
                                            How To                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/videos/">
                                            Videos                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/podcasts/">
                                            Podcasts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/conference-papers/">
                                            Conference Materials                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/white-papers/">
                                            White Papers                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/threat-reports/">
                                            Threat Reports                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/magazine/">
                                            Magazine                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/our-experts/">
                                            Our Experts                                        </a>
                                    </li>
                                                            </ul>

                            <div class="col-md-12 col-sm-6 col-xs-6 imc">
                                <ul class="languages hidden-lg hidden-md hidden-xxs col-xs-12 imc">
                                        <li>
        <a href="/br/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/2020/03/20/nouveau-cryptomineur-stantinko-dobfuscation/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/" title="In Deutsch">
            In Deutsch        </a>
    </li>
                                    </ul>
                                <div class="hidden-lg hidden-md col-xs-12 imc">
                                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="menu-overlay col-md-12 col-sm-12 col-xs-12 imc">
                        <div class="inner imc"></div>
                    </div>
                </div>
                <div class="row hidden-sm hidden-xs">
                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc  col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                </div>
            </div>
            <div class="col-md-5 hidden-sm hidden-xs pull-left" id="header-logo">
                <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                <span class="slogan hidden-sm hidden-xs">
						Award-winning news, views, and insight from the ESET <strong>security community</strong> 
					</span>
            </div>
        </div>
    </header>
        <section id="article-detail">
            <div class="hero-wide" style="background-image: url('../../../../wp-content/uploads/2020/03/stantinko-cryptominer-features-unique-obfuscation-techniques.jpg'); background-position: 50% 50%;">
    <div class="text-wrapper">
        <div class="container promo-text">
            <div class="col-md-11 col-sm-11 col-xs-12 no-padding">
                <h1>Stantinko’s new cryptominer features unique obfuscation techniques</h1>
<div class="excerpt">ESET researchers bring to light unique obfuscation techniques discovered in the course of analyzing a new cryptomining module distributed by the Stantinko group’s botnet</div>
<div class="post-meta">
    <div class="wls-authors">
                <div class="wls-author with-avatar">
                            <div class="wls-author-avatar">
                    <a href="https://www.welivesecurity.com/author/vhrcka/" title="Vladislav Hrčka">
                        <img src="https://www.welivesecurity.com/wp-content/uploads/2019/11/vladislav-hrcka-222x179.jpg" alt="Vladislav Hrčka">
                    </a>
                </div>
                        <div class="wls-author-name">
                <a href="https://www.welivesecurity.com/author/vhrcka/" title="Vladislav Hrčka">
                    Vladislav Hrčka                </a>
            </div>
        </div>
            </div>
    <span class="meta">
		<span class="strong">
			<time datetime="2020-03-19 11:30:05">19 Mar 2020 - 11:30AM</time>
		</span>
			</span>
</div>
            </div>
        </div>
    </div>
</div>

            <div class="content">
                <div class="social-wrapper" id="social-sharer">
                    <span class="text">Share</span>
	<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2020%2F03%2F19%2Fstantinko-new-cryptominer-unique-obfuscation-techniques%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
		<span class="icomoon icon-icon_fb"></span>
	</a>
	<a class="share-twitter" href="https://twitter.com/intent/tweet?&url=https%3A%2F%2Fwww.welivesecurity.com%2F2020%2F03%2F19%2Fstantinko-new-cryptominer-unique-obfuscation-techniques%2F&text=Stantinko’s new cryptominer features unique obfuscation techniques%0A&via=welivesecurity" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
		<span class="icomoon icon-icon_tw"></span>
	</a>
	<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2020%2F03%2F19%2Fstantinko-new-cryptominer-unique-obfuscation-techniques%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
		<span class="icomoon icon-icon_in"></span>
	</a>
                </div>
                <div class="container">
                    <div class="row">
                        <div class="col-md-1 col-sm-1 hidden-xs">

                        </div>
                        <div class="col-md-10 col-sm-10 col-xs-12 formatted">

                            <div class="excerpt wide">
                                <p>ESET researchers bring to light unique obfuscation techniques discovered in the course of analyzing a new cryptomining module distributed by the Stantinko group’s botnet</p>
                            </div>

                            <p>In the new cryptomining module we discovered and described in our <a href="https://www.welivesecurity.com/2019/11/26/stantinko-botnet-adds-cryptomining-criminal-activities/" target="_blank" rel="noopener">previous article</a>, the cybercriminals behind the <a href="https://www.welivesecurity.com/2017/07/20/stantinko-massive-adware-campaign-operating-covertly-since-2012/" target="_blank" rel="noopener">Stantinko botnet</a> introduced several obfuscation techniques, some of which have not yet been publicly described. In this article, we dissect these techniques and describe possible countermeasures against some of them.</p>
<p>To thwart the analysis and avoid detection, Stantinko’s new module uses various obfuscation techniques:</p>
<ul>
<li>Obfuscation of strings &#8211; meaningful strings are constructed and only present in memory when they are to be used</li>
<li>Control-flow obfuscation &#8211; transformation of the control flow to a form that is hard to read and the execution order of basic blocks is unpredictable without extensive analysis</li>
<li>Dead code &#8211; addition of code that is never executed; it also contains exports that are never called. Its purpose is to make the files look more legitimate to prevent detection</li>
<li>Do-nothing code – addition of code that is executed, but that has no material effect on the overall functionality. It is meant to bypass behavioral detections</li>
<li>Dead strings and resources &#8211; addition of resources and strings with no impact on the functionality</li>
</ul>
<p>Out of these techniques, the most notable are obfuscation of strings and control-flow obfuscation; we will describe them in detail in the following sections.</p>
<h1>Obfuscation of strings</h1>
<p>All the strings embedded in the module are unrelated to the real functionality. Their source is unknown and they either serve as building blocks for constructing the strings that are actually used or they are not used at all.</p>
<p>The actual strings used by the malware are generated in memory in order to avoid file-based detection and thwart analysis. They are formed by rearranging bytes of the decoy strings – those embedded in the module – and using standard functions for string manipulation, such as <span style="font-family: courier new, courier, monospace;">strcpy(), strcat(), strncat(), strncpy(), sprintf(), memmove()</span> and their Unicode versions.</p>
<p>Since all the strings to be used in a particular function are always assembled sequentially at the beginning of the function, one can emulate the entry points of the functions and extract the sequences of printable characters that arise to reveal the strings.</p>
<div id="attachment_136230" style="width: 604px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-1-2.png"><img class="wp-image-136230" src="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-1-2-827x1024.png" alt="" width="594" height="735" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-1-2-827x1024.png 827w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-1-2-242x300.png 242w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-1-2-768x951.png 768w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-1-2.png 861w" sizes="(max-width: 594px) 100vw, 594px" /></a><p class="wp-caption-text"><i>Figure 1. Example of string obfuscation. There are 7 highlighted decoy strings in the image. For example, the one marked in red generates the string “NameService”.</i></p></div>
<h1>Control-flow flattening</h1>
<p><a href="https://reverseengineering.stackexchange.com/questions/2221/what-is-a-control-flow-flattening-obfuscation-technique" target="_blank" rel="noopener">Control-flow flattening</a> is an obfuscation technique used to thwart analysis and avoid detection.</p>
<p>Common control-flow flattening is achieved by splitting a single function into basic blocks. These blocks are then placed as dispatches into a switch statement inside of a loop (i.e. each dispatch consists of exactly one basic block). There is a control variable to determine which basic block should be executed in the switch statement; its initial value is assigned before the loop.</p>
<p>The basic blocks are all assigned an ID and the control variable always holds the ID of the basic block to be executed.</p>
<p>All the basic blocks set the value of the control variable to the ID of its successor (a basic block can have multiple possible successors; in that case the immediate successor can be chosen in a condition).</p>
<div id="attachment_136231" style="width: 604px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-2-1.png"><img class="wp-image-136231 size-full" src="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-2-1.png" alt="" width="594" height="251" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-2-1.png 594w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-2-1-300x127.png 300w" sizes="(max-width: 594px) 100vw, 594px" /></a><p class="wp-caption-text"><i>Figure 2. Structure of common control-flow-flattening loop</i></p></div>
<p>There are various approaches to resolving this obfuscation, such as using IDA’s microcode API. Rolf Rolles used <a href="https://www.hexblog.com/?p=1248" target="_blank" rel="noopener">this method</a> to identify these loops heuristically, extract the control variable from each flattened block and rearrange them in accordance with the control variables.</p>
<p>This – and similar – approaches would not work on Stantinko’s obfuscation, because it has some unique features compared to common control-flow-flattening obfuscations:</p>
<ul>
<li>Code is flattened on the source code level, which also means the compiler can introduce some anomalies into the resulting binary</li>
<li>The control variable is incremented in a control block (to be explained later), not in basic blocks</li>
<li>Dispatches contain multiple basic blocks (the division may be disjunctive, i.e. each basic block belongs to exactly one dispatch, <em>but</em> sometimes the dispatches intertwine, meaning that they share some basic blocks)</li>
<li>Flattening loops can be nested and successive</li>
<li>Multiple functions are merged</li>
</ul>
<p>These features show that Stantinko has introduced new obstacles to this technique that must be overcome in order to analyze its final payload.</p>
<h2>Control-flow flattening in Stantinko</h2>
<p>In most of Stantinko’s functions, the code is split into several dispatches (described above) and two control blocks — a head and a tail — that control the flow of the function.</p>
<p>The head decides which dispatch should be executed by checking the control variable. The tail increases the control variable by a fixed constant and either goes back to the head or exits the flattening loop:</p>
<div id="attachment_136232" style="width: 502px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-3-2.png"><img class="wp-image-136232" src="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-3-2.png" alt="" width="492" height="412" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-3-2.png 537w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-3-2-300x251.png 300w" sizes="(max-width: 492px) 100vw, 492px" /></a><p class="wp-caption-text"><i>Figure 3. Regular structure of Stantinko’s control-flow-flattening loop </i></p></div>
<p>Stantinko appears to be flattening code of all functions and bodies of high-level constructs (such as a <span style="font-family: 'courier new', courier, monospace;">for</span> loop), but sometimes it also tends to choose seemingly random blocks of code. Since it applies the control-flow-flattening loops on both functions and high-level constructs, they can be naturally nested and there happen to be multiple consecutive loops too.</p>
<p>When a control-flow-flattening loop is created by merging code of multiple functions, the control variable in the resulting merged function is initialized with different values, based on which of the original functions is called. The value of the control variable is passed to the resulting function as a parameter.</p>
<p>We overcame this obfuscation technique by rearranging the blocks in the binary; our approach is described in the next section.</p>
<p>It’s important to note that we observed multiple anomalies in some of the flattening loops that make it harder to automate the deobfuscation process. The majority of them seem to be generated by the compiler; this leads us to believe that the control-flow-flattening obfuscation is applied prior to compilation.</p>
<p>We witnessed the following anomalies; they can appear separately or in combination:</p>
<ol>
<li>Some dispatches can be just dead code – they will never be executed. (Examples in the section “Dead code inside the control-flow-flattening loop” below.)</li>
<li>Basic blocks inside of dispatches may intertwine, this means that they can contain joint code.</li>
</ol>
<div id="attachment_136233" style="width: 502px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-4-1.png"><img class="wp-image-136233" src="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-4-1.png" alt="" width="492" height="646" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-4-1.png 557w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-4-1-229x300.png 229w" sizes="(max-width: 492px) 100vw, 492px" /></a><p class="wp-caption-text"><i>Figure 4. Structure of a flattening loop with dispatches sharing joint code</i></p></div>
<ol start="3">
<li>There are direct jumps from dispatches to a block outside the flattening loop, right behind the tail, and to blocks that return from the function.</li>
</ol>
<div id="attachment_136234" style="width: 502px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-5-2.png"><img class="wp-image-136234 size-full" src="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-5-2.png" alt="" width="492" height="443" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-5-2.png 492w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-5-2-300x270.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-5-2-87x77.png 87w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-5-2-60x53.png 60w" sizes="(max-width: 492px) 100vw, 492px" /></a><p class="wp-caption-text"><i>Figure 5. Structure of a flattening loop whose dispatch breaks directly out of the loop. Only one of the dashed lines occurs.</i></p></div>
<ol start="4">
<li>There can be multiple tails, or no tail at all – in the latter case, the control variable is increased at the end of each dispatch.</li>
</ol>
<div id="attachment_136235" style="width: 610px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-6-2.png"><img class="wp-image-136235" src="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-6-2.png" alt="" width="600" height="232" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-6-2.png 1168w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-6-2-300x116.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-6-2-768x297.png 768w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-6-2-1024x396.png 1024w" sizes="(max-width: 600px) 100vw, 600px" /></a><p class="wp-caption-text"><i>Figure 6. Structure of a flattening loop without any tail (left) and with multiple tails (right)</i></p></div>
<ol start="5">
<li>The head doesn’t contain a jump table right away. Instead, there can be multiple jump tables and there’s a sequence of branches, prior to the jump tables, binary-searching for the correct dispatch.</li>
<li>The value of the control variable might be used inside of the dispatches; this means that the control value has to be preserved/computed even in the deobfuscated code.</li>
</ol>
<div id="attachment_136236" style="width: 610px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-7-2.png"><img class="wp-image-136236" src="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-7-2.png" alt="" width="600" height="251" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-7-2.png 1461w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-7-2-300x125.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-7-2-768x321.png 768w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-7-2-1024x428.png 1024w" sizes="(max-width: 600px) 100vw, 600px" /></a><p class="wp-caption-text"><i>Figure 7. The <span style="font-family: courier new, courier, monospace;">EDI</span> register contains the control variable that is passed to EAX and used inside the dispatch. The dispatch is highlighted with red.</i></p></div>
<ol start="7">
<li>Sometimes, the tail contains instructions that are crucial to restoring the correct values of registers and local variables. During deobfuscation, we remove the tail, so we must make sure these instructions are executed after each dispatch, even if they are not part of it.</li>
<li>There are cases where there is no dispatch whose ID is, at that moment, equal to the current value of the control variable.</li>
</ol>
<h3>Deobfuscation</h3>
<p>Our goal is to build a deobfuscation function able to rearrange the code on the binary level to make it easily readable for a reverse engineer, while keeping the resulting code executable. It has to be able to recognize all basic blocks belonging to each dispatch and to copy and move them arbitrarily.</p>
<p>During basic block manipulation one has to make sure to recalculate relative addresses of branch targets and addresses forming legitimate jump tables correctly.</p>
<p>Our solution doesn’t take relocations into account; hence one always needs to make sure that the sample is loaded at the same base address.</p>
<p>We used a reverse-engineering framework that provides us with some useful features, such as assembly manipulation and a <a href="https://en.wikipedia.org/wiki/Symbolic_execution" target="_blank" rel="noopener">symbolic execution</a> engine.</p>
<p>The core parameters of the function are the addresses of the control blocks (head and tails), range and step of the control variable, names of the registers, and the memory locations containing the control variable, control_locations, and, lastly, the address of the first basic block following the loop, which we define as <span style="font-family: courier new, courier, monospace;">next_block</span>. It obviously also requires the address of the function to be deobfuscated and the address where the deobfuscated function should be placed.</p>
<p>We expect multiple tails due to anomaly 4 above.</p>
<p>The deobfuscation function iterates through the range of the control variable by its step value to simulate the real control-flow-flattening loop; in each iteration, the function starts by generating a context to deal with anomalies 6 and 7. The context is to be placed before the respective dispatch.</p>
<p>The context is a basic block containing instructions assigning registers and memory addresses and keeping control_locations updated. The context of the first iteration just preserves the value of the control variable. (Note: no context is required to deal with anomaly number 4.)</p>
<p>The last basic blocks of the previous dispatch (or, in case of the first dispatch, the basic blocks right before the head) are redirected to the created context.</p>
<p>The initial basic block of a dispatch that is to be executed (in each of the iterations) is determined by the current value of the control variable (dispatch ID).</p>
<p>The actual basic block is found by symbolically executing the binary-search algorithm, which searches for a basic block with the current ID. The initial state of the symbolic execution contains control_locations assigned to the current value of the control variable.</p>
<p>We stop the symbolic execution at the first basic block that (i) contains an unconditional branch, or, (ii) has a destination that cannot be determined by the control variable.</p>
<p>One could also emulate this part or use a framework that would be able to simplify the binary-search algorithm into a jump table and then convert that into a switch statement instead. These methods deal with anomaly 5.</p>
<p>In case there’s no dispatch for a particular ID, the loop just continues and increases the control variable due to anomaly 8.</p>
<p>The whole dispatch (i.e., each basic block that is reachable from its initial basic block to its head, tail(s) or <span style="font-family: courier new, courier, monospace;">next_block</span>) is then copied after the preceding context block (as described above). It cannot be just moved due to anomaly 2.</p>
<p>There are currently two uncommon cases that can occur due to anomaly 3; both result in premature termination of the iteration. The cases happen when a dispatch:</p>
<ul>
<li>Returns from the function</li>
<li>Points to <span style="font-family: courier new, courier, monospace;">next_block</span></li>
</ul>
<p>Finally, when the iteration ends, the last basic blocks of the previous dispatch (or basic blocks right before the head, in case of the first dispatch), are redirected to the first basic block outside the flattening loop.</p>
<p>This method solves anomaly 1 automatically, since the dead dispatches won’t be copied into the resulting code.</p>
<div id="attachment_136237" style="width: 610px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-8.png"><img class="wp-image-136237" src="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-8.png" alt="" width="600" height="386" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-8.png 1447w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-8-300x193.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-8-768x494.png 768w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-8-1024x658.png 1024w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-8-65x42.png 65w" sizes="(max-width: 600px) 100vw, 600px" /></a><p class="wp-caption-text"><i>Figure 8. Example of an obfuscated function (left) and its deobfuscated counterpart (right). The dispatches are executed in this order: dispatch1 → dispatch2 → dispatch3.</i></p></div>
<p>These changes are then written to the virtual address where the deobfuscated function should be placed.</p>
<p>In case we are dealing with flattening of merged functions, we point references to the target function having the identical initial value of the control variable in the parameter, to the address of the new deobfuscated function.</p>
<div id="attachment_136238" style="width: 610px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-9.png"><img class="wp-image-136238" src="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-9-300x100.png" alt="" width="600" height="201" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-9-300x100.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-9-768x257.png 768w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-9-1024x343.png 1024w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-9.png 1430w" sizes="(max-width: 600px) 100vw, 600px" /></a><p class="wp-caption-text"><i>Figure 9. Example of obfuscated (right) and deobfuscated (left) control flow graph</i></p></div>
<h3><em>Possible improvements</em></h3>
<p>The approach described above operates exclusively at the assembly level, which isn’t sufficient to make the deobfuscation fully automated.</p>
<p>The reason is that accurate recognition of all patterns is rather difficult, mostly due to various compiler optimizations present in the source code level obfuscations. The pattern recognition is necessary in our case, for example, to automatically fill in the parameters of the core deobfuscation function.</p>
<p>The advantage of this approach is that the resulting code can be executed right away and one can use arbitrary reverse-engineering tools for further analysis.</p>
<p>This approach could be further improved by the use of a progressive <a href="https://en.wikipedia.org/wiki/Intermediate_representation" target="_blank" rel="noopener">intermediate representation</a> (IR), which provides optimization techniques that would, among other things, get rid of most of the anomalies generated by compilers, and thus allow automated recognition of the parameters required by the deobfuscation function.</p>
<p>One could also use the selected IR for both recognition and the deobfuscation of which the latter, in our case, consists of rearranging of basic blocks.</p>
<p>The drawback of this option is that the resulting code would also be in the IR, which means that the consecutive analysis would have to be done with the IR as well. The number of tools working with the IR and their functionality could be rather limited, especially when it comes to visualization. Due to this, it’d be hard to analyze a more complex sample, especially when there are additional layers of obfuscation. We wouldn’t be able to execute the resulting code either.</p>
<h1>Dead code</h1>
<p>By “dead code” we mean code that either is never executed, or has no overall impact on the functionality. The malware contains dead code mostly in the flattened loops (effectively removed by our above-explained deobfuscation function), but there are also, for example, unused exports and there’s no way to distinguish the unused exports from the legitimate ones.</p>
<p>As for dead code in the flattened loop: for Stantinko, it is always inside the dispatches that are never executed. It may contain modified parts of legitimate software such as WinSpy++ (see the example below) that was obfuscated in the same way.</p>
<div id="attachment_136239" style="width: 610px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-10.png"><img class="wp-image-136239" src="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-10-300x242.png" alt="" width="600" height="485" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-10-300x242.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-10-768x620.png 768w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-10-1024x827.png 1024w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-10-222x179.png 222w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-10.png 1035w" sizes="(max-width: 600px) 100vw, 600px" /></a><p class="wp-caption-text"><i>Figure 10. Deobfuscated part of dead code inside a dispatch containing legitimate WinSpy++ code</i></p></div>
<div id="attachment_136240" style="width: 610px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-11.png"><img class="wp-image-136240" src="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-11.png" alt="" width="600" height="443" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-11.png 763w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-11-300x221.png 300w" sizes="(max-width: 600px) 100vw, 600px" /></a><p class="wp-caption-text"><i>Figure 11. The equivalent part of code (as in Figure 10) in the official release of WinSpy++</i></p></div>
<h1>Do-nothing code</h1>
<p>Even after the unflattening operation, there are parts of code that have no purpose at all, intermingled with the lines of the “real code”. This is probably meant to obscure the analysis even more or to bypass behavioral detection.</p>
<div id="attachment_136241" style="width: 610px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-12.png"><img class="wp-image-136241" src="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-12.png" alt="" width="600" height="1427" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-12.png 616w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-12-126x300.png 126w, https://www.welivesecurity.com/wp-content/uploads/2020/03/Figure-12-431x1024.png 431w" sizes="(max-width: 600px) 100vw, 600px" /></a><p class="wp-caption-text"><i>Figure 12. Marked parts are redundant code that iterates through the first two disk volume names and then does nothing with the returned values</i></p></div>
<p>Since the code isn’t much harder to read, we decided not to take any actions and analyzed the code at this point.</p>
<p>To optimize out this do-nothing code in general: we’d have to, for example, generate disjunct <a href="https://en.wikipedia.org/wiki/Program_slicing" target="_blank" rel="noopener">slices</a> containing all the Windows API calls that are present. The slicing criterion would consist of all the parameters of the calls in each disjunct slice.</p>
<p>Subsequently we’d execute the slices with a prepared call stack in a controlled environment and we’d consider a slice to be functional if it does at least one of the following:</p>
<ul>
<li>make some changes to the underlying OS</li>
<li>require an initial value of a function parameter or a global variable to be known</li>
<li>assign a value of a function parameter or a global variable</li>
<li>directly affect overall control flow of the function</li>
</ul>
<h1>Conclusion</h1>
<p>The criminals behind the Stantinko botnet are constantly improving and developing new modules that often contain non-standard and interesting techniques.</p>
<p>We have described their new cryptomining module previously; for the module&#8217;s functional analysis, refer to our November 2019 <a href="https://www.welivesecurity.com/2019/11/26/stantinko-botnet-adds-cryptomining-criminal-activities/" target="_blank" rel="noopener">blogpost</a>. This module displays several obfuscation techniques aimed at protecting against detection and thwarting analysis. We analyzed the techniques and described a possible approach to deobfuscating some of these techniques.</p>
<p><em>Note: For IoCs and the list of techniques mapped to the MITRE ATT&amp;CK taxonomy, please refer to <a href="https://www.welivesecurity.com/2019/11/26/stantinko-botnet-adds-cryptomining-criminal-activities/" target="_blank" rel="noopener">our previous article</a> describing this cryptominer’s functionality.</em></p>

                            
                                                            <div class="dot">
                                    <span class="icomoon icon-icon_article_dot"></span>
                                </div>

                                <div class="meta">
                                    <div class="wls-authors wls-authors-footer">
                                                <div class="wls-author">
                        <div class="wls-author-name">
                <a href="https://www.welivesecurity.com/author/vhrcka/" title="Vladislav Hrčka">
                    Vladislav Hrčka                </a>
            </div>
        </div>
                                            </div>
                                    <span class="strong">
								        <time datetime="2020-03-19 11:30:05">19 Mar 2020 - 11:30AM</time>
                                    </span>
                                </div>
                            
                            <div class="widgets row">
                                <div class="col-md-12 col-sm-12 col-xs-12">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12 no-padding">
                                        <h3><span class="text">Newsletter</span></h3>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-12 newsletter-wrapper">
                                    			
		<div class="heading-line col-md-12 no-padding sidebar-item clearfix">
			<h3>
				<span class="text">Newsletter</span>
			</h3>

			<form action="//liondigital.us3.list-manage.com/subscribe/post?u=b76f82b1cc198ab1d80665c99&amp;id=102b0810e2" class="basic-searchform col-md-12 col-sm-12 col-xs-12 no-padding newsletter" method="post" role="search">
				<div class="search-input clearfix">
					<input type="text" name="email" value="" placeholder="Email...">
					<button>
						Submit					</button>
				</div>
			</form>		
		</div>
                                </div>
                            </div>

                                                            <div class="similar-articles row">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12">
                                        <h3><span class="text">Similar Articles</span></h3>
                                    </div>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/cybercrime/" class="category-tag-btn">Cybercrime</a>                                                <a href="https://www.welivesecurity.com/2021/03/18/fbi-cybercrime-losses-topped-us42billion-2020/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/03/fbi-cybercrime-losses-2020-ic3-623x432.jpg"
                                                         alt="Stantinko’s new cryptominer features unique obfuscation techniques">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/03/18/fbi-cybercrime-losses-topped-us42billion-2020/">
                                                    FBI: Cybercrime losses topped US$4.2 billion in 2020                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/03/10/exchange-servers-under-siege-10-apt-groups/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/03/exchange-servers-under-siege-10-apt-groups-623x432.jpg"
                                                         alt="Stantinko’s new cryptominer features unique obfuscation techniques">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/03/10/exchange-servers-under-siege-10-apt-groups/">
                                                    Exchange servers under siege from at least 10 APT groups                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/02/18/malware-authors-already-taking-aim-apple-m1-macs/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/02/apple-m1-macs-malware-1-623x432.jpg"
                                                         alt="Stantinko’s new cryptominer features unique obfuscation techniques">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/02/18/malware-authors-already-taking-aim-apple-m1-macs/">
                                                    Malware authors already taking aim at Apple M1 Macs                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/02/02/kobalos-complex-linux-threat-high-performance-computing-infrastructure/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/02/eset-kobalos-hpc-high-performance-computing-malware-research-623x432.jpg"
                                                         alt="Stantinko’s new cryptominer features unique obfuscation techniques">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/02/02/kobalos-complex-linux-threat-high-performance-computing-infrastructure/">
                                                    Kobalos – A complex Linux threat to high performance computing infrastructure                                                </a>
                                            </h4>
                                        </article>
                                                                    </div>
                            
                            <div class="comments row">
                                <div class="heading-line col-xs-12">
                                    <h3><span class="text">Discussion</span></h3>
                                                                            
<div id="disqus_thread"></div>
                                                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    	</div> 	<footer id="site-footer">
		<div class="container">
			<div class="row">
				<div class="col-md-2">
                    <div class="hidden-sm hidden-xs">
                        <div class="logo-wrapper footer clearfix">
                            <div class="dark clearfix">
                                <a href="https://www.welivesecurity.com/" class="wls">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-1.svg" alt="Welivesecurity.com">
                                </a>
                                <a href="https://www.eset.com" class="eset">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-2.svg" alt="by ESET">
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="hidden-lg hidden-md">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
				</div>
				<nav id="footer" class="clearfix">
											<div class="mobile-block">
																<div class="col-md-2 col-md-offset-2">
										<ul>
																							<li>
													<a href="/">Home</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/about-us/">About Us</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/contact-us/">Contact Us</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/sitemap/">Sitemap</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/our-experts/">Our Experts</a>
												</li>
																							<li>
													<a href="https://eset.com">ESET</a>
												</li>
																					</ul>
									</div>
													</div>
											<div class="mobile-block">
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/research/">Research</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/category/how-to/">How To</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/categories/">Categories</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/rss-configurator/">RSS Configurator</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/news-widget-generator/">News Widget</a>
												</li>
																					</ul>
									</div>
													</div>
									</nav>
			</div>
			<div class="row">
				<div class="col-md-12 legal clearfix">
					<div class="wrap clearfix">
													<span>
								<a href="https://www.welivesecurity.com/privacy/">
									Privacy policy								</a>
							</span>
													<span>
								<a href="https://www.welivesecurity.com/legal-information/">
									Legal Information								</a>
							</span>
											</div>
					<span class="copyright pull-right">Copyright &copy; ESET, All Rights Reserved</span>
				</div>
							</div>
		</div>
	</footer>
	
	<button id="back-to-top" class="animated-scroll" data-target="absoluteTop">
		<span class="icomoon icon-icon_arrow"></span>
		<span class="text">Back to top</span>
	</button>

			<div class="social-wrapper-mobile hidden-lg hidden-md hidden-sm" id="mobile-article-sharer">
			<div class="col-xs-12">
				<div class="icons" style="text-align: center;">
											<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2020%2F03%2F19%2Fstantinko-new-cryptominer-unique-obfuscation-techniques%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
							<span class="icomoon icon-icon_fb"></span>
						</a>
											<a class="share-twitter" href="https://twitter.com/intent/tweet?https%3A%2F%2Fwww.welivesecurity.com%2F2020%2F03%2F19%2Fstantinko-new-cryptominer-unique-obfuscation-techniques%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
							<span class="icomoon icon-icon_tw"></span>
						</a>
											<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2020%2F03%2F19%2Fstantinko-new-cryptominer-unique-obfuscation-techniques%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
							<span class="icomoon icon-icon_in"></span>
						</a>
									</div>
			</div>
		</div>
	
	<script>
		var baseUrl = "https://www.welivesecurity.com/";
	</script>
	
			<script>
            !function(){if(-1==window.document.cookie.indexOf("user_rec=1")){function e(e,o){var t=document.createElement("img");t.setAttribute("style","display:none"),t.src=e+o,window.document.body.appendChild(t)}function o(){d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Default%20status&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=defaultStatus&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c)}function t(){console.log("GA and GTM are loaded."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=11",e(u,a),e(s,c)}function n(){var e=new Date;e.setTime(e.getTime()+63072e6);var o="expires="+e.toUTCString();window.document.cookie="user_rec=1; "+o+"; path=/"}var d,a,c,i,r,l="UA-76266002-27",g=window.location.href,s="https://cdn1.esetstatic.com/ESET/INT/assets/img/check.png",u="https://www.google-analytics.com/collect",w="wls",m=0,h=function e(){i=window.ga&&ga.create?1:0,r=window.google_tag_manager?1:0,m++,console.log("Timer: ",m),h=setTimeout(e,500)};window.document.addEventListener&&(d=1e6*Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Script%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=scriptLoaded&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c),window.addEventListener("beforeunload",o),window.ga&&ga.create&&window.google_tag_manager?(t(),window.removeEventListener("beforeunload",o),n()):(setTimeout(h,500),setTimeout(function(){clearTimeout(h),i&&r?t():i&&!r?(console.log("GA is loaded and GTM is blocked."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=10",e(u,a),e(s,c)):!i&&r?(console.log("GA is blocked and GTM is loaded."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=01",e(u,a),e(s,c)):i||r||(console.log("GA is blocked and GTM is blocked."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=00",e(u,a),e(s,c)),window.removeEventListener("beforeunload",o),n()},1e4)))}}();
		</script>
	
	<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/js/main-0ba0c3843d.js"></script>
    <!-- Version: v1.1.76.32619db9.pro-azeu -->
    		<script type="text/javascript">
			var disqus_config = function () { 
				this.language = "en";
			};
			var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":"", "numsVisible": false};
			var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
		</script>
		<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/static/js/crayon.min.js"></script>

			
		
    <script>
    	Main.init();
    </script>

    <script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"welivesecurity"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_count.js?ver=3.0.16'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var embedVars = {"disqusConfig":{"integration":"wordpress 3.0.16"},"disqusIdentifier":"135937 https:\/\/backend.welivesecurity.com\/?p=135937","disqusShortname":"welivesecurity","disqusTitle":"Stantinko\u2019s new cryptominer features unique obfuscation techniques","disqusUrl":"https:\/\/www.welivesecurity.com\/2020\/03\/19\/stantinko-new-cryptominer-unique-obfuscation-techniques\/","postId":"135937"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_embed.js?ver=3.0.16'></script>
    <script src="https://assets.esetstatic.com/3PR/app.min.js"></script>
  </body>
</html>