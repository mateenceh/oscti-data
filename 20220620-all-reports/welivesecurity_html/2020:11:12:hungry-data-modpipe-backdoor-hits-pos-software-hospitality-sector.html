<!doctype html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="google-site-verification" content="_b2avZwzr79oru6lM2Ddae1fNpSIbPaP0H0WNkc2x3k"/>
    <meta name="msvalidate.01" content="CE77828A466C2513F660017CFCB6BA13"/>
    <link rel="icon" href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/favicon.ico">

    

            
    
    <link href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/css/main-8633bd3c28.css" rel="stylesheet">
    <script type="text/javascript"> var appInsights=window.appInsights||function(a){ function b(a){c[a]=function(){var b=arguments;c.queue.push(function(){c[a].apply(c,b)})}}var c={config:a},d=document,e=window;setTimeout(function(){var b=d.createElement("script");b.src=a.url||"https://az416426.vo.msecnd.net/scripts/a/ai.0.js",d.getElementsByTagName("script")[0].parentNode.appendChild(b)});try{c.cookie=d.cookie}catch(a){}c.queue=[];for(var f=["Event","Exception","Metric","PageView","Trace","Dependency"];f.length;)b("track"+f.pop());if(b("setAuthenticatedUserContext"),b("clearAuthenticatedUserContext"),b("startTrackEvent"),b("stopTrackEvent"),b("startTrackPage"),b("stopTrackPage"),b("flush"),!a.disableExceptionTracking){f="onerror",b("_"+f);var g=e[f];e[f]=function(a,b,d,e,h){var i=g&&g(a,b,d,e,h);return!0!==i&&c["_"+f](a,b,d,e,h),i}}return c }({ instrumentationKey:"dcb460fe-684e-4d39-bfcd-d3a6f2710a32" }); window.appInsights=appInsights,appInsights.queue&&0===appInsights.queue.length&&appInsights.trackPageView(); </script>
    <script>
        window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
        'Author': 'Martin Smolár',
        'ArticleCategory': 'Malware',
        'ArticleSection': 'Research',
        'cookie-bar-hq': true
    });

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PMDGSM');
</script>
<script>(function() {
  var _fbq = window._fbq || (window._fbq = []);
  if (!_fbq.loaded) {
    var fbds = document.createElement('script');
    fbds.async = true;
    fbds.src = '//connect.facebook.net/en_US/fbds.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(fbds, s);
    _fbq.loaded = true;
  }
  _fbq.push(['addPixelId', '1518099328403839']);
})();
window._fbq = window._fbq || [];
window._fbq.push(['track', 'PixelInitialized', {}]);
</script>
<noscript><img height="1" width="1" alt="" style="display:none" src="https://www.facebook.com/tr?id=1518099328403839&amp;ev=NoScript" /></noscript>
<meta property="fb:pages" content="56844830907" />
<!-- This site is optimized with the Yoast SEO plugin v9.2 - https://yoast.com/wordpress/plugins/seo/ -->
<title>Hungry for data, ModPipe backdoor hits POS software used in hospitality sector | WeLiveSecurity</title>
<meta name="description" content="ESET researchers uncover ModPipe, a modular backdoor that targets POS software used by thousands of restaurants and hotels worldwide."/>
<link rel="canonical" href="https://www.welivesecurity.com/2020/11/12/hungry-data-modpipe-backdoor-hits-pos-software-hospitality-sector/" />
<meta property="og:locale" content="en_US" />
<meta property="og:locale:alternate" content="de_DE" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Hungry for data, ModPipe backdoor hits POS software used in hospitality sector | WeLiveSecurity" />
<meta property="og:description" content="ESET researchers uncover ModPipe, a modular backdoor that targets POS software used by thousands of restaurants and hotels worldwide." />
<meta property="og:url" content="https://www.welivesecurity.com/2020/11/12/hungry-data-modpipe-backdoor-hits-pos-software-hospitality-sector/" />
<meta property="og:site_name" content="WeLiveSecurity" />
<meta property="article:section" content="Malware" />
<meta property="article:published_time" content="2020-11-12T10:30:34+00:00" />
<meta property="article:modified_time" content="2021-01-01T06:17:36+00:00" />
<meta property="og:updated_time" content="2021-01-01T06:17:36+00:00" />
<meta property="og:image" content="https://www.welivesecurity.com/wp-content/uploads/2020/11/eset-modpipe-backdoor-pos-systems-restaurants-bars.jpg" />
<meta property="og:image:secure_url" content="https://www.welivesecurity.com/wp-content/uploads/2020/11/eset-modpipe-backdoor-pos-systems-restaurants-bars.jpg" />
<meta property="og:image:width" content="1001" />
<meta property="og:image:height" content="667" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="ESET researchers uncover ModPipe, a modular backdoor that targets POS software used by thousands of restaurants and hotels worldwide." />
<meta name="twitter:title" content="Hungry for data, ModPipe backdoor hits POS software used in hospitality sector | WeLiveSecurity" />
<meta name="twitter:site" content="@welivesecurity" />
<meta name="twitter:image" content="https://www.welivesecurity.com/wp-content/uploads/2020/11/eset-modpipe-backdoor-pos-systems-restaurants-bars.jpg" />
<meta name="twitter:creator" content="@welivesecurity" />
<!-- / Yoast SEO plugin. -->

<link rel='stylesheet' id='crayon-theme-classic-css'  href='https://www.welivesecurity.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://www.welivesecurity.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel="alternate" href="https://www.welivesecurity.com/2020/11/12/hungry-data-modpipe-backdoor-hits-pos-software-hospitality-sector/" hreflang="en" />
<link rel="alternate" href="https://www.welivesecurity.com/la-es/2020/11/16/backdoor-modpipe-afecta-software-pos-utilizado-sector-hotelero/" hreflang="es" />
<link rel="alternate" href="https://www.welivesecurity.com/deutsch/2020/11/12/hungrig-nach-daten-modpipe-backdoor-bedroht-pos-software-im-gastgewerbe/" hreflang="de" />
<link rel="alternate" type="application/rss+xml" title="WeLiveSecurity RSS 2.0 Feed" href="/rss-configurator/" /><style type="text/css" id="syntaxhighlighteranchor"></style>
        <link id="cookie-style" rel="stylesheet" type="text/css" href="https://assets.esetstatic.com/3PS/cookiebar.min.css">
</head>
<body class="no-js single wide">
<noscript>
	<iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PMDGSM" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div class="main">
    <header id="site-header" class="container">
        <div class="row">
            <div class="col-md-4 col-sm-12 col-xs-12 pull-right" id="header-nav">
                <div class="row">
                    <div class="col-xs-12 mobile-search-input">
                        <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                    </div>
                    <div class="hidden-lg hidden-md col-sm-7 col-xs-8 hidden-xxs">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
                    <div class="col-md-8 hidden-sm hidden-xs languages">
                        <div class="dropdown">
	<button class="btn btn-default dropdown-toggle" type="button" id="main-language-picker" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
    	<span class="text">In English</span>
    	<span class="icomoon icon-icon_arrow"></span>
  	</button>
  	<ul class="dropdown-menu" aria-labelledby="main-language-picker">
            <li>
        <a href="/br/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/2020/11/16/backdoor-modpipe-afecta-software-pos-utilizado-sector-hotelero/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/2020/11/12/hungrig-nach-daten-modpipe-backdoor-bedroht-pos-software-im-gastgewerbe/" title="In Deutsch">
            In Deutsch        </a>
    </li>
      	</ul>
</div>                    </div>
                    <div class="col-md-4 col-sm-2 col-xs-3 menu-trigger">
                        <div class="menu-btn">
	<span class="text">Menu</span>
	<button type="button" id="menu-trigger" class="tcon tcon-menu--xcross" aria-label="toggle menu">
        <span class="wrapper">
            <span class="tcon-menu__lines" aria-hidden="true"></span>
            <span class="tcon-visuallyhidden">toggle menu</span>
        </span>
    </button>
</div>                    </div>
                    <div class="hidden-lg hidden-md hidden-sm hidden-xs col-xs-2 mobile-search imc">
                        <button class="imc">
                            <span class="icomoon icon-icon_search imc"></span>
                        </button>
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12 imc" id="main-menu">
                        <nav class="menu clearfix imc">
                            <ul class="col-md-12 col-sm-6 col-xs-6 imc">
                                                                    <li class="">
                                        <a href="/">
                                            All Posts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/research">
                                            Research                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/category/how-to/">
                                            How To                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/videos/">
                                            Videos                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/podcasts/">
                                            Podcasts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/conference-papers/">
                                            Conference Materials                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/white-papers/">
                                            White Papers                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/threat-reports/">
                                            Threat Reports                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/magazine/">
                                            Magazine                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/our-experts/">
                                            Our Experts                                        </a>
                                    </li>
                                                            </ul>

                            <div class="col-md-12 col-sm-6 col-xs-6 imc">
                                <ul class="languages hidden-lg hidden-md hidden-xxs col-xs-12 imc">
                                        <li>
        <a href="/br/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/2020/11/16/backdoor-modpipe-afecta-software-pos-utilizado-sector-hotelero/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/2020/11/12/hungrig-nach-daten-modpipe-backdoor-bedroht-pos-software-im-gastgewerbe/" title="In Deutsch">
            In Deutsch        </a>
    </li>
                                    </ul>
                                <div class="hidden-lg hidden-md col-xs-12 imc">
                                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="menu-overlay col-md-12 col-sm-12 col-xs-12 imc">
                        <div class="inner imc"></div>
                    </div>
                </div>
                <div class="row hidden-sm hidden-xs">
                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc  col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                </div>
            </div>
            <div class="col-md-5 hidden-sm hidden-xs pull-left" id="header-logo">
                <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                <span class="slogan hidden-sm hidden-xs">
						Award-winning news, views, and insight from the ESET <strong>security community</strong> 
					</span>
            </div>
        </div>
    </header>
        <section id="article-detail">
            <div class="hero-wide" style="background-image: url('../../../../wp-content/uploads/2020/11/eset-discovers-modpipe-backdoor-pos-systems-restaurants.jpg'); background-position: 50% 50%;">
    <div class="text-wrapper">
        <div class="container promo-text">
            <div class="col-md-11 col-sm-11 col-xs-12 no-padding">
                <h1>Hungry for data, ModPipe backdoor hits POS software used in hospitality sector</h1>
<div class="excerpt">Backdoor authors show deep knowledge of the targeted POS software, decrypting database passwords from Windows registry values</div>
<div class="post-meta">
    <div class="wls-authors">
                <div class="wls-author with-avatar">
                            <div class="wls-author-avatar">
                    <a href="https://www.welivesecurity.com/author/msmolar/" title="Martin Smolár">
                        <img src="https://www.welivesecurity.com/wp-content/uploads/2020/05/martin.smolar-1-222x179.jpg" alt="Martin Smolár">
                    </a>
                </div>
                        <div class="wls-author-name">
                <a href="https://www.welivesecurity.com/author/msmolar/" title="Martin Smolár">
                    Martin Smolár                </a>
            </div>
        </div>
            </div>
    <span class="meta">
		<span class="strong">
			<time datetime="2020-11-12 11:30:34">12 Nov 2020 - 11:30AM</time>
		</span>
			</span>
</div>
            </div>
        </div>
    </div>
</div>

            <div class="content">
                <div class="social-wrapper" id="social-sharer">
                    <span class="text">Share</span>
	<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2020%2F11%2F12%2Fhungry-data-modpipe-backdoor-hits-pos-software-hospitality-sector%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
		<span class="icomoon icon-icon_fb"></span>
	</a>
	<a class="share-twitter" href="https://twitter.com/intent/tweet?&url=https%3A%2F%2Fwww.welivesecurity.com%2F2020%2F11%2F12%2Fhungry-data-modpipe-backdoor-hits-pos-software-hospitality-sector%2F&text=Hungry for data, ModPipe backdoor hits POS software used in hospitality sector%0A&via=welivesecurity" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
		<span class="icomoon icon-icon_tw"></span>
	</a>
	<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2020%2F11%2F12%2Fhungry-data-modpipe-backdoor-hits-pos-software-hospitality-sector%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
		<span class="icomoon icon-icon_in"></span>
	</a>
                </div>
                <div class="container">
                    <div class="row">
                        <div class="col-md-1 col-sm-1 hidden-xs">

                        </div>
                        <div class="col-md-10 col-sm-10 col-xs-12 formatted">

                            <div class="excerpt wide">
                                <p>Backdoor authors show deep knowledge of the targeted POS software, decrypting database passwords from Windows registry values</p>
                            </div>

                            <p>ESET researchers have discovered ModPipe, a modular backdoor that gives its operators access to sensitive information stored in devices running <a href="https://www.oracle.com/industries/food-beverage/products/res-3700/" target="_blank" rel="noopener">ORACLE MICROS Restaurant Enterprise Series (RES) 3700</a> POS – a management software suite used by hundreds of thousands of bars, restaurants, hotels and other hospitality establishments worldwide.</p>
<p>What makes the backdoor distinctive are its downloadable modules and their capabilities. One of them – named GetMicInfo – contains an algorithm designed to gather database passwords by decrypting them from Windows registry values. This shows that the backdoor’s authors have deep knowledge of the targeted software and opted for this sophisticated method instead of collecting the data via a simpler yet “louder” approach, such as keylogging.</p>
<p>Exfiltrated credentials allow ModPipe’s operators access to database contents, including various definitions and configuration, status tables and information about POS transactions.</p>
<p>However, based on the documentation of RES 3700 POS, the attackers should not be able to access some of the most sensitive information – such as credit card numbers and expiration dates – which is protected by encryption. The only customer data stored in the clear and thus available to the attackers should be cardholder names.</p>
<p>This would limit the amount of valuable information viable for further sale or misuse, making the full “business model” behind the operation unclear. One possible explanation is that another downloadable module exists that allows the malware operators to decrypt the more sensitive data in the user’s database.</p>
<p>According to the documentation, to achieve this the attackers would have to reverse engineer the generation process of the “site-specific passphrase”, which is used to derive the encryption key for sensitive data. This process would then have to be implemented into the module and – due to use of the Windows Data Protection API (DPAPI) – executed directly on the victim’s machine.  Another remaining unknown is ModPipe’s distribution method. The majority of the identified targets were from the United States, with indications that they were in the restaurant and hospitality sectors – the primary customers of RES 3700 POS.</p>
<h2>ModPipe architecture</h2>
<p>Our analysis shows that ModPipe uses modular architecture consisting of basic components and downloadable modules (for a better overview see Figure 1):</p>
<ol>
<li><strong>initial dropper</strong> – contains both 32-bit and 64-bit binaries of the next stage – the persistent loader – and installs the appropriate version to the compromised machine.</li>
<li><strong>persistent loader</strong> – unpacks and loads the next stage of the malware, namely the main module.</li>
<li><strong>main module </strong>– performs the main functionality of the malware. It creates a pipe used for communication with other malicious modules, un/installs these modules and serves as a dispatcher that handles communication between the modules and attacker’s <a href="https://www.virusradar.com/en/glossary/command-and-control-server" target="_blank" rel="noopener">C&amp;C</a> server.</li>
<li><strong>networking module </strong>– module used for communication with C&amp;C.</li>
<li><strong>downloadable modules</strong> – components adding specific functionality to the backdoor, such as the ability to steal database passwords and configuration information, scan specific IP addresses or acquire a list of the running processes and their loaded modules.</li>
</ol>
<div id="attachment_144985" style="width: 760px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-1.-Overview-of-ModPipe-backdoor-architecture.png"><img class="wp-image-144985" src="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-1.-Overview-of-ModPipe-backdoor-architecture-150x150.png" alt="" width="750" height="1026" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-1.-Overview-of-ModPipe-backdoor-architecture-219x300.png 219w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-1.-Overview-of-ModPipe-backdoor-architecture-768x1051.png 768w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-1.-Overview-of-ModPipe-backdoor-architecture-748x1024.png 748w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-1.-Overview-of-ModPipe-backdoor-architecture.png 1096w" sizes="(max-width: 750px) 100vw, 750px" /></a><p class="wp-caption-text"><i>Figure 1. Overview of ModPipe backdoor architecture</i></p></div>
<h3>Downloadable modules</h3>
<p>Probably the most intriguing parts of ModPipe are its downloadable modules. We’ve been aware of their existence since the end of 2019, when we first found and analyzed its “basic” components.</p>
<p>In April 2020, after a couple of months of hunting, we found three of these modules in the wild. The list of all downloadable modules we found and analyzed, and their IDs – represented by a 16-bit unsigned value – are available in Table 1. Our research also suggests that the operators use at least four other downloadable modules, whose functionality remains completely unknown to us for now.</p>
<p>It’s worth mentioning that some of these modules can create a named pipe with a GUID-formatted name derived from the module’s ID. Other modules can use this pipe to send commands to the module that created it.</p>
<p><em>Table 1. Downloadable modules</em></p>

<table id="tablepress-885" class="tablepress tablepress-id-885">
<thead>
<tr class="row-1 odd">
	<th class="column-1">Module ID</th><th class="column-2">Name</th><th class="column-3">Description</th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1">0xA0C0</td><td class="column-2">GetMicInfo</td><td class="column-3">Steals database passwords, data and various settings</td>
</tr>
<tr class="row-3 odd">
	<td class="column-1">0x2000</td><td class="column-2">ModScan</td><td class="column-3">Performs scan on the specified IP addresses</td>
</tr>
<tr class="row-4 even">
	<td class="column-1">-</td><td class="column-2">ProcList</td><td class="column-3">Gets list of the running processes and their loaded modules</td>
</tr>
<tr class="row-5 odd">
	<td class="column-1">0xA000</td><td class="column-2">unknown</td><td class="column-3">-</td>
</tr>
<tr class="row-6 even">
	<td class="column-1">0xA040</td><td class="column-2">unknown</td><td class="column-3">-</td>
</tr>
<tr class="row-7 odd">
	<td class="column-1">0xA740</td><td class="column-2">unknown</td><td class="column-3">-</td>
</tr>
<tr class="row-8 even">
	<td class="column-1">0xA080</td><td class="column-2">unknown</td><td class="column-3">-</td>
</tr>
</tbody>
</table>

<h4></h4>
<h4><strong>Downloadable module: GetMicInfo</strong></h4>
<p>GetMicInfo is a downloadable component that targets data related to the MICROS POS including passwords tied to two database usernames predefined by the manufacturer: <span style="font-family: courier new, courier, monospace;">dba</span> and <span style="font-family: courier new, courier, monospace;">micros</span> (see Figure 2). This information is encrypted and stored in <span style="font-family: courier new, courier, monospace;">DataS5</span> (for <span style="font-family: courier new, courier, monospace;">dba</span>) and <span style="font-family: courier new, courier, monospace;">DataS6</span> (for <span style="font-family: courier new, courier, monospace;">micros</span>) registry values within one of the following registry keys:</p>
<ul>
<li><span style="font-family: courier new, courier, monospace;">HKLM\Software\Micros\UserData</span> or</li>
<li><span style="font-family: courier new, courier, monospace;">HKLM\Software\WOW6432Node\Micros\UserData</span> if run in Windows 32-bit on Windows 64-bit (WOW64) subsystem</li>
</ul>
<div id="attachment_144986" style="width: 607px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-2.-Hex-Rays-decompiled-code-of-the-function-stealing-database-passwords.png"><img class="wp-image-144986 size-full" src="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-2.-Hex-Rays-decompiled-code-of-the-function-stealing-database-passwords.png" alt="" width="597" height="357" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-2.-Hex-Rays-decompiled-code-of-the-function-stealing-database-passwords.png 597w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-2.-Hex-Rays-decompiled-code-of-the-function-stealing-database-passwords-300x179.png 300w" sizes="(max-width: 597px) 100vw, 597px" /></a><p class="wp-caption-text"><i>Figure 2. Hex-Rays decompiled code of the function stealing database passwords</i></p></div>
<p>The GetMicInfo module can intercept and decrypt these database passwords, using a specifically designed algorithm. So as not to aid other malicious actors, we won’t be disclosing the inner workings of the algorithm. Since the decryption mechanism wasn’t publicly available, there are at least three possible scenarios of how the attackers could have created the algorithm:</p>
<ul>
<li>The most probable option is that the attackers acquired and<strong> reverse engineered the implementation of the ORACLE MICROS RES 3700</strong> <strong>POS</strong> and the libraries responsible for encryption and decryption of the database passwords.</li>
<li>The attackers could have gained the information describing the implementation of the encryption and decryption mechanism from a 2016 data breach, <a href="https://krebsonsecurity.com/2016/08/data-breach-at-oracles-micros-point-of-sale-division/" target="_blank" rel="noopener">first reported by security journalist Brian Krebs</a>.</li>
<li>The malware operators could have bought the code from an underground market.</li>
</ul>
<p>Our analysis shows that in cases where the GetMicInfo module decrypts the password for the dba username, it will also try to acquire the path to the SQL Anywhere API library from the environment variable “SQLANY_API_DLL” and load it if it’s available.</p>
<p>If the environment variable does not exist, the module tries to load the library using its name <span style="font-family: courier new, courier, monospace;">dbcapi.dll</span>. This library is a part of Sybase SQL Anywhere, which is used by RES 3700 POS.</p>
<p>If one of these approaches is successful, GetMicInfo attempts to connect to the database using the following connection string:</p>
<p style="text-align: left;"><span style="font-family: courier new, courier, monospace;">DBN=micros;UID=dba;ENG=sql%PCNAME%;PWD=%decrypted_DataS5%</span></p>
<p><span style="font-family: courier new, courier, monospace;">%PCNAME%</span> represents the computer name retrieved via the GetComputerName API and <span style="font-family: courier new, courier, monospace;">%decrypted_DataS5%</span> stands for the decrypted <span style="font-family: courier new, courier, monospace;">dba</span> user password.</p>
<p>After establishing a connection, GetMicInfo tries to execute the following SQL queries and report the results to the main module, using a pipe message with ID 0x10000013 (see Table 3 for a full list of pipe messages and their IDs):</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-6057fb3e9c948580284958" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
SELECT lan_node_seq,obj_num,name,lan_addr,ob_diskless,type,ip_addr,ip_netmask FROM micros.lan_node_def

SELECT dvc_tbl_seq,obj_num,name,type,com_port_seq,com_port,baud_rate,num_data_bits,num_stop_bits,parity_type,filename FROM micros.dev_def

SELECT tmed_seq,obj_num,name,type,ca_driver,edc_driver FROM micros.tmed_def

SELECT * FROM micros.caedc_driver_def

SELECT * FROM micros.interface_def</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-6057fb3e9c948580284958-1">1</div><div class="crayon-num" data-line="crayon-6057fb3e9c948580284958-2">2</div><div class="crayon-num" data-line="crayon-6057fb3e9c948580284958-3">3</div><div class="crayon-num" data-line="crayon-6057fb3e9c948580284958-4">4</div><div class="crayon-num" data-line="crayon-6057fb3e9c948580284958-5">5</div><div class="crayon-num" data-line="crayon-6057fb3e9c948580284958-6">6</div><div class="crayon-num" data-line="crayon-6057fb3e9c948580284958-7">7</div><div class="crayon-num" data-line="crayon-6057fb3e9c948580284958-8">8</div><div class="crayon-num" data-line="crayon-6057fb3e9c948580284958-9">9</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-6057fb3e9c948580284958-1"><span class="crayon-e">SELECT </span><span class="crayon-v">lan_node_seq</span><span class="crayon-sy">,</span><span class="crayon-v">obj_num</span><span class="crayon-sy">,</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-v">lan_addr</span><span class="crayon-sy">,</span><span class="crayon-v">ob_diskless</span><span class="crayon-sy">,</span><span class="crayon-v">type</span><span class="crayon-sy">,</span><span class="crayon-v">ip_addr</span><span class="crayon-sy">,</span><span class="crayon-e">ip_netmask </span><span class="crayon-e">FROM </span><span class="crayon-v">micros</span><span class="crayon-sy">.</span><span class="crayon-e">lan_node_def</span></div><div class="crayon-line" id="crayon-6057fb3e9c948580284958-2">&nbsp;</div><div class="crayon-line" id="crayon-6057fb3e9c948580284958-3"><span class="crayon-e">SELECT </span><span class="crayon-v">dvc_tbl_seq</span><span class="crayon-sy">,</span><span class="crayon-v">obj_num</span><span class="crayon-sy">,</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-v">type</span><span class="crayon-sy">,</span><span class="crayon-v">com_port_seq</span><span class="crayon-sy">,</span><span class="crayon-v">com_port</span><span class="crayon-sy">,</span><span class="crayon-v">baud_rate</span><span class="crayon-sy">,</span><span class="crayon-v">num_data_bits</span><span class="crayon-sy">,</span><span class="crayon-v">num_stop_bits</span><span class="crayon-sy">,</span><span class="crayon-v">parity_type</span><span class="crayon-sy">,</span><span class="crayon-e">filename </span><span class="crayon-e">FROM </span><span class="crayon-v">micros</span><span class="crayon-sy">.</span><span class="crayon-e">dev_def</span></div><div class="crayon-line" id="crayon-6057fb3e9c948580284958-4">&nbsp;</div><div class="crayon-line" id="crayon-6057fb3e9c948580284958-5"><span class="crayon-e">SELECT </span><span class="crayon-v">tmed_seq</span><span class="crayon-sy">,</span><span class="crayon-v">obj_num</span><span class="crayon-sy">,</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-v">type</span><span class="crayon-sy">,</span><span class="crayon-v">ca_driver</span><span class="crayon-sy">,</span><span class="crayon-e">edc_driver </span><span class="crayon-e">FROM </span><span class="crayon-v">micros</span><span class="crayon-sy">.</span><span class="crayon-e">tmed_def</span></div><div class="crayon-line" id="crayon-6057fb3e9c948580284958-6">&nbsp;</div><div class="crayon-line" id="crayon-6057fb3e9c948580284958-7"><span class="crayon-e ">SELECT *</span><span class="crayon-h"> </span><span class="crayon-e">FROM </span><span class="crayon-v">micros</span><span class="crayon-sy">.</span><span class="crayon-e">caedc_driver_def</span></div><div class="crayon-line" id="crayon-6057fb3e9c948580284958-8">&nbsp;</div><div class="crayon-line" id="crayon-6057fb3e9c948580284958-9"><span class="crayon-e ">SELECT *</span><span class="crayon-h"> </span><span class="crayon-e">FROM </span><span class="crayon-v">micros</span><span class="crayon-sy">.</span><span class="crayon-v">interface_def</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>&nbsp;</p>
<p>Queried data contain various MICROS RES 3700 POS system definitions and configurations (see Figure 3). Other information stolen by the module includes the version of the MICROS POS and information about specific registry keys most likely related to various credit card services configurations.</p>
<div id="attachment_144987" style="width: 610px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-3.-Hex-Rays-decompiled-code-of-the-function-that-steals-database-data.png"><img class="wp-image-144987" src="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-3.-Hex-Rays-decompiled-code-of-the-function-that-steals-database-data-150x150.png" alt="" width="600" height="244" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-3.-Hex-Rays-decompiled-code-of-the-function-that-steals-database-data-300x122.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-3.-Hex-Rays-decompiled-code-of-the-function-that-steals-database-data-340x137.png 340w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-3.-Hex-Rays-decompiled-code-of-the-function-that-steals-database-data.png 754w" sizes="(max-width: 600px) 100vw, 600px" /></a><p class="wp-caption-text"><i>Figure 3. Hex-Rays decompiled code of the function that steals database data</i></p></div>
<p>The GetMicInfo module is injected into one of the processes specified by the C&amp;C in the install command (0x0C). Based on our findings, it is typically associated with one of the following legitimate processes:</p>
<ul>
<li><span style="font-family: courier new, courier, monospace;">MDSHTTPService.exe</span> (MICROS MDS HTTP Service)</li>
<li><span style="font-family: courier new, courier, monospace;">CALSrv.exe</span> (MICROS CAL Service &#8211; Client Application Loader server)</li>
<li><span style="font-family: courier new, courier, monospace;">explorer.exe</span></li>
</ul>
<p>We can confirm that the GetMicInfo module can successfully obtain the database passwords from RES 3700 POS v4.7 and v5.4. For all the other versions, we were neither able to confirm nor deny the ability of the component to obtain the targeted libraries.</p>
<h4><strong>Downloadable module: ModScan 2.20</strong></h4>
<p>The main purpose of ModScan 2.20 is to collect additional information about the installed MICROS POS environment on the machines by scanning selected IP addresses. The ModScan 2.20 module is injected into one of the processes specified by the C&amp;C via an InstallMod command (0x72). Based on our findings, it is typically associated with one of the following legitimate processes:</p>
<ul>
<li><span style="font-family: courier new, courier, monospace;">MDSHTTPService.exe</span> (MICROS MDS HTTP Service)</li>
<li><span style="font-family: courier new, courier, monospace;">CALSrv.exe</span> (MICROS CAL Service &#8211; Client Application Loader server)</li>
<li><span style="font-family: courier new, courier, monospace;">msdtc.exe</span></li>
<li><span style="font-family: courier new, courier, monospace;">jusched.exe</span></li>
<li><span style="font-family: courier new, courier, monospace;">spoolsv.exe</span></li>
<li><span style="font-family: courier new, courier, monospace;">services.exe</span></li>
</ul>
<p>Differences between the injected processes misused by GetMicInfo and those targeted by ModScan 2.20 might be caused by the fact that GetMicInfo module is injected only into processes running under WOW64.</p>
<p>The list of IP addresses intended for scanning and the special “ping” IP address are specified by the C&amp;C in one of two ways. It is either:</p>
<ol>
<li>downloaded from the C&amp;C along with the ModScan module, or</li>
<li>received during runtime, using the named pipe associated with the ModScan module.</li>
</ol>
<p>The ModScan module handles pipe commands listed in Table 2.</p>
<p><em>Table 2. ModScan 2.20 module pipe commands</em></p>

<table id="tablepress-886" class="tablepress tablepress-id-886">
<thead>
<tr class="row-1 odd">
	<th class="column-1">Command name</th><th class="column-2">Command description</th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1">exit</td><td class="column-2">Exit</td>
</tr>
<tr class="row-3 odd">
	<td class="column-1">stop</td><td class="column-2">Terminate scanning threads</td>
</tr>
<tr class="row-4 even">
	<td class="column-1">scan</td><td class="column-2">Start scanning IPs specified in the command data to collect additional information about the environment</td>
</tr>
<tr class="row-5 odd">
	<td class="column-1">prm</td><td class="column-2">Specify special “ping”  IP address</td>
</tr>
</tbody>
</table>

<p>&nbsp;</p>
<p><strong>Scanning procedure routine</strong></p>
<ol>
<li>Before scanning, the module sends a special “ping” message containing a 32-bit value generated by the<span style="font-family: courier new, courier, monospace;"> GetTickCount</span> Windows API function to TCP ports 50123 (used by MDS HTTP Service) and 2638 (used by SAP Sybase database server) of the “ping” IP address.</li>
<li>The response from the “ping” IP address should contain the same 32-bit value rotated right by one bit and XORed with the value 0x6CF6B8A8. If the response on at least one of the ports provides the appropriate value, the module will start the scan of the selected IP addresses. A decompilation of this ping function is shown in Figure 4.</li>
</ol>
<div id="attachment_144988" style="width: 549px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-4.-Hex-Rays-decompiled-code-of-the-ModScan-ping-functionality.png"><img class="wp-image-144988 size-full" src="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-4.-Hex-Rays-decompiled-code-of-the-ModScan-ping-functionality.png" alt="" width="539" height="255" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-4.-Hex-Rays-decompiled-code-of-the-ModScan-ping-functionality.png 539w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-4.-Hex-Rays-decompiled-code-of-the-ModScan-ping-functionality-300x142.png 300w" sizes="(max-width: 539px) 100vw, 539px" /></a><p class="wp-caption-text"><i>Figure 4. Hex-Rays decompiled code of the ModScan ping functionality</i></p></div>
<ol start="3">
<li>When the ModScan module starts the scan, some of the following information may be gathered, depending on the parameters received along with the scan command:</li>
</ol>
<ul>
<li><strong>Version of the Oracle MICROS RES 3700 POS, </strong>which is acquired by sending an HTTP Post message (see Figure 5) to the specified IP address on port 50123 used by the MDS HTTP Service. The sought-after information is stored between data xml tags (<span style="font-family: courier new, courier, monospace;">&lt;data&gt;%version%&lt;/data&gt;</span>) of the response from the service.</li>
</ul>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-6057fb3e9c951212323271" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" no-popup minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-6057fb3e9c951212323271-1">1</div><div class="crayon-num" data-line="crayon-6057fb3e9c951212323271-2">2</div><div class="crayon-num" data-line="crayon-6057fb3e9c951212323271-3">3</div><div class="crayon-num" data-line="crayon-6057fb3e9c951212323271-4">4</div><div class="crayon-num" data-line="crayon-6057fb3e9c951212323271-5">5</div><div class="crayon-num" data-line="crayon-6057fb3e9c951212323271-6">6</div><div class="crayon-num" data-line="crayon-6057fb3e9c951212323271-7">7</div><div class="crayon-num" data-line="crayon-6057fb3e9c951212323271-8">8</div><div class="crayon-num" data-line="crayon-6057fb3e9c951212323271-9">9</div><div class="crayon-num" data-line="crayon-6057fb3e9c951212323271-10">10</div><div class="crayon-num" data-line="crayon-6057fb3e9c951212323271-11">11</div><div class="crayon-num" data-line="crayon-6057fb3e9c951212323271-12">12</div><div class="crayon-num" data-line="crayon-6057fb3e9c951212323271-13">13</div><div class="crayon-num" data-line="crayon-6057fb3e9c951212323271-14">14</div><div class="crayon-num" data-line="crayon-6057fb3e9c951212323271-15">15</div><div class="crayon-num" data-line="crayon-6057fb3e9c951212323271-16">16</div><div class="crayon-num" data-line="crayon-6057fb3e9c951212323271-17">17</div><div class="crayon-num" data-line="crayon-6057fb3e9c951212323271-18">18</div><div class="crayon-num" data-line="crayon-6057fb3e9c951212323271-19">19</div><div class="crayon-num" data-line="crayon-6057fb3e9c951212323271-20">20</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-6057fb3e9c951212323271-1"><span class="crayon-v">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-o">%</span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-v">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line" id="crayon-6057fb3e9c951212323271-2"><span class="crayon-v">Accept</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-o">/</span><span class="crayon-e">xml</span></div><div class="crayon-line" id="crayon-6057fb3e9c951212323271-3"><span class="crayon-v">User</span><span class="crayon-o">-</span><span class="crayon-v">Agent</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">MDS </span><span class="crayon-e">POS </span><span class="crayon-e">Client</span></div><div class="crayon-line" id="crayon-6057fb3e9c951212323271-4"><span class="crayon-v">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-v">s</span><span class="crayon-o">:</span><span class="crayon-cn">50123</span></div><div class="crayon-line" id="crayon-6057fb3e9c951212323271-5"><span class="crayon-v">Content</span><span class="crayon-o">-</span><span class="crayon-v">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">459</span></div><div class="crayon-line" id="crayon-6057fb3e9c951212323271-6"><span class="crayon-v">Connection</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Keep</span><span class="crayon-o">-</span><span class="crayon-e">Alive</span></div><div class="crayon-line" id="crayon-6057fb3e9c951212323271-7"><span class="crayon-v">Cache</span><span class="crayon-o">-</span><span class="crayon-v">Control</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">no</span><span class="crayon-o">-</span><span class="crayon-v">cache</span></div><div class="crayon-line" id="crayon-6057fb3e9c951212323271-8">&nbsp;</div><div class="crayon-line" id="crayon-6057fb3e9c951212323271-9"><span class="crayon-o">&lt;</span><span class="crayon-v">SOAP</span><span class="crayon-o">-</span><span class="crayon-v">ENV</span><span class="crayon-o">:</span><span class="crayon-e">Envelope </span><span class="crayon-v">xmlns</span><span class="crayon-o">:</span><span class="crayon-v">SOAP</span><span class="crayon-o">-</span><span class="crayon-v">ENV</span><span class="crayon-o">=</span><span class="crayon-s">"http://schemas.xmlsoap.org/soap/envelope/"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-6057fb3e9c951212323271-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-v">SOAP</span><span class="crayon-o">-</span><span class="crayon-v">ENV</span><span class="crayon-o">:</span><span class="crayon-e">Body </span><span class="crayon-v">xmlns</span><span class="crayon-o">:</span><span class="crayon-v">MCRS</span><span class="crayon-o">-</span><span class="crayon-v">ENV</span><span class="crayon-o">=</span><span class="crayon-s">"MCRS-URI"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-6057fb3e9c951212323271-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-v">MCRS</span><span class="crayon-o">-</span><span class="crayon-v">ENV</span><span class="crayon-o">:</span><span class="crayon-v">Service</span><span class="crayon-o">&gt;</span><span class="crayon-v">MDSSYSUTILS</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">MCRS</span><span class="crayon-o">-</span><span class="crayon-v">ENV</span><span class="crayon-o">:</span><span class="crayon-v">Service</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-6057fb3e9c951212323271-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-v">MCRS</span><span class="crayon-o">-</span><span class="crayon-v">ENV</span><span class="crayon-o">:</span><span class="crayon-v">Method</span><span class="crayon-o">&gt;</span><span class="crayon-v">Reg_GetValue</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">MCRS</span><span class="crayon-o">-</span><span class="crayon-v">ENV</span><span class="crayon-o">:</span><span class="crayon-v">Method</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-6057fb3e9c951212323271-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-v">MCRS</span><span class="crayon-o">-</span><span class="crayon-v">ENV</span><span class="crayon-o">:</span><span class="crayon-v">SessionKey</span><span class="crayon-o">&gt;</span><span class="crayon-v">Session</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">MCRS</span><span class="crayon-o">-</span><span class="crayon-v">ENV</span><span class="crayon-o">:</span><span class="crayon-v">SessionKey</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-6057fb3e9c951212323271-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-v">MCRS</span><span class="crayon-o">-</span><span class="crayon-v">ENV</span><span class="crayon-o">:</span><span class="crayon-v">InputParameters</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-6057fb3e9c951212323271-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-v">Key</span><span class="crayon-o">&gt;</span><span class="crayon-v">SOFTWARE</span><span class="crayon-sy">\</span><span class="crayon-v">MICROS</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">Key</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-6057fb3e9c951212323271-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-v">KeyType</span><span class="crayon-o">&gt;</span><span class="crayon-v">HKEY_LOCAL_MACHINE</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">KeyType</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-6057fb3e9c951212323271-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-v">KeyName</span><span class="crayon-o">&gt;</span><span class="crayon-v">Version</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">KeyName</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-6057fb3e9c951212323271-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">MCRS</span><span class="crayon-o">-</span><span class="crayon-v">ENV</span><span class="crayon-o">:</span><span class="crayon-v">InputParameters</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-6057fb3e9c951212323271-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">SOAP</span><span class="crayon-o">-</span><span class="crayon-v">ENV</span><span class="crayon-o">:</span><span class="crayon-v">Body</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-6057fb3e9c951212323271-20"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">SOAP</span><span class="crayon-o">-</span><span class="crayon-v">ENV</span><span class="crayon-o">:</span><span class="crayon-v">Envelope</span><span class="crayon-o">&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p><em>Figure 5. MDS HTTP Service request</em></p>
<ul>
<li><strong>Name of the database</strong>, extracted by sending a specially crafted TCP packet (possibly using the CMDSEQ command protocol) to the selected IP address on port 2638 used by the SAP Sybase Database Server. The string representing the name of the database is located at offset 0x28 of the response sent by the database server.</li>
<li><strong>Database server</strong> <strong>data, </strong>such as its name, version of the TDS protocol and the TDS server version. To gain this information, the ModScan module sends a hardcoded <a href="http://www.freetds.org/tds.html#login" target="_blank" rel="noopener">TDS 4.2 &amp; 5.0 Login Packet</a> (Figure 6) to the specified IP address on port 2638. The response includes a <a href="http://www.freetds.org/tds.html#t173" target="_blank" rel="noopener">Login Acknowledgement</a> packet which, in both cases – success and failure – contains information about the database server and the TDS versions used. The TDS login packet is hardcoded, with username set to the built-in dba and a hardcoded password, which is potentially the default password in some RES 3700 POS versions. As we haven’t found any public reference to this password, we won’t be publishing it in our blogpost.</li>
</ul>
<div id="attachment_144989" style="width: 417px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-6.-TDS-4.2-5.0-Login-Packet-used-by-the-ModScan-module-dissected-using-Wireshark.png"><img class="wp-image-144989 size-full" src="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-6.-TDS-4.2-5.0-Login-Packet-used-by-the-ModScan-module-dissected-using-Wireshark.png" alt="" width="407" height="427" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-6.-TDS-4.2-5.0-Login-Packet-used-by-the-ModScan-module-dissected-using-Wireshark.png 407w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-6.-TDS-4.2-5.0-Login-Packet-used-by-the-ModScan-module-dissected-using-Wireshark-286x300.png 286w" sizes="(max-width: 407px) 100vw, 407px" /></a><p class="wp-caption-text"><i>Figure 6. TDS 4.2 &amp; 5.0 Login Packet used by the ModScan module, dissected using Wireshark</i></p></div>
<h4><strong>Downloadable module: ProcList</strong></h4>
<p>The last of the downloadable modules we were able to obtain and dissect was ProcList. This is a lightweight module that doesn’t have an assigned ID. Its main purpose is to collect information about currently running processes, including: name, process identifier (PID), parent process PID, number of threads, token owner, token domain, process creation time, and command line.</p>
<p>Optionally, ProcList can also collect information about loaded modules for each of the running processes. Collected information is sent to the main module of the backdoor (using pipe message 0x10000013).</p>
<h3>Initial dropper</h3>
<p>The initial dropper is responsible for installing the next stage of the malware. During our investigation, we discovered one dropper executable on two compromised machines, stored in the following locations:</p>
<ul>
<li><span style="font-family: courier new, courier, monospace;">C:\IQXDatabase\Live\1.exe</span></li>
<li><span style="font-family: courier new, courier, monospace;">C:\OasisLive\1.exe</span></li>
</ul>
<p>Each time the initial dropper is executed, a unique configuration is generated, using mostly random bytes. This causes the hash of the dropped loader to change with each execution, complicating detection and tracking of the malware. The dropper component can drop the loader into two possible locations and set up the persistence mechanism by creating a Windows service or Windows registry Run key (for details, please refer to the <em>Indicators of Compromise</em> section).</p>
<p>The encrypted payload, containing the main functionality of the dropper, is stored in the dropper&#8217;s resources as bitmaps named from A to L. The dropper decrypts this payload using the provided command line parameter, then executes it. The payload is responsible for decrypting the appropriate loader depending on the system architecture, so either 32-bit or 64-bit. Each of the loaders is encrypted using its own XOR key, each 0x80 bytes long. Decompiled code responsible for loading the payload from the binary’s resources, its decryption and execution is shown in Figure 7.</p>
<p><center><br />
<a href="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-7a.-Hex-Rays-decompiled-code-decryption-and-execution-of-the-payload-in-the-initial-dropper.png"><img class="aligncenter wp-image-144990" src="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-7a.-Hex-Rays-decompiled-code-decryption-and-execution-of-the-payload-in-the-initial-dropper-150x150.png" alt="" width="650" height="434" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-7a.-Hex-Rays-decompiled-code-decryption-and-execution-of-the-payload-in-the-initial-dropper-300x200.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-7a.-Hex-Rays-decompiled-code-decryption-and-execution-of-the-payload-in-the-initial-dropper-65x42.png 65w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-7a.-Hex-Rays-decompiled-code-decryption-and-execution-of-the-payload-in-the-initial-dropper-114x76.png 114w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-7a.-Hex-Rays-decompiled-code-decryption-and-execution-of-the-payload-in-the-initial-dropper-97x65.png 97w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-7a.-Hex-Rays-decompiled-code-decryption-and-execution-of-the-payload-in-the-initial-dropper.png 720w" sizes="(max-width: 650px) 100vw, 650px" /></a></center>&nbsp;</p>
<div id="attachment_144991" style="width: 660px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-7b.-Hex-Rays-decompiled-code-decryption-and-execution-of-the-payload-in-the-initial-dropper.png"><img class="wp-image-144991" src="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-7b.-Hex-Rays-decompiled-code-decryption-and-execution-of-the-payload-in-the-initial-dropper-150x150.png" alt="" width="650" height="363" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-7b.-Hex-Rays-decompiled-code-decryption-and-execution-of-the-payload-in-the-initial-dropper-300x168.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-7b.-Hex-Rays-decompiled-code-decryption-and-execution-of-the-payload-in-the-initial-dropper-768x429.png 768w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-7b.-Hex-Rays-decompiled-code-decryption-and-execution-of-the-payload-in-the-initial-dropper-143x79.png 143w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-7b.-Hex-Rays-decompiled-code-decryption-and-execution-of-the-payload-in-the-initial-dropper-298x165.png 298w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-7b.-Hex-Rays-decompiled-code-decryption-and-execution-of-the-payload-in-the-initial-dropper.png 820w" sizes="(max-width: 650px) 100vw, 650px" /></a><p class="wp-caption-text"><i>Figure 7. Hex-Rays decompiled code &#8211; decryption and execution of the payload in the initial dropper</i></p></div>
<p>An example of an encrypted and decrypted configuration with explanations is visible in Figure 8. The configuration shown comes from the loader installed by the dropper sample with SHA-1 hash <span style="font-family: courier new, courier, monospace;">9f8530627a8ad38f47102f626dec9f0173b44cd5</span>. Note that the structure of the configuration can vary between older and newer versions of the loader executable.</p>
<div id="attachment_144992" style="width: 742px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-8.-Example-of-the-loaders-generated-configuration-upper-is-encrypted-lower-decrypted.png"><img class="wp-image-144992 size-full" src="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-8.-Example-of-the-loaders-generated-configuration-upper-is-encrypted-lower-decrypted.png" alt="" width="732" height="430" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-8.-Example-of-the-loaders-generated-configuration-upper-is-encrypted-lower-decrypted.png 732w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-8.-Example-of-the-loaders-generated-configuration-upper-is-encrypted-lower-decrypted-300x176.png 300w" sizes="(max-width: 732px) 100vw, 732px" /></a><p class="wp-caption-text"><i>Figure 8. Example of the loader&#8217;s generated configuration (upper is encrypted, lower decrypted)</i></p></div>
<h3>Persistent loader</h3>
<p>This component is responsible for both unpacking the main module and for its injection into one of the following processes:</p>
<ul>
<li><span style="font-family: courier new, courier, monospace;">lsass.exe</span></li>
<li><span style="font-family: courier new, courier, monospace;">wininit.exe</span></li>
<li><span style="font-family: courier new, courier, monospace;">services.exe</span></li>
</ul>
<p>To unpack the main module, the persistent loader uses different approaches for the 32-bit and 64-bit versions. While the 32-bit loader is almost identical to the initial dropper – the only difference being the payloads stored in the resources – the 64-bit loader uses completely different “unpacking” code.</p>
<p>We have found seven different versions of the loader executables, each having a different compilation timestamp, with the oldest one probably originating in December 2017 and the latest in June 2020. For the full timeline, see Figure 9. A list of all the loader hashes is included in the <em>Indicators of Compromise</em> section.</p>
<div id="attachment_144993" style="width: 760px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-9.-Timeline-of-known-ModPipe-variants-and-their-timestamps..png"><img class="wp-image-144993" src="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-9.-Timeline-of-known-ModPipe-variants-and-their-timestamps.-150x150.png" alt="" width="750" height="133" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-9.-Timeline-of-known-ModPipe-variants-and-their-timestamps.-300x53.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-9.-Timeline-of-known-ModPipe-variants-and-their-timestamps.-768x136.png 768w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-9.-Timeline-of-known-ModPipe-variants-and-their-timestamps.-1024x182.png 1024w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-9.-Timeline-of-known-ModPipe-variants-and-their-timestamps..png 1500w" sizes="(max-width: 750px) 100vw, 750px" /></a><p class="wp-caption-text"><i>Figure 9. Timeline of known ModPipe variants and their timestamps.</i></p></div>
<h3>Main module</h3>
<p>The main module is mostly responsible for managing C&amp;C communication and for handling received messages/commands, either from C&amp;C or downloadable modules. To facilitate the communication with modules, the main module starts by creating a pipe with a randomly generated name formatted using the following format string:</p>
<p><span style="font-family: courier new, courier, monospace;">{%08X-%04X-%04X-%04X-%08X%04X}</span></p>
<p>It then periodically checks the pipe for new messages using the <span style="font-family: courier new, courier, monospace;">PeekNamedPipe</span> Windows API function. Messages are parsed and handled according to their content. For a full list of recognized pipe commands and messages see Table 3.</p>
<p><em>Table 3. List of pipe message/command types</em></p>

<table id="tablepress-887" class="tablepress tablepress-id-887">
<thead>
<tr class="row-1 odd">
	<th class="column-1">Message code</th><th class="column-2">Description</th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1">0x10000012</td><td class="column-2">inject and execute received module in specified process</td>
</tr>
<tr class="row-3 odd">
	<td class="column-1">0x10000013</td><td class="column-2">data for C&amp;C server (execution logs, stolen data, …)</td>
</tr>
<tr class="row-4 even">
	<td class="column-1">0x10000014</td><td class="column-2">write requested configuration data to the file handle received in this message (most likely handle to named pipe created by some other module) (main config, network config, loader name, main module PID, ...)</td>
</tr>
<tr class="row-5 odd">
	<td class="column-1">0x10000020</td><td class="column-2">C&amp;C commands (not encrypted) – see Table 4 for the full list of available commands</td>
</tr>
<tr class="row-6 even">
	<td class="column-1">0x10000022</td><td class="column-2">set module status (or err code)</td>
</tr>
<tr class="row-7 odd">
	<td class="column-1">0x10000023</td><td class="column-2">set C&amp;C communication time intervals</td>
</tr>
<tr class="row-8 even">
	<td class="column-1">0x10000024</td><td class="column-2">close received list of handles</td>
</tr>
<tr class="row-9 odd">
	<td class="column-1">0x10000025</td><td class="column-2">get handle of the process with specified PID, duplicate it for some other specified process and send it through the received named pipe handle</td>
</tr>
<tr class="row-10 even">
	<td class="column-1">0x10000072</td><td class="column-2">C&amp;C commands (encrypted) – see Table 4 for the full list of available commands</td>
</tr>
</tbody>
</table>

<p>For the detailed structure and format used for the messages transferred through the pipe refer to Figure 10.</p>
<div id="attachment_145002" style="width: 462px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-10.-Structure-of-the-main-module’s-named-pipe-messages.png"><img class="wp-image-145002 size-full" src="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-10.-Structure-of-the-main-module’s-named-pipe-messages.png" alt="" width="452" height="234" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-10.-Structure-of-the-main-module’s-named-pipe-messages.png 452w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-10.-Structure-of-the-main-module’s-named-pipe-messages-300x155.png 300w" sizes="(max-width: 452px) 100vw, 452px" /></a><p class="wp-caption-text"><i>Figure 10. Structure of the main module’s named pipe messages</i></p></div>
<p>For communication with its C&amp;C server, the main module uses HTTP and port 80. Each of the dissected samples contained a list of potentially available servers from which one was randomly chosen. A list of all C&amp;C addresses discovered over the course of our research is available in the <em>Indicators of Compromise</em> section.</p>
<p>Messages sent to the C&amp;C (see Figure 11) are constructed and encrypted within the main module’s code.</p>
<p><center><br />
<a href="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-11a.-Structure-of-the-messages-sent-to-the-CC.png"><img class="wp-image-145003 size-medium alignleft" src="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-11a.-Structure-of-the-messages-sent-to-the-CC-300x156.png" alt="" width="300" height="156" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-11a.-Structure-of-the-messages-sent-to-the-CC-300x156.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-11a.-Structure-of-the-messages-sent-to-the-CC.png 600w" sizes="(max-width: 300px) 100vw, 300px" /></a><a href="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-11b.-Structure-of-the-messages-sent-to-the-CC.png"><img class="alignright wp-image-145004" src="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-11b.-Structure-of-the-messages-sent-to-the-CC-300x114.png" alt="" width="450" height="171" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-11b.-Structure-of-the-messages-sent-to-the-CC-300x114.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-11b.-Structure-of-the-messages-sent-to-the-CC.png 578w" sizes="(max-width: 450px) 100vw, 450px" /></a></center></p>
<div id="attachment_145007" style="width: 760px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-11c.-Structure-of-the-messages-sent-to-the-CC-1.png"><img class="wp-image-145007" src="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-11c.-Structure-of-the-messages-sent-to-the-CC-1-150x150.png" alt="" width="750" height="278" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-11c.-Structure-of-the-messages-sent-to-the-CC-1-300x111.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-11c.-Structure-of-the-messages-sent-to-the-CC-1-768x284.png 768w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-11c.-Structure-of-the-messages-sent-to-the-CC-1.png 845w" sizes="(max-width: 750px) 100vw, 750px" /></a><p class="wp-caption-text"><i>Figure 11. Structure of the messages sent to the C&amp;C</i></p></div>
<p>Before any communication with the  C&amp;C, the main module generates two clean URLs and uses them to check for an internet connection and a clean-looking cover for the malicious traffic. The URLs use the following format: <span style="font-family: courier new, courier, monospace;">www.%domain%[.]com/?%rand%</span>, where <span style="font-family: courier new, courier, monospace;">%domain%</span> is randomly chosen from <span style="font-family: courier new, courier, monospace;">google</span>, <span style="font-family: courier new, courier, monospace;">bing</span> and <span style="font-family: courier new, courier, monospace;">yahoo</span> and <span style="font-family: courier new, courier, monospace;">%rand%</span> is a random 32-bit unsigned integer represented in ASCII.</p>
<p>Communication with the C&amp;C is encrypted using AES in CBC mode with the following 128-bit key: <span style="font-family: courier new, courier, monospace;">F45D076FEC641691A21F0C946EDA9BD5</span>.  Before encryption, C&amp;C messages start with a 4-byte checksum, which is calculated as CRC32 (message) XORed with the first 4 bytes of the AES key used to encrypt the message. In the case of the key mentioned above, this would be <span style="font-family: courier new, courier, monospace;">F4 5D 07 6F</span>.</p>
<p>The data is transmitted using the lightweight networking module, which is injected on demand and exits immediately after uploading or downloading the requested message. To select the process for injection, the main module enumerates running processes and assigns them a priority value between 3 and 6. Those with higher priority are injected first, based on the following criteria:</p>
<ul>
<li>Priority 6
<ul>
<li>The highest priority, assigned to any process that has already been used successfully to inject a networking module, received a response from the C&amp;C and that is still running under the same PID, name and CreationTime.</li>
</ul>
</li>
<li>Priority 5
<ul>
<li>Process name with no extension that matches one of the following process names used for browsers: iexplore, opera, chrome, firefox</li>
</ul>
</li>
<li>Priority 4
<ul>
<li>Process name with no extension that matches the following process names: explorer, svchost</li>
</ul>
</li>
<li>Priority 3
<ul>
<li>All the other running processes excluding the following system processes: system, lsass, csrss, lsm, winlogon, smss, wininit</li>
</ul>
</li>
</ul>
<p>The main reason behind the priority list is to inject processes that are expected to communicate over the network and at the same time avoid system processes that might attract attention if caught communicating over the network.</p>
<h3>Networking module</h3>
<p>This ModPipe module is responsible for sending requests to the C&amp;C and parsing the payload received in the C&amp;C responses. HTTP POST or GET methods with headers shown in Figure 12 and Figure 13 can be used to upload data to the C&amp;C and download additional payloads and C&amp;C commands.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-6057fb3e9c954382040710" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /robots.txt HTTP/1.1 
Accept: */* 
Content-Length: %data_length% 
Content-Type: application/octet-stream 
User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0) 
Host: %remote_host% 
Cache-Control: no-cache 

%data%</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-6057fb3e9c954382040710-1">1</div><div class="crayon-num" data-line="crayon-6057fb3e9c954382040710-2">2</div><div class="crayon-num" data-line="crayon-6057fb3e9c954382040710-3">3</div><div class="crayon-num" data-line="crayon-6057fb3e9c954382040710-4">4</div><div class="crayon-num" data-line="crayon-6057fb3e9c954382040710-5">5</div><div class="crayon-num" data-line="crayon-6057fb3e9c954382040710-6">6</div><div class="crayon-num" data-line="crayon-6057fb3e9c954382040710-7">7</div><div class="crayon-num" data-line="crayon-6057fb3e9c954382040710-8">8</div><div class="crayon-num" data-line="crayon-6057fb3e9c954382040710-9">9</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-6057fb3e9c954382040710-1"><span class="crayon-v">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-v">robots</span><span class="crayon-sy">.</span><span class="crayon-e">txt </span><span class="crayon-v">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-6057fb3e9c954382040710-2"><span class="crayon-v">Accept</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-o">/</span><span class="crayon-o">*</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-6057fb3e9c954382040710-3"><span class="crayon-v">Content</span><span class="crayon-o">-</span><span class="crayon-v">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-v">data_length</span><span class="crayon-o">%</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-6057fb3e9c954382040710-4"><span class="crayon-v">Content</span><span class="crayon-o">-</span><span class="crayon-v">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">application</span><span class="crayon-o">/</span><span class="crayon-v">octet</span><span class="crayon-o">-</span><span class="crayon-e">stream </span></div><div class="crayon-line" id="crayon-6057fb3e9c954382040710-5"><span class="crayon-v">User</span><span class="crayon-o">-</span><span class="crayon-v">Agent</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Mozilla</span><span class="crayon-o">/</span><span class="crayon-cn">4.0</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">compatible</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-i">MSIE</span><span class="crayon-h"> </span><span class="crayon-cn">8.0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-e">Windows </span><span class="crayon-i">NT</span><span class="crayon-h"> </span><span class="crayon-cn">6.1</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">Trident</span><span class="crayon-o">/</span><span class="crayon-cn">4.0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-6057fb3e9c954382040710-6"><span class="crayon-v">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-v">remote_host</span><span class="crayon-o">%</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-6057fb3e9c954382040710-7"><span class="crayon-v">Cache</span><span class="crayon-o">-</span><span class="crayon-v">Control</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">no</span><span class="crayon-o">-</span><span class="crayon-v">cache</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-6057fb3e9c954382040710-8">&nbsp;</div><div class="crayon-line" id="crayon-6057fb3e9c954382040710-9"><span class="crayon-o">%</span><span class="crayon-v">data</span><span class="crayon-o">%</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p><em>Figure 12. HTTP POST header used to contact the C&amp;C</em></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-6057fb3e9c95b863203873" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
GET %rsrc_path% HTTP/1.1 
Accept: */* 
User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0) 
Host: %remote_host% 
Cache-Control: no-cache</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-6057fb3e9c95b863203873-1">1</div><div class="crayon-num" data-line="crayon-6057fb3e9c95b863203873-2">2</div><div class="crayon-num" data-line="crayon-6057fb3e9c95b863203873-3">3</div><div class="crayon-num" data-line="crayon-6057fb3e9c95b863203873-4">4</div><div class="crayon-num" data-line="crayon-6057fb3e9c95b863203873-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-6057fb3e9c95b863203873-1"><span class="crayon-v">GET</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-v">rsrc_path</span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-6057fb3e9c95b863203873-2"><span class="crayon-v">Accept</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-o">/</span><span class="crayon-o">*</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-6057fb3e9c95b863203873-3"><span class="crayon-v">User</span><span class="crayon-o">-</span><span class="crayon-v">Agent</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Mozilla</span><span class="crayon-o">/</span><span class="crayon-cn">4.0</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">compatible</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-i">MSIE</span><span class="crayon-h"> </span><span class="crayon-cn">8.0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-e">Windows </span><span class="crayon-i">NT</span><span class="crayon-h"> </span><span class="crayon-cn">6.1</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">Trident</span><span class="crayon-o">/</span><span class="crayon-cn">4.0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-6057fb3e9c95b863203873-4"><span class="crayon-v">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-v">remote_host</span><span class="crayon-o">%</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-6057fb3e9c95b863203873-5"><span class="crayon-v">Cache</span><span class="crayon-o">-</span><span class="crayon-v">Control</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">no</span><span class="crayon-o">-</span><span class="crayon-v">cache</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p><em>Figure 13. HTTP GET message header</em></p>
<p>Responses from the C&amp;C server have to be at least 33-bytes long in order to be parsed by the networking module and the malicious payload is located after a sequence of 13 spaces followed by an HTML comment opening tag. An example of a server response including this sequence is shown in Figure 14.</p>
<div id="attachment_144994" style="width: 660px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-14.-Example-CC-server-response-including-encrypted-payload.png"><img class="wp-image-144994" src="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-14.-Example-CC-server-response-including-encrypted-payload-150x150.png" alt="" width="650" height="245" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-14.-Example-CC-server-response-including-encrypted-payload-300x113.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-14.-Example-CC-server-response-including-encrypted-payload-768x289.png 768w, https://www.welivesecurity.com/wp-content/uploads/2020/11/Figure-14.-Example-CC-server-response-including-encrypted-payload.png 970w" sizes="(max-width: 650px) 100vw, 650px" /></a><p class="wp-caption-text"><i>Figure 14. Example C&amp;C server response including encrypted payload</i></p></div>
<p>If all conditions are met, the network module sends the C&amp;C response to the main module using a pipe message with ID 0x10000072. The main module then decrypts the payload, verifies its checksum and executes the C&amp;C command. Available commands are listed in Table 4.</p>
<p><em>Table 4. List of available main module commands</em></p>

<table id="tablepress-888" class="tablepress tablepress-id-888">
<thead>
<tr class="row-1 odd">
	<th class="column-1">Command code</th><th class="column-2">Command description</th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1">0x01</td><td class="column-2">Exit</td>
</tr>
<tr class="row-3 odd">
	<td class="column-1">0x05</td><td class="column-2">Update list of C&amp;C addresses</td>
</tr>
<tr class="row-4 even">
	<td class="column-1">0x0A</td><td class="column-2">Inject and execute received module in specified process</td>
</tr>
<tr class="row-5 odd">
	<td class="column-1">0x0B</td><td class="column-2">Inject and execute received module in specified process (module name is included in the command)</td>
</tr>
<tr class="row-6 even">
	<td class="column-1">0x0C</td><td class="column-2">Optionally write module to the encrypted storage, then inject and execute received module in specified process – add it to the list of the installed modules</td>
</tr>
<tr class="row-7 odd">
	<td class="column-1">0x0D</td><td class="column-2">Send command to the named pipe belonging to the module with specified ID and queue the response for the upload to the C&amp;C</td>
</tr>
<tr class="row-8 even">
	<td class="column-1">0x0E</td><td class="column-2">Uninstall module with specified ID (remove from the in-memory list and encrypted storage)</td>
</tr>
<tr class="row-9 odd">
	<td class="column-1">0x0F</td><td class="column-2">Save network configuration to the encrypted storage</td>
</tr>
</tbody>
</table>

<h2></h2>
<h2>Conclusion</h2>
<p>ModPipe shows quite a few interesting features. Probably the most intriguing finding is the algorithm hidden in one of the backdoor’s modules, which was specifically designed to steal credentials by decrypting them from registry values. By acquiring the database passwords, the attackers gain broad access to sensitive information even though the most sensitive data stored in devices running RES 3700 POS should still be protected by encryption.</p>
<p>ModPipe’s architecture, modules and their capabilities also indicate that its writers have extensive knowledge of the targeted RES 3700 POS software. The proficiency of the operators could stem from multiple scenarios, including stealing and reverse engineering the proprietary software product, misusing its leaked parts or buying code from an underground market.</p>
<p>To keep the operators behind ModPipe at bay, potential victims in the hospitality sector as well as any other businesses using the RES 3700 POS are advised to:</p>
<ul>
<li>Use the latest version of the software.</li>
<li>Use it on devices that run updated operating system and software.</li>
<li>Use reliable multi-layered security software that can detect ModPipe and similar threats.</li>
</ul>
<h2>Indicators of Compromise</h2>
<h3>C&amp;C IP addresses</h3>
<ul>
<li>191.101.31[.]223</li>
<li>194.32.76[.]192</li>
<li>23.19.58[.]114</li>
<li>88.99.177[.]103</li>
<li>91.209.77[.]172</li>
<li>5.135.230[.]136</li>
</ul>
<h3>C&amp;C domains/URLs</h3>
<ul>
<li>subzeroday.zapto[.]org</li>
<li>shj145ertyb.ddns[.]net/gettime.html</li>
<li>ouidji12345.ddns[.]net/gettime.html</li>
</ul>
<h3>Dropper samples</h3>
<ul>
<li><span style="font-family: courier new, courier, monospace;">9F8530627A8AD38F47102F626DEC9F0173B44CD5</span></li>
<li><span style="font-family: courier new, courier, monospace;">FEE9C08B494C80DBF73A6F70FACD20ED0429330D</span></li>
</ul>
<h3>Loader samples</h3>
<ul>
<li><span style="font-family: courier new, courier, monospace;">0D1A4CB620576B8ADD34F919B4C6C46E7C3F9A59</span></li>
<li><span style="font-family: courier new, courier, monospace;">B47E05D67DC055AF5B0689782D67EAA2EB8C75E3</span></li>
<li><span style="font-family: courier new, courier, monospace;">F213B4EEF63F06EC127D3DC3265E14EE190B71E5</span></li>
<li><span style="font-family: courier new, courier, monospace;">B2CE307DFE65C188FDAE169ABD65B75B112522C4</span></li>
<li><span style="font-family: courier new, courier, monospace;">2AC7A2C09E50EAFABF1F401194AC487ED96C6781</span></li>
<li><span style="font-family: courier new, courier, monospace;">0F4355A17AABD3645788341EAC2A9BB759DB95EE</span></li>
</ul>
<h3>File paths</h3>
<ul>
<li>%CSIDL_APPDATA%\Microsoft\Windows\{%rand_guid%}\explorer.exe</li>
<li>%WINDIR%\system32\%random_name%.exe</li>
</ul>
<p>%rand_guid% &#8211; pseudo-random GUID formatted string<br />
%random_name% &#8211; from 4 to 7 pseudo-random letters (a-z) with the first one capital e.g. “Cvoeqo.exe”</p>
<h2>MITRE ATT&amp;CK techniques</h2>
<p><em>Note: This table was built using </em><a href="https://attack.mitre.org/versions/v7/" target="_blank" rel="noopener"><em>version 7</em></a><em> of the MITRE ATT&amp;CK framework.</em></p>

<table id="tablepress-889" class="tablepress tablepress-id-889">
<thead>
<tr class="row-1 odd">
	<th class="column-1">Tactic</th><th class="column-2">ID</th><th class="column-3">Name</th><th class="column-4">Description</th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1">Execution</td><td class="column-2"><a href="https://attack.mitre.org/versions/v7/techniques/T1059/003/" rel="noopener" target="_blank">T1059.003</a></td><td class="column-3">Command and Scripting Interpreter: Windows Command Shell</td><td class="column-4">Attackers were seen using Windows Command Shell to execute the initial dropper.</td>
</tr>
<tr class="row-3 odd">
	<td rowspan="2" class="column-1">Persistence</td><td class="column-2"><a href="https://attack.mitre.org/versions/v7/techniques/T1547/001/" rel="noopener" target="_blank">T1547.001</a></td><td class="column-3">Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder</td><td class="column-4">ModPipe can use Registry Run key for persistence.</td>
</tr>
<tr class="row-4 even">
	<td class="column-2"><a href="https://attack.mitre.org/versions/v7/techniques/T1543/003/" rel="noopener" target="_blank">T1543.003</a></td><td class="column-3">Create or Modify System Process: Windows Service</td><td class="column-4">ModPipe can create a new service for persistence.</td>
</tr>
<tr class="row-5 odd">
	<td class="column-1">Privilege Escalation</td><td class="column-2"><a href="https://attack.mitre.org/versions/v7/techniques/T1134/001/" rel="noopener" target="_blank">T1134.001</a></td><td class="column-3">Access Token Manipulation: Token Impersonation/Theft</td><td class="column-4">Attackers were seen using partially modified <a href="https://github.com/itm4n/PrintSpoofer" rel="noopener" target="_blank">PrintSpoofer </a>tool to drop and subsequently execute loader with SYSTEM privileges. </td>
</tr>
<tr class="row-6 even">
	<td rowspan="2" class="column-1">Defense Evasion</td><td class="column-2"><a href="https://attack.mitre.org/versions/v7/techniques/T1055/002/" rel="noopener" target="_blank">T1055.002</a></td><td class="column-3">Process Injection: Portable Executable Injection</td><td class="column-4">ModPipe can inject it’s modules into various processes.</td>
</tr>
<tr class="row-7 odd">
	<td class="column-2"><a href="https://attack.mitre.org/versions/v7/techniques/T1205/" rel="noopener" target="_blank">T1205</a></td><td class="column-3">Traffic Signaling</td><td class="column-4">ModPipe’s ModScan module sends random 32-bit values to  TCP ports 50123 and 2638 of the specified IP address and requires a specific response in order to continue executing its scan functionality.</td>
</tr>
<tr class="row-8 even">
	<td class="column-1">Credential Access</td><td class="column-2"><a href="https://attack.mitre.org/versions/v7/techniques/T1552/002/" rel="noopener" target="_blank">T1552.002</a></td><td class="column-3">Unsecured Credentials: Credentials in Registry</td><td class="column-4">ModPipe’s GetMicInfo module retrieves encrypted database passwords for ORACLE MICROS RES 3700 POS software from Windows Registry and uses a custom algorithm to decrypt them before uploading to the C&amp;C.</td>
</tr>
<tr class="row-9 odd">
	<td rowspan="3" class="column-1">Discovery</td><td class="column-2"><a href="https://attack.mitre.org/versions/v7/techniques/T1057/" rel="noopener" target="_blank">T1057</a></td><td class="column-3">Process Discovery</td><td class="column-4">ModPipe’s ProcList module can get information about processes running on a system.</td>
</tr>
<tr class="row-10 even">
	<td class="column-2"><a href="https://attack.mitre.org/versions/v7/techniques/T1012/" rel="noopener" target="_blank">T1012</a></td><td class="column-3">Query Registry</td><td class="column-4">ModPipe’s GetMicInfo module queries the Registry for ORACLE MICROS RES 3700 POS version, database passwords and other configuration data.</td>
</tr>
<tr class="row-11 odd">
	<td class="column-2"><a href="https://attack.mitre.org/versions/v7/techniques/T1033/" rel="noopener" target="_blank">T1033</a></td><td class="column-3">System Owner/User Discovery</td><td class="column-4">ModPipe gathers username and computer name from victim machines and reports them to the C&amp;C in initial message.</td>
</tr>
<tr class="row-12 even">
	<td rowspan="2" class="column-1">Command and Control</td><td class="column-2"><a href="https://attack.mitre.org/versions/v7/techniques/T1071/001/" rel="noopener" target="_blank">T1071.001</a></td><td class="column-3">Application Layer Protocol: Web Protocols</td><td class="column-4">ModPipe uses HTTP for command and control.</td>
</tr>
<tr class="row-13 odd">
	<td class="column-2"><a href="https://attack.mitre.org/versions/v7/techniques/T1573/001/" rel="noopener" target="_blank">T1573.001</a></td><td class="column-3">Encrypted Channel: Symmetric Cryptography</td><td class="column-4">ModPipe encrypts communication with C&amp;C using AES in CBC mode.</td>
</tr>
<tr class="row-14 even">
	<td rowspan="2" class="column-1">Exfiltration</td><td class="column-2"><a href="https://attack.mitre.org/versions/v7/techniques/T1041/" rel="noopener" target="_blank">T1041</a></td><td class="column-3">Exfiltration Over C2 Channel</td><td class="column-4">ModPipe exfiltrates data over its C&amp;C channel.</td>
</tr>
<tr class="row-15 odd">
	<td class="column-2"><a href="https://attack.mitre.org/versions/v7/techniques/T1029/" rel="noopener" target="_blank">T1029</a></td><td class="column-3">Scheduled Transfer</td><td class="column-4">Default interval used by ModPipe for uploading data to C&amp;C is set to 30 minutes. </td>
</tr>
</tbody>
</table>


                            
                                                            <div class="dot">
                                    <span class="icomoon icon-icon_article_dot"></span>
                                </div>

                                <div class="meta">
                                    <div class="wls-authors wls-authors-footer">
                                                <div class="wls-author">
                        <div class="wls-author-name">
                <a href="https://www.welivesecurity.com/author/msmolar/" title="Martin Smolár">
                    Martin Smolár                </a>
            </div>
        </div>
                                            </div>
                                    <span class="strong">
								        <time datetime="2020-11-12 11:30:34">12 Nov 2020 - 11:30AM</time>
                                    </span>
                                </div>
                            
                            <div class="widgets row">
                                <div class="col-md-12 col-sm-12 col-xs-12">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12 no-padding">
                                        <h3><span class="text">Newsletter</span></h3>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-12 newsletter-wrapper">
                                    			
		<div class="heading-line col-md-12 no-padding sidebar-item clearfix">
			<h3>
				<span class="text">Newsletter</span>
			</h3>

			<form action="//liondigital.us3.list-manage.com/subscribe/post?u=b76f82b1cc198ab1d80665c99&amp;id=102b0810e2" class="basic-searchform col-md-12 col-sm-12 col-xs-12 no-padding newsletter" method="post" role="search">
				<div class="search-input clearfix">
					<input type="text" name="email" value="" placeholder="Email...">
					<button>
						Submit					</button>
				</div>
			</form>		
		</div>
                                </div>
                            </div>

                                                            <div class="similar-articles row">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12">
                                        <h3><span class="text">Similar Articles</span></h3>
                                    </div>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/cybercrime/" class="category-tag-btn">Cybercrime</a>                                                <a href="https://www.welivesecurity.com/2021/03/18/fbi-cybercrime-losses-topped-us42billion-2020/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/03/fbi-cybercrime-losses-2020-ic3-623x432.jpg"
                                                         alt="Hungry for data, ModPipe backdoor hits POS software used in hospitality sector">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/03/18/fbi-cybercrime-losses-topped-us42billion-2020/">
                                                    FBI: Cybercrime losses topped US$4.2 billion in 2020                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/03/10/exchange-servers-under-siege-10-apt-groups/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/03/exchange-servers-under-siege-10-apt-groups-623x432.jpg"
                                                         alt="Hungry for data, ModPipe backdoor hits POS software used in hospitality sector">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/03/10/exchange-servers-under-siege-10-apt-groups/">
                                                    Exchange servers under siege from at least 10 APT groups                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/02/18/malware-authors-already-taking-aim-apple-m1-macs/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/02/apple-m1-macs-malware-1-623x432.jpg"
                                                         alt="Hungry for data, ModPipe backdoor hits POS software used in hospitality sector">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/02/18/malware-authors-already-taking-aim-apple-m1-macs/">
                                                    Malware authors already taking aim at Apple M1 Macs                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/02/02/kobalos-complex-linux-threat-high-performance-computing-infrastructure/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/02/eset-kobalos-hpc-high-performance-computing-malware-research-623x432.jpg"
                                                         alt="Hungry for data, ModPipe backdoor hits POS software used in hospitality sector">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/02/02/kobalos-complex-linux-threat-high-performance-computing-infrastructure/">
                                                    Kobalos – A complex Linux threat to high performance computing infrastructure                                                </a>
                                            </h4>
                                        </article>
                                                                    </div>
                            
                            <div class="comments row">
                                <div class="heading-line col-xs-12">
                                    <h3><span class="text">Discussion</span></h3>
                                                                            
<div id="disqus_thread"></div>
                                                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    	</div> 	<footer id="site-footer">
		<div class="container">
			<div class="row">
				<div class="col-md-2">
                    <div class="hidden-sm hidden-xs">
                        <div class="logo-wrapper footer clearfix">
                            <div class="dark clearfix">
                                <a href="https://www.welivesecurity.com/" class="wls">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-1.svg" alt="Welivesecurity.com">
                                </a>
                                <a href="https://www.eset.com" class="eset">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-2.svg" alt="by ESET">
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="hidden-lg hidden-md">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
				</div>
				<nav id="footer" class="clearfix">
											<div class="mobile-block">
																<div class="col-md-2 col-md-offset-2">
										<ul>
																							<li>
													<a href="/">Home</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/about-us/">About Us</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/contact-us/">Contact Us</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/sitemap/">Sitemap</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/our-experts/">Our Experts</a>
												</li>
																							<li>
													<a href="https://eset.com">ESET</a>
												</li>
																					</ul>
									</div>
													</div>
											<div class="mobile-block">
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/research/">Research</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/category/how-to/">How To</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/categories/">Categories</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/rss-configurator/">RSS Configurator</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/news-widget-generator/">News Widget</a>
												</li>
																					</ul>
									</div>
													</div>
									</nav>
			</div>
			<div class="row">
				<div class="col-md-12 legal clearfix">
					<div class="wrap clearfix">
													<span>
								<a href="https://www.welivesecurity.com/privacy/">
									Privacy policy								</a>
							</span>
													<span>
								<a href="https://www.welivesecurity.com/legal-information/">
									Legal Information								</a>
							</span>
											</div>
					<span class="copyright pull-right">Copyright &copy; ESET, All Rights Reserved</span>
				</div>
							</div>
		</div>
	</footer>
	
	<button id="back-to-top" class="animated-scroll" data-target="absoluteTop">
		<span class="icomoon icon-icon_arrow"></span>
		<span class="text">Back to top</span>
	</button>

			<div class="social-wrapper-mobile hidden-lg hidden-md hidden-sm" id="mobile-article-sharer">
			<div class="col-xs-12">
				<div class="icons" style="text-align: center;">
											<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2020%2F11%2F12%2Fhungry-data-modpipe-backdoor-hits-pos-software-hospitality-sector%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
							<span class="icomoon icon-icon_fb"></span>
						</a>
											<a class="share-twitter" href="https://twitter.com/intent/tweet?https%3A%2F%2Fwww.welivesecurity.com%2F2020%2F11%2F12%2Fhungry-data-modpipe-backdoor-hits-pos-software-hospitality-sector%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
							<span class="icomoon icon-icon_tw"></span>
						</a>
											<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2020%2F11%2F12%2Fhungry-data-modpipe-backdoor-hits-pos-software-hospitality-sector%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
							<span class="icomoon icon-icon_in"></span>
						</a>
									</div>
			</div>
		</div>
	
	<script>
		var baseUrl = "https://www.welivesecurity.com/";
	</script>
	
			<script>
            !function(){if(-1==window.document.cookie.indexOf("user_rec=1")){function e(e,o){var t=document.createElement("img");t.setAttribute("style","display:none"),t.src=e+o,window.document.body.appendChild(t)}function o(){d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Default%20status&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=defaultStatus&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c)}function t(){console.log("GA and GTM are loaded."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=11",e(u,a),e(s,c)}function n(){var e=new Date;e.setTime(e.getTime()+63072e6);var o="expires="+e.toUTCString();window.document.cookie="user_rec=1; "+o+"; path=/"}var d,a,c,i,r,l="UA-76266002-27",g=window.location.href,s="https://cdn1.esetstatic.com/ESET/INT/assets/img/check.png",u="https://www.google-analytics.com/collect",w="wls",m=0,h=function e(){i=window.ga&&ga.create?1:0,r=window.google_tag_manager?1:0,m++,console.log("Timer: ",m),h=setTimeout(e,500)};window.document.addEventListener&&(d=1e6*Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Script%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=scriptLoaded&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c),window.addEventListener("beforeunload",o),window.ga&&ga.create&&window.google_tag_manager?(t(),window.removeEventListener("beforeunload",o),n()):(setTimeout(h,500),setTimeout(function(){clearTimeout(h),i&&r?t():i&&!r?(console.log("GA is loaded and GTM is blocked."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=10",e(u,a),e(s,c)):!i&&r?(console.log("GA is blocked and GTM is loaded."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=01",e(u,a),e(s,c)):i||r||(console.log("GA is blocked and GTM is blocked."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=00",e(u,a),e(s,c)),window.removeEventListener("beforeunload",o),n()},1e4)))}}();
		</script>
	
	<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/js/main-0ba0c3843d.js"></script>
    <!-- Version: v1.1.76.32619db9.pro-awus -->
    		<script type="text/javascript">
			var disqus_config = function () { 
				this.language = "en";
			};
			var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":"", "numsVisible": false};
			var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
		</script>
		<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/static/js/crayon.min.js"></script>

			
		
    <script>
    	Main.init();
    </script>

    <script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"welivesecurity"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_count.js?ver=3.0.16'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var embedVars = {"disqusConfig":{"integration":"wordpress 3.0.16"},"disqusIdentifier":"144922 https:\/\/backend.welivesecurity.com\/?p=144922","disqusShortname":"welivesecurity","disqusTitle":"Hungry for data, ModPipe backdoor hits POS software used in hospitality sector","disqusUrl":"https:\/\/www.welivesecurity.com\/2020\/11\/12\/hungry-data-modpipe-backdoor-hits-pos-software-hospitality-sector\/","postId":"144922"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_embed.js?ver=3.0.16'></script>
    <script src="https://assets.esetstatic.com/3PR/app.min.js"></script>
  </body>
</html>